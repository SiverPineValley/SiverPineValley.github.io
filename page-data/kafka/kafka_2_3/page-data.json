{"componentChunkName":"component---src-templates-blog-post-js","path":"/kafka/kafka_2_3/","result":{"data":{"site":{"siteMetadata":{"title":"Devlog"}},"markdownRemark":{"id":"1c4c82cc-4fed-55be-a6c1-4a8047478138","excerpt":"데이터의 저장은 브로커의 역할 중 하나이다. 카프카를 실행할 때 config/server.properties의  옵션에 지정한 경로에 데이터를 저장한다. (토픽 이름 + Partition…","html":"<ul>\n<li>데이터의 저장은 브로커의 역할 중 하나이다.</li>\n<li>카프카를 실행할 때 config/server.properties의 <code class=\"language-text\">log.dir</code> 옵션에 지정한 경로에 데이터를 저장한다. (토픽 이름 + Partition 번호를 조합)\n- 해당 경로 안에는 여러 파일이 생성되는데, <code class=\"language-text\">log</code>에는 메시지와 메타데이터, <code class=\"language-text\">index</code>에는 메시지의 오프셋을 인덱싱한 파일, <code class=\"language-text\">timeindex</code> 파일에는 타임스탬프 값을 기준으로 인덱싱한 데이터가 저장된다.</li>\n</ul>\n</br>\n<div align=\"left\">\n  <span class=\"gatsby-resp-image-wrapper\" style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 630px; \">\n      <a class=\"gatsby-resp-image-link\" href=\"/static/9533d0cb5bf8e7e8630fa376de89c1a4/8079d/%EC%8A%A4%ED%81%AC%EB%A6%B0%EC%83%B7%202024-12-07%20%EC%98%A4%ED%9B%84%202.35.55.png\" style=\"display: block\" target=\"_blank\" rel=\"noopener\">\n    <span class=\"gatsby-resp-image-background-image\" style=\"padding-bottom: 36.075949367088604%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAHCAYAAAAIy204AAAACXBIWXMAABYlAAAWJQFJUiTwAAABkUlEQVR42nWOy8qSURiFvytw4ET7ElEnNWjSIIyg8gSmODED+5X8wz9n3oIXIXhMrUwUPHye8QCK4kx0ZiDiwIn38eTeUKMaPOz1Lt717qWkUilCoRCJREISj8d5+PLA/f1nYrHYjU/4fD78fv9/CQQCuFwukskkSiQSwW6343a7cTgcOJ1OXr96y4unL7E8sqE+VjEYDP/EaDRKVFVFp9Ph8XhQRKNgMEg0GiUcDnP38Y737z7w5rmbJ+ozrFYrNpvtL2K2WCwSk8kkMZvN6PV6vF4vynA4JJPJUCwWKRQK8v1R+Mm3r9/J5/Lk83np/aFUKkmEn81myeVyUqfTadrtNsp2u6Xb7TKbzRiNRnQ0jcGwf2OA1tWYTCaMx2P6/b7cE1oEp9Mpg8FA+iLX6/VYLBYoy+WSWq0mzVarRaVSoV6vU61WpdZuH4gDwiuXyzQaDdlI+EKLPZEXrZvNJsr1euVwODCfz2VwtVrd5l+cTieOxyP7/V6GRdPdbie98/nMer2m0+nIxoLNZsPlcuE3b61Yoi5JR9YAAAAASUVORK5CYII='); background-size: cover; display: block;\"></span>\n  <img class=\"gatsby-resp-image-image\" alt=\"     2024 12 07    2 35 55\" title=\"\" src=\"/static/9533d0cb5bf8e7e8630fa376de89c1a4/f058b/%EC%8A%A4%ED%81%AC%EB%A6%B0%EC%83%B7%202024-12-07%20%EC%98%A4%ED%9B%84%202.35.55.png\" srcset=\"/static/9533d0cb5bf8e7e8630fa376de89c1a4/c26ae/%EC%8A%A4%ED%81%AC%EB%A6%B0%EC%83%B7%202024-12-07%20%EC%98%A4%ED%9B%84%202.35.55.png 158w,\n/static/9533d0cb5bf8e7e8630fa376de89c1a4/6bdcf/%EC%8A%A4%ED%81%AC%EB%A6%B0%EC%83%B7%202024-12-07%20%EC%98%A4%ED%9B%84%202.35.55.png 315w,\n/static/9533d0cb5bf8e7e8630fa376de89c1a4/f058b/%EC%8A%A4%ED%81%AC%EB%A6%B0%EC%83%B7%202024-12-07%20%EC%98%A4%ED%9B%84%202.35.55.png 630w,\n/static/9533d0cb5bf8e7e8630fa376de89c1a4/40601/%EC%8A%A4%ED%81%AC%EB%A6%B0%EC%83%B7%202024-12-07%20%EC%98%A4%ED%9B%84%202.35.55.png 945w,\n/static/9533d0cb5bf8e7e8630fa376de89c1a4/78612/%EC%8A%A4%ED%81%AC%EB%A6%B0%EC%83%B7%202024-12-07%20%EC%98%A4%ED%9B%84%202.35.55.png 1260w,\n/static/9533d0cb5bf8e7e8630fa376de89c1a4/8079d/%EC%8A%A4%ED%81%AC%EB%A6%B0%EC%83%B7%202024-12-07%20%EC%98%A4%ED%9B%84%202.35.55.png 2100w\" sizes=\"(max-width: 630px) 100vw, 630px\" style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\" loading=\"lazy\" decoding=\"async\">\n  </a>\n    </span>\n</div>\n</br>\n<ul>\n<li>로그 파일은 파일 시스템을 나눠서 저장하는데, 다음과 같은 설정에 의해 로그 세그먼트 파일의 크기가 정해진다. 로그 파일의 이름은 해당 파일의 offset 시작 번호이다. 현재 작성되고 있는 세그먼트 파일을 <code class=\"language-text\">active segment</code>라고 한다. 일반 세그먼트 파일은 retention 옵션에 따라 삭제 대상으로 지정된다.\n<ul>\n<li><code class=\"language-text\">log.segment.bytes</code>: 바이트 단위의 최대 세그먼트 크기 기정 (기본값: 1GB)</li>\n<li><code class=\"language-text\">log.rolls.ms(hours)</code>: 세그먼트가 신규 생성된 이후 다음 파일로 넘어가는 주기. (기본값: 7일)</li>\n</ul>\n</li>\n</ul>\n</br>\n<div align=\"left\">\n  <span class=\"gatsby-resp-image-wrapper\" style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 630px; \">\n      <a class=\"gatsby-resp-image-link\" href=\"/static/6c1d934de1b95cbf15b3b48ccf37b283/aae30/%EC%8A%A4%ED%81%AC%EB%A6%B0%EC%83%B7%202024-12-07%20%EC%98%A4%ED%9B%84%202.37.21.png\" style=\"display: block\" target=\"_blank\" rel=\"noopener\">\n    <span class=\"gatsby-resp-image-background-image\" style=\"padding-bottom: 36.708860759493675%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAHCAYAAAAIy204AAAACXBIWXMAABYlAAAWJQFJUiTwAAABSUlEQVR42n2PucrCUBCF71uIQgoRRWMpamGlhQsIAcGlznMFF9yXuBBEIhZio2DlAwRFLH2H8zOHPyktPuZyZubMuco0TdRqNbTbbXQ6HTSbTVKv10m1WkUul0M2m/1JJpNBqVSCMgwDxWKRi5VKhRQKBaRSKUQiEWiahnA4/BOZC4VCSCaTUJKq0Wig1WoF6crlMvL5PKLRKHRdh55Os6b/qxwT4vE4SSQSiMViTKlOpxOWyyXW6zVs2w7qarXCeDwmk8mETKdTzOdzzGazoDcajchwOKSPul6vNDgcDtjtdlzcbDaBseM42O/3HJbedrulsfR93Q8gqPP5THd/sNfrscrVwWCAxWLBVPLudrs0tSyLO6LLvE+/34f6fr94Pp+4XC68eL/f8Xq98Pl8qD8eD6Y8Ho98e57H3u12YwjRXdeF/PT9fuMPN8NYvrD9UU0AAAAASUVORK5CYII='); background-size: cover; display: block;\"></span>\n  <img class=\"gatsby-resp-image-image\" alt=\"     2024 12 07    2 37 21\" title=\"\" src=\"/static/6c1d934de1b95cbf15b3b48ccf37b283/f058b/%EC%8A%A4%ED%81%AC%EB%A6%B0%EC%83%B7%202024-12-07%20%EC%98%A4%ED%9B%84%202.37.21.png\" srcset=\"/static/6c1d934de1b95cbf15b3b48ccf37b283/c26ae/%EC%8A%A4%ED%81%AC%EB%A6%B0%EC%83%B7%202024-12-07%20%EC%98%A4%ED%9B%84%202.37.21.png 158w,\n/static/6c1d934de1b95cbf15b3b48ccf37b283/6bdcf/%EC%8A%A4%ED%81%AC%EB%A6%B0%EC%83%B7%202024-12-07%20%EC%98%A4%ED%9B%84%202.37.21.png 315w,\n/static/6c1d934de1b95cbf15b3b48ccf37b283/f058b/%EC%8A%A4%ED%81%AC%EB%A6%B0%EC%83%B7%202024-12-07%20%EC%98%A4%ED%9B%84%202.37.21.png 630w,\n/static/6c1d934de1b95cbf15b3b48ccf37b283/40601/%EC%8A%A4%ED%81%AC%EB%A6%B0%EC%83%B7%202024-12-07%20%EC%98%A4%ED%9B%84%202.37.21.png 945w,\n/static/6c1d934de1b95cbf15b3b48ccf37b283/78612/%EC%8A%A4%ED%81%AC%EB%A6%B0%EC%83%B7%202024-12-07%20%EC%98%A4%ED%9B%84%202.37.21.png 1260w,\n/static/6c1d934de1b95cbf15b3b48ccf37b283/aae30/%EC%8A%A4%ED%81%AC%EB%A6%B0%EC%83%B7%202024-12-07%20%EC%98%A4%ED%9B%84%202.37.21.png 2080w\" sizes=\"(max-width: 630px) 100vw, 630px\" style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\" loading=\"lazy\" decoding=\"async\">\n  </a>\n    </span>\n</div>\n</br>\n<ul>\n<li>세그먼트의 삭제 주기는 다음과 같은 옵션에 의해 정해진다. 세그먼트의 삭제는 파일 단위로 진행되므로, 특정 레코드(키, 값, 오프셋, 타임스탬프) 단위로는 삭제/수정이 불가능하다.\n<ul>\n<li><code class=\"language-text\">cleanup.policy=delete</code>: 세그먼트의 삭제를 결정하는 옵션</li>\n<li><code class=\"language-text\">retention.ms(minitues, hours)</code>: 세그먼트를 보유할 최대 기간. (기본값: 7일)</li>\n<li><code class=\"language-text\">retention.bytes</code>: 파티션 당 로그 적재 바이트 값. (기본값: -1, 지정하지 않음)</li>\n<li><code class=\"language-text\">log.retention.check.interval.ms</code>: 세그먼트가 삭제 영역에 들어왔는지 확인하는 간격. (기본값: 5분)</li>\n</ul>\n</li>\n</ul>\n</br>\n<div align=\"left\">\n  <span class=\"gatsby-resp-image-wrapper\" style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 630px; \">\n      <a class=\"gatsby-resp-image-link\" href=\"/static/9f776f048e7b9cb2d6e2b698d4a569f5/b8471/%EC%8A%A4%ED%81%AC%EB%A6%B0%EC%83%B7%202024-12-07%20%EC%98%A4%ED%9B%84%202.38.06.png\" style=\"display: block\" target=\"_blank\" rel=\"noopener\">\n    <span class=\"gatsby-resp-image-background-image\" style=\"padding-bottom: 46.835443037974684%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAJCAYAAAAywQxIAAAACXBIWXMAABYlAAAWJQFJUiTwAAABiklEQVR42k1RyarCQBCcb/Ob/BDBfd8RUVFcERKNS3ynxIsLCCJGTx4U8ehSUg3xZaCZ6a7umu5qtVqtMJlMYBgGTNPEfD6HbdkwjT/omo71eo33+/2z1+sl9+fzgffQJ6YI8jyfz58RPDkn8LPz+fwj8drhcMB+v8fxeMRut8PtdhMedb1eBbBtG61WC91uF/1+H81mE41GA/V6HZ1OB71eD+12W+7hcChYrVZDtVqVmzmLxQKKI0UiESELhUJi4XAY0WgUwWBQ3oylUikEAgGJJRIJwd08+sT5iXTIlsmeTqdRLBZRKBTEcrmc+JlMBvF4XN7lclkKXYx5lUpFOtV1/V9D6kbz6sTzeDzg9/vh8/mw3W4lhzp7dfXWqfv9DsdxsNlsMB6PZdvT6VS2PZvNJMYOstms6DsajQRnN5qmyc0Y8yzLgiJRLBaTRVAHjsbR8/m8+NSHxvGoNXVjnDV8M8YaxrhAdblcsFwupRsGSUZzNXQ/ISlJqCc7dkmSyaTklUolDAYDfAEm2Uq6UJCkCAAAAABJRU5ErkJggg=='); background-size: cover; display: block;\"></span>\n  <img class=\"gatsby-resp-image-image\" alt=\"     2024 12 07    2 38 06\" title=\"\" src=\"/static/9f776f048e7b9cb2d6e2b698d4a569f5/f058b/%EC%8A%A4%ED%81%AC%EB%A6%B0%EC%83%B7%202024-12-07%20%EC%98%A4%ED%9B%84%202.38.06.png\" srcset=\"/static/9f776f048e7b9cb2d6e2b698d4a569f5/c26ae/%EC%8A%A4%ED%81%AC%EB%A6%B0%EC%83%B7%202024-12-07%20%EC%98%A4%ED%9B%84%202.38.06.png 158w,\n/static/9f776f048e7b9cb2d6e2b698d4a569f5/6bdcf/%EC%8A%A4%ED%81%AC%EB%A6%B0%EC%83%B7%202024-12-07%20%EC%98%A4%ED%9B%84%202.38.06.png 315w,\n/static/9f776f048e7b9cb2d6e2b698d4a569f5/f058b/%EC%8A%A4%ED%81%AC%EB%A6%B0%EC%83%B7%202024-12-07%20%EC%98%A4%ED%9B%84%202.38.06.png 630w,\n/static/9f776f048e7b9cb2d6e2b698d4a569f5/40601/%EC%8A%A4%ED%81%AC%EB%A6%B0%EC%83%B7%202024-12-07%20%EC%98%A4%ED%9B%84%202.38.06.png 945w,\n/static/9f776f048e7b9cb2d6e2b698d4a569f5/78612/%EC%8A%A4%ED%81%AC%EB%A6%B0%EC%83%B7%202024-12-07%20%EC%98%A4%ED%9B%84%202.38.06.png 1260w,\n/static/9f776f048e7b9cb2d6e2b698d4a569f5/b8471/%EC%8A%A4%ED%81%AC%EB%A6%B0%EC%83%B7%202024-12-07%20%EC%98%A4%ED%9B%84%202.38.06.png 2016w\" sizes=\"(max-width: 630px) 100vw, 630px\" style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\" loading=\"lazy\" decoding=\"async\">\n  </a>\n    </span>\n</div>\n</br>\n<ul>\n<li>세그먼트의 압축이란 zip 파일과 같은 파일의 압축(compression)과는 다른 개념이다. 여기서 압축이란 <strong>메시지의 키 별로 해당 메시지의 레코드 중 오래된 데이터를 삭제하는 정책</strong>을 말한다. 그렇기 때문에 delete 와 다르게, 일부 레코드만 삭제될 수 있다. 압축은 세그먼트를 제외한 데이터가 대상이다. 이러한 compact 옵션은 key-value 스토어의 느낌으로 사용할 때 사용될 수 있다.\n<ul>\n<li><code class=\"language-text\">cleanup.policy=compact</code>: 세그먼트를 압축하는 옵션.</li>\n</ul>\n</li>\n<li>compact 옵션에는 테일/헤드 영역이 존재한다.\n<ul>\n<li>테일 영역 (클린 로그): 압축 정책에 의해 압축이 완료된 세그먼트. 중복 메시지 키가 없다.</li>\n<li>헤드 영역 (더티 로그): 압축 정책이 되기 전 레코드들. 중복된 메시지 키가 있다.</li>\n<li><code class=\"language-text\">min.cleanable.dirty.ratio</code>: compact 옵션의 압축 시점은 테일 영역과 헤드 영역의 비율을 지정한 설정 값으로 정할 수 있다. 예를 들어 0.5로 설정 하면, 테일 영역과 헤드 영역의 수가 동일할 대 압축이 진행된다. 0.9인 경우 헤드 영역을 최대한 모았다가 한번에 압축하므로, 압축의 효율이 좋다. 0.1인 경우 자주 압축을 시도하므로 용량에서는 이점이 있다.</li>\n</ul>\n</li>\n</ul>\n</br>\n<div align=\"left\">\n  <span class=\"gatsby-resp-image-wrapper\" style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 630px; \">\n      <a class=\"gatsby-resp-image-link\" href=\"/static/7a85c3f54b3ba367ef73b58f1e63f7e5/3c2d4/%EC%8A%A4%ED%81%AC%EB%A6%B0%EC%83%B7%202024-12-07%20%EC%98%A4%ED%9B%84%202.38.51.png\" style=\"display: block\" target=\"_blank\" rel=\"noopener\">\n    <span class=\"gatsby-resp-image-background-image\" style=\"padding-bottom: 31.0126582278481%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAGCAYAAADDl76dAAAACXBIWXMAABYlAAAWJQFJUiTwAAABOUlEQVR42lWRSYvCQBCF8/s9eAgJLvHsvkQFl4sKmoCCooLgjpBEvARBPGn0G6ohw0xB0dVVr14/Xmur1YrFYsF0OmUymTCbzZjP56zXaxzHwfd9JL7fL3F8Ph+Vf3sxRosLAbxeLw6HA8fjkTAMFej9fqu553ns93uCIFA4CXlss9lwOp3Ybrfc73c0WRag67pUKhWq1SrFYpFarYZt2wyHQ9rt9r++ZL/fp9frkc/n1V6pVGIwGKB1u12azSatVotEIkE2m8UwDFKpFLquUygUME1TpfQtyyKZTJLL5RSZYNLpNJlMRhFrt9uN6/XKeDxWCoS40WhQr9eVKlEop9xFsczK5TKdTofRaKRqmcmecGjij6R4JT4tl0vO5zOXy4Xn86n8ejwe7Ha7X79EhODjj4n/IIoifgCs55fFWqWxoQAAAABJRU5ErkJggg=='); background-size: cover; display: block;\"></span>\n  <img class=\"gatsby-resp-image-image\" alt=\"     2024 12 07    2 38 51\" title=\"\" src=\"/static/7a85c3f54b3ba367ef73b58f1e63f7e5/f058b/%EC%8A%A4%ED%81%AC%EB%A6%B0%EC%83%B7%202024-12-07%20%EC%98%A4%ED%9B%84%202.38.51.png\" srcset=\"/static/7a85c3f54b3ba367ef73b58f1e63f7e5/c26ae/%EC%8A%A4%ED%81%AC%EB%A6%B0%EC%83%B7%202024-12-07%20%EC%98%A4%ED%9B%84%202.38.51.png 158w,\n/static/7a85c3f54b3ba367ef73b58f1e63f7e5/6bdcf/%EC%8A%A4%ED%81%AC%EB%A6%B0%EC%83%B7%202024-12-07%20%EC%98%A4%ED%9B%84%202.38.51.png 315w,\n/static/7a85c3f54b3ba367ef73b58f1e63f7e5/f058b/%EC%8A%A4%ED%81%AC%EB%A6%B0%EC%83%B7%202024-12-07%20%EC%98%A4%ED%9B%84%202.38.51.png 630w,\n/static/7a85c3f54b3ba367ef73b58f1e63f7e5/40601/%EC%8A%A4%ED%81%AC%EB%A6%B0%EC%83%B7%202024-12-07%20%EC%98%A4%ED%9B%84%202.38.51.png 945w,\n/static/7a85c3f54b3ba367ef73b58f1e63f7e5/78612/%EC%8A%A4%ED%81%AC%EB%A6%B0%EC%83%B7%202024-12-07%20%EC%98%A4%ED%9B%84%202.38.51.png 1260w,\n/static/7a85c3f54b3ba367ef73b58f1e63f7e5/3c2d4/%EC%8A%A4%ED%81%AC%EB%A6%B0%EC%83%B7%202024-12-07%20%EC%98%A4%ED%9B%84%202.38.51.png 2092w\" sizes=\"(max-width: 630px) 100vw, 630px\" style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\" loading=\"lazy\" decoding=\"async\">\n  </a>\n    </span>\n</div>\n</br>","frontmatter":{"title":"2-3) 로그와 세그먼트","date":"December 07, 2024","description":null}},"previous":{"fields":{"slug":"/kafka/kafka_2_2/"},"frontmatter":{"title":"2-2) Kafka 클러스터와 브로커, 주키퍼"}},"next":{"fields":{"slug":"/kafka/kafka_2_4/"},"frontmatter":{"title":"2-4) 복제 (replication)"}}},"pageContext":{"id":"1c4c82cc-4fed-55be-a6c1-4a8047478138","previousPostId":"91bb9541-75fa-5429-9d06-224bf2f096fc","nextPostId":"de7d3d86-8de6-504d-814b-b83489741626"}},"staticQueryHashes":["2841359383","3257411868"],"slicesMap":{}}