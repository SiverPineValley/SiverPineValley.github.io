{"componentChunkName":"component---src-templates-blog-post-js","path":"/kafka/kafka_6_4/","result":{"data":{"site":{"siteMetadata":{"title":"Devlog"}},"markdownRemark":{"id":"04e0f7dd-1978-5731-85de-86b00b693049","excerpt":"6-4-1) 카프카 버로우 버로우는 링크드인에서 개발하여 오픈소스로 공개한 컨슈머 랙 체크 툴로서 RestAPI…","html":"<h2>6-4-1) 카프카 버로우</h2>\n<ul>\n<li>버로우는 링크드인에서 개발하여 오픈소스로 공개한 컨슈머 랙 체크 툴로서 RestAPI를 통해 컨슈머 그룹 별로 컨슈머 랙을 확인할 수 있다. 외부 모니터링 툴을 사용하면 카프카 클러스터에 포함된 모든 컨슈머, 토픽들의 랙 정보를 한번에 모니터링할 수 있다는 장점이 있다. 또한, 모니터링 툴들은 클러스터와 연동되어 컨슈머의 데이터 처리와는 별개로 지표를 수집하기 때문에 데이터를 활용하는 프로듀서나 컨슈머의 동작에는 영향을 주지 않는다.</li>\n<li>버로우는 다수의 클러스터에 연결하여 동작할 수 있다. 버로우를 카프카 클러스터에 연동하면 REST API를 통해 컨슈머 그룹 별 랙을 조회할 수 있다.</li>\n</ul>\n</br>\n<h2>6-4-2) 컨슈머 랙 이슈 판별</h2>\n<ul>\n<li>버로우의 기능 중 가장 돋보이는 점은 컨슈머와 파티션의 상태를 단순히 랙의 임계치(threshold)로 나타내지 않았다는 점이다. 특정 파티션의 랙이 100만이 넘었다고 해서 단순히 컨슈머 또는 파티션에 문제가 있다고 단정지을 수 없다. 왜냐하면 프로듀서가 데이터를 많이 보내면 일시적으로 임계치를 넘어가는 현상이 발생할 수 있기 때문이다. 컨슈머 애플리케이션을 운영할 때 컨슈머 랙이 임계치에 도달할 때마다 알람을 받는 것은 무의미한 일이다.</li>\n</ul>\n</br>\n<h3>6-5-2-1) 컨슈머 랙 평가 (Evaluation)</h3>\n<ul>\n<li>버로우는 단순히 임계치를 통해 판별하는 것이 아닌 슬라이딩 윈도우 (Sliding Window) 계산을 통해 문제가 생긴 파티션과 컨슈머의 상태를 표현한다. 이렇게 버로우에서 컨슈머 랙 상태를 표현하는 것을 컨슈머 랙 평가 (evalution)이라고 한다. 컨슈머 랙과 파티션의 오프셋을 슬라이딩 윈도우로 계산하면 상태가 정해진다. 결과적으로 파티션의 상태를 OK, STALLED, STOPPED로 표시하고, 컨슈머의 상태를 OK, WARNING, ERROR로 표시한다.</li>\n</ul>\n</br>\n<h3>6-5-2-2) 정상적인 상태</h3>\n</br>\n<div align=\"left\">\n  <span class=\"gatsby-resp-image-wrapper\" style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 564px; \">\n      <a class=\"gatsby-resp-image-link\" href=\"/static/515a81bb8726d87e1e27af3e4e0f8f76/ba4d9/normal_graph.png\" style=\"display: block\" target=\"_blank\" rel=\"noopener\">\n    <span class=\"gatsby-resp-image-background-image\" style=\"padding-bottom: 52.53164556962025%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAALCAYAAAB/Ca1DAAAACXBIWXMAABYlAAAWJQFJUiTwAAABzUlEQVR42o1TyW7iUBD0/38BZw6jIAGZOIngYLYIgVmCWb0AZt+3C+KAWGpcjV6iSDnModSvn7urq7uftel0iuVyidls9l9g/Hw+x2KxkDwF3t9uN2jVahWmaUrAaDTCeDz+An0F+opkMBjAcRxUKhXUajUUzSI+a5+4XC7Q+IGku93uR1WqoN3v9wJ+I0EqlUKhUEC5XEY0GkUymUQkEkEmk8H9fiehK1XW67W0RBKeD4eD+LlcThLz+TzC4TBisZioZYt2x0a/3wc5ikUT1+sVGis0Gg0hINFwOES73UYoFIJhGMhms+JT4Wq1+mEZz/NmsxEOaTkej0t1z/NEQSKREJ9t+L4v7aqhq6X8drYs60FoGCkhsW1bCNQcWZXBbG8ymQRJ39tVUAoJjk0Ie72etHQ8HrHdboVoGQRzWaxMXyXRd2wHHbsDz/VQr9dlUd1uF81m80HIVtPBhlqtFsxSCfqLjlddB5W/6a/QA3Cz+t8XvL+9I51Ki58NlvX05wmlIKfX78kMz+czNLKzEiXz+dASLPCR+8Bz/PnrzqpbaDQbooYEnJt6syQ+nU4PhdwsH6uyCr4/QNfrgmNRoAB19oMnQ991XSHln/IP4CYJGjp6Xm4AAAAASUVORK5CYII='); background-size: cover; display: block;\"></span>\n  <img class=\"gatsby-resp-image-image\" alt=\"normal graph\" title=\"\" src=\"/static/515a81bb8726d87e1e27af3e4e0f8f76/ba4d9/normal_graph.png\" srcset=\"/static/515a81bb8726d87e1e27af3e4e0f8f76/c26ae/normal_graph.png 158w,\n/static/515a81bb8726d87e1e27af3e4e0f8f76/6bdcf/normal_graph.png 315w,\n/static/515a81bb8726d87e1e27af3e4e0f8f76/ba4d9/normal_graph.png 564w\" sizes=\"(max-width: 564px) 100vw, 564px\" style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\" loading=\"lazy\" decoding=\"async\">\n  </a>\n    </span>\n</div>\n</br>\n<ul>\n<li>일반적으로 컨슈머를 운영하면서 자주 볼 수 있는 그래프이다. 이렇게 컨슈머 랙이 낮은 상태가 유지되거나 거의 없는 경우 버로우는 파티션은 OK, 컨슈머도 OK로 표현한다.</li>\n</ul>\n</br>\n<h3>6-5-2-3) 컨슈머 처리량 이슈</h3>\n</br>\n<div align=\"left\">\n  <span class=\"gatsby-resp-image-wrapper\" style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 630px; \">\n      <a class=\"gatsby-resp-image-link\" href=\"/static/50a3dec90ca51e6011c87666ae57c671/e9140/consumer_throghput_issue.png\" style=\"display: block\" target=\"_blank\" rel=\"noopener\">\n    <span class=\"gatsby-resp-image-background-image\" style=\"padding-bottom: 51.89873417721519%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAKCAYAAAC0VX7mAAAACXBIWXMAABYlAAAWJQFJUiTwAAABh0lEQVR42oWSx44CQQxE5/9/gSscuCC4IJFEzkLAkHOcIQl+oXafR420pz2UZtp2l8vl9vb7vZbLpTabjU6nk47H4784n8+6Xq9WfzgcDPyPRiN5JJvNpubzuZ7Pp8Iw1O12M/Dv8Hg8LH+/34WI6XSq2WymarWqTqejcrmsdrstD+bxeKzdbmfFdA6CwPB6vQzEya9WK+VyOWWzWSMkxhes12tVKhV5BGu1mrbbramCADVgOBxas0QioVgsJt/3VSgUlM/nbUTuoBBlIJPJyIM9Ho+bMpRAgBetVkvJZNLG6fV6dibvfKYeK7CB5u/3O/IQ71DQ7XatSyqVMiVcggDVTrFbBrhcLgas4Uy+3+/Lw+BSqWTjkXAjuy1CEi0m+CUP/yyLGl4H3lI3GAyiLUOGIsjchiFFIXmeBaZzkbGwgIkmk4l5WCwWv1aZQtbfaDS+hQ74l06nzWMMB1yu1+u2SCxiOpp9Pp9oZDwkAKl7AoDu5CiChMe/WCws5t4gX/wmxugs7gfHCr2uqrY6GwAAAABJRU5ErkJggg=='); background-size: cover; display: block;\"></span>\n  <img class=\"gatsby-resp-image-image\" alt=\"consumer throghput issue\" title=\"\" src=\"/static/50a3dec90ca51e6011c87666ae57c671/f058b/consumer_throghput_issue.png\" srcset=\"/static/50a3dec90ca51e6011c87666ae57c671/c26ae/consumer_throghput_issue.png 158w,\n/static/50a3dec90ca51e6011c87666ae57c671/6bdcf/consumer_throghput_issue.png 315w,\n/static/50a3dec90ca51e6011c87666ae57c671/f058b/consumer_throghput_issue.png 630w,\n/static/50a3dec90ca51e6011c87666ae57c671/40601/consumer_throghput_issue.png 945w,\n/static/50a3dec90ca51e6011c87666ae57c671/e9140/consumer_throghput_issue.png 1226w\" sizes=\"(max-width: 630px) 100vw, 630px\" style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\" loading=\"lazy\" decoding=\"async\">\n  </a>\n    </span>\n</div>\n</br>\n<ul>\n<li>프로듀서가 추가하는 최신 오프셋에 비해 컨슈머 오프셋이 따라가지 못하는 추이를 볼 수 있다. 이런 그래프가 나오는 이유는 컨슈머의 데이터 처리량이 프로듀서가 보내는 데이터 양에 비해 적기 때문이다. 이 경우 파티션은 OK, 컨슈머는 WARNING 상태로 나타낸다.</li>\n</ul>\n</br>\n<h3>6-5-2-4) 컨슈머 이슈</h3>\n</br>\n<div align=\"left\">\n  <span class=\"gatsby-resp-image-wrapper\" style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 630px; \">\n      <a class=\"gatsby-resp-image-link\" href=\"/static/d225b11cc51f23c8b9ca92aabf32cfab/89048/consumer_issue.png\" style=\"display: block\" target=\"_blank\" rel=\"noopener\">\n    <span class=\"gatsby-resp-image-background-image\" style=\"padding-bottom: 51.26582278481012%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAKCAYAAAC0VX7mAAAACXBIWXMAABYlAAAWJQFJUiTwAAABo0lEQVR42mWS147iQBBF/f//wBsSiDcWCY0JIpmcwSYNOUfxCXc4pfVqpH246m5Xdd9Qdubzufr9vqbTqdbrtVar1X9YLpf/wHm322m73Vp/4Afyg0DBJFCtVpOz3+9VKpXEw4/HQ5fLRdfr1cD+fD7rfr/r+Xrq+XzqcDgY+WAwMNSrdXkVT17Js9WBiQLMPHA8Hg3sIQDU6MGJ67pKJv981H4LMafTyQBpu92WM5vNlMvlTP7tdjMVAFudTkfdblf5fF7pdFqbzcYuv99v64WUFTev10u9Xk8OrLFYzIqo9TxP1WrVYohGo5pMJpbd+u9ji8VCvu+bdRRiH1FEBrGDlUgkokajoXq9rlQqZda4RAPNhJ3JZEwhfYVCwWIYjUbKZrNyv1wVi8VPFEk5FLgQfCZFDtgJh/PbDkARLobDoeXFCgHECOBsQ6GIFWyggm+APZaazaZFgYpyuWwDIorw9+FPQESr1ZLDMCiSGxdhBOEj8XhciUTCbHKB76xhj+tmNP+IwYFNmRywy6OAfQjUkWelUrEsf9fCXtbxeGyWUf8DnyG6At3nOtAAAAAASUVORK5CYII='); background-size: cover; display: block;\"></span>\n  <img class=\"gatsby-resp-image-image\" alt=\"consumer issue\" title=\"\" src=\"/static/d225b11cc51f23c8b9ca92aabf32cfab/f058b/consumer_issue.png\" srcset=\"/static/d225b11cc51f23c8b9ca92aabf32cfab/c26ae/consumer_issue.png 158w,\n/static/d225b11cc51f23c8b9ca92aabf32cfab/6bdcf/consumer_issue.png 315w,\n/static/d225b11cc51f23c8b9ca92aabf32cfab/f058b/consumer_issue.png 630w,\n/static/d225b11cc51f23c8b9ca92aabf32cfab/40601/consumer_issue.png 945w,\n/static/d225b11cc51f23c8b9ca92aabf32cfab/89048/consumer_issue.png 1242w\" sizes=\"(max-width: 630px) 100vw, 630px\" style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\" loading=\"lazy\" decoding=\"async\">\n  </a>\n    </span>\n</div>\n</br>\n<ul>\n<li>최신 오프셋이 지속적으로 증가하지만, 컨슈머 오프셋이 멈춘 상태이다. 이로 인해 컨슈머 랙이 증가하고 있는데, 컨슈머가 어떠한 이유로 데이터를 가져가지 않고 있는 것이다. 이 경우 파티션은 STALLED, 컨슈머는 ERROR 상태로 표신된다.</li>\n</ul>","frontmatter":{"title":"6-4) 버로우","date":"January 11, 2024","description":null}},"previous":{"fields":{"slug":"/web/jwt&paesto/"},"frontmatter":{"title":"[Web] JWT Token과 PASETO"}},"next":{"fields":{"slug":"/web/jwt&paesto/"},"frontmatter":{"title":"[Web] JWT Token과 PASETO"}}},"pageContext":{"id":"04e0f7dd-1978-5731-85de-86b00b693049"}},"staticQueryHashes":["230163734","3589320610"],"slicesMap":{}}