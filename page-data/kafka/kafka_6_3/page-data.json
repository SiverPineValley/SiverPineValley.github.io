{"componentChunkName":"component---src-templates-blog-post-js","path":"/kafka/kafka_6_3/","result":{"data":{"site":{"siteMetadata":{"title":"Devlog","author":"JonginPark","siteUrl":"https://SiverPineValley.github.io","comment":{"disqusShortName":"","utterances":"SiverPineValley/devlog"},"sponsor":{"buyMeACoffeeId":""}}},"markdownRemark":{"id":"d3129b67-0a2b-530f-9c43-4820992d4d12","excerpt":"6-3-1) 컨슈머 랙 컨슈머 랙(Lag)은 파티션의 최신 오프셋과 컨슈머 오프셋간의 차이이다. 프로듀서는 계속해서 새로운 레코드를 파티션에 저장하고, 컨슈머는 처리할 수 있는 만큼 데이터를 가져간다. 컨슈머 랙은 컨슈머가 정상적으로 동작하는지 여부를 확인할 수 있기 때문에 컨슈머 애플리케이션을 운영하면 필수적으로 모니터링해야 하는 요소이다. 컨슈머 랙은 컨슈머 그룹과 토픽, 파티션 별로 생성된다. 6-3-…","html":"<h2 id=\"6-3-1-컨슈머-랙\" style=\"position:relative;\"><a href=\"#6-3-1-%EC%BB%A8%EC%8A%88%EB%A8%B8-%EB%9E%99\" aria-label=\"6 3 1 컨슈머 랙 permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>6-3-1) 컨슈머 랙</h2>\n</br>\n<div align=\"left\">\n  <span class=\"gatsby-resp-image-wrapper\" style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 564px; \">\n      <span class=\"gatsby-resp-image-background-image\" style=\"padding-bottom: 37.666666666666664%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAICAYAAAD5nd/tAAAACXBIWXMAABYlAAAWJQFJUiTwAAABZklEQVR42oVSPYvCUBDMnxYLbS0tBBuxFKzs/EbFiIqKCRrxK/ELiSlSiBglRfyYY/aIxXHHPRj2bXbfvNl5UbrdLprNJqrVKtrtNvr9PhaLBTzPw+VyEdxuNzyfz3/xer2gJJNJxONxRCIRJBIJpNNp5PN5nE4nHA4H2LaN8XiM8/kMrvf7jd8WvwuhqqoYjUZgbLVaqNVq0DRNyCzLguM4qFQqUjsej9hsNthutx/sdjuYpikXk1ShmmKxiMlkIqOGhwzDkHw6nWK5XEp9OBxKzn0I5pyA1nFspVAooFQqiX+9Xk+KVNxoNMTPwWAgOQ90Oh1RT+i6/gF7WBNCjkXpVEFF8/kcs9kMuVxObl+v11Jj32q1Qr1elwfkVOVyWfaM+/1evFTwx2IDSehReCmVZbNZZDIZRKNRxGIx2adSKbiu+00YBAF+4vF4SLzf7/B9X36h6/UqL01Sjkg/QzsY2cNH+QL1KC/Vg/Ek9AAAAABJRU5ErkJggg=='); background-size: cover; display: block;\"></span>\n  <img class=\"gatsby-resp-image-image\" alt=\"consumer lag\" title=\"\" src=\"/static/a1abcbad63a39e15704c439a7f695eed/ba4d9/consumer_lag.png\" srcset=\"/static/a1abcbad63a39e15704c439a7f695eed/5a46d/consumer_lag.png 300w,\n/static/a1abcbad63a39e15704c439a7f695eed/ba4d9/consumer_lag.png 564w\" sizes=\"(max-width: 564px) 100vw, 564px\" style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\" loading=\"lazy\" decoding=\"async\">\n    </span>\n</div>\n</br>\n<ul>\n<li>컨슈머 랙(Lag)은 파티션의 최신 오프셋과 컨슈머 오프셋간의 차이이다. 프로듀서는 계속해서 새로운 레코드를 파티션에 저장하고, 컨슈머는 처리할 수 있는 만큼 데이터를 가져간다. 컨슈머 랙은 컨슈머가 정상적으로 동작하는지 여부를 확인할 수 있기 때문에 컨슈머 애플리케이션을 운영하면 필수적으로 모니터링해야 하는 요소이다.</li>\n</ul>\n</br>\n<div align=\"left\">\n  <span class=\"gatsby-resp-image-wrapper\" style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 1200px; \">\n      <span class=\"gatsby-resp-image-background-image\" style=\"padding-bottom: 61%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAMCAYAAABiDJ37AAAACXBIWXMAABYlAAAWJQFJUiTwAAACMUlEQVR42k2T6UtyURDG7x/vNxFBEZG03Pe0FFErzT3IpVwQwxI1FVM/iAslLk/vM2C8F4Z775w5M79nzhylWCzC4/FAr9fDaDTC5/MhkUhgNBrh8/MTg8FArN/vy//ZuP79/Y3D4YD9fv9nSr1eRzQahd/vF7u9vUWpVMJ2u8XPzw/G4zF6vR46nQ6WyyXW67UkGg6H+Pr6Ap/T6YTzozSbTTw8PCCbzaJQKCCXy+Hx8RHJZFL819fX8Hq9uLy8FB/XGBMOhxEIBJBOp3F/f494PI58Pg+F8gwGg2xgADczEYk+Pj5QrValULvdxvPzs/wTgolTqRRarRZeX1/F73K5oLCCw+GQRKwSi8WkBUxK+WwDAxnH4vRnMhmEQiGh5zcTk97tdkO5u7uDWq2G1WpFIBhAMBiUhCSw2+2IRCLyzw1MSmN7WIyy+c1YyhZCJlSpVP8onRJ0c3MjQZTFzY1GAzy4p6cnkVUul/Hy8iIFaFyrVCrSDk7In2Sn0yk0lGw2m6HRaKDVamGxWGSd/SU93yQjPVWdW8QWME4hKjcRl4Q0+mq1mhC9v7/LDL69vcn4dLtd8fGbpCSkGh6MEFIeT5gJWYWSr66ucHFxAZPJJEEkYiGq4BqJzj0kIQ/zvFfZ7XYyrKvVSgZ3s9nIMLMvnDeOD2l4W+hjL3lLOPxM5PP75HTZLvqU/6f8/ByPRywWC0wmE8xmM8znc7HpdCo+FuaVJbFOr4NOp4PNZhPiXzw9Er+dZiR3AAAAAElFTkSuQmCC'); background-size: cover; display: block;\"></span>\n  <img class=\"gatsby-resp-image-image\" alt=\"consumer lag per partition\" title=\"\" src=\"/static/8d0e8e232f84c2fa28993836dd23b3d1/c1b63/consumer_lag_per_partition.png\" srcset=\"/static/8d0e8e232f84c2fa28993836dd23b3d1/5a46d/consumer_lag_per_partition.png 300w,\n/static/8d0e8e232f84c2fa28993836dd23b3d1/0a47e/consumer_lag_per_partition.png 600w,\n/static/8d0e8e232f84c2fa28993836dd23b3d1/c1b63/consumer_lag_per_partition.png 1200w,\n/static/8d0e8e232f84c2fa28993836dd23b3d1/c929c/consumer_lag_per_partition.png 1218w\" sizes=\"(max-width: 1200px) 100vw, 1200px\" style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\" loading=\"lazy\" decoding=\"async\">\n    </span>\n</div>\n</br>\n<ul>\n<li>컨슈머 랙은 컨슈머 그룹과 토픽, 파티션 별로 생성된다.</li>\n</ul>\n<h2 id=\"6-3-2-컨슈머-랙-모니터링\" style=\"position:relative;\"><a href=\"#6-3-2-%EC%BB%A8%EC%8A%88%EB%A8%B8-%EB%9E%99-%EB%AA%A8%EB%8B%88%ED%84%B0%EB%A7%81\" aria-label=\"6 3 2 컨슈머 랙 모니터링 permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>6-3-2) 컨슈머 랙 모니터링</h2>\n<ul>\n<li>컨슈머 랙을 모니터링하는 것은 카프카를 통해 데이터파이프라인을 운영하는 데 있어서는 핵심적인 역할을 한다. 컨슈머 랙을 모니터링함으로써 컨슈머의 장애를 확인할 수 있고 파티션 개수를 정하는 데 참고할 수 있다.</li>\n<li>프로듀서의 데이터 양이 일정함에도 컨슈머의 장애로 컨슈머 랙이 증가할 수도 있다. 컨슈머는 파티션 개수만큼 늘려서 병렬처리하며 파티션마다 컨슈머가 할당되어 데이터를 처리한다.</li>\n</ul>\n</br>\n<h2 id=\"6-3-3-컨슈머-랙을-모니터링하는-방법-3가지\" style=\"position:relative;\"><a href=\"#6-3-3-%EC%BB%A8%EC%8A%88%EB%A8%B8-%EB%9E%99%EC%9D%84-%EB%AA%A8%EB%8B%88%ED%84%B0%EB%A7%81%ED%95%98%EB%8A%94-%EB%B0%A9%EB%B2%95-3%EA%B0%80%EC%A7%80\" aria-label=\"6 3 3 컨슈머 랙을 모니터링하는 방법 3가지 permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>6-3-3) 컨슈머 랙을 모니터링하는 방법 3가지</h2>\n</br>\n<h3 id=\"6-3-3-1-kafka-cli를-사용하는-방법\" style=\"position:relative;\"><a href=\"#6-3-3-1-kafka-cli%EB%A5%BC-%EC%82%AC%EC%9A%A9%ED%95%98%EB%8A%94-%EB%B0%A9%EB%B2%95\" aria-label=\"6 3 3 1 kafka cli를 사용하는 방법 permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>6-3-3-1) Kafka CLI를 사용하는 방법</h3>\n<ul>\n<li><code class=\"language-text\">kafka-consuemr-groups.sh</code> 명령어를 사용하면 컨슈머 랙을 포함하여 특정 컨슈머 그룹의 상태를 확인할 수 있다. 컨슈머 랙을 확인하기 위한 가장 기초적인 방법이라고 생각하면 된다.</li>\n</ul>\n<div class=\"gatsby-highlight\" data-language=\"sh\"><pre class=\"language-sh\"><code class=\"language-sh\">./kafka-consumer-groups.sh --bootstrap-server<span class=\"token operator\">=</span>my-kafka:19092 <span class=\"token parameter variable\">--group</span> test-group <span class=\"token parameter variable\">--describe</span>\n\nConsumer group <span class=\"token string\">'test-group'</span> has no active members.\n\nGROUP           TOPIC           PARTITION  CURRENT-OFFSET  LOG-END-OFFSET  LAG             CONSUMER-ID     HOST            CLIENT-ID\ntest-group      <span class=\"token builtin class-name\">test</span>            <span class=\"token number\">0</span>          <span class=\"token number\">6</span>               <span class=\"token number\">6</span>               <span class=\"token number\">0</span>               -               -               -%</code></pre></div>\n</br>\n<h3 id=\"6-3-3-2-code-classlanguage-textmetricscode-메서드-사용\" style=\"position:relative;\"><a href=\"#6-3-3-2-code-classlanguage-textmetricscode-%EB%A9%94%EC%84%9C%EB%93%9C-%EC%82%AC%EC%9A%A9\" aria-label=\"6 3 3 2 code classlanguage textmetricscode 메서드 사용 permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>6-3-3-2) <code class=\"language-text\">metrics()</code> 메서드 사용</h3>\n<ul>\n<li>컨슈머 애플리케이션의 <code class=\"language-text\">KafkaConsumer</code> 인스턴스의 <code class=\"language-text\">metric()</code> 메서드를 활용하면 컨슈머 랙 지표를 확인할 수 있다. 컨슈머 인스턴스가 제공하는 컨슈머 랙 관련 모니터링 지표는 3가지로 <code class=\"language-text\">records-lag-max</code>, <code class=\"language-text\">records-lag</code>, <code class=\"language-text\">records-lag-avg</code> 가 있다.</li>\n<li>다만 이 방법은 몇 가지 문제가 있는데, 첫 번째로는 컨슈머가 정상 동작할 때만 확인할 수 있다는 점이다. <code class=\"language-text\">metric()</code> 메서드는 컨슈머가 정상적으로 실행될 경우에만 호출된다. 그렇기 때문에 컨슈머 애플리케이션이 비정상적으로 종료된다면 더는 컨슈머 랙을 확인할 수 없다.</li>\n<li>두 번째로, 모든 컨슈머 애플리케이션에 컨슈머 랙 모니터링 코드를 중복해서 작성해야 한다. 왜냐하면 특정 컨슈머 그룹에 해당하는 애플리케이션이 수집하는 컨슈머 랙은 자기 자신 컨슈머 그룹의 컨슈머 랙에 한정되기 때문이다.</li>\n<li>세 번째로, 컨슈머 랙을 모니터링하는 코드를 추가할 수 없는 카프카 서드 파티 애플리케이션의 컨슈머 랙 모니터링이 불가능하다.</li>\n<li>마지막으로, 공식 java 라이브러리에서만 지원되므로 각 언어별로 지원되는지는 별도 확인이 필요하다.</li>\n</ul>\n</br>\n<h3 id=\"6-3-3-3-외부-모니터링-툴-사용\" style=\"position:relative;\"><a href=\"#6-3-3-3-%EC%99%B8%EB%B6%80-%EB%AA%A8%EB%8B%88%ED%84%B0%EB%A7%81-%ED%88%B4-%EC%82%AC%EC%9A%A9\" aria-label=\"6 3 3 3 외부 모니터링 툴 사용 permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>6-3-3-3) 외부 모니터링 툴 사용</h3>\n<ul>\n<li>데이터 톡(Datadog), 컨플루언트 컨트롤 센터(Confluent Control Center), 버로우(Burrow), 펠리체(Felice) - 국내 기업용 등을 활용할 수 있다.</li>\n</ul>","frontmatter":{"title":"6-3) 컨슈머 랙","date":"January 11, 2024"}}},"pageContext":{"slug":"/kafka/kafka_6_3/","previous":{"fields":{"slug":"/kafka/kafka_6_2/"},"frontmatter":{"title":"6-2) 컨슈머 애플리케이션 개발"}},"next":{"fields":{"slug":"/kafka/kafka_6_4/"},"frontmatter":{"title":"6-4) 버로우"}}}},"staticQueryHashes":["3128451518","643154061"],"slicesMap":{}}