{"componentChunkName":"component---src-templates-blog-post-js","path":"/kubernetes/kubernetes_4_3/","result":{"data":{"site":{"siteMetadata":{"title":"Devlog","author":"JonginPark","siteUrl":"https://SiverPineValley.github.io","comment":{"disqusShortName":"","utterances":"SiverPineValley/devlog"},"sponsor":{"buyMeACoffeeId":""}}},"markdownRemark":{"id":"c25ab26e-ea48-5f39-929a-977b6a9ee547","excerpt":"4.5.6 매니페스트 파일 설계 지금까지는 kubectl…","html":"<h2 id=\"456-매니페스트-파일-설계\" style=\"position:relative;\"><a href=\"#456-%EB%A7%A4%EB%8B%88%ED%8E%98%EC%8A%A4%ED%8A%B8-%ED%8C%8C%EC%9D%BC-%EC%84%A4%EA%B3%84\" aria-label=\"456 매니페스트 파일 설계 permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>4.5.6 매니페스트 파일 설계</h2>\n<p>지금까지는 kubectl로 ‘한개 리소스가 정의된 한 개의 매니페스트 파일’을 적용하는 예들이었다면 실제로는 한 개의 매니페스트 파일에 여러 개의 리소스를 정의하거나 여러 매니페스트 파일을 동시에 적용할 수도 있다.</p>\n<h3 id=\"하나의-매니페스트-파일에-여러-리소스-정의\" style=\"position:relative;\"><a href=\"#%ED%95%98%EB%82%98%EC%9D%98-%EB%A7%A4%EB%8B%88%ED%8E%98%EC%8A%A4%ED%8A%B8-%ED%8C%8C%EC%9D%BC%EC%97%90-%EC%97%AC%EB%9F%AC-%EB%A6%AC%EC%86%8C%EC%8A%A4-%EC%A0%95%EC%9D%98\" aria-label=\"하나의 매니페스트 파일에 여러 리소스 정의 permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>하나의 매니페스트 파일에 여러 리소스 정의</h3>\n<p>매니페스트 파일에는 여러 리소스를 한 개의 매니페스트 파일에 정의할 수 있다. 따라서 어떤 서비스에서 사용할 여러 종류의 리소스를 한 개의 매니페스트 파일로 통합할 수 있다. 일반적인 사용 사례로는 ‘파드를 기동하는 워크로드 API 카테고리의 리소스’와 ‘외부에 공개하는 서비스 API 카테고리의 리소스’를 매니페스트에 통합하여 작성하는 방법을 생각해볼 수 있다. 이 경우 한 개의 매니페스트 파일로 서비스를 외부에 공개할 수 있게 된다. 실행 순서를 정확하게 지켜야 하거나 리소스 간 결합도를 높이고 싶다면 하나의 매니페스트로 관리하는 것이 좋을 수 있다.</p>\n<p>아래 매니페스트를 적용하면 위에서부터 리소스 순서대로 적용된다. 위에서 부터 차례대로 적용되지만, 중간에 에러가 발생하면 이후 정의된 리소스는 적용되지 않게 된다.</p>\n<div class=\"gatsby-highlight\" data-language=\"yaml\"><pre class=\"language-yaml\"><code class=\"language-yaml\"><span class=\"token punctuation\">---</span>\n<span class=\"token key atrule\">apiVersion</span><span class=\"token punctuation\">:</span> apps/v1\n<span class=\"token key atrule\">kind</span><span class=\"token punctuation\">:</span> Deployment\n<span class=\"token key atrule\">metadata</span><span class=\"token punctuation\">:</span>\n  <span class=\"token key atrule\">name</span><span class=\"token punctuation\">:</span> order1<span class=\"token punctuation\">-</span>deployment\n<span class=\"token key atrule\">spec</span><span class=\"token punctuation\">:</span>\n  <span class=\"token key atrule\">replicas</span><span class=\"token punctuation\">:</span> <span class=\"token number\">3</span>\n  <span class=\"token key atrule\">selector</span><span class=\"token punctuation\">:</span>\n    <span class=\"token key atrule\">matchLabels</span><span class=\"token punctuation\">:</span>\n      <span class=\"token key atrule\">app</span><span class=\"token punctuation\">:</span> sample<span class=\"token punctuation\">-</span>app\n  <span class=\"token key atrule\">template</span><span class=\"token punctuation\">:</span>\n    <span class=\"token key atrule\">metadata</span><span class=\"token punctuation\">:</span>\n      <span class=\"token key atrule\">labels</span><span class=\"token punctuation\">:</span>\n        <span class=\"token key atrule\">app</span><span class=\"token punctuation\">:</span> sample<span class=\"token punctuation\">-</span>app\n    <span class=\"token key atrule\">spec</span><span class=\"token punctuation\">:</span>\n      <span class=\"token key atrule\">containers</span><span class=\"token punctuation\">:</span>\n        <span class=\"token punctuation\">-</span> <span class=\"token key atrule\">name</span><span class=\"token punctuation\">:</span> nginx<span class=\"token punctuation\">-</span>container\n          <span class=\"token key atrule\">image</span><span class=\"token punctuation\">:</span> nginx<span class=\"token punctuation\">:</span><span class=\"token number\">1.12</span>\n          <span class=\"token key atrule\">ports</span><span class=\"token punctuation\">:</span>\n            <span class=\"token punctuation\">-</span> <span class=\"token key atrule\">containerPort</span><span class=\"token punctuation\">:</span> <span class=\"token number\">80</span>\n<span class=\"token punctuation\">---</span>\n<span class=\"token key atrule\">apiVersion</span><span class=\"token punctuation\">:</span> v1\n<span class=\"token key atrule\">kind</span><span class=\"token punctuation\">:</span> Service\n<span class=\"token key atrule\">metadata</span><span class=\"token punctuation\">:</span>\n  <span class=\"token key atrule\">name</span><span class=\"token punctuation\">:</span> order2<span class=\"token punctuation\">-</span>service\n<span class=\"token key atrule\">spec</span><span class=\"token punctuation\">:</span>\n  <span class=\"token key atrule\">type</span><span class=\"token punctuation\">:</span> LoadBalancer\n  <span class=\"token key atrule\">ports</span><span class=\"token punctuation\">:</span>\n    <span class=\"token punctuation\">-</span> <span class=\"token key atrule\">name</span><span class=\"token punctuation\">:</span> <span class=\"token string\">\"http-port\"</span>\n      <span class=\"token key atrule\">protocol</span><span class=\"token punctuation\">:</span> <span class=\"token string\">\"TCP\"</span>\n      <span class=\"token key atrule\">port</span><span class=\"token punctuation\">:</span> <span class=\"token number\">8080</span>\n      <span class=\"token key atrule\">targetPort</span><span class=\"token punctuation\">:</span> <span class=\"token number\">80</span>\n  <span class=\"token key atrule\">selector</span><span class=\"token punctuation\">:</span>\n    <span class=\"token key atrule\">app</span><span class=\"token punctuation\">:</span> sample<span class=\"token punctuation\">-</span>app</code></pre></div>\n<h3 id=\"여러-매니페스트-파일을-동시에-적용\" style=\"position:relative;\"><a href=\"#%EC%97%AC%EB%9F%AC-%EB%A7%A4%EB%8B%88%ED%8E%98%EC%8A%A4%ED%8A%B8-%ED%8C%8C%EC%9D%BC%EC%9D%84-%EB%8F%99%EC%8B%9C%EC%97%90-%EC%A0%81%EC%9A%A9\" aria-label=\"여러 매니페스트 파일을 동시에 적용 permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>여러 매니페스트 파일을 동시에 적용</h3>\n<p>여러 매니페스트 파일을 동시에 적용하려면 디렉터리 안에 적용하고 싶은 여러 매니페스트 파일을 배치해 두고 <code class=\"language-text\">kubectl apply</code> 명령어를 실행할 때 해당 디렉터리를 지정하면 된다. 파일명 순으로 매니페스트 파일이 순차적으로 적용되기 때문에 순서를 제어하고 싶을 때는 파일명 앞에 연번의 인덱스 번호 등을 지정하여 사용하면 된다. <code class=\"language-text\">kubectl apply -f ./ -R</code> 과 같이 <code class=\"language-text\">-R</code> 옵션을 사용하면 재귀적으로 디렉터리 안에 존재하는 매니페스트 파일들을 적용할 수도 있다.</p>\n<h2 id=\"457-어노테이션과-레이블\" style=\"position:relative;\"><a href=\"#457-%EC%96%B4%EB%85%B8%ED%85%8C%EC%9D%B4%EC%85%98%EA%B3%BC-%EB%A0%88%EC%9D%B4%EB%B8%94\" aria-label=\"457 어노테이션과 레이블 permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>4.5.7 어노테이션과 레이블</h2>\n<p>쿠버네티스에서는 각 리소스에 대해 어노테이션과 레이블이라는 메타데이터를 부여할 수 있다. 둘다 쿠버네티스가 리소스를 관리할 때 사용한다는 점에서 비슷하지만 용도가 조금 다르다. 어노테이션과 레이블은 ‘[접두사]/키:값’ 으로 구성된다. 접두사 부분은 옵션으로, 지정하는 경우 DNS 서브 도메인 형식이어야 한다.</p>\n<table>\n<thead>\n<tr>\n<th>명칭</th>\n<th>개요</th>\n</tr>\n</thead>\n<tbody>\n<tr>\n<td>어노테이션</td>\n<td>시스템 구성 요소가 사용하는 메타데이터</td>\n</tr>\n<tr>\n<td>레이블</td>\n<td>리소스 관리에 사용되는 메타데이터</td>\n</tr>\n</tbody>\n</table>\n<h3 id=\"어노테이션\" style=\"position:relative;\"><a href=\"#%EC%96%B4%EB%85%B8%ED%85%8C%EC%9D%B4%EC%85%98\" aria-label=\"어노테이션 permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>어노테이션</h3>\n<p>어노테이션(annotation)은 아래와 같이 <code class=\"language-text\">metadate.annotations</code>로 설정할 수 있는 메타데이터로, 리소스에 대한 메모라고 생각하면 된다. 어노테이션 자체는 단순히 key-value 값이므로, 어노테이션 값으로 어떤 처리를 하는 시스템 구성 요소가 없으면 아무 일도 일어나지 않는다. 리소스에 의미를 가지지 않는 메모를 하고 싶을 때도 사용할 수 있고, 값에 수치를 사용하는 경우에는 큰따옴표(\"\")로 묶어야 한다.</p>\n<div class=\"gatsby-highlight\" data-language=\"yaml\"><pre class=\"language-yaml\"><code class=\"language-yaml\"><span class=\"token key atrule\">apiVersion</span><span class=\"token punctuation\">:</span> v1\n<span class=\"token key atrule\">kind</span><span class=\"token punctuation\">:</span> Pod\n<span class=\"token key atrule\">metadata</span><span class=\"token punctuation\">:</span>\n  <span class=\"token key atrule\">name</span><span class=\"token punctuation\">:</span> sample<span class=\"token punctuation\">-</span>annotation\n  <span class=\"token key atrule\">annotations</span><span class=\"token punctuation\">:</span>\n    <span class=\"token key atrule\">annotation1</span><span class=\"token punctuation\">:</span> val1\n    <span class=\"token key atrule\">annotation2</span><span class=\"token punctuation\">:</span> val2\n<span class=\"token key atrule\">spec</span><span class=\"token punctuation\">:</span>\n  <span class=\"token key atrule\">containers</span><span class=\"token punctuation\">:</span>\n    <span class=\"token punctuation\">-</span> <span class=\"token key atrule\">name</span><span class=\"token punctuation\">:</span> nginx<span class=\"token punctuation\">-</span>container\n      <span class=\"token key atrule\">image</span><span class=\"token punctuation\">:</span> nginx<span class=\"token punctuation\">:</span><span class=\"token number\">1.12</span></code></pre></div>\n<p>kubectl을 통해서도 부여 가능하다.</p>\n<div class=\"gatsby-highlight\" data-language=\"sh\"><pre class=\"language-sh\"><code class=\"language-sh\">$ kubectl apply <span class=\"token parameter variable\">-f</span> sample-annotations.yaml\n\n<span class=\"token comment\"># 어노테이션 부여</span>\n$ kubectl annotate pods sample-annotation <span class=\"token assign-left variable\">annotation3</span><span class=\"token operator\">=</span>val3\n\n<span class=\"token comment\"># 어노테이션 부여 (덮어 쓰기)</span>\n$ kubectl annotate pods sample-annotation <span class=\"token assign-left variable\">annotation3</span><span class=\"token operator\">=</span>val-new <span class=\"token parameter variable\">--overwrite</span>\n\n<span class=\"token comment\"># 어노테이션 확인</span>\n$ kubectl get pods sample-annotation <span class=\"token parameter variable\">-o</span> json <span class=\"token operator\">|</span> jp .metadata.annotations\n\n<span class=\"token comment\"># 어노테이션 삭제</span>\n$ kubectl annotate pods sample-annotations annotations3-</code></pre></div>\n<p>어노테이션은 크게 다음과 같이 사용된다.</p>\n<ul>\n<li>시스템 구성 요소를 위한 데이터 저장</li>\n<li>모든 환경에서 사용할 수 없는 설정</li>\n<li>정식으로 통합되기 전의 기능을 설정</li>\n</ul>\n<h4 id=\"시스템-구성-요소를-위한-데이터-저장\" style=\"position:relative;\"><a href=\"#%EC%8B%9C%EC%8A%A4%ED%85%9C-%EA%B5%AC%EC%84%B1-%EC%9A%94%EC%86%8C%EB%A5%BC-%EC%9C%84%ED%95%9C-%EB%8D%B0%EC%9D%B4%ED%84%B0-%EC%A0%80%EC%9E%A5\" aria-label=\"시스템 구성 요소를 위한 데이터 저장 permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>시스템 구성 요소를 위한 데이터 저장</h4>\n<p>이전에 <code class=\"language-text\">kubectl create</code>을 쓰지 말고 <code class=\"language-text\">kubectl apply</code>를 사용해야 하는 이유를 설명했을 때 등장한 <code class=\"language-text\">kubectl.kubernetes.io/last-applied-configuration</code>도 어노테이션 중 하나이다. 이 어노테이션은 ‘이전에 적용한 매니페스트’ 내용이 저장되어 있다. 이 어노테이션은 사용자가 따로 저장하는 것이 아니라 시스템 자체적으로 저장한 데이터이다.</p>\n<h4 id=\"모든-환경에서-사용할-수-없는-설정\" style=\"position:relative;\"><a href=\"#%EB%AA%A8%EB%93%A0-%ED%99%98%EA%B2%BD%EC%97%90%EC%84%9C-%EC%82%AC%EC%9A%A9%ED%95%A0-%EC%88%98-%EC%97%86%EB%8A%94-%EC%84%A4%EC%A0%95\" aria-label=\"모든 환경에서 사용할 수 없는 설정 permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>모든 환경에서 사용할 수 없는 설정</h4>\n<p>쿠버네티스 클러스터의 파드에 대해 클러스터 외부에서 접속할 수 있도록 외부 로드 밸런서 등과 연계하는 서비스 리소스 등에서 사용된다. 서비스 리소스를 생성하면 GKE 에서는 Google Cloud Load Balancing(GCLB), EKS에서는 AWS Classic Load Balancer(CLB) 또는 Network Load Balancer(NLB)와 연계한다. 대부분의 경우 로드 밸런서와 연계하는 서비스 리소스는 외부에서 접속할 수 있도록 글로벌 IP 주소가 부여된 글로벌 엔드포인트가 생성된다. 그러나 GKE와 EKS는 어노테이션을 부여하면 로컬 IP 주소가 부여된 인터널 엔드포인트 생성도 가능하다.</p>\n<h4 id=\"정식으로-통합되기-전의-기능을-설정\" style=\"position:relative;\"><a href=\"#%EC%A0%95%EC%8B%9D%EC%9C%BC%EB%A1%9C-%ED%86%B5%ED%95%A9%EB%90%98%EA%B8%B0-%EC%A0%84%EC%9D%98-%EA%B8%B0%EB%8A%A5%EC%9D%84-%EC%84%A4%EC%A0%95\" aria-label=\"정식으로 통합되기 전의 기능을 설정 permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>정식으로 통합되기 전의 기능을 설정</h4>\n<p>최근에는 쿠버네티스 생태계가 많이 성숙한 덕분에 거의 보이지 않지만, 쿠버네티스에 공식적으로 통합되기 전의 실험적인 기능과 평가 중인 새로운 기능 설정을 어노테이션으로 사용하는 경우도 있다. 스토리지클래스(StorageClass)나 초기화 컨테이너(Init Container)등이 있다.</p>\n<h3 id=\"레이블\" style=\"position:relative;\"><a href=\"#%EB%A0%88%EC%9D%B4%EB%B8%94\" aria-label=\"레이블 permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>레이블</h3>\n<p>레이블은 <code class=\"language-text\">metadata.labels</code>에 설정할 수 있는 메타데이터다. 레이블은 리소스를 구분하기 위한 정보이다. 컨테이너는 하나의 프로세스와 같은 아주 작은 리소스이다. 파드도 여러 컨테이너로 이루어진 작은 리소스이다. 쿠버네티스는 파드와 같은 리소스를 대량으로 처리할 뿐만 아니라, 서비스, 인그레스, 컨피그맵, 시크릿 등등과 같은 리소스들도 처리한다. 레이블은 이러한 수 많은 리소스에 대해 동일한 레이블로 그룹핑하여 처리하거나 어떤 처리 조건으로 사용되기 때문에 리소스를 효율적으로 관리할 수 있는 구조를 가진다.</p>\n<div class=\"gatsby-highlight\" data-language=\"yaml\"><pre class=\"language-yaml\"><code class=\"language-yaml\"><span class=\"token key atrule\">apiVersion</span><span class=\"token punctuation\">:</span> v1\n<span class=\"token key atrule\">kind</span><span class=\"token punctuation\">:</span> Pod\n<span class=\"token key atrule\">metadata</span><span class=\"token punctuation\">:</span>\n  <span class=\"token key atrule\">name</span><span class=\"token punctuation\">:</span> sample<span class=\"token punctuation\">-</span>label\n  <span class=\"token key atrule\">labels</span><span class=\"token punctuation\">:</span>\n    <span class=\"token key atrule\">label1</span><span class=\"token punctuation\">:</span> val1\n    <span class=\"token key atrule\">label2</span><span class=\"token punctuation\">:</span> val2\n<span class=\"token key atrule\">spec</span><span class=\"token punctuation\">:</span>\n  <span class=\"token key atrule\">containers</span><span class=\"token punctuation\">:</span>\n    <span class=\"token punctuation\">-</span> <span class=\"token key atrule\">name</span><span class=\"token punctuation\">:</span> nginx<span class=\"token punctuation\">-</span>container\n      <span class=\"token key atrule\">image</span><span class=\"token punctuation\">:</span> nginx<span class=\"token punctuation\">:</span><span class=\"token number\">1.12</span></code></pre></div>\n<p>매니페스트에 작성할 수도 있지만, kubectl에서 직접 부여할 수도 있다.</p>\n<div class=\"gatsby-highlight\" data-language=\"sh\"><pre class=\"language-sh\"><code class=\"language-sh\"><span class=\"token comment\"># 레이블 부여</span>\n$ kubectl label pods sample-label <span class=\"token assign-left variable\">label3</span><span class=\"token operator\">=</span>val3\n\n<span class=\"token comment\"># 레이블 부여 (덮어 쓰기)</span>\n$ kubectl label pods sample-label <span class=\"token assign-left variable\">label3</span><span class=\"token operator\">=</span>val3-new <span class=\"token parameter variable\">--overwrite</span>\n\n<span class=\"token comment\"># 레이블 확인</span>\n$ kubectl get pods sample-label <span class=\"token parameter variable\">-o</span> json <span class=\"token operator\">|</span> jq .metadata.labels\n\n<span class=\"token comment\"># 레이블 삭제</span>\n$ kubectl label pods sample-label label3-</code></pre></div>\n<h4 id=\"개발자가-사용하는-레이블\" style=\"position:relative;\"><a href=\"#%EA%B0%9C%EB%B0%9C%EC%9E%90%EA%B0%80-%EC%82%AC%EC%9A%A9%ED%95%98%EB%8A%94-%EB%A0%88%EC%9D%B4%EB%B8%94\" aria-label=\"개발자가 사용하는 레이블 permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>개발자가 사용하는 레이블</h4>\n<p>개발자가 많은 리소스를 효율적으로 관리하는 데 레이블은 정말 유용하게 사용된다. <code class=\"language-text\">kubectl get -l</code>과 같이 <code class=\"language-text\">-l</code> 옵션을 사용해서 특정 label이 있는 pod 들을 필터링하여 표시할 수 있다. <code class=\"language-text\">-L</code> 옵션은 해당 파드의 뒤에 입력된 label 값을 같이 표시해준다. <code class=\"language-text\">--show-label</code>은 모든 레이블을 표시할 때 사용된다.</p>\n<div class=\"gatsby-highlight\" data-language=\"sh\"><pre class=\"language-sh\"><code class=\"language-sh\"><span class=\"token comment\"># label1=val1, label2 레이블을 가진 파드 표시</span>\n$ kubectl get pods <span class=\"token parameter variable\">-l</span> <span class=\"token assign-left variable\">label1</span><span class=\"token operator\">=</span>val1,label2\n\n<span class=\"token comment\"># 파드와 label1 레이블 표시</span>\n$ kubectl get pods <span class=\"token parameter variable\">-L</span> label1\n\n<span class=\"token comment\"># 모든 레이블 표시</span>\n$ kubectl get pods --show-labels</code></pre></div>\n<h4 id=\"시스템이-사용하는-레이블\" style=\"position:relative;\"><a href=\"#%EC%8B%9C%EC%8A%A4%ED%85%9C%EC%9D%B4-%EC%82%AC%EC%9A%A9%ED%95%98%EB%8A%94-%EB%A0%88%EC%9D%B4%EB%B8%94\" aria-label=\"시스템이 사용하는 레이블 permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>시스템이 사용하는 레이블</h4>\n<p>파드 수를 유지하는 리소스(ReplicaSet) 에서는 레이블에 부여된 파드 수를 계산하여 레플리카 수를 관리한다. 대상 파드 수가 레플리카 수의 설정보다 많으면 기존 파드 중 하나를 삭제하고, 부족하면 하나를 생성한다. 따라서 조건에 일치하는 파드를 별도로 생성하게 되면 기존 파드가 정지하는 경우가 발생할 수 있다. 마찬가지로, 외부 요청을 로드 밸런서로 받은 후에 파드로 전송하는 서비스 리소스(LoadBalancer)에서는 이 레이블을 기준으로 목적지 파드를 설정한다. 이 경우 실수로 레이블을 지정하게 되면 다른 파드에 트래픽이 전송되어 문제가 발생한다.</p>\n<p>레이블 키 이름에는 다음과 같이 권장되고 있다.</p>\n<table>\n<thead>\n<tr>\n<th>레이블 키 이름</th>\n<th>개요</th>\n</tr>\n</thead>\n<tbody>\n<tr>\n<td>app.kubernetes.io/name</td>\n<td>애플리케이션 이름</td>\n</tr>\n<tr>\n<td>app.kubernetes.io/version</td>\n<td>애플리케이션 버전</td>\n</tr>\n<tr>\n<td>app.kubernetes.io/component</td>\n<td>애플리케이션 내 구성 요소</td>\n</tr>\n<tr>\n<td>app.kubernetes.io/part-of</td>\n<td>애플리케이션이 전체적으로 구성하는 시스템 이름</td>\n</tr>\n<tr>\n<td>app.kubernetes.io/instance</td>\n<td>애플리케이션이나 시스템을 식별하는 인스턴스명</td>\n</tr>\n<tr>\n<td>app.kubernetes.io/managed-by</td>\n<td>이 애플리케이션을 관리하는 데 사용되는 도구</td>\n</tr>\n</tbody>\n</table>\n<h2 id=\"458-prune을-사용한-리소스-삭제--prune-옵션\" style=\"position:relative;\"><a href=\"#458-prune%EC%9D%84-%EC%82%AC%EC%9A%A9%ED%95%9C-%EB%A6%AC%EC%86%8C%EC%8A%A4-%EC%82%AD%EC%A0%9C--prune-%EC%98%B5%EC%85%98\" aria-label=\"458 prune을 사용한 리소스 삭제  prune 옵션 permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>4.5.8 Prune을 사용한 리소스 삭제: -prune 옵션</h2>\n<p>쿠버네티스를 실제 운용할 때 수동으로 kubectl 명령어를 사용하는 일은 거의 없다. 수동으로 운영하는 것은 휴먼 에러가 발생하기 쉽고, 사람이 파악하고 관리할 수 있는 리소스 수에 한계가 있기 때문에 권장되지 않는다. Git 저장소에서 매니페스를 관리하고 변경이 있을 때만 <code class=\"language-text\">kubectl apply</code> 명령어를 사용하여 자동으로 매니페스트를 적용시키는 방법이 있다. 하지만 매니페스트에서 삭제된 리소스를 삭제하는 데 필요한 kubectl delete 명령어를 자동으로 실행하려면 매니페스트에서 삭제된 리소스를 감지할 수 있는 구조를 만들어야 한다.</p>\n<p>여기서 필요한 것이 <code class=\"language-text\">kubectl apply</code> 명령어에서 사용 가능한 <code class=\"language-text\">--prune</code> 옵션이다. 이 옵션은 <code class=\"language-text\">kubectl apply</code> 명령어어를 실행할 때 매니페스트에서 삭제된 리소스를 감지하여 자동으로 삭제하는 기능을 구현할 수 있다. 그래서 CI/CD 파이프라인에서는 업데이트된 매니페스트에 대해 kubectl apply —prune 명령어를 계속 실행하는 것만으로 매니페스트에서 삭제된 리소스도 자동으로 삭제할 수 있다.</p>\n<p>Prune은 레이블과 일치하는 전체 리소스의 목록에서 읽어들인 매니페스트 안에 ‘포함되지 않는 리소스’를 모두 삭제하는 구조로 동작한다.</p>\n<div class=\"gatsby-highlight\" data-language=\"sh\"><pre class=\"language-sh\"><code class=\"language-sh\"><span class=\"token comment\"># 초기 생성</span>\n$ kubectl apply <span class=\"token parameter variable\">-f</span> ./prune-sample <span class=\"token parameter variable\">--prune</span> <span class=\"token parameter variable\">-l</span> <span class=\"token assign-left variable\">system</span><span class=\"token operator\">=</span>a\n\n<span class=\"token comment\"># 파일 삭제</span>\n$ <span class=\"token function\">rm</span> prune-sample/sample-pod1.yaml\n\n<span class=\"token comment\"># 삭제 후 다시 업데이트</span>\n$ kubectl apply <span class=\"token parameter variable\">-f</span> ./prune-sample <span class=\"token parameter variable\">--prune</span> <span class=\"token parameter variable\">-l</span> <span class=\"token assign-left variable\">system</span><span class=\"token operator\">=</span>a</code></pre></div>\n<h2 id=\"459-편집기로-편집-edit\" style=\"position:relative;\"><a href=\"#459-%ED%8E%B8%EC%A7%91%EA%B8%B0%EB%A1%9C-%ED%8E%B8%EC%A7%91-edit\" aria-label=\"459 편집기로 편집 edit permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>4.5.9 편집기로 편집: edit</h2>\n<p><code class=\"language-text\">kubectl edit</code> 명령어는 편집기 상에서 해당 리소스를 편집할 수 있다. 편집에 사용되는 편집기는 환경 변수 EDITOR이나 KUBE_EDITOR로 지정할 수 있다.</p>\n<div class=\"gatsby-highlight\" data-language=\"sh\"><pre class=\"language-sh\"><code class=\"language-sh\"><span class=\"token comment\"># 환경 변수 EDITOR에 vim을 일시적으로 정의(~/.bashrc 등에 추가하면 영구적으로 사용 가능)</span>\n$ <span class=\"token builtin class-name\">export</span> <span class=\"token assign-left variable\">EDITOR</span><span class=\"token operator\">=</span>vim\n\n<span class=\"token comment\"># 파드 정의 편집(환경 변수 EDITOR에 정의된 편집기 실행)</span>\n$ kubectl edit pod sample-pod</code></pre></div>\n<h2 id=\"4510-리소스-일부-정보-업데이트-set\" style=\"position:relative;\"><a href=\"#4510-%EB%A6%AC%EC%86%8C%EC%8A%A4-%EC%9D%BC%EB%B6%80-%EC%A0%95%EB%B3%B4-%EC%97%85%EB%8D%B0%EC%9D%B4%ED%8A%B8-set\" aria-label=\"4510 리소스 일부 정보 업데이트 set permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>4.5.10 리소스 일부 정보 업데이트: set</h2>\n<p>매니페스트 파일을 업데이트하지 않고 일부 설정값(또는 이 설정값을 가진 특정 리소스)만 <code class=\"language-text\">kubectl set</code> 명령어를 사용하여 간단히 동작 상태를 변경할 수 있다. 변경 가능한 설정값은 다음과 같다.</p>\n<ul>\n<li>env</li>\n<li>image</li>\n<li>resources</li>\n<li>selector</li>\n<li>serviceaccount</li>\n<li>subject</li>\n</ul>\n<p>예를 들어, 컨테이너 이미지만 업데이트 하는 경우, 다음과 같이 하면 된다. 다만, <code class=\"language-text\">kubectl set</code>은 매니페스트 파일만 업데이트 되는 것이라, 실제 서버상의 리소스에 적용되는 것이 아니다.</p>\n<div class=\"gatsby-highlight\" data-language=\"sh\"><pre class=\"language-sh\"><code class=\"language-sh\"><span class=\"token comment\"># sample-pod 내 nginx-container 컨테이너의 컨테이너 이미지 확인</span>\n$ kubectl describe pod sample-pod\n\n<span class=\"token comment\"># 컨테이너 이미지를 nginx:1.17에서 nginx:1.16으로 변경</span>\n<span class=\"token comment\"># 서식: kubectl set image 리소스 종류 리소스명 컨테이너명=컨테이너 이미지 지정</span>\n$ kubectl <span class=\"token builtin class-name\">set</span> image pod sample-pod nginx-container<span class=\"token operator\">=</span>nginx:1.16\n\n<span class=\"token comment\"># sample-pod 내 nginx-container 컨테이너의 컨테이너 이미지 확인</span>\n$ kubectl describe pod sample-pod</code></pre></div>\n<h2 id=\"4511-로컬-매니페스트와-쿠버네티스-등록-정보-비교-출력-diff\" style=\"position:relative;\"><a href=\"#4511-%EB%A1%9C%EC%BB%AC-%EB%A7%A4%EB%8B%88%ED%8E%98%EC%8A%A4%ED%8A%B8%EC%99%80-%EC%BF%A0%EB%B2%84%EB%84%A4%ED%8B%B0%EC%8A%A4-%EB%93%B1%EB%A1%9D-%EC%A0%95%EB%B3%B4-%EB%B9%84%EA%B5%90-%EC%B6%9C%EB%A0%A5-diff\" aria-label=\"4511 로컬 매니페스트와 쿠버네티스 등록 정보 비교 출력 diff permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>4.5.11 로컬 매니페스트와 쿠버네티스 등록 정보 비교 출력: diff</h2>\n<p>쿠버네티스에서는 매니페스트를 적용할 때 ‘실제로 쿠버네티스 클러스터에 등록된 정보’와 ‘로컬에 있는 매니페스트’ 내용의 차이가 있는지 알 수 없다면 매니페스트를 적용하기 힘들 수 있다. 이에 <code class=\"language-text\">kubectl diff</code>명령어를 사용하여 둘의 차이를 확인할 수 있다.</p>\n<div class=\"gatsby-highlight\" data-language=\"sh\"><pre class=\"language-sh\"><code class=\"language-sh\"><span class=\"token comment\"># 컨테이너 이미지를 nginx:1.15로 변경</span>\n$ kubectl <span class=\"token builtin class-name\">set</span> image pod sample-pod nginx-container<span class=\"token operator\">=</span>nginx:1.15\n\n<span class=\"token comment\"># 클러스터 등록 정보와 매니페스트의 차이점 확인</span>\n$ kubectl <span class=\"token function\">diff</span> <span class=\"token parameter variable\">-f</span> sample-pod.yaml\n\n<span class=\"token comment\"># 상태 코드 확인</span>\n$ <span class=\"token builtin class-name\">echo</span> <span class=\"token variable\">$?</span></code></pre></div>\n<h2 id=\"4512-사용-가능한-리소스-종류의-목록-가져오기-api-resources\" style=\"position:relative;\"><a href=\"#4512-%EC%82%AC%EC%9A%A9-%EA%B0%80%EB%8A%A5%ED%95%9C-%EB%A6%AC%EC%86%8C%EC%8A%A4-%EC%A2%85%EB%A5%98%EC%9D%98-%EB%AA%A9%EB%A1%9D-%EA%B0%80%EC%A0%B8%EC%98%A4%EA%B8%B0-api-resources\" aria-label=\"4512 사용 가능한 리소스 종류의 목록 가져오기 api resources permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>4.5.12 사용 가능한 리소스 종류의 목록 가져오기: api-resources</h2>\n<p><code class=\"language-text\">kubectl api-resources</code> 명령어는 사용 가능한 리소스 목록을 가져올 수 있다.</p>\n<div class=\"gatsby-highlight\" data-language=\"sh\"><pre class=\"language-sh\"><code class=\"language-sh\"><span class=\"token comment\"># 모든 리소스 종류 표시(일부 발췌)</span>\n$ kubectl api-resources\n\n<span class=\"token comment\"># 네임 스페이스에 속하는 리소스</span>\n$ kubectl api-resources <span class=\"token parameter variable\">--namespaced</span><span class=\"token operator\">=</span>true</code></pre></div>\n<h2 id=\"4513-리소스-정보-가져오기-get\" style=\"position:relative;\"><a href=\"#4513-%EB%A6%AC%EC%86%8C%EC%8A%A4-%EC%A0%95%EB%B3%B4-%EA%B0%80%EC%A0%B8%EC%98%A4%EA%B8%B0-get\" aria-label=\"4513 리소스 정보 가져오기 get permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>4.5.13 리소스 정보 가져오기: get</h2>\n<p><code class=\"language-text\">kubectl get</code> 명령어는 리소스 목록을 가져올 수 있다.</p>\n<div class=\"gatsby-highlight\" data-language=\"sh\"><pre class=\"language-sh\"><code class=\"language-sh\"><span class=\"token comment\"># 파드 목록 표시</span>\n$ kubectl get pods sample-pod\n\n<span class=\"token comment\"># label1=val1과 label2 레이블을 가진 파드를 표시</span>\n$ kubectl get pods <span class=\"token parameter variable\">-l</span> <span class=\"token assign-left variable\">label</span><span class=\"token operator\">=</span>val1,label2 --show-labels\n\n<span class=\"token comment\"># 파드 목록 표시(더 상세히 표시)</span>\n$ kubectl get pods <span class=\"token parameter variable\">-o</span> wide\n\n<span class=\"token comment\"># YAML 형식으로 파드의 상세 목록 출력</span>\n$ kubectl get pods <span class=\"token parameter variable\">-o</span> yaml\n\n<span class=\"token comment\"># Custom Columns (모든 파드의 파드명과 기동 중인 호스트 IP주소를 표시)</span>\n$ kubectl get pods <span class=\"token parameter variable\">-o</span> custom-columns<span class=\"token operator\">=</span><span class=\"token string\">\"NAME:{.metadata.name},NodeIP:{.status.hostIP}\"</span>\n\n<span class=\"token comment\"># JSON Path(sample-pod의 파드명 표시)</span>\n$ kubectl get pods sample-pod <span class=\"token parameter variable\">-o</span> <span class=\"token assign-left variable\">jsonpath</span><span class=\"token operator\">=</span><span class=\"token string\">\"{.metadata.name}\"</span>\n\n<span class=\"token comment\"># .spec.containers[].name이 nginx-container에 일치하는 요소의 .spec.containers[].image를 출력</span>\n$ kubectl get pods sample-pod <span class=\"token parameter variable\">-o</span> <span class=\"token assign-left variable\">jsonpath</span><span class=\"token operator\">=</span><span class=\"token string\">\"{.spec.containers[?(@.name == 'nginx-container')].image}\"</span>\n\n<span class=\"token comment\"># Go Template(가장 유연한 출력 방식. 여기서는 모든 파드의 이름과 파드 안에서 기동 중인 각 컨테이너 이미지를 표시)</span>\n$ kubectl get pods <span class=\"token parameter variable\">-o</span> go-template<span class=\"token operator\">=</span><span class=\"token string\">\"{{range .items}}{{.metadata.name}}:{{range .spec.containers}}{{.image}}{{end}} {{end}}\"</span>\n\n<span class=\"token comment\"># 노드 목록 표시</span>\n$ kubectl get nodes\n\n<span class=\"token comment\"># 생성된 모든 종료의 리소스를 표시 (시크릿/컨피그맵/인그레스는 제외)</span>\n$ kubectl get all\n\n<span class=\"token comment\"># --watch 옵션을 사용하여 리소스 상태의 변화가 있을 때 결과를 계속 출력</span>\n$ kubectl get pods <span class=\"token parameter variable\">--watch</span>\n\n<span class=\"token comment\"># --output-watch-events 옵션을 사용하면 해당 리소스가 API처럼 어떤 처리가 되었는지 이벤트 정보도 함께 표시할 수 있다.</span>\n$ kubectl get pods <span class=\"token parameter variable\">--watch</span> --output-watch-events</code></pre></div>\n<h2 id=\"4514-리소스-상세-정보-가져오기-describe\" style=\"position:relative;\"><a href=\"#4514-%EB%A6%AC%EC%86%8C%EC%8A%A4-%EC%83%81%EC%84%B8-%EC%A0%95%EB%B3%B4-%EA%B0%80%EC%A0%B8%EC%98%A4%EA%B8%B0-describe\" aria-label=\"4514 리소스 상세 정보 가져오기 describe permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>4.5.14 리소스 상세 정보 가져오기: describe</h2>\n<div class=\"gatsby-highlight\" data-language=\"sh\"><pre class=\"language-sh\"><code class=\"language-sh\"><span class=\"token comment\"># 파드 상세 정보 표시</span>\n$ kubectl describe pod sample-pod\n\n<span class=\"token comment\"># 노드 상세 정보 표시</span>\n$ kubectl describe <span class=\"token function\">node</span> </code></pre></div>\n<h2 id=\"4515--실제-리소스-사용량-확인-top\" style=\"position:relative;\"><a href=\"#4515--%EC%8B%A4%EC%A0%9C-%EB%A6%AC%EC%86%8C%EC%8A%A4-%EC%82%AC%EC%9A%A9%EB%9F%89-%ED%99%95%EC%9D%B8-top\" aria-label=\"4515  실제 리소스 사용량 확인 top permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>4.5.15  실제 리소스 사용량 확인: top</h2>\n<p><code class=\"language-text\">kubectl describe</code> 명령어에서 확인할 수 있는 리소스 사용량은 쿠버네티스가 파드에 확보한 값을 타나낸다. 실제 파드 내부의 컨테이너가 사용하고 있는 리소스 사용량은 <code class=\"language-text\">kubectl top</code>명령어를 사용하여 확인할 수 있다. 리소스 사용량은 노드와 파드 단위로 확인한다. 또, <code class=\"language-text\">kubectl top</code>명령어는 <code class=\"language-text\">metric-server</code>라는 추가 구성 요소를 사용한다. 일반적인 쿠버네티스 환경이라면 배포되겠지만, 배포되지 않을 경우에는 수동으로 배포해야 한다.</p>\n<div class=\"gatsby-highlight\" data-language=\"sh\"><pre class=\"language-sh\"><code class=\"language-sh\"><span class=\"token comment\"># 노드 리소스 사용량 확인</span>\n$ kubectl <span class=\"token function\">top</span> <span class=\"token function\">node</span>\nerror: Metrics API not available</code></pre></div>\n<p>그런데 위 명령어 사용 시 위와 같이 에러가 발생하였다. 확인해보니 쿠버네티스를 설치했다고 메트릭스 서버까지 같이 설치되지는 않는 모양이다. 그래서 별도로 설치를 진행하였다.</p>\n<div class=\"gatsby-highlight\" data-language=\"sh\"><pre class=\"language-sh\"><code class=\"language-sh\"><span class=\"token comment\"># metric 서버 실행</span>\n$ kubectl apply <span class=\"token parameter variable\">-f</span> https://github.com/kubernetes-sigs/metrics-server/releases/latest/download/components.yaml\n\n<span class=\"token comment\"># kubectl에 접근하여 파드와 노드의 정보를 얻어올 수 있도록 설정 (tls 통신이 가능하도록 수정)</span>\n$ kubectl edit deployments.apps <span class=\"token parameter variable\">-n</span> kube-system metrics-server</code></pre></div>\n<p>yaml 파일 내부에서 args 찾아가서 아래 두 설정을 추가한다.</p>\n<table>\n<thead>\n<tr>\n<th>Arguments</th>\n<th>Detail</th>\n</tr>\n</thead>\n<tbody>\n<tr>\n<td>—kubelet-insecure-tls</td>\n<td>인증서가 공인 기관에 승인 받지 않아 안전하지 않기 때문에 보안적으로 취약하지만, 무시하겠다는 의미</td>\n</tr>\n<tr>\n<td>—kubelet-preferred-address-types=InternalIP</td>\n<td>kubelet 연결에 사용할 때 사용하는 주소 타입을 지정</td>\n</tr>\n</tbody>\n</table>\n<div class=\"gatsby-highlight\" data-language=\"sh\"><pre class=\"language-sh\"><code class=\"language-sh\"><span class=\"token comment\"># 파드별 리소스 사용량 확인</span>\n$ kubectl <span class=\"token parameter variable\">-n</span> kube-system <span class=\"token function\">top</span> pod\n\n<span class=\"token comment\"># 파드 리스트 표시 및 컨테이너별 리소스 사용량 확인</span>\n$ kubectl <span class=\"token parameter variable\">-n</span> kube-system get pods\n$ kubectl <span class=\"token parameter variable\">-n</span> kube-system <span class=\"token function\">top</span> pod <span class=\"token parameter variable\">--containers</span></code></pre></div>\n<h2 id=\"4516-컨테이너에서-명령어-실행-exec\" style=\"position:relative;\"><a href=\"#4516-%EC%BB%A8%ED%85%8C%EC%9D%B4%EB%84%88%EC%97%90%EC%84%9C-%EB%AA%85%EB%A0%B9%EC%96%B4-%EC%8B%A4%ED%96%89-exec\" aria-label=\"4516 컨테이너에서 명령어 실행 exec permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>4.5.16 컨테이너에서 명령어 실행: exec</h2>\n<p>파드 내부의 컨테이너에서 특정 명령어를 실행시키려면 <code class=\"language-text\">kubectl exec</code> 명령어를 사용한다. 이 명령어를 사용하여 /bin/bash 등의 셸을 실행하여 마치 컨테이너에 로그인한 것과 같은 상태를 만들 수 있다. 명령어를 사용하기 전 <code class=\"language-text\">--</code>는 필수로 붙여서 사용해야 한다.</p>\n<div class=\"gatsby-highlight\" data-language=\"sh\"><pre class=\"language-sh\"><code class=\"language-sh\"><span class=\"token comment\"># 파드 내부의 컨테이너에서 /bin/ls 실행</span>\n$ kubectl <span class=\"token builtin class-name\">exec</span> <span class=\"token parameter variable\">-it</span> sample-pod -- /bin/ls\n\n\n<span class=\"token comment\"># 여러 컨테이너에 존재하는 파드의 특정 컨테이너에서 /bin/ls 실행</span>\n$ kubectl <span class=\"token builtin class-name\">exec</span> <span class=\"token parameter variable\">-it</span> sample-pod <span class=\"token parameter variable\">-c</span> nginx-container -- /bin/ls\n\n<span class=\"token comment\"># 파드 내부의 컨테이너에서 /bin/bash 실행(종료하려면 exit 실행)</span>\n$ kubectl <span class=\"token builtin class-name\">exec</span> <span class=\"token parameter variable\">-it</span> sample-pod -- /bin/bash\n\n<span class=\"token comment\"># 파이프 등 특정 문자가 포함된 경우 /bin/bash에 인수를 전달하는 형태로 실행</span>\n$ kubectl <span class=\"token builtin class-name\">exec</span> <span class=\"token parameter variable\">-it</span> sample-pod -- /bin/bash <span class=\"token parameter variable\">-c</span> <span class=\"token string\">\"ls -all --classify | grep lib\"</span></code></pre></div>\n<h2 id=\"4517-파드에-디버깅용-임시-컨테이너-추가-debug\" style=\"position:relative;\"><a href=\"#4517-%ED%8C%8C%EB%93%9C%EC%97%90-%EB%94%94%EB%B2%84%EA%B9%85%EC%9A%A9-%EC%9E%84%EC%8B%9C-%EC%BB%A8%ED%85%8C%EC%9D%B4%EB%84%88-%EC%B6%94%EA%B0%80-debug\" aria-label=\"4517 파드에 디버깅용 임시 컨테이너 추가 debug permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>4.5.17 파드에 디버깅용 임시 컨테이너 추가: debug</h2>\n<p>컨테이너 이미지로 경량의 Distroless나 Scratch 이미지 등을 사용하는 경우 디버깅용 도구 등이 전혀 들어 있지 않기 때문에, 문제가 발생했을 때 <code class=\"language-text\">kubectl exec</code> 명령어를 사용하여 컨테이너 안으로 들어가도 디버깅을 수행하기 어렵다. 이 문제를 해결하기 위해 사용 가능한 것이 <code class=\"language-text\">kubectl debug</code> 명령어이다. 이 명령어는 파드에 추가 임시 컨테이너를 기동하고 그 컨테이너를 사용하여 디버깅이나 트러블슈팅을 수행한다.</p>\n<div class=\"gatsby-highlight\" data-language=\"sh\"><pre class=\"language-sh\"><code class=\"language-sh\"><span class=\"token comment\"># sample-pod에 임의의 명령어로 디버깅용 컨테이너를 기동하여 접속 (4장에서 생성한 k8s-alpha에서 실행)</span>\n$ kubectl debug sample-pod <span class=\"token parameter variable\">--image</span><span class=\"token operator\">=</span>amsy810/tools:v2.0 <span class=\"token parameter variable\">-it</span> -- <span class=\"token function\">bash</span></code></pre></div>\n<h2 id=\"4518-로컬-머신에서-파드로-포트-포워딩-port-forwarding\" style=\"position:relative;\"><a href=\"#4518-%EB%A1%9C%EC%BB%AC-%EB%A8%B8%EC%8B%A0%EC%97%90%EC%84%9C-%ED%8C%8C%EB%93%9C%EB%A1%9C-%ED%8F%AC%ED%8A%B8-%ED%8F%AC%EC%9B%8C%EB%94%A9-port-forwarding\" aria-label=\"4518 로컬 머신에서 파드로 포트 포워딩 port forwarding permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>4.5.18 로컬 머신에서 파드로 포트 포워딩: port-forwarding</h2>\n<p>디버깅 용도 등으로 JMX 클라이언트에서 컨테이너에서 실행 중인 자바 애플리케이션 서버에 접속하거나, 데이터베이스 클라이언트에서 컨테이너에서 기동 중인 MySQL 서버에 접속해야 하는 경우가 있다. 그런 경우 kubectl을 실행하는 로컬 머신에서 특정 파드로 트래픽을 전송하는 <code class=\"language-text\">kubectl port-forwarding</code> 명령어를 사용할 수 있다.</p>\n<div class=\"gatsby-highlight\" data-language=\"sh\"><pre class=\"language-sh\"><code class=\"language-sh\"><span class=\"token comment\"># localhost:8888에서 파드의 80/TCP 포트로 전송 (종료하려면 Ctrl + C 입력)</span>\n$ kubectl port-forward sample-pod <span class=\"token number\">8888</span>:80\n\n<span class=\"token comment\"># 다른 터미널에서 접속 확인</span>\n$ <span class=\"token function\">curl</span> <span class=\"token parameter variable\">-I</span> localhost:8888</code></pre></div>\n<h2 id=\"4519-컨테이너-로그-확인-logs\" style=\"position:relative;\"><a href=\"#4519-%EC%BB%A8%ED%85%8C%EC%9D%B4%EB%84%88-%EB%A1%9C%EA%B7%B8-%ED%99%95%EC%9D%B8-logs\" aria-label=\"4519 컨테이너 로그 확인 logs permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>4.5.19 컨테이너 로그 확인: logs</h2>\n<div class=\"gatsby-highlight\" data-language=\"sh\"><pre class=\"language-sh\"><code class=\"language-sh\"><span class=\"token comment\"># 파드 내의 컨테이너 로그 출력</span>\n$ kubectl logs sample-pod\n\n<span class=\"token comment\"># 특정 파드 내의 특정 컨테이너 로그 출력</span>\n$ kubectl logs sample-pod <span class=\"token parameter variable\">-c</span> nginx-container\n\n<span class=\"token comment\"># 실시간 로그 출력</span>\n$ kubectl logs <span class=\"token parameter variable\">-f</span> sample-pod\n\n<span class=\"token comment\"># 최근 1시간 이내, 10건의 로그를 타임스탬프와 함께 출력</span>\n$ kubectl logs <span class=\"token parameter variable\">--since</span><span class=\"token operator\">=</span>1h <span class=\"token parameter variable\">--tail</span><span class=\"token operator\">=</span><span class=\"token number\">10</span> <span class=\"token parameter variable\">--timestamp</span><span class=\"token operator\">=</span>true sample-pod\n\n<span class=\"token comment\"># app=sample-app 레이블을 가진 모든 파드의 로그 출력</span>\n$ kubectl logs <span class=\"token parameter variable\">--selector</span> <span class=\"token assign-left variable\">app</span><span class=\"token operator\">=</span>sample-app</code></pre></div>\n<h2 id=\"4520-컨테이너와-로컬-머신-간의-파일-복사-cp\" style=\"position:relative;\"><a href=\"#4520-%EC%BB%A8%ED%85%8C%EC%9D%B4%EB%84%88%EC%99%80-%EB%A1%9C%EC%BB%AC-%EB%A8%B8%EC%8B%A0-%EA%B0%84%EC%9D%98-%ED%8C%8C%EC%9D%BC-%EB%B3%B5%EC%82%AC-cp\" aria-label=\"4520 컨테이너와 로컬 머신 간의 파일 복사 cp permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>4.5.20 컨테이너와 로컬 머신 간의 파일 복사: cp</h2>\n<div class=\"gatsby-highlight\" data-language=\"sh\"><pre class=\"language-sh\"><code class=\"language-sh\"><span class=\"token comment\"># sample-pod의 /etc/hostname 파일을 로컬 머신에 복사</span>\n$ kubectl <span class=\"token function\">cp</span> sample-pod:/etc/hostname ./hostname\n\n<span class=\"token comment\"># hostname 파일 확인</span>\n$ <span class=\"token function\">cat</span> <span class=\"token function\">hostname</span>\n\n<span class=\"token comment\"># 가져온 로컬 파일을 컨테이너로 복사</span>\n$ kubectl <span class=\"token function\">cp</span> <span class=\"token function\">hostname</span> sample-pod:/tmp/newfile\n\n<span class=\"token comment\"># 컨테이너의 /tmp를 확인</span>\n$ kubectl <span class=\"token builtin class-name\">exec</span> <span class=\"token parameter variable\">-it</span> sample-pod -- <span class=\"token function\">ls</span> /tmp</code></pre></div>\n<h2 id=\"4521-kubectl-플러그인과-패키지-관리자-pluginkrew\" style=\"position:relative;\"><a href=\"#4521-kubectl-%ED%94%8C%EB%9F%AC%EA%B7%B8%EC%9D%B8%EA%B3%BC-%ED%8C%A8%ED%82%A4%EC%A7%80-%EA%B4%80%EB%A6%AC%EC%9E%90-pluginkrew\" aria-label=\"4521 kubectl 플러그인과 패키지 관리자 pluginkrew permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>4.5.21 kubectl 플러그인과 패키지 관리자: plugin/krew</h2>\n<p>kubectl에는 하위 명령어가 확장할 수 있도록 플러그인이 준비되어 있다. kubectl 플러그인 관리는 수동으로 할 수 있지만, krew 라는 플러그인 관리자를 통해 관리할 것을 추천한다.</p>\n<div class=\"gatsby-highlight\" data-language=\"sh\"><pre class=\"language-sh\"><code class=\"language-sh\"><span class=\"token comment\"># krew 설치</span>\n<span class=\"token punctuation\">(</span>\n  <span class=\"token builtin class-name\">set</span> -x<span class=\"token punctuation\">;</span> <span class=\"token builtin class-name\">cd</span> <span class=\"token string\">\"<span class=\"token variable\"><span class=\"token variable\">$(</span>mktemp <span class=\"token parameter variable\">-d</span><span class=\"token variable\">)</span></span>\"</span> <span class=\"token operator\">&amp;&amp;</span>\n  <span class=\"token assign-left variable\">OS</span><span class=\"token operator\">=</span><span class=\"token string\">\"<span class=\"token variable\"><span class=\"token variable\">$(</span><span class=\"token function\">uname</span> <span class=\"token operator\">|</span> <span class=\"token function\">tr</span> <span class=\"token string\">'[:upper:]'</span> <span class=\"token string\">'[:lower:]'</span><span class=\"token variable\">)</span></span>\"</span> <span class=\"token operator\">&amp;&amp;</span>\n  <span class=\"token assign-left variable\">ARCH</span><span class=\"token operator\">=</span><span class=\"token string\">\"<span class=\"token variable\"><span class=\"token variable\">$(</span><span class=\"token function\">uname</span> <span class=\"token parameter variable\">-m</span> <span class=\"token operator\">|</span> <span class=\"token function\">sed</span> <span class=\"token parameter variable\">-e</span> <span class=\"token string\">'s/x86_64/amd64/'</span> <span class=\"token parameter variable\">-e</span> <span class=\"token string\">'s/\\(arm\\)\\(64\\)\\?.*/\\1\\2/'</span> <span class=\"token parameter variable\">-e</span> <span class=\"token string\">'s/aarch64$/arm64/'</span><span class=\"token variable\">)</span></span>\"</span> <span class=\"token operator\">&amp;&amp;</span>\n  <span class=\"token assign-left variable\">KREW</span><span class=\"token operator\">=</span><span class=\"token string\">\"krew-<span class=\"token variable\">${OS}</span>_<span class=\"token variable\">${ARCH}</span>\"</span> <span class=\"token operator\">&amp;&amp;</span>\n  <span class=\"token function\">curl</span> <span class=\"token parameter variable\">-fsSLO</span> <span class=\"token string\">\"https://github.com/kubernetes-sigs/krew/releases/latest/download/<span class=\"token variable\">${KREW}</span>.tar.gz\"</span> <span class=\"token operator\">&amp;&amp;</span>\n  <span class=\"token function\">tar</span> zxvf <span class=\"token string\">\"<span class=\"token variable\">${KREW}</span>.tar.gz\"</span> <span class=\"token operator\">&amp;&amp;</span>\n  ./<span class=\"token string\">\"<span class=\"token variable\">${KREW}</span>\"</span> <span class=\"token function\">install</span> krew\n<span class=\"token punctuation\">)</span>\n<span class=\"token builtin class-name\">export</span> <span class=\"token assign-left variable\"><span class=\"token environment constant\">PATH</span></span><span class=\"token operator\">=</span><span class=\"token string\">\"<span class=\"token variable\">${KREW_ROOT<span class=\"token operator\">:-</span>$HOME<span class=\"token operator\">/</span>.krew}</span>/bin:<span class=\"token environment constant\">$PATH</span>\"</span>\n\n<span class=\"token comment\"># 플러그인 목록 표시</span>\n$ kubectl plugin list\n\n<span class=\"token comment\"># 플러그인 설치</span>\n$ kubectl krew <span class=\"token function\">install</span> tree rolesum sort-manifests open-svc view-serviceaccount-kubeconfig</code></pre></div>\n<h2 id=\"4522-kubectl에서-디버깅\" style=\"position:relative;\"><a href=\"#4522-kubectl%EC%97%90%EC%84%9C-%EB%94%94%EB%B2%84%EA%B9%85\" aria-label=\"4522 kubectl에서 디버깅 permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>4.5.22 kubectl에서 디버깅</h2>\n<p>kubectl은 쿠버네티스 마스터의 API와 통신하여 클러스터를 관리한다. 따라서 어떤 에러가 발생했을 때는 API통신이나 kubectl 설정에 문제가 있는 경우가 대부분이다. kubectl 명령어를 실행할 때 -v 옵션으로 로그 레벨을 지정하면 면령어 실행 내용을 좀 더 상세히 볼 수 있다. 리소스 등을 생성했을 때 HTTP Request/Response 내용을 표시하는 경우 -v=6 이상의 로그 레벨로 출력하면 된다.</p>\n<p>Request Body/Resposne Body 까지 확인하려면 -v=8 이상의 레벨로 출력한다.</p>\n<div class=\"gatsby-highlight\" data-language=\"sh\"><pre class=\"language-sh\"><code class=\"language-sh\">$ kubectl <span class=\"token parameter variable\">-v</span><span class=\"token operator\">=</span><span class=\"token number\">6</span> get pod\n\n$ kubectl <span class=\"token parameter variable\">-v</span><span class=\"token operator\">=</span><span class=\"token number\">8</span> apply <span class=\"token parameter variable\">-f</span> sample-pod.yaml</code></pre></div>\n<h2 id=\"kubectl의-기타-팁\" style=\"position:relative;\"><a href=\"#kubectl%EC%9D%98-%EA%B8%B0%ED%83%80-%ED%8C%81\" aria-label=\"kubectl의 기타 팁 permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>kubectl의 기타 팁</h2>\n<h3 id=\"alias-생성\" style=\"position:relative;\"><a href=\"#alias-%EC%83%9D%EC%84%B1\" aria-label=\"alias 생성 permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>alias 생성</h3>\n<div class=\"gatsby-highlight\" data-language=\"sh\"><pre class=\"language-sh\"><code class=\"language-sh\"><span class=\"token comment\"># kubectl 명령어를 k로 사용할 수 있도록 alias 설정</span>\n$ <span class=\"token builtin class-name\">alias</span> <span class=\"token assign-left variable\">k</span><span class=\"token operator\">=</span><span class=\"token string\">'kubectl'</span></code></pre></div>\n<h3 id=\"kube-ps1\" style=\"position:relative;\"><a href=\"#kube-ps1\" aria-label=\"kube ps1 permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>kube-ps1</h3>\n<p>kube-ps1은 bash나 zsh의 프롬프트에 현재 작업 중인 쿠버네티스 클러스터와 네임스페이스를 표시한다. 맥 운영체제에서는 brew로 설치할 수 있다. 설치 후에는 다음 표시된 순서로 bashrc나 zshrc에 내용을 추가한다.</p>\n<div class=\"gatsby-highlight\" data-language=\"sh\"><pre class=\"language-sh\"><code class=\"language-sh\">$ brew update\n$ brew <span class=\"token function\">install</span> kube-ps1\n$ <span class=\"token builtin class-name\">source</span> <span class=\"token string\">\"/opt/homebrew/Cellar/kube-ps1/0.7.0/share/kube-ps1.sh\"</span>\n$ <span class=\"token assign-left variable\"><span class=\"token environment constant\">PS1</span></span><span class=\"token operator\">=</span><span class=\"token string\">'$(kube_ps1)'</span><span class=\"token environment constant\">$PS1</span>\n$ kubeon\n\n<span class=\"token comment\"># 프롬프트에 현재 작업 중인 클러스터와 네임스페이스 표시</span></code></pre></div>\n<h3 id=\"파드가-기동하지-않는-경우의-디버깅\" style=\"position:relative;\"><a href=\"#%ED%8C%8C%EB%93%9C%EA%B0%80-%EA%B8%B0%EB%8F%99%ED%95%98%EC%A7%80-%EC%95%8A%EB%8A%94-%EA%B2%BD%EC%9A%B0%EC%9D%98-%EB%94%94%EB%B2%84%EA%B9%85\" aria-label=\"파드가 기동하지 않는 경우의 디버깅 permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>파드가 기동하지 않는 경우의 디버깅</h3>\n<p>쿠버네티스 환경에서 파드가 기동되지 않는 경우에는 디버깅할 때 주로 다음 세 가지 방법이 사용된다.</p>\n<ol>\n<li><code class=\"language-text\">kubectl logs</code> 명령어를 사용하여 컨테이너가 출력하는 로그를 확인하는 방법이다. 이 방법은 주로 애플리케이션에 문제가 있을 때 유용하다.</li>\n<li><code class=\"language-text\">kubectl describe</code> 명령어로 표시되는 Events 항목을 확인하는 방법이다. 이 방법은 주로 쿠버네티스 설정이나 리소스 설정에 문제가 있을 때 유용하다. 명령어를 실행하면 에러 메시지를 확인할 수 있어 리소스 부족으로 스케줄리 불가능/스케줄링 정책에 해당하는 노드가 없음/볼륨 마운트 실패 등의 원인을 파악 가능하다.</li>\n<li>마지막으로 <code class=\"language-text\">kubectl run</code> 명령어를 사용하여 실제 컨테이너 셸로 확인하는 방법이다. 이는 주로 컨테이너 환경이나 애플리케이션에 문제가 있을 때 유용하다. 기동한 애플리케이션이 정지되면 파드도 정지되어 <code class=\"language-text\">kubectl exec</code> 명령어로 셸을 실행할 수 없다. 그런 경우에는 애플리케이션의 <code class=\"language-text\">ENTRYPOINT</code>를 덮어 씌워 일시적으로 컨테이너를 기동시켜 확인할 수 있다.</li>\n</ol>\n<h1 id=\"출처\" style=\"position:relative;\"><a href=\"#%EC%B6%9C%EC%B2%98\" aria-label=\"출처 permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>출처</h1>\n<p><a href=\"https://m.blog.naver.com/isc0304/221860790762\">https://m.blog.naver.com/isc0304/221860790762</a></p>","frontmatter":{"title":"[쿠버네티스 완벽 가이드] 06. API 리소스와 kubectl (3)","date":"August 06, 2022"}}},"pageContext":{"slug":"/kubernetes/kubernetes_4_3/","previous":{"fields":{"slug":"/kubernetes/kubernetes_terms/"},"frontmatter":{"title":"쿠버네티스 용어 정리"}},"next":{"fields":{"slug":"/linux/os/"},"frontmatter":{"title":"[Linux] OS 확인 하는 법"}}}},"staticQueryHashes":["3128451518","643154061"],"slicesMap":{}}