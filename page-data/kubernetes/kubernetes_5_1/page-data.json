{"componentChunkName":"component---src-templates-blog-post-js","path":"/kubernetes/kubernetes_5_1/","result":{"data":{"site":{"siteMetadata":{"title":"Devlog"}},"markdownRemark":{"id":"d9f963bc-436a-53a2-8aaf-7ffeae70a471","excerpt":"5.1 워크로드 API 카테고리란? 다음으로는 쿠버네티스 리소스 중 한 가지인 워크로드 API 카테고리의 리소스들에 대해 살펴보겠다. 워크로드 API…","html":"<h1>5.1 워크로드 API 카테고리란?</h1>\n<p>다음으로는 쿠버네티스 리소스 중 한 가지인 워크로드 API 카테고리의 리소스들에 대해 살펴보겠다. 워크로드 API 카테고리로 분류된 리소스는 클러스터에 컨테이너를 기동시키기 위해 사용되는 리소스이다. 내부에서 사용되는 리소스를 제외하고, 사용자가 직접 사용하는 리소스는 총 여덟가지 이다. 각 리소스는 파드를 최소 단위로 하여 그것을 관리하는 상위 리소스가 있는 부모 자식 관계로 되어 있다.</p>\n<ul>\n<li>파드</li>\n<li>레플리케이션 컨트롤러</li>\n<li>레플리카 셋</li>\n<li>디플로이먼트</li>\n<li>데몬 셋</li>\n<li>스테이트풀 셋</li>\n<li>잡</li>\n<li>크론 잡</li>\n</ul>\n<h1>5.2 파드(Pod)</h1>\n<p>워크로드 리소스의 최소 단위는 '파드'라고 불리는 리소스이다. 파드는 한 개 이상의 컨테이너로 구성되어 있으며, 같은 파드에 포함된 컨테이너들은 네트워크적으로 격리되어 있지 않고 IP주소를 공유한다. 따라서, 파드 내부의 컨테이너들은 서로 localhost로 통신할 수 있다. 대부분의 경우 하나의 파드에 하나의 컨테이너를 가지지만, 메인 컨테이너와 서브 컨테이너 등 여러 컨테이너를 가질 수 있다. 서브 컨테이너에는 프록시 역할을 하는 컨테이너, 설정값을 동적으로 변화시키는 컨테이너, 로컬 캐시용 컨테이너, SSL용 컨테이너 등을 예로 들 수 있다.</p>\n<h2>5.2.1 파드 디자인 패턴</h2>\n<p>파드 디자인 패턴에는 크게 세 종류가 있다.</p>\n<table>\n<thead>\n<tr>\n<th>종류</th>\n<th>내용</th>\n</tr>\n</thead>\n<tbody>\n<tr>\n<td>사이드카 패턴(sidecar pattern)</td>\n<td>메인 컨테이너에 기능을 추가한다.</td>\n</tr>\n<tr>\n<td>앰배서더 패턴(ambassador pattern)</td>\n<td>외부 시스템과의 통신을 중계한다.</td>\n</tr>\n<tr>\n<td>어댑터 패턴(adapter pattern)</td>\n<td>외부 접속을 위한 인터페이스를 제공한다.</td>\n</tr>\n</tbody>\n</table>\n<h3>사이드카 패턴</h3>\n<p>사이드카 패턴은 메인 컨테이너 외에 보조적인 기능을 추가하는 서브 컨테이너를 포함하는 패턴이다. <code class=\"language-text\">특정 변경 사항을 감지하여 동적으로 설정을 변경하는 컨테이너</code>, <code class=\"language-text\">깃 저장소와 로컬 스토리지를 동기화하는 컨테이너</code>, <code class=\"language-text\">애플리케이션의 로그 파일을 오브젝트 스토리지로 전송하는 컨테이너</code> 라는 구성이 자주 사용된다. 파드는 데이터 영역을 공유하고 가지고 있을 수 있기 때문에 데이터와 설정에 관련된 패턴이라고 볼 수 있다.</p>\n<h3>앰배서더 패턴</h3>\n<p>앰배서더 패턴은 메인 컨테이너가 외부 시스템과 접속할 때 중계하는 역할을 하는 서브 컨테이너이다. 파드에 두 개의 컨테이너가 있어 메인 컨테이너에서 목적지에 localhost를 지정하여 앰버서더 컨테이너로 접속할 수 있다. 앰배서더 컨테이너를 사용하여 외부 시스템과 통신하면 단일 데이터베이스를 사용하거나 샤딩된 분산 데이터베이스를 사용하는 환경 모두에서 특별한 변경 사항 없이 애플리케이션을 느슨한 결합을 유지하며 사용할 수 있다.</p>\n<h3>어댑터 패턴</h3>\n<p>어댑터 패턴은 서로 다른 데이터 형식을 변환해주는 컨테이너 패턴이다. 예를 들어, 프로메테우스 등의 모니터링 소프트웨어에서는 정의된 형식으로 메트릭을 수집해야 한다. 그러나 대부분의 미들웨어가 제공하는 메트릭 출력 형식은 프로메테우스 메트릭 형식을 지원하지 않는다. 따라서 이러한 경우 어댑터 컨테이너를 사용하면 외부 요청에 맞게 데이터 형식으로 변환하고 데이터를 반환해준다.</p>\n<h2>5.2.2 파드 생성</h2>\n<div class=\"gatsby-highlight\" data-language=\"sh\"><pre class=\"language-sh\"><code class=\"language-sh\"><span class=\"token comment\"># 파드 생성</span>\n$ kubectl apply <span class=\"token parameter variable\">-f</span> sample-pod.yaml\npod/sample-pod created\n\n<span class=\"token comment\"># 파드 조회</span>\n$ kubectl get pods\nNAME         READY   STATUS    RESTARTS      AGE\nsample-pod   <span class=\"token number\">1</span>/1     Running   <span class=\"token number\">6</span> <span class=\"token punctuation\">(</span>20m ago<span class=\"token punctuation\">)</span>   12d</code></pre></div>\n<h2>5.2.3 두 개의 컨테이너를 포함한 파드 새엇ㅇ</h2>\n<p>아래의 매니페스트는 nginx와 redis라는 두 개의 컨테이너를 가진 예제이다. redis는 6379/TCP 포트를 바인드한다.</p>\n<div class=\"gatsby-highlight\" data-language=\"yaml\"><pre class=\"language-yaml\"><code class=\"language-yaml\"><span class=\"token key atrule\">apiVersion</span><span class=\"token punctuation\">:</span> v1\n<span class=\"token key atrule\">kind</span><span class=\"token punctuation\">:</span> Pod\n<span class=\"token key atrule\">metadata</span><span class=\"token punctuation\">:</span>\n  <span class=\"token key atrule\">name</span><span class=\"token punctuation\">:</span> sample<span class=\"token punctuation\">-</span>2pod\n<span class=\"token key atrule\">spec</span><span class=\"token punctuation\">:</span>\n  <span class=\"token key atrule\">containers</span><span class=\"token punctuation\">:</span>\n    <span class=\"token punctuation\">-</span> <span class=\"token key atrule\">name</span><span class=\"token punctuation\">:</span> nginx<span class=\"token punctuation\">-</span>container\n      <span class=\"token key atrule\">image</span><span class=\"token punctuation\">:</span> nginx<span class=\"token punctuation\">:</span><span class=\"token number\">1.12</span>\n    <span class=\"token punctuation\">-</span> <span class=\"token key atrule\">name</span><span class=\"token punctuation\">:</span> redis<span class=\"token punctuation\">-</span>container\n      <span class=\"token key atrule\">image</span><span class=\"token punctuation\">:</span> redis<span class=\"token punctuation\">:</span><span class=\"token number\">3.2</span></code></pre></div>\n<div class=\"gatsby-highlight\" data-language=\"sh\"><pre class=\"language-sh\"><code class=\"language-sh\"><span class=\"token comment\"># 파드 생성</span>\n$ kubectl apply <span class=\"token parameter variable\">-f</span> sample-2pod.yaml\npod/sample-2pod created\n\n<span class=\"token comment\"># 두 개의 컨테이너를 포함한 파드 확인</span>\n$ kubetl get pod <span class=\"token parameter variable\">-o</span> wide\nNAME          READY   STATUS    RESTARTS      AGE   IP           NODE                   NOMINATED NODE   READINESS GATES\nsample-2pod   <span class=\"token number\">2</span>/2     Running   <span class=\"token number\">0</span>             65s   <span class=\"token number\">10.244</span>.3.2   kind-cluster-worker    <span class=\"token operator\">&lt;</span>none<span class=\"token operator\">></span>           <span class=\"token operator\">&lt;</span>none<span class=\"token operator\">></span>\nsample-pod    <span class=\"token number\">1</span>/1     Running   <span class=\"token number\">6</span> <span class=\"token punctuation\">(</span>21m ago<span class=\"token punctuation\">)</span>   12d   <span class=\"token number\">10.244</span>.1.2   kind-cluster-worker2   <span class=\"token operator\">&lt;</span>none<span class=\"token operator\">></span>           <span class=\"token operator\">&lt;</span>none<span class=\"token operator\">></span></code></pre></div>\n<p>파드는 네트워크 네임스페이스를 공유하고 있으므로 (같은 IP 내에서 동작하므로), 같은 포트를 여러 개를 동시에 사용할 수 없다. 파드 내에서는 <code class=\"language-text\">containerPort</code>가 충돌하지 않도록 주의해야 한다.</p>\n<h2>5.2.4 컨테이너 로그인과 명령어 실행</h2>\n<p>컨테이너 로그인이란 가상 터미널을 생성(-t)하고, 표준 입력을 패스 스루(-i)하면서 /bin/sh를 실행하면 마치 컨테이너에 SSH로 로그인한 상태가 된다. 실제로 컨테이너에 로그인하여 확인하려면 <code class=\"language-text\">kubectl exec -it (pod명) -c (컨테이너명) -- /bin/bash</code>를 실행해야 한다.</p>\n<div class=\"gatsby-highlight\" data-language=\"sh\"><pre class=\"language-sh\"><code class=\"language-sh\"><span class=\"token comment\"># 컨테이너에 로그인하여 /bin/bash 실행</span>\n$ kubectl <span class=\"token builtin class-name\">exec</span> <span class=\"token parameter variable\">-it</span> sample-pod <span class=\"token parameter variable\">-c</span> nginx-continer -- /bin/bash\n\n<span class=\"token comment\"># 확인 작업에 필요한 패키지 설치</span>\nroot@sample-pod:/<span class=\"token comment\"># (이후부터는 컨테이너 내부에서 명령어 실행 가능)</span>\n$ <span class=\"token function\">apt</span> update <span class=\"token operator\">&amp;&amp;</span> <span class=\"token function\">apt</span> <span class=\"token parameter variable\">-y</span> <span class=\"token function\">install</span> iproute2 procps\n\n<span class=\"token comment\"># 컨테이너 내부에서 IP 주소 확인</span>\n$ <span class=\"token function\">ip</span> a <span class=\"token operator\">|</span> <span class=\"token function\">grep</span> <span class=\"token string\">\"inet \"</span>\n\n<span class=\"token comment\"># 컨테이너 내부에 LISTEM 포트 확인</span>\nss <span class=\"token parameter variable\">-napt</span> <span class=\"token operator\">|</span> <span class=\"token function\">grep</span> LISTEN\n\n<span class=\"token comment\"># 컨테이너 내부 프로세스 확인</span>\n$ <span class=\"token function\">ps</span> aux</code></pre></div>\n<h2>5.2.5 ENTRYPOINT 명령/CMD 명령과 command/args</h2>\n<p>도커 파일로 이미지를 생성할 때는 ENTRYPOINT 명령과 CMD 명령을 사용하여 컨테이너 실행 시 명령어를 정의했다. 쿠버네티스에서는 도커용 용어와 다르게 ENTRYPOINT를 command, CMD를 agrs로 보른다. 컨테이너 실행 시 도커 이미지의 ENTRYPOINT와 CMD를 덮어 쓰기하려면 파드 내용 중 <code class=\"language-text\">spec.containers[].command</code>와 <code class=\"language-text\">spec.containers[].args</code>를 지정한다.</p>\n<p>아래 이미지를 생성해보면, 컨테이너 내부에서 <code class=\"language-text\">/bin/sleep 3600</code>이 실행 중인지 확인해볼 수 있다.</p>\n<div class=\"gatsby-highlight\" data-language=\"yaml\"><pre class=\"language-yaml\"><code class=\"language-yaml\"><span class=\"token key atrule\">apiVersion</span><span class=\"token punctuation\">:</span> v1\n<span class=\"token key atrule\">kind</span><span class=\"token punctuation\">:</span> Pod\n<span class=\"token key atrule\">metadata</span><span class=\"token punctuation\">:</span>\n  <span class=\"token key atrule\">name</span><span class=\"token punctuation\">:</span> sample<span class=\"token punctuation\">-</span>entrypoint\n<span class=\"token key atrule\">spec</span><span class=\"token punctuation\">:</span>\n  <span class=\"token key atrule\">containers</span><span class=\"token punctuation\">:</span>\n    <span class=\"token punctuation\">-</span> <span class=\"token key atrule\">name</span><span class=\"token punctuation\">:</span> nginx<span class=\"token punctuation\">-</span>container<span class=\"token punctuation\">-</span><span class=\"token number\">112</span>\n      <span class=\"token key atrule\">image</span><span class=\"token punctuation\">:</span> nginx<span class=\"token punctuation\">:</span><span class=\"token number\">1.16</span>\n      <span class=\"token key atrule\">command</span><span class=\"token punctuation\">:</span> <span class=\"token punctuation\">[</span><span class=\"token string\">\"/bin/sleep\"</span><span class=\"token punctuation\">]</span> <span class=\"token comment\"># ENTRYPOINT를 대체</span>\n      <span class=\"token key atrule\">args</span><span class=\"token punctuation\">:</span> <span class=\"token punctuation\">[</span><span class=\"token string\">\"3600\"</span><span class=\"token punctuation\">]</span> <span class=\"token comment\"># CMD를 대체</span></code></pre></div>\n<div class=\"gatsby-highlight\" data-language=\"sh\"><pre class=\"language-sh\"><code class=\"language-sh\"><span class=\"token comment\"># 파드 생성</span>\n$ kubectl apply <span class=\"token parameter variable\">-f</span> sample-entrypoint.yaml\npod/sample-entrypoint created\n\n<span class=\"token comment\"># bash 실행</span>\n$ kubectl <span class=\"token builtin class-name\">exec</span> <span class=\"token parameter variable\">-it</span> sample-entrypoint -- /bin/bash\n\n<span class=\"token comment\"># procps 설치</span>\nroot@sample-entrypoint:/<span class=\"token comment\"># apt update &amp;&amp; apt -y install procps</span>\n\n<span class=\"token comment\"># 실행중인 프로세스 확인</span>\nroot@sample-entrypoint:/<span class=\"token comment\"># ps -ef</span>\n<span class=\"token environment constant\">UID</span>          PID    <span class=\"token environment constant\">PPID</span>  C STIME TTY          TIME CMD\nroot           <span class=\"token number\">1</span>       <span class=\"token number\">0</span>  <span class=\"token number\">0</span> 07:15 ?        00:00:00 /bin/sleep <span class=\"token number\">3600</span>\nroot          <span class=\"token number\">10</span>       <span class=\"token number\">0</span>  <span class=\"token number\">0</span> 07:15 pts/0    00:00:00 /bin/bash\nroot         <span class=\"token number\">338</span>      <span class=\"token number\">10</span>  <span class=\"token number\">0</span> 07:16 pts/0    00:00:00 <span class=\"token function\">ps</span> <span class=\"token parameter variable\">-ef</span></code></pre></div>\n<h2>5.2.6 파드명 제한</h2>\n<p>파드명에는 RFC1123의 호스트명 규약을 따른 명명 규칙이 있다.</p>\n<ul>\n<li>이용 가능한 문자는 영문 소문자와 숫자</li>\n<li>이용 가능한 기호는 '-' 또는 '.'</li>\n<li>시작과 끝은 영문 소문자</li>\n</ul>\n<h2>5.2.7 호스트의 네트워크 구성을 사용한 파드 기동</h2>\n<p>쿠버네티스에서 기동한 파드에 할당된 IP 주소는 쿠버네티스 노드의 호스트 IP 주소와 범위가 달라 외부에서 볼 수 없는 IP 주소가 할당된다. 호스트의 네트워크를 사용하는 설정(<code class=\"language-text\">spec.hostNetwork</code>)을 활성화하면 호스트상에서 프로세스를 기동하는 것과 같은 네트워크 구성 (IP 주소, DNS 설정, host 설정 등)으로 파드를 기동시킬 수 있다. <code class=\"language-text\">hostNetwork</code>를 사용한 파드는 쿠버네티스 노드의 IP주소를 사용하는 관계로 포트 번호 충돌을 방지하기 위해 기본적으로 사용하지 않고, 차후 설명할 NodePort 서비스 등으로 해결할 수 있다. 사용할 때는 엣지 환경에서의 사용이나 호스트 측의 네트워크를 감시 또는 제어와 같은 특수 애플리케이션 환경 등에서만 사용하는게 바람직하다.</p>\n<div class=\"gatsby-highlight\" data-language=\"yaml\"><pre class=\"language-yaml\"><code class=\"language-yaml\"><span class=\"token key atrule\">apiVersion</span><span class=\"token punctuation\">:</span> v1\n<span class=\"token key atrule\">kind</span><span class=\"token punctuation\">:</span> Pod\n<span class=\"token key atrule\">metadata</span><span class=\"token punctuation\">:</span>\n  <span class=\"token key atrule\">name</span><span class=\"token punctuation\">:</span> sample<span class=\"token punctuation\">-</span>hostnetwork\n<span class=\"token key atrule\">spec</span><span class=\"token punctuation\">:</span>\n  <span class=\"token key atrule\">hostNetwork</span><span class=\"token punctuation\">:</span> <span class=\"token boolean important\">true</span>\n  <span class=\"token key atrule\">containers</span><span class=\"token punctuation\">:</span>\n  <span class=\"token punctuation\">-</span> <span class=\"token key atrule\">name</span><span class=\"token punctuation\">:</span> nginx<span class=\"token punctuation\">-</span>container\n    <span class=\"token key atrule\">image</span><span class=\"token punctuation\">:</span> nginx<span class=\"token punctuation\">:</span><span class=\"token number\">1.16</span></code></pre></div>\n<div class=\"gatsby-highlight\" data-language=\"sh\"><pre class=\"language-sh\"><code class=\"language-sh\"><span class=\"token comment\"># 파드의 IP 주소 확인</span>\n$ kubectl get pod sample-hostnetwork <span class=\"token parameter variable\">-o</span> wide\nNAME                 READY   STATUS    RESTARTS   AGE   IP           NODE                  NOMINATED NODE   READINESS GATES\nsample-hostnetwork   <span class=\"token number\">1</span>/1     Running   <span class=\"token number\">0</span>          50s   <span class=\"token number\">172.18</span>.0.5   kind-cluster-worker   <span class=\"token operator\">&lt;</span>none<span class=\"token operator\">></span>           <span class=\"token operator\">&lt;</span>none<span class=\"token operator\">></span>\n\n<span class=\"token comment\"># 파드가 기동 중인 노드의 IP 주소 확인</span>\n$ kubectl get <span class=\"token function\">node</span> kind-cluster-worker <span class=\"token parameter variable\">-o</span> wide\nNAME                  STATUS   ROLES    AGE   VERSION   INTERNAL-IP   EXTERNAL-IP   OS-IMAGE       KERNEL-VERSION     CONTAINER-RUNTIME\nkind-cluster-worker   Ready    <span class=\"token operator\">&lt;</span>none<span class=\"token operator\">></span>   14d   v1.24.0   <span class=\"token number\">172.18</span>.0.5    <span class=\"token operator\">&lt;</span>none<span class=\"token operator\">></span>        Ubuntu <span class=\"token number\">21.10</span>   <span class=\"token number\">5.10</span>.76-linuxkit   containerd://1.6.4\n\n<span class=\"token comment\"># 파드의 DNS 설정 확인</span>\n$ kubectl <span class=\"token builtin class-name\">exec</span> <span class=\"token parameter variable\">-it</span> sample-hostnetwork -- <span class=\"token function\">cat</span> /etc/resolv.conf\nnameserver <span class=\"token number\">192.168</span>.65.2\noptions ndots:0</code></pre></div>\n<h2>5.2.8 파드 DNS 설정과 서비스 디스커버리</h2>\n<p>DNS 서버에 관한 설정(<code class=\"language-text\">dnsPolicy</code>)은 파드 정의 <code class=\"language-text\">spec.dnsPolicy</code>에 설정한다. 설정할 수 있는 값은 아래 네 가지이다.</p>\n<table>\n<thead>\n<tr>\n<th>설정값</th>\n<th>개요</th>\n</tr>\n</thead>\n<tbody>\n<tr>\n<td>ClusterFirst(기본값)</td>\n<td>클러스터 내부 DNS에 질의하여 해석되지 않으면 업스트림(upstream)에 질의한다.</td>\n</tr>\n<tr>\n<td>None</td>\n<td>파드 정의 내에서 정적으로 설정한다.</td>\n</tr>\n<tr>\n<td>Default</td>\n<td>파드가 구동하는 쿠버네티스 노드의 /etc/resolv.conf를 상속받는다.</td>\n</tr>\n<tr>\n<td>ClusterFirstWithHostNet</td>\n<td>ClusterFirst의 동작과 같다(hostNetwork 사용 시 설정)</td>\n</tr>\n</tbody>\n</table>\n<h3>ClusterFirst(기본값)</h3>\n<p>일반적으로 파드는 클러스터 내부 DNS를 사용하여 이름을 해석한다. 이는 서비스 디스커버리나 클러스터 내부 로드밸런싱을 위함이다. <code class=\"language-text\">dnsPolicy</code>가 <code class=\"language-text\">ClusterFirst</code>인 경우 클러스터 내부의 DNS 서비스에 질의하고, 클러스터 내부 DNS에서 해석이 안 되는 도메인에 대해서는 업스트림 DNS 서버에 질의한다.</p>\n<div class=\"gatsby-highlight\" data-language=\"yaml\"><pre class=\"language-yaml\"><code class=\"language-yaml\"><span class=\"token key atrule\">apiVersion</span><span class=\"token punctuation\">:</span> v1\n<span class=\"token key atrule\">kind</span><span class=\"token punctuation\">:</span> Pod\n<span class=\"token key atrule\">metadata</span><span class=\"token punctuation\">:</span>\n  <span class=\"token key atrule\">name</span><span class=\"token punctuation\">:</span> sample<span class=\"token punctuation\">-</span>dnspolicy<span class=\"token punctuation\">-</span>clusterfirst\n<span class=\"token key atrule\">spec</span><span class=\"token punctuation\">:</span>\n  <span class=\"token key atrule\">dnsPolicy</span><span class=\"token punctuation\">:</span> ClusterFirst\n  <span class=\"token key atrule\">containers</span><span class=\"token punctuation\">:</span>\n  <span class=\"token punctuation\">-</span> <span class=\"token key atrule\">name</span><span class=\"token punctuation\">:</span> nginx<span class=\"token punctuation\">-</span>container\n    <span class=\"token key atrule\">image</span><span class=\"token punctuation\">:</span> nginx<span class=\"token punctuation\">:</span><span class=\"token number\">1.16</span></code></pre></div>\n<div class=\"gatsby-highlight\" data-language=\"sh\"><pre class=\"language-sh\"><code class=\"language-sh\">$ kubectl apply <span class=\"token parameter variable\">-f</span> sample-dnspolicy-clusterfirst.yaml\npod/sample-dnspolicy-clusterfirst created\n\n$ kubectl <span class=\"token builtin class-name\">exec</span> <span class=\"token parameter variable\">-it</span> sample-dnspolicy-clusterfirst -- <span class=\"token function\">cat</span> /etc/resolv.conf\nsearch default.svc.cluster.local svc.cluster.local cluster.local\nnameserver <span class=\"token number\">10.96</span>.0.10\noptions ndots:5</code></pre></div>\n<h3>None</h3>\n<p>DNS 서버를 수동으로 설정하려면 <code class=\"language-text\">spec.dnsPolicy: None</code>이라고 설정한 후 <code class=\"language-text\">dnsConfig</code>에 설정하고 싶은 값을 작성하면 된다. 정적으로 외부 DNS 서버만 설정하면 클러스터 내부 DNS를 사용한 서비스 디스커버리는 사용할 수 없게 된다.</p>\n<div class=\"gatsby-highlight\" data-language=\"yaml\"><pre class=\"language-yaml\"><code class=\"language-yaml\"><span class=\"token key atrule\">apiVersion</span><span class=\"token punctuation\">:</span> v1\n<span class=\"token key atrule\">kind</span><span class=\"token punctuation\">:</span> Pod\n<span class=\"token key atrule\">metadata</span><span class=\"token punctuation\">:</span>\n  <span class=\"token key atrule\">name</span><span class=\"token punctuation\">:</span> sample<span class=\"token punctuation\">-</span>dnspolicy<span class=\"token punctuation\">-</span>none\n<span class=\"token key atrule\">spec</span><span class=\"token punctuation\">:</span>\n  <span class=\"token key atrule\">dnsPolicy</span><span class=\"token punctuation\">:</span> None\n  <span class=\"token key atrule\">dnsConfig</span><span class=\"token punctuation\">:</span>\n    <span class=\"token key atrule\">nameservers</span><span class=\"token punctuation\">:</span>\n    <span class=\"token punctuation\">-</span> 8.8.8.8\n    <span class=\"token punctuation\">-</span> 8.8.4.4\n    <span class=\"token key atrule\">searches</span><span class=\"token punctuation\">:</span>\n    <span class=\"token punctuation\">-</span> example.com\n    <span class=\"token key atrule\">options</span><span class=\"token punctuation\">:</span>\n    <span class=\"token punctuation\">-</span> <span class=\"token key atrule\">name</span><span class=\"token punctuation\">:</span> ndots\n      <span class=\"token key atrule\">value</span><span class=\"token punctuation\">:</span> <span class=\"token string\">\"5\"</span>\n  <span class=\"token key atrule\">containers</span><span class=\"token punctuation\">:</span>\n  <span class=\"token punctuation\">-</span> <span class=\"token key atrule\">name</span><span class=\"token punctuation\">:</span> nginx<span class=\"token punctuation\">-</span>container\n    <span class=\"token key atrule\">image</span><span class=\"token punctuation\">:</span> nginx<span class=\"token punctuation\">:</span><span class=\"token number\">1.16</span></code></pre></div>\n<div class=\"gatsby-highlight\" data-language=\"sh\"><pre class=\"language-sh\"><code class=\"language-sh\">$ kubectl <span class=\"token builtin class-name\">exec</span> <span class=\"token parameter variable\">-it</span> sample-dnspolicy-none -- <span class=\"token function\">cat</span> /etc/resolv\nsearch example.com\nnameserver <span class=\"token number\">8.8</span>.8.8\nnameserver <span class=\"token number\">8.8</span>.4.4\noptions ndots:5</code></pre></div>\n<h2>Default</h2>\n<p>쿠버네티스 노드의 DNS 설정을 그대로 상속받는 경우 <code class=\"language-text\">spec.dnsPolicy: Default</code>로 설정한다. dnsPolicy의 기본값은 Default가 아니므로 주의하자.</p>\n<div class=\"gatsby-highlight\" data-language=\"yaml\"><pre class=\"language-yaml\"><code class=\"language-yaml\"><span class=\"token key atrule\">apiVersion</span><span class=\"token punctuation\">:</span> v1\n<span class=\"token key atrule\">kind</span><span class=\"token punctuation\">:</span> Pod\n<span class=\"token key atrule\">metadata</span><span class=\"token punctuation\">:</span>\n  <span class=\"token key atrule\">name</span><span class=\"token punctuation\">:</span> sample<span class=\"token punctuation\">-</span>dnspolicy<span class=\"token punctuation\">-</span>default\n<span class=\"token key atrule\">spec</span><span class=\"token punctuation\">:</span>\n  <span class=\"token key atrule\">dnsPolicy</span><span class=\"token punctuation\">:</span> Default\n  <span class=\"token key atrule\">containers</span><span class=\"token punctuation\">:</span>\n  <span class=\"token punctuation\">-</span> <span class=\"token key atrule\">name</span><span class=\"token punctuation\">:</span> nginx<span class=\"token punctuation\">-</span>container\n    <span class=\"token key atrule\">image</span><span class=\"token punctuation\">:</span> nginx<span class=\"token punctuation\">:</span><span class=\"token number\">1.16</span></code></pre></div>\n<div class=\"gatsby-highlight\" data-language=\"sh\"><pre class=\"language-sh\"><code class=\"language-sh\">$ kubectl <span class=\"token builtin class-name\">exec</span> <span class=\"token parameter variable\">-it</span> sample-dnspolicy-none -- <span class=\"token function\">cat</span> /etc/resolv\nnameserver <span class=\"token number\">192.168</span>.65.2\noptions ndots:0</code></pre></div>\n<h3>ClusterFirstWithHostNet</h3>\n<p><code class=\"language-text\">hostNetwork</code>를 사용한 파드에 클러스터 내부의 DNS를 참조하고 싶은 경우에는 <code class=\"language-text\">spec.dnsPolicy: ClusterNetworkWithHostNet</code>을 설정한다. <code class=\"language-text\">hostNetwork</code>를 사용하는 경우 기본값 ClusterFirst의 설정값은 무시되고 쿠버네티스 노드의 네트워크 설정(DNS 설정 포함)이 사용되기 때문에 명시적으로 <code class=\"language-text\">ClusterFirstWithHostNet</code>을 지정하도록 하자.</p>\n<div class=\"gatsby-highlight\" data-language=\"yaml\"><pre class=\"language-yaml\"><code class=\"language-yaml\"><span class=\"token key atrule\">apiVersion</span><span class=\"token punctuation\">:</span> v1\n<span class=\"token key atrule\">kind</span><span class=\"token punctuation\">:</span> Pod\n<span class=\"token key atrule\">metadata</span><span class=\"token punctuation\">:</span>\n  <span class=\"token key atrule\">name</span><span class=\"token punctuation\">:</span> sample<span class=\"token punctuation\">-</span>dnspolicy<span class=\"token punctuation\">-</span>clusterfirstwithhostnet\n<span class=\"token key atrule\">spec</span><span class=\"token punctuation\">:</span>\n  <span class=\"token key atrule\">dnsPolicy</span><span class=\"token punctuation\">:</span> ClusterFirstWithHostNet\n  <span class=\"token key atrule\">hostNetwork</span><span class=\"token punctuation\">:</span> <span class=\"token boolean important\">true</span>\n  <span class=\"token key atrule\">containers</span><span class=\"token punctuation\">:</span>\n  <span class=\"token punctuation\">-</span> <span class=\"token key atrule\">name</span><span class=\"token punctuation\">:</span> nginx<span class=\"token punctuation\">-</span>container\n    <span class=\"token key atrule\">image</span><span class=\"token punctuation\">:</span> nginx<span class=\"token punctuation\">:</span><span class=\"token number\">1.16</span></code></pre></div>\n<div class=\"gatsby-highlight\" data-language=\"sh\"><pre class=\"language-sh\"><code class=\"language-sh\"><span class=\"token comment\"># 경합하는 파드 삭제</span>\n$ kubectl delete pod sample-hostnetwork\n\n<span class=\"token comment\"># 컨테이너 내부의 DNS 설정 파일 </span>\n$ kubectl <span class=\"token builtin class-name\">exec</span> <span class=\"token parameter variable\">-it</span> sample-dnspolicy-clusterfirstwithhostnet -- <span class=\"token function\">cat</span> /etc/resolv.conf\nsearch default.svc.cluster.local svc.cluster.local cluster.local\nnameserver <span class=\"token number\">10.96</span>.0.10\noptions ndots:5</code></pre></div>\n<h2>5.2.9 정적 호스트명 해석 설정: /etc/hosts</h2>\n<p>리눅스 운영체제에서는 DNS로 호스트명을 해석하기 전에 /etc/hosts 파일로 정적 호스트명을 해석한다. 쿠버네티스에서는 파드 내부 모든 컨테이너에 /etc/hosts를 변경하는 기능이 준비되어 있으며 <code class=\"language-text\">spec.Aliases</code>로 지정하여 사용할 수 있다.</p>\n<div class=\"gatsby-highlight\" data-language=\"yaml\"><pre class=\"language-yaml\"><code class=\"language-yaml\"><span class=\"token key atrule\">apiVersion</span><span class=\"token punctuation\">:</span> v1\n<span class=\"token key atrule\">kind</span><span class=\"token punctuation\">:</span> Pod\n<span class=\"token key atrule\">metadata</span><span class=\"token punctuation\">:</span>\n  <span class=\"token key atrule\">name</span><span class=\"token punctuation\">:</span> sample<span class=\"token punctuation\">-</span>hostaliases\n<span class=\"token key atrule\">spec</span><span class=\"token punctuation\">:</span>\n  <span class=\"token key atrule\">containers</span><span class=\"token punctuation\">:</span>\n    <span class=\"token punctuation\">-</span> <span class=\"token key atrule\">name</span><span class=\"token punctuation\">:</span> nginx<span class=\"token punctuation\">-</span>container\n      <span class=\"token key atrule\">image</span><span class=\"token punctuation\">:</span> nginx<span class=\"token punctuation\">:</span><span class=\"token number\">1.12</span>\n  <span class=\"token key atrule\">hostAliases</span><span class=\"token punctuation\">:</span>\n  <span class=\"token punctuation\">-</span> <span class=\"token key atrule\">ip</span><span class=\"token punctuation\">:</span> 8.8.8.8\n    <span class=\"token key atrule\">hostnames</span><span class=\"token punctuation\">:</span>\n    <span class=\"token punctuation\">-</span> google<span class=\"token punctuation\">-</span>dns\n    <span class=\"token punctuation\">-</span> google<span class=\"token punctuation\">-</span>public<span class=\"token punctuation\">-</span>dns</code></pre></div>\n<div class=\"gatsby-highlight\" data-language=\"sh\"><pre class=\"language-sh\"><code class=\"language-sh\">$ kubectl <span class=\"token builtin class-name\">exec</span> <span class=\"token parameter variable\">-it</span> sample-hostaliases -- <span class=\"token function\">cat</span> /etc/hosts\n<span class=\"token comment\"># Kubernetes-managed hosts file.</span>\n<span class=\"token number\">127.0</span>.0.1\tlocalhost\n::1\tlocalhost ip6-localhost ip6-loopback\nfe00::0\tip6-localnet\nfe00::0\tip6-mcastprefix\nfe00::1\tip6-allnodes\nfe00::2\tip6-allrouters\n<span class=\"token number\">10.244</span>.3.5\tsample-hostaliases\n\n<span class=\"token comment\"># Entries added by HostAliases.</span>\n<span class=\"token number\">8.8</span>.8.8\tgoogle-dns\tgoogle-public-dns</code></pre></div>\n<h2>5.2.10 작업 디렉터리 설정</h2>\n<p>컨테이너에서 동작하는 애플리케이션의 작업 디렉터리(Working Directory)는 도커 파일의 WORKDIR 명령 설정을 따르지만, <code class=\"language-text\">spec.containers[].workingDir</code>로 덮어 쓸 수도 있다.</p>\n<div class=\"gatsby-highlight\" data-language=\"yaml\"><pre class=\"language-yaml\"><code class=\"language-yaml\"><span class=\"token key atrule\">apiVersion</span><span class=\"token punctuation\">:</span> v1\n<span class=\"token key atrule\">kind</span><span class=\"token punctuation\">:</span> Pod\n<span class=\"token key atrule\">metadata</span><span class=\"token punctuation\">:</span>\n  <span class=\"token key atrule\">name</span><span class=\"token punctuation\">:</span> sample<span class=\"token punctuation\">-</span>workingdir\n<span class=\"token key atrule\">spec</span><span class=\"token punctuation\">:</span>\n  <span class=\"token key atrule\">containers</span><span class=\"token punctuation\">:</span>\n  <span class=\"token punctuation\">-</span> <span class=\"token key atrule\">name</span><span class=\"token punctuation\">:</span> nginx<span class=\"token punctuation\">-</span>container\n    <span class=\"token key atrule\">image</span><span class=\"token punctuation\">:</span> nginx<span class=\"token punctuation\">:</span><span class=\"token number\">1.16</span>\n    <span class=\"token key atrule\">workingDir</span><span class=\"token punctuation\">:</span> /tmp</code></pre></div>\n<p>실제로 workingDir를 설정한 경우 프로세스가 실행되는 디렉터리가 변경된 것을 확인할 수 있다.</p>\n<div class=\"gatsby-highlight\" data-language=\"sh\"><pre class=\"language-sh\"><code class=\"language-sh\"><span class=\"token comment\"># workingDir: 미지정</span>\n$ kubectl <span class=\"token builtin class-name\">exec</span> it sample-pod -- <span class=\"token builtin class-name\">pwd</span>\n/\n\n<span class=\"token comment\"># workingDir: /tmp로 설정</span>\n$ kubectl <span class=\"token builtin class-name\">exec</span> <span class=\"token parameter variable\">-it</span> sample-workingdir -- <span class=\"token builtin class-name\">pwd</span>\n/tmp</code></pre></div>","frontmatter":{"title":"[쿠버네티스 완벽 가이드] 07. 워크로드 API 카테고리 (1) - 파드(Pod)","date":"August 13, 2022","description":null}},"previous":{"fields":{"slug":"/linux/os/"},"frontmatter":{"title":"[Linux] OS 확인 하는 법"}},"next":{"fields":{"slug":"/kubernetes/kubernetes_5_2/"},"frontmatter":{"title":"[쿠버네티스 완벽 가이드] 08. 워크로드 API 카테고리 (2) - 레플리카셋/레플리케이션 컨트롤러"}}},"pageContext":{"id":"d9f963bc-436a-53a2-8aaf-7ffeae70a471","previousPostId":"24db19aa-2f30-5a32-89b7-39c68a0691f1","nextPostId":"863c8140-4bbd-5d28-b250-91c73e7aacea"}},"staticQueryHashes":["2841359383","3257411868"],"slicesMap":{}}