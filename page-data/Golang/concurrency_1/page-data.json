{"componentChunkName":"component---src-templates-blog-post-js","path":"/Golang/concurrency_1/","result":{"data":{"site":{"siteMetadata":{"title":"Devlog","author":"JonginPark","siteUrl":"https://SiverPineValley.github.io","comment":{"disqusShortName":"","utterances":"SiverPineValley/devlog"},"sponsor":{"buyMeACoffeeId":""}}},"markdownRemark":{"id":"c12afb1d-f1ee-5d1f-ab3c-892768da6ac3","excerpt":"1. 고루틴(goroutine) 이번에는 Go언어에서 지원하는 몇 가지 병행 처리 기법에 대해서 볼 예정이다.\nGo언어의 가장 큰 특징 중 하나인 goroutine이 바로 그러한 기능인데,\n은 Go…","html":"<h2 id=\"1-고루틴goroutine\" style=\"position:relative;\"><a href=\"#1-%EA%B3%A0%EB%A3%A8%ED%8B%B4goroutine\" aria-label=\"1 고루틴goroutine permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>1. 고루틴(goroutine)</h2>\n<p>이번에는 Go언어에서 지원하는 몇 가지 병행 처리 기법에 대해서 볼 예정이다.\nGo언어의 가장 큰 특징 중 하나인 goroutine이 바로 그러한 기능인데,\n<code class=\"language-text\">고루틴(goroutine)</code>은 Go 프로그램 안에서 동시에 독립적으로 실행되는 흐름의 단위로, 스레드와 비슷한 개념이다.\n하지만, 스레드와 달리 고루틴은 수 킬로바이트 정도의 아주 작은 리소스에서 동작하므로 한 프로세스에 수천, 수만 개의 고루틴을 동작시킬 수 있다.\n고루틴은 정보를 공유하는 방식이 아니라 메시지를 서로 주고받는 방식으로 동작한다.\n그래서 Lock으로 공유 메모리를 관리할 필요가 없고 구현도 어렵지 않다.\n아래와 같이 go 키워드로 함수를 실행하면 새 고루틴이 만들어진다.</p>\n<div class=\"gatsby-highlight\" data-language=\"go\"><pre class=\"language-go\"><code class=\"language-go\"><span class=\"token keyword\">func</span> <span class=\"token function\">long</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n\tfmt<span class=\"token punctuation\">.</span><span class=\"token function\">Println</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"long 함수 시작\"</span><span class=\"token punctuation\">,</span> time<span class=\"token punctuation\">.</span><span class=\"token function\">Now</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span>\n\ttime<span class=\"token punctuation\">.</span><span class=\"token function\">Sleep</span><span class=\"token punctuation\">(</span><span class=\"token number\">3</span> <span class=\"token operator\">*</span> time<span class=\"token punctuation\">.</span>Second<span class=\"token punctuation\">)</span>\n\tfmt<span class=\"token punctuation\">.</span><span class=\"token function\">Println</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"long 함수 종료\"</span><span class=\"token punctuation\">,</span> time<span class=\"token punctuation\">.</span><span class=\"token function\">Now</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span>\n<span class=\"token punctuation\">}</span>\n\n<span class=\"token keyword\">func</span> <span class=\"token function\">short</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n\tfmt<span class=\"token punctuation\">.</span><span class=\"token function\">Println</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"short 함수 시작\"</span><span class=\"token punctuation\">,</span> time<span class=\"token punctuation\">.</span><span class=\"token function\">Now</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span>\n\ttime<span class=\"token punctuation\">.</span><span class=\"token function\">Sleep</span><span class=\"token punctuation\">(</span><span class=\"token number\">1</span> <span class=\"token operator\">*</span> time<span class=\"token punctuation\">.</span>Second<span class=\"token punctuation\">)</span>\n\tfmt<span class=\"token punctuation\">.</span><span class=\"token function\">Println</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"short 함수 종료\"</span><span class=\"token punctuation\">,</span> time<span class=\"token punctuation\">.</span><span class=\"token function\">Now</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span>\n<span class=\"token punctuation\">}</span>\n\n<span class=\"token keyword\">func</span> <span class=\"token function\">main</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n\tfmt<span class=\"token punctuation\">.</span><span class=\"token function\">Println</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"main 함수 시작: \"</span><span class=\"token punctuation\">,</span> time<span class=\"token punctuation\">.</span><span class=\"token function\">Now</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span>\n\n\t<span class=\"token keyword\">go</span> <span class=\"token function\">long</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span>\n\t<span class=\"token keyword\">go</span> <span class=\"token function\">short</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span>\n\n\ttime<span class=\"token punctuation\">.</span><span class=\"token function\">Sleep</span><span class=\"token punctuation\">(</span><span class=\"token number\">5</span> <span class=\"token operator\">*</span> time<span class=\"token punctuation\">.</span>Second<span class=\"token punctuation\">)</span>\n\tfmt<span class=\"token punctuation\">.</span><span class=\"token function\">Println</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"main 함수 종료: \"</span><span class=\"token punctuation\">,</span> time<span class=\"token punctuation\">.</span><span class=\"token function\">Now</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span>\n<span class=\"token punctuation\">}</span></code></pre></div>\n<p>결과</p>\n<div class=\"gatsby-highlight\" data-language=\"text\"><pre class=\"language-text\"><code class=\"language-text\">main 함수 시작:  2022-03-01 21:12:30.7620499 +0900 KST m=+1.809606901\nshort 함수 시작 2022-03-01 21:12:30.847062 +0900 KST m=+1.894619001\nlong 함수 시작 2022-03-01 21:12:30.847062 +0900 KST m=+1.894619001\nshort 함수 종료 2022-03-01 21:12:31.8491954 +0900 KST m=+2.896752401\nlong 함수 종료 2022-03-01 21:12:33.8548548 +0900 KST m=+4.902411801\nmain 함수 종료:  2022-03-01 21:12:35.847659 +0900 KST m=+6.895216001</code></pre></div>\n<p>메인 함수 안에서 long과 short 함수는 go 키워드로 호출되고, 두 함수는 각각 새 고루틴을 생성하며 동시에 시작한다.\n각 함수에서는 시작과 종료 시 메시지를 출력하게 하여 실행 시점과 종료 시점을 알 수 있게 했다.</p>\n<p>고루틴을 사용할 때 주의할 점이 있다. 실행 중인 고루틴이 있어도 메인 함수가 종료되면 프로그램이 종료된다.\n그래서 아직 실행 중인 고루틴이 있다면 메인 함수가 종료되지 않게 해야 한다. 따라서 예시의 main 함수에서는 대기 시간을 잡아 놨다.\n이와 같이 비정상적으로 종료되는 것을 막기 위해 메인 함수에서 충분히 긴 시간을 대기하는 것은 효율적이지 않다.\nGo에서 제안하는 방법은 메인 함수에서 고루틴의 종료 시점을 확인할 수 있는 채널을 만들고, 만든 채널을 통해 종료 메시지를 대기시키는 것이다.</p>\n<h2 id=\"2-채널channel\" style=\"position:relative;\"><a href=\"#2-%EC%B1%84%EB%84%90channel\" aria-label=\"2 채널channel permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>2. 채널(Channel)</h2>\n<p><code class=\"language-text\">채널(channel)</code>은 고루틴끼리의 정보를 교환하고 실행의 흐름을 동기화하기 위해 사용된다.\n채널은 일반 변수를 선언하는 것과 똑같이 선언하고, <code class=\"language-text\">make()</code> 함수로 생성한다.\n채널을 정의할 때는 <code class=\"language-text\">chan</code> 키워드로 채널을 통해 주고받을 데이터의 타입을 지정해주어야 한다.</p>\n<div class=\"gatsby-highlight\" data-language=\"go\"><pre class=\"language-go\"><code class=\"language-go\"><span class=\"token comment\">// 채널 변수 선언 후 make() 함수로 채널 생성</span>\n<span class=\"token keyword\">var</span> ch <span class=\"token keyword\">chan</span> <span class=\"token builtin\">string</span>\nch <span class=\"token operator\">=</span> <span class=\"token function\">make</span><span class=\"token punctuation\">(</span><span class=\"token keyword\">chan</span> <span class=\"token builtin\">string</span><span class=\"token punctuation\">)</span>\n\n<span class=\"token comment\">// make() 함수로 채널 생성 후 바로 변수에 할당</span>\ndone <span class=\"token operator\">:=</span> <span class=\"token function\">make</span><span class=\"token punctuation\">(</span><span class=\"token keyword\">chan</span> <span class=\"token builtin\">bool</span><span class=\"token punctuation\">)</span></code></pre></div>\n<p>채널을 정의할 때 지정한 데이터 타입만 채널을 통해 주고받을 수 있다. 타입에 상관없이 받으려면 <code class=\"language-text\">chan interface{}</code> 처럼 타입을 지정하면 된다.\n채널로 값을 주고받을 때는 <code class=\"language-text\">&lt;-</code> 연산자를 사용한다.\n<code class=\"language-text\">&lt;-</code> 를 채널 변수 오른쪽에 작성하면 채널에 값을 전송하고, <code class=\"language-text\">&lt;-</code>를 채널 변수 왼쪽에 작성하면 채널로부터 값을 수신한다.\n채널에 값을 전송하거나 수신할 때 채널이 준비되어 있지 않으면 준비될때 까지 대기한다.</p>\n<div class=\"gatsby-highlight\" data-language=\"go\"><pre class=\"language-go\"><code class=\"language-go\">ch <span class=\"token operator\">&lt;-</span> <span class=\"token string\">\"msg\"</span> <span class=\"token comment\">// ch 채널에 \"msg\" 전송</span>\nm <span class=\"token operator\">:=</span> <span class=\"token operator\">&lt;-</span> ch  <span class=\"token comment\">// ch 채널로부터 메시지 수신</span></code></pre></div>\n<p>고루틴 예시를 채널을 통해 아래와 같이 구현 가능하다.</p>\n<div class=\"gatsby-highlight\" data-language=\"go\"><pre class=\"language-go\"><code class=\"language-go\"><span class=\"token keyword\">func</span> <span class=\"token function\">long</span><span class=\"token punctuation\">(</span>done <span class=\"token keyword\">chan</span> <span class=\"token builtin\">bool</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n\tfmt<span class=\"token punctuation\">.</span><span class=\"token function\">Println</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"long 함수 시작\"</span><span class=\"token punctuation\">,</span> time<span class=\"token punctuation\">.</span><span class=\"token function\">Now</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span>\n\ttime<span class=\"token punctuation\">.</span><span class=\"token function\">Sleep</span><span class=\"token punctuation\">(</span><span class=\"token number\">3</span> <span class=\"token operator\">*</span> time<span class=\"token punctuation\">.</span>Second<span class=\"token punctuation\">)</span>\n\tfmt<span class=\"token punctuation\">.</span><span class=\"token function\">Println</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"long 함수 종료\"</span><span class=\"token punctuation\">,</span> time<span class=\"token punctuation\">.</span><span class=\"token function\">Now</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span>\n\tdone <span class=\"token operator\">&lt;-</span> <span class=\"token boolean\">true</span>\n<span class=\"token punctuation\">}</span>\n\n<span class=\"token keyword\">func</span> <span class=\"token function\">short</span><span class=\"token punctuation\">(</span>done <span class=\"token keyword\">chan</span> <span class=\"token builtin\">bool</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n\tfmt<span class=\"token punctuation\">.</span><span class=\"token function\">Println</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"short 함수 시작\"</span><span class=\"token punctuation\">,</span> time<span class=\"token punctuation\">.</span><span class=\"token function\">Now</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span>\n\ttime<span class=\"token punctuation\">.</span><span class=\"token function\">Sleep</span><span class=\"token punctuation\">(</span><span class=\"token number\">1</span> <span class=\"token operator\">*</span> time<span class=\"token punctuation\">.</span>Second<span class=\"token punctuation\">)</span>\n\tfmt<span class=\"token punctuation\">.</span><span class=\"token function\">Println</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"short 함수 종료\"</span><span class=\"token punctuation\">,</span> time<span class=\"token punctuation\">.</span><span class=\"token function\">Now</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span>\n\tdone <span class=\"token operator\">&lt;-</span> <span class=\"token boolean\">true</span>\n<span class=\"token punctuation\">}</span>\n\n<span class=\"token keyword\">func</span> <span class=\"token function\">main</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n\tfmt<span class=\"token punctuation\">.</span><span class=\"token function\">Println</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"main 함수 시작: \"</span><span class=\"token punctuation\">,</span> time<span class=\"token punctuation\">.</span><span class=\"token function\">Now</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span>\n\n\tdone <span class=\"token operator\">:=</span> <span class=\"token function\">make</span><span class=\"token punctuation\">(</span><span class=\"token keyword\">chan</span> <span class=\"token builtin\">bool</span><span class=\"token punctuation\">)</span>\n\t<span class=\"token keyword\">go</span> <span class=\"token function\">long</span><span class=\"token punctuation\">(</span>done<span class=\"token punctuation\">)</span>\n\t<span class=\"token keyword\">go</span> <span class=\"token function\">short</span><span class=\"token punctuation\">(</span>done<span class=\"token punctuation\">)</span>\n\n\t<span class=\"token operator\">&lt;-</span>done\n\t<span class=\"token operator\">&lt;-</span>done\n\tfmt<span class=\"token punctuation\">.</span><span class=\"token function\">Println</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"main 함수 종료: \"</span><span class=\"token punctuation\">,</span> time<span class=\"token punctuation\">.</span><span class=\"token function\">Now</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span>\n<span class=\"token punctuation\">}</span></code></pre></div>\n<p>결과</p>\n<div class=\"gatsby-highlight\" data-language=\"text\"><pre class=\"language-text\"><code class=\"language-text\">main 함수 시작:  2022-03-01 21:12:30.7620499 +0900 KST m=+1.809606901\nshort 함수 시작 2022-03-01 21:12:30.847062 +0900 KST m=+1.894619001\nlong 함수 시작 2022-03-01 21:12:30.847062 +0900 KST m=+1.894619001\nshort 함수 종료 2022-03-01 21:12:31.8491954 +0900 KST m=+2.896752401\nlong 함수 종료 2022-03-01 21:12:33.8548548 +0900 KST m=+4.902411801\nmain 함수 종료:  2022-03-01 21:12:35.847659 +0900 KST m=+6.895216001</code></pre></div>\n<p>함수로 done 채널을 전달하고, 각 함수에서는 처리를 완료한 후 done 채널로 완료 메시지를 전달한다.\n메인 함수에서는 done 채널로부터 메시지를 전달받고 프로그램을 종료한다.</p>\n<h2 id=\"3-채널-방향\" style=\"position:relative;\"><a href=\"#3-%EC%B1%84%EB%84%90-%EB%B0%A9%ED%96%A5\" aria-label=\"3 채널 방향 permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>3. 채널 방향</h2>\n<p>채널은 기본적으로 양방향 통신이 가능하다. 하나의 채널로 값을 송수신할 수 있지만, 실제로 채널을 구조체 필드로 사용하거나 함수의 매개변수로 전달하는 것이 일반적이다.\n이때는 채널이 대부분 단방향으로만 사용된다. 채널을 단방향으로만 사용할때는 아래와 같이 방향을 지정해 사용할 수 있다.</p>\n<div class=\"gatsby-highlight\" data-language=\"go\"><pre class=\"language-go\"><code class=\"language-go\"><span class=\"token keyword\">chan</span><span class=\"token operator\">&lt;-</span> <span class=\"token builtin\">string</span> <span class=\"token comment\">// 송신 전용 채널</span>\n<span class=\"token operator\">&lt;-</span><span class=\"token keyword\">chan</span> <span class=\"token builtin\">string</span> <span class=\"token comment\">// 수신 전용 채널</span></code></pre></div>\n<p>수신 전용 채널에 값을 전달하려고 하거나 송신 채널로부터 값을 수신하려고 하면 컴파일 오류가 발생한다.</p>\n<h2 id=\"4-버퍼드-채널\" style=\"position:relative;\"><a href=\"#4-%EB%B2%84%ED%8D%BC%EB%93%9C-%EC%B1%84%EB%84%90\" aria-label=\"4 버퍼드 채널 permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>4. 버퍼드 채널</h2>\n<p>채널은 지정한 크기의 버퍼를 가질 수 있다. 채널을 생성할 때 버퍼의 크기를 make의 두 번째 매개변수로 전달하면 버퍼드 채널(buffered channel)을 만들 수 있다.\n버퍼드 채널은 비동기 방식으로 동작한다. 채널이 꽉 찰 때까지 채널로 메시지를 계속 전송할 수 있고, 채널이 빌 때까지 채널로부터 메시지를 계속 수신할 수 있다.</p>\n<div class=\"gatsby-highlight\" data-language=\"go\"><pre class=\"language-go\"><code class=\"language-go\">ch <span class=\"token operator\">:=</span> <span class=\"token function\">make</span><span class=\"token punctuation\">(</span><span class=\"token keyword\">chan</span> <span class=\"token builtin\">int</span><span class=\"token punctuation\">,</span> <span class=\"token number\">100</span><span class=\"token punctuation\">)</span></code></pre></div>\n<p>아래 코드는 버퍼가 꽉 찼는데도 메시지를 계속 전송해서 다음과 같은 에러가 발생한다.</p>\n<div class=\"gatsby-highlight\" data-language=\"go\"><pre class=\"language-go\"><code class=\"language-go\"><span class=\"token keyword\">package</span> main\n\n<span class=\"token keyword\">import</span> <span class=\"token string\">\"fmt\"</span>\n\n<span class=\"token keyword\">func</span> <span class=\"token function\">main</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n\tc <span class=\"token operator\">:=</span> <span class=\"token function\">make</span><span class=\"token punctuation\">(</span><span class=\"token keyword\">chan</span> <span class=\"token builtin\">int</span><span class=\"token punctuation\">,</span> <span class=\"token number\">2</span><span class=\"token punctuation\">)</span>\n\tc <span class=\"token operator\">&lt;-</span> <span class=\"token number\">1</span>\n\tc <span class=\"token operator\">&lt;-</span> <span class=\"token number\">2</span>\n\tc <span class=\"token operator\">&lt;-</span> <span class=\"token number\">3</span>\n\tfmt<span class=\"token punctuation\">.</span><span class=\"token function\">Println</span><span class=\"token punctuation\">(</span><span class=\"token operator\">&lt;-</span>c<span class=\"token punctuation\">)</span>\n\tfmt<span class=\"token punctuation\">.</span><span class=\"token function\">Println</span><span class=\"token punctuation\">(</span><span class=\"token operator\">&lt;-</span>c<span class=\"token punctuation\">)</span>\n\tfmt<span class=\"token punctuation\">.</span><span class=\"token function\">Println</span><span class=\"token punctuation\">(</span><span class=\"token operator\">&lt;-</span>c<span class=\"token punctuation\">)</span>\n<span class=\"token punctuation\">}</span></code></pre></div>\n<div class=\"gatsby-highlight\" data-language=\"text\"><pre class=\"language-text\"><code class=\"language-text\">fatal error: all goroutines are asleep - deadlock!</code></pre></div>\n<p>코드를 다음과 같이 수정하면 고루틴에서 채널 c에 전송할 수 있을 때까지 대기하다가, 첫 번째 값을 수신해가는 즉시 바로 채널에 값을 전송한다.</p>\n<div class=\"gatsby-highlight\" data-language=\"go\"><pre class=\"language-go\"><code class=\"language-go\"><span class=\"token keyword\">package</span> main\n\n<span class=\"token keyword\">import</span> <span class=\"token string\">\"fmt\"</span>\n\n<span class=\"token keyword\">func</span> <span class=\"token function\">main</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n\tc <span class=\"token operator\">:=</span> <span class=\"token function\">make</span><span class=\"token punctuation\">(</span><span class=\"token keyword\">chan</span> <span class=\"token builtin\">int</span><span class=\"token punctuation\">,</span> <span class=\"token number\">2</span><span class=\"token punctuation\">)</span>\n\tc <span class=\"token operator\">&lt;-</span> <span class=\"token number\">1</span>\n\tc <span class=\"token operator\">&lt;-</span> <span class=\"token number\">2</span>\n\t<span class=\"token keyword\">go</span> <span class=\"token keyword\">func</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span> c <span class=\"token operator\">&lt;-</span> <span class=\"token number\">3</span> <span class=\"token punctuation\">}</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span>\n\tfmt<span class=\"token punctuation\">.</span><span class=\"token function\">Println</span><span class=\"token punctuation\">(</span><span class=\"token operator\">&lt;-</span>c<span class=\"token punctuation\">)</span>\n\tfmt<span class=\"token punctuation\">.</span><span class=\"token function\">Println</span><span class=\"token punctuation\">(</span><span class=\"token operator\">&lt;-</span>c<span class=\"token punctuation\">)</span>\n\tfmt<span class=\"token punctuation\">.</span><span class=\"token function\">Println</span><span class=\"token punctuation\">(</span><span class=\"token operator\">&lt;-</span>c<span class=\"token punctuation\">)</span>\n<span class=\"token punctuation\">}</span></code></pre></div>\n<h2 id=\"5-close--range\" style=\"position:relative;\"><a href=\"#5-close--range\" aria-label=\"5 close  range permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>5. close &#x26; range</h2>\n<p>채널에 더 이상 전송할 값이 없으면 <code class=\"language-text\">close(ch)</code>를 사용해서 채널을 닫을 수 있다. 채널을 닫은 후 메시지를 전송하면 에러가 발생한다.\n채널의 수신자는 채널에서 값을 읽을 때 채널이 닫힌 상태인지 아닌지는 두 번째 매개변수로 확인 가능하다.</p>\n<div class=\"gatsby-highlight\" data-language=\"go\"><pre class=\"language-go\"><code class=\"language-go\">v<span class=\"token punctuation\">,</span> ok <span class=\"token operator\">:=</span> <span class=\"token operator\">&lt;-</span>ch</code></pre></div>\n<p>ok의 값이 false라면 채널에 더 수신할 값이 없고 채널이 닫힌 상태이다.\n<code class=\"language-text\">for i := range c</code> 는 채널 c가 닫힐 때까지 반복하여 채널로부터 수신을 시도한다.\n채널을 꼭 닫을 필요는 없지만, range 루프를 돌며 채널에 수신할 값이 없는 것을 알아야 할 때는 채널을 닫아주면 된다.</p>\n<h2 id=\"6-select\" style=\"position:relative;\"><a href=\"#6-select\" aria-label=\"6 select permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>6. select</h2>\n<p>select는 하나의 고루틴이 여러 채널과 통신할 때 사용한다. case로 여러 채널을 대기시키고 있다가 실행 가능한 상태가 되면 해당 케이스를 수행한다.\nselect 문에서 default 케이스는 case에 지정된 모든 채널이 사용 가능 상태가 아닐 때 수행한다.\ndefault 케이스는 select 문에서 case의 채널들이 사용 가능 상태가 아닐 때 대기하지 않고 바로 무언가를 처리할 때 사용한다.</p>\n<div class=\"gatsby-highlight\" data-language=\"go\"><pre class=\"language-go\"><code class=\"language-go\"><span class=\"token keyword\">func</span> <span class=\"token function\">fibonacci</span><span class=\"token punctuation\">(</span>c<span class=\"token punctuation\">,</span> quit <span class=\"token keyword\">chan</span> <span class=\"token builtin\">int</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n\tx<span class=\"token punctuation\">,</span> y <span class=\"token operator\">:=</span> <span class=\"token number\">0</span><span class=\"token punctuation\">,</span> <span class=\"token number\">1</span>\n\t<span class=\"token keyword\">for</span> <span class=\"token punctuation\">{</span>\n\t\t<span class=\"token keyword\">select</span> <span class=\"token punctuation\">{</span>\n\t\t<span class=\"token keyword\">case</span> c <span class=\"token operator\">&lt;-</span> x<span class=\"token punctuation\">:</span>\n\t\t\tx<span class=\"token punctuation\">,</span> y <span class=\"token operator\">=</span> y<span class=\"token punctuation\">,</span> x<span class=\"token operator\">+</span>y\n\t\t<span class=\"token keyword\">case</span> <span class=\"token operator\">&lt;-</span>quit<span class=\"token punctuation\">:</span>\n\t\t\tfmt<span class=\"token punctuation\">.</span><span class=\"token function\">Println</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"quit\"</span><span class=\"token punctuation\">)</span>\n\t\t\t<span class=\"token keyword\">return</span>\n\t\t<span class=\"token punctuation\">}</span>\n\t<span class=\"token punctuation\">}</span>\n\n<span class=\"token punctuation\">}</span>\n\n<span class=\"token keyword\">func</span> <span class=\"token function\">main</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n\tc <span class=\"token operator\">:=</span> <span class=\"token function\">make</span><span class=\"token punctuation\">(</span><span class=\"token keyword\">chan</span> <span class=\"token builtin\">int</span><span class=\"token punctuation\">)</span>\n\tquit <span class=\"token operator\">:=</span> <span class=\"token function\">make</span><span class=\"token punctuation\">(</span><span class=\"token keyword\">chan</span> <span class=\"token builtin\">int</span><span class=\"token punctuation\">)</span>\n\t<span class=\"token keyword\">go</span> <span class=\"token keyword\">func</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n\t\t<span class=\"token keyword\">for</span> i <span class=\"token operator\">:=</span> <span class=\"token number\">0</span><span class=\"token punctuation\">;</span> i <span class=\"token operator\">&lt;</span> <span class=\"token number\">10</span><span class=\"token punctuation\">;</span> i<span class=\"token operator\">++</span> <span class=\"token punctuation\">{</span>\n\t\t\tfmt<span class=\"token punctuation\">.</span><span class=\"token function\">Println</span><span class=\"token punctuation\">(</span><span class=\"token operator\">&lt;-</span>c<span class=\"token punctuation\">)</span>\n\t\t<span class=\"token punctuation\">}</span>\n\t\tquit <span class=\"token operator\">&lt;-</span> <span class=\"token number\">0</span>\n\t<span class=\"token punctuation\">}</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span>\n\t<span class=\"token function\">fibonacci</span><span class=\"token punctuation\">(</span>c<span class=\"token punctuation\">,</span> quit<span class=\"token punctuation\">)</span>\n<span class=\"token punctuation\">}</span></code></pre></div>\n<p>고루틴과 채널은 기본적으로 동기식으로 동작하는 go언어에서 비동기 동작을 지원하는 아주 좋은 도구이다.\n사용법도 간편하고 다른 저수준 제어에 비해 제어도 쉽다.</p>","frontmatter":{"title":"[Go 언어 문법 정리] 04. 병행 처리 (1) 고루틴과 채널","date":"April 02, 2022"}}},"pageContext":{"slug":"/Golang/concurrency_1/","previous":{"fields":{"slug":"/Golang/basic_grammer/"},"frontmatter":{"title":"[Go 언어 문법 정리] 01. 기초 문법"}},"next":{"fields":{"slug":"/Golang/concurrency_2/"},"frontmatter":{"title":"[Go 언어 문법 정리] 04. 병행 처리 (2) 저수준 제어"}}}},"staticQueryHashes":["3128451518","643154061"],"slicesMap":{}}