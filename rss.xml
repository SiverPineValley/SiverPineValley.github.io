<?xml version="1.0" encoding="UTF-8"?><rss xmlns:dc="http://purl.org/dc/elements/1.1/" xmlns:content="http://purl.org/rss/1.0/modules/content/" xmlns:atom="http://www.w3.org/2005/Atom" version="2.0"><channel><title><![CDATA[Gatsby Starter Blog RSS Feed]]></title><description><![CDATA[A starter blog demonstrating what Gatsby can do.]]></description><link>https://github.com/SiverPineValley/SiverPineValley.github.io</link><generator>GatsbyJS</generator><lastBuildDate>Thu, 30 Jan 2025 12:22:58 GMT</lastBuildDate><item><title><![CDATA[4-2) 토픽을 생성하는 두 가지 방법]]></title><description><![CDATA[Kafka에서 토픽을 생성하는 방법에는 두 가지 방법이 있다. 첫 번째로 kafka-topics.sh 와 같은 CLI…]]></description><link>https://github.com/SiverPineValley/SiverPineValley.github.io/kafka/kafka_4_2/</link><guid isPermaLink="false">https://github.com/SiverPineValley/SiverPineValley.github.io/kafka/kafka_4_2/</guid><pubDate>Mon, 23 Dec 2024 23:00:00 GMT</pubDate><content:encoded>&lt;ul&gt;
&lt;li&gt;
&lt;p&gt;Kafka에서 토픽을 생성하는 방법에는 두 가지 방법이 있다. 첫 번째로 kafka-topics.sh 와 같은 CLI툴을 사용하여 명시적으로 생성하는 방법이다. 토픽을 효과적으로 유지보수하기 위해 추천되는 방법이다. 두 번 째로는 컨슈머나 프로듀서가 카프카 브로커에 생성되지 않은 토픽에 대한 데이터를 요청할 때이다.&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;두 번째 방법에 대한 옵션이 바로 &lt;code class=&quot;language-text&quot;&gt;auto.create.topics.enable=true&lt;/code&gt; 이다. 이 값은 true가 default인데, false로 설정하면 토픽이 자동 생성되지 않는다.&lt;/p&gt;
&lt;/li&gt;
&lt;/ul&gt;</content:encoded></item><item><title><![CDATA[4-1) 카프카 CLI 툴 소개]]></title><description><![CDATA[Kafka CLI…]]></description><link>https://github.com/SiverPineValley/SiverPineValley.github.io/kafka/kafka_4_1/</link><guid isPermaLink="false">https://github.com/SiverPineValley/SiverPineValley.github.io/kafka/kafka_4_1/</guid><pubDate>Mon, 23 Dec 2024 22:45:00 GMT</pubDate><content:encoded>&lt;ul&gt;
&lt;li&gt;&lt;strong&gt;Kafka CLI&lt;/strong&gt;: 카프카를 운영할 때 가장 많이 접하는 도구로, 카프카 브로커 운영에 필요한 다양한 명령을 내릴 수 있다. 카프카 클라이언트 애플리케이션을 운영할 때는 카프카 클러스터와 연동하여 데이터를 주고받는 것도 중요하지만 토픽이나 파티션 변경과 같은 명령을 실행할 경우도 많이 발생한다. 그렇기 때문에 카프카 커맨드 라인 툴과 각 툴별 옵션에 대해서도 알고 있어야 한다.&lt;/li&gt;
&lt;li&gt;&lt;code class=&quot;language-text&quot;&gt;zookeeper&lt;/code&gt; 실행&lt;/li&gt;
&lt;/ul&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;sh&quot;&gt;&lt;pre class=&quot;language-sh&quot;&gt;&lt;code class=&quot;language-sh&quot;&gt;bin/zookeeper-server-start.sh config/zookeeper.properties&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;ul&gt;
&lt;li&gt;Kafka Broker 실행&lt;/li&gt;
&lt;/ul&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;sh&quot;&gt;&lt;pre class=&quot;language-sh&quot;&gt;&lt;code class=&quot;language-sh&quot;&gt;bin/kafka-server-start.sh config/server.properties&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;ul&gt;
&lt;li&gt;Kafka Broker API Version 체크&lt;/li&gt;
&lt;/ul&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;sh&quot;&gt;&lt;pre class=&quot;language-sh&quot;&gt;&lt;code class=&quot;language-sh&quot;&gt;bin/kafka-broker-api-versions.sh --bootstrap-server localhost:9092&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;ul&gt;
&lt;li&gt;Kafka 생성 토픽 확인&lt;/li&gt;
&lt;/ul&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;sh&quot;&gt;&lt;pre class=&quot;language-sh&quot;&gt;&lt;code class=&quot;language-sh&quot;&gt;bin/kafka-topics.sh --bootstrap-server localhost:9092 &lt;span class=&quot;token parameter variable&quot;&gt;--list&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;/br&gt;
&lt;h2&gt;4-1-1) kafka-topics.sh&lt;/h2&gt;
&lt;ul&gt;
&lt;li&gt;토픽을 생성하기 위해서는 &lt;code class=&quot;language-text&quot;&gt;Kafka 클러스터 정보&lt;/code&gt;와 &lt;code class=&quot;language-text&quot;&gt;토픽 이름&lt;/code&gt;을 알고 있어야 한다. 두 값은 토픽을 만들기 위한 필수 값이다. 이렇게 만들어진 토픽은 파티션 개수, 복제 개수 등과 같은 다양한 옵션이 포함되어 있지만 모두 브로커의 기본값으로 생성된다.&lt;/li&gt;
&lt;li&gt;토픽의 설정을 변경하는 것은 가능하나, partition 개수를 줄이는 것은 불가능하다.&lt;/li&gt;
&lt;/ul&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;sh&quot;&gt;&lt;pre class=&quot;language-sh&quot;&gt;&lt;code class=&quot;language-sh&quot;&gt;&lt;span class=&quot;token comment&quot;&gt;# Kafka 토픽 생성 (--create)&lt;/span&gt;
./kafka-topics.sh &lt;span class=&quot;token parameter variable&quot;&gt;--create&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;\&lt;/span&gt;
--bootstrap-server my-kafka:9092 &lt;span class=&quot;token punctuation&quot;&gt;\&lt;/span&gt;
&lt;span class=&quot;token parameter variable&quot;&gt;--partitions&lt;/span&gt; &lt;span class=&quot;token number&quot;&gt;10&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;\&lt;/span&gt;
--replication-factor &lt;span class=&quot;token number&quot;&gt;1&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;\&lt;/span&gt;
&lt;span class=&quot;token parameter variable&quot;&gt;--config&lt;/span&gt; &lt;span class=&quot;token assign-left variable&quot;&gt;retention.ms&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;token number&quot;&gt;172800000&lt;/span&gt;
&lt;span class=&quot;token parameter variable&quot;&gt;--topic&lt;/span&gt; hello.kafka

&lt;span class=&quot;token comment&quot;&gt;# Kafka 토픽 설명 (--describe)&lt;/span&gt;
./kafka-topics.sh --bootstrap-server my-kafka:9092 &lt;span class=&quot;token punctuation&quot;&gt;\&lt;/span&gt;
&lt;span class=&quot;token parameter variable&quot;&gt;--topic&lt;/span&gt; hello.kafka
&lt;span class=&quot;token parameter variable&quot;&gt;--describe&lt;/span&gt;

&lt;span class=&quot;token comment&quot;&gt;# Kafka 토픽 옵션 변경 (--alter)&lt;/span&gt;
./kafka-topics.sh --bootstrap-server my-kafka:9092 &lt;span class=&quot;token punctuation&quot;&gt;\&lt;/span&gt;
&lt;span class=&quot;token parameter variable&quot;&gt;--topic&lt;/span&gt; hello.kafka
&lt;span class=&quot;token parameter variable&quot;&gt;--alter&lt;/span&gt; &lt;span class=&quot;token parameter variable&quot;&gt;--partitions&lt;/span&gt; &lt;span class=&quot;token number&quot;&gt;12&lt;/span&gt;

&lt;span class=&quot;token comment&quot;&gt;# Kafka 토픽 삭제&lt;/span&gt;
./kafka-topics.sh &lt;span class=&quot;token parameter variable&quot;&gt;--delete&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;\&lt;/span&gt;
--bootstrap-server my-kafka:9092 &lt;span class=&quot;token punctuation&quot;&gt;\&lt;/span&gt;
&lt;span class=&quot;token parameter variable&quot;&gt;--topic&lt;/span&gt; hello.kafka &lt;span class=&quot;token punctuation&quot;&gt;\&lt;/span&gt;
--if-exists&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;/br&gt;
&lt;h2&gt;4-1-2) kafka-configs.sh&lt;/h2&gt;
&lt;ul&gt;
&lt;li&gt;토픽에 일부 옵션을 설정하기 위해서는 &lt;code class=&quot;language-text&quot;&gt;kafka-configs.sh&lt;/code&gt; 명령어를 사용해야 한다. &lt;code class=&quot;language-text&quot;&gt;--alter&lt;/code&gt;과 &lt;code class=&quot;language-text&quot;&gt;-add-config&lt;/code&gt; 옵션을 사용하여 &lt;code class=&quot;language-text&quot;&gt;min.insync.replicas&lt;/code&gt; 옵션을 토픽별로 설정할 수 있다.&lt;/li&gt;
&lt;li&gt;브로커에 설정된 각종 기본 값은 &lt;code class=&quot;language-text&quot;&gt;--broker&lt;/code&gt;, &lt;code class=&quot;language-text&quot;&gt;--all&lt;/code&gt;, &lt;code class=&quot;language-text&quot;&gt;--describe&lt;/code&gt; 옵션을 사용하여 조회할 수 있다.&lt;/li&gt;
&lt;/ul&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;sh&quot;&gt;&lt;pre class=&quot;language-sh&quot;&gt;&lt;code class=&quot;language-sh&quot;&gt;&lt;span class=&quot;token comment&quot;&gt;# Kafka 옵션 변경 (min.insync.replicas)&lt;/span&gt;
./kafka-configs.sh --bootstrap-server my-kafka:9092 &lt;span class=&quot;token punctuation&quot;&gt;\&lt;/span&gt;
&lt;span class=&quot;token parameter variable&quot;&gt;--alter&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;\&lt;/span&gt;
--add-config &lt;span class=&quot;token assign-left variable&quot;&gt;min.insync.replicas&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;token number&quot;&gt;2&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;\&lt;/span&gt;
&lt;span class=&quot;token parameter variable&quot;&gt;--topic&lt;/span&gt; hello.kafka

&lt;span class=&quot;token comment&quot;&gt;# Kafka 브로커에 설정된 옵션 조회&lt;/span&gt;
./kafka-configs.sh --bootstrap-server my-kafka:9092 &lt;span class=&quot;token punctuation&quot;&gt;\&lt;/span&gt;
&lt;span class=&quot;token parameter variable&quot;&gt;--broker&lt;/span&gt; &lt;span class=&quot;token number&quot;&gt;0&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;\&lt;/span&gt;
&lt;span class=&quot;token parameter variable&quot;&gt;--all&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;\&lt;/span&gt;
&lt;span class=&quot;token parameter variable&quot;&gt;--describe&lt;/span&gt; &lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;/br&gt;
&lt;h2&gt;4-1-3) kafka-console-producer.sh&lt;/h2&gt;
&lt;ul&gt;
&lt;li&gt;토픽에 데이터를 produce할 때 사용하는 스크립트로, 실행하면 텍스트를 입력할 수 있고 입력 후 엔터를 누르면 별 다른 메시지 없이 produce된다. produce된 메시지는 vlaue 값으로 전달된다. 이 때 메시지 키는 null로 전송된다.&lt;/li&gt;
&lt;li&gt;메시지 키를 가지는 레코드를 전송하기 위해서는 몇 가지 추가 옵션을 작성해야 한다. key.seperator를 선언하지 않으면 기본 설정은 Tab delimiter(\t) 이므로 key.seperator를 선언하지 않고 메시지를 보내려면 메시지 키를 작성하고 탭 키를 누른 다음 메시지를 작성하고 엔터를 누른다. 여기서는 명시적으로 구분하기 위해 콜론(:)으로 구분하였다. 메시지 키를 전송하지 않는 경우에는 각 파티션에 라운드 로빈 방식으로 전달되지만 메시지 키를 같이 전달하면 키의 해시값을 작성하여 존재하는 파티션 중 하나에 들어간다. 따라서 동일 키를 가진 메시지들은 같은 파티션으로 들어간다. 이 때 동일 키를 가진 메시지들은 순서가 보장된 형태가 된다.&lt;/li&gt;
&lt;/ul&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;sh&quot;&gt;&lt;pre class=&quot;language-sh&quot;&gt;&lt;code class=&quot;language-sh&quot;&gt;&lt;span class=&quot;token comment&quot;&gt;# 메시지만 Produce&lt;/span&gt;
./kafka-console-producer.sh --bootstrap-server my-kafka:9092 &lt;span class=&quot;token punctuation&quot;&gt;\&lt;/span&gt;
&lt;span class=&quot;token parameter variable&quot;&gt;--topic&lt;/span&gt; hello.kafka
&lt;span class=&quot;token operator&quot;&gt;&gt;&lt;/span&gt;hello
&lt;span class=&quot;token operator&quot;&gt;&gt;&lt;/span&gt;kafka 

&lt;span class=&quot;token comment&quot;&gt;# Key 값도 Produce&lt;/span&gt;
./kafka-console-producer.sh --bootstrap-server my-kafka:9092 &lt;span class=&quot;token punctuation&quot;&gt;\&lt;/span&gt;
&lt;span class=&quot;token parameter variable&quot;&gt;--topic&lt;/span&gt; hello.kafka &lt;span class=&quot;token punctuation&quot;&gt;\&lt;/span&gt;
&lt;span class=&quot;token parameter variable&quot;&gt;--property&lt;/span&gt; &lt;span class=&quot;token string&quot;&gt;&quot;parse.key=true&quot;&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;\&lt;/span&gt;
&lt;span class=&quot;token parameter variable&quot;&gt;--property&lt;/span&gt; &lt;span class=&quot;token string&quot;&gt;&quot;key.separator=:&quot;&lt;/span&gt;
&lt;span class=&quot;token operator&quot;&gt;&gt;&lt;/span&gt;key1:no1
&lt;span class=&quot;token operator&quot;&gt;&gt;&lt;/span&gt;key2:no2
&lt;span class=&quot;token operator&quot;&gt;&gt;&lt;/span&gt;key3:no3&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;/br&gt;
&lt;h2&gt;4-1-4) kafka-console-consumer.sh&lt;/h2&gt;
&lt;ul&gt;
&lt;li&gt;토픽의 데이터를 consume할 때 사용한다. &lt;code class=&quot;language-text&quot;&gt;--from-beginning&lt;/code&gt; 옵션은 토픽의 첫 번째 데이터부터 출력한다.&lt;/li&gt;
&lt;li&gt;Producer와 마찬가지로 key를 표시하기 위해서는 &lt;code class=&quot;language-text&quot;&gt;print.key=true&lt;/code&gt;, &lt;code class=&quot;language-text&quot;&gt;key.separator&lt;/code&gt; 옵션을 같이 사용해야 한다.&lt;/li&gt;
&lt;li&gt;&lt;code class=&quot;language-text&quot;&gt;--max-messages&lt;/code&gt; 옵션은 최대 컨슘 메시지를 설정할 수 있다.&lt;/li&gt;
&lt;li&gt;&lt;code class=&quot;language-text&quot;&gt;--partiion&lt;/code&gt; 옵션은 특정 파티션만 컨슘할 수 있다.&lt;/li&gt;
&lt;li&gt;&lt;code class=&quot;language-text&quot;&gt;--group&lt;/code&gt; 옵션은 컨슈머 그룹을 기반으로 동작한다. 컨슈머 그룹이란 특정 목적을 가진 컨슈머들을 묶음으로 사용하는 것을 말한다. 컨슈머 그룹으로 토픽의 레코드를 가져갈 경우 어느 레코드 까지 가졌는지(offset) 브로커에 저장된다.&lt;/li&gt;
&lt;/ul&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;sh&quot;&gt;&lt;pre class=&quot;language-sh&quot;&gt;&lt;code class=&quot;language-sh&quot;&gt;&lt;span class=&quot;token comment&quot;&gt;# 메시지 Consume&lt;/span&gt;
./kafka-console-consumer.sh --bootstrap-server my-kafka:9092 &lt;span class=&quot;token punctuation&quot;&gt;\&lt;/span&gt;
&lt;span class=&quot;token parameter variable&quot;&gt;--topic&lt;/span&gt; hello.kafka &lt;span class=&quot;token punctuation&quot;&gt;\&lt;/span&gt;
&lt;span class=&quot;token parameter variable&quot;&gt;--property&lt;/span&gt; &lt;span class=&quot;token string&quot;&gt;&quot;print.key=true&quot;&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;\&lt;/span&gt;
&lt;span class=&quot;token parameter variable&quot;&gt;--property&lt;/span&gt; &lt;span class=&quot;token string&quot;&gt;&quot;key.separator=:&quot;&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;\&lt;/span&gt;
--from-beginning

&lt;span class=&quot;token comment&quot;&gt;# Consumer 그룹 사용&lt;/span&gt;
./kafka-console-consumer.sh --bootstrap-server my-kafka:9092 &lt;span class=&quot;token punctuation&quot;&gt;\&lt;/span&gt;
&lt;span class=&quot;token parameter variable&quot;&gt;--topic&lt;/span&gt; hello.kafka &lt;span class=&quot;token punctuation&quot;&gt;\&lt;/span&gt;
&lt;span class=&quot;token parameter variable&quot;&gt;--group&lt;/span&gt; hello-group &lt;span class=&quot;token punctuation&quot;&gt;\&lt;/span&gt;
--from-beginning&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;/br&gt;
&lt;h2&gt;4-1-5) kafka-console-groups.sh&lt;/h2&gt;
&lt;ul&gt;
&lt;li&gt;&lt;code class=&quot;language-text&quot;&gt;--describe&lt;/code&gt; 옵션을 사용하면 해당 컨슈머 그룹이 어떤 토픽을 대상으로 레코드를 가져갔는지, 파티션 별 현재 오프셋, 마지막 레코드의 오프셋, 컨슈머 랙, 컨슈머 ID, 호스트 정보를 알 수 있다.&lt;/li&gt;
&lt;li&gt;&lt;code class=&quot;language-text&quot;&gt;컨슈머 랙&lt;/code&gt; 이란 마지막 레코드 오프셋과 현재 오프셋의 차이이다.&lt;/li&gt;
&lt;li&gt;컨슈머 그룹의 offset 리셋에는 다음과 같은 옵션들이 있다.
&lt;ul&gt;
&lt;li&gt;&lt;code class=&quot;language-text&quot;&gt;--to-earliest&lt;/code&gt;: 가장 처음 오프셋으로 리셋&lt;/li&gt;
&lt;li&gt;&lt;code class=&quot;language-text&quot;&gt;--to-latest&lt;/code&gt;: 가장 마지막 오프셋으로 리셋&lt;/li&gt;
&lt;li&gt;&lt;code class=&quot;language-text&quot;&gt;--to-current&lt;/code&gt;: 현 시점 기준 오프셋으로 리셋&lt;/li&gt;
&lt;li&gt;&lt;code class=&quot;language-text&quot;&gt;--to-datetime {YYYY-MM-DDTHH:mm:SS.sss}&lt;/code&gt;: 특정 시점으로 오프셋 리셋 (레코드 타임스탬프 기준)&lt;/li&gt;
&lt;li&gt;&lt;code class=&quot;language-text&quot;&gt;--to-offset {long}&lt;/code&gt;: 특정 오프셋으로 리셋&lt;/li&gt;
&lt;li&gt;&lt;code class=&quot;language-text&quot;&gt;--shift-by {+/- long}&lt;/code&gt;: 현재 컨슈머 오프셋에서 앞뒤로 옮기며 리셋&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;/ul&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;sh&quot;&gt;&lt;pre class=&quot;language-sh&quot;&gt;&lt;code class=&quot;language-sh&quot;&gt;&lt;span class=&quot;token comment&quot;&gt;# Consumer Group 리스트&lt;/span&gt;
./kafka-consumer-groups.sh --bootstrap-server my-kafka:9092 &lt;span class=&quot;token punctuation&quot;&gt;\&lt;/span&gt;
&lt;span class=&quot;token parameter variable&quot;&gt;--list&lt;/span&gt;

&lt;span class=&quot;token comment&quot;&gt;# Consumer Group 상세 정보&lt;/span&gt;
./kafka-consumer-groups.sh --bootstrap-server my-kafka:9092 &lt;span class=&quot;token punctuation&quot;&gt;\&lt;/span&gt;
&lt;span class=&quot;token parameter variable&quot;&gt;--group&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;group 명&lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;\&lt;/span&gt;
&lt;span class=&quot;token parameter variable&quot;&gt;--describe&lt;/span&gt;

&lt;span class=&quot;token comment&quot;&gt;# Offset 리셋 (group - topic의 오프셋을 맨 처음 레코드의 오프셋으로 되돌림)&lt;/span&gt;
./kafka-consumer-groups.sh --bootstrap-server my-kafka:9092 &lt;span class=&quot;token punctuation&quot;&gt;\&lt;/span&gt;
&lt;span class=&quot;token parameter variable&quot;&gt;--group&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;group 명&lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;\&lt;/span&gt;
&lt;span class=&quot;token parameter variable&quot;&gt;--topic&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;topic 명&lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;
--reset-offsets --to-earliest &lt;span class=&quot;token parameter variable&quot;&gt;--execute&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;/br&gt;
&lt;h2&gt;4-1-6) kafka-producer-perf-test.sh&lt;/h2&gt;
&lt;ul&gt;
&lt;li&gt;kafka producer로 성능을 측정할 때 사용한다.&lt;/li&gt;
&lt;/ul&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;sh&quot;&gt;&lt;pre class=&quot;language-sh&quot;&gt;&lt;code class=&quot;language-sh&quot;&gt;./kafka-producer-perf-test.sh --producer-props &lt;span class=&quot;token punctuation&quot;&gt;\&lt;/span&gt;
--bootstrap-servers my-kafka:9092 &lt;span class=&quot;token punctuation&quot;&gt;\&lt;/span&gt;
&lt;span class=&quot;token parameter variable&quot;&gt;--topic&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;topic 명&lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;\&lt;/span&gt;
--num-records &lt;span class=&quot;token number&quot;&gt;10&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;\&lt;/span&gt;
&lt;span class=&quot;token parameter variable&quot;&gt;--throughput&lt;/span&gt; &lt;span class=&quot;token number&quot;&gt;1&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;\&lt;/span&gt;
--record-size &lt;span class=&quot;token number&quot;&gt;100&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;\&lt;/span&gt;
--print-metric&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;/br&gt;
&lt;h2&gt;4-1-7) kafka-reassign-partitions.sh&lt;/h2&gt;
&lt;ul&gt;
&lt;li&gt;리더 파티션이 특정 브로커에 몰리는 현상을 해소하기 위해 파티션을 분산해서 운영할 때 사용.&lt;/li&gt;
&lt;li&gt;Kafka 브로커에는 &lt;code class=&quot;language-text&quot;&gt;auto.leader. rebalance.enable&lt;/code&gt; 옵션이 있는데 이 기본 값은 true로써 클라이언트 단위에서 리더 파티션을 자동 리밸런스하도록 도와준다.&lt;/li&gt;
&lt;/ul&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;sh&quot;&gt;&lt;pre class=&quot;language-sh&quot;&gt;&lt;code class=&quot;language-sh&quot;&gt;$ &lt;span class=&quot;token function&quot;&gt;cat&lt;/span&gt; partition.json
&lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;
	&lt;span class=&quot;token string&quot;&gt;&quot;partitions&quot;&lt;/span&gt;&lt;span class=&quot;token builtin class-name&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;[&lt;/span&gt;
		&lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;
			&lt;span class=&quot;token string&quot;&gt;&quot;topic&quot;&lt;/span&gt;&lt;span class=&quot;token builtin class-name&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;token string&quot;&gt;&quot;hello.kafka&quot;&lt;/span&gt;, &lt;span class=&quot;token string&quot;&gt;&quot;partition&quot;&lt;/span&gt;&lt;span class=&quot;token builtin class-name&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;token number&quot;&gt;0&lt;/span&gt;, &lt;span class=&quot;token string&quot;&gt;&quot;replicas&quot;&lt;/span&gt;&lt;span class=&quot;token builtin class-name&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;[&lt;/span&gt; &lt;span class=&quot;token number&quot;&gt;0&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;]&lt;/span&gt;
		&lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;
	&lt;span class=&quot;token punctuation&quot;&gt;]&lt;/span&gt;, &lt;span class=&quot;token string&quot;&gt;&quot;version&quot;&lt;/span&gt;&lt;span class=&quot;token builtin class-name&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;token number&quot;&gt;1&lt;/span&gt;
&lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;

./kafka-reassign-partitions.sh &lt;span class=&quot;token parameter variable&quot;&gt;--zookeeper&lt;/span&gt; my-kafka:2181 &lt;span class=&quot;token punctuation&quot;&gt;\&lt;/span&gt;
--reassignment-json-file partitions.json &lt;span class=&quot;token parameter variable&quot;&gt;--execute&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;/br&gt;
&lt;h2&gt;4-1-8) kafka-delete-records.sh&lt;/h2&gt;
&lt;ul&gt;
&lt;li&gt;특정 파티션의 특정 offset까지의 모든 레코드를 지울 때 사용.&lt;/li&gt;
&lt;/ul&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;sh&quot;&gt;&lt;pre class=&quot;language-sh&quot;&gt;&lt;code class=&quot;language-sh&quot;&gt;$ &lt;span class=&quot;token function&quot;&gt;cat&lt;/span&gt; delete.json
&lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;
	&lt;span class=&quot;token string&quot;&gt;&quot;partitions&quot;&lt;/span&gt;&lt;span class=&quot;token builtin class-name&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;[&lt;/span&gt;
		&lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;
			&lt;span class=&quot;token string&quot;&gt;&quot;topic&quot;&lt;/span&gt;&lt;span class=&quot;token builtin class-name&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;token string&quot;&gt;&quot;hello.kafka&quot;&lt;/span&gt;, &lt;span class=&quot;token string&quot;&gt;&quot;partition&quot;&lt;/span&gt;&lt;span class=&quot;token builtin class-name&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;token number&quot;&gt;0&lt;/span&gt;, &lt;span class=&quot;token string&quot;&gt;&quot;offset&quot;&lt;/span&gt;&lt;span class=&quot;token builtin class-name&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;token number&quot;&gt;5&lt;/span&gt;
		&lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;
	&lt;span class=&quot;token punctuation&quot;&gt;]&lt;/span&gt;, &lt;span class=&quot;token string&quot;&gt;&quot;version&quot;&lt;/span&gt;&lt;span class=&quot;token builtin class-name&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;token number&quot;&gt;1&lt;/span&gt;
&lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;

./kafka-delete-records.sh --bootstrap-server my-kafka:9092 &lt;span class=&quot;token punctuation&quot;&gt;\&lt;/span&gt;
--offset-json-file delete.json&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;/br&gt;
&lt;/br&gt;
&lt;h2&gt;4-1-9) kafka-dump-log.sh&lt;/h2&gt;
&lt;ul&gt;
&lt;li&gt;Kafka의 파일 단위로 Dump된 로그를 확인하기 위해 사용하는 명령어.&lt;/li&gt;
&lt;/ul&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;sh&quot;&gt;&lt;pre class=&quot;language-sh&quot;&gt;&lt;code class=&quot;language-sh&quot;&gt;./kafka-dump-log.sh &lt;span class=&quot;token punctuation&quot;&gt;\&lt;/span&gt;
&lt;span class=&quot;token parameter variable&quot;&gt;--files&lt;/span&gt; data/hello.kafka-0/00000000000000000000.log &lt;span class=&quot;token punctuation&quot;&gt;\&lt;/span&gt;
--deep-iteration&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;</content:encoded></item><item><title><![CDATA[3-3) Saas형 Apache Kafka 장점과 단점]]></title><description><![CDATA[3-3-1) 장점 인프라 관리의 효율화: Kafka 클러스터는 최소 3대 이상의 서버로 운영되는데, 클러스터 담당자의 입장에서는 이러한 모든 서버를 운영하고 관리해야 하는데, Saas는 이러한 운영 burden…]]></description><link>https://github.com/SiverPineValley/SiverPineValley.github.io/kafka/kafka_3_3/</link><guid isPermaLink="false">https://github.com/SiverPineValley/SiverPineValley.github.io/kafka/kafka_3_3/</guid><pubDate>Sat, 07 Dec 2024 16:30:00 GMT</pubDate><content:encoded>&lt;h2&gt;3-3-1) 장점&lt;/h2&gt;
&lt;ul&gt;
&lt;li&gt;&lt;strong&gt;인프라 관리의 효율화&lt;/strong&gt;: Kafka 클러스터는 최소 3대 이상의 서버로 운영되는데, 클러스터 담당자의 입장에서는 이러한 모든 서버를 운영하고 관리해야 하는데, Saas는 이러한 운영 burden의 많은 부분을 해소해준다. 서버 상태를 모니터링하다가 장애가 발생하면 바로 정상 서버로 대체해주거나, 쉽게 스케일업 / 스케일다운을 진행할 수 있다.&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;모니터링 대시보드 제공&lt;/strong&gt;: 오픈형 Apache Kafka의 경우 기본적으로 모니터링하기 위해서는 많은 부분의 노하우가 필요한데, Saas형 Apache Kafka는 자동화된 모니터링 툴을 제공해주기 때문에, 쉽게 클러스터 상태를 체크할 수 있다.&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;보안 설정&lt;/strong&gt;: Kafka 브로커는 각종 보안 위협에 대비하여 SSL, SASL, ACL과 같은 불특정 다수의 침입을 막기 위한 다양한 종류의 보안 설정을 제공하고 있다. 그러나 어떤 종류의 보안을 설정할지 고르고 설정/운영하는 것은 쉬운일이 아니다. 이러한 점을 보안하기 위해 Saas형 Apache Kafka는 보안 설정을 기본으로 제공하고 있다.&lt;/li&gt;
&lt;/ul&gt;
&lt;h2&gt;3-3-2) 단점&lt;/h2&gt;
&lt;ul&gt;
&lt;li&gt;&lt;strong&gt;서비스 사용 비용&lt;/strong&gt;: Kafka를 직접 설치해서 사용하는 경우에는 서버의 사용 비용만 들지만, Saas형으로 운영할 경우 최소 3대의 인스턴스를 사용하기 때문에, 최소 사양으로 사용해도 월 120만원 이상이 발생한다. 인스턴스를 발급하고부터 비용이 발생하며, 추가적으로 스토리지 요금과 데이터 전송 요금도 발생한다.&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;커스터마이징의 제한&lt;/strong&gt;: SaaS형의 경우 각종 옵션들을 원하는 대로 설정할 수 없는 경우들이 있다. SaaS 서비스들은 인프라부터 애플리케이션 설치까지 모든 부분이 자동화되어 있고 업체에서 설정한 아키텍처를 따라가기 때문에 상세한 설정을 적용하거나 클러스터 아키텍처 변화가 필요할 때 적용하기 매우 어렵다. 특히 멀티 클라우드 (2개 이상의 퍼블릭 클라우드 혹은 온프레미스와 퍼블릭을 함께 사용) 형태로 카프카 클러스터를 구성하는 것이 불가능하다. 클라우드 종속성 탈피를 위해 마이그레이션의 목적으로 이러한 형태를 구성하는 경우 문제가 복잡해질 수 있다.&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;클라우드의 종속성&lt;/strong&gt;: SaaS형 카프카 구축을 위해서는 업체를 선택하고 운영해야 하는데, 클라우드 서비스 업체를 선택하고 클러스터를 운영하는 순간 프로듀서, 컨슈머를 포함한 모든 애플리케이션들은 해당 서비스에 종속된다. 차후 비용 문제나 종속성 문제를 해결해야 할 때 큰 문제가 발생할 수 있으므로 추후 발생할 수 있는 이슈를 예측해보고 서비스에 미치는 위험 정도를 따져보고 도입 해야한다.&lt;/li&gt;
&lt;/ul&gt;
&lt;blockquote&gt;
&lt;p&gt;카프카 클러스터에 대한 운영 노하우가 부족한 경우 빠르게 클러스터 인프라를 구축하고 사용할 때는 SaaS형 카프카가 최고의 선택지가 될 수 있다. 다만, SaaS형 카프카도 결국 카프카를 설치하여 구성하는 클러스터이므로 카프카에 대한 노하우가 없으면 세세한 운영 부분에서 어려움을 겪을 수 있다.&lt;/p&gt;
&lt;/blockquote&gt;</content:encoded></item><item><title><![CDATA[3-2) Saas형 Apache Kafka 소개]]></title><link>https://github.com/SiverPineValley/SiverPineValley.github.io/kafka/kafka_3_2/</link><guid isPermaLink="false">https://github.com/SiverPineValley/SiverPineValley.github.io/kafka/kafka_3_2/</guid><pubDate>Sat, 07 Dec 2024 16:10:00 GMT</pubDate><content:encoded>&lt;/br&gt;
&lt;div align=&quot;left&quot;&gt;
  &lt;span class=&quot;gatsby-resp-image-wrapper&quot; style=&quot;position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 630px; &quot;&gt;
      &lt;a class=&quot;gatsby-resp-image-link&quot; href=&quot;/static/156d4095c8176e0199efac566247ae48/cd13d/%EC%8A%A4%ED%81%AC%EB%A6%B0%EC%83%B7%202024-12-07%20%EC%98%A4%ED%9B%84%202.53.37.png&quot; style=&quot;display: block&quot; target=&quot;_blank&quot; rel=&quot;noopener&quot;&gt;
    &lt;span class=&quot;gatsby-resp-image-background-image&quot; style=&quot;padding-bottom: 49.36708860759494%; position: relative; bottom: 0; left: 0; background-image: url(&apos;data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAKCAYAAAC0VX7mAAAACXBIWXMAABYlAAAWJQFJUiTwAAABcUlEQVR42n1Sy4rCQBCcj/PqA8GT5OA/eBD0L7xoJDcFz36OuBE1McY83OTg29RaDe26sDih6OlXdc1MTKvVQrlcRrVaRaPRQLfbRbvdRqfTgWVZqFQqqNVqgnq9/qpjXtFsNlEqldDr9WDG4zGGwyFGoxEcx8F0OsVkMgHj9AeDgeRt25Y9wVqtoWVdv9/HbDaDud/veDweoL3dbrhcLuL/t67XKz6toihgttst3C8X6/Uay+VSsNlsEMcxkiRBFEUIwxB5nkvM932JM7bf72VPm2WZCDJJmgjBarUScAChPnP0qZyN8/n8Tz2FeJ73OpmhAhYEwU4SxG73uyeCIBBQ3WKxkBitklEt8+QydEiYpinO5zOOx6PgdDrJEXhvnE5Lha7rCvH7QPrkYJ8hM4t4LAZ5J3EUI3/eCRePoY90OBxEBYn1/thPIRwuR86+s9cDsIhqiuenRAr+BWzkSxKM6V59IdTEeyOnqX2HKvmEH+qdxlRvtiYqAAAAAElFTkSuQmCC&apos;); background-size: cover; display: block;&quot;&gt;&lt;/span&gt;
  &lt;img class=&quot;gatsby-resp-image-image&quot; alt=&quot;     2024 12 07    2 53 37&quot; title=&quot;&quot; src=&quot;/static/156d4095c8176e0199efac566247ae48/f058b/%EC%8A%A4%ED%81%AC%EB%A6%B0%EC%83%B7%202024-12-07%20%EC%98%A4%ED%9B%84%202.53.37.png&quot; srcset=&quot;/static/156d4095c8176e0199efac566247ae48/c26ae/%EC%8A%A4%ED%81%AC%EB%A6%B0%EC%83%B7%202024-12-07%20%EC%98%A4%ED%9B%84%202.53.37.png 158w,
/static/156d4095c8176e0199efac566247ae48/6bdcf/%EC%8A%A4%ED%81%AC%EB%A6%B0%EC%83%B7%202024-12-07%20%EC%98%A4%ED%9B%84%202.53.37.png 315w,
/static/156d4095c8176e0199efac566247ae48/f058b/%EC%8A%A4%ED%81%AC%EB%A6%B0%EC%83%B7%202024-12-07%20%EC%98%A4%ED%9B%84%202.53.37.png 630w,
/static/156d4095c8176e0199efac566247ae48/40601/%EC%8A%A4%ED%81%AC%EB%A6%B0%EC%83%B7%202024-12-07%20%EC%98%A4%ED%9B%84%202.53.37.png 945w,
/static/156d4095c8176e0199efac566247ae48/78612/%EC%8A%A4%ED%81%AC%EB%A6%B0%EC%83%B7%202024-12-07%20%EC%98%A4%ED%9B%84%202.53.37.png 1260w,
/static/156d4095c8176e0199efac566247ae48/cd13d/%EC%8A%A4%ED%81%AC%EB%A6%B0%EC%83%B7%202024-12-07%20%EC%98%A4%ED%9B%84%202.53.37.png 1958w&quot; sizes=&quot;(max-width: 630px) 100vw, 630px&quot; style=&quot;width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;&quot; loading=&quot;lazy&quot; decoding=&quot;async&quot;&gt;
  &lt;/a&gt;
    &lt;/span&gt;
&lt;/div&gt;
&lt;/br&gt;
&lt;div align=&quot;left&quot;&gt;
  &lt;span class=&quot;gatsby-resp-image-wrapper&quot; style=&quot;position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 630px; &quot;&gt;
      &lt;a class=&quot;gatsby-resp-image-link&quot; href=&quot;/static/1913c80530ac3293744f77cba02ac174/c549b/%EC%8A%A4%ED%81%AC%EB%A6%B0%EC%83%B7%202024-12-07%20%EC%98%A4%ED%9B%84%202.53.55.png&quot; style=&quot;display: block&quot; target=&quot;_blank&quot; rel=&quot;noopener&quot;&gt;
    &lt;span class=&quot;gatsby-resp-image-background-image&quot; style=&quot;padding-bottom: 48.10126582278481%; position: relative; bottom: 0; left: 0; background-image: url(&apos;data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAKCAYAAAC0VX7mAAAACXBIWXMAABYlAAAWJQFJUiTwAAABtElEQVR42n1SyUpDQRAc8Bv0Eg+CXuLBi3pwJYqKHjzowV8SvAgi3lReVPAHFD9BJSELL3nZ9wWymBASsqdMNUwICD4ouqenqqem36jhcAiNfr8Pfp9f37i9vYNhPI3hxOOjE/cPxjgauLy8gmkGhTcYDDCtH41GUNOFbrcrxOvrGywu2bG2voldxwHsyyuYnbPBNr8ApWbw/PIqvF6v939DEvgZxjOOT05xdn4Bh+MQm1sObO/sYW//CKtrG3h7/xAeb/SnIYtMtH3m7XYbjUYD9XodlUoF1WoVP9UflMuVMcpotVrSjBpC59SreDyOVCqFbDYrSKfTyOVyKBaLElljzGQyEw7XsVhsosvn86Kr1WpQbrcbHo8HPp8PkUgEoVAIXq8XgUBA6sFgEC6XS/Y1yOO+aZoC8hhLpRIUG5AQDocFzKPRqDigezqzLEvqXJPPvUQiITldMufepCFPY6SQJ9EVm5NIMXMKLCskPIKHsu73+0VPLeertP1kMjlxyqhdUUAxIw/TDrnHWXJ2zAn+PMXh81p6sHr4vIoWsEa3hUJBeM1mE51OR94tnxpfBdf8278XIrv6rzxljQAAAABJRU5ErkJggg==&apos;); background-size: cover; display: block;&quot;&gt;&lt;/span&gt;
  &lt;img class=&quot;gatsby-resp-image-image&quot; alt=&quot;     2024 12 07    2 53 55&quot; title=&quot;&quot; src=&quot;/static/1913c80530ac3293744f77cba02ac174/f058b/%EC%8A%A4%ED%81%AC%EB%A6%B0%EC%83%B7%202024-12-07%20%EC%98%A4%ED%9B%84%202.53.55.png&quot; srcset=&quot;/static/1913c80530ac3293744f77cba02ac174/c26ae/%EC%8A%A4%ED%81%AC%EB%A6%B0%EC%83%B7%202024-12-07%20%EC%98%A4%ED%9B%84%202.53.55.png 158w,
/static/1913c80530ac3293744f77cba02ac174/6bdcf/%EC%8A%A4%ED%81%AC%EB%A6%B0%EC%83%B7%202024-12-07%20%EC%98%A4%ED%9B%84%202.53.55.png 315w,
/static/1913c80530ac3293744f77cba02ac174/f058b/%EC%8A%A4%ED%81%AC%EB%A6%B0%EC%83%B7%202024-12-07%20%EC%98%A4%ED%9B%84%202.53.55.png 630w,
/static/1913c80530ac3293744f77cba02ac174/40601/%EC%8A%A4%ED%81%AC%EB%A6%B0%EC%83%B7%202024-12-07%20%EC%98%A4%ED%9B%84%202.53.55.png 945w,
/static/1913c80530ac3293744f77cba02ac174/78612/%EC%8A%A4%ED%81%AC%EB%A6%B0%EC%83%B7%202024-12-07%20%EC%98%A4%ED%9B%84%202.53.55.png 1260w,
/static/1913c80530ac3293744f77cba02ac174/c549b/%EC%8A%A4%ED%81%AC%EB%A6%B0%EC%83%B7%202024-12-07%20%EC%98%A4%ED%9B%84%202.53.55.png 2128w&quot; sizes=&quot;(max-width: 630px) 100vw, 630px&quot; style=&quot;width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;&quot; loading=&quot;lazy&quot; decoding=&quot;async&quot;&gt;
  &lt;/a&gt;
    &lt;/span&gt;
&lt;/div&gt;
&lt;/br&gt;</content:encoded></item><item><title><![CDATA[3-1) Kafka 클러스터를 운영하는 여러 가지 방법]]></title><description><![CDATA[기업용 Kafka는 Confluent Platform으로, 여러 부분에서 튜닝된 기능들이 제공된다. 더 나은 커넥터 기능들을 제공한다. 또한, 모니터링 툴(felice)도 제공된다.]]></description><link>https://github.com/SiverPineValley/SiverPineValley.github.io/kafka/kafka_3_1/</link><guid isPermaLink="false">https://github.com/SiverPineValley/SiverPineValley.github.io/kafka/kafka_3_1/</guid><pubDate>Sat, 07 Dec 2024 16:00:00 GMT</pubDate><content:encoded>&lt;/br&gt;
&lt;div align=&quot;left&quot;&gt;
  &lt;span class=&quot;gatsby-resp-image-wrapper&quot; style=&quot;position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 630px; &quot;&gt;
      &lt;a class=&quot;gatsby-resp-image-link&quot; href=&quot;/static/796b02dacb15637c4d58053fea829d53/ca98b/%EC%8A%A4%ED%81%AC%EB%A6%B0%EC%83%B7%202024-12-07%20%EC%98%A4%ED%9B%84%202.51.51.png&quot; style=&quot;display: block&quot; target=&quot;_blank&quot; rel=&quot;noopener&quot;&gt;
    &lt;span class=&quot;gatsby-resp-image-background-image&quot; style=&quot;padding-bottom: 48.734177215189874%; position: relative; bottom: 0; left: 0; background-image: url(&apos;data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAKCAYAAAC0VX7mAAAACXBIWXMAABYlAAAWJQFJUiTwAAABiElEQVR42k2Sx6oCMBBF86Mq2Jbi0oW49stcidgVe+8Fe/c+zkDkBS6T6XcmcalUSsFgUOl0WtlsVolEQqFQSJFIRLFY7Id4PG62ZDKpTCajcDhs9mg0aggEAqKWazabajQaWi6XWiwWGo/Hhna7rXw+r2KxaLJQKBiq1apKpZLZyuWy+bvdrkajkWazmRxBuVxO+/1enO/3a/J8PqtWq1kSslKpWDI6RSFRr9e12+3kD7nu8/nofr8b3u/3D9frVbfbTafTyYqjI9G5g8vloufzqdfrZRK4Vqul4/FogeBwOFjwdru10TwTWMEQpuish0I0fTwedgduMBhoOBza3ubzue0CSWF8k8nEdkTjTqejXq9nII69Ewtz2FHY9ft9S0ZhBDpyYI2PRdMMSXGasDfigF8R7JCOrjCkE4mMwl4ZH/t0OjX7er22gjDbbDZarVbWlIf4v3vH9+CF/QMAHEjYMB5MgR/Zfy10YvzD2A4p6EfDCSMYMj42/ze540OHLROhw9SPC/4AHXjL1QKGSSMAAAAASUVORK5CYII=&apos;); background-size: cover; display: block;&quot;&gt;&lt;/span&gt;
  &lt;img class=&quot;gatsby-resp-image-image&quot; alt=&quot;     2024 12 07    2 51 51&quot; title=&quot;&quot; src=&quot;/static/796b02dacb15637c4d58053fea829d53/f058b/%EC%8A%A4%ED%81%AC%EB%A6%B0%EC%83%B7%202024-12-07%20%EC%98%A4%ED%9B%84%202.51.51.png&quot; srcset=&quot;/static/796b02dacb15637c4d58053fea829d53/c26ae/%EC%8A%A4%ED%81%AC%EB%A6%B0%EC%83%B7%202024-12-07%20%EC%98%A4%ED%9B%84%202.51.51.png 158w,
/static/796b02dacb15637c4d58053fea829d53/6bdcf/%EC%8A%A4%ED%81%AC%EB%A6%B0%EC%83%B7%202024-12-07%20%EC%98%A4%ED%9B%84%202.51.51.png 315w,
/static/796b02dacb15637c4d58053fea829d53/f058b/%EC%8A%A4%ED%81%AC%EB%A6%B0%EC%83%B7%202024-12-07%20%EC%98%A4%ED%9B%84%202.51.51.png 630w,
/static/796b02dacb15637c4d58053fea829d53/40601/%EC%8A%A4%ED%81%AC%EB%A6%B0%EC%83%B7%202024-12-07%20%EC%98%A4%ED%9B%84%202.51.51.png 945w,
/static/796b02dacb15637c4d58053fea829d53/78612/%EC%8A%A4%ED%81%AC%EB%A6%B0%EC%83%B7%202024-12-07%20%EC%98%A4%ED%9B%84%202.51.51.png 1260w,
/static/796b02dacb15637c4d58053fea829d53/ca98b/%EC%8A%A4%ED%81%AC%EB%A6%B0%EC%83%B7%202024-12-07%20%EC%98%A4%ED%9B%84%202.51.51.png 1968w&quot; sizes=&quot;(max-width: 630px) 100vw, 630px&quot; style=&quot;width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;&quot; loading=&quot;lazy&quot; decoding=&quot;async&quot;&gt;
  &lt;/a&gt;
    &lt;/span&gt;
&lt;/div&gt;
&lt;/br&gt;
&lt;div align=&quot;left&quot;&gt;
  &lt;span class=&quot;gatsby-resp-image-wrapper&quot; style=&quot;position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 630px; &quot;&gt;
      &lt;a class=&quot;gatsby-resp-image-link&quot; href=&quot;/static/c418dbb6db49c5bd995de23e23f46e72/cd13d/%EC%8A%A4%ED%81%AC%EB%A6%B0%EC%83%B7%202024-12-07%20%EC%98%A4%ED%9B%84%202.52.16.png&quot; style=&quot;display: block&quot; target=&quot;_blank&quot; rel=&quot;noopener&quot;&gt;
    &lt;span class=&quot;gatsby-resp-image-background-image&quot; style=&quot;padding-bottom: 48.10126582278481%; position: relative; bottom: 0; left: 0; background-image: url(&apos;data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAKCAYAAAC0VX7mAAAACXBIWXMAABYlAAAWJQFJUiTwAAABoklEQVR42mVRx6oCQRCcX/TiQdH15Fk8e1P/Y//EiBEVVzArijnnHOpRDbM83hsoumemuqeqRzmdTgQCAUSjUQSDQbhcLhiGAa/X+w+hUAjhcBiRSAR+vx9utxsejwc+nw8OhwOmaULl83kUi0WUSiXkcjmkUinE43EkEgkbyWRSYiaTEU42m5Uzgvx0Oo1YLIZOpwPVbrdxvV7B9f1+JV4uFzSbTfR6PdTrdQyHQwwGA2y3W9zvd5zPZ9xuN/xdrFflchn9fh+v18sGG1pWDZVKBYVCAeTQCRVMp1OMRiMsFgus12u832+peT6fkit2ZvJ4PGywIQkaPKOq0+kkd3REUOXn85GGOipaYEP9Ei8Oh4PYnM1mGI/Hooj5fD6398vlUlROJhNsNhs5Ox6PUK1WS4ppRc+KDTlDy7LEdrValUjrBHPy+QAVUynV043ihvKplDkJmqTj73NyaV/X8CPojs5khvxJKuKAaYHzIrnRaIhKRnKIbrcrYK7P+fOsYUNCUTabrVYrachmJOz3e7Gx2+2kiOCM+Dgj97zjXv8w8QOM7st/ZeAtNwAAAABJRU5ErkJggg==&apos;); background-size: cover; display: block;&quot;&gt;&lt;/span&gt;
  &lt;img class=&quot;gatsby-resp-image-image&quot; alt=&quot;     2024 12 07    2 52 16&quot; title=&quot;&quot; src=&quot;/static/c418dbb6db49c5bd995de23e23f46e72/f058b/%EC%8A%A4%ED%81%AC%EB%A6%B0%EC%83%B7%202024-12-07%20%EC%98%A4%ED%9B%84%202.52.16.png&quot; srcset=&quot;/static/c418dbb6db49c5bd995de23e23f46e72/c26ae/%EC%8A%A4%ED%81%AC%EB%A6%B0%EC%83%B7%202024-12-07%20%EC%98%A4%ED%9B%84%202.52.16.png 158w,
/static/c418dbb6db49c5bd995de23e23f46e72/6bdcf/%EC%8A%A4%ED%81%AC%EB%A6%B0%EC%83%B7%202024-12-07%20%EC%98%A4%ED%9B%84%202.52.16.png 315w,
/static/c418dbb6db49c5bd995de23e23f46e72/f058b/%EC%8A%A4%ED%81%AC%EB%A6%B0%EC%83%B7%202024-12-07%20%EC%98%A4%ED%9B%84%202.52.16.png 630w,
/static/c418dbb6db49c5bd995de23e23f46e72/40601/%EC%8A%A4%ED%81%AC%EB%A6%B0%EC%83%B7%202024-12-07%20%EC%98%A4%ED%9B%84%202.52.16.png 945w,
/static/c418dbb6db49c5bd995de23e23f46e72/78612/%EC%8A%A4%ED%81%AC%EB%A6%B0%EC%83%B7%202024-12-07%20%EC%98%A4%ED%9B%84%202.52.16.png 1260w,
/static/c418dbb6db49c5bd995de23e23f46e72/cd13d/%EC%8A%A4%ED%81%AC%EB%A6%B0%EC%83%B7%202024-12-07%20%EC%98%A4%ED%9B%84%202.52.16.png 1958w&quot; sizes=&quot;(max-width: 630px) 100vw, 630px&quot; style=&quot;width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;&quot; loading=&quot;lazy&quot; decoding=&quot;async&quot;&gt;
  &lt;/a&gt;
    &lt;/span&gt;
&lt;/div&gt;
&lt;/br&gt;
&lt;ul&gt;
&lt;li&gt;기업용 Kafka는 Confluent Platform으로, 여러 부분에서 튜닝된 기능들이 제공된다. 더 나은 커넥터 기능들을 제공한다. 또한, 모니터링 툴(felice)도 제공된다.&lt;/li&gt;
&lt;/ul&gt;
&lt;/br&gt;
&lt;div align=&quot;left&quot;&gt;
  &lt;span class=&quot;gatsby-resp-image-wrapper&quot; style=&quot;position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 630px; &quot;&gt;
      &lt;a class=&quot;gatsby-resp-image-link&quot; href=&quot;/static/0c026e1815eb0bc62c3aaae8cc0c430e/de766/%EC%8A%A4%ED%81%AC%EB%A6%B0%EC%83%B7%202024-12-07%20%EC%98%A4%ED%9B%84%202.52.38.png&quot; style=&quot;display: block&quot; target=&quot;_blank&quot; rel=&quot;noopener&quot;&gt;
    &lt;span class=&quot;gatsby-resp-image-background-image&quot; style=&quot;padding-bottom: 20.253164556962027%; position: relative; bottom: 0; left: 0; background-image: url(&apos;data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAECAYAAACOXx+WAAAACXBIWXMAABYlAAAWJQFJUiTwAAAAp0lEQVR42mVOyQqFMBDr/3+ceFHrbosibgiKy0GNTKAP5BVCk7TJjOr7Hnmeo21bZFlG7m5BmqaEMYZ+VVVIkoRcPPc/CAJYa6GmaSIpy/JXEobhp1S01ppFnufB932+j+PIRdxSotUwDAw0TYMoihiUaeLFcUwtGwpf1xXzPGNZFuz7DjnP83ygpFUm13XN0qIoyLuuw7ZtxHEcOM/zE7zvG9d1/eEFl90nLb7P7yAAAAAASUVORK5CYII=&apos;); background-size: cover; display: block;&quot;&gt;&lt;/span&gt;
  &lt;img class=&quot;gatsby-resp-image-image&quot; alt=&quot;     2024 12 07    2 52 38&quot; title=&quot;&quot; src=&quot;/static/0c026e1815eb0bc62c3aaae8cc0c430e/f058b/%EC%8A%A4%ED%81%AC%EB%A6%B0%EC%83%B7%202024-12-07%20%EC%98%A4%ED%9B%84%202.52.38.png&quot; srcset=&quot;/static/0c026e1815eb0bc62c3aaae8cc0c430e/c26ae/%EC%8A%A4%ED%81%AC%EB%A6%B0%EC%83%B7%202024-12-07%20%EC%98%A4%ED%9B%84%202.52.38.png 158w,
/static/0c026e1815eb0bc62c3aaae8cc0c430e/6bdcf/%EC%8A%A4%ED%81%AC%EB%A6%B0%EC%83%B7%202024-12-07%20%EC%98%A4%ED%9B%84%202.52.38.png 315w,
/static/0c026e1815eb0bc62c3aaae8cc0c430e/f058b/%EC%8A%A4%ED%81%AC%EB%A6%B0%EC%83%B7%202024-12-07%20%EC%98%A4%ED%9B%84%202.52.38.png 630w,
/static/0c026e1815eb0bc62c3aaae8cc0c430e/40601/%EC%8A%A4%ED%81%AC%EB%A6%B0%EC%83%B7%202024-12-07%20%EC%98%A4%ED%9B%84%202.52.38.png 945w,
/static/0c026e1815eb0bc62c3aaae8cc0c430e/78612/%EC%8A%A4%ED%81%AC%EB%A6%B0%EC%83%B7%202024-12-07%20%EC%98%A4%ED%9B%84%202.52.38.png 1260w,
/static/0c026e1815eb0bc62c3aaae8cc0c430e/de766/%EC%8A%A4%ED%81%AC%EB%A6%B0%EC%83%B7%202024-12-07%20%EC%98%A4%ED%9B%84%202.52.38.png 1838w&quot; sizes=&quot;(max-width: 630px) 100vw, 630px&quot; style=&quot;width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;&quot; loading=&quot;lazy&quot; decoding=&quot;async&quot;&gt;
  &lt;/a&gt;
    &lt;/span&gt;
&lt;/div&gt;
&lt;/br&gt;</content:encoded></item><item><title><![CDATA[2-9) 클라이언트 메타데이터와 브로커 통신]]></title><description><![CDATA[카프카 클라이언트는 통신하고자 하는 를 알기 위해 데이터를 주고 (프로듀서) 받기 (컨슈머) 전에 메타데이터를 브로커로부터 전달받는다. 메타데이터는 다음과 같은 옵션을 통해 리프레쉬된다. : 메타데이터를 강제로 리프레쉬하는 간격. 기본값은…]]></description><link>https://github.com/SiverPineValley/SiverPineValley.github.io/kafka/kafka_2_9/</link><guid isPermaLink="false">https://github.com/SiverPineValley/SiverPineValley.github.io/kafka/kafka_2_9/</guid><pubDate>Sat, 07 Dec 2024 15:30:00 GMT</pubDate><content:encoded>&lt;ul&gt;
&lt;li&gt;
&lt;p&gt;카프카 클라이언트는 통신하고자 하는 &lt;code class=&quot;language-text&quot;&gt;리더 파티션의 위치&lt;/code&gt;를 알기 위해 데이터를 주고 (프로듀서) 받기 (컨슈머) 전에 메타데이터를 브로커로부터 전달받는다. 메타데이터는 다음과 같은 옵션을 통해 리프레쉬된다.&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;&lt;code class=&quot;language-text&quot;&gt;metadata.max.age.ms&lt;/code&gt;: 메타데이터를 강제로 리프레쉬하는 간격. 기본값은 5분.&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;&lt;code class=&quot;language-text&quot;&gt;metadata.max.idle.ms&lt;/code&gt;: 프로듀서가 유휴상태일 때 메타데이터를 캐시에 유지하는 기간.  예를 들어, 프로듀서가 특정 토픽으로 데이터를 보낸 이후 지정된 시간이 지나고 나면 강제로 메타데이터를 리프레시. 기본값은 5분.&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;카프카 클라이언트는 반드시 리더 파티션과 통신해야 하는데, 가끔 리프레시 이후 리더 파티션이 아닌 파티션과 통신하다 보면 &lt;code class=&quot;language-text&quot;&gt;LEADER_NOT_AVAILABLE&lt;/code&gt; 이라는 에러가 발생한다. 이 에러는 클라이언트가 데이터를 요청한 브로커에 리더 파티션이 없는 경우이며 대부분 메타데이터 리프레시 이슈로 발생한다. 이 에러가 자주 발생하면 메타데이터 리프레시 간격을 확인하고 클라이언트가 정상적인 메타데이터를 가지고 있는지 확인해야 한다.&lt;/p&gt;
&lt;/li&gt;
&lt;/ul&gt;</content:encoded></item><item><title><![CDATA[2-8) 토픽 이름 제약 조건과 유지보수 하기 좋은 토픽 이름 정하기]]></title><description><![CDATA[토픽 이름은 대/소문자, 숫자 0-9, 마침표(.), 언더바( _ ), 하이픈(-) 조합으로 생성할 수 있다. 이외의 문자열이 포함된 토픽 이름은 생성 불가하다. 토픽 이름 길이는 249자 미만이다. 내부 관리용 토픽 (comsumer_offsets…]]></description><link>https://github.com/SiverPineValley/SiverPineValley.github.io/kafka/kafka_2_8/</link><guid isPermaLink="false">https://github.com/SiverPineValley/SiverPineValley.github.io/kafka/kafka_2_8/</guid><pubDate>Sat, 07 Dec 2024 15:20:00 GMT</pubDate><content:encoded>&lt;ul&gt;
&lt;li&gt;토픽 이름은 대/소문자, 숫자 0-9, 마침표(.), 언더바( _ ), 하이픈(-) 조합으로 생성할 수 있다. 이외의 문자열이 포함된 토픽 이름은 생성 불가하다.&lt;/li&gt;
&lt;li&gt;토픽 이름 길이는 249자 미만이다.&lt;/li&gt;
&lt;li&gt;내부 관리용 토픽 (comsumer_offsets, transaction_state) 로는 생성 불가능하다.&lt;/li&gt;
&lt;li&gt;카프카 내부 로직 때문에 마침표(.)와 언더바( _ )가 동시에 들어간 토픽은 생성을 지양한다.&lt;/li&gt;
&lt;li&gt;카프카 토픽은 변경이 지원되지 않으므로, 이름을 변경하기 위해서는 삭제하고 다시 생성해야 한다. 따라서 토픽 생성 규칙을 잘 논의 후에 정하는 것이 중요하다.&lt;/li&gt;
&lt;/ul&gt;</content:encoded></item><item><title><![CDATA[2-6) 토픽과 파티션]]></title><description><![CDATA[: 카프카에서 데이터를 구분하기 위해 사용되는 단위. 토픽은 1개 이상의 파티션을 소유한다. 파티션에는 프로듀서가 보낸 데이터가 저장되는데, 이를 라고 한다. : 자료구조에서 접하는 와 비슷한 구조로, 컨슈머는 FIFO…]]></description><link>https://github.com/SiverPineValley/SiverPineValley.github.io/kafka/kafka_2_6/</link><guid isPermaLink="false">https://github.com/SiverPineValley/SiverPineValley.github.io/kafka/kafka_2_6/</guid><pubDate>Sat, 07 Dec 2024 15:10:00 GMT</pubDate><content:encoded>&lt;ul&gt;
&lt;li&gt;&lt;code class=&quot;language-text&quot;&gt;토픽(Topic)&lt;/code&gt;: 카프카에서 데이터를 구분하기 위해 사용되는 단위. 토픽은 1개 이상의 파티션을 소유한다. 파티션에는 프로듀서가 보낸 데이터가 저장되는데, 이를 &lt;code class=&quot;language-text&quot;&gt;레코드(Record)&lt;/code&gt;라고 한다.&lt;/li&gt;
&lt;li&gt;&lt;code class=&quot;language-text&quot;&gt;파티션(Partition)&lt;/code&gt;: 자료구조에서 접하는 &lt;code class=&quot;language-text&quot;&gt;큐(queue)&lt;/code&gt;와 비슷한 구조로, 컨슈머는 FIFO 구조와 같이 먼저 들어간 데이터를 먼저 컨슘한다. 큐와 다른 점은 레코드가 컨슘되더라도 삭제하지 않는다는 점이다. 따라서 다양한 목적을 가진 컨슈머 그룹들이 토픽 데이터를 여러 번 가져가게 된다.&lt;/li&gt;
&lt;/ul&gt;
&lt;h2&gt;2-6-1) 토픽 생성 시 파티션이 배치되는 방법&lt;/h2&gt;
&lt;/br&gt;
&lt;div align=&quot;left&quot;&gt;
  &lt;span class=&quot;gatsby-resp-image-wrapper&quot; style=&quot;position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 630px; &quot;&gt;
      &lt;a class=&quot;gatsby-resp-image-link&quot; href=&quot;/static/fdb53a4a4cc8b2b5b5e228c846ec1496/9e7e4/%EC%8A%A4%ED%81%AC%EB%A6%B0%EC%83%B7%202024-12-07%20%EC%98%A4%ED%9B%84%202.45.05.png&quot; style=&quot;display: block&quot; target=&quot;_blank&quot; rel=&quot;noopener&quot;&gt;
    &lt;span class=&quot;gatsby-resp-image-background-image&quot; style=&quot;padding-bottom: 29.746835443037973%; position: relative; bottom: 0; left: 0; background-image: url(&apos;data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAGCAYAAADDl76dAAAACXBIWXMAABYlAAAWJQFJUiTwAAABCklEQVR42lVQyYqFQBDz/w+CIAju+76+J6KiJ68iKIKI/kvNpOY0h6K7Kkkl3ULbtvT5fCjPc8qyjL7fLzVNQ+/78hyVpilVVUV1XdMwDPQ8D5VlyViSJMwHviwLCXEcU9d1ZFkWmaZJ4zgSZuu6sgkwTdN4Kcxguu87Y+gVRWEjLEUvgADXIAi45nlm0bZtnAKY4zg8w/KiKOg8T7Jtm3zfpyiKWIdAfd//JfQ8j0UokFAQgYi767rMQSEZMNyxLAxDPsH5txCOlmXyPfglHcfBZPRwhxlESAoMPTDDMHgOPV4g4AlIIcsySZLEJHz0fd98osdcVVVOjP+6ros1MBJFkXRd56XTNNEPgrRqnFBIhxsAAAAASUVORK5CYII=&apos;); background-size: cover; display: block;&quot;&gt;&lt;/span&gt;
  &lt;img class=&quot;gatsby-resp-image-image&quot; alt=&quot;     2024 12 07    2 45 05&quot; title=&quot;&quot; src=&quot;/static/fdb53a4a4cc8b2b5b5e228c846ec1496/f058b/%EC%8A%A4%ED%81%AC%EB%A6%B0%EC%83%B7%202024-12-07%20%EC%98%A4%ED%9B%84%202.45.05.png&quot; srcset=&quot;/static/fdb53a4a4cc8b2b5b5e228c846ec1496/c26ae/%EC%8A%A4%ED%81%AC%EB%A6%B0%EC%83%B7%202024-12-07%20%EC%98%A4%ED%9B%84%202.45.05.png 158w,
/static/fdb53a4a4cc8b2b5b5e228c846ec1496/6bdcf/%EC%8A%A4%ED%81%AC%EB%A6%B0%EC%83%B7%202024-12-07%20%EC%98%A4%ED%9B%84%202.45.05.png 315w,
/static/fdb53a4a4cc8b2b5b5e228c846ec1496/f058b/%EC%8A%A4%ED%81%AC%EB%A6%B0%EC%83%B7%202024-12-07%20%EC%98%A4%ED%9B%84%202.45.05.png 630w,
/static/fdb53a4a4cc8b2b5b5e228c846ec1496/40601/%EC%8A%A4%ED%81%AC%EB%A6%B0%EC%83%B7%202024-12-07%20%EC%98%A4%ED%9B%84%202.45.05.png 945w,
/static/fdb53a4a4cc8b2b5b5e228c846ec1496/78612/%EC%8A%A4%ED%81%AC%EB%A6%B0%EC%83%B7%202024-12-07%20%EC%98%A4%ED%9B%84%202.45.05.png 1260w,
/static/fdb53a4a4cc8b2b5b5e228c846ec1496/9e7e4/%EC%8A%A4%ED%81%AC%EB%A6%B0%EC%83%B7%202024-12-07%20%EC%98%A4%ED%9B%84%202.45.05.png 2056w&quot; sizes=&quot;(max-width: 630px) 100vw, 630px&quot; style=&quot;width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;&quot; loading=&quot;lazy&quot; decoding=&quot;async&quot;&gt;
  &lt;/a&gt;
    &lt;/span&gt;
&lt;/div&gt;
&lt;/br&gt;
&lt;ul&gt;
&lt;li&gt;파티션이 생성되면 위와 같이 0번 브로커부터 round-robin 방식으로 리더 브로커들이 생성된다. 카프카 클라이언트는 리더 파티션이 있는 브로커와 통신하여 복제를 진행하므로 여러 브로커에 골고루 네트워크 통신을 진행하게 된다. 이를 통해 데이터가 특정 브로커와 통신이 집중되는 현상(hot spot)을 막고 scale out을 하여 데이터가 많아지더라도 자연스럽게 대응할 수 있게 된다.&lt;/li&gt;
&lt;/ul&gt;
&lt;/br&gt;
&lt;div align=&quot;left&quot;&gt;
  &lt;span class=&quot;gatsby-resp-image-wrapper&quot; style=&quot;position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 630px; &quot;&gt;
      &lt;a class=&quot;gatsby-resp-image-link&quot; href=&quot;/static/8e24aea80f161ddfcf3fee20168ae82b/aae30/%EC%8A%A4%ED%81%AC%EB%A6%B0%EC%83%B7%202024-12-07%20%EC%98%A4%ED%9B%84%202.45.52.png&quot; style=&quot;display: block&quot; target=&quot;_blank&quot; rel=&quot;noopener&quot;&gt;
    &lt;span class=&quot;gatsby-resp-image-background-image&quot; style=&quot;padding-bottom: 46.202531645569614%; position: relative; bottom: 0; left: 0; background-image: url(&apos;data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAJCAYAAAAywQxIAAAACXBIWXMAABYlAAAWJQFJUiTwAAABfUlEQVR42mWSR6sCQRCE5+frSfAiuCqKuibMOScURcSEnhX8GWo9voY9vcMyNT1d1VWt7vv96vP5iPP3+/3DwT3oo77f71UqldTpdPR4PDSfz+17v99yh8NBo9FI/X5f3W5Xk8lEw+FQr9dL6/Vay+XS3qmDN5uNns+nCSwWCw0GAzun06nO57Ncu91Ws9mU7/vyPE+9Xs/w8Xi05tVqpXK5rHq9bgPohzgej21AsVg0MQZSc6jzIVqpVMwBTq/Xq2q1msXKZrP2Rr1arep2u5kIPKIjHNxNkMkQad5ut+bscrlYjbi5XM4EwQzGIb2tVkvxeNxck4BVOazS2Gg0zD67AZ9OJ4uAYwjsGMww3hBgPZlMxpwzCB1HEQIu2CEEYuACzIB8Pm/xwcE6MMKddcxmM4vM6YJfDjLOdrudWYdELAQgMQRMdHaIGDwGBf8GEyRKOp1WNBpVOBw2zHe/381ZMplUKBRSJBJRKpVSoVAwQXpIxFssFlMikbDIfwEFQApRGe9YAAAAAElFTkSuQmCC&apos;); background-size: cover; display: block;&quot;&gt;&lt;/span&gt;
  &lt;img class=&quot;gatsby-resp-image-image&quot; alt=&quot;     2024 12 07    2 45 52&quot; title=&quot;&quot; src=&quot;/static/8e24aea80f161ddfcf3fee20168ae82b/f058b/%EC%8A%A4%ED%81%AC%EB%A6%B0%EC%83%B7%202024-12-07%20%EC%98%A4%ED%9B%84%202.45.52.png&quot; srcset=&quot;/static/8e24aea80f161ddfcf3fee20168ae82b/c26ae/%EC%8A%A4%ED%81%AC%EB%A6%B0%EC%83%B7%202024-12-07%20%EC%98%A4%ED%9B%84%202.45.52.png 158w,
/static/8e24aea80f161ddfcf3fee20168ae82b/6bdcf/%EC%8A%A4%ED%81%AC%EB%A6%B0%EC%83%B7%202024-12-07%20%EC%98%A4%ED%9B%84%202.45.52.png 315w,
/static/8e24aea80f161ddfcf3fee20168ae82b/f058b/%EC%8A%A4%ED%81%AC%EB%A6%B0%EC%83%B7%202024-12-07%20%EC%98%A4%ED%9B%84%202.45.52.png 630w,
/static/8e24aea80f161ddfcf3fee20168ae82b/40601/%EC%8A%A4%ED%81%AC%EB%A6%B0%EC%83%B7%202024-12-07%20%EC%98%A4%ED%9B%84%202.45.52.png 945w,
/static/8e24aea80f161ddfcf3fee20168ae82b/78612/%EC%8A%A4%ED%81%AC%EB%A6%B0%EC%83%B7%202024-12-07%20%EC%98%A4%ED%9B%84%202.45.52.png 1260w,
/static/8e24aea80f161ddfcf3fee20168ae82b/aae30/%EC%8A%A4%ED%81%AC%EB%A6%B0%EC%83%B7%202024-12-07%20%EC%98%A4%ED%9B%84%202.45.52.png 2080w&quot; sizes=&quot;(max-width: 630px) 100vw, 630px&quot; style=&quot;width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;&quot; loading=&quot;lazy&quot; decoding=&quot;async&quot;&gt;
  &lt;/a&gt;
    &lt;/span&gt;
&lt;/div&gt;
&lt;/br&gt;
&lt;ul&gt;
&lt;li&gt;리더 파티션이 생성되고 나면 나머지 브로커들에는 팔로워 파티션들이 생성된다. 팔로워 파티션은 리더 파티션 넘버의 +1, +2 순서로 생성되며, Replication Factor에 따라 생성되는 개수가 달라진다. 그런데 간혹 특정 브로커에 리더 파티션들이 몰려서 생성되는 경우가 있는데, 이러면 해당 브로커에만 자원 사용량이 집중된다. 이러한 현상을 해결하기 위해 파티션을 rebalance할 수 있는 기능이 있는데, &lt;code class=&quot;language-text&quot;&gt;kafka-reassign-partition.sh&lt;/code&gt; 쉘 스크립트 명령을 통해 해결 가능하다.&lt;/li&gt;
&lt;/ul&gt;
&lt;h2&gt;2-6-2) 파티션 개수와 컨슈머 개수의 처리량&lt;/h2&gt;
&lt;/br&gt;
&lt;div align=&quot;left&quot;&gt;
  &lt;span class=&quot;gatsby-resp-image-wrapper&quot; style=&quot;position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 630px; &quot;&gt;
      &lt;a class=&quot;gatsby-resp-image-link&quot; href=&quot;/static/8c32e1ae70bebea8624c4e94c5ca1bc8/0c3d0/%EC%8A%A4%ED%81%AC%EB%A6%B0%EC%83%B7%202024-12-07%20%EC%98%A4%ED%9B%84%202.46.16.png&quot; style=&quot;display: block&quot; target=&quot;_blank&quot; rel=&quot;noopener&quot;&gt;
    &lt;span class=&quot;gatsby-resp-image-background-image&quot; style=&quot;padding-bottom: 34.810126582278485%; position: relative; bottom: 0; left: 0; background-image: url(&apos;data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAHCAYAAAAIy204AAAACXBIWXMAABYlAAAWJQFJUiTwAAABdElEQVR42j1Sy+sBYRSdv9zCYpQVIyGRWCBvNZ6R9zuvibIgj4gspAZZnV/nlt/idpvvO989jzvKdDpFp9NBu91Gr9fDZrPB4XDAfr+Xvlqt8P1+8X6/0e/30e12BTscDrHb7QT3q/V6DaVYLMLn88HpdCIcDmM+n+N6veJ0OuF8PmM2m+Hz+cjAeDwOt9stRSwJiTsej9IpTikUCshms2g2mwiFQvB6vdA0DRaLBTabDZFIBLfbTR4nk0nouo5SqQSPx4NoNAqHwwFVVeFyuZDP56HUajUkEgnkcjkBNBoN8IxEVF+v18Umo0in03JeLpcRDAYRi8WE1Gq1wm63I5VKQdlut//2LpcLHo8Hns+n1P1+lwzZec8BJKbCQCAgzvx+v6hjbKKQ/pnZZDKRULmYwWCA0WgkBIZhSH6v10sW0Wq1kMlkRCWXRPx4PBbsYrGAwgcM/metWq2KZX4TwCGmaYpiLoz1+yMqlYpgGdNyuRRRf0mczMAo+BOzAAAAAElFTkSuQmCC&apos;); background-size: cover; display: block;&quot;&gt;&lt;/span&gt;
  &lt;img class=&quot;gatsby-resp-image-image&quot; alt=&quot;     2024 12 07    2 46 16&quot; title=&quot;&quot; src=&quot;/static/8c32e1ae70bebea8624c4e94c5ca1bc8/f058b/%EC%8A%A4%ED%81%AC%EB%A6%B0%EC%83%B7%202024-12-07%20%EC%98%A4%ED%9B%84%202.46.16.png&quot; srcset=&quot;/static/8c32e1ae70bebea8624c4e94c5ca1bc8/c26ae/%EC%8A%A4%ED%81%AC%EB%A6%B0%EC%83%B7%202024-12-07%20%EC%98%A4%ED%9B%84%202.46.16.png 158w,
/static/8c32e1ae70bebea8624c4e94c5ca1bc8/6bdcf/%EC%8A%A4%ED%81%AC%EB%A6%B0%EC%83%B7%202024-12-07%20%EC%98%A4%ED%9B%84%202.46.16.png 315w,
/static/8c32e1ae70bebea8624c4e94c5ca1bc8/f058b/%EC%8A%A4%ED%81%AC%EB%A6%B0%EC%83%B7%202024-12-07%20%EC%98%A4%ED%9B%84%202.46.16.png 630w,
/static/8c32e1ae70bebea8624c4e94c5ca1bc8/40601/%EC%8A%A4%ED%81%AC%EB%A6%B0%EC%83%B7%202024-12-07%20%EC%98%A4%ED%9B%84%202.46.16.png 945w,
/static/8c32e1ae70bebea8624c4e94c5ca1bc8/78612/%EC%8A%A4%ED%81%AC%EB%A6%B0%EC%83%B7%202024-12-07%20%EC%98%A4%ED%9B%84%202.46.16.png 1260w,
/static/8c32e1ae70bebea8624c4e94c5ca1bc8/0c3d0/%EC%8A%A4%ED%81%AC%EB%A6%B0%EC%83%B7%202024-12-07%20%EC%98%A4%ED%9B%84%202.46.16.png 1414w&quot; sizes=&quot;(max-width: 630px) 100vw, 630px&quot; style=&quot;width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;&quot; loading=&quot;lazy&quot; decoding=&quot;async&quot;&gt;
  &lt;/a&gt;
    &lt;/span&gt;
&lt;/div&gt;
&lt;/br&gt;
&lt;ul&gt;
&lt;li&gt;파티션은 카프카의 병렬 처리의 핵심으로써 그룹으로 묶인 컨슈머들이 레코드를 병렬으로 처리할 수 있도록 매칭된다. 파티션 한개에 컨슈머 한개만 매칭될 수 있는데, 반대로 컨슈머 한개는 여러 파티션에 매칭될 수 있기 때문에 컨슈머 처리량이 한정된 상황에서 많은 레코드를 병렬로 처리하기 가장 좋은 방법은 컨슈머의 개수를 늘려 스케일 아웃하는 방법이다. 컨슈머를 늘림과 동시에 파티션 개수도 늘리면 처리량이 더욱 증가하는 모습을 볼 수 있다.&lt;/li&gt;
&lt;li&gt;만약 프로듀서의 초당 데이터 발생이 10 TPS이고, 3개의 컨슈머가 존재하고 컨슈머 한개가 초당 1개의 레코드를 처리할 수 있는 상황이라면 프로듀스 되는 레코드가 훨씬 많으므로 점점 쌓이는 레코드의 수가 증가한다. 이러한 컨슈머의 데이터 처리 지연을 &lt;code class=&quot;language-text&quot;&gt;컨슈머 렉(Consumer Lag)&lt;/code&gt;이라고 한다.&lt;/li&gt;
&lt;li&gt;보통의 운영 시에는 현재의 Produce되는 레코드 보다 조금 여유 있게 파티션과 컨슈머의 수를 조절하는 편이다.&lt;/li&gt;
&lt;li&gt;다만 이렇게 파티션 수를 늘리는 것에는 주의 점이 있는데, 파티션의 개수를 줄이는 것은 불가능하다는 점이다. 파티션 수를 줄이는 방법은 토픽을 삭제하고 재생성하는 방법밖에 없다. 카프카에서는 파티션의 데이터를 세그먼트 단위로 저장하고 있기에 만에 하나 파티션을 줄이는 것을 지원하더라도 여러 브로커에 저장된 데이터를 취합하고 정렬하는 복잡한 과정을 거쳐야 하므로 클러스터에 큰 영향이 가게 된다.&lt;/li&gt;
&lt;/ul&gt;</content:encoded></item><item><title><![CDATA[2-7) 레코드]]></title><description><![CDATA[레코드는 타임스탬프, 헤더, 오프셋, 메시지 키, 메시지 값으로 구성되어 있다. Producer가 생성한 레코드가 브로커로 전송되면, 타임스탬프와 오프셋이 지정된다. 브로커에 한 번 적재된 데이터는 수정 불가하고, retention…]]></description><link>https://github.com/SiverPineValley/SiverPineValley.github.io/kafka/kafka_2_7/</link><guid isPermaLink="false">https://github.com/SiverPineValley/SiverPineValley.github.io/kafka/kafka_2_7/</guid><pubDate>Sat, 07 Dec 2024 15:10:00 GMT</pubDate><content:encoded>&lt;/br&gt;
&lt;div align=&quot;left&quot;&gt;
  &lt;span class=&quot;gatsby-resp-image-wrapper&quot; style=&quot;position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 630px; &quot;&gt;
      &lt;a class=&quot;gatsby-resp-image-link&quot; href=&quot;/static/1c117bca6138d73eb2ceb948f76e440a/2e195/%EC%8A%A4%ED%81%AC%EB%A6%B0%EC%83%B7%202024-12-07%20%EC%98%A4%ED%9B%84%202.47.10.png&quot; style=&quot;display: block&quot; target=&quot;_blank&quot; rel=&quot;noopener&quot;&gt;
    &lt;span class=&quot;gatsby-resp-image-background-image&quot; style=&quot;padding-bottom: 80.37974683544303%; position: relative; bottom: 0; left: 0; background-image: url(&apos;data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAQCAYAAAAWGF8bAAAACXBIWXMAABYlAAAWJQFJUiTwAAACC0lEQVR42m2U14pCQRBE/WhfRPAfFHPOOefwoIiiImIOiP/Sy+ll3OviQ9F3Znqqa6pnrm0wGEg2m5VkMimJROIDqVRK5//jWx4cjUZDbNVqVfx+v+RyOalUKlIulxXFYlEymYzk8/k3yGHe5AD2kBcMBsXn84mtVquJ1+uV/X4vz+dT7ve7RsamABGyQqEg5F+vV815PB7yer1ks9koRzgcFlu9XhePx6OJHL/X673R7Xal3W6rKmKz2dQ86zp7SqWSEoZCoT+F6/VazuezHI9HxeFwUCWtVksCgYB6BMntdtM1k3O5XGQ+n+txldAoJA6HQ+n3+29AACFKODYqUWTNYQ+2vBVC9F8hlfmezWYSj8e1i7FYTM1frVa6Ro5V4Qeh2+3+8BBFBnSXZpgGodioB1YPtSnGw+12q/6cTidVSUTJbrdTQgqzzhxrJg+fF4uF+hyNRn8JUcilHI1GWt34RGQOMtRNJpO3Kubxbzwe6+m4h18VosCooPp0OlUPORbfzBmFJme5XP51GUIGxE6no500YIwynhukptP4aHLxmWK8NlQqYTqdVrlUIAIWGdNd0+VIJKJgHb/MN+Ce4qN2mWdFFWB9pxSy2+3idDrF5XKJw+HQjSg1+bwiwG1QD+mg+WMYmCMSUUplIooown1k3XxThDHNtdE5mLnA32AlB8xxfGsOguBA3A9+T8pjFTK9vQAAAABJRU5ErkJggg==&apos;); background-size: cover; display: block;&quot;&gt;&lt;/span&gt;
  &lt;img class=&quot;gatsby-resp-image-image&quot; alt=&quot;     2024 12 07    2 47 10&quot; title=&quot;&quot; src=&quot;/static/1c117bca6138d73eb2ceb948f76e440a/f058b/%EC%8A%A4%ED%81%AC%EB%A6%B0%EC%83%B7%202024-12-07%20%EC%98%A4%ED%9B%84%202.47.10.png&quot; srcset=&quot;/static/1c117bca6138d73eb2ceb948f76e440a/c26ae/%EC%8A%A4%ED%81%AC%EB%A6%B0%EC%83%B7%202024-12-07%20%EC%98%A4%ED%9B%84%202.47.10.png 158w,
/static/1c117bca6138d73eb2ceb948f76e440a/6bdcf/%EC%8A%A4%ED%81%AC%EB%A6%B0%EC%83%B7%202024-12-07%20%EC%98%A4%ED%9B%84%202.47.10.png 315w,
/static/1c117bca6138d73eb2ceb948f76e440a/f058b/%EC%8A%A4%ED%81%AC%EB%A6%B0%EC%83%B7%202024-12-07%20%EC%98%A4%ED%9B%84%202.47.10.png 630w,
/static/1c117bca6138d73eb2ceb948f76e440a/2e195/%EC%8A%A4%ED%81%AC%EB%A6%B0%EC%83%B7%202024-12-07%20%EC%98%A4%ED%9B%84%202.47.10.png 782w&quot; sizes=&quot;(max-width: 630px) 100vw, 630px&quot; style=&quot;width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;&quot; loading=&quot;lazy&quot; decoding=&quot;async&quot;&gt;
  &lt;/a&gt;
    &lt;/span&gt;
&lt;/div&gt;
&lt;/br&gt;
&lt;ul&gt;
&lt;li&gt;레코드는 타임스탬프, 헤더, 오프셋, 메시지 키, 메시지 값으로 구성되어 있다. Producer가 생성한 레코드가 브로커로 전송되면, 타임스탬프와 오프셋이 지정된다. 브로커에 한 번 적재된 데이터는 수정 불가하고, retention 정책(용량/기간)에 의해서만 삭제될 수 있다.&lt;/li&gt;
&lt;li&gt;레코드의 &lt;code class=&quot;language-text&quot;&gt;타임스탬프(timestamp)&lt;/code&gt;는 스트림 프로레싱에서 활용하기 위해 시간을 저장하는 용도로 사용된다. 카프카 0.10.0.0 이후 버전부터 추가된 타임스탬프는 Unix timestamp가 포함되며, 프로듀서가 따로 설정하지 않으면 기본적으로는 프로듀스 레코드의 생성 시간이 기록된다. &lt;code class=&quot;language-text&quot;&gt;message.timestamp.type&lt;/code&gt;을 지정하면 브로커 적재 시간 (Log Append Time)으로 설정할 수도 있다.&lt;/li&gt;
&lt;li&gt;레코드의 &lt;code class=&quot;language-text&quot;&gt;오프셋(offset)&lt;/code&gt;은 프로듀서가 전송한 레코드가 브로커에 저장될 때 지정된다. 오프셋은 0부터 시작하여 1씩 증가된다. 컨슈머는 오프셋을 기반으로 처리한 데이터와 앞으로 처리해야 할 데이터를 구분한다. 각 메시지는 파티션별로 고유한 오프셋을 가지므로 컨슈머에서 중복 처리하지 않기 위한 용도로도 사용된다.&lt;/li&gt;
&lt;li&gt;레코드의 &lt;code class=&quot;language-text&quot;&gt;헤더(header)&lt;/code&gt;는 0.11부터 제공된 기능이다. key/value 데이터를 추가할 수 있으며 레코드의 스키마 버전이나 포맷과 같이 데이터 프로세싱에 참고될만한 정보를 담아 사용할 수 있다.&lt;/li&gt;
&lt;li&gt;&lt;code class=&quot;language-text&quot;&gt;메시지 키(key)&lt;/code&gt;는 처리하고자 하는 메시지를 구분하는 용도로 사용되며, 이를 &lt;code class=&quot;language-text&quot;&gt;파티셔닝(Partitioning)&lt;/code&gt;이라고 한다. 파티셔닝에 사용되는 메시지 키는 &lt;code class=&quot;language-text&quot;&gt;파티셔너(Partitioner)&lt;/code&gt;에 따라 토픽의 파티션 번호가 지정된다. 파티셔너는 레코드가 토픽 내 어느 파티션으로 전해지는 지를 정해주는 역할을 한다. 키는 필수 값이 아니라 값이 없으면 null로 되며 메시지 키가 null인 레코드는 특정 토픽 파티션에 라운드 로빈으로 전해진다. 키 값이 null이 아니면  키의 해쉬값에 따라 특정 파티션에 전달된다. 즉, 같은 키 값의 데이터들은 같은 파티션에 순서대로 전달되므로 순서가 보장된다고 볼 수 있다.&lt;/li&gt;
&lt;li&gt;&lt;code class=&quot;language-text&quot;&gt;메시지 값(value)&lt;/code&gt;은 실절적으로 처리할 데이터가 담기는 공간이다. 메시지 포맷은 제너릭으로 사용자에 의해 정해진다. Float, []Byte, String 등 다양한 형태로 지정 가능하며, 필요에 따라 사용자 지정 포맷으로 직렬화/역직렬화 클래스를 만들어서 사용할 수 있다. 메시지에 어떤 값으로 직렬화/역직렬화되어 저장되었는지 알 수 없으므로 컨슈머는 미리 역직렬화 포맷을 알고 있어야 한다.&lt;/li&gt;
&lt;/ul&gt;</content:encoded></item><item><title><![CDATA[2-5) ISR (In-Sync-Replicas)]]></title><description><![CDATA[은 브로커의 또 다른 역할 중 하나이다. 는 리더 파티션과 팔로워 파티션이 모두 싱크된다는 의미이다. 즉, 리더 파티션의 모든 데이터가 팔로워 파티션에 모두 복제된 상태를 의미한다. 만약, ISR…]]></description><link>https://github.com/SiverPineValley/SiverPineValley.github.io/kafka/kafka_2_5/</link><guid isPermaLink="false">https://github.com/SiverPineValley/SiverPineValley.github.io/kafka/kafka_2_5/</guid><pubDate>Sat, 07 Dec 2024 15:00:00 GMT</pubDate><content:encoded>&lt;ul&gt;
&lt;li&gt;&lt;code class=&quot;language-text&quot;&gt;복제(replication)&lt;/code&gt;은 브로커의 또 다른 역할 중 하나이다.&lt;/li&gt;
&lt;/ul&gt;
&lt;/br&gt;
&lt;div align=&quot;left&quot;&gt;
  &lt;span class=&quot;gatsby-resp-image-wrapper&quot; style=&quot;position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 630px; &quot;&gt;
      &lt;a class=&quot;gatsby-resp-image-link&quot; href=&quot;/static/cc5c38de8a407fdbe03bdc4d2f2dfa45/541fe/%EC%8A%A4%ED%81%AC%EB%A6%B0%EC%83%B7%202024-12-07%20%EC%98%A4%ED%9B%84%202.43.26.png&quot; style=&quot;display: block&quot; target=&quot;_blank&quot; rel=&quot;noopener&quot;&gt;
    &lt;span class=&quot;gatsby-resp-image-background-image&quot; style=&quot;padding-bottom: 45.56962025316456%; position: relative; bottom: 0; left: 0; background-image: url(&apos;data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAJCAYAAAAywQxIAAAACXBIWXMAABYlAAAWJQFJUiTwAAABcklEQVR42nVRR6sCYRDb368evApebBd7wYIeRFcQEQQ7igXBtiBeLOhaIgn4nvB8A2Fms0y+mYxRq9UQiURQr9fButFooNlsIpvNolqtiuv3+2Dcbjfc7/cfPB6PPzBWqxUmkwmY5/O5sNvtMJvNsFwuhf1+j2/xVfD5fOon87s+Ho+YTqcYjUYCH7EsC4PBAJ1OB91uF+PxGOfzWVNfr1fYtq3a+FyBJKPdbsPn88E0TVQqFfj9fiSTSVlDG8h7vV49xCEoeLlccDgcYHyOS1EGpygUCthsNkIqlZKn9HO9XosLh8NYLBYSomXM3OxfQQqwgUgkEvoul8uaihwFW62Wam5EG7bb7XfBXq+HaDSKUqkkxGIxCZLL5XLiQqGQxNjD6YjT6fQryB80lTEcDiWQTqeRz+eVM5kMisWivCQXj8e1KnsoxAPRSwm+L8VXaDIv6/F44HQ64XK5EAwG5R8P4XA44Ha7EQgE5Cf73xemxguyN4aWolnubgAAAABJRU5ErkJggg==&apos;); background-size: cover; display: block;&quot;&gt;&lt;/span&gt;
  &lt;img class=&quot;gatsby-resp-image-image&quot; alt=&quot;     2024 12 07    2 43 26&quot; title=&quot;&quot; src=&quot;/static/cc5c38de8a407fdbe03bdc4d2f2dfa45/f058b/%EC%8A%A4%ED%81%AC%EB%A6%B0%EC%83%B7%202024-12-07%20%EC%98%A4%ED%9B%84%202.43.26.png&quot; srcset=&quot;/static/cc5c38de8a407fdbe03bdc4d2f2dfa45/c26ae/%EC%8A%A4%ED%81%AC%EB%A6%B0%EC%83%B7%202024-12-07%20%EC%98%A4%ED%9B%84%202.43.26.png 158w,
/static/cc5c38de8a407fdbe03bdc4d2f2dfa45/6bdcf/%EC%8A%A4%ED%81%AC%EB%A6%B0%EC%83%B7%202024-12-07%20%EC%98%A4%ED%9B%84%202.43.26.png 315w,
/static/cc5c38de8a407fdbe03bdc4d2f2dfa45/f058b/%EC%8A%A4%ED%81%AC%EB%A6%B0%EC%83%B7%202024-12-07%20%EC%98%A4%ED%9B%84%202.43.26.png 630w,
/static/cc5c38de8a407fdbe03bdc4d2f2dfa45/40601/%EC%8A%A4%ED%81%AC%EB%A6%B0%EC%83%B7%202024-12-07%20%EC%98%A4%ED%9B%84%202.43.26.png 945w,
/static/cc5c38de8a407fdbe03bdc4d2f2dfa45/78612/%EC%8A%A4%ED%81%AC%EB%A6%B0%EC%83%B7%202024-12-07%20%EC%98%A4%ED%9B%84%202.43.26.png 1260w,
/static/cc5c38de8a407fdbe03bdc4d2f2dfa45/541fe/%EC%8A%A4%ED%81%AC%EB%A6%B0%EC%83%B7%202024-12-07%20%EC%98%A4%ED%9B%84%202.43.26.png 1654w&quot; sizes=&quot;(max-width: 630px) 100vw, 630px&quot; style=&quot;width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;&quot; loading=&quot;lazy&quot; decoding=&quot;async&quot;&gt;
  &lt;/a&gt;
    &lt;/span&gt;
&lt;/div&gt;
&lt;/br&gt;
&lt;ul&gt;
&lt;li&gt;&lt;code class=&quot;language-text&quot;&gt;ISR(In-Sync-Replicas)&lt;/code&gt;는 리더 파티션과 팔로워 파티션이 모두 싱크된다는 의미이다. 즉, 리더 파티션의 모든 데이터가 팔로워 파티션에 모두 복제된 상태를 의미한다. 만약, ISR로 묶이지 않은 두 개의 브로커가 존재할 때 리더 파티션의 브로커에 장애가 발생해서 리더 파티션을 팔로워 파티션이 이어 받게 된다면 특정 데이터는 유실될 수 있다. 이러한 유실을 감수하더라도 리더 파티션을 선출할지를 결정하는 옵션이 &lt;code class=&quot;language-text&quot;&gt;unclean.leader.election.enable&lt;/code&gt; 이다.
&lt;ul&gt;
&lt;li&gt;unclean.leader.election.enable=true: 유실을 감수함. 복제가 안 된 팔로워 파티션을 리더로 승급.&lt;/li&gt;
&lt;li&gt;unclean.leader.election.enable=false: 유실을 감수하지 않음. 해당 브로커(ISR 상태의 브로커 혹은 리더 브로커)가 복구될 때 까지 중단.&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;/ul&gt;</content:encoded></item><item><title><![CDATA[2-4) 복제 (replication)]]></title><description><![CDATA[은 브로커의 또 다른 역할 중 하나이다. 데이터 복제는 카프카를 장애 허용 시스템 (fault tolerant system…]]></description><link>https://github.com/SiverPineValley/SiverPineValley.github.io/kafka/kafka_2_4/</link><guid isPermaLink="false">https://github.com/SiverPineValley/SiverPineValley.github.io/kafka/kafka_2_4/</guid><pubDate>Sat, 07 Dec 2024 14:50:00 GMT</pubDate><content:encoded>&lt;ul&gt;
&lt;li&gt;&lt;code class=&quot;language-text&quot;&gt;복제(replication)&lt;/code&gt;은 브로커의 또 다른 역할 중 하나이다.&lt;/li&gt;
&lt;/ul&gt;
&lt;/br&gt;
&lt;div align=&quot;left&quot;&gt;
  &lt;span class=&quot;gatsby-resp-image-wrapper&quot; style=&quot;position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 630px; &quot;&gt;
      &lt;a class=&quot;gatsby-resp-image-link&quot; href=&quot;/static/e3bb6e00fb92364d6a8f8d213dc80b61/5a791/%EC%8A%A4%ED%81%AC%EB%A6%B0%EC%83%B7%202024-12-07%20%EC%98%A4%ED%9B%84%202.41.51.png&quot; style=&quot;display: block&quot; target=&quot;_blank&quot; rel=&quot;noopener&quot;&gt;
    &lt;span class=&quot;gatsby-resp-image-background-image&quot; style=&quot;padding-bottom: 40.50632911392405%; position: relative; bottom: 0; left: 0; background-image: url(&apos;data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAICAYAAAD5nd/tAAAACXBIWXMAABYlAAAWJQFJUiTwAAABhElEQVR42j2SR4tqURCE74/XhQs3Ii4UUUFXBlDM2THngGEMg8qoCP6IGr6G9xbNvX26q7qqz3E2m42q1arK5bKy2az9VyoVfX9/azQaqVarKZ/Pq1AoqNFoqNPp6HQ6qd1uWy2Xy6lUKqler2s4HMqBIBQKye/3y+Vy2X8gEFCr1VIqlbLc4/HI6/UqEokoGo0aaSwWUzAYlNvtls/nUzgcVjwel9Pv93U+n3W/3zWfz/V8PjWdTtVsNk0h+eFw0G630/v91tfXlyldLpeW4/Byueh2u5kLp9frWRG52Fiv1wZCIYQQMZQ6QHoYNpvNtN1u1e12tVqtrK9YLMoBDBAbWEQdawDIMIDpdFrJZNKGoe6f+vF4rEQiYbvEHbs2y7Afj0ft93v9/PxYM8DBYGDroMYlsRYUQQjB9Xq1cy6Jvv8KscI+2Nfn8zGVTIXw8XhY/P7+6vV6mXJewWKxMAw1ziHnxh1ASIWAp8M3k8loMpmYSqZCwNMgALEGLoB+gjo58QejnQzXYTNAzwAAAABJRU5ErkJggg==&apos;); background-size: cover; display: block;&quot;&gt;&lt;/span&gt;
  &lt;img class=&quot;gatsby-resp-image-image&quot; alt=&quot;     2024 12 07    2 41 51&quot; title=&quot;&quot; src=&quot;/static/e3bb6e00fb92364d6a8f8d213dc80b61/f058b/%EC%8A%A4%ED%81%AC%EB%A6%B0%EC%83%B7%202024-12-07%20%EC%98%A4%ED%9B%84%202.41.51.png&quot; srcset=&quot;/static/e3bb6e00fb92364d6a8f8d213dc80b61/c26ae/%EC%8A%A4%ED%81%AC%EB%A6%B0%EC%83%B7%202024-12-07%20%EC%98%A4%ED%9B%84%202.41.51.png 158w,
/static/e3bb6e00fb92364d6a8f8d213dc80b61/6bdcf/%EC%8A%A4%ED%81%AC%EB%A6%B0%EC%83%B7%202024-12-07%20%EC%98%A4%ED%9B%84%202.41.51.png 315w,
/static/e3bb6e00fb92364d6a8f8d213dc80b61/f058b/%EC%8A%A4%ED%81%AC%EB%A6%B0%EC%83%B7%202024-12-07%20%EC%98%A4%ED%9B%84%202.41.51.png 630w,
/static/e3bb6e00fb92364d6a8f8d213dc80b61/40601/%EC%8A%A4%ED%81%AC%EB%A6%B0%EC%83%B7%202024-12-07%20%EC%98%A4%ED%9B%84%202.41.51.png 945w,
/static/e3bb6e00fb92364d6a8f8d213dc80b61/5a791/%EC%8A%A4%ED%81%AC%EB%A6%B0%EC%83%B7%202024-12-07%20%EC%98%A4%ED%9B%84%202.41.51.png 1248w&quot; sizes=&quot;(max-width: 630px) 100vw, 630px&quot; style=&quot;width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;&quot; loading=&quot;lazy&quot; decoding=&quot;async&quot;&gt;
  &lt;/a&gt;
    &lt;/span&gt;
&lt;/div&gt;
&lt;/br&gt;
&lt;ul&gt;
&lt;li&gt;데이터 복제는 카프카를 장애 허용 시스템 (fault tolerant system)으로 동작하게 하는 원동력이다. 복제는 클러스터로 묶인 일부에 장애가 발생하더라도, 데이터를 유실하지 않고 안전하게 사용하기 위함이다. 카프카의 데이터 복제는 파티션 단위로 이루어지는데, 토픽이 생성될 때 파티션의 복제 개수 (replication factor)에 따라 파티션 복제 개수가 설정된다. 최소 값은 1 (복제 없음) 이고, 최대는 브로커의 개수만큼이다.&lt;/li&gt;
&lt;li&gt;복제된 파티션은 &lt;code class=&quot;language-text&quot;&gt;리더(leader)&lt;/code&gt;와 &lt;code class=&quot;language-text&quot;&gt;팔로워(follower)&lt;/code&gt;로 이루어진다. 프로듀서/컨슈머와 직접 통신하는 파티션을 리더, 나머지 복제된 데이터를 가진 파티션을 팔로워라고 한다. 팔로워 파티션은 리더 파티션의 오프셋을 확인하여 자신이 가진 오프셋과 차이가 나는 경우 리더 파티션으로 부터 데이터를 가져와 저장하는데, 이를 복제라고 한다.&lt;/li&gt;
&lt;li&gt;파티션 복제로 인해 나머지 팔로워에도 같은 내용이 저장되므로, 복제 개수 만큼 저장 용량이 증가한다는 단점이 있다. 그러나, &lt;strong&gt;복제를 통해 데이터를 안전하게 사용할 수 있다는 강력한 장점 때문에 카프카를 사용할 때 2 이상의 복제를 두는 것이 중요하다.&lt;/strong&gt;&lt;/li&gt;
&lt;li&gt;브로커에 장애가 발생해 다운되면, 팔로워 파티션 중 하나가 리더 파티션으로 승급된다. 이를 통해 데이터가 유실되지 않고 컨슈머나 프로듀서와 데이터를 주고 받도록 동작할 수 있다. 운영 시에는 데이터/토픽 마다 이러한 복제 개수를 다르게 설정하기도 한다. 속도가 중요하다면 복제의 개수를 조금 줄이고, 금융권 같이 데이터의 유실이 적어야 한다면 3 이상으로 설정하기도 한다.&lt;/li&gt;
&lt;/ul&gt;</content:encoded></item><item><title><![CDATA[2-3) 로그와 세그먼트]]></title><description><![CDATA[데이터의 저장은 브로커의 역할 중 하나이다. 카프카를 실행할 때 config/server.properties의  옵션에 지정한 경로에 데이터를 저장한다. (토픽 이름 + Partition…]]></description><link>https://github.com/SiverPineValley/SiverPineValley.github.io/kafka/kafka_2_3/</link><guid isPermaLink="false">https://github.com/SiverPineValley/SiverPineValley.github.io/kafka/kafka_2_3/</guid><pubDate>Sat, 07 Dec 2024 14:40:00 GMT</pubDate><content:encoded>&lt;ul&gt;
&lt;li&gt;데이터의 저장은 브로커의 역할 중 하나이다.&lt;/li&gt;
&lt;li&gt;카프카를 실행할 때 config/server.properties의 &lt;code class=&quot;language-text&quot;&gt;log.dir&lt;/code&gt; 옵션에 지정한 경로에 데이터를 저장한다. (토픽 이름 + Partition 번호를 조합)
- 해당 경로 안에는 여러 파일이 생성되는데, &lt;code class=&quot;language-text&quot;&gt;log&lt;/code&gt;에는 메시지와 메타데이터, &lt;code class=&quot;language-text&quot;&gt;index&lt;/code&gt;에는 메시지의 오프셋을 인덱싱한 파일, &lt;code class=&quot;language-text&quot;&gt;timeindex&lt;/code&gt; 파일에는 타임스탬프 값을 기준으로 인덱싱한 데이터가 저장된다.&lt;/li&gt;
&lt;/ul&gt;
&lt;/br&gt;
&lt;div align=&quot;left&quot;&gt;
  &lt;span class=&quot;gatsby-resp-image-wrapper&quot; style=&quot;position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 630px; &quot;&gt;
      &lt;a class=&quot;gatsby-resp-image-link&quot; href=&quot;/static/9533d0cb5bf8e7e8630fa376de89c1a4/8079d/%EC%8A%A4%ED%81%AC%EB%A6%B0%EC%83%B7%202024-12-07%20%EC%98%A4%ED%9B%84%202.35.55.png&quot; style=&quot;display: block&quot; target=&quot;_blank&quot; rel=&quot;noopener&quot;&gt;
    &lt;span class=&quot;gatsby-resp-image-background-image&quot; style=&quot;padding-bottom: 36.075949367088604%; position: relative; bottom: 0; left: 0; background-image: url(&apos;data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAHCAYAAAAIy204AAAACXBIWXMAABYlAAAWJQFJUiTwAAABkUlEQVR42nWOy8qSURiFvytw4ET7ElEnNWjSIIyg8gSmODED+5X8wz9n3oIXIXhMrUwUPHye8QCK4kx0ZiDiwIn38eTeUKMaPOz1Lt717qWkUilCoRCJREISj8d5+PLA/f1nYrHYjU/4fD78fv9/CQQCuFwukskkSiQSwW6343a7cTgcOJ1OXr96y4unL7E8sqE+VjEYDP/EaDRKVFVFp9Ph8XhQRKNgMEg0GiUcDnP38Y737z7w5rmbJ+ozrFYrNpvtL2K2WCwSk8kkMZvN6PV6vF4vynA4JJPJUCwWKRQK8v1R+Mm3r9/J5/Lk83np/aFUKkmEn81myeVyUqfTadrtNsp2u6Xb7TKbzRiNRnQ0jcGwf2OA1tWYTCaMx2P6/b7cE1oEp9Mpg8FA+iLX6/VYLBYoy+WSWq0mzVarRaVSoV6vU61WpdZuH4gDwiuXyzQaDdlI+EKLPZEXrZvNJsr1euVwODCfz2VwtVrd5l+cTieOxyP7/V6GRdPdbie98/nMer2m0+nIxoLNZsPlcuE3b61Yoi5JR9YAAAAASUVORK5CYII=&apos;); background-size: cover; display: block;&quot;&gt;&lt;/span&gt;
  &lt;img class=&quot;gatsby-resp-image-image&quot; alt=&quot;     2024 12 07    2 35 55&quot; title=&quot;&quot; src=&quot;/static/9533d0cb5bf8e7e8630fa376de89c1a4/f058b/%EC%8A%A4%ED%81%AC%EB%A6%B0%EC%83%B7%202024-12-07%20%EC%98%A4%ED%9B%84%202.35.55.png&quot; srcset=&quot;/static/9533d0cb5bf8e7e8630fa376de89c1a4/c26ae/%EC%8A%A4%ED%81%AC%EB%A6%B0%EC%83%B7%202024-12-07%20%EC%98%A4%ED%9B%84%202.35.55.png 158w,
/static/9533d0cb5bf8e7e8630fa376de89c1a4/6bdcf/%EC%8A%A4%ED%81%AC%EB%A6%B0%EC%83%B7%202024-12-07%20%EC%98%A4%ED%9B%84%202.35.55.png 315w,
/static/9533d0cb5bf8e7e8630fa376de89c1a4/f058b/%EC%8A%A4%ED%81%AC%EB%A6%B0%EC%83%B7%202024-12-07%20%EC%98%A4%ED%9B%84%202.35.55.png 630w,
/static/9533d0cb5bf8e7e8630fa376de89c1a4/40601/%EC%8A%A4%ED%81%AC%EB%A6%B0%EC%83%B7%202024-12-07%20%EC%98%A4%ED%9B%84%202.35.55.png 945w,
/static/9533d0cb5bf8e7e8630fa376de89c1a4/78612/%EC%8A%A4%ED%81%AC%EB%A6%B0%EC%83%B7%202024-12-07%20%EC%98%A4%ED%9B%84%202.35.55.png 1260w,
/static/9533d0cb5bf8e7e8630fa376de89c1a4/8079d/%EC%8A%A4%ED%81%AC%EB%A6%B0%EC%83%B7%202024-12-07%20%EC%98%A4%ED%9B%84%202.35.55.png 2100w&quot; sizes=&quot;(max-width: 630px) 100vw, 630px&quot; style=&quot;width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;&quot; loading=&quot;lazy&quot; decoding=&quot;async&quot;&gt;
  &lt;/a&gt;
    &lt;/span&gt;
&lt;/div&gt;
&lt;/br&gt;
&lt;ul&gt;
&lt;li&gt;로그 파일은 파일 시스템을 나눠서 저장하는데, 다음과 같은 설정에 의해 로그 세그먼트 파일의 크기가 정해진다. 로그 파일의 이름은 해당 파일의 offset 시작 번호이다. 현재 작성되고 있는 세그먼트 파일을 &lt;code class=&quot;language-text&quot;&gt;active segment&lt;/code&gt;라고 한다. 일반 세그먼트 파일은 retention 옵션에 따라 삭제 대상으로 지정된다.
&lt;ul&gt;
&lt;li&gt;&lt;code class=&quot;language-text&quot;&gt;log.segment.bytes&lt;/code&gt;: 바이트 단위의 최대 세그먼트 크기 기정 (기본값: 1GB)&lt;/li&gt;
&lt;li&gt;&lt;code class=&quot;language-text&quot;&gt;log.rolls.ms(hours)&lt;/code&gt;: 세그먼트가 신규 생성된 이후 다음 파일로 넘어가는 주기. (기본값: 7일)&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;/ul&gt;
&lt;/br&gt;
&lt;div align=&quot;left&quot;&gt;
  &lt;span class=&quot;gatsby-resp-image-wrapper&quot; style=&quot;position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 630px; &quot;&gt;
      &lt;a class=&quot;gatsby-resp-image-link&quot; href=&quot;/static/6c1d934de1b95cbf15b3b48ccf37b283/aae30/%EC%8A%A4%ED%81%AC%EB%A6%B0%EC%83%B7%202024-12-07%20%EC%98%A4%ED%9B%84%202.37.21.png&quot; style=&quot;display: block&quot; target=&quot;_blank&quot; rel=&quot;noopener&quot;&gt;
    &lt;span class=&quot;gatsby-resp-image-background-image&quot; style=&quot;padding-bottom: 36.708860759493675%; position: relative; bottom: 0; left: 0; background-image: url(&apos;data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAHCAYAAAAIy204AAAACXBIWXMAABYlAAAWJQFJUiTwAAABSUlEQVR42n2PucrCUBCF71uIQgoRRWMpamGlhQsIAcGlznMFF9yXuBBEIhZio2DlAwRFLH2H8zOHPyktPuZyZubMuco0TdRqNbTbbXQ6HTSbTVKv10m1WkUul0M2m/1JJpNBqVSCMgwDxWKRi5VKhRQKBaRSKUQiEWiahnA4/BOZC4VCSCaTUJKq0Wig1WoF6crlMvL5PKLRKHRdh55Os6b/qxwT4vE4SSQSiMViTKlOpxOWyyXW6zVs2w7qarXCeDwmk8mETKdTzOdzzGazoDcajchwOKSPul6vNDgcDtjtdlzcbDaBseM42O/3HJbedrulsfR93Q8gqPP5THd/sNfrscrVwWCAxWLBVPLudrs0tSyLO6LLvE+/34f6fr94Pp+4XC68eL/f8Xq98Pl8qD8eD6Y8Ho98e57H3u12YwjRXdeF/PT9fuMPN8NYvrD9UU0AAAAASUVORK5CYII=&apos;); background-size: cover; display: block;&quot;&gt;&lt;/span&gt;
  &lt;img class=&quot;gatsby-resp-image-image&quot; alt=&quot;     2024 12 07    2 37 21&quot; title=&quot;&quot; src=&quot;/static/6c1d934de1b95cbf15b3b48ccf37b283/f058b/%EC%8A%A4%ED%81%AC%EB%A6%B0%EC%83%B7%202024-12-07%20%EC%98%A4%ED%9B%84%202.37.21.png&quot; srcset=&quot;/static/6c1d934de1b95cbf15b3b48ccf37b283/c26ae/%EC%8A%A4%ED%81%AC%EB%A6%B0%EC%83%B7%202024-12-07%20%EC%98%A4%ED%9B%84%202.37.21.png 158w,
/static/6c1d934de1b95cbf15b3b48ccf37b283/6bdcf/%EC%8A%A4%ED%81%AC%EB%A6%B0%EC%83%B7%202024-12-07%20%EC%98%A4%ED%9B%84%202.37.21.png 315w,
/static/6c1d934de1b95cbf15b3b48ccf37b283/f058b/%EC%8A%A4%ED%81%AC%EB%A6%B0%EC%83%B7%202024-12-07%20%EC%98%A4%ED%9B%84%202.37.21.png 630w,
/static/6c1d934de1b95cbf15b3b48ccf37b283/40601/%EC%8A%A4%ED%81%AC%EB%A6%B0%EC%83%B7%202024-12-07%20%EC%98%A4%ED%9B%84%202.37.21.png 945w,
/static/6c1d934de1b95cbf15b3b48ccf37b283/78612/%EC%8A%A4%ED%81%AC%EB%A6%B0%EC%83%B7%202024-12-07%20%EC%98%A4%ED%9B%84%202.37.21.png 1260w,
/static/6c1d934de1b95cbf15b3b48ccf37b283/aae30/%EC%8A%A4%ED%81%AC%EB%A6%B0%EC%83%B7%202024-12-07%20%EC%98%A4%ED%9B%84%202.37.21.png 2080w&quot; sizes=&quot;(max-width: 630px) 100vw, 630px&quot; style=&quot;width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;&quot; loading=&quot;lazy&quot; decoding=&quot;async&quot;&gt;
  &lt;/a&gt;
    &lt;/span&gt;
&lt;/div&gt;
&lt;/br&gt;
&lt;ul&gt;
&lt;li&gt;세그먼트의 삭제 주기는 다음과 같은 옵션에 의해 정해진다. 세그먼트의 삭제는 파일 단위로 진행되므로, 특정 레코드(키, 값, 오프셋, 타임스탬프) 단위로는 삭제/수정이 불가능하다.
&lt;ul&gt;
&lt;li&gt;&lt;code class=&quot;language-text&quot;&gt;cleanup.policy=delete&lt;/code&gt;: 세그먼트의 삭제를 결정하는 옵션&lt;/li&gt;
&lt;li&gt;&lt;code class=&quot;language-text&quot;&gt;retention.ms(minitues, hours)&lt;/code&gt;: 세그먼트를 보유할 최대 기간. (기본값: 7일)&lt;/li&gt;
&lt;li&gt;&lt;code class=&quot;language-text&quot;&gt;retention.bytes&lt;/code&gt;: 파티션 당 로그 적재 바이트 값. (기본값: -1, 지정하지 않음)&lt;/li&gt;
&lt;li&gt;&lt;code class=&quot;language-text&quot;&gt;log.retention.check.interval.ms&lt;/code&gt;: 세그먼트가 삭제 영역에 들어왔는지 확인하는 간격. (기본값: 5분)&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;/ul&gt;
&lt;/br&gt;
&lt;div align=&quot;left&quot;&gt;
  &lt;span class=&quot;gatsby-resp-image-wrapper&quot; style=&quot;position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 630px; &quot;&gt;
      &lt;a class=&quot;gatsby-resp-image-link&quot; href=&quot;/static/9f776f048e7b9cb2d6e2b698d4a569f5/b8471/%EC%8A%A4%ED%81%AC%EB%A6%B0%EC%83%B7%202024-12-07%20%EC%98%A4%ED%9B%84%202.38.06.png&quot; style=&quot;display: block&quot; target=&quot;_blank&quot; rel=&quot;noopener&quot;&gt;
    &lt;span class=&quot;gatsby-resp-image-background-image&quot; style=&quot;padding-bottom: 46.835443037974684%; position: relative; bottom: 0; left: 0; background-image: url(&apos;data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAJCAYAAAAywQxIAAAACXBIWXMAABYlAAAWJQFJUiTwAAABiklEQVR42k1RyarCQBCcb/Ob/BDBfd8RUVFcERKNS3ynxIsLCCJGTx4U8ehSUg3xZaCZ6a7umu5qtVqtMJlMYBgGTNPEfD6HbdkwjT/omo71eo33+/2z1+sl9+fzgffQJ6YI8jyfz58RPDkn8LPz+fwj8drhcMB+v8fxeMRut8PtdhMedb1eBbBtG61WC91uF/1+H81mE41GA/V6HZ1OB71eD+12W+7hcChYrVZDtVqVmzmLxQKKI0UiESELhUJi4XAY0WgUwWBQ3oylUikEAgGJJRIJwd08+sT5iXTIlsmeTqdRLBZRKBTEcrmc+JlMBvF4XN7lclkKXYx5lUpFOtV1/V9D6kbz6sTzeDzg9/vh8/mw3W4lhzp7dfXWqfv9DsdxsNlsMB6PZdvT6VS2PZvNJMYOstms6DsajQRnN5qmyc0Y8yzLgiJRLBaTRVAHjsbR8/m8+NSHxvGoNXVjnDV8M8YaxrhAdblcsFwupRsGSUZzNXQ/ISlJqCc7dkmSyaTklUolDAYDfAEm2Uq6UJCkCAAAAABJRU5ErkJggg==&apos;); background-size: cover; display: block;&quot;&gt;&lt;/span&gt;
  &lt;img class=&quot;gatsby-resp-image-image&quot; alt=&quot;     2024 12 07    2 38 06&quot; title=&quot;&quot; src=&quot;/static/9f776f048e7b9cb2d6e2b698d4a569f5/f058b/%EC%8A%A4%ED%81%AC%EB%A6%B0%EC%83%B7%202024-12-07%20%EC%98%A4%ED%9B%84%202.38.06.png&quot; srcset=&quot;/static/9f776f048e7b9cb2d6e2b698d4a569f5/c26ae/%EC%8A%A4%ED%81%AC%EB%A6%B0%EC%83%B7%202024-12-07%20%EC%98%A4%ED%9B%84%202.38.06.png 158w,
/static/9f776f048e7b9cb2d6e2b698d4a569f5/6bdcf/%EC%8A%A4%ED%81%AC%EB%A6%B0%EC%83%B7%202024-12-07%20%EC%98%A4%ED%9B%84%202.38.06.png 315w,
/static/9f776f048e7b9cb2d6e2b698d4a569f5/f058b/%EC%8A%A4%ED%81%AC%EB%A6%B0%EC%83%B7%202024-12-07%20%EC%98%A4%ED%9B%84%202.38.06.png 630w,
/static/9f776f048e7b9cb2d6e2b698d4a569f5/40601/%EC%8A%A4%ED%81%AC%EB%A6%B0%EC%83%B7%202024-12-07%20%EC%98%A4%ED%9B%84%202.38.06.png 945w,
/static/9f776f048e7b9cb2d6e2b698d4a569f5/78612/%EC%8A%A4%ED%81%AC%EB%A6%B0%EC%83%B7%202024-12-07%20%EC%98%A4%ED%9B%84%202.38.06.png 1260w,
/static/9f776f048e7b9cb2d6e2b698d4a569f5/b8471/%EC%8A%A4%ED%81%AC%EB%A6%B0%EC%83%B7%202024-12-07%20%EC%98%A4%ED%9B%84%202.38.06.png 2016w&quot; sizes=&quot;(max-width: 630px) 100vw, 630px&quot; style=&quot;width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;&quot; loading=&quot;lazy&quot; decoding=&quot;async&quot;&gt;
  &lt;/a&gt;
    &lt;/span&gt;
&lt;/div&gt;
&lt;/br&gt;
&lt;ul&gt;
&lt;li&gt;세그먼트의 압축이란 zip 파일과 같은 파일의 압축(compression)과는 다른 개념이다. 여기서 압축이란 &lt;strong&gt;메시지의 키 별로 해당 메시지의 레코드 중 오래된 데이터를 삭제하는 정책&lt;/strong&gt;을 말한다. 그렇기 때문에 delete 와 다르게, 일부 레코드만 삭제될 수 있다. 압축은 세그먼트를 제외한 데이터가 대상이다. 이러한 compact 옵션은 key-value 스토어의 느낌으로 사용할 때 사용될 수 있다.
&lt;ul&gt;
&lt;li&gt;&lt;code class=&quot;language-text&quot;&gt;cleanup.policy=compact&lt;/code&gt;: 세그먼트를 압축하는 옵션.&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;li&gt;compact 옵션에는 테일/헤드 영역이 존재한다.
&lt;ul&gt;
&lt;li&gt;테일 영역 (클린 로그): 압축 정책에 의해 압축이 완료된 세그먼트. 중복 메시지 키가 없다.&lt;/li&gt;
&lt;li&gt;헤드 영역 (더티 로그): 압축 정책이 되기 전 레코드들. 중복된 메시지 키가 있다.&lt;/li&gt;
&lt;li&gt;&lt;code class=&quot;language-text&quot;&gt;min.cleanable.dirty.ratio&lt;/code&gt;: compact 옵션의 압축 시점은 테일 영역과 헤드 영역의 비율을 지정한 설정 값으로 정할 수 있다. 예를 들어 0.5로 설정 하면, 테일 영역과 헤드 영역의 수가 동일할 대 압축이 진행된다. 0.9인 경우 헤드 영역을 최대한 모았다가 한번에 압축하므로, 압축의 효율이 좋다. 0.1인 경우 자주 압축을 시도하므로 용량에서는 이점이 있다.&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;/ul&gt;
&lt;/br&gt;
&lt;div align=&quot;left&quot;&gt;
  &lt;span class=&quot;gatsby-resp-image-wrapper&quot; style=&quot;position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 630px; &quot;&gt;
      &lt;a class=&quot;gatsby-resp-image-link&quot; href=&quot;/static/7a85c3f54b3ba367ef73b58f1e63f7e5/3c2d4/%EC%8A%A4%ED%81%AC%EB%A6%B0%EC%83%B7%202024-12-07%20%EC%98%A4%ED%9B%84%202.38.51.png&quot; style=&quot;display: block&quot; target=&quot;_blank&quot; rel=&quot;noopener&quot;&gt;
    &lt;span class=&quot;gatsby-resp-image-background-image&quot; style=&quot;padding-bottom: 31.0126582278481%; position: relative; bottom: 0; left: 0; background-image: url(&apos;data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAGCAYAAADDl76dAAAACXBIWXMAABYlAAAWJQFJUiTwAAABOUlEQVR42lWRSYvCQBCF8/s9eAgJLvHsvkQFl4sKmoCCooLgjpBEvARBPGn0G6ohw0xB0dVVr14/Xmur1YrFYsF0OmUymTCbzZjP56zXaxzHwfd9JL7fL3F8Ph+Vf3sxRosLAbxeLw6HA8fjkTAMFej9fqu553ns93uCIFA4CXlss9lwOp3Ybrfc73c0WRag67pUKhWq1SrFYpFarYZt2wyHQ9rt9r++ZL/fp9frkc/n1V6pVGIwGKB1u12azSatVotEIkE2m8UwDFKpFLquUygUME1TpfQtyyKZTJLL5RSZYNLpNJlMRhFrt9uN6/XKeDxWCoS40WhQr9eVKlEop9xFsczK5TKdTofRaKRqmcmecGjij6R4JT4tl0vO5zOXy4Xn86n8ejwe7Ha7X79EhODjj4n/IIoifgCs55fFWqWxoQAAAABJRU5ErkJggg==&apos;); background-size: cover; display: block;&quot;&gt;&lt;/span&gt;
  &lt;img class=&quot;gatsby-resp-image-image&quot; alt=&quot;     2024 12 07    2 38 51&quot; title=&quot;&quot; src=&quot;/static/7a85c3f54b3ba367ef73b58f1e63f7e5/f058b/%EC%8A%A4%ED%81%AC%EB%A6%B0%EC%83%B7%202024-12-07%20%EC%98%A4%ED%9B%84%202.38.51.png&quot; srcset=&quot;/static/7a85c3f54b3ba367ef73b58f1e63f7e5/c26ae/%EC%8A%A4%ED%81%AC%EB%A6%B0%EC%83%B7%202024-12-07%20%EC%98%A4%ED%9B%84%202.38.51.png 158w,
/static/7a85c3f54b3ba367ef73b58f1e63f7e5/6bdcf/%EC%8A%A4%ED%81%AC%EB%A6%B0%EC%83%B7%202024-12-07%20%EC%98%A4%ED%9B%84%202.38.51.png 315w,
/static/7a85c3f54b3ba367ef73b58f1e63f7e5/f058b/%EC%8A%A4%ED%81%AC%EB%A6%B0%EC%83%B7%202024-12-07%20%EC%98%A4%ED%9B%84%202.38.51.png 630w,
/static/7a85c3f54b3ba367ef73b58f1e63f7e5/40601/%EC%8A%A4%ED%81%AC%EB%A6%B0%EC%83%B7%202024-12-07%20%EC%98%A4%ED%9B%84%202.38.51.png 945w,
/static/7a85c3f54b3ba367ef73b58f1e63f7e5/78612/%EC%8A%A4%ED%81%AC%EB%A6%B0%EC%83%B7%202024-12-07%20%EC%98%A4%ED%9B%84%202.38.51.png 1260w,
/static/7a85c3f54b3ba367ef73b58f1e63f7e5/3c2d4/%EC%8A%A4%ED%81%AC%EB%A6%B0%EC%83%B7%202024-12-07%20%EC%98%A4%ED%9B%84%202.38.51.png 2092w&quot; sizes=&quot;(max-width: 630px) 100vw, 630px&quot; style=&quot;width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;&quot; loading=&quot;lazy&quot; decoding=&quot;async&quot;&gt;
  &lt;/a&gt;
    &lt;/span&gt;
&lt;/div&gt;
&lt;/br&gt;</content:encoded></item><item><title><![CDATA[2-2) Kafka 클러스터와 브로커, 주키퍼]]></title><description><![CDATA[2-2-1) Kafka…]]></description><link>https://github.com/SiverPineValley/SiverPineValley.github.io/kafka/kafka_2_2/</link><guid isPermaLink="false">https://github.com/SiverPineValley/SiverPineValley.github.io/kafka/kafka_2_2/</guid><pubDate>Sat, 07 Dec 2024 14:30:00 GMT</pubDate><content:encoded>&lt;div align=&quot;left&quot;&gt;
  &lt;span class=&quot;gatsby-resp-image-wrapper&quot; style=&quot;position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 630px; &quot;&gt;
      &lt;a class=&quot;gatsby-resp-image-link&quot; href=&quot;/static/a5139ec17433710f00b73bc3763bb5c1/7b1dc/%EC%8A%A4%ED%81%AC%EB%A6%B0%EC%83%B7%202024-12-07%20%EC%98%A4%ED%9B%84%202.31.22.png&quot; style=&quot;display: block&quot; target=&quot;_blank&quot; rel=&quot;noopener&quot;&gt;
    &lt;span class=&quot;gatsby-resp-image-background-image&quot; style=&quot;padding-bottom: 44.93670886075949%; position: relative; bottom: 0; left: 0; background-image: url(&apos;data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAJCAYAAAAywQxIAAAACXBIWXMAABYlAAAWJQFJUiTwAAAB8klEQVR42k1R227aQBD1D1XNU6XS5r/6HVWf+wdpm5dKiFsMocE1BJmrzcU2BHzB2GvAhKt9OuvQpiMdzczu2bNnNEKcAOwUI+A4JvCPLzU7JdRTPidgMRByHpEDOmcX+IfzC4fX9OaZuEKL7XFdNPGxNEEmp18wRqYwwbtbBW8+f8PbL98p3+Dqaw6ZvIH3xEmRHeFDXsd1wcBVdoxPigshOp5RdSPcqk/IT5YoPgWvmPooGS5uGn387OhUOyjNGIHf+7ibh/jRNZEd2yhaK2jhDgISmoUi2mwQxzH+xna9QluW0G7IeKw94FF6gEL9TB/h/wh8H4f9/l8vRNst3IUH3TAxt2z4AcNm+wx1MIBYqUCSZeQKRcj1Rory/S8E4QoBC7EkseFoDHMypTrAbn+AsF6vMZvNoKoqdF2H53lpvhPL+F2vo99XUancU+6nHFEUEUURGGOwbBvD4RAD+tymekdOXwXpgWma5HaBBaHZbKJWq6HT7ZK4CEVR0CPBarUKwzBSjuM40LQBVAIX3+1IMAxDTKdTdHs9GnOYCnreEnVyJ8t1dElQLJfR7nRSl1yQuxrRqLbtpK65Q8uySJCWsiebXHQ+n8NxF9jQchJaFHfQarXQo48kSULnIqhpGmK630TbdGzuko+7oiWezif8AYUygkyeFVk7AAAAAElFTkSuQmCC&apos;); background-size: cover; display: block;&quot;&gt;&lt;/span&gt;
  &lt;img class=&quot;gatsby-resp-image-image&quot; alt=&quot;     2024 12 07    2 31 22&quot; title=&quot;&quot; src=&quot;/static/a5139ec17433710f00b73bc3763bb5c1/f058b/%EC%8A%A4%ED%81%AC%EB%A6%B0%EC%83%B7%202024-12-07%20%EC%98%A4%ED%9B%84%202.31.22.png&quot; srcset=&quot;/static/a5139ec17433710f00b73bc3763bb5c1/c26ae/%EC%8A%A4%ED%81%AC%EB%A6%B0%EC%83%B7%202024-12-07%20%EC%98%A4%ED%9B%84%202.31.22.png 158w,
/static/a5139ec17433710f00b73bc3763bb5c1/6bdcf/%EC%8A%A4%ED%81%AC%EB%A6%B0%EC%83%B7%202024-12-07%20%EC%98%A4%ED%9B%84%202.31.22.png 315w,
/static/a5139ec17433710f00b73bc3763bb5c1/f058b/%EC%8A%A4%ED%81%AC%EB%A6%B0%EC%83%B7%202024-12-07%20%EC%98%A4%ED%9B%84%202.31.22.png 630w,
/static/a5139ec17433710f00b73bc3763bb5c1/40601/%EC%8A%A4%ED%81%AC%EB%A6%B0%EC%83%B7%202024-12-07%20%EC%98%A4%ED%9B%84%202.31.22.png 945w,
/static/a5139ec17433710f00b73bc3763bb5c1/7b1dc/%EC%8A%A4%ED%81%AC%EB%A6%B0%EC%83%B7%202024-12-07%20%EC%98%A4%ED%9B%84%202.31.22.png 956w&quot; sizes=&quot;(max-width: 630px) 100vw, 630px&quot; style=&quot;width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;&quot; loading=&quot;lazy&quot; decoding=&quot;async&quot;&gt;
  &lt;/a&gt;
    &lt;/span&gt;
&lt;/div&gt;
&lt;/br&gt;
&lt;h3&gt;2-2-1) Kafka 클러스터와 브로커&lt;/h3&gt;
&lt;ul&gt;
&lt;li&gt;&lt;code class=&quot;language-text&quot;&gt;카프카 브로커(Kafka Broker)&lt;/code&gt;는 카프카 클라이언트와 데이터를 주고받기 위해 사용하는 주체이자, 데이터를 분산 저장하여 장애 상황에서도 데이터를 안전하게 사용할 수 있도록 도와주는 애플리케이션이다. 보통 브로커는 하나의 서버에서 한개의 프로세스만 동작하는 인스턴스 단위로 이러한 브로커들이 모여 클러스터를 형성한다. 카프카 클러스터로 묶인 브로커들은 프로듀서가 보낸 데이터를 안전하게 분산 저장하고 복제하는 역할을 한다. 브로커는 다음과 같은 역할들을 한다.
&lt;ul&gt;
&lt;li&gt;&lt;code class=&quot;language-text&quot;&gt;컨트롤러&lt;/code&gt;는 클러스터 내 다수의 브로커 중 한대가 역할을 수행하며, 다른 브로커들의 상태를 체크하고, 브로커가 클러스터에서 빠지는 경우 해당 브로커에 존재하는 &lt;code class=&quot;language-text&quot;&gt;리더 파티션(Leader Partition)&lt;/code&gt;을 재분배한다. 카프카는 지속적으로 데이터를 처리해야 하므로 브로커의 상태가 비정상이라면 빠르게 클러스터에서 빼내는 것이 중요하다. 만약 컨트롤러 브로커에 장애가 생기면, 다른 브로커가 컨트롤러 역할을 한다.&lt;/li&gt;
&lt;li&gt;&lt;code class=&quot;language-text&quot;&gt;데이터 삭제&lt;/code&gt;: 카프카는 다른 메세징 플랫폼과 다르게 컨슈머가 메시지를 가져가더라도 토픽의 데이터는 삭제되지 않는다. 또한, 컨슈퍼나 프로듀서가 데이터 삭제를 요청할 수 도 없다. 오직 브로커만이 데이터를 삭제할 수 있다. 데이터 삭제는 파일 단위로 이루어지는데 이를 &lt;code class=&quot;language-text&quot;&gt;로그 세그먼트(log segment)&lt;/code&gt; 라고 부른다. 이 세그먼트에는 다수의 데이터가 들어가 있기 때문에 일반적인 데이터베이스처럼 데이터를 선별해서 삭제할 수 없다.&lt;/li&gt;
&lt;li&gt;&lt;code class=&quot;language-text&quot;&gt;컨슈머 Offset 저장&lt;/code&gt;: &lt;code class=&quot;language-text&quot;&gt;컨슈머 그룹(Consumer Group)&lt;/code&gt;은 토픽이 특정 파티션으로부터 데이터를 가져가서 처리하고 이 파티션의 어느 레코드까지 가져갔는지를 확인하기 위해 offset을 커밋한다. 커밋한 오프셋은 &lt;code class=&quot;language-text&quot;&gt;__consumer_offset&lt;/code&gt; 토픽에 저장된다. 여기에 저장된 offset을 토대로 컨슈머 그룹은 다음 레코드를 가져가서 처리한다.&lt;/li&gt;
&lt;li&gt;&lt;code class=&quot;language-text&quot;&gt;그룹 코디네이터(Group Cordinator)&lt;/code&gt;: 코디네이터는 컨슈머 그룹의 상태를 체크하고 파티션을 컨슈머와 매칭되도록 분배하는 역할을 한다. 컨슈머가 컨슈머 그룹에서 빠지면 매핑되지 않는 파티션을 정상 동작하는 컨슈머로 할당하여 끊임없이 데이터가 처리되도록 도와준다. 이렇게 파티션을 컨슈머로 재할당하는 과정을 &lt;code class=&quot;language-text&quot;&gt;리밸런스(reblalance)&lt;/code&gt; 라고 한다.&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;/ul&gt;
&lt;h3&gt;2-2-2) 주키퍼&lt;/h3&gt;
&lt;ul&gt;
&lt;li&gt;​&lt;code class=&quot;language-text&quot;&gt;주키퍼(Zookeeper)&lt;/code&gt;는 카프카 클러스터를 실행하기 위해서 필요한 애플리케이션이다.
&lt;ul&gt;
&lt;li&gt;주키퍼는 분산형 Configuration 정보를 유지하고 &apos;분산 시스템에서 동기화 서비스를 제공하는 소프트웨어&apos;이다. 카프카에서 Zookeeper를 사용하는데, 여기서는 분산된 Broker들을 관리하는 용도로 사용된다. 즉, Broker들의 목록이나 설정 정보를 관리하며 Zookeeper는 변경사항(Topic 생성 및 제거, Broker 생성 및 제거 등)이 발생하면 모든 Broker들에게 알린다.&lt;/li&gt;
&lt;li&gt;Zookeeper는 카프카의 Broker, Topic, Partition의 개수 등에 대한 정보를 가지고 있다. 이러한 정보들은 Zookeeper의 리더가 가지고 있고 팔로워가 읽어가 Broker들에 동기화를 해 주는 작업을 진행한다. Zookeeper는 분산 시스템의 정보를 제어하기 위해 Tree 형태로 데이터를 관리하며 동기화 작업을 수행한다. 주키퍼의 root znode에 여러 개의 znode를 생성하여 각 znode당 하나의 클러스터를 연결한다. Kafka 3.0 부터는 주키퍼 없이도 동작이 가능하다.&lt;/li&gt;
&lt;li&gt;Zookeeper 없이는 카프카가 동작할 수 없다. 하지만 최근 Zookeeper를 제거하는 방식을 개발 중에 있다.&lt;/li&gt;
&lt;li&gt;Zookeeper 서버는 홀수로 구성해야 한다. 보통 Zookeeper 서버 3개를 구성한다. (1개는 불가능)&lt;/li&gt;
&lt;li&gt;Zookeeper에는 리더가 있고 나머지 서버에는 팔로워로 구성된다. 리더는 write를하고 팔로워는 read를 한다. 위 Zookeeper 아키텍처 그림에서 보면, 하나의 리더에서 팔로워들이 데이터를 가져가서 클라이언트(여기서는 Broker)에 동기화하는 작업을 진행한다.&lt;/li&gt;
&lt;li&gt;위와 같이 홀수로 구성된 Zookeeper 클러스터 형태를 Zookeeper Ensemble(주키퍼 앙상블)이라고 한다.&lt;/li&gt;
&lt;li&gt;주키퍼의 수를 홀수로 유지해야 하는 이유는 &lt;code class=&quot;language-text&quot;&gt;Quorum(쿼럼)&lt;/code&gt; 알고리즘을 사용하기 때문이다.Quorum(쿼럼)은 특정 합의체에서 의결을 하는데 필요한 &apos;일정 구성원의 수&apos;를 의미한다. 즉, Zookeeper 앙상블에서 무언가를 의결하기 위해서는 과반수 이상의 Zookeeper서버가 필요하다는 것이다. 이러한 방식으로 Zookeeper가 동작하는 이유는 분산 환경에서 예상치 못한 장애가 발생해도 분산 시스템의 일관성을 유지할 수 있기 때문이다.&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;/ul&gt;</content:encoded></item><item><title><![CDATA[2-1) 오픈 소스 Apache Kafka 생태계]]></title><description><![CDATA[Kafka 클러스터는 여러 개의 브로커로 이루어져 있으며 토픽 단위로 데이터가 저장된다. 데이터의 최초 제공자는 Producer라고 하며, Consumer가 토픽을 구독하였다가 이를 받아가는 형태이다. Kafka의 모든 기능들은 Java…]]></description><link>https://github.com/SiverPineValley/SiverPineValley.github.io/kafka/kafka_2_1/</link><guid isPermaLink="false">https://github.com/SiverPineValley/SiverPineValley.github.io/kafka/kafka_2_1/</guid><pubDate>Sat, 07 Dec 2024 14:00:00 GMT</pubDate><content:encoded>&lt;div align=&quot;left&quot;&gt;
  &lt;span class=&quot;gatsby-resp-image-wrapper&quot; style=&quot;position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 630px; &quot;&gt;
      &lt;a class=&quot;gatsby-resp-image-link&quot; href=&quot;/static/aa0fed06a9faf371c7076a11ef8aa68c/3a1b1/%EC%8A%A4%ED%81%AC%EB%A6%B0%EC%83%B7%202024-12-07%20%EC%98%A4%ED%9B%84%202.28.57.png&quot; style=&quot;display: block&quot; target=&quot;_blank&quot; rel=&quot;noopener&quot;&gt;
    &lt;span class=&quot;gatsby-resp-image-background-image&quot; style=&quot;padding-bottom: 50%; position: relative; bottom: 0; left: 0; background-image: url(&apos;data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAKCAYAAAC0VX7mAAAACXBIWXMAABYlAAAWJQFJUiTwAAABz0lEQVR42m1SacsxQBSd/+0HWIpkDx+ED5ZIyr6WJWu2KFkjQrJH1vN0b3l6enunTjPNXeacc0d8Ph/8Xe/3G6/Xi8/n8xk2mw0ymQxarRaxWAzffNr/raUlrtcrjscj43Q64fF4MKgx3Wk0GkgkEkilUvh8Puz3e2y3W8693W58Xq/XDIqJVqsFr9cLt9uNSCSCZrOJxWKB5XIJiqlUKqRSKbhcLhgMBpTLZWQyGeRyOY4Xi0Vmnkwmkc/nIcbjMUqlEiqVChqNBr+8Wq1+YbVaYTabuVkwGOQGSqWSd7KGCFSrVa7vdDoQvV4PiUQC8Xick2q1GjNIp9PMmLyjuN/vh9FoRKFQQDQaRTab5QaBQIAZhsNhhphOp9ykXq+zBPLC4/HA4XDwPTEkdjqdjmUPh0NW0u/32RY6k3wiQ/Wi3W4jFArxK8SK6BMLAr2o1+uZMfksl8vZQ7JoNBqh2+1yjdPp5Djlic1mg8FgwAnk5+FwwGw2w2QywXw+h8lkYtlqtZoHt9vtmAmBfgP9Etrv9ztPXfzvL33vaEB2u51ZEAOFQsHSSDqxoslSw7//UtCk/oL+3/P55ODlcuGGFovld8rkGykhkBLKpZovfgDiMq98Cpv41AAAAABJRU5ErkJggg==&apos;); background-size: cover; display: block;&quot;&gt;&lt;/span&gt;
  &lt;img class=&quot;gatsby-resp-image-image&quot; alt=&quot;     2024 12 07    2 28 57&quot; title=&quot;&quot; src=&quot;/static/aa0fed06a9faf371c7076a11ef8aa68c/f058b/%EC%8A%A4%ED%81%AC%EB%A6%B0%EC%83%B7%202024-12-07%20%EC%98%A4%ED%9B%84%202.28.57.png&quot; srcset=&quot;/static/aa0fed06a9faf371c7076a11ef8aa68c/c26ae/%EC%8A%A4%ED%81%AC%EB%A6%B0%EC%83%B7%202024-12-07%20%EC%98%A4%ED%9B%84%202.28.57.png 158w,
/static/aa0fed06a9faf371c7076a11ef8aa68c/6bdcf/%EC%8A%A4%ED%81%AC%EB%A6%B0%EC%83%B7%202024-12-07%20%EC%98%A4%ED%9B%84%202.28.57.png 315w,
/static/aa0fed06a9faf371c7076a11ef8aa68c/f058b/%EC%8A%A4%ED%81%AC%EB%A6%B0%EC%83%B7%202024-12-07%20%EC%98%A4%ED%9B%84%202.28.57.png 630w,
/static/aa0fed06a9faf371c7076a11ef8aa68c/40601/%EC%8A%A4%ED%81%AC%EB%A6%B0%EC%83%B7%202024-12-07%20%EC%98%A4%ED%9B%84%202.28.57.png 945w,
/static/aa0fed06a9faf371c7076a11ef8aa68c/78612/%EC%8A%A4%ED%81%AC%EB%A6%B0%EC%83%B7%202024-12-07%20%EC%98%A4%ED%9B%84%202.28.57.png 1260w,
/static/aa0fed06a9faf371c7076a11ef8aa68c/3a1b1/%EC%8A%A4%ED%81%AC%EB%A6%B0%EC%83%B7%202024-12-07%20%EC%98%A4%ED%9B%84%202.28.57.png 1686w&quot; sizes=&quot;(max-width: 630px) 100vw, 630px&quot; style=&quot;width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;&quot; loading=&quot;lazy&quot; decoding=&quot;async&quot;&gt;
  &lt;/a&gt;
    &lt;/span&gt;
&lt;/div&gt;
&lt;/br&gt;
&lt;ul&gt;
&lt;li&gt;Kafka 클러스터는 여러 개의 브로커로 이루어져 있으며 토픽 단위로 데이터가 저장된다. 데이터의 최초 제공자는 Producer라고 하며, Consumer가 토픽을 구독하였다가 이를 받아가는 형태이다.&lt;/li&gt;
&lt;li&gt;Kafka의 모든 기능들은 Java를 기반으로 구현되었기 때문에 go, javascript와 같은 3rd 파티 언어들의 라이브러리들에서는 모든 기능이 제공되지 않을 수도 있다.&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;Kafka Streams&lt;/strong&gt;: 토픽에 저장된 데이터를 stateful하게 혹은 stateless하게 데이터를 처리해서 토픽에 다시 데이터를 넣을 때 사용되는 라이브러리.&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;Connector&lt;/strong&gt;: 데이터 파이프라인을 운영하는 핵심적인 기능으로, Producer 역할을 하는 소스 커넥터와 Consumer 역할을 하는 싱크 커넥터로 구성되어 있다. 이러한 커넥터가 Producer, Consumer와 구분되는 점은 커넥터는 클러스터 단위로 운영되며, 파이프라인을 템플릿 단위로 지속적으로 반복적으로 여러 번 생성할 수 있고 운영된다는 점에서 차이가 있다. 이러한 특징은 Producer를 개별적으로 만들고 생성하는 것보다 효율적이다.&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;Mirror Maker&lt;/strong&gt;: 클러스터 단위로 데이터베이스 카프라를 운영할 때 특정 토픽의 데이터를 완벽하게 복제하기 위해 사용되는 툴.&lt;/li&gt;
&lt;/ul&gt;</content:encoded></item><item><title><![CDATA[1) Apache Kafka의 특징과 미래]]></title><description><![CDATA[1-1) Apache Kafka의 특징 특징 상세 설명 높은 데이터 처리량 Kafka는 Producer가 브로커로 데이터를 보낼 때, Consumer…]]></description><link>https://github.com/SiverPineValley/SiverPineValley.github.io/kafka/kafka_1/</link><guid isPermaLink="false">https://github.com/SiverPineValley/SiverPineValley.github.io/kafka/kafka_1/</guid><pubDate>Sat, 07 Dec 2024 13:00:00 GMT</pubDate><content:encoded>&lt;h2&gt;1-1) Apache Kafka의 특징&lt;/h2&gt;
&lt;table&gt;
&lt;thead&gt;
&lt;tr&gt;
&lt;th&gt;특징&lt;/th&gt;
&lt;th&gt;상세 설명&lt;/th&gt;
&lt;/tr&gt;
&lt;/thead&gt;
&lt;tbody&gt;
&lt;tr&gt;
&lt;td&gt;높은 데이터 처리량&lt;/td&gt;
&lt;td&gt;Kafka는 Producer가 브로커로 데이터를 보낼 때, Consumer가 브로커로부터 데이터를 받을 때 묶어서 데이터를 전송한다. 많은 양의 데이터를 송수신할 때 맺어지는 네트워크 비용은 무시할 수 없는 규모인데, Kafka는 더 적은 횟수의 연결로 동일 시간 내에 더 많은 데이터를 처리할 수 있다. 따라서 대용량의 로그성 데이터를 처리하는데 적합하다. 또한, 파티션 단위를 통해 동일 목적의 데이터를 여러 파티션에 분배하여 병렬 처리가 가능하다. 파티션 개수만큼 컨슈머 개수를 늘려서 시간당 데이터 처리량을 늘리는 것이다.&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;확장성&lt;/td&gt;
&lt;td&gt;데이터 파이프라인에서 데이터가 얼마나 들어올 지 예측하기 어렵다. 언제든지 한순간에 한번에 들어올 수 도 있다. Kafka는 이러한 가변적인 환경에서도 안정적으로 확장 가능하도록 설계되어 있다. 데이터가 많아지면 Kafka 클러스터의 브로커 수를 늘려 자연스럽게 스케일 아웃(Scale-out)할 수 있다. 반대로, 데이터가 적어지면 브로커 수를 줄여 스케일 인(Scale-in)을 할 수 도 있다. 이러한 특성을 통해 무중단 운영이 필요한 커머스나 은행 시스템에서도 안정적인 운영이 가능하다.&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;영속성&lt;/td&gt;
&lt;td&gt;데이터를 생성한 프로그램이 종료되더라도 사라지지 않는 데이터의 특성을 의미한다. 다른 메세징 처리 시스템과 다르게 Kafka는 전송받은 데이터를 메모리에 저장하는 것이 아니라, 파일 시스템에 저장한다. 파일 시스템에 저장하는 것은 보편적으로 느리다고 생각되지만, Kafka는 운영 체제 레벨에서 파일 시스템을 최대한 활용하는 방법을 적용하였다. 운영체제에서는 파일 I/O 성능 향상을 위해 페이지 캐시 (page cache) 영역을 메모리에 따로 생성하여 사용한다. 이러한 캐시 기능을 통해 한번 읽은 데이터를 캐싱해두었다가, 다시 사용하는 방식이기 때문에 파일시스템을 이용하더라도 높은 처리량이 유지된다. 또한, 갑작스러운 애플리케이션 장애에도 재시작하면 저장된 파일을 통해 안정적으로 데이터를 재처리 가능하다.&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;고가용성&lt;/td&gt;
&lt;td&gt;3개 이상의 브로커로 운영되는 시스템은 Kafka 클러스터 일부에서 장애가 발생하더라도, 무중단으로 안전하고 지속적으로 데이터를 처리할 수 있다. 클러스터로 이루어진 Kafka의 데이터는 복제(replicant)를 통해 고가용성의 특징을 갖는다. 프로듀서로부터 전달받은 데이터를 각 브로커는 다른 브로커에도 복제하여 저장한다. 이에 더해 온프레미스 / 퍼블릭 클라우드의 리전 단위 장애에도 데이터를 안전하게 복제할 수 있는 브로커 옵션들이 준비되어 있다.&lt;/td&gt;
&lt;/tr&gt;
&lt;/tbody&gt;
&lt;/table&gt;
&lt;/br&gt;
&lt;h2&gt;1-2) 대용량 아키텍쳐의 변화&lt;/h2&gt;
&lt;h3&gt;1-2-1) 초기 대용량 아키텍쳐&lt;/h3&gt;
&lt;div align=&quot;left&quot;&gt;
  &lt;span class=&quot;gatsby-resp-image-wrapper&quot; style=&quot;position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 630px; &quot;&gt;
      &lt;a class=&quot;gatsby-resp-image-link&quot; href=&quot;/static/ea5472f19861f41e05693d0def4e030e/203d3/%EC%8A%A4%ED%81%AC%EB%A6%B0%EC%83%B7%202024-12-07%20%EC%98%A4%ED%9B%84%202.14.32.png&quot; style=&quot;display: block&quot; target=&quot;_blank&quot; rel=&quot;noopener&quot;&gt;
    &lt;span class=&quot;gatsby-resp-image-background-image&quot; style=&quot;padding-bottom: 44.30379746835443%; position: relative; bottom: 0; left: 0; background-image: url(&apos;data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAJCAYAAAAywQxIAAAACXBIWXMAABYlAAAWJQFJUiTwAAAB8UlEQVR42jVSS48pURDu/+jf2JLcidiZcAnjbUTj6m6vZtDehPZKrniMsPFaWNiwGt89VcntpNJ1qr76zld1Snq9Xvj//fz8wByP0Wy2UK/XcTqd8P29RaNhoF6rY7fb4Xw+w2g20RD5xXyO+/0u8AZKpRIGgyGk/X6P4XCIsSCiAvL7vT4Mw8BqtcJms0G300VH2FwQHA4HtFotUTxAv9/H8XjEZ/IT0WgUqVQKUqVSgdVqhd1uRyKRQDgcRjweRyAQgK5XoPxRGRwMhqBpeeTzeXwEPhCLxaAoCi6XC+S0zAplOQ1puVyiWCyKYh2LxQLT6RR0Cdl6vcZ2s2W/VqthNBrxKPSyjqbRRFXEg8Eg5JQMn88nCGVI1Nrb2y+8v7s4EIlE+AJSSUQFoYiUpNNpeH97USgUGEcCXC4XLBYLfF4fbDYbq2aFVESSZ7MZzyWbzULVVD5XK1U+a5rG6tqdDpScwsRESnPLZDJwu92Mk6gNCuZyOX4IKur1egym2Ff1C+12Gw2R63a7HCfl5BP+er3y3J1OJxNzyx6PB6FQiG+gVglAM6HCsl7mHM2qKFTRipAfDoWhqioT+v1+OBwOJJNJSM/nE2SPx4P/tDqmaWIymfAekpljk9eKVoxedUx5c4Ll3yVutxuvESmnzv4BKi1BK1WpGF0AAAAASUVORK5CYII=&apos;); background-size: cover; display: block;&quot;&gt;&lt;/span&gt;
  &lt;img class=&quot;gatsby-resp-image-image&quot; alt=&quot;     2024 12 07    2 14 32&quot; title=&quot;&quot; src=&quot;/static/ea5472f19861f41e05693d0def4e030e/f058b/%EC%8A%A4%ED%81%AC%EB%A6%B0%EC%83%B7%202024-12-07%20%EC%98%A4%ED%9B%84%202.14.32.png&quot; srcset=&quot;/static/ea5472f19861f41e05693d0def4e030e/c26ae/%EC%8A%A4%ED%81%AC%EB%A6%B0%EC%83%B7%202024-12-07%20%EC%98%A4%ED%9B%84%202.14.32.png 158w,
/static/ea5472f19861f41e05693d0def4e030e/6bdcf/%EC%8A%A4%ED%81%AC%EB%A6%B0%EC%83%B7%202024-12-07%20%EC%98%A4%ED%9B%84%202.14.32.png 315w,
/static/ea5472f19861f41e05693d0def4e030e/f058b/%EC%8A%A4%ED%81%AC%EB%A6%B0%EC%83%B7%202024-12-07%20%EC%98%A4%ED%9B%84%202.14.32.png 630w,
/static/ea5472f19861f41e05693d0def4e030e/40601/%EC%8A%A4%ED%81%AC%EB%A6%B0%EC%83%B7%202024-12-07%20%EC%98%A4%ED%9B%84%202.14.32.png 945w,
/static/ea5472f19861f41e05693d0def4e030e/78612/%EC%8A%A4%ED%81%AC%EB%A6%B0%EC%83%B7%202024-12-07%20%EC%98%A4%ED%9B%84%202.14.32.png 1260w,
/static/ea5472f19861f41e05693d0def4e030e/203d3/%EC%8A%A4%ED%81%AC%EB%A6%B0%EC%83%B7%202024-12-07%20%EC%98%A4%ED%9B%84%202.14.32.png 1322w&quot; sizes=&quot;(max-width: 630px) 100vw, 630px&quot; style=&quot;width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;&quot; loading=&quot;lazy&quot; decoding=&quot;async&quot;&gt;
  &lt;/a&gt;
    &lt;/span&gt;
&lt;/div&gt;
&lt;/br&gt;
&lt;ul&gt;
&lt;li&gt;초기 대용량 레이크 아키텍처는 위와 같이 원천 데이터 -&gt; 파생 데이터 -&gt; 서빙 데이터를 통해 Data 분석가들에게 제공되었는데, 대부분 배치로 데이터가 전달되므로 유연하지 못하고 실시간 생성 데이터들에 대해 애플리케이션에 빠르게 전달되지 못해서 데이터 히스토리 파악이 힘들고, 파편화되어 데이터 거버넌스 (데이터 표준 및 정책)을 지키기 어려웠다.&lt;/li&gt;
&lt;/ul&gt;
&lt;/br&gt;
&lt;h3&gt;1-2-2) 람다 아키텍쳐 (Lamda Architecture)&lt;/h3&gt;
&lt;div align=&quot;left&quot;&gt;
  &lt;span class=&quot;gatsby-resp-image-wrapper&quot; style=&quot;position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 630px; &quot;&gt;
      &lt;a class=&quot;gatsby-resp-image-link&quot; href=&quot;/static/cea41f5d5643fc192d619be0e1eafeb2/d50e7/%EC%8A%A4%ED%81%AC%EB%A6%B0%EC%83%B7%202024-12-07%20%EC%98%A4%ED%9B%84%202.16.12.png&quot; style=&quot;display: block&quot; target=&quot;_blank&quot; rel=&quot;noopener&quot;&gt;
    &lt;span class=&quot;gatsby-resp-image-background-image&quot; style=&quot;padding-bottom: 51.89873417721519%; position: relative; bottom: 0; left: 0; background-image: url(&apos;data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAKCAYAAAC0VX7mAAAACXBIWXMAABYlAAAWJQFJUiTwAAAChElEQVR42m2S20uUYRDG91+oi8KSlbwJBYnqZpEuQjGQECIj06RcV8NDqN1om0oaWliUhlrWhdhFeagQD3lIEzO3TRPNY5qJq+sB/fa87iH38OtzXaGigZl3eF6emWHmkfCPebweJjZVqFbaGRS9V9PIhDCAzualT+OhXwsflqBlzo3G6PFxvH/wJXuJ1w8LtjUKVbHkq2LI+xRNRl84JUNnaZgxc+bpCpFlak6VqpFVrlE17PJx3B6RLfpOCQleMXo8IrDbTbAvk9YcTULNOVJrLxNfc57c9hjqxjY4WTTEkbi7HL1SQfi9Uaq/unZH8f5nwh3TLK4wszRKwosoAlNDCM4MIzAtBHltJE96xzldPsex7AZk+d1EVGuo+uIAlxNh3oF2aAubzoVke3YWS/lD9O/aMBi32LAuk9MbQWq7DEVLOPJWGUWDUbyYMhNWoEZ6oQRp3H1O3BmhQixo05voKV2mLWeR7516JIZ8JUJiPEJKEt71dez8onJUSYk6mbLhdIrVCuqmb6PSbpPy1sKl59MoXi4hbxRonhYn9Lpx2LfFPe7uU2J4XM7mxVg2b2RhWl3zgTZVJcauPCw9tzB35GDvzsX5/iaGDiXGThHrzMPUmo1zcQCHExb6TEw2GdAvOJG4rVasH/txrWpZXN3gx8Qw9mcyLJXHmc8PZSIzgG8ZB5lXBjKZFcB4+gGmsg4jFO8XGxZitcDAoyX6H2jRjpj/PopLPLRuZR5zRSimskOMZUvpuypFnRbET6WUz9eC6E8OYvh6MELRPmxiQZ923ds70X9lv2x80vF/WroKMDclYXytQHi18yZjeqNAVy9H1yAX8xRM9Yk45rr9IvbsiZnfcYqD0hXKeYwAAAAASUVORK5CYII=&apos;); background-size: cover; display: block;&quot;&gt;&lt;/span&gt;
  &lt;img class=&quot;gatsby-resp-image-image&quot; alt=&quot;     2024 12 07    2 16 12&quot; title=&quot;&quot; src=&quot;/static/cea41f5d5643fc192d619be0e1eafeb2/f058b/%EC%8A%A4%ED%81%AC%EB%A6%B0%EC%83%B7%202024-12-07%20%EC%98%A4%ED%9B%84%202.16.12.png&quot; srcset=&quot;/static/cea41f5d5643fc192d619be0e1eafeb2/c26ae/%EC%8A%A4%ED%81%AC%EB%A6%B0%EC%83%B7%202024-12-07%20%EC%98%A4%ED%9B%84%202.16.12.png 158w,
/static/cea41f5d5643fc192d619be0e1eafeb2/6bdcf/%EC%8A%A4%ED%81%AC%EB%A6%B0%EC%83%B7%202024-12-07%20%EC%98%A4%ED%9B%84%202.16.12.png 315w,
/static/cea41f5d5643fc192d619be0e1eafeb2/f058b/%EC%8A%A4%ED%81%AC%EB%A6%B0%EC%83%B7%202024-12-07%20%EC%98%A4%ED%9B%84%202.16.12.png 630w,
/static/cea41f5d5643fc192d619be0e1eafeb2/40601/%EC%8A%A4%ED%81%AC%EB%A6%B0%EC%83%B7%202024-12-07%20%EC%98%A4%ED%9B%84%202.16.12.png 945w,
/static/cea41f5d5643fc192d619be0e1eafeb2/78612/%EC%8A%A4%ED%81%AC%EB%A6%B0%EC%83%B7%202024-12-07%20%EC%98%A4%ED%9B%84%202.16.12.png 1260w,
/static/cea41f5d5643fc192d619be0e1eafeb2/d50e7/%EC%8A%A4%ED%81%AC%EB%A6%B0%EC%83%B7%202024-12-07%20%EC%98%A4%ED%9B%84%202.16.12.png 2280w&quot; sizes=&quot;(max-width: 630px) 100vw, 630px&quot; style=&quot;width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;&quot; loading=&quot;lazy&quot; decoding=&quot;async&quot;&gt;
  &lt;/a&gt;
    &lt;/span&gt;
&lt;/div&gt;
&lt;/br&gt;
&lt;ul&gt;
&lt;li&gt;그래서 발전된 것이 람다 아키텍쳐(Lamda Architecture)이다. 람다 아키텍쳐는 3가지 레이어로 나뉘는데, 배치 레이어는 데이터를 특정 시간마다 일괄적으로 처리하여 서빙 레이어에 제공한다. 스피드 레이어는 Kafka와 같이 실시간으로 데이터를 처리하여 서빙 레이어로 전달한다. 스피드 레이어는 배치 레이어에 비해 낮은 지연으로 분석이 필요한 경우에 사용된다. 서빙 레이어는 가공된 데이터를 데이터 사용자, 서비스 애플리케이션에 제공하기 위해 데이터가 저장된 공간이다.&lt;/li&gt;
&lt;li&gt;람다 아키텍쳐는 데이터를 분석/처리할 수 있는 경우 배치 데이터와 스피드 레이어의 데이터를 융합하여 처리하기 에는 유연하지 못하다는 단점이 있다. 1개의 로직을 추상화하여 배치 레이어와 스피드 레이어에 적용하는 형태를 고안한 서밍버드가 있었지만 완벽히 문제가 해결되지는 못했다.&lt;/li&gt;
&lt;/ul&gt;
&lt;/br&gt;
&lt;h3&gt;1-2-3) 카파 아키텍쳐 (Kappa Architecture)&lt;/h3&gt;
&lt;p&gt;&lt;img src=&quot;https://blog.skby.net/wp-content/uploads/2019/01/2-28.png&quot; alt=&quot;&quot;&gt;&lt;/p&gt;
&lt;/br&gt;
&lt;ul&gt;
&lt;li&gt;이러한 문제 때문에 고안된 것이 카파 아키텍쳐(Kappa Architecture)이다. 람다 아키텍쳐에서 단점으로 부각되었던 로직의 파편화, 디버깅, 배포, 운영 관리에 대한 이슈를 제거하기 위해 배치 레이어를 아예 삭제하였다.&lt;/li&gt;
&lt;/ul&gt;
&lt;/br&gt;
&lt;div align=&quot;left&quot;&gt;
  &lt;span class=&quot;gatsby-resp-image-wrapper&quot; style=&quot;position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 630px; &quot;&gt;
      &lt;a class=&quot;gatsby-resp-image-link&quot; href=&quot;/static/818df837cc86865a0ba2eff94c3a47f2/966ce/%EC%8A%A4%ED%81%AC%EB%A6%B0%EC%83%B7%202024-12-07%20%EC%98%A4%ED%9B%84%202.21.38.png&quot; style=&quot;display: block&quot; target=&quot;_blank&quot; rel=&quot;noopener&quot;&gt;
    &lt;span class=&quot;gatsby-resp-image-background-image&quot; style=&quot;padding-bottom: 33.54430379746836%; position: relative; bottom: 0; left: 0; background-image: url(&apos;data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAHCAYAAAAIy204AAAACXBIWXMAABYlAAAWJQFJUiTwAAABaUlEQVR42k2R64uCUBDF/f//gyBKbc3o/TBvpKEZUdASbF8KsqDdpQck9SGih3bWmSj2wjBy8Z75nTPS4/HAq8Iw5KJvOq++D/bQPjSoqopCoRD3DEzTRKPRgCzLKJfLyOVyqNfrkI7HI5bLJTabDe73Owv8fP9i8jXBbDbD7XbD4XCArutciqJA0zQIIVgwlUohkUjwsGq1Cul0OvFDfz7Hdrtl4YW/QLfrYb1e84DdbgfXdTEejzGdTjEafcK2bRalIURWLBZ5gBQEAVzHRTqdRj6ff+NnYltE9hKsVCpoNpvciUSIFgzDYGKyTdS1Wg0SPVitVnAcB/1+PybrotfrYTgcsl2KkQRbLcH/DAYD7u22xTkSIQG8M7xer6A6n88gWt/3QTFcLhe+p8WQdbJDVJ1OJyY1YQoz7gaSyST0bJYJOcMoit6b/b/dKHze0yHrpVIptqdCkRVegOd5nCNF9RTVYVkW/gCaytnmLssDPAAAAABJRU5ErkJggg==&apos;); background-size: cover; display: block;&quot;&gt;&lt;/span&gt;
  &lt;img class=&quot;gatsby-resp-image-image&quot; alt=&quot;     2024 12 07    2 21 38&quot; title=&quot;&quot; src=&quot;/static/818df837cc86865a0ba2eff94c3a47f2/f058b/%EC%8A%A4%ED%81%AC%EB%A6%B0%EC%83%B7%202024-12-07%20%EC%98%A4%ED%9B%84%202.21.38.png&quot; srcset=&quot;/static/818df837cc86865a0ba2eff94c3a47f2/c26ae/%EC%8A%A4%ED%81%AC%EB%A6%B0%EC%83%B7%202024-12-07%20%EC%98%A4%ED%9B%84%202.21.38.png 158w,
/static/818df837cc86865a0ba2eff94c3a47f2/6bdcf/%EC%8A%A4%ED%81%AC%EB%A6%B0%EC%83%B7%202024-12-07%20%EC%98%A4%ED%9B%84%202.21.38.png 315w,
/static/818df837cc86865a0ba2eff94c3a47f2/f058b/%EC%8A%A4%ED%81%AC%EB%A6%B0%EC%83%B7%202024-12-07%20%EC%98%A4%ED%9B%84%202.21.38.png 630w,
/static/818df837cc86865a0ba2eff94c3a47f2/40601/%EC%8A%A4%ED%81%AC%EB%A6%B0%EC%83%B7%202024-12-07%20%EC%98%A4%ED%9B%84%202.21.38.png 945w,
/static/818df837cc86865a0ba2eff94c3a47f2/78612/%EC%8A%A4%ED%81%AC%EB%A6%B0%EC%83%B7%202024-12-07%20%EC%98%A4%ED%9B%84%202.21.38.png 1260w,
/static/818df837cc86865a0ba2eff94c3a47f2/966ce/%EC%8A%A4%ED%81%AC%EB%A6%B0%EC%83%B7%202024-12-07%20%EC%98%A4%ED%9B%84%202.21.38.png 2050w&quot; sizes=&quot;(max-width: 630px) 100vw, 630px&quot; style=&quot;width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;&quot; loading=&quot;lazy&quot; decoding=&quot;async&quot;&gt;
  &lt;/a&gt;
    &lt;/span&gt;
&lt;/div&gt;
&lt;/br&gt;
&lt;ul&gt;
&lt;li&gt;카파 아키텍쳐로 배치 데이터를 처리하기 위해서는 위와 같이 파티션의 로그를 기반으로 각 시간별 배치 데이터의 스냅샷을 생성함으로써 가능해진다. 각 레코드는 타임스탬프를 가지며, 시간의 변화에 따라 각 배치 데이터의 스냅샷을 생성할 수 있다. 이를 통해 각 시점의 모든 스냅샷을 생성하지 않아도 된다.&lt;/li&gt;
&lt;/ul&gt;
&lt;/br&gt;
&lt;h3&gt;1-2-4) 배치 데이터와 스트림 데이터&lt;/h3&gt;
&lt;table&gt;
&lt;thead&gt;
&lt;tr&gt;
&lt;th&gt;배치 데이터&lt;/th&gt;
&lt;th&gt;스트림 데이터&lt;/th&gt;
&lt;/tr&gt;
&lt;/thead&gt;
&lt;tbody&gt;
&lt;tr&gt;
&lt;td&gt;- 한정된 (bounded) 데이터 처리&lt;br&gt;- 대규모 배치 데이터 처리를 위한 분산&lt;br&gt;- 분, 시간, 일 단위 처리를 위한 지연 발생&lt;br&gt;- 복잡한 키 조인 수행&lt;br&gt;&lt;/td&gt;
&lt;td&gt;- 무한 (unbounded) 데이터 처리&lt;br&gt;- 지속적으로 들어오는 데이터를 위한 분산 처리 수행&lt;br&gt;- 분 단위 이하 지연 발생&lt;br&gt;- 단순한 키 조인 수행&lt;/td&gt;
&lt;/tr&gt;
&lt;/tbody&gt;
&lt;/table&gt;
&lt;/br&gt;
&lt;h3&gt;1-2-5) 스트리밍 데이터 레이크 아키텍쳐 (Streaming Data Lake Architecture)&lt;/h3&gt;
&lt;div align=&quot;left&quot;&gt;
  &lt;span class=&quot;gatsby-resp-image-wrapper&quot; style=&quot;position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 630px; &quot;&gt;
      &lt;a class=&quot;gatsby-resp-image-link&quot; href=&quot;/static/ea1200d508ef15f343a308fe31069b22/1b1d5/%EC%8A%A4%ED%81%AC%EB%A6%B0%EC%83%B7%202024-12-07%20%EC%98%A4%ED%9B%84%202.26.38.png&quot; style=&quot;display: block&quot; target=&quot;_blank&quot; rel=&quot;noopener&quot;&gt;
    &lt;span class=&quot;gatsby-resp-image-background-image&quot; style=&quot;padding-bottom: 66.45569620253164%; position: relative; bottom: 0; left: 0; background-image: url(&apos;data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAANCAYAAACpUE5eAAAACXBIWXMAABYlAAAWJQFJUiTwAAACMElEQVR42nVTSU8yURCcv8MP80fAzUQuGAxB9iUiQoCwwwEOeAMkYRFkkT0BE0Ji8CKya32pNmM8+L2kM/Pmdderqu5RPj8/wTidThLq/uvr67/Bc67X11c8PDygWq2iUqng6ekJinr4e7FIveCvOB6Pktfr9eByueDxeOB2u3F7ewvl5eUFyWQSoVBIIhaLodvtSsFfl6kXcg2HQwHL5/MIBoMSSqfTwfX1NbRarYTJZEIkEvmRNB6P8fz8jNFoBOYOBgOQhApos9lQq9UQDodxd3cHZTabCStuSJnv2WwWrVYL9XodzWYT6XQa9/f3oqBYLIpvBKdkApIha30+HxSyKJfLEkxkwWKxELm0gskEJzCZkBXBLi4ukMlkBMjpdMLhcCAQCEChX16vF3q9XpJobjQaxWq1kgv8fj9ubm6QSqXEr0KhIOAajQY6nU4sMhqNOD8/F2CFnrDg6upKDvhOD8mS7CiJUsiEl1EBpZ6dnckFJMPvZrP5W/L7+7tIoPEMztLb2xu2261Ipo/T6RTtdhv9fh/L5VKk09PHx0fpLIEolx4rk8kE8Xhcgg1JJBLI5XIiq9Fo/DxZzCBYqVTCfr+XC+x2OwwGgzAUQLIjdY6OxWKRQWXH1eEmUxbzuV6vQUWbzUbOaRfrLi8vxS4BnM/nIo2jwXFhQ9hVLgLxr2AcDgcBZRCQ30iGjSA7q9X63WUm7HY7SVLff+/5VEPdf3x8CCBHiFPAJtJLkvoH8i1puD/ABf4AAAAASUVORK5CYII=&apos;); background-size: cover; display: block;&quot;&gt;&lt;/span&gt;
  &lt;img class=&quot;gatsby-resp-image-image&quot; alt=&quot;     2024 12 07    2 26 38&quot; title=&quot;&quot; src=&quot;/static/ea1200d508ef15f343a308fe31069b22/f058b/%EC%8A%A4%ED%81%AC%EB%A6%B0%EC%83%B7%202024-12-07%20%EC%98%A4%ED%9B%84%202.26.38.png&quot; srcset=&quot;/static/ea1200d508ef15f343a308fe31069b22/c26ae/%EC%8A%A4%ED%81%AC%EB%A6%B0%EC%83%B7%202024-12-07%20%EC%98%A4%ED%9B%84%202.26.38.png 158w,
/static/ea1200d508ef15f343a308fe31069b22/6bdcf/%EC%8A%A4%ED%81%AC%EB%A6%B0%EC%83%B7%202024-12-07%20%EC%98%A4%ED%9B%84%202.26.38.png 315w,
/static/ea1200d508ef15f343a308fe31069b22/f058b/%EC%8A%A4%ED%81%AC%EB%A6%B0%EC%83%B7%202024-12-07%20%EC%98%A4%ED%9B%84%202.26.38.png 630w,
/static/ea1200d508ef15f343a308fe31069b22/1b1d5/%EC%8A%A4%ED%81%AC%EB%A6%B0%EC%83%B7%202024-12-07%20%EC%98%A4%ED%9B%84%202.26.38.png 876w&quot; sizes=&quot;(max-width: 630px) 100vw, 630px&quot; style=&quot;width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;&quot; loading=&quot;lazy&quot; decoding=&quot;async&quot;&gt;
  &lt;/a&gt;
    &lt;/span&gt;
&lt;/div&gt;
&lt;/br&gt;
&lt;ul&gt;
&lt;li&gt;기존 카파 아키텍쳐에서 서빙 레이어까지 제거한 형태의 아키텍쳐. 서빙 데이터에서 처리하던 대용량 데이터를 Kafka에서 오랜 기간 저장하고 사용할 수 있다면, 서빙 레이어를 제거할 수 있다는 관점이다. 이를 해결하기 위해서는 자주 사용되는 데이터와 자주 사용되지 않는 데이터를 구분하여, 자주 사용되는 데이터를 메모리 (Kafka Broker)에 올리고 자주 사용되지 않는 데이터를 오브젝트 스토리지에서 보관할 수 있다.&lt;/li&gt;
&lt;/ul&gt;</content:encoded></item><item><title><![CDATA[CKA, CKAD 합격 후기]]></title><description><![CDATA[CKA, CKAD 합격 후기 지난 2022년 7월부터 시작한 kubernetes 공부가 2024년 6~1…]]></description><link>https://github.com/SiverPineValley/SiverPineValley.github.io/kubernetes/kubernetes_certificate/</link><guid isPermaLink="false">https://github.com/SiverPineValley/SiverPineValley.github.io/kubernetes/kubernetes_certificate/</guid><pubDate>Sat, 16 Nov 2024 18:00:00 GMT</pubDate><content:encoded>&lt;h2&gt;CKA, CKAD 합격 후기&lt;/h2&gt;
&lt;br&gt;
&lt;div align=&quot;left&quot;&gt;
  &lt;span class=&quot;gatsby-resp-image-wrapper&quot; style=&quot;position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 630px; &quot;&gt;
      &lt;a class=&quot;gatsby-resp-image-link&quot; href=&quot;/static/8bcd2279504b461841da974d3464bd68/95fa1/cka.png&quot; style=&quot;display: block&quot; target=&quot;_blank&quot; rel=&quot;noopener&quot;&gt;
    &lt;span class=&quot;gatsby-resp-image-background-image&quot; style=&quot;padding-bottom: 75.31645569620254%; position: relative; bottom: 0; left: 0; background-image: url(&apos;data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAPCAYAAADkmO9VAAAACXBIWXMAABYlAAAWJQFJUiTwAAAC8klEQVR42n1S3UtTYRw+/0HYXV0UdWN404V94Wq6zc9Zms1QjNSslLrRSJ3LbeqmNs2wmRHURUUEgvRBHyBEFKgM6aYkowupLkQMPec9O9vcmTs7T+/7nolp4IGH8378fs/7PL/fT8A2n57+ryg6FlZSxpmObT9hOyI5pmNqLongaxVDL1RMfkuCRPVtiQWNPpzSNwesr0lEh29Mxf13BrqexSFF/ifU0/mMa5PCVMo41Ax3mP6uwf00jufTaxifSvD1x9nkpthUaovCD19ULIopJLXNHtiLq6qOx+8TuP0yzvFgQsVqQsdWt4x4iWj4NLsGwdQqorCToOGOgsB4BK9CCfxYSCKmGmmsGZNzGq/lryVDDiOdX9TwZobVNobLIzKKPDIYl2C7ISOvQ4KpTUJ2s4TDLSJynQSOPgLXkxgeTkQx+zOOud8qVRultmOoCrAcGUeuiTzH1CrRPQHjEiyUzOaSYXURlPkIKvtlSiaj3E+Q3ynB7k+iPABUDAKlvUmqhOBkj4wzvQRnAwrPYUQsn0Gw0o3FJVGwCwmFboIiBo+Ekm4FWTYXdh0ooihGprkF9q4wij2EWyx0Syhw0/wOEQYPYQpFvlgnZYpzKU60E44sxxj2WW9iv20QmWWPYHaG6TmNcbJ4mcdbXRukhkK+ITRIhJmSlHYTXqfqARnng0nUBIG6UaB2RKPnBNWDMuxeEcfbRF5/i3MZljSPwJRZ040p8cqo6JVRNaDgUjDM0TBMUDckonZIomsJjXcV1A8rqLqlwRFIwO5LwOZNpGvIFPKGSNQKLTTtbNOIiKbgMh2jMJpGFToSjFjBhWGZQsGVexE0DC3inDeEet9nFDSHcOhiCHntS/9YpuyFtNCW6/PIufqVXv7hj7DROEU7etpPeHfN7SuwdKo4WPMWO3ZnI2NPDnbuOYaMvSYcbZxBvie+0ZRyfxiVfctcpaNf4dZZ1+1dMkq7jM6zOrOHCtxh2OkE2HtiKPYqsLmj3DIr318lyqJViLmQIgAAAABJRU5ErkJggg==&apos;); background-size: cover; display: block;&quot;&gt;&lt;/span&gt;
  &lt;img class=&quot;gatsby-resp-image-image&quot; alt=&quot;cka&quot; title=&quot;&quot; src=&quot;/static/8bcd2279504b461841da974d3464bd68/f058b/cka.png&quot; srcset=&quot;/static/8bcd2279504b461841da974d3464bd68/c26ae/cka.png 158w,
/static/8bcd2279504b461841da974d3464bd68/6bdcf/cka.png 315w,
/static/8bcd2279504b461841da974d3464bd68/f058b/cka.png 630w,
/static/8bcd2279504b461841da974d3464bd68/40601/cka.png 945w,
/static/8bcd2279504b461841da974d3464bd68/78612/cka.png 1260w,
/static/8bcd2279504b461841da974d3464bd68/95fa1/cka.png 1816w&quot; sizes=&quot;(max-width: 630px) 100vw, 630px&quot; style=&quot;width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;&quot; loading=&quot;lazy&quot; decoding=&quot;async&quot;&gt;
  &lt;/a&gt;
    &lt;/span&gt;
  &lt;span class=&quot;gatsby-resp-image-wrapper&quot; style=&quot;position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 630px; &quot;&gt;
      &lt;a class=&quot;gatsby-resp-image-link&quot; href=&quot;/static/25f8ab3dd32a63b5013f0fcf95668f66/c4842/ckad.png&quot; style=&quot;display: block&quot; target=&quot;_blank&quot; rel=&quot;noopener&quot;&gt;
    &lt;span class=&quot;gatsby-resp-image-background-image&quot; style=&quot;padding-bottom: 75.31645569620254%; position: relative; bottom: 0; left: 0; background-image: url(&apos;data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAPCAYAAADkmO9VAAAACXBIWXMAABYlAAAWJQFJUiTwAAADC0lEQVR42n1SW0gUYRTeR18Vot6iXoIIgoIsUnddN0W3MvNSvXSxEu1ioKatS7vttm4EaV4yur0UBdVL0QUs6qWHSu2hEgLpaiFbujPzz7jtZdyZr/P/w2ql9cNhzsz5zvd/3zljM00T/wrDMAGYkKcMTDJD5MZ/8DxsmOeYpvWMJ02MjKVx5XEKvfdTGH4/jahm/oH5+9jShlX8HZDJea3rThJdd5O48igF340ExiYMUTPMuSIMKv2hkBNkgp9339LwXU/g/qCOh8M6QjcpH9LnYH8XYxsaTYHFyD9mv2ayWMLEnec6eu8lcZkUXhpIISIb89pN6CbefZ2GraBVxsYTChovTqH/QQxPXuv4Fk1jOm0BI7KJuy91oezt5/SMXb6owVEd154m0H5VQ/UpFY5jEmzOdgUFbTLWNUtY3ShhbZOEIq+CnWcYwrfjuPUsjk8RHVE1jYFXCfTci+PAeQ1lfob1LdRzREZuk4x8ElboUWArJNYiIuXEXGlFiGFzkFGDIm4s9sdREU6g6nQK7uBPapJR4mOElbG1Q8XmgAyXl4l+XiOFTCScfYNXRikRuSnK/DSKgIbi5hHYDw0iv+EFXE1v4KZLNwYUoZBjSo5TP13MeZweZil0epQZ0sJjNAKSn3dUgt0Tx6JVDcjKWY6sBSuRs6wSeS2TVFOERYeHu5AFGecRlq0XXmSwt0k0T0XYrQ4zVJ1iqAlPoiI4gZoOinAUlR0Ktp/WsClgXewgvKNNQobHZiljwq77hEpAhvKQir3dKmop9vZo2NWlYU93DPv7NNSKd4at4RjcNBI+lhL/lJg3JxUKubItIQ11fSoOXyCSs1Ec7FdR16thX4+K3V08Z2jo11B/TsXOTobazgjqe37g8LnvqA59Jw5a7OxSrC3nN31Bbv1rFDSPCxvcfqlPwaagIjbvapfg8Cawpm4YOUtdyF5ShOzFdixcsQOOlnE4vRq3LInhlp9UsS38A1WhCZqdRrNSiUAWWy0PWr+UyyuLi4s8UWxo/Yjiti9wHf1AAsZmlvILaACm4fYIO0UAAAAASUVORK5CYII=&apos;); background-size: cover; display: block;&quot;&gt;&lt;/span&gt;
  &lt;img class=&quot;gatsby-resp-image-image&quot; alt=&quot;ckad&quot; title=&quot;&quot; src=&quot;/static/25f8ab3dd32a63b5013f0fcf95668f66/f058b/ckad.png&quot; srcset=&quot;/static/25f8ab3dd32a63b5013f0fcf95668f66/c26ae/ckad.png 158w,
/static/25f8ab3dd32a63b5013f0fcf95668f66/6bdcf/ckad.png 315w,
/static/25f8ab3dd32a63b5013f0fcf95668f66/f058b/ckad.png 630w,
/static/25f8ab3dd32a63b5013f0fcf95668f66/40601/ckad.png 945w,
/static/25f8ab3dd32a63b5013f0fcf95668f66/78612/ckad.png 1260w,
/static/25f8ab3dd32a63b5013f0fcf95668f66/c4842/ckad.png 1634w&quot; sizes=&quot;(max-width: 630px) 100vw, 630px&quot; style=&quot;width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;&quot; loading=&quot;lazy&quot; decoding=&quot;async&quot;&gt;
  &lt;/a&gt;
    &lt;/span&gt;
&lt;/div&gt;
&lt;br&gt;
&lt;p&gt;지난 2022년 7월부터 시작한 kubernetes 공부가 2024년 6~10월이 되서야 비로소 성과를 만들어 낼 수 있었다. 그 기간동안 지속적으로 공부한 기간도 있고, 잠시 쉰 기간도 있다 보니 첫 자격증 취득에도 꽤 많은 시간이 걸렸던 것 같다. 블로그에도 여러 자료를 올리기도 하고 했지만 중간에 중단했는데 그 때문에 더 뜬금없이 자격증 취득 후기를 올리게 된 것 같다.&lt;/p&gt;
&lt;/br&gt;
&lt;p&gt;개인적으로는 노트 앱에 자료는 계속 정리를 해오긴 했지만 귀찮니즘으로 블로그에는 올리지 않았었는데, 차례차례 올려볼 예정이다.&lt;/p&gt;
&lt;/br&gt;
&lt;p&gt;자격증을 취득하면서 느낀점은 역시 실무에서 사용하면서 이론과 실습이 병행되어야 빠르게 익숙해지고 금방 취득이 가능한 것 같다는 점이었다. 나의 경우 실무에서는 사용하지 않았지만 쿠버네티스나 컨테이너를 사용하는 것이 BE의 덕목 중 하나가 되면서 위기감에 자연스레 공부하게 된 것 같다. 또한, Go를 사용하는 업무 특성상 Go로 작성되었다는 쿠버네티스의 구조도 궁금증을 일으킨 것도 공부를 시작하게 된 계기 중 하나가 되었다.&lt;/p&gt;
&lt;/br&gt;
&lt;h2&gt;쿠버네티스의 시험 종류&lt;/h2&gt;
&lt;p&gt;본격적으로 시험 후기를 작성하기에 앞서 Linux Foundation이 주관하는 쿠버네티스 자격증에 대해 소개부터 하고 시작하겠다. Linux Foundation에는 리눅스, 쿠버네티스 자격증 등을 주관하고 있는데 쿠버네티스 관련으로는 총 5개의 자격증이 있다.&lt;/p&gt;
&lt;/br&gt;
&lt;blockquote&gt;
&lt;p&gt;CKA(Certified Kubernetes Administrator), CKAD(Certified Kubernetes Application Developer), CKS(Certified Kubernetes Security Specialist), NCNA(Kubernetes and Cloud Native Associate), KCSA(Kubernetes and Cloud Native Security)&lt;/p&gt;
&lt;/blockquote&gt;
&lt;br&gt;
&lt;p&gt;이중 CKA, CKAD, CKS는 실습형 시험이고, KCNA, KCSA는 객관형 시험이다. 이 다섯가지 자격을 모두 클리어하면 &lt;code class=&quot;language-text&quot;&gt;Kubestronaut&lt;/code&gt;라는 자격이 주어진다고 한다. 나는 이 중 CKA와 CKAD를 취득한 것이고 쿠버네티스 자격증에 입문하는 대부분이 이 두 시험을 치루게 된다.&lt;/p&gt;
&lt;/br&gt;
&lt;h2&gt;CKA와 CKAD 비교&lt;/h2&gt;
&lt;p&gt;CKA는 영문명 그대로 쿠버네티스 클러스터 전반에 대한 운영에 대한 내용이다. 따라서 각 Object들을 생성/삭제/수정하는 방법 외에도 쿠버네티스 클러스터 구조, 보안, 버전 업데이트, 설치, 트러블 슈팅 등등 다양한 주제를 다루게 된다. 특히 시험 환경은 여러 클러스터를 운영하는 쿠버네티스 운영자의 입장에서 문제들을 해결하는 방식이다.&lt;/p&gt;
&lt;/br&gt;
&lt;p&gt;CKAD는 쿠버네티스를 이용하는 개발자의 입장에서 각종 Object들을 다루는 내용이 중점이 된다. 따라서 CKA보다는 비교적 적은 범위가 출제되고 각 Object들에 대한 설정은 보다 자세하게 공부해야 한다. 그 외에 heml을 다루는 부분이 시험 문제에 출제되기도 한다.&lt;/p&gt;
&lt;/br&gt;
&lt;br&gt;
&lt;div align=&quot;left&quot;&gt;
  &lt;span class=&quot;gatsby-resp-image-wrapper&quot; style=&quot;position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 630px; &quot;&gt;
      &lt;a class=&quot;gatsby-resp-image-link&quot; href=&quot;/static/5f77a9fd58e3a069e9f10520ec56d334/bd9eb/ckavsckad.png&quot; style=&quot;display: block&quot; target=&quot;_blank&quot; rel=&quot;noopener&quot;&gt;
    &lt;span class=&quot;gatsby-resp-image-background-image&quot; style=&quot;padding-bottom: 36.708860759493675%; position: relative; bottom: 0; left: 0; background-image: url(&apos;data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAHCAYAAAAIy204AAAACXBIWXMAABYlAAAWJQFJUiTwAAAA1ElEQVR42nWSBw6EMAwE+f8z6Z1QRfdpjMIdQYdkBeT1eO3gifNkWSZ93+v7eZ6PnP0ehkF835dlWdxy8bZtk7qupaoqMcZIWZZSFMUd67oqiFzXdRpo0aVp+oJ6FERRJEEQaCRJog7atpWmaWSeZwXmea4gAndxHGsdeRgPIJ2A4cgd046KIyYBDIzGAO10x3F8gYhIUjSOo3b93RliNDimGBgG0L92aB3SlSJcAv3nEChAAq3d+zRNF3Df93vB3C4wd2wcoiHPXxCGoZ6Y4KTGXs4HafIbI+W8X7cAAAAASUVORK5CYII=&apos;); background-size: cover; display: block;&quot;&gt;&lt;/span&gt;
  &lt;img class=&quot;gatsby-resp-image-image&quot; alt=&quot;ckavsckad&quot; title=&quot;&quot; src=&quot;/static/5f77a9fd58e3a069e9f10520ec56d334/f058b/ckavsckad.png&quot; srcset=&quot;/static/5f77a9fd58e3a069e9f10520ec56d334/c26ae/ckavsckad.png 158w,
/static/5f77a9fd58e3a069e9f10520ec56d334/6bdcf/ckavsckad.png 315w,
/static/5f77a9fd58e3a069e9f10520ec56d334/f058b/ckavsckad.png 630w,
/static/5f77a9fd58e3a069e9f10520ec56d334/40601/ckavsckad.png 945w,
/static/5f77a9fd58e3a069e9f10520ec56d334/78612/ckavsckad.png 1260w,
/static/5f77a9fd58e3a069e9f10520ec56d334/bd9eb/ckavsckad.png 1442w&quot; sizes=&quot;(max-width: 630px) 100vw, 630px&quot; style=&quot;width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;&quot; loading=&quot;lazy&quot; decoding=&quot;async&quot;&gt;
  &lt;/a&gt;
    &lt;/span&gt;
&lt;/div&gt;
&lt;br&gt;
&lt;p&gt;즉, 시험 범위는 CKA가 조금 더 넓은 편이고, CKAD 시험범위 대부분이 포함되지만 일부 내용은 CKAD에만 포함된 내용도 있다. 전체적인 시험 출제 유형은 아래와 같다.&lt;/p&gt;
&lt;/br&gt;
&lt;h3&gt;CKA 시험 유형&lt;/h3&gt;
&lt;ul&gt;
&lt;li&gt;Pod, Deployment, Service Object 생성&lt;/li&gt;
&lt;li&gt;Deployment Scale 조정&lt;/li&gt;
&lt;li&gt;특정 컨테이너 이미지와 네임스페이스가 포함된 Pod 생성&lt;/li&gt;
&lt;li&gt;Deployment에 연결하는 Service 생성(Cluster IP), Ingress 생성&lt;/li&gt;
&lt;li&gt;A 네임스페이스에 있는 파드와 통신할 수 있는 B 네임스페이스에 포함된 Network Policy를 생성하는 문제&lt;/li&gt;
&lt;li&gt;PV(Persistent Volume), PVC(Persistent Volume Claim) 생성 및 볼륨을 연동하는 Pod 생성과 같은 문제&lt;/li&gt;
&lt;li&gt;Role 및 RoleBinding을 생성하고 연동하는 문제들이 나왔다.&lt;/li&gt;
&lt;li&gt;클러스터 트러블슈팅 (notReady -&gt; Ready)
&lt;ul&gt;
&lt;li&gt;kubelet / kubectl 설정 변경&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;li&gt;kubectl log를 통해서 pod의 로그 확인하기 (error 로그 출력 후 저장)&lt;/li&gt;
&lt;li&gt;모든 노드의 InternalIP 출력 후 저장 (jsonPath)&lt;/li&gt;
&lt;li&gt;특정 워커노드 drain 하기&lt;/li&gt;
&lt;li&gt;etcd 백업, 리스토어 ( 리스토어는 이미 백업이 존재하여, 내가 백업한 db말고 지문에서 백업해놓은 db로 리스토어 해야 함)&lt;/li&gt;
&lt;li&gt;마스터노드 kubeadm, kubectl, kubelet 업그레이드 ( master만 하라고 지문에 되어 있었음 )&lt;/li&gt;
&lt;li&gt;특정 조건의 파드생성하기 ( Tolerations )&lt;/li&gt;
&lt;li&gt;사이드카 컨테이너 생성해서 로그 추출하기 (emptydir 사용)&lt;/li&gt;
&lt;li&gt;멀티컨테이너 파드 생성하기 (2개 컨테이너 와 각기 다른 env 설정)&lt;/li&gt;
&lt;li&gt;rolling update 및 undo rollback 후 rollback history 저장&lt;/li&gt;
&lt;li&gt;지문에 맞게 network policy 생성&lt;/li&gt;
&lt;li&gt;지문에 맞게 ingress 생성 후 curl로 테스트&lt;/li&gt;
&lt;li&gt;csr 생성하여 승낙하여 지문에 맞게 role 생성 후 해당 유저에게 rolebinding&lt;/li&gt;
&lt;li&gt;deployment &amp;#x26; service expose&lt;/li&gt;
&lt;li&gt;pv, pvc와 pod 만들기 (스토리지 클래스는 이미 생성되어있음, storage 증설)&lt;/li&gt;
&lt;li&gt;cpu가장 많이 사용하는 pod name 저장 (top)&lt;/li&gt;
&lt;/ul&gt;
&lt;/br&gt;
&lt;h3&gt;CKAD 시험 유형&lt;/h3&gt;
&lt;ul&gt;
&lt;li&gt;키, 밸류 제공 → 시크릿 만들고 그 시크릿을 파드에 env secretRefValue 추가&lt;/li&gt;
&lt;li&gt;Resourece Request&lt;/li&gt;
&lt;li&gt;deployment의 pod 템플릿에 resouce request, limit 지정 (half, maximum 이런식으로 제시함)&lt;/li&gt;
&lt;li&gt;deployment, svc, ingress 제공, curl 명령어 제공해주고 deployment 수정없이 curl 성공하게끔 만들어야함&lt;/li&gt;
&lt;li&gt;ingress에 svc name이 다르게 들어가있어서 수정&lt;/li&gt;
&lt;li&gt;svc에 target port가 pod의 container port와 달라서 수정&lt;/li&gt;
&lt;li&gt;deployment 제공해주고, maxSurge, maxUnavailable, replica 수 조정 → 그 이후 버전 바꾸고 롤링 업데이트 되게끔함 (Canary 업데이트)&lt;/li&gt;
&lt;li&gt;deployment 배포 후 이미지 변경, rollout undo로 되돌리기&lt;/li&gt;
&lt;li&gt;deployment에 serviceaccount set 해주기&lt;/li&gt;
&lt;li&gt;deployment 의 pod 템플릿에 serviceaccount 변경 후 저장, 파드 로그 확인&lt;/li&gt;
&lt;li&gt;docker file 이미지로 제공한 이미지이름:tag달아서 build →  제시한 이름.tar 형식으로 docker save
&lt;ul&gt;
&lt;li&gt;docker build -t {이미지명}:{태그명} {Dockerfile경로}&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;li&gt;제시한 조건대로 cronjob만들고, 만든 크론잡을 사용하는 job 생성하기&lt;/li&gt;
&lt;li&gt;readinessProbe, livenessProbe 추가&lt;/li&gt;
&lt;li&gt;예전 버전의 yaml 제공, 현버전에 맞게 api 바꿔서 배포
&lt;ul&gt;
&lt;li&gt;kubernetes.io docs 참고해서 wget으로 kubectl-convert 다운 받기&lt;/li&gt;
&lt;li&gt;권한 chmod +x 로 주고 /usr/local/bin 으로 옮기기&lt;/li&gt;
&lt;li&gt;kubectl-convert -f 예전버전.yaml &gt; 신규버전.yaml&lt;/li&gt;
&lt;li&gt;k apply -f 신규버전.yaml&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;li&gt;pod 배포, 문제에서 제공하는 env name, value 넣어서 배포&lt;/li&gt;
&lt;li&gt;deployment 배포, 제공하는 포트 및 NodePort 타입으로 deployment를 svc로 expose&lt;/li&gt;
&lt;li&gt;networkpolicy를 제공해주고, a,b,c 파드에서 c가 a,b로만 통신될 수 있도록 수정&lt;/li&gt;
&lt;li&gt;pod에 security context 넣기&lt;/li&gt;
&lt;/ul&gt;
&lt;/br&gt;
&lt;p&gt;두 시험과 CKS를 포함한 세 종류의 시험은 모두 유사한 환경에서 치뤄진다. 시험을 예약하고 당일이 되면 시험 페이지에 입장할 수 있는 버튼이 활성화된다. 그 버튼을 통해 시험을 치루면 가상 데스크톱 환경 (VDI)에 접속하기 위한 프로그램 설치를 하게 되고 이를 통해 리눅스 기반의 시험 환경으로 접속할 수 있게 된다. 둘다 환경은 유사하나, CKA는 여러 클러스터의 Context를 변경해가면서 문제를 풀이하게 된다면, CKAD는 ssh로 서버에 접속해서 문제를 해결하게 된다.&lt;/p&gt;
&lt;/br&gt;
&lt;h2&gt;시험 예약하기&lt;/h2&gt;
&lt;p&gt;시험을 예약하기에 앞서 Linux Foundation에 가입이 필요하다. 가입 절차가 끝나면 시험 예약이 가능한데, 외국 사이트다 보니 Visa/MasterCard 지원하는 외화 결제 가능 카드로 결제해야 한다. 시험비가 보통 $395인데, 요즘 환율을 생각하면 55만원에 달한다... Linux Foundation에서는 정기적으로 할인 쿠폰을 제공해주는데 메일링리스트를 구독하거나 나의 경우 아래 Git을 참고하였다. 시험은 한번 예약하면 총 2번의 기회가 주어진다. 즉, 한번 탈락하더라도 만회할 기회가 있다는 것이다.&lt;/p&gt;
&lt;p&gt;&lt;a href=&quot;https://github.com/techiescamp/linux-foundation-coupon&quot;&gt;Linux Foundation Coupons&lt;/a&gt;&lt;/p&gt;
&lt;/br&gt;
&lt;p&gt;시험을 예약하는 방법은 다른 블로그를 참조하면 자세히 나와 있으니 자세한 방법은 생략하겠다. 시험은 온라인으로 가상환경에서 치뤄지므로 시험관을 위해 마이크, 카메라, 스피커가 준비되어 있어야 한다. 시험을 예약하면 아래와 같은 화면에 접근이 가능한데, 시험을 치루기 전에 준비 사항들을 점검할 수 있다. 시험 시 여권이나 본인을 인증할 수 있는 신분증이 있어야 하는데 본인 이름이나 여권 정보들을 넣는 부분도 있고 시험을 예약할 수 있는 화면도 존재한다. 또한, 시험을 치루는 환경이 적절한지 (마이크, 스피커, 브라우저 등 테스트)를 검사할 수도 있다. 모든 절차가 끝나면 Take Exam 부분에 비활성화된 버튼이 생기고 시험일이 도래하면 버튼이 활성화된다.&lt;/p&gt;
&lt;br&gt;
&lt;div align=&quot;left&quot;&gt;
  &lt;span class=&quot;gatsby-resp-image-wrapper&quot; style=&quot;position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 630px; &quot;&gt;
      &lt;a class=&quot;gatsby-resp-image-link&quot; href=&quot;/static/a639e1a510fdf9b67f8ecc201648070c/f09ab/checklist.png&quot; style=&quot;display: block&quot; target=&quot;_blank&quot; rel=&quot;noopener&quot;&gt;
    &lt;span class=&quot;gatsby-resp-image-background-image&quot; style=&quot;padding-bottom: 74.68354430379746%; position: relative; bottom: 0; left: 0; background-image: url(&apos;data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAPCAYAAADkmO9VAAAACXBIWXMAABYlAAAWJQFJUiTwAAAB8klEQVR42o1UXZObMBDL//9V7Wv70ubhmmsIhBBKIHwaMGAg6so3ZGja3NUzmvWAkbXSDpuqqlCpCkVRoCxLKKXsnjXLMtR1jev1iq7r8D9rk8cpXOeAc3jGfr+3cBwHQRDgfD7D8zzsdjtLznW73d4n/F55CIoLVPmmcgFVLXutW7TjjKwzMPMHhHsVIswuKPK3j+M4xuVysYiiyEKJLb0QKTNjJKGovD3B5kv2ip/REYF/gn/yYYz55801PRXV9Hwcx+cKIy3GDxpmGDAIFo9Y53m+3zxNkyViXZ/5S+HnZIuX0MHx4OEUiErftyoeA9BaI01TNE1jK0OjPZwG2sJpsArNPMKMBn3fW4VsmcoeFfBd27b2HBMnCS/hu7XyzbfigLCM0VT1fRZZ8zy3BGuFSlS0Uvmcc0m1VLY+t/EaSbS8IokTmyzb4O1hGFolS9t9p9HIx7rVtk2ChAQJ7x5uCxdBFqFIc0tIfziDVGgPLSnLHMbdiH76YA4P9S8kKkNVlJaMLVMZ214vzl8vpPMS1EPSd8Kv+SteAgcnz7fJMWWCe9d1bUtc5TAi1uaOhLWVMKf5T4WnNkGpa5lDY5Ok2QTTJJie6JBJmEThhEFghGTBelath5/iLX6EB/juEZF4+GwxhFS8VfJnmm/z03O/AaV3iCqzXfcxAAAAAElFTkSuQmCC&apos;); background-size: cover; display: block;&quot;&gt;&lt;/span&gt;
  &lt;img class=&quot;gatsby-resp-image-image&quot; alt=&quot;checklist&quot; title=&quot;&quot; src=&quot;/static/a639e1a510fdf9b67f8ecc201648070c/f058b/checklist.png&quot; srcset=&quot;/static/a639e1a510fdf9b67f8ecc201648070c/c26ae/checklist.png 158w,
/static/a639e1a510fdf9b67f8ecc201648070c/6bdcf/checklist.png 315w,
/static/a639e1a510fdf9b67f8ecc201648070c/f058b/checklist.png 630w,
/static/a639e1a510fdf9b67f8ecc201648070c/40601/checklist.png 945w,
/static/a639e1a510fdf9b67f8ecc201648070c/f09ab/checklist.png 1250w&quot; sizes=&quot;(max-width: 630px) 100vw, 630px&quot; style=&quot;width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;&quot; loading=&quot;lazy&quot; decoding=&quot;async&quot;&gt;
  &lt;/a&gt;
    &lt;/span&gt;
&lt;/div&gt;
&lt;br&gt;
&lt;/br&gt;
&lt;p&gt;시험에 입장하기 위해서는 위에서 말한 대로 VDI 환경 접속을 위한 프로그램을 설치하게 되고, 시험 환경에 들어가게 되면 아래와 같은 환경을 볼 수 있다. (아래 화면은 실제 시험 환경과 유사한 killer.sh의 화면이다.) 좌측에는 시험 문제가 보이며 우측 화면이 VDI 환경이다. 우측 화면에서 linux shell, firefox 브라우저를 오픈해서 Kubernetes Document를 볼 수 있도록 화면을 적절히 분배해서 사용해야 한다. (앞서 얘기하지 않았지만, CKA, CKAD, CKS는 모두 오픈북 시험이다.) 사용하는 모니터가 너무 작거나 네트워크 환경이 유선이 아닌 경우 시험을 볼 때 지옥을 경험할 수 있다.&lt;/p&gt;
&lt;br&gt;
&lt;div align=&quot;left&quot;&gt;
  &lt;span class=&quot;gatsby-resp-image-wrapper&quot; style=&quot;position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 630px; &quot;&gt;
      &lt;a class=&quot;gatsby-resp-image-link&quot; href=&quot;/static/a81b37f480182d5e88e5f668296b9d60/58213/test.png&quot; style=&quot;display: block&quot; target=&quot;_blank&quot; rel=&quot;noopener&quot;&gt;
    &lt;span class=&quot;gatsby-resp-image-background-image&quot; style=&quot;padding-bottom: 67.08860759493672%; position: relative; bottom: 0; left: 0; background-image: url(&apos;data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAANCAYAAACpUE5eAAAACXBIWXMAABYlAAAWJQFJUiTwAAADOUlEQVR42m2SXWxTZRjHz9nadctaztqOdlvbM9KtJVsz0NB9dKCRxHhjIm6TbWHCPmIjcuOF3nhl1uFAmShcKZBoWEIIRmN0LiLErysTNeqFgiFCtcWu3+u2frHUn28PJGL0JP+8T85Jfu/veZ4jjR2YZmJiguDMNM9MTzE6OsaTQ8PMHDrIYfEuODXJzOQhDh4YZ3x0hPH9wyIjjD01zP6RIUZFfTgY5MizQSYnZ5ASyTS30yk+++E6S9/+zB+izufznP/6V04u/8ipj77h2OJV5s4tM3vmE2bf+pjQmSVCby9x/J3LvHnhc05d+IK5s8tc/PR7pHIFoqkc7331E4tXvuNGLE0imaLn8SlMvU/g2D2EqWsvhvYAdeoAOlcftW1+ZKsPvX0nSkcA07Y+pKYujry0gFTMZCnHIsBfFFYzVFaixH+7gaezA7tZwa066Nym4nG3ozpacLXZUYwN6GQJWZKQ7svC628gbSSSJMM3yRWK3I5EiN+6ReTaL+zY+QAOpxOXS8XpdImIU1VR1XYcDif6ujoBkampqUWWazTgqwsCmM/mWF+JUSiXySYTlNJJ4r+H6eruxmw2Y7FYUBQFZYuCyWRii0iT0oROp/uXnQY8cRIpu5anWMhTFsDNzTtUn0QiTrcAVmEulwu73Y5V1EajEWOjEZPRhF6vvw8ma+fR+WPCsHiHdDotgCVyG3mSq+tEIlF8Ph9Wq5W21lZaRVpaWsTZpllXLWVZ/gd4rw4dnRdLKW+ymlujWCqxIX6XfLFELLZCT88OOjs62e7djtvtxuvx4vF4tHi9Xm0MVYgGvgecnZu/axiOxvgzmdFMc2s5otGoaNmnWVVbtm21YbPZNePm5mYtDfX1/w+sGpbWMxTW0trsstkM4XBYA9psNg24VQAtFqs2w8bGRm05NbW1/2n55dArSNfiJZaur/PlzQ0qlYq2lFQqhd/vRxUw1eW8O0dhaxcXWMQMrRYzBoNB27S5SaFZmDfUG5g//hrS6Xcv8cKJs4ROn+fSB+/z4fJlzi1eZGziafYN7WPvo4/ROzBI/+AeegOD7Ort50F/H7tE+voDDOx5mMBDj4jvu3nu+Rf5G0LkLAYWQaGrAAAAAElFTkSuQmCC&apos;); background-size: cover; display: block;&quot;&gt;&lt;/span&gt;
  &lt;img class=&quot;gatsby-resp-image-image&quot; alt=&quot;test&quot; title=&quot;&quot; src=&quot;/static/a81b37f480182d5e88e5f668296b9d60/f058b/test.png&quot; srcset=&quot;/static/a81b37f480182d5e88e5f668296b9d60/c26ae/test.png 158w,
/static/a81b37f480182d5e88e5f668296b9d60/6bdcf/test.png 315w,
/static/a81b37f480182d5e88e5f668296b9d60/f058b/test.png 630w,
/static/a81b37f480182d5e88e5f668296b9d60/58213/test.png 902w&quot; sizes=&quot;(max-width: 630px) 100vw, 630px&quot; style=&quot;width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;&quot; loading=&quot;lazy&quot; decoding=&quot;async&quot;&gt;
  &lt;/a&gt;
    &lt;/span&gt;
&lt;/div&gt;
&lt;br&gt;
&lt;p&gt;시험 환경이 리눅스이다 보니 윈도우나 맥북에서 사용하던 복사/붙여넣기 키가 통하지 않는다. ctrl + c / ctrl + v 대신 ctrl + insert / shift + insert를 사용해야 하므로 시험 시 헷갈리지 않으려면 미리 killer.sh 환경에서 연습이 필요할 수 있다.&lt;/p&gt;
&lt;/br&gt;
&lt;p&gt;두 시험 모두 시험 시간은 2시간으로 총 17문제 정도가 주어진다. 시험은 부분점수가 존재하므로 답을 모르더라도 최대한 풀어보는 것이 좋다. 그리고 시간 분배가 중요하므로 잘 모르는 문제는 넘어 갔다가 나중에 다시 확인해야 한다. 오픈북이라고 한 문제만 너무 잡고 있는 것 보다는 전략적으로 시간 분배하도록 하자.&lt;/p&gt;
&lt;/br&gt;
&lt;p&gt;두 시험 모두 유효기간은 2년이다 (과거에는 3년이었던 적도 있는데 2024년 4월부터 2년으로 변경되었다.) 즉, 2년마다 시험을 갱신해야 한다.&lt;/p&gt;
&lt;h2&gt;시험 공부하기&lt;/h2&gt;
&lt;p&gt;거의 모든 CKA, CKAD 시험 후기를 보면 시험 공부를 위해 세 가지 강의를 추천한다.&lt;/p&gt;
&lt;/br&gt;
&lt;ul&gt;
&lt;li&gt;&lt;a href=&quot;https://www.udemy.com/course/certified-kubernetes-administrator-with-practice-tests/?couponCode=KRLETSLEARNNOW&quot;&gt;Udemy Certified Kubernetes Administrator (CKA) with Practice Tests&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href=&quot;https://www.youtube.com/playlist?list=PLApuRlvrZKojqx9-wIvWP3MPtgy2B372f&quot;&gt;[따배씨] CKA 시리즈&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href=&quot;https://www.udemy.com/course/certified-kubernetes-application-developer/?couponCode=KRLETSLEARNNOW&quot;&gt;Kubernetes Certified Application Developer (CKAD) with Tests&lt;/a&gt;&lt;/li&gt;
&lt;/ul&gt;
&lt;/br&gt;
&lt;p&gt;Udemy 강의는 이론부터 실전(Kodekloud 실습 쿠폰을 통해 kubernetes 클러스터 실습 가능), 모의 시험까지 제공하는 엄청난 가성비 강의이다. 또한, 완전 영어 강의지만 그렇게 어렵지 않은 수준으로 강의해주므로 CKA, CKAD의 Bible처럼 여겨진다. 강의의 마지막에는 Lightling Lab과 Mock Exam이 제공되는데, 두세번은 반복해서 풀어보는 것을 추천한다. 실제 시험과 가장 유사한 난이도로 출제된다.&lt;/p&gt;
&lt;/br&gt;
&lt;p&gt;이성미 강사님의 따배씨는 실제 출제되는 유형을 위주로 연습한다. 이론에 대해서도 알려주시지만 실전 연습할 때는 이 강의를 보는 것도 좋다. 다만 따배씨 쿠버네티스는 CKA만 지원된다. (2024/11/16 현재)&lt;/p&gt;
&lt;/br&gt;
&lt;p&gt;그 외에도 Linux Foundation에서 시험을 예악하면, Killer.sh에서 실제 시험 환경과 유사한 VDI환경에서 시험을 치룰 수 있도록 모의 시험을 제공해준다. 시험마다 2회씩 제공되는데, 실제 시험보다는 훨씬 어려운 수준이라 점수가 낮더라도 너무 낙담할 필요는 없다. 실제 시험 환경을 경험해본다는 데에 의미를 두면 된다.&lt;/p&gt;
&lt;/br&gt;
&lt;h2&gt;시험 후기&lt;/h2&gt;
&lt;p&gt;마지막으로 시험을 치룬 후기도 올려보자면... CKA는 처음 쿠버네티스를 접하고나서부터 취득하기 까지 대략 2년의 시간이 흘렀던 것 같다. 그 사이에 몇 번이나 공부를 하다가 중단하다를 반복하였는데, 올해 초에 무조건 올해에는 딴다고 결심하였고 다른 취득한 사람의 후기를 찾아보다 보니 자신감이 생겨 몇 개월 만에 취득하게 된 것 같다. 역시나 시험은 자신감이 중요하다는 생각이 들었다.&lt;/p&gt;
&lt;/br&gt;
&lt;p&gt;CKAD는 아무래도 CKA와 시험범위가 많이 겹치다 보니 빠르게 취득할 수 있을거라 생각했고 다시 2-3달만에 취득하게 된 것 같다. 실제로는 몇일만 더 공부하면 (readinessProbe, livenessProbe, Canary Update, helm, docker, job, cronjob만 추가로 공부하면) 쉽게 취득할 수 있을것이다. 나의 경우 전체 범위를 한 번 더 둘러보다 보니 시간이 더 허비되었는데 CKA를 봤다면 크게 다르지 않았다.&lt;/p&gt;
&lt;/br&gt;
&lt;p&gt;사실 이 후기가 좀 두서가 없긴 한데, 최대한 여러 블로그의 내용을 한군데에 집약하고 싶었다. 시험이 시간이 지나면서 바뀐 부분도 많기도 해서 가능하면 최근에 올린 후기를 보고 준비하는 것이 좋을 것 같다. 다시 한 번 말하지만 CKA, CKAD 시험은 자신감이 중요한 것 같다. 잘 모르는 분야라고 너무 쫄 필요는 없는 것 같다. 여러 번 반복하고 하다 보면 문외한에서 쿠버네티스가 익숙해진 자신을 발견할 수 있을 것 이다.&lt;/p&gt;
&lt;/br&gt;
&lt;h2&gt;시험에 참고한 사이트&lt;/h2&gt;
&lt;p&gt;&lt;a href=&quot;https://peterica.tistory.com/category/Kubernetes/CKA%26CKAD&quot;&gt;https://peterica.tistory.com/category/Kubernetes/CKA%26CKAD&lt;/a&gt;&lt;/br&gt;
&lt;a href=&quot;https://cumulus.tistory.com/95&quot;&gt;https://cumulus.tistory.com/95&lt;/a&gt;&lt;/br&gt;
&lt;a href=&quot;https://nayoungs.tistory.com/entry/CKACertified-Kubernetes-Administrator-%ED%95%A9%EA%B2%A9-%EB%B0%8F-%EC%8B%9C%ED%97%98-%ED%9B%84%EA%B8%B0&quot;&gt;https://nayoungs.tistory.com/entry/CKACertified-Kubernetes-Administrator-%ED%95%A9%EA%B2%A9-%EB%B0%8F-%EC%8B%9C%ED%97%98-%ED%9B%84%EA%B8%B0&lt;/a&gt;&lt;/br&gt;&lt;/p&gt;</content:encoded></item><item><title><![CDATA[[쿠버네티스 완벽 가이드] 17. 컨피그 & 스토리지 API 카테고리 (3) - 영구 볼륨(PV), 영구 볼륨 클레임(PVC), Storage Class]]></title><description><![CDATA[7.7 영구 볼륨(PV) 대규모 시스템이 모여 있는 클러스터 내에서 Pod가 생성될 때마다, Storage를 설정해줘야 한다. 모든 Pod에 일일히 설정하기는 너무 번거롭다. 쿠버네티스에는 중앙화된 거대한 pool…]]></description><link>https://github.com/SiverPineValley/SiverPineValley.github.io/kubernetes/kubernetes_7_3/</link><guid isPermaLink="false">https://github.com/SiverPineValley/SiverPineValley.github.io/kubernetes/kubernetes_7_3/</guid><pubDate>Mon, 05 Feb 2024 18:10:00 GMT</pubDate><content:encoded>&lt;h1&gt;7.7 영구 볼륨(PV)&lt;/h1&gt;
&lt;p&gt;대규모 시스템이 모여 있는 클러스터 내에서 Pod가 생성될 때마다, Storage를 설정해줘야 한다. 모든 Pod에 일일히 설정하기는 너무 번거롭다. 쿠버네티스에는 중앙화된 거대한 pool의 스토리지를 생성하고, 각 유저들에게 조금씩 이를 쪼개어(carve out) 줄 수 있는데, 이러한 기능을 Persistent Volume이라고 한다.&lt;/p&gt;
&lt;/br&gt;
&lt;p&gt;영구 볼륨(Persistent Volume)이란 쿠버네티스에서 영속성 영역으로 확보된 볼륨이다. 기존에 설명한 볼륨은 파드 정의 안에 직접 정의 하는 형태이지만, 영구 볼륨은 개별 리소스로 생성한다. 파드에서 이를 직접적으로 연결하는 것은 불가능하다. 이를 연결하기 위해서는 영구 볼륨 클레임(Persistent Volume Claim) 리소스를 생성하고, 이를 파드의 &lt;code class=&quot;language-text&quot;&gt;spec.volumes.persistentVolumeClaim&lt;/code&gt; 필드에서 연결할 수 있다.&lt;/p&gt;
&lt;/br&gt;
&lt;p&gt;영구 볼륨은 기본적으로 네트워크를 통해서 마운트하는 디스크 타입이다. 단일 노드 시에는 테스트용으로 hostPath가 제공되지만, 영구 볼륨으로는 실용적이지 않다. 사용 가능한 플러그인의 종류는 다음과 같다.&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;GCE Persistent Disk&lt;/li&gt;
&lt;li&gt;AWS EBS(Elastic Block Store)&lt;/li&gt;
&lt;li&gt;Azure File&lt;/li&gt;
&lt;li&gt;nfs&lt;/li&gt;
&lt;li&gt;iSCSI&lt;/li&gt;
&lt;li&gt;Ceph(RBD, CephFS)&lt;/li&gt;
&lt;li&gt;OpenStack Cinder&lt;/li&gt;
&lt;li&gt;GlusterFS&lt;/li&gt;
&lt;li&gt;Container Store Interface (CSI)&lt;/li&gt;
&lt;/ul&gt;
&lt;/br&gt;
&lt;h2&gt;7.7.1 CSI(Container Store Interface)&lt;/h2&gt;
&lt;p&gt;&lt;code class=&quot;language-text&quot;&gt;CSI(Container Store Interface)&lt;/code&gt;는 컨테이너 오케스트레이션 엔진과 스토리지 시스템을 연결하는 인터페이스이다. 과거에는 쿠버네티스에서 프로바이더용 플러그인이 개발되었지만, 플러그인이 업데이트가 있을 때마다 쿠버네티스의 변경이 불가피하였다. 여러 종류의 Storage에 대한 종속성을 해결하기 위해 벤더들의 표준을 지정하였고, 이를 지원하는 플러그인이 CSI이다. 벤더의 종류는 아래와 같다.&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;Amazon EBS(Elastic Block Store)&lt;/li&gt;
&lt;li&gt;Azure Desk&lt;/li&gt;
&lt;li&gt;Port Works&lt;/li&gt;
&lt;li&gt;Dell EMC Isilon&lt;/li&gt;
&lt;li&gt;PowerMax Unity&lt;/li&gt;
&lt;li&gt;XtermIO&lt;/li&gt;
&lt;/ul&gt;
&lt;/br&gt;
&lt;h2&gt;7.7.2 영구 볼륨 생성&lt;/h2&gt;
&lt;p&gt;영구 볼륨을 생성할 때에는 다음과 같은 항목들을 고려해야 한다.&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;레이블&lt;/li&gt;
&lt;li&gt;용량&lt;/li&gt;
&lt;li&gt;Access Mode&lt;/li&gt;
&lt;li&gt;Reclaim Policy&lt;/li&gt;
&lt;li&gt;Mount Option&lt;/li&gt;
&lt;li&gt;Storage Class&lt;/li&gt;
&lt;li&gt;HostPath&lt;/li&gt;
&lt;li&gt;각 플러그인 특유의 설정&lt;/li&gt;
&lt;/ul&gt;
&lt;/br&gt;
&lt;h3&gt;7.7.2.1 레이블&lt;/h3&gt;
&lt;p&gt;동적 프로비저닝을 사용하지 않고 영구 볼륨을 생성하는 경우 영구 볼륨 종류를 알 수 없기 때문에 레이블을 지정하는 것이 좋다. &lt;code class=&quot;language-text&quot;&gt;metadata.labels&lt;/code&gt;애서 지정한다.&lt;/p&gt;
&lt;/br&gt;
&lt;h3&gt;7.2.2.2 용량&lt;/h3&gt;
&lt;p&gt;용량을 지정할 때 주의해야 할 점은 동적 프로비저닝을 사용할 수 없는 환경에서는 작은 용량의 영구 볼륨도 준비해두어야 한다는 점이다. 영구 볼륨 클레임에서 작은 용량의 클레임이 요청된 경우, 생성된 영구 볼륨 중 가장 비슷한 용량이 지정되기 때문이다. &lt;code class=&quot;language-text&quot;&gt;spec.capacity.storage&lt;/code&gt;에서 지정한다.&lt;/p&gt;
&lt;br&gt;
&lt;div align=&quot;left&quot;&gt;
  &lt;span class=&quot;gatsby-resp-image-wrapper&quot; style=&quot;position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 630px; &quot;&gt;
      &lt;a class=&quot;gatsby-resp-image-link&quot; href=&quot;/static/61dfdfffe5fe0df906b37ee858855554/d61c2/persistentvolume.png&quot; style=&quot;display: block&quot; target=&quot;_blank&quot; rel=&quot;noopener&quot;&gt;
    &lt;span class=&quot;gatsby-resp-image-background-image&quot; style=&quot;padding-bottom: 56.32911392405063%; position: relative; bottom: 0; left: 0; background-image: url(&apos;data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAALCAYAAAB/Ca1DAAAACXBIWXMAABYlAAAWJQFJUiTwAAAC1UlEQVR42iWRWUhUURjH72MPFdRLj9FbgSRBRQXttBClFq1Y2g7ZarZZDJVZKtVEC1SaRWVBm9nKmKkxhBWVFAZtOqk56p2Ze+4y9844o/Lr3Onhxznn4ft9/+87ypN779mysorPDU3YV5YSflPB38IGtDU1+H7Ws96/g8bWJlZca2F/7XfUoteo0yr5UNNM9uJKHtxq4kCzh13+w4TCIZTqO+/IzbrF5zo/Me9MInUX6Mx9iphRRU3Lc7Iacqj95WdZeQsFtT8IlTSizr3Jl7pv7Fx/F9/jZkpavJz44CUSiaAIoaUuumkSkR10w0CPCAyJE3PkW8exHUk0hR13MJ0oUcfCjppYlkFUj2LqJkITKK5M01yphhBSpAt0+VbVEMGuIL29Kl3Bbnrk2R3spUcSVsPowsAwZAgpEbJGE//rFVfmYshkrsy0LIRM19HZSevvNgKBdgJtAdrl2db6h9+BAD3dvTKdTCkTu1JT1rpSXejuyIL/GHJkHdvQcAxBXHdSRVZMYseJxvqwLZuk1UfUtGRzC10iLJHCDeSuS9FTZpP8rVdZPqeQqj1Lqc/J5GHaIfbt3sSci2uZ5blN2v4Krm+s5uGYbdTNLWfVwmJWLz5JxrHN5N3dIxvasokUGqabTLBpeQXz04/zKm8q7dnT+Tq8iIM715F2P5PRR54xwuOjbMp1AsMKeTHyFIsmlrFwUhlTileysX47hvxUU6KYUqjJD9mQcYPZY8/yZXc6Ts5kwoqXwwU5jKtfwihPI0NKP1E64SoopfiGFjNv/DkWjD9P+ulMsv1bUzJL7j8ldOe/VPqKwrwH/LyWj+bdh5rxiPLLZWx76yG3somsmx+pPvSSyLwbNG95xNG9jykqeEp+VRElvjM48RiW3K3iylxzXyJGIhknluwn1j9AggFCoTDBP12Euv+iBjsIqkE6JPFkAhhkcDDJYHKA/kQ/tm2nPP8A5PbJk0w4t3wAAAAASUVORK5CYII=&apos;); background-size: cover; display: block;&quot;&gt;&lt;/span&gt;
  &lt;img class=&quot;gatsby-resp-image-image&quot; alt=&quot;persistentvolume&quot; title=&quot;&quot; src=&quot;/static/61dfdfffe5fe0df906b37ee858855554/f058b/persistentvolume.png&quot; srcset=&quot;/static/61dfdfffe5fe0df906b37ee858855554/c26ae/persistentvolume.png 158w,
/static/61dfdfffe5fe0df906b37ee858855554/6bdcf/persistentvolume.png 315w,
/static/61dfdfffe5fe0df906b37ee858855554/f058b/persistentvolume.png 630w,
/static/61dfdfffe5fe0df906b37ee858855554/40601/persistentvolume.png 945w,
/static/61dfdfffe5fe0df906b37ee858855554/78612/persistentvolume.png 1260w,
/static/61dfdfffe5fe0df906b37ee858855554/d61c2/persistentvolume.png 1800w&quot; sizes=&quot;(max-width: 630px) 100vw, 630px&quot; style=&quot;width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;&quot; loading=&quot;lazy&quot; decoding=&quot;async&quot;&gt;
  &lt;/a&gt;
    &lt;/span&gt;
&lt;/div&gt;
&lt;br&gt;
&lt;h3&gt;7.2.2.3 접근 모드&lt;/h3&gt;
&lt;p&gt;접근 모드는 Volume이 호스트에 어떻게 마운트되어야 하는지를 정의한다.&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;ReadWriteOnce(RWO): 단일 노드에서 Read/Write 가능&lt;/li&gt;
&lt;li&gt;ReadMany(ROX): 여러 노드에서 Read 가능&lt;/li&gt;
&lt;li&gt;ReadWriteMany(RWX): 여러 노드에서 Read/Write 가능&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;주의할 점은 각 모드는 파드 단위가 아닌, 노드 단위이다. 한 노드 내의 여러 파드에서 동시에 Claim한다면 동시에 Read/Write도 가능하다는 이야기이다. 특히 &lt;code class=&quot;language-text&quot;&gt;ReadWriteMany(RXO)&lt;/code&gt;의 경우 하나라도 쓰기 요청이 있는 파드가 있다면, 다른 노드에서 마운트가 불가능하기 떼문에 영구 볼륨 클레임을 지정할 때 &lt;code class=&quot;language-text&quot;&gt;readOnly&lt;/code&gt;로 지정한다. &lt;code class=&quot;language-text&quot;&gt;spec.volumes[].persistentVolumeClaim.readOnly&lt;/code&gt;에서 지정한다.&lt;/p&gt;
&lt;/br&gt;
&lt;h3&gt;7.2.2.4 Reclaim Policy&lt;/h3&gt;
&lt;p&gt;Reclaim Policy는 영구 볼륨을 사용한 후 처리 방법을 제어하는 정책이다. 영구 볼륨 클레임에서 사용된 후 그 영구 볼륨 클레임이 삭제되었을 때 영구 볼륨의 동작을 설정한다. &lt;code class=&quot;language-text&quot;&gt;spec.persistentVolumeReClaimPolicy&lt;/code&gt;를 설정하는 방법은 다음 세 가지 이다.&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;Delete
&lt;ul&gt;
&lt;li&gt;영구 볼륨 자체가 삭제된다.&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;li&gt;Retain
&lt;ul&gt;
&lt;li&gt;영구 볼륨 자체를 삭제하지 않고 유지한다.&lt;/li&gt;
&lt;li&gt;또 다른 영구 볼륨 클레임에 의해 이 영구 볼륨이 다시 마운트되지 않는다.&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;li&gt;Recycle
&lt;ul&gt;
&lt;li&gt;영구 볼륨 데이터를 삭제하고, 재사용 가능 상태로 만든다.&lt;/li&gt;
&lt;li&gt;다른 영구 볼륨 클레임에서 다시 마운트 가능.&lt;/li&gt;
&lt;li&gt;이 정책은 쿠버네티스에서 더 이상 사용되지 않는다.&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;/ul&gt;
&lt;/br&gt;
&lt;h3&gt;7.2.2.5 Storage Class&lt;/h3&gt;
&lt;p&gt;GKE에는 기본으로 &lt;code class=&quot;language-text&quot;&gt;kubernetes.io/gce-pd&lt;/code&gt;라는 프로비저너가 설정된 스토리지 클래스가 정의되어 있다. 프로비저너는 클라우드 환경의 API를 호출하는 등 동적으로 영구 볼륨을 프로비저닝하는 구조이다. 따라서 GKE에서 기본 설정 그대로 영구 볼륨 클레임을 사용하면 자동으로 동적 프로비저닝된다.&lt;/p&gt;
&lt;/br&gt;
&lt;h3&gt;7.2.2.6 Mount Option&lt;/h3&gt;
&lt;p&gt;영구 볼륨의 종류에 따라 &lt;code class=&quot;language-text&quot;&gt;spec.mountOptions&lt;/code&gt;를 설정하여 마운트 옵션을 추가로 설정할 수 있다.&lt;/p&gt;
&lt;/br&gt;
&lt;h3&gt;7.2.2.7 HostPath&lt;/h3&gt;
&lt;p&gt;spec.hostPath에는 스토리지가 사용할 노드의 로컬 디렉토리 경로를 지정한다.&lt;/p&gt;
&lt;/br&gt;
&lt;h3&gt;7.2.2.8 영구 볼륨 플러그인 특유의 설정&lt;/h3&gt;
&lt;p&gt;각 영구 볼륨 종류마다 설정 항목이 조금씩 다르다.&lt;/p&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;yaml&quot;&gt;&lt;pre class=&quot;language-yaml&quot;&gt;&lt;code class=&quot;language-yaml&quot;&gt;&lt;span class=&quot;token comment&quot;&gt;# gcePersistentDisk의 경우&lt;/span&gt;
&lt;span class=&quot;token key atrule&quot;&gt;gcePersistentDisk&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt;
  &lt;span class=&quot;token key atrule&quot;&gt;pdName&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt; sample&lt;span class=&quot;token punctuation&quot;&gt;-&lt;/span&gt;gce&lt;span class=&quot;token punctuation&quot;&gt;-&lt;/span&gt;pv
  &lt;span class=&quot;token key atrule&quot;&gt;fsType&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt; ext4

&lt;span class=&quot;token comment&quot;&gt;# nfs 플러그인의 경우&lt;/span&gt;
&lt;span class=&quot;token key atrule&quot;&gt;nfs&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt;
  &lt;span class=&quot;token key atrule&quot;&gt;server&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt; xxx.xxx.xxx.xxx
  &lt;span class=&quot;token key atrule&quot;&gt;path&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt; /nfs/sample&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;/br&gt;
&lt;p&gt;이렇게 모든 설정을 고려하여 아래와 같은 영구 볼륨(PV)의 생성이 가능하다.&lt;/p&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;yaml&quot;&gt;&lt;pre class=&quot;language-yaml&quot;&gt;&lt;code class=&quot;language-yaml&quot;&gt;&lt;span class=&quot;token key atrule&quot;&gt;apiVersion&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt; v1
&lt;span class=&quot;token key atrule&quot;&gt;kind&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt; PersistentVolume
&lt;span class=&quot;token key atrule&quot;&gt;metadata&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt;
  &lt;span class=&quot;token key atrule&quot;&gt;name&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt; sample&lt;span class=&quot;token punctuation&quot;&gt;-&lt;/span&gt;pv
  &lt;span class=&quot;token key atrule&quot;&gt;labels&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt;
    &lt;span class=&quot;token key atrule&quot;&gt;type&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt; pv
    &lt;span class=&quot;token key atrule&quot;&gt;environment&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt; stg
&lt;span class=&quot;token key atrule&quot;&gt;spec&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt;
  &lt;span class=&quot;token key atrule&quot;&gt;capacity&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt;
    &lt;span class=&quot;token key atrule&quot;&gt;storage&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt; 10Gi
  &lt;span class=&quot;token key atrule&quot;&gt;accessModes&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt;
  &lt;span class=&quot;token punctuation&quot;&gt;-&lt;/span&gt; ReadWriteOnce
  &lt;span class=&quot;token key atrule&quot;&gt;hostPath&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt;
    &lt;span class=&quot;token key atrule&quot;&gt;path&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt; /tmp/data
  &lt;span class=&quot;token key atrule&quot;&gt;persistentVolumeReclaimPolicy&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt; Retain
  &lt;span class=&quot;token key atrule&quot;&gt;storageClass&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt; manual
  &lt;span class=&quot;token comment&quot;&gt;# nfs:&lt;/span&gt;
  &lt;span class=&quot;token comment&quot;&gt;#   server: xxx.xxx.xxx.xxx&lt;/span&gt;
  &lt;span class=&quot;token comment&quot;&gt;#   path: /nfs/sample&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;/br&gt;
&lt;h1&gt;7.8 영구 볼륨 클레임 (PVC)&lt;/h1&gt;
&lt;p&gt;&lt;code class=&quot;language-text&quot;&gt;영구 볼륨 클레임(Persistent Volume Claim)&lt;/code&gt;은 영구 볼륨을 요청하는 리소스이다. 앞에서 설명한 영구 볼륨은 영구 볼륨 클레임을 통해 사용하는 형태이다. 영구 볼륨 클레임에서 지정된 조건(용량, 레이블)을 기반으로 현재 가지고 있는 영구 볼륨에서 적당한 볼륨을 할당한다. 영구 볼륨 클레임을 생성할 때는 아래와 같은 항목을 설정할 수 있다.&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;레이블 셀렉터&lt;/li&gt;
&lt;li&gt;용량&lt;/li&gt;
&lt;li&gt;Access Mode&lt;/li&gt;
&lt;li&gt;StorageClass&lt;/li&gt;
&lt;/ul&gt;
&lt;/br&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;yaml&quot;&gt;&lt;pre class=&quot;language-yaml&quot;&gt;&lt;code class=&quot;language-yaml&quot;&gt;&lt;span class=&quot;token key atrule&quot;&gt;apiVersion&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt; v1
&lt;span class=&quot;token key atrule&quot;&gt;kind&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt; PersistentVolumeClaim
&lt;span class=&quot;token key atrule&quot;&gt;metadata&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt;
  &lt;span class=&quot;token key atrule&quot;&gt;name&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt; sample&lt;span class=&quot;token punctuation&quot;&gt;-&lt;/span&gt;pvc
&lt;span class=&quot;token key atrule&quot;&gt;spec&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt;
  &lt;span class=&quot;token key atrule&quot;&gt;selector&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt;
    &lt;span class=&quot;token key atrule&quot;&gt;matchLabels&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt;
      &lt;span class=&quot;token key atrule&quot;&gt;type&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt; pv
    &lt;span class=&quot;token key atrule&quot;&gt;matchExpressions&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt;
    &lt;span class=&quot;token punctuation&quot;&gt;-&lt;/span&gt; &lt;span class=&quot;token key atrule&quot;&gt;key&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt; environment
      &lt;span class=&quot;token key atrule&quot;&gt;operator&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt; In
      &lt;span class=&quot;token key atrule&quot;&gt;values&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt;
        &lt;span class=&quot;token punctuation&quot;&gt;-&lt;/span&gt; stg
  &lt;span class=&quot;token key atrule&quot;&gt;resources&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt;
    &lt;span class=&quot;token key atrule&quot;&gt;requests&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt;
      &lt;span class=&quot;token key atrule&quot;&gt;storage&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt; 3Gi
  &lt;span class=&quot;token key atrule&quot;&gt;accessModes&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt;
  &lt;span class=&quot;token punctuation&quot;&gt;-&lt;/span&gt; ReadWriteOnce
  &lt;span class=&quot;token key atrule&quot;&gt;storageClassName&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt; manual&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;/br&gt;
&lt;p&gt;이와 같은 PersistentVolume과 PersistentVolumeClaim이 존재한다면, 파드에서는 다음과 같이 볼륨 마운트할 수 있다.&lt;/p&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;yaml&quot;&gt;&lt;pre class=&quot;language-yaml&quot;&gt;&lt;code class=&quot;language-yaml&quot;&gt;&lt;span class=&quot;token key atrule&quot;&gt;apiVersion&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt; v1
&lt;span class=&quot;token key atrule&quot;&gt;kind&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt; Pod
&lt;span class=&quot;token key atrule&quot;&gt;metadata&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt;
  &lt;span class=&quot;token key atrule&quot;&gt;name&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt; sample&lt;span class=&quot;token punctuation&quot;&gt;-&lt;/span&gt;pod&lt;span class=&quot;token punctuation&quot;&gt;-&lt;/span&gt;pvc
&lt;span class=&quot;token key atrule&quot;&gt;spec&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt;
  &lt;span class=&quot;token key atrule&quot;&gt;containers&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt;
  &lt;span class=&quot;token punctuation&quot;&gt;-&lt;/span&gt; &lt;span class=&quot;token key atrule&quot;&gt;name&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt; nginx&lt;span class=&quot;token punctuation&quot;&gt;-&lt;/span&gt;container
    &lt;span class=&quot;token key atrule&quot;&gt;image&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt; nginx&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt;&lt;span class=&quot;token number&quot;&gt;1.16&lt;/span&gt;
    &lt;span class=&quot;token key atrule&quot;&gt;volumeMounts&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt;
    &lt;span class=&quot;token punctuation&quot;&gt;-&lt;/span&gt; &lt;span class=&quot;token key atrule&quot;&gt;name&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt; sample&lt;span class=&quot;token punctuation&quot;&gt;-&lt;/span&gt;pvc
      &lt;span class=&quot;token key atrule&quot;&gt;mountPath&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt; /usr/share/nginx
  &lt;span class=&quot;token key atrule&quot;&gt;volumes&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt;
  &lt;span class=&quot;token punctuation&quot;&gt;-&lt;/span&gt; &lt;span class=&quot;token key atrule&quot;&gt;name&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt; sample&lt;span class=&quot;token punctuation&quot;&gt;-&lt;/span&gt;pvc
    &lt;span class=&quot;token key atrule&quot;&gt;persistentVolumeClaim&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt; sample&lt;span class=&quot;token punctuation&quot;&gt;-&lt;/span&gt;pvc&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;/br&gt;
&lt;p&gt;volumeMounts에서는 몇 가지 옵션을 지정할 수 있다. &lt;code class=&quot;language-text&quot;&gt;readOnly&lt;/code&gt;는 말 그대로 마운트할 때 readOnly 옵션을 주는 케이스이다. hostPath는 컨테이너에 호스트 영역을 보여주기 때문에 보안상 그다지 좋지 않다. 어쩔 수 없이 hostPath로 마운트해야 하는 경우 최소한 readOnly 옵션을 주는 것이 좋다.&lt;/p&gt;
&lt;/br&gt;
&lt;p&gt;&lt;code class=&quot;language-text&quot;&gt;subPath&lt;/code&gt;는 볼륨 마운트 시 특정 디렉터리를 루트로 마운트하는 기능이다. 즉, 호스트의 특정 경로를 subPath로 지정하면, 해당 경로를 mountPath에 마운트한다.&lt;/p&gt;
&lt;/br&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;yaml&quot;&gt;&lt;pre class=&quot;language-yaml&quot;&gt;&lt;code class=&quot;language-yaml&quot;&gt;&lt;span class=&quot;token key atrule&quot;&gt;apiVersion&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt; v1
&lt;span class=&quot;token key atrule&quot;&gt;kind&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt; Pod
&lt;span class=&quot;token key atrule&quot;&gt;metadata&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt;
  &lt;span class=&quot;token key atrule&quot;&gt;name&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt; sample&lt;span class=&quot;token punctuation&quot;&gt;-&lt;/span&gt;volumemount&lt;span class=&quot;token punctuation&quot;&gt;-&lt;/span&gt;option&lt;span class=&quot;token punctuation&quot;&gt;-&lt;/span&gt;pod
&lt;span class=&quot;token key atrule&quot;&gt;spec&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt;
  &lt;span class=&quot;token key atrule&quot;&gt;containers&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt;
  &lt;span class=&quot;token punctuation&quot;&gt;-&lt;/span&gt; &lt;span class=&quot;token key atrule&quot;&gt;image&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt; nginx&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt;&lt;span class=&quot;token number&quot;&gt;1.16&lt;/span&gt;
    &lt;span class=&quot;token key atrule&quot;&gt;name&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt; nginx&lt;span class=&quot;token punctuation&quot;&gt;-&lt;/span&gt;container
    &lt;span class=&quot;token key atrule&quot;&gt;volumeMounts&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt;
    &lt;span class=&quot;token punctuation&quot;&gt;-&lt;/span&gt; &lt;span class=&quot;token key atrule&quot;&gt;mountPath&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt; /srv
      &lt;span class=&quot;token key atrule&quot;&gt;name&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt; sample&lt;span class=&quot;token punctuation&quot;&gt;-&lt;/span&gt;volumemount&lt;span class=&quot;token punctuation&quot;&gt;-&lt;/span&gt;option&lt;span class=&quot;token punctuation&quot;&gt;-&lt;/span&gt;pv
      &lt;span class=&quot;token key atrule&quot;&gt;readOnly&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;token boolean important&quot;&gt;true&lt;/span&gt;
      &lt;span class=&quot;token key atrule&quot;&gt;subPath&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt; /path1
  &lt;span class=&quot;token key atrule&quot;&gt;volumes&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt;
  &lt;span class=&quot;token punctuation&quot;&gt;-&lt;/span&gt; &lt;span class=&quot;token key atrule&quot;&gt;name&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt; sample&lt;span class=&quot;token punctuation&quot;&gt;-&lt;/span&gt;volumemount&lt;span class=&quot;token punctuation&quot;&gt;-&lt;/span&gt;option&lt;span class=&quot;token punctuation&quot;&gt;-&lt;/span&gt;pv
    &lt;span class=&quot;token key atrule&quot;&gt;hostPath&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt;
      &lt;span class=&quot;token key atrule&quot;&gt;path&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt; /etc
      &lt;span class=&quot;token key atrule&quot;&gt;type&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt; DirectoryOrCreate&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;/br&gt;
&lt;h1&gt;7.9 StorageClass&lt;/h1&gt;
&lt;p&gt;Static Provisioning Volume이란 GKE와 같은 클라우드 환경에서 Persistent Volume을 요청하기 위해 클라우드 내에 Disk를 프로비저닝한 뒤, 이와 같은 이름으로 PV를 요청하는 것을 말한다. 이러한 과정이 자동적으로 일어나면 좋기 때문에 Storage Class가 도입되었다. Storage Class는 구글 클라우드 같은 클라우드 서비스에 자동적으로 디스크 프로비저닝할 수 있도록 프로비저너를 정의할 수 있다. 그리고 자동으로 Pod에 마운트된다. 이를 Dynamic Provisioning of Volumes라고 한다. 즉, Storage Class가 생성되면, PV와 이와 연관된 스토리지들이 자동적으로 생성되므로 PV를 정의할 필요가 없게 된다. PVC에는 storageClassName을 붙여서 요청해주면 된다.&lt;/p&gt;
&lt;/br&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;sh&quot;&gt;&lt;pre class=&quot;language-sh&quot;&gt;&lt;code class=&quot;language-sh&quot;&gt;&lt;span class=&quot;token comment&quot;&gt;# Google Cloud disk provisioning&lt;/span&gt;
gcloud beta compute disks create &lt;span class=&quot;token parameter variable&quot;&gt;--size&lt;/span&gt; 1GB &lt;span class=&quot;token parameter variable&quot;&gt;--region&lt;/span&gt; us-east1 pd-disk&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;/br&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;yaml&quot;&gt;&lt;pre class=&quot;language-yaml&quot;&gt;&lt;code class=&quot;language-yaml&quot;&gt;&lt;span class=&quot;token key atrule&quot;&gt;apiVersion&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt; storage.k8s.io/v1
&lt;span class=&quot;token key atrule&quot;&gt;kind&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt; StorageClass
&lt;span class=&quot;token key atrule&quot;&gt;metadata&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt;
  &lt;span class=&quot;token key atrule&quot;&gt;name&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt; google&lt;span class=&quot;token punctuation&quot;&gt;-&lt;/span&gt;storage
&lt;span class=&quot;token key atrule&quot;&gt;provisioner&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt; kubernetes.io/gce&lt;span class=&quot;token punctuation&quot;&gt;-&lt;/span&gt;pd
&lt;span class=&quot;token key atrule&quot;&gt;volumeBindingMode&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt; WaitForFirstConsumer
&lt;span class=&quot;token punctuation&quot;&gt;---&lt;/span&gt;
&lt;span class=&quot;token key atrule&quot;&gt;apiVersion&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt; v1
&lt;span class=&quot;token key atrule&quot;&gt;kind&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt; PersistentVolume
&lt;span class=&quot;token key atrule&quot;&gt;metadata&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt;
  &lt;span class=&quot;token key atrule&quot;&gt;name&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt; pv&lt;span class=&quot;token punctuation&quot;&gt;-&lt;/span&gt;vol1
&lt;span class=&quot;token key atrule&quot;&gt;spec&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt;
  &lt;span class=&quot;token key atrule&quot;&gt;accessModes&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt;
      &lt;span class=&quot;token punctuation&quot;&gt;-&lt;/span&gt; ReadWriteOnce
  &lt;span class=&quot;token key atrule&quot;&gt;capacity&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt;
      &lt;span class=&quot;token key atrule&quot;&gt;storage&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt; 500Mi
  &lt;span class=&quot;token key atrule&quot;&gt;gcePersistentDisk&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt;
    &lt;span class=&quot;token key atrule&quot;&gt;pdName&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt; pd&lt;span class=&quot;token punctuation&quot;&gt;-&lt;/span&gt;disk
    &lt;span class=&quot;token key atrule&quot;&gt;fsType&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt; ext4
  &lt;span class=&quot;token key atrule&quot;&gt;persistentVolumeReclaimPolicy&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt; Retain
&lt;span class=&quot;token punctuation&quot;&gt;---&lt;/span&gt;
&lt;span class=&quot;token key atrule&quot;&gt;apiVersion&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt; v1
&lt;span class=&quot;token key atrule&quot;&gt;kind&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt; PersistentVolumeClaim
&lt;span class=&quot;token key atrule&quot;&gt;metadata&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt;
  &lt;span class=&quot;token key atrule&quot;&gt;name&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt; myclaim
&lt;span class=&quot;token key atrule&quot;&gt;spec&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt;
  &lt;span class=&quot;token key atrule&quot;&gt;accessModes&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt;
      &lt;span class=&quot;token punctuation&quot;&gt;-&lt;/span&gt; ReadWriteOnce
  &lt;span class=&quot;token key atrule&quot;&gt;storageClassName&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt; google&lt;span class=&quot;token punctuation&quot;&gt;-&lt;/span&gt;storage
  &lt;span class=&quot;token key atrule&quot;&gt;resources&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt;
     &lt;span class=&quot;token key atrule&quot;&gt;requests&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt;
       &lt;span class=&quot;token key atrule&quot;&gt;storage&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt; 500Mi&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;/br&gt;
&lt;h1&gt;출처&lt;/h1&gt;
&lt;p&gt;&lt;a href=&quot;https://peterica.tistory.com/272&quot;&gt;https://peterica.tistory.com/272&lt;/a&gt;&lt;/br&gt;&lt;/p&gt;</content:encoded></item><item><title><![CDATA[[쿠버네티스 완벽 가이드] 16. 컨피그 & 스토리지 API 카테고리 (2) - 볼륨 (Volume)]]></title><description><![CDATA[7.…]]></description><link>https://github.com/SiverPineValley/SiverPineValley.github.io/kubernetes/kubernetes_7_2/</link><guid isPermaLink="false">https://github.com/SiverPineValley/SiverPineValley.github.io/kubernetes/kubernetes_7_2/</guid><pubDate>Mon, 05 Feb 2024 11:00:00 GMT</pubDate><content:encoded>&lt;h1&gt;7.5 영구 볼륨 클레임 리소스&lt;/h1&gt;
&lt;p&gt;영구 볼륨 클레임 리소스는 영구 볼륨을 사용하기 위한 리소스이다. 종류에는 볼륨, 영구 볼륨, 영구 볼륨 클레임이 있는데, 각각의 차이점은 다음과 같다.&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;볼륨: 미리 준비된 사용 가능 볼륨 등을 매니페스트에서 직접 지정하여 사용할 수 있게 하는 것이다. 설정된 볼륨의 사용은 가능하나, 신규 볼륨을 생성하거나 기존 볼륨을 삭제하는 것은 불가능하다.&lt;/li&gt;
&lt;li&gt;영구 볼륨: 외부 영구 볼륨을 제공하는 시스템과 연계하여 신규 볼륨을 생성하거나 기존 볼륨을 삭제하는 등의 작업이 가능하다. 매니페스트를 통해 별도로 생성 가능하다. 볼륨과 영구 볼륨은 같은 플러그인을 제공한다.&lt;/li&gt;
&lt;li&gt;영구 볼륨 클레임: 생성된 영구 볼륨 리소스를 할당하는 리소스이다. 영구 볼륨은 클러스터에 볼륨을 등록만 하기 때문에 실제 파드에서 사용하려면 영구 볼륨 클레임을 정의하고 사용해야 한다. 동적 프로비저닝 기능을 사용한 경우 영구 볼륨 클레임이 사용된 시점에 영구 볼륨을 동적으로 생성할 수 있다.&lt;/li&gt;
&lt;/ul&gt;
&lt;/br&gt;
&lt;h2&gt;7.6 볼륨&lt;/h2&gt;
&lt;p&gt;쿠버네티스에서는 볼륨을 추상화하여 파드와 느슨하게 결합된 리소스로 정의하고 있다. 볼륨 플로그인은 다음과 같이 제공되는데, 앞서 설명한 시크릿과 컨피그맵도 볼륨 플러그인의 한 종류이다. 볼륨은 영구 볼륨과 다르게 정적으로 파드에 볼륨을 지정하므로 플러그인에 따라 충돌이 있을 수 있다.&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;emptyDir&lt;/li&gt;
&lt;li&gt;hostPath&lt;/li&gt;
&lt;li&gt;downwardAPI&lt;/li&gt;
&lt;li&gt;projected&lt;/li&gt;
&lt;li&gt;nfs&lt;/li&gt;
&lt;li&gt;iscsi&lt;/li&gt;
&lt;li&gt;cephfs&lt;/li&gt;
&lt;/ul&gt;
&lt;/br&gt;
&lt;h3&gt;7.6.1 emptyDir&lt;/h3&gt;
&lt;br&gt;
&lt;div align=&quot;left&quot;&gt;
  &lt;span class=&quot;gatsby-resp-image-wrapper&quot; style=&quot;position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 504px; &quot;&gt;
      &lt;a class=&quot;gatsby-resp-image-link&quot; href=&quot;/static/1af354b6f2d1b10a23b266d3bbce78ac/08115/empty_dir.png&quot; style=&quot;display: block&quot; target=&quot;_blank&quot; rel=&quot;noopener&quot;&gt;
    &lt;span class=&quot;gatsby-resp-image-background-image&quot; style=&quot;padding-bottom: 58.22784810126582%; position: relative; bottom: 0; left: 0; background-image: url(&apos;data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAMCAYAAABiDJ37AAAACXBIWXMAABYlAAAWJQFJUiTwAAACIElEQVR42pWTy09TQRTG7/+miWt3xpgYjbIwxpVi2LNwgRsLkfhIW7EapFTFFnQBpYqgBap934vFkEhrU9vePu6d6fQ+Ps/cAgFFo5P8cmbmTL4555uMohe30FIPQetmQYPR7EAO13XxP0Opjd9G48E4GvfuoHHfBz0wiZpvDPVM3jvgOA6k5L/gCbb9E+DRZ2DRGbC5aW/eDkxAz2QHFZLgn8evciRYCfpRfRxENfTogErgISq5EroW0DZtdJhzLD3bJQBO54yeA4d0leWCiRWV4d0xvC3+DROhhc94spBG6HUWiVwLfXtP8L3GsHIcKvvtsoQUUzni2Q5GfdO4OXoXV0fGEFvbgTRHiedNLBNLOQOLh5DrJZmjCw8qJj5sMayXBjG1Y2Hzq6A1R3K7h57lQlmjRKVpoclc6BxocRldL9a7NrSK8FqUXSRJaCrJMfSc41KE43KE4eIsx/A8R4Kq7pOnyreG5b1OsZBHJv0Jqc11L+ayaeh608sltzlepRjeZBgukMDppwLXYgLnIwJDcwInAj1MrnLvtZXdPcFyeRelLxo0tUAUoRbzMLpdL7dBguEkw4sNhisvOU5NCZybFTgzI3A2LHAy2IP/I5e/AIo0v0yidcOltuG1u0+tY0MtC8TJR/mqq5qJMFU6Ms9wI8YwTFyPMtxaHHgspIfVlg3Jd90iL/tHkHsy94OEa+0BOvnaNY/SNmw0aF/+gZ/wCmO7nFSfBQAAAABJRU5ErkJggg==&apos;); background-size: cover; display: block;&quot;&gt;&lt;/span&gt;
  &lt;img class=&quot;gatsby-resp-image-image&quot; alt=&quot;empty dir&quot; title=&quot;&quot; src=&quot;/static/1af354b6f2d1b10a23b266d3bbce78ac/08115/empty_dir.png&quot; srcset=&quot;/static/1af354b6f2d1b10a23b266d3bbce78ac/c26ae/empty_dir.png 158w,
/static/1af354b6f2d1b10a23b266d3bbce78ac/6bdcf/empty_dir.png 315w,
/static/1af354b6f2d1b10a23b266d3bbce78ac/08115/empty_dir.png 504w&quot; sizes=&quot;(max-width: 504px) 100vw, 504px&quot; style=&quot;width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;&quot; loading=&quot;lazy&quot; decoding=&quot;async&quot;&gt;
  &lt;/a&gt;
    &lt;/span&gt;
&lt;/div&gt;
&lt;br&gt;
&lt;p&gt;emptyDir는 local Volume 중 하나이며, 파드 내의 파일 시스템을 할당하여 컨테이너들의 임시 디스크 영역으로 사용할 수 있는 플러그인이다. 파드가 종료 되면 삭제된다. 호스트의 임의 영역을 마운트할 수 없으며 파일을 참조할 수도 없다.&lt;/p&gt;
&lt;/br&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;yaml&quot;&gt;&lt;pre class=&quot;language-yaml&quot;&gt;&lt;code class=&quot;language-yaml&quot;&gt;&lt;span class=&quot;token key atrule&quot;&gt;apiVersion&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt; v1
&lt;span class=&quot;token key atrule&quot;&gt;kind&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt; Pod
&lt;span class=&quot;token key atrule&quot;&gt;metadata&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt;
  &lt;span class=&quot;token key atrule&quot;&gt;name&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt; sample&lt;span class=&quot;token punctuation&quot;&gt;-&lt;/span&gt;pod&lt;span class=&quot;token punctuation&quot;&gt;-&lt;/span&gt;emptydir
&lt;span class=&quot;token key atrule&quot;&gt;spec&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt;
  &lt;span class=&quot;token key atrule&quot;&gt;containers&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt;
  &lt;span class=&quot;token punctuation&quot;&gt;-&lt;/span&gt; &lt;span class=&quot;token key atrule&quot;&gt;image&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt; nginx&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt;&lt;span class=&quot;token number&quot;&gt;1.16&lt;/span&gt;
    &lt;span class=&quot;token key atrule&quot;&gt;name&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt; nginx&lt;span class=&quot;token punctuation&quot;&gt;-&lt;/span&gt;container
    &lt;span class=&quot;token key atrule&quot;&gt;volumeMounts&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt;
    &lt;span class=&quot;token punctuation&quot;&gt;-&lt;/span&gt; &lt;span class=&quot;token key atrule&quot;&gt;mountPath&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt; /cache
      &lt;span class=&quot;token key atrule&quot;&gt;name&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt; cache&lt;span class=&quot;token punctuation&quot;&gt;-&lt;/span&gt;volume
  &lt;span class=&quot;token key atrule&quot;&gt;volumes&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt;
  &lt;span class=&quot;token punctuation&quot;&gt;-&lt;/span&gt; &lt;span class=&quot;token key atrule&quot;&gt;name&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt; cache&lt;span class=&quot;token punctuation&quot;&gt;-&lt;/span&gt;volume
    &lt;span class=&quot;token key atrule&quot;&gt;emptyDir&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;/br&gt;
&lt;p&gt;emptyDir은 위와 같이 volumes.emptyDir를 통해 파드에서 생성된다. &lt;code class=&quot;language-text&quot;&gt;emptyDir&lt;/code&gt; 필드에서는 디스크 사이즈의 리소스 제한, 메모리 영역의 리소스 제한 역시 가능하다.&lt;/p&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;yaml&quot;&gt;&lt;pre class=&quot;language-yaml&quot;&gt;&lt;code class=&quot;language-yaml&quot;&gt;&lt;span class=&quot;token key atrule&quot;&gt;apiVersion&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt; v1
&lt;span class=&quot;token key atrule&quot;&gt;kind&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt; Pod
&lt;span class=&quot;token key atrule&quot;&gt;metadata&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt;
  &lt;span class=&quot;token key atrule&quot;&gt;name&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt; sample&lt;span class=&quot;token punctuation&quot;&gt;-&lt;/span&gt;pod&lt;span class=&quot;token punctuation&quot;&gt;-&lt;/span&gt;emptydir&lt;span class=&quot;token punctuation&quot;&gt;-&lt;/span&gt;resource&lt;span class=&quot;token punctuation&quot;&gt;-&lt;/span&gt;limits
&lt;span class=&quot;token key atrule&quot;&gt;spec&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt;
  &lt;span class=&quot;token key atrule&quot;&gt;containers&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt;
  &lt;span class=&quot;token punctuation&quot;&gt;-&lt;/span&gt; &lt;span class=&quot;token key atrule&quot;&gt;image&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt; nginx&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt;&lt;span class=&quot;token number&quot;&gt;1.16&lt;/span&gt;
    &lt;span class=&quot;token key atrule&quot;&gt;name&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt; nginx&lt;span class=&quot;token punctuation&quot;&gt;-&lt;/span&gt;container
    &lt;span class=&quot;token key atrule&quot;&gt;volumeMounts&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt;
    &lt;span class=&quot;token punctuation&quot;&gt;-&lt;/span&gt; &lt;span class=&quot;token key atrule&quot;&gt;mountPath&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt; /data
      &lt;span class=&quot;token key atrule&quot;&gt;name&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt; resource&lt;span class=&quot;token punctuation&quot;&gt;-&lt;/span&gt;volume&lt;span class=&quot;token punctuation&quot;&gt;-&lt;/span&gt;disk
    &lt;span class=&quot;token punctuation&quot;&gt;-&lt;/span&gt; &lt;span class=&quot;token key atrule&quot;&gt;mountPath&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt; /cache
      &lt;span class=&quot;token key atrule&quot;&gt;name&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt; resource&lt;span class=&quot;token punctuation&quot;&gt;-&lt;/span&gt;volume&lt;span class=&quot;token punctuation&quot;&gt;-&lt;/span&gt;memory
  &lt;span class=&quot;token key atrule&quot;&gt;volumes&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt;
  &lt;span class=&quot;token punctuation&quot;&gt;-&lt;/span&gt; &lt;span class=&quot;token key atrule&quot;&gt;name&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt; resource&lt;span class=&quot;token punctuation&quot;&gt;-&lt;/span&gt;volume&lt;span class=&quot;token punctuation&quot;&gt;-&lt;/span&gt;disk
    &lt;span class=&quot;token key atrule&quot;&gt;emptyDir&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt;
      &lt;span class=&quot;token key atrule&quot;&gt;sizeLimit&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt; 128Mi
  &lt;span class=&quot;token punctuation&quot;&gt;-&lt;/span&gt; &lt;span class=&quot;token key atrule&quot;&gt;name&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt; resource&lt;span class=&quot;token punctuation&quot;&gt;-&lt;/span&gt;volume&lt;span class=&quot;token punctuation&quot;&gt;-&lt;/span&gt;memory
    &lt;span class=&quot;token key atrule&quot;&gt;emptyDir&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt;
      &lt;span class=&quot;token key atrule&quot;&gt;medium&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt; Memory
      &lt;span class=&quot;token key atrule&quot;&gt;sizeLimit&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt; 128Mi&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;br/&gt;
&lt;h2&gt;7.6.2 hostPath&lt;/h2&gt;
&lt;p&gt;hostPath는 쿠버네티스 노드 상의 파일시스템 영역을 할당하여, 이를 컨테이너에 매핑하는 플러그인이다. emptyDir과 다르게, 호스트의 임의 영역을 마운트할 수 있기 때문에 사용할 때 호스트의 어떤 영역을 사용할지 지정해야 한다. 또한, 노드에 장애가 일어나지 않는다면, 파드가 지워지더라도 영향을 받지 않는 플러그인이다. 사용 시 type을 지정해야 하는데, 종류는 다음과 같다.&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;Directory: 기존에 생성된 디렉터리의 경로 지정.&lt;/li&gt;
&lt;li&gt;DirectoryOrCreate: 기존의 생서된 디렉터리의 경로 지정. 경로에 존재하지 않을 경우 새롭게 생성.&lt;/li&gt;
&lt;li&gt;File: 기존에 존재하는 파일의 경로 지정.&lt;/li&gt;
&lt;li&gt;FileOrCreate: 기존에 존재하는 파일의 경로 지정. 경로에 존재하지 않을 경우 새롭게 생성.&lt;/li&gt;
&lt;li&gt;Socket: UNIX 소켓&lt;/li&gt;
&lt;li&gt;BlockDevice: (Linux Node에서만 사용 가능) Block Device&lt;/li&gt;
&lt;li&gt;CharDevice: (Linux Node에서만 사용 가능) Character Device&lt;/li&gt;
&lt;/ul&gt;
&lt;br&gt;
&lt;div align=&quot;left&quot;&gt;
  &lt;span class=&quot;gatsby-resp-image-wrapper&quot; style=&quot;position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 502px; &quot;&gt;
      &lt;a class=&quot;gatsby-resp-image-link&quot; href=&quot;/static/4926d1fc9cfed41dfbbdc212b4c48852/eea79/host_path.png&quot; style=&quot;display: block&quot; target=&quot;_blank&quot; rel=&quot;noopener&quot;&gt;
    &lt;span class=&quot;gatsby-resp-image-background-image&quot; style=&quot;padding-bottom: 60.75949367088608%; position: relative; bottom: 0; left: 0; background-image: url(&apos;data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAMCAYAAABiDJ37AAAACXBIWXMAABYlAAAWJQFJUiTwAAACa0lEQVR42pWS3WvTUBjG+78JXnjphaBX4oUoKIIgiIoigleCythEK3ZWhsMWGZ37kI1uq+7TbV27buu6uraba7MmTdN8nOSkSZ69ScZEVMTAL+95c8558rznPRHTsKA2ZWhSG5oon6BKChzHxf8+ESmbR7PvKaRoD1pv+ogXaNG4HouCdfRgked58Pz4DwJBeXkFaqwX7FMSbDhBMQErNYhW/0tYiopjxb/48f7gMFeAEO2F8K4fjdhrIgqhP4q9eByypIFT1Sa9TNv7DZvmeNeDdUzX9RApHzAsFSRUagr26wZ+CCZqBzq+U75WNTG7zTBXCpk/wcBC2cLoQg0zhTYyGwqm1ts4VFxESoINUaMzcrvY2i6iVC5hb38/sK+bLr4UGb4ek9kKmdrQsbALPHw2gFuP+nDzwXPcexKHSEce2WlwtDSHBG3UalUsLS6iWq0EgoblYKLAkFplmCyEYr7jxZ2Q+aKOTL6FTK6JdE5Gve2QQxL0y6mJNgTVwyH9pdFxUWnaWK2YmCGR9AbDWJ4hPscwmmN4nGa4MmTiWsrC9WGOGyM23i9baCrdUHCXNvOuiwbdR1nRIcoq5YBAC6Y3/RJZEEfXGF7NMpx6a+FyiuPiRwuXhjjODlJMMogdEiwLHG2DOmRbyK58w+TEODLT6aBki9qY3gxLHskyJJYYYvMMp0nw3AeOC0mO8wmOMwMcV8mx5AsW6xzrexyK7qDDXLLNgwlFd7FDDZshQb8xYXOM4Bx7Mgy3xxjujjPcIe5/ZkiuGBDaJKhZLg47DkTVQZOEJM0NCHOHxj/xv/lRYw4M81dkMuTfzSNOqGe+4aXKUAAAAABJRU5ErkJggg==&apos;); background-size: cover; display: block;&quot;&gt;&lt;/span&gt;
  &lt;img class=&quot;gatsby-resp-image-image&quot; alt=&quot;host path&quot; title=&quot;&quot; src=&quot;/static/4926d1fc9cfed41dfbbdc212b4c48852/eea79/host_path.png&quot; srcset=&quot;/static/4926d1fc9cfed41dfbbdc212b4c48852/c26ae/host_path.png 158w,
/static/4926d1fc9cfed41dfbbdc212b4c48852/6bdcf/host_path.png 315w,
/static/4926d1fc9cfed41dfbbdc212b4c48852/eea79/host_path.png 502w&quot; sizes=&quot;(max-width: 502px) 100vw, 502px&quot; style=&quot;width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;&quot; loading=&quot;lazy&quot; decoding=&quot;async&quot;&gt;
  &lt;/a&gt;
    &lt;/span&gt;
&lt;/div&gt;
&lt;br&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;yaml&quot;&gt;&lt;pre class=&quot;language-yaml&quot;&gt;&lt;code class=&quot;language-yaml&quot;&gt;&lt;span class=&quot;token key atrule&quot;&gt;apiVersion&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt; v1
&lt;span class=&quot;token key atrule&quot;&gt;kind&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt; Pod
&lt;span class=&quot;token key atrule&quot;&gt;metadata&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt;
  &lt;span class=&quot;token key atrule&quot;&gt;name&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt; sample&lt;span class=&quot;token punctuation&quot;&gt;-&lt;/span&gt;pod&lt;span class=&quot;token punctuation&quot;&gt;-&lt;/span&gt;hostpath
&lt;span class=&quot;token key atrule&quot;&gt;spec&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt;
  &lt;span class=&quot;token key atrule&quot;&gt;containers&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt;
  &lt;span class=&quot;token punctuation&quot;&gt;-&lt;/span&gt; &lt;span class=&quot;token key atrule&quot;&gt;image&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt; nginx&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt;&lt;span class=&quot;token number&quot;&gt;1.16&lt;/span&gt;
    &lt;span class=&quot;token key atrule&quot;&gt;name&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt; nginx&lt;span class=&quot;token punctuation&quot;&gt;-&lt;/span&gt;container
    &lt;span class=&quot;token key atrule&quot;&gt;volumeMounts&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt;
      &lt;span class=&quot;token key atrule&quot;&gt;name&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt; sample&lt;span class=&quot;token punctuation&quot;&gt;-&lt;/span&gt;hostpath
      &lt;span class=&quot;token key atrule&quot;&gt;path&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt; /srv
  &lt;span class=&quot;token key atrule&quot;&gt;volumes&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt;
  &lt;span class=&quot;token punctuation&quot;&gt;-&lt;/span&gt; &lt;span class=&quot;token key atrule&quot;&gt;name&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt; sample&lt;span class=&quot;token punctuation&quot;&gt;-&lt;/span&gt;hostpath
    &lt;span class=&quot;token key atrule&quot;&gt;hostPath&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt;
      &lt;span class=&quot;token key atrule&quot;&gt;path&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt; /etc
      &lt;span class=&quot;token key atrule&quot;&gt;type&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt; Directory&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;/br&gt;
&lt;h2&gt;7.6.3 downwardAPI&lt;/h2&gt;
&lt;p&gt;환경 변수를 사용할 때 사용했던 필드들인 fieldRef, resourceFieldRef의 사용 방법과 유사한데, 생성된 후 파드의 경로에 파일로써 존재한다.&lt;/p&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;yaml&quot;&gt;&lt;pre class=&quot;language-yaml&quot;&gt;&lt;code class=&quot;language-yaml&quot;&gt;&lt;span class=&quot;token key atrule&quot;&gt;apiVersion&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt; v1
&lt;span class=&quot;token key atrule&quot;&gt;kind&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt; Pod
&lt;span class=&quot;token key atrule&quot;&gt;metadata&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt;
  &lt;span class=&quot;token key atrule&quot;&gt;name&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt; sample&lt;span class=&quot;token punctuation&quot;&gt;-&lt;/span&gt;downard&lt;span class=&quot;token punctuation&quot;&gt;-&lt;/span&gt;api
&lt;span class=&quot;token key atrule&quot;&gt;spec&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt;
  &lt;span class=&quot;token key atrule&quot;&gt;containers&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt;
  &lt;span class=&quot;token punctuation&quot;&gt;-&lt;/span&gt; &lt;span class=&quot;token key atrule&quot;&gt;image&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt; nginx&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt;&lt;span class=&quot;token number&quot;&gt;1.16&lt;/span&gt;
    &lt;span class=&quot;token key atrule&quot;&gt;name&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt; nginx&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt;&lt;span class=&quot;token number&quot;&gt;1.16&lt;/span&gt;
    &lt;span class=&quot;token key atrule&quot;&gt;volumeMounts&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt;
      &lt;span class=&quot;token key atrule&quot;&gt;name&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt; downard&lt;span class=&quot;token punctuation&quot;&gt;-&lt;/span&gt;api&lt;span class=&quot;token punctuation&quot;&gt;-&lt;/span&gt;volume
      &lt;span class=&quot;token key atrule&quot;&gt;path&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt; /srv
  &lt;span class=&quot;token key atrule&quot;&gt;volumes&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt;
  &lt;span class=&quot;token punctuation&quot;&gt;-&lt;/span&gt; &lt;span class=&quot;token key atrule&quot;&gt;name&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt; downard&lt;span class=&quot;token punctuation&quot;&gt;-&lt;/span&gt;api&lt;span class=&quot;token punctuation&quot;&gt;-&lt;/span&gt;volume
    &lt;span class=&quot;token key atrule&quot;&gt;downardAPI&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt;
      &lt;span class=&quot;token key atrule&quot;&gt;items&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt;
      &lt;span class=&quot;token punctuation&quot;&gt;-&lt;/span&gt; &lt;span class=&quot;token key atrule&quot;&gt;path&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;token string&quot;&gt;&quot;podname&quot;&lt;/span&gt;
        &lt;span class=&quot;token key atrule&quot;&gt;fieldRef&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt;
          &lt;span class=&quot;token key atrule&quot;&gt;fieldPath&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt; metadata.name
      &lt;span class=&quot;token punctuation&quot;&gt;-&lt;/span&gt; &lt;span class=&quot;token key atrule&quot;&gt;path&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;token string&quot;&gt;&quot;cpu-request&quot;&lt;/span&gt;
        &lt;span class=&quot;token key atrule&quot;&gt;fieldRef&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt;
          &lt;span class=&quot;token key atrule&quot;&gt;fieldPath&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt; requests.cpu&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;/br&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;sh&quot;&gt;&lt;pre class=&quot;language-sh&quot;&gt;&lt;code class=&quot;language-sh&quot;&gt;$ kubectl &lt;span class=&quot;token builtin class-name&quot;&gt;exec&lt;/span&gt; &lt;span class=&quot;token parameter variable&quot;&gt;-it&lt;/span&gt; sample-downard-api -- &lt;span class=&quot;token function&quot;&gt;ls&lt;/span&gt; /srv
cpu-request podname&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;/br&gt;
&lt;h2&gt;7.6.4 projected&lt;/h2&gt;
&lt;p&gt;&lt;code class=&quot;language-text&quot;&gt;projected&lt;/code&gt;는 secret/configmap/downardAPI/serviceAccountToken의 볼륨 마운트를 하나의 디렉터리에 통합하는 플러그인이다.&lt;/p&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;yaml&quot;&gt;&lt;pre class=&quot;language-yaml&quot;&gt;&lt;code class=&quot;language-yaml&quot;&gt;&lt;span class=&quot;token key atrule&quot;&gt;apiVersion&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt; v1
&lt;span class=&quot;token key atrule&quot;&gt;kind&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt; Pod
&lt;span class=&quot;token key atrule&quot;&gt;metadata&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt;
  &lt;span class=&quot;token key atrule&quot;&gt;name&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt; sample&lt;span class=&quot;token punctuation&quot;&gt;-&lt;/span&gt;projected
&lt;span class=&quot;token key atrule&quot;&gt;spec&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt;
  &lt;span class=&quot;token key atrule&quot;&gt;containers&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt;
  &lt;span class=&quot;token punctuation&quot;&gt;-&lt;/span&gt; &lt;span class=&quot;token key atrule&quot;&gt;name&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt; nginx&lt;span class=&quot;token punctuation&quot;&gt;-&lt;/span&gt;container
    &lt;span class=&quot;token key atrule&quot;&gt;image&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt; nginx&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt;&lt;span class=&quot;token number&quot;&gt;1.16&lt;/span&gt;
    &lt;span class=&quot;token key atrule&quot;&gt;volumeMounts&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt;
    &lt;span class=&quot;token punctuation&quot;&gt;-&lt;/span&gt; &lt;span class=&quot;token key atrule&quot;&gt;name&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt; projected&lt;span class=&quot;token punctuation&quot;&gt;-&lt;/span&gt;volume
      &lt;span class=&quot;token key atrule&quot;&gt;path&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt; /srv
  &lt;span class=&quot;token key atrule&quot;&gt;voumes&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt;
  &lt;span class=&quot;token punctuation&quot;&gt;-&lt;/span&gt; &lt;span class=&quot;token key atrule&quot;&gt;name&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt; projected&lt;span class=&quot;token punctuation&quot;&gt;-&lt;/span&gt;volume
    &lt;span class=&quot;token key atrule&quot;&gt;projected&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt;
      &lt;span class=&quot;token key atrule&quot;&gt;sources&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt;
      &lt;span class=&quot;token punctuation&quot;&gt;-&lt;/span&gt; &lt;span class=&quot;token key atrule&quot;&gt;secret&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt;
          &lt;span class=&quot;token key atrule&quot;&gt;name&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt; sample&lt;span class=&quot;token punctuation&quot;&gt;-&lt;/span&gt;db&lt;span class=&quot;token punctuation&quot;&gt;-&lt;/span&gt;auth
          &lt;span class=&quot;token key atrule&quot;&gt;items&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt;
          &lt;span class=&quot;token punctuation&quot;&gt;-&lt;/span&gt; &lt;span class=&quot;token key atrule&quot;&gt;key&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt; username
            &lt;span class=&quot;token key atrule&quot;&gt;path&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt; secret/username.txt
      &lt;span class=&quot;token punctuation&quot;&gt;-&lt;/span&gt; &lt;span class=&quot;token key atrule&quot;&gt;configmap&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt;
          &lt;span class=&quot;token key atrule&quot;&gt;name&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt; sample&lt;span class=&quot;token punctuation&quot;&gt;-&lt;/span&gt;configmap
          &lt;span class=&quot;token key atrule&quot;&gt;items&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt;
          &lt;span class=&quot;token punctuation&quot;&gt;-&lt;/span&gt; &lt;span class=&quot;token key atrule&quot;&gt;key&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt; nginx.conf
            &lt;span class=&quot;token key atrule&quot;&gt;path&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt; configmap/nginx.conf
      &lt;span class=&quot;token key atrule&quot;&gt;-downardAPI&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt;
          &lt;span class=&quot;token key atrule&quot;&gt;items&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt;
          &lt;span class=&quot;token punctuation&quot;&gt;-&lt;/span&gt; &lt;span class=&quot;token key atrule&quot;&gt;path&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;token string&quot;&gt;&quot;podname&quot;&lt;/span&gt;
            &lt;span class=&quot;token key atrule&quot;&gt;fieldRef&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt;
              &lt;span class=&quot;token key atrule&quot;&gt;fieldPath&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt; metadata.name&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;/br&gt;
&lt;p&gt;생성하고 나면 /srv 경로 아래에 세 가지 종류의 파일이 저장된다.&lt;/p&gt;
&lt;/br&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;yaml&quot;&gt;&lt;pre class=&quot;language-yaml&quot;&gt;&lt;code class=&quot;language-yaml&quot;&gt;$ kubectl exec &lt;span class=&quot;token punctuation&quot;&gt;-&lt;/span&gt;it sample&lt;span class=&quot;token punctuation&quot;&gt;-&lt;/span&gt;projected &lt;span class=&quot;token punctuation&quot;&gt;-&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;-&lt;/span&gt;ls /srv
configmap podname secret

$ kubectl exec &lt;span class=&quot;token punctuation&quot;&gt;-&lt;/span&gt;it sample&lt;span class=&quot;token punctuation&quot;&gt;-&lt;/span&gt;projected &lt;span class=&quot;token punctuation&quot;&gt;-&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;-&lt;/span&gt;ls /srv/configmap
nginx.conf

$ kubectl exec &lt;span class=&quot;token punctuation&quot;&gt;-&lt;/span&gt;it sample&lt;span class=&quot;token punctuation&quot;&gt;-&lt;/span&gt;projected &lt;span class=&quot;token punctuation&quot;&gt;-&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;-&lt;/span&gt;ls /srv/secret
username.txt&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;/br&gt;
&lt;h1&gt;출처&lt;/h1&gt;
&lt;p&gt;&lt;a href=&quot;https://peterica.tistory.com/272&quot;&gt;https://peterica.tistory.com/272&lt;/a&gt;&lt;/br&gt;&lt;/p&gt;</content:encoded></item><item><title><![CDATA[[Flutter] Fluter-Firebase 연동 방법]]></title><description><![CDATA[1. Flutter Firebase 연동 Flutter Provider 강의를 듣다가 Flutter 프로젝트 내에서 Firebase 연동하는 방법을 배우고 있었는데, Firebase 화면에서 Flutter 연동 아이콘이 있음을 확인하고 Flutter…]]></description><link>https://github.com/SiverPineValley/SiverPineValley.github.io/flutter/flutter_firebase/</link><guid isPermaLink="false">https://github.com/SiverPineValley/SiverPineValley.github.io/flutter/flutter_firebase/</guid><pubDate>Sat, 27 Jan 2024 18:00:00 GMT</pubDate><content:encoded>&lt;h1&gt;1. Flutter Firebase 연동&lt;/h1&gt;
&lt;p&gt;Flutter Provider 강의를 듣다가 Flutter 프로젝트 내에서 Firebase 연동하는 방법을 배우고 있었는데, Firebase 화면에서 Flutter 연동 아이콘이 있음을 확인하고 Flutter 프로젝트에 바로 연동할 수 있다는 것을 확인하였다.&lt;/p&gt;
&lt;/br&gt;
&lt;h2&gt;1.1. Firebase 프로젝트 생성&lt;/h2&gt;
&lt;div align=&quot;left&quot;&gt;
  &lt;span class=&quot;gatsby-resp-image-wrapper&quot; style=&quot;position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 630px; &quot;&gt;
      &lt;a class=&quot;gatsby-resp-image-link&quot; href=&quot;/static/3a8c22642fb8f7cf493e9177d15804a0/c6ff8/1.png&quot; style=&quot;display: block&quot; target=&quot;_blank&quot; rel=&quot;noopener&quot;&gt;
    &lt;span class=&quot;gatsby-resp-image-background-image&quot; style=&quot;padding-bottom: 78.48101265822784%; position: relative; bottom: 0; left: 0; background-image: url(&apos;data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAQCAYAAAAWGF8bAAAACXBIWXMAABYlAAAWJQFJUiTwAAACrElEQVR42qWUz08TQRTHl5bStKWl9Ae7tKXt/mrpT9rSdqmLUH4YsgSEgkZEDIkVf8QENMGD4cYNjyZevUj05NF48ejVRP+ir2+2pWyNJkQPn5nZNzPf9+bNvOWMBQmpSh1i1UC6YSBRXoQtpMAeVv8JLl1QEZRy8Mt1RHKzCKc0mvgPwYFRFbaggoGAhAG/SD0RUjE41lkwOJb6C935sHUtCTr4FBh2Po2YmMV6LQtFnQTHRMnOjm86GyVHQbkzJpidCdu7Di56jjVOIQ3OK6FRaeDr6VOszs2B84lw0JwvWQaf1cFnriGg1BDJX8fEVBPexFRP1ArnEKjxK8hMF2HUFLx5chN6UwcXUDBEEY4kS4iXmlBqKxjP6cQsYsU5DCeKlBqZIlP74JhYWa/i+6dNPFvmcX7awI/PLYRFcuRNws6iEDK0eJL6bA9nJA9XrNgHs3G+RB4f3x7g2/khdrUIXj+S8fODjq3tFVTnDeRnluCVNIzIM/BJHdh4RNZofAmzeeIVJpiDIJdwcryDtco49pujODvScPLyBd6dtbG3dxvOWJU21eEVuyRrGE5WL78ZJOqJl8HZgirc0RK+nD/G8baAwzU3nj9YxKvjI7w/28Lu3Q0SrPUEmZBfncVYYQWexDTZNIsgRWjnMxAKC2gf3MLauo6dey202/ex0WrBWN9Evr5AG2uWaDSEc0vgSZAd32o3BV0TJQjVTbjlG3CJTXiUphmRK07eExW6zUpv0zAdlUU3PrVqCgbS878dmQSd0QLsggqp+BCyuo+odAdR0cBQNNO9yVJ/rsRO/swcJuv9EVIK6GGnqUpYHilP0QY8kTpRIVvnoTKHvTx1MW/2DzY3u5SLoraFqKRCrI6pD0u9YmeiQ/QOr4KDn7wUtIdTFqx/EMV83FflF2sTxoysVad/AAAAAElFTkSuQmCC&apos;); background-size: cover; display: block;&quot;&gt;&lt;/span&gt;
  &lt;img class=&quot;gatsby-resp-image-image&quot; alt=&quot;1&quot; title=&quot;&quot; src=&quot;/static/3a8c22642fb8f7cf493e9177d15804a0/f058b/1.png&quot; srcset=&quot;/static/3a8c22642fb8f7cf493e9177d15804a0/c26ae/1.png 158w,
/static/3a8c22642fb8f7cf493e9177d15804a0/6bdcf/1.png 315w,
/static/3a8c22642fb8f7cf493e9177d15804a0/f058b/1.png 630w,
/static/3a8c22642fb8f7cf493e9177d15804a0/40601/1.png 945w,
/static/3a8c22642fb8f7cf493e9177d15804a0/c6ff8/1.png 1088w&quot; sizes=&quot;(max-width: 630px) 100vw, 630px&quot; style=&quot;width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;&quot; loading=&quot;lazy&quot; decoding=&quot;async&quot;&gt;
  &lt;/a&gt;
    &lt;/span&gt;
&lt;/div&gt;
&lt;/br&gt;
&lt;p&gt;먼저, Firebase 콘솔로 이동하여, Firebase 프로젝트부터 생성해준다. 생성하는 방법이 간단해서 상세한 방법은 따로 적지 않았다.&lt;/p&gt;
&lt;/br&gt;
&lt;h2&gt;1.2. Flutter 프로젝트 앱 등록&lt;/h2&gt;
&lt;div align=&quot;left&quot;&gt;
  &lt;span class=&quot;gatsby-resp-image-wrapper&quot; style=&quot;position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 630px; &quot;&gt;
      &lt;a class=&quot;gatsby-resp-image-link&quot; href=&quot;/static/7adf82a93d96a7659d7306bb17b148ca/ae694/3.png&quot; style=&quot;display: block&quot; target=&quot;_blank&quot; rel=&quot;noopener&quot;&gt;
    &lt;span class=&quot;gatsby-resp-image-background-image&quot; style=&quot;padding-bottom: 54.43037974683544%; position: relative; bottom: 0; left: 0; background-image: url(&apos;data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAALCAYAAAB/Ca1DAAAACXBIWXMAABYlAAAWJQFJUiTwAAABuklEQVR42q1S2y4DURQ9vaBK6YUObQft9DLMtE3oVZRKlKJoJUiUByHRSoRn8eAPvHnzAxI+wIM3XyC+Z9lnWmMIiYiHlZW9d87ae699mE8pQM6vQkwWIU9XEMmUEUqVICaKsPtVWAYjGqze6Lf4WmM23wTsgTi6/Qp6R5LoCajoFGRCDCZXsAV3CMw5ZoiDn2qcmatVZ+aBMEweCZwZJbqGxzEYy2IgmoGUXoInnIFLmoJXzlMuC08kA7eUgjuc1uL+4KQWC+PTGphxJUbdXKEplLabWNhqoFI/Q7ZchzeaQ7F2hMWdExTWD7B9fImdxiXyK/sIJOZQ2TvH8u4p5qqHH4I6+KTOUdhoUu4tbxCmSfkUPOZ1J+U4OrgtNISV3mlbEpjFy6czQIiiR0xALWzg7vEFzYtr3N4/4+zqBg9Pr0jOb0KZWYNfnaUjrqJPykFMrUGIl+AIprmg4WJtNlNHOx1HLVTJzxwmZtZ1tvkUahiHj/wapXW550YNXdBiELS0vwNziDDzC7fZ1Cfq1ijZMtLFGhwjCe2guuBP/4ujc0jWfOJsfef3LUjEKPQrwb+gJSj8kyDpvAEqzzIMTciUzAAAAABJRU5ErkJggg==&apos;); background-size: cover; display: block;&quot;&gt;&lt;/span&gt;
  &lt;img class=&quot;gatsby-resp-image-image&quot; alt=&quot;3&quot; title=&quot;&quot; src=&quot;/static/7adf82a93d96a7659d7306bb17b148ca/f058b/3.png&quot; srcset=&quot;/static/7adf82a93d96a7659d7306bb17b148ca/c26ae/3.png 158w,
/static/7adf82a93d96a7659d7306bb17b148ca/6bdcf/3.png 315w,
/static/7adf82a93d96a7659d7306bb17b148ca/f058b/3.png 630w,
/static/7adf82a93d96a7659d7306bb17b148ca/ae694/3.png 850w&quot; sizes=&quot;(max-width: 630px) 100vw, 630px&quot; style=&quot;width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;&quot; loading=&quot;lazy&quot; decoding=&quot;async&quot;&gt;
  &lt;/a&gt;
    &lt;/span&gt;
&lt;/div&gt;
&lt;/br&gt;
&lt;p&gt;다음으로는, 프로젝트 내에서 앱을 연동해야 한다. 생성된 콘솔 내 프로젝트 화면의 상단 좌측에서 Flutter 아이콘을 클릭해준다.&lt;/p&gt;
&lt;/br&gt;
&lt;div align=&quot;left&quot;&gt;
  &lt;span class=&quot;gatsby-resp-image-wrapper&quot; style=&quot;position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 630px; &quot;&gt;
      &lt;a class=&quot;gatsby-resp-image-link&quot; href=&quot;/static/6cd5abdef7bb985eeb3239bcab8231a6/078fe/2.png&quot; style=&quot;display: block&quot; target=&quot;_blank&quot; rel=&quot;noopener&quot;&gt;
    &lt;span class=&quot;gatsby-resp-image-background-image&quot; style=&quot;padding-bottom: 72.78481012658227%; position: relative; bottom: 0; left: 0; background-image: url(&apos;data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAPCAYAAADkmO9VAAAACXBIWXMAABYlAAAWJQFJUiTwAAACLElEQVR42qVU224SURTlB2oURG6t3AozwEBnEIFwKzDAlLZAG2i5DaVNE43RZ2Ni9BN88Af8AY2/54PJcu8zgGDxwfqwOLMOc9asvfaesdmlKh7HddjluoAjphNv4InSuhdsxusvUFovoTVn0IwbHDSuIJeHQtSdOtp6yJU0NtYNQa37Fv7cBfyZDoK5czzNdOE9aK+cbsPqvy3V2OzRCgkcQSoNCZeIFC8Qq4wQPxwjpc8Qpb1EdSJcM2Jr+3yfRHseMuBMNC1BNxFPqi2c+TM9+LQT7D3rCB7InmE3fQr/8561Evfz/pIvrt1rpdv4hw9zdlFyp9LKT2ZXaeMaidpUOGJ+NwbdwsKd5ZCCZ7hSBlk/hkc9ESV4tVP40h3hlt3sEdi9Rz227uPKVGvdpf1lg4QgEzcJBvKXkGq3iBxeI1yaEaZQyKFMjhmJmkkZmkjqc8pwBKU+Jz6B2pzDS+Kc40rQlaTSs32ESiZCRROBwhTR8pji6Kzm0yr5N5iziPPPki1BA8F8n0SmCBepyzXKlDq/XxhQU85IuEfld6l8jsG6DtGY8fm7ggTOhQ/zuITz52JlzmMilUfC7X5xSA8dQKpMiI+QrJvwLUrdEHQmGngQymMnkMXDSJl4a9VRx1+Gezng62LW2JBYqDBGZf4JtdvPUIw3cMjVjdn6p3f5UbSM7OA9Pnz7gY/ff6L/7it2gjnKpn0/Qe4uz5usv0C8+Yo6PYDzP742vwC55uPgOt/r+gAAAABJRU5ErkJggg==&apos;); background-size: cover; display: block;&quot;&gt;&lt;/span&gt;
  &lt;img class=&quot;gatsby-resp-image-image&quot; alt=&quot;2&quot; title=&quot;&quot; src=&quot;/static/6cd5abdef7bb985eeb3239bcab8231a6/f058b/2.png&quot; srcset=&quot;/static/6cd5abdef7bb985eeb3239bcab8231a6/c26ae/2.png 158w,
/static/6cd5abdef7bb985eeb3239bcab8231a6/6bdcf/2.png 315w,
/static/6cd5abdef7bb985eeb3239bcab8231a6/f058b/2.png 630w,
/static/6cd5abdef7bb985eeb3239bcab8231a6/078fe/2.png 934w&quot; sizes=&quot;(max-width: 630px) 100vw, 630px&quot; style=&quot;width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;&quot; loading=&quot;lazy&quot; decoding=&quot;async&quot;&gt;
  &lt;/a&gt;
    &lt;/span&gt;
&lt;/div&gt;
&lt;/br&gt;
&lt;p&gt;가장 첫 번째 단계는 prerequisite들을 설치하는 단계이다. Firebase CLI, flutter SDK 등을 설치해준다. flutter SDK는 이미 설치되어 있을 테니 Firebase CLI 설치 후, &lt;code class=&quot;language-text&quot;&gt;firebase login&lt;/code&gt;을 통해 Firebase 계정에 접근할 수 있도록 로그인 해준다.&lt;/p&gt;
&lt;/br&gt;
&lt;h2&gt;1.3. Firebase CLI를 사용하여 앱 등록&lt;/h2&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;sh&quot;&gt;&lt;pre class=&quot;language-sh&quot;&gt;&lt;code class=&quot;language-sh&quot;&gt;dart pub global activate flutterfire_cli
flutterfire configure &lt;span class=&quot;token parameter variable&quot;&gt;--project&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt;프로젝트명&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;다음으로는, 위의 명령어들을 통해서 Firebaes 앱 등록을 위한 CLI를 다운받아주어야 한다. 이 때, &lt;code class=&quot;language-text&quot;&gt;flutterfire&lt;/code&gt; 명령어가 없다는 에러가 발생하면, &lt;code class=&quot;language-text&quot;&gt;export PATH=&quot;$PATH&quot;:&quot;$HOME/.pub-cache/bin&quot;&lt;/code&gt; 다음과 같은 환경변수를 shell Profile 파일에 입력해주어야 한다.&lt;/p&gt;
&lt;/br&gt;
&lt;p&gt;혹자의 경우 Macbook M1에서 진행하였는데, 진행 도중 아래와 같은 Ruby 스크립트 관련 에러가 발생하였다.&lt;/p&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;sh&quot;&gt;&lt;pre class=&quot;language-sh&quot;&gt;&lt;code class=&quot;language-sh&quot;&gt;jsx
Exception: /System/Library/Frameworks/Ruby.framework/Versions/2.6/usr/lib/ruby/2.6.0/rubygems/core_ext/kernel_require.rb:54:in &lt;span class=&quot;token variable&quot;&gt;&lt;span class=&quot;token variable&quot;&gt;`&lt;/span&gt;require&apos;: cannot load such &lt;span class=&quot;token function&quot;&gt;file&lt;/span&gt; -- xcodeproj &lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;LoadError&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;
        from /System/Library/Frameworks/Ruby.framework/Versions/2.6/usr/lib/ruby/2.6.0/rubygems/core_ext/kernel_require.rb:54:in &lt;span class=&quot;token variable&quot;&gt;`&lt;/span&gt;&lt;/span&gt;require&lt;span class=&quot;token string&quot;&gt;&apos;
        from -e:1:in `&amp;lt;main&gt;&apos;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;/br&gt;
&lt;p&gt;다음 커맨드를 사용해주면 된다.&lt;/p&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;sh&quot;&gt;&lt;pre class=&quot;language-sh&quot;&gt;&lt;code class=&quot;language-sh&quot;&gt;&lt;span class=&quot;token function&quot;&gt;sudo&lt;/span&gt; gem &lt;span class=&quot;token function&quot;&gt;install&lt;/span&gt; cocoapods &lt;span class=&quot;token operator&quot;&gt;&amp;amp;&amp;amp;&lt;/span&gt; pod &lt;span class=&quot;token function&quot;&gt;install&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;/br&gt;
&lt;p&gt;&lt;code class=&quot;language-text&quot;&gt;flutterfire configure --project=프로젝트명&lt;/code&gt; 명령어 사용 시 등록할 수 있는 앱 옵션을 선택할 수 있다. 원하는 앱 옵션을 선택하여 설정하자.&lt;/p&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;sh&quot;&gt;&lt;pre class=&quot;language-sh&quot;&gt;&lt;code class=&quot;language-sh&quot;&gt;$ trailer_manager_web % flutterfire configure &lt;span class=&quot;token parameter variable&quot;&gt;--project&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt;프로젝트명
i Found &lt;span class=&quot;token number&quot;&gt;1&lt;/span&gt; Firebase projects. Selecting project 프로젝트명.
✔ Which platforms should your configuration support &lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;use arrow keys &lt;span class=&quot;token operator&quot;&gt;&amp;amp;&lt;/span&gt; space to &lt;span class=&quot;token keyword&quot;&gt;select&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;? · android, ios, macos, web
i Firebase android app com.example.프로젝트명 is not registered on Firebase project 프로젝트명.
i Registered a new Firebase android app on Firebase project 프로젝트명.
i Firebase ios app com.example.trailerManagerWeb is not registered on Firebase project 프로젝트명.
i Registered a new Firebase ios app on Firebase project 프로젝트명.
i Firebase macos app com.example.trailerManagerWeb.RunnerTests is not registered on Firebase project 프로젝트명.
i Registered a new Firebase macos app on Firebase project 프로젝트명.
i Firebase web app 프로젝트명 &lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;web&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt; is not registered on Firebase project 프로젝트명.
i Registered a new Firebase web app on Firebase project 프로젝트명.
? Generated FirebaseAppID &lt;span class=&quot;token function&quot;&gt;file&lt;/span&gt; /프로젝트명/ios/firebase_app_id_file.json already exists, &lt;span class=&quot;token keyword&quot;&gt;do&lt;/span&gt; you want to override it? &lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;y/n&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt; › &lt;span class=&quot;token function&quot;&gt;yes&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;/br&gt;
&lt;h1&gt;2. 출처&lt;/h1&gt;
&lt;p&gt;&lt;a href=&quot;https://www.udemy.com/course/flutter-provider-essential-korean/&quot;&gt;https://www.udemy.com/course/flutter-provider-essential-korean/&lt;/a&gt;&lt;/br&gt;
&lt;a href=&quot;https://velog.io/@hee_mm_/Flutter-Firebase-%EC%97%B0%EB%8F%99&quot;&gt;https://velog.io/@hee_mm_/Flutter-Firebase-%EC%97%B0%EB%8F%99&lt;/a&gt;&lt;/br&gt;&lt;/p&gt;</content:encoded></item><item><title><![CDATA[[Flutter] 07. ChangeNotifier를 이용한 action 처리]]></title><description><![CDATA[1. ChangeNotifier를 이용한 action의 처리 이번에는 ChangeNotifier를 이용한 action의 처리 방법에 대해 알아보겠다. action의 종류에는 앞서 설명했던  뿐만 아니라, (팝업 표시),  등이 있다. action…]]></description><link>https://github.com/SiverPineValley/SiverPineValley.github.io/flutter/flutter_7/</link><guid isPermaLink="false">https://github.com/SiverPineValley/SiverPineValley.github.io/flutter/flutter_7/</guid><pubDate>Sun, 21 Jan 2024 18:00:00 GMT</pubDate><content:encoded>&lt;h1&gt;1. ChangeNotifier를 이용한 action의 처리&lt;/h1&gt;
&lt;p&gt;이번에는 ChangeNotifier를 이용한 action의 처리 방법에 대해 알아보겠다. action의 종류에는 앞서 설명했던 &lt;code class=&quot;language-text&quot;&gt;Navigator.push&lt;/code&gt; 뿐만 아니라, &lt;code class=&quot;language-text&quot;&gt;showDialog&lt;/code&gt;(팝업 표시), &lt;code class=&quot;language-text&quot;&gt;showBottomSheet&lt;/code&gt; 등이 있다. action을 처리하는 프로세스 패턴은 다음과 같다.&lt;/p&gt;
&lt;ol&gt;
&lt;li&gt;action을 수행하는 void 함수 생성&lt;/li&gt;
&lt;li&gt;&lt;code class=&quot;language-text&quot;&gt;initState&lt;/code&gt; 메소드 내 ChangeNotifier의 addListener 함수를 사용하여 리스너 등록&lt;/li&gt;
&lt;li&gt;&lt;code class=&quot;language-text&quot;&gt;dispose&lt;/code&gt; 메소드 내 ChangeNotifier의 removeListener 함수를 사용하여 리스너 제거&lt;/li&gt;
&lt;/ol&gt;
&lt;/br&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;dart&quot;&gt;&lt;pre class=&quot;language-dart&quot;&gt;&lt;code class=&quot;language-dart&quot;&gt;late &lt;span class=&quot;token keyword&quot;&gt;final&lt;/span&gt; &lt;span class=&quot;token class-name&quot;&gt;AppProvider&lt;/span&gt; appProv&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;

&lt;span class=&quot;token metadata function&quot;&gt;@override&lt;/span&gt;
&lt;span class=&quot;token keyword&quot;&gt;void&lt;/span&gt; &lt;span class=&quot;token function&quot;&gt;initState&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;
  &lt;span class=&quot;token keyword&quot;&gt;super&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;initState&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;
  appProv &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; context&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;read&lt;span class=&quot;token generics&quot;&gt;&lt;span class=&quot;token punctuation&quot;&gt;&amp;lt;&lt;/span&gt;&lt;span class=&quot;token class-name&quot;&gt;AppProvider&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;
  appProv&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;addListener&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;appListener&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;
&lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;

&lt;span class=&quot;token keyword&quot;&gt;void&lt;/span&gt; &lt;span class=&quot;token function&quot;&gt;appListener&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;
  &lt;span class=&quot;token keyword&quot;&gt;if&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;appProv&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;state &lt;span class=&quot;token operator&quot;&gt;==&lt;/span&gt; &lt;span class=&quot;token class-name&quot;&gt;AppState&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;success&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;
    &lt;span class=&quot;token class-name&quot;&gt;WidgetsBinding&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;instance&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;addPostFrameCallback&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;_&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;
      &lt;span class=&quot;token class-name&quot;&gt;Navigator&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;push&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;
        context&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt;
        &lt;span class=&quot;token class-name&quot;&gt;MaterialPageRoute&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;builder&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;context&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;
          &lt;span class=&quot;token keyword&quot;&gt;return&lt;/span&gt; &lt;span class=&quot;token class-name&quot;&gt;SuccessPage&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;
        &lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt;
      &lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;
    &lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;
  &lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt; &lt;span class=&quot;token keyword&quot;&gt;else&lt;/span&gt; &lt;span class=&quot;token keyword&quot;&gt;if&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;appProv&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;state &lt;span class=&quot;token operator&quot;&gt;==&lt;/span&gt; &lt;span class=&quot;token class-name&quot;&gt;AppState&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;error&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;
    &lt;span class=&quot;token class-name&quot;&gt;WidgetsBinding&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;instance&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;addPostFrameCallback&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;
      &lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;_&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;
        &lt;span class=&quot;token function&quot;&gt;showDialog&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;
          context&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt; context&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt;
          builder&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;context&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;
            &lt;span class=&quot;token keyword&quot;&gt;return&lt;/span&gt; &lt;span class=&quot;token class-name&quot;&gt;AlertDialog&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;
              content&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;token class-name&quot;&gt;Text&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token string-literal&quot;&gt;&lt;span class=&quot;token string&quot;&gt;&apos;Something went wrong&apos;&lt;/span&gt;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt;
            &lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;
          &lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt;
        &lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;
      &lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt;
    &lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;
  &lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;
&lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;h1&gt;2. 출처&lt;/h1&gt;
&lt;p&gt;&lt;a href=&quot;https://www.udemy.com/course/flutter-provider-essential-korean/&quot;&gt;https://www.udemy.com/course/flutter-provider-essential-korean/&lt;/a&gt;&lt;/br&gt;&lt;/p&gt;</content:encoded></item><item><title><![CDATA[[Flutter] 06. Provider에서 자주 마주치게 되는 에러들]]></title><description><![CDATA[1. 개요 flutter를 사용하다 보면 자주 마주하게 되는 에러들이 있다. 이러한 에러들에 대한 정리와, 이를 어떻게 처리하면 좋을지에 대해 정리해보았다. 2. 에러들의 종류 2.1. ProviderNotFound Error…]]></description><link>https://github.com/SiverPineValley/SiverPineValley.github.io/flutter/flutter_6/</link><guid isPermaLink="false">https://github.com/SiverPineValley/SiverPineValley.github.io/flutter/flutter_6/</guid><pubDate>Sun, 21 Jan 2024 16:00:00 GMT</pubDate><content:encoded>&lt;h1&gt;1. 개요&lt;/h1&gt;
&lt;p&gt;flutter를 사용하다 보면 자주 마주하게 되는 에러들이 있다. 이러한 에러들에 대한 정리와, 이를 어떻게 처리하면 좋을지에 대해 정리해보았다.&lt;/p&gt;
&lt;/br&gt;
&lt;h1&gt;2. 에러들의 종류&lt;/h1&gt;
&lt;h2&gt;2.1. ProviderNotFound Error&lt;/h2&gt;
&lt;div align=&quot;left&quot;&gt;
  &lt;span class=&quot;gatsby-resp-image-wrapper&quot; style=&quot;position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 630px; &quot;&gt;
      &lt;a class=&quot;gatsby-resp-image-link&quot; href=&quot;/static/0d9ce99a65dd08e32598d334a3619ebd/91a65/provider_not_found.png&quot; style=&quot;display: block&quot; target=&quot;_blank&quot; rel=&quot;noopener&quot;&gt;
    &lt;span class=&quot;gatsby-resp-image-background-image&quot; style=&quot;padding-bottom: 49.36708860759494%; position: relative; bottom: 0; left: 0; background-image: url(&apos;data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAKCAYAAAC0VX7mAAAACXBIWXMAABYlAAAWJQFJUiTwAAABXklEQVR42n1S2W7DMAzL///e9tB1wNAmaXPf92WOspJtGLIJIORINkPKdta2xFKliiLEnD0wFwERYrX1DEuZYM7ZS5/cE8FMA7AZYF2ZBZvCGDhbkWONE2xZBtN1RA/TDzB1DdM0WquZW6LaayP707TnkXnUvCxwQEJ4HvB4AFEIPJ9AXgBtq+iIkt/8AfoeGKjunyAhN/s+ySKFEMbMSUJi/iwIuI6VcJ4BKhNrNo4M84OQFhDzAC1/kcg6TZnT75qoE4hqWrMzO1UoB4KnWn6/qkJRJd+uu/d8XYes1xWsK8EJqTMUNZogRRNm6GMqKUtVIRarCl3IXlygiXLUxFR3Olfpi9LfhAsvYLq5mD5umF1Ph74/AYk5yzHePIzsT66Pla/APhfBqeW+U6tX4u0CXC5qTxRI8NnY+usLcL9zpqlVbudpzAmhyBbIDR63KPnYLD0ZwUEiAmTPH/EJJ7kJIQ2tm68AAAAASUVORK5CYII=&apos;); background-size: cover; display: block;&quot;&gt;&lt;/span&gt;
  &lt;img class=&quot;gatsby-resp-image-image&quot; alt=&quot;provider not found&quot; title=&quot;&quot; src=&quot;/static/0d9ce99a65dd08e32598d334a3619ebd/f058b/provider_not_found.png&quot; srcset=&quot;/static/0d9ce99a65dd08e32598d334a3619ebd/c26ae/provider_not_found.png 158w,
/static/0d9ce99a65dd08e32598d334a3619ebd/6bdcf/provider_not_found.png 315w,
/static/0d9ce99a65dd08e32598d334a3619ebd/f058b/provider_not_found.png 630w,
/static/0d9ce99a65dd08e32598d334a3619ebd/40601/provider_not_found.png 945w,
/static/0d9ce99a65dd08e32598d334a3619ebd/78612/provider_not_found.png 1260w,
/static/0d9ce99a65dd08e32598d334a3619ebd/91a65/provider_not_found.png 2476w&quot; sizes=&quot;(max-width: 630px) 100vw, 630px&quot; style=&quot;width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;&quot; loading=&quot;lazy&quot; decoding=&quot;async&quot;&gt;
  &lt;/a&gt;
    &lt;/span&gt;
&lt;/div&gt;
&lt;/br&gt;
&lt;p&gt;앞서 자주 보게되었던 ProviderNotFound에러이다. 이 에러가 발생하는 케이스는 몇 가지 있는데, 다음과 같다.&lt;/p&gt;
&lt;/br&gt;
&lt;p&gt;첫 번째로는,
새로운 Provider를 생성했음에도 Hot-restart를 하지 않았을 때 발생하는 에러이다. Hot-restart 후 확인하면 해결되는 문제이다.&lt;/p&gt;
&lt;/br&gt;
&lt;p&gt;두 번째로는, 잘못된 route로 발생하는 에러이다. Route 내에 정의된 Provider는 다른 route에서는 접근할 수 없는 유형으로, Provider를 보다 상단의 위젯에서 정의하거나, Builder 위젯을 사용하거나, ProxyProvider 등의 방법으로 해결할 수 있다.&lt;/p&gt;
&lt;/br&gt;
&lt;p&gt;마지막으로는, 잘못된 BuildContext를 사용했을 경우 발생할 수 있는 에러로 앞선 예제에서는 Provider를 감싼 Route 위젯의 context가 사용되거나 해서 발생하는 에러로 context를 사용하지 않도록 수정해주면 대부분 해결된다. 혹은, Provider의 생성 위치를 변경해주는 방법으로도 해결 가능하다.&lt;/p&gt;
&lt;/br&gt;
&lt;h2&gt;2.2. setState() or markNeedsBuild() called during build.&lt;/h2&gt;
&lt;div align=&quot;left&quot;&gt;
  &lt;span class=&quot;gatsby-resp-image-wrapper&quot; style=&quot;position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 630px; &quot;&gt;
      &lt;a class=&quot;gatsby-resp-image-link&quot; href=&quot;/static/191569e618f4a49b304fa29b77b78995/82e86/set_state_mark_need_build.png&quot; style=&quot;display: block&quot; target=&quot;_blank&quot; rel=&quot;noopener&quot;&gt;
    &lt;span class=&quot;gatsby-resp-image-background-image&quot; style=&quot;padding-bottom: 44.93670886075949%; position: relative; bottom: 0; left: 0; background-image: url(&apos;data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAJCAYAAAAywQxIAAAACXBIWXMAABYlAAAWJQFJUiTwAAABpElEQVR42l2R6XLbMAyE9f4v1V9tOumRy1ZlHdZ9n5asiKRkb0E0dSbhzA6AJQF+HBqqKSGLBCL0oBwLMvaxugeoyIcMXCjbhCJPehZEFkJVGZ+XeQxFUZUp1SnnEALGGgdQ1h5L6EIENsT+CXJHokEyDSB0PNpYXBPisIOoc4j5BDn1UOcB6nWCOPcQUwdcrzD6ykebO2gyC3Vioo5NlMEj5Xt0pYcmtdAVLsU/KMNn5OEDKjqb+j9RRM9I/B9IyZNigl5Gkbwg9u6RHO+RBr+QR08cI/cOWfAbofONvYyaIvc7Kw8fEdpfcTS/IHLuEJPXVR4BasI6QBm/8G0VUdVE0pYue111RE00LZHqPe03hc1+34Rc19mBe6ehwOWywWjpOXnwgCKmgTRMbxZ6WO1jnlrM5xYDNWvppnlqSDXGIef9bVXYNoX/y1jlwof0kKZweGCZ7DjXNGIZ+SnXy8oEWtfr5abPy9C3nbr0NkB/ktbYZ3glOk21zD3T6Frn57FiLfPAMFyfKiY15pGMU/l+81v8R0NU2/qevxF+8Lf1Jv2Sv+zjo/ZSoZ8LAAAAAElFTkSuQmCC&apos;); background-size: cover; display: block;&quot;&gt;&lt;/span&gt;
  &lt;img class=&quot;gatsby-resp-image-image&quot; alt=&quot;set state mark need build&quot; title=&quot;&quot; src=&quot;/static/191569e618f4a49b304fa29b77b78995/f058b/set_state_mark_need_build.png&quot; srcset=&quot;/static/191569e618f4a49b304fa29b77b78995/c26ae/set_state_mark_need_build.png 158w,
/static/191569e618f4a49b304fa29b77b78995/6bdcf/set_state_mark_need_build.png 315w,
/static/191569e618f4a49b304fa29b77b78995/f058b/set_state_mark_need_build.png 630w,
/static/191569e618f4a49b304fa29b77b78995/40601/set_state_mark_need_build.png 945w,
/static/191569e618f4a49b304fa29b77b78995/78612/set_state_mark_need_build.png 1260w,
/static/191569e618f4a49b304fa29b77b78995/82e86/set_state_mark_need_build.png 1978w&quot; sizes=&quot;(max-width: 630px) 100vw, 630px&quot; style=&quot;width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;&quot; loading=&quot;lazy&quot; decoding=&quot;async&quot;&gt;
  &lt;/a&gt;
    &lt;/span&gt;
&lt;/div&gt;
&lt;/br&gt;
&lt;p&gt;위 에러는 framework가 위젯을 그리고 있는데, 다시 위젯을 그려달라는 요청이 들어왔을 때 발생한다. Stateful 위젯의 State 위젯 내에서 initState 중간에 Provider의 값을 변경하는 경우 발생할 수 있다. 이러한 에러가 발생하는 이유는 Provider에서 화면을 렌더링하는 절차를 살펴보면 알 수 있다.&lt;/p&gt;
&lt;/br&gt;
&lt;ul&gt;
&lt;li&gt;화면 렌더링 절차&lt;/li&gt;
&lt;/ul&gt;
&lt;ol&gt;
&lt;li&gt;화면 구성 요소 생성 (BuildContext)&lt;/li&gt;
&lt;li&gt;initState&lt;/li&gt;
&lt;li&gt;didChangeDependencies&lt;/li&gt;
&lt;li&gt;Build&lt;/li&gt;
&lt;/ol&gt;
&lt;/br&gt;
&lt;p&gt;페이지가 빌드된 이후부터 우리는 다른 것들을 그릴 수 있게 되는데, initState의 경우 렌더링 중간에 진행되는 절차이므로, 해당 단계에서 context를 이용하여 다른 것들을 화면에 그리는 것이 불가능하다. 마찬가지로, 페이지에 무언가를 그리면서 다른 화면으로 이동시킬 때도 마찬가지로 발생할 수 있다.&lt;/p&gt;
&lt;/br&gt;
&lt;p&gt;이러한 케이스를 방지하기 위해 flutter 프레임워크에서는 자체적으로 해결할 수 있는 방안을 제공해준다. &lt;code class=&quot;language-text&quot;&gt;addPostFrameCallback()&lt;/code&gt; 함수이다.&lt;/p&gt;
&lt;/br&gt;
&lt;h3&gt;2.2.1. addPostFrameCallback&lt;/h3&gt;
&lt;div align=&quot;left&quot;&gt;
  &lt;span class=&quot;gatsby-resp-image-wrapper&quot; style=&quot;position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 630px; &quot;&gt;
      &lt;a class=&quot;gatsby-resp-image-link&quot; href=&quot;/static/eea69792edb8ebfaf1ffae73263a0d18/de9fe/add_post_frame_callback.png&quot; style=&quot;display: block&quot; target=&quot;_blank&quot; rel=&quot;noopener&quot;&gt;
    &lt;span class=&quot;gatsby-resp-image-background-image&quot; style=&quot;padding-bottom: 35.44303797468354%; position: relative; bottom: 0; left: 0; background-image: url(&apos;data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAHCAYAAAAIy204AAAACXBIWXMAABYlAAAWJQFJUiTwAAABBUlEQVR42n2R2aqDQBBE/f//0kcRNSoumAjumgTBfalQDXp9ugNlz9J9eqZUjuMAxzAMcBwHqqpC13VEUYTH4wHf9xGGIQzDgGVZsmaeaZrwPA+2bSPLMmGQpZzAvu/huq4kPJ9PxHEsattWIoEEsFEQBNKEYO5VVfUHHMfxAiRJgjzPURQFvt8v6rqW7u/3W+YUiz+fjzTquk4ic5qmwb7vUKZpkiRuEEixYNs2zPN8iXn3uCwL1nWVeK7lhizkATcZz/l/+2czwinCeDsOhR8m8Nmv1wtlWcqcT6c/NJ+3pneapol3PKfoIf3kGcEX8DT0HukP/yhh9IhiIYFpml65d3H8AEKyDyaBlGoEAAAAAElFTkSuQmCC&apos;); background-size: cover; display: block;&quot;&gt;&lt;/span&gt;
  &lt;img class=&quot;gatsby-resp-image-image&quot; alt=&quot;add post frame callback&quot; title=&quot;&quot; src=&quot;/static/eea69792edb8ebfaf1ffae73263a0d18/f058b/add_post_frame_callback.png&quot; srcset=&quot;/static/eea69792edb8ebfaf1ffae73263a0d18/c26ae/add_post_frame_callback.png 158w,
/static/eea69792edb8ebfaf1ffae73263a0d18/6bdcf/add_post_frame_callback.png 315w,
/static/eea69792edb8ebfaf1ffae73263a0d18/f058b/add_post_frame_callback.png 630w,
/static/eea69792edb8ebfaf1ffae73263a0d18/40601/add_post_frame_callback.png 945w,
/static/eea69792edb8ebfaf1ffae73263a0d18/78612/add_post_frame_callback.png 1260w,
/static/eea69792edb8ebfaf1ffae73263a0d18/de9fe/add_post_frame_callback.png 2146w&quot; sizes=&quot;(max-width: 630px) 100vw, 630px&quot; style=&quot;width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;&quot; loading=&quot;lazy&quot; decoding=&quot;async&quot;&gt;
  &lt;/a&gt;
    &lt;/span&gt;
&lt;/div&gt;
&lt;/br&gt;
&lt;p&gt;이 함수의 역할을 화면이 렌더링 된 이후, 등록된 콜백을 실행시키는 역할이다. UI에 영향을 주는 행동을 현재 frame 이후로 지연시킨다.&lt;/p&gt;
&lt;/br&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;dart&quot;&gt;&lt;pre class=&quot;language-dart&quot;&gt;&lt;code class=&quot;language-dart&quot;&gt;  &lt;span class=&quot;token metadata function&quot;&gt;@override&lt;/span&gt;
  &lt;span class=&quot;token keyword&quot;&gt;void&lt;/span&gt; &lt;span class=&quot;token function&quot;&gt;initState&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;
    &lt;span class=&quot;token keyword&quot;&gt;super&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;initState&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;
    &lt;span class=&quot;token class-name&quot;&gt;WidgetsBinding&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;instance&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;addPostFrameCallback&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;_&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;
      context&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;read&lt;span class=&quot;token generics&quot;&gt;&lt;span class=&quot;token punctuation&quot;&gt;&amp;lt;&lt;/span&gt;&lt;span class=&quot;token class-name&quot;&gt;Counter&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;increment&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;
      myCounter &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; context&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;read&lt;span class=&quot;token generics&quot;&gt;&lt;span class=&quot;token punctuation&quot;&gt;&amp;lt;&lt;/span&gt;&lt;span class=&quot;token class-name&quot;&gt;Counter&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;counter &lt;span class=&quot;token operator&quot;&gt;+&lt;/span&gt; &lt;span class=&quot;token number&quot;&gt;10&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;
    &lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;
  &lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;/br&gt;
&lt;p&gt;이와 유사한 또 다른 방법으로는 &lt;code class=&quot;language-text&quot;&gt;Future.delayed(Duration)&lt;/code&gt;, &lt;code class=&quot;language-text&quot;&gt;Future.microtask()&lt;/code&gt; 함수를 이용하는 방법이다.&lt;/p&gt;
&lt;/br&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;dart&quot;&gt;&lt;pre class=&quot;language-dart&quot;&gt;&lt;code class=&quot;language-dart&quot;&gt;  &lt;span class=&quot;token metadata function&quot;&gt;@override&lt;/span&gt;
  &lt;span class=&quot;token keyword&quot;&gt;void&lt;/span&gt; &lt;span class=&quot;token function&quot;&gt;initState&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;
    &lt;span class=&quot;token keyword&quot;&gt;super&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;initState&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;
    &lt;span class=&quot;token class-name&quot;&gt;Future.Delayed&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token class-name&quot;&gt;Duration&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;seconds&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;token number&quot;&gt;0&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;
      context&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;read&lt;span class=&quot;token generics&quot;&gt;&lt;span class=&quot;token punctuation&quot;&gt;&amp;lt;&lt;/span&gt;&lt;span class=&quot;token class-name&quot;&gt;Counter&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;increment&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;
      myCounter &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; context&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;read&lt;span class=&quot;token generics&quot;&gt;&lt;span class=&quot;token punctuation&quot;&gt;&amp;lt;&lt;/span&gt;&lt;span class=&quot;token class-name&quot;&gt;Counter&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;counter &lt;span class=&quot;token operator&quot;&gt;+&lt;/span&gt; &lt;span class=&quot;token number&quot;&gt;10&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;
    &lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;
  &lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;/br&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;dart&quot;&gt;&lt;pre class=&quot;language-dart&quot;&gt;&lt;code class=&quot;language-dart&quot;&gt;  &lt;span class=&quot;token metadata function&quot;&gt;@override&lt;/span&gt;
  &lt;span class=&quot;token keyword&quot;&gt;void&lt;/span&gt; &lt;span class=&quot;token function&quot;&gt;initState&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;
    &lt;span class=&quot;token keyword&quot;&gt;super&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;initState&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;
    &lt;span class=&quot;token class-name&quot;&gt;Future&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;microtest&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;
      context&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;read&lt;span class=&quot;token generics&quot;&gt;&lt;span class=&quot;token punctuation&quot;&gt;&amp;lt;&lt;/span&gt;&lt;span class=&quot;token class-name&quot;&gt;Counter&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;increment&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;
      myCounter &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; context&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;read&lt;span class=&quot;token generics&quot;&gt;&lt;span class=&quot;token punctuation&quot;&gt;&amp;lt;&lt;/span&gt;&lt;span class=&quot;token class-name&quot;&gt;Counter&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;counter &lt;span class=&quot;token operator&quot;&gt;+&lt;/span&gt; &lt;span class=&quot;token number&quot;&gt;10&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;
    &lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;
  &lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;/br&gt;
&lt;h2&gt;2.3. Widget 트리 밖에서 Provider value를 listen했을 때&lt;/h2&gt;
&lt;div align=&quot;left&quot;&gt;
  &lt;span class=&quot;gatsby-resp-image-wrapper&quot; style=&quot;position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 630px; &quot;&gt;
      &lt;a class=&quot;gatsby-resp-image-link&quot; href=&quot;/static/3f4ac28b54879b6b59faa42bee9f8938/82e86/listen_outside_widget.png&quot; style=&quot;display: block&quot; target=&quot;_blank&quot; rel=&quot;noopener&quot;&gt;
    &lt;span class=&quot;gatsby-resp-image-background-image&quot; style=&quot;padding-bottom: 36.708860759493675%; position: relative; bottom: 0; left: 0; background-image: url(&apos;data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAHCAYAAAAIy204AAAACXBIWXMAABYlAAAWJQFJUiTwAAABGElEQVR42m2R2U7DMBBF8///BkJUQFHpmi7Z96pSnPgwk0lbHohk3bHHcxcnGOITQ7jBrb9wi1fBJe7zDbeS/XKBe3/B7X4Yvj/oVx+4w3ra93LfR2fIMkgSyHPoewKiCz6JGbuGscwZb1d8U+PrEl/k+Eqwa6d6rCu5N9eZkEhN10FRwPWKfsGkkEozSSGO4Syqp5MpXy7PM3UQRYZ1bevurKpgGGZCPYij53DT2MWyNAJxO5HfCW43cM6WRJxQybz/Q3g8GpmSKmHbGuqwEmkcdTEP/fs9CFVdI263sN/DZiP1xnC/g93W8BjC4SCiZ6vD0AykqYnVFjugbexAGxpPH1ib+q5lYQ5VVF3Lz3j088zm7pHn2L/Vqxn+uSJaWQAAAABJRU5ErkJggg==&apos;); background-size: cover; display: block;&quot;&gt;&lt;/span&gt;
  &lt;img class=&quot;gatsby-resp-image-image&quot; alt=&quot;listen outside widget&quot; title=&quot;&quot; src=&quot;/static/3f4ac28b54879b6b59faa42bee9f8938/f058b/listen_outside_widget.png&quot; srcset=&quot;/static/3f4ac28b54879b6b59faa42bee9f8938/c26ae/listen_outside_widget.png 158w,
/static/3f4ac28b54879b6b59faa42bee9f8938/6bdcf/listen_outside_widget.png 315w,
/static/3f4ac28b54879b6b59faa42bee9f8938/f058b/listen_outside_widget.png 630w,
/static/3f4ac28b54879b6b59faa42bee9f8938/40601/listen_outside_widget.png 945w,
/static/3f4ac28b54879b6b59faa42bee9f8938/78612/listen_outside_widget.png 1260w,
/static/3f4ac28b54879b6b59faa42bee9f8938/82e86/listen_outside_widget.png 1978w&quot; sizes=&quot;(max-width: 630px) 100vw, 630px&quot; style=&quot;width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;&quot; loading=&quot;lazy&quot; decoding=&quot;async&quot;&gt;
  &lt;/a&gt;
    &lt;/span&gt;
&lt;/div&gt;
&lt;/br&gt;
&lt;p&gt;위 에러는 제목에서 설명한 대로, Widget 트리 밖에서 Provider value를 Listen하려 했을 때 발생한다. 즉, Build하는 위젯의 변경사항을 watch하는 것이 안된다는 뜻이다. 이를 해결하기 위해서는 &lt;code class=&quot;language-text&quot;&gt;Provider.of&lt;/code&gt; 함수의 listen 파라미터를 false로 주거나, &lt;code class=&quot;language-text&quot;&gt;read&lt;/code&gt; extension 함수를 사용하면 된다.&lt;/p&gt;
&lt;/br&gt;
&lt;h2&gt;2.4. 의존성 있는 Widget이 변경될 때 발생하는 에러&lt;/h2&gt;
&lt;div align=&quot;left&quot;&gt;
  &lt;span class=&quot;gatsby-resp-image-wrapper&quot; style=&quot;position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 630px; &quot;&gt;
      &lt;a class=&quot;gatsby-resp-image-link&quot; href=&quot;/static/ad7026e41b98a0c3fe5f62f67028efcc/a6d66/dependent_widget_change.png&quot; style=&quot;display: block&quot; target=&quot;_blank&quot; rel=&quot;noopener&quot;&gt;
    &lt;span class=&quot;gatsby-resp-image-background-image&quot; style=&quot;padding-bottom: 36.075949367088604%; position: relative; bottom: 0; left: 0; background-image: url(&apos;data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAHCAYAAAAIy204AAAACXBIWXMAABYlAAAWJQFJUiTwAAABVklEQVR42jWR63KjMAyF+/7vtdOZ7o82LQkhFxqSUAhNwh2DAX8r7FlmzuhYso6OzMtcPBmjA8POQ/srxv2a0XtnPPjowGP0P9FSG7df6O8tJkuhKKCuoWlcXNB1LN8LaYJ5/YPxPuEcwdoDfwNRZGGiEyYM4XrBBD4EgeTPEMdQVlAJsgyUcoJz/mA6HTHPO7NqmLpa0DguML2yfO5bC1tra+amZKqelpuhh3lygkOeUJ9WtD97mnBFtXujPr7TRB7txae9bqnDD1RypJM7C69DqV82VPu/qNvJ8rHJneDiYngmDo8fhiKTGDPWD0HOkKfo4mYbHM9sXgu35/LX9pppdIJaGrt4T3+/0mcRnThZLqpbhEpDB8ktNZV+W0e9DGxlA5v7PaNl2PIcTlAmdHFgG9vz2q60rKqSg8SNWzXeWee6vIuzG4uJQVzrUnKV/AMR++/wHyAsEjPHhNZfAAAAAElFTkSuQmCC&apos;); background-size: cover; display: block;&quot;&gt;&lt;/span&gt;
  &lt;img class=&quot;gatsby-resp-image-image&quot; alt=&quot;dependent widget change&quot; title=&quot;&quot; src=&quot;/static/ad7026e41b98a0c3fe5f62f67028efcc/f058b/dependent_widget_change.png&quot; srcset=&quot;/static/ad7026e41b98a0c3fe5f62f67028efcc/c26ae/dependent_widget_change.png 158w,
/static/ad7026e41b98a0c3fe5f62f67028efcc/6bdcf/dependent_widget_change.png 315w,
/static/ad7026e41b98a0c3fe5f62f67028efcc/f058b/dependent_widget_change.png 630w,
/static/ad7026e41b98a0c3fe5f62f67028efcc/40601/dependent_widget_change.png 945w,
/static/ad7026e41b98a0c3fe5f62f67028efcc/78612/dependent_widget_change.png 1260w,
/static/ad7026e41b98a0c3fe5f62f67028efcc/a6d66/dependent_widget_change.png 2070w&quot; sizes=&quot;(max-width: 630px) 100vw, 630px&quot; style=&quot;width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;&quot; loading=&quot;lazy&quot; decoding=&quot;async&quot;&gt;
  &lt;/a&gt;
    &lt;/span&gt;
&lt;/div&gt;
&lt;/br&gt;
&lt;p&gt;이 에러는 특정 위젯이 빌드되고 있는 시점에 다른 위젯을 그려달라고 요청 했을 때 발생한다. 위젯이 빌드되는 프로세스 중간 단계인 &lt;code class=&quot;language-text&quot;&gt;initState()&lt;/code&gt; 함수나 constructor 내에서 다른 위젯을 그려달라는 요청이 있을 때 발생할 수 있다. 마찬가지로, &lt;code class=&quot;language-text&quot;&gt;addPostFrameCallback()&lt;/code&gt; 함수로 파훼가 가능하다.&lt;/p&gt;
&lt;/br&gt;
&lt;h2&gt;2.5. 빌드되는 중간에 Widget을 그려달라고 했을 때&lt;/h2&gt;
&lt;div align=&quot;left&quot;&gt;
  &lt;span class=&quot;gatsby-resp-image-wrapper&quot; style=&quot;position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 630px; &quot;&gt;
      &lt;a class=&quot;gatsby-resp-image-link&quot; href=&quot;/static/25ef418068659c988f0439ad929400c4/e53e8/set_state_mark_need_build_2.png&quot; style=&quot;display: block&quot; target=&quot;_blank&quot; rel=&quot;noopener&quot;&gt;
    &lt;span class=&quot;gatsby-resp-image-background-image&quot; style=&quot;padding-bottom: 36.075949367088604%; position: relative; bottom: 0; left: 0; background-image: url(&apos;data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAHCAYAAAAIy204AAAACXBIWXMAABYlAAAWJQFJUiTwAAABVElEQVR42m1R2ZKCQBDz/79t1/UWFFAQEMGbYQ5kJhuwtsqHnarUpEMTusPoVaYwWQQTrdD6M95rGN4taxMsYTxqO4/aHCb2YZIAOlhAhQuYvY+uLIDHE7jfAWMwUlkAsflCs2fTMYJKt5DxCr3exMsBIppChBPIg4cmWUHmG7T1Fe3zjJek0ccZudsVrjjCXi+w5wouz+CyFO5UwF3OcOVpuG2RExlsfYdzFq7rANvBWfJWwxpFO4eRvqSo4xlEuoY4rFEnC4KTcQoRk+8maDIfz3AMfc3Je53PkzUkedNPzffaR0U/GqpjiDoYD6IIf7jiAoLr1+RiN4VMPdTRhD3fNPDfMXDtJvUZxYS9c3IPllMOK/eFLmPIYwBVRNBn/qRLPnxdVwfo057a4c3Zp6tkMFO9XiZQhMy3MLfibdjJmu7qnSiz6XPoR/9Dn9Fn/S8+zi+LgBEnbV+QTAAAAABJRU5ErkJggg==&apos;); background-size: cover; display: block;&quot;&gt;&lt;/span&gt;
  &lt;img class=&quot;gatsby-resp-image-image&quot; alt=&quot;set state mark need build 2&quot; title=&quot;&quot; src=&quot;/static/25ef418068659c988f0439ad929400c4/f058b/set_state_mark_need_build_2.png&quot; srcset=&quot;/static/25ef418068659c988f0439ad929400c4/c26ae/set_state_mark_need_build_2.png 158w,
/static/25ef418068659c988f0439ad929400c4/6bdcf/set_state_mark_need_build_2.png 315w,
/static/25ef418068659c988f0439ad929400c4/f058b/set_state_mark_need_build_2.png 630w,
/static/25ef418068659c988f0439ad929400c4/40601/set_state_mark_need_build_2.png 945w,
/static/25ef418068659c988f0439ad929400c4/78612/set_state_mark_need_build_2.png 1260w,
/static/25ef418068659c988f0439ad929400c4/e53e8/set_state_mark_need_build_2.png 1982w&quot; sizes=&quot;(max-width: 630px) 100vw, 630px&quot; style=&quot;width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;&quot; loading=&quot;lazy&quot; decoding=&quot;async&quot;&gt;
  &lt;/a&gt;
    &lt;/span&gt;
&lt;/div&gt;
&lt;/br&gt;
&lt;p&gt;이전에 설명한 2.2의 케이스와 유사하게, 빌드되는 중간에 위젯의 값이 변경되어 다시 그려달라고 했을 때 발생하는 에러이다. 에러 내용이 조금 다른건 initState가 아닌, Build 함수의 return 이전에 호출했을 경우이다. 이 경우에도 역시 &lt;code class=&quot;language-text&quot;&gt;addPostFrameCallback()&lt;/code&gt; 함수를 사용하면 된다.&lt;/p&gt;
&lt;/br&gt;
&lt;h1&gt;3. 출처&lt;/h1&gt;
&lt;p&gt;&lt;a href=&quot;https://www.udemy.com/course/flutter-provider-essential-korean/&quot;&gt;https://www.udemy.com/course/flutter-provider-essential-korean/&lt;/a&gt;&lt;/br&gt;&lt;/p&gt;</content:encoded></item><item><title><![CDATA[[Flutter] 05. Proxy Provider]]></title><description><![CDATA[1. Proxy Provider Provider란 위젯에 Non-위젯 오브젝트를 제공하는 위젯이라고 할 수 있다. 만약, 한 Provider에서 다른 Provider…]]></description><link>https://github.com/SiverPineValley/SiverPineValley.github.io/flutter/flutter_5/</link><guid isPermaLink="false">https://github.com/SiverPineValley/SiverPineValley.github.io/flutter/flutter_5/</guid><pubDate>Sun, 14 Jan 2024 23:00:00 GMT</pubDate><content:encoded>&lt;h1&gt;1. Proxy Provider&lt;/h1&gt;
&lt;p&gt;Provider란 위젯에 Non-위젯 오브젝트를 제공하는 위젯이라고 할 수 있다. 만약, 한 Provider에서 다른 Provider의 값이 필요한 경우에는 어떻게 해야할까? 이 때는 &lt;code class=&quot;language-text&quot;&gt;Proxy Provider&lt;/code&gt;를 사용할 수 있다. &lt;code class=&quot;language-text&quot;&gt;Proxy Provider&lt;/code&gt;는 다른 Provider들의 의존성을 가져와서 값을 만드는 Provider이다.&lt;/p&gt;
&lt;/br&gt;
&lt;div align=&quot;left&quot;&gt;
  &lt;span class=&quot;gatsby-resp-image-wrapper&quot; style=&quot;position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 630px; &quot;&gt;
      &lt;a class=&quot;gatsby-resp-image-link&quot; href=&quot;/static/e3bc9eb45d41a97c3b03d592f7e95b15/3f3b9/proxy_provider.png&quot; style=&quot;display: block&quot; target=&quot;_blank&quot; rel=&quot;noopener&quot;&gt;
    &lt;span class=&quot;gatsby-resp-image-background-image&quot; style=&quot;padding-bottom: 115.18987341772151%; position: relative; bottom: 0; left: 0; background-image: url(&apos;data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAXCAYAAAALHW+jAAAACXBIWXMAABYlAAAWJQFJUiTwAAAC4ElEQVR42pVUiXaiQBDM/39YXo5NYlSU+1IQLxTRKCJTW03Ep2azMb439hxMTXdVd98ppTAajRCGA3iejyAM4boufN9Hlq0QxyMkSYLD4YBbfnfyt9vtoHU7CAMfht7HZDzGoSxREUTsviigqgrg46chv/P1ca8GrCqFaLaBm2xgxzmi6Qb5tsJwXiBKCxTl58fqanzrYX0cRVCOC2U7UMkYiuFXholDEEK5Hug64NiAbQGuAywWACPBfA5Y3GNkWOefgMKjqWkwWi10X19h83K/3Ubn+RlDcmnzLCTQZDhE5+kJeqcDjedWv4/22xtMzn3DgCI9NaAQbvGVbq8HjR9Zto2Er+v0UNa6aaIUPsnjnraklXUz6n2CiWMnQJsgvudhSC9E5fV6XZNR8kM5r0SUW1WWC4PBACY9acb7+3v9SBAEpGpcp5HBsOTBhqZvAff7fR1yixw2ALquny6Ld/JN4+2PHs5mM+R5XoN1SPh0Oq0v3prM//RQwhNgCVfs/8L6EVBCcgg4YNnFcVyDrlarSy+vwc8r5hpQuHGocJ+8OVR4mWVMGQN9junR2995SP5igvUeHxGbBrKICXx/D4tJfmBFVMslyjQ9zZu1DMU5wzkDZLiy6TLM1ssLQno6o8qWeEsP55MJlrwo64iUZJzLeZdpZTLpN3QG2fKzeTSAlBgFhTEIKqGGvCiZv2OXaax0pOrImVipDrH1DinCBSCrQpSWCjHoiSTxhJ4FtJKLNnM0ZEpJG7sQ6GjVNaAiB6J0yGoRUUSkC0F/UuICUEpvPsOC7WvPgw/Oi+UCOwrwkc6wXZB87perDNt0Xp+L3XE/n044T1Eko0uVFcPVWXYaVW2zZVlaF+0/z3h7eIBHCubMzaHjwGCb0qXG2c7snoYuRRywrcWk40tzcKlum2Xn8GJK76SViUjSxn6dhwXJFvKF+JQhRAzf4wNbKnsqwbPxZX0N2JTZ9U81l3/x+wutfOO65JuY9wAAAABJRU5ErkJggg==&apos;); background-size: cover; display: block;&quot;&gt;&lt;/span&gt;
  &lt;img class=&quot;gatsby-resp-image-image&quot; alt=&quot;proxy provider&quot; title=&quot;&quot; src=&quot;/static/e3bc9eb45d41a97c3b03d592f7e95b15/f058b/proxy_provider.png&quot; srcset=&quot;/static/e3bc9eb45d41a97c3b03d592f7e95b15/c26ae/proxy_provider.png 158w,
/static/e3bc9eb45d41a97c3b03d592f7e95b15/6bdcf/proxy_provider.png 315w,
/static/e3bc9eb45d41a97c3b03d592f7e95b15/f058b/proxy_provider.png 630w,
/static/e3bc9eb45d41a97c3b03d592f7e95b15/3f3b9/proxy_provider.png 870w&quot; sizes=&quot;(max-width: 630px) 100vw, 630px&quot; style=&quot;width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;&quot; loading=&quot;lazy&quot; decoding=&quot;async&quot;&gt;
  &lt;/a&gt;
    &lt;/span&gt;
&lt;/div&gt;
&lt;/br&gt;
&lt;p&gt;ProxyProvider의 명세를 보면 일반 Provider와 달리 create는 Optional이고, update가 required인 것을 볼 수 있다. 또한 create와 달리 update는 여러 번 호출 될 수 있다. create가 Optional인 이유는 자체적으로 핸들링할 오브젝트가 있을 경우 create를 만들어야 하지만, 이미 계산된 다른 오브젝트의 값을 가져오는 역할만이라면 꼭 create에 값을 넣어줄 필요가 없다. 또한, 다른 오브젝트의 값이 변경될 때마다 가져와야 하므로 update가 여러 번 호출될 수 있는 것이다. update가 호출될 수 있는 경우는 아래와 같다.&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;ProxyProvider가 의존하는 Provider의 값을 처음으로 획득했을 때&lt;/li&gt;
&lt;li&gt;ProxyProvider가 의존하는 Provider의 값이 바뀔 때&lt;/li&gt;
&lt;li&gt;ProxyProvider가 리빌드될 때&lt;/li&gt;
&lt;/ul&gt;
&lt;/br&gt;
&lt;div align=&quot;left&quot;&gt;
  &lt;span class=&quot;gatsby-resp-image-wrapper&quot; style=&quot;position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 630px; &quot;&gt;
      &lt;a class=&quot;gatsby-resp-image-link&quot; href=&quot;/static/89b098c846109de1f246e6f372e1e63f/ae953/update_callback.png&quot; style=&quot;display: block&quot; target=&quot;_blank&quot; rel=&quot;noopener&quot;&gt;
    &lt;span class=&quot;gatsby-resp-image-background-image&quot; style=&quot;padding-bottom: 75.31645569620254%; position: relative; bottom: 0; left: 0; background-image: url(&apos;data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAPCAYAAADkmO9VAAAACXBIWXMAABYlAAAWJQFJUiTwAAACBklEQVR42pWT167iQAyG8/5vxBVFINE7Cb2X0AkdkcUnn7MT7SLtxVqy7Jnx/O6W53nS6XRkMBjIZDKR8XgsvV5PdWS/35dut6v6crmU6XQqi8VCJW/D4VDl/X4XyDqdTpJOpyWTyUixWFS9UCionkwmpVQqieM4+gkQHM7n88ghzuDz+RwCPh4PNeZjPp/XD7PZTCXeAdntdsqbzSbi7Xb7130UIQopVyoVyeVyYtutCATD9Xotq9VK2XXdSBrmHXm73ULAw+Ego9FIud8fSKPpyGA4CgxdBeUdPh6Pst/vozPMO2DU9nq9hoAoGFMDL+D98Sy7gycLdx84GUu77Uiz2ZRaraaZNBoN1W3bVkAyBPz5fIaA8ps+n4/8SbeHHwC1grrmtAHUk7oyDaa+1PGbLPkH+b8kjDoYq/8hy/d9/UjYpI+OJBUKbe4AvlwuqhvmjI25f7/fYr1eL+1wPB7XupTLZZ07msScwWbYGSdS5g3JuFFX5hDJTFvUjmjq9XrQgLY2AEnxGR8iNJEiseUj0XwTWApIlESHF6KrVqvSarX0jCPzRndpBktAtJSBUeJ/BIgn5ohVIyoA+EyKSMDMLqOTAalSJpxms1mdxQiQ+UkkEhKLxdQolUrpLmPM5sCc2WuAcQ5TV4CIlIZGXQaV0M0mmB3FiLXijjMgZl/NzH7PLvQDfkVYxIS3vrAAAAAASUVORK5CYII=&apos;); background-size: cover; display: block;&quot;&gt;&lt;/span&gt;
  &lt;img class=&quot;gatsby-resp-image-image&quot; alt=&quot;update callback&quot; title=&quot;&quot; src=&quot;/static/89b098c846109de1f246e6f372e1e63f/f058b/update_callback.png&quot; srcset=&quot;/static/89b098c846109de1f246e6f372e1e63f/c26ae/update_callback.png 158w,
/static/89b098c846109de1f246e6f372e1e63f/6bdcf/update_callback.png 315w,
/static/89b098c846109de1f246e6f372e1e63f/f058b/update_callback.png 630w,
/static/89b098c846109de1f246e6f372e1e63f/40601/update_callback.png 945w,
/static/89b098c846109de1f246e6f372e1e63f/ae953/update_callback.png 1132w&quot; sizes=&quot;(max-width: 630px) 100vw, 630px&quot; style=&quot;width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;&quot; loading=&quot;lazy&quot; decoding=&quot;async&quot;&gt;
  &lt;/a&gt;
    &lt;/span&gt;
&lt;/div&gt;
&lt;/br&gt;
&lt;p&gt;ProxyProvider의 update 콜백은 빌드 context, Type T의 value, Optional인 Type R의 nullable value를 받아서, Type R의 값을 리턴하는 방식이다. update 함수의 또 다른 특징은 (context, value) 파라미터를 받는 argument 2개 짜리 함수가 (context, value, previous) 와 같은 argument 3개 짜리 함수를 리턴한다는 것이다.&lt;/p&gt;
&lt;/br&gt;
&lt;div align=&quot;left&quot;&gt;
  &lt;span class=&quot;gatsby-resp-image-wrapper&quot; style=&quot;position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 630px; &quot;&gt;
      &lt;a class=&quot;gatsby-resp-image-link&quot; href=&quot;/static/20e2840b43919060efa6024c6f60185f/a628a/proxy_provider2.png&quot; style=&quot;display: block&quot; target=&quot;_blank&quot; rel=&quot;noopener&quot;&gt;
    &lt;span class=&quot;gatsby-resp-image-background-image&quot; style=&quot;padding-bottom: 48.10126582278481%; position: relative; bottom: 0; left: 0; background-image: url(&apos;data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAKCAYAAAC0VX7mAAAACXBIWXMAABYlAAAWJQFJUiTwAAABVElEQVR42p1RaW+CUBB8//+v2U8aNAEPUEBAuW8EprMvobWNJk0nmbx91+zsrrp4PvKyQtv3aNoWrzCO4w8+Hg/N3/t5nqE864Sb4yIm+yhEFVxRxnd09zvABJJks9nAMAxst1sdm6YJx3Hgui5839fx4XBAURRQ5taA69gIfQ9lmqIuSzR1jaFpgHlCT+citF6v4VFAPvvXK8IwRBAEel3iqqqgrP2eBxFqCpQ8ENuCZe26DrvdDqvVB44nG1EUaYrIsgrF6ZdgTUfPmJ9i6U2WZWSOJM3heoF2bFmWLn3P/3JfsjKpRl2OR/gsuWX9E90MFB9lONP0ckB10yJlayTRMAxfw1igJNvlfNbM+LBippbW+fLbMT888xWWOyX1l3SXJgl6OtSXIjb0eId3otrhiX3wbBtFHCMnEybIbjdMLOc/UDKpmELSj5F9E05v+vcXfALLmwKKxPp/+gAAAABJRU5ErkJggg==&apos;); background-size: cover; display: block;&quot;&gt;&lt;/span&gt;
  &lt;img class=&quot;gatsby-resp-image-image&quot; alt=&quot;proxy provider2&quot; title=&quot;&quot; src=&quot;/static/20e2840b43919060efa6024c6f60185f/f058b/proxy_provider2.png&quot; srcset=&quot;/static/20e2840b43919060efa6024c6f60185f/c26ae/proxy_provider2.png 158w,
/static/20e2840b43919060efa6024c6f60185f/6bdcf/proxy_provider2.png 315w,
/static/20e2840b43919060efa6024c6f60185f/f058b/proxy_provider2.png 630w,
/static/20e2840b43919060efa6024c6f60185f/40601/proxy_provider2.png 945w,
/static/20e2840b43919060efa6024c6f60185f/78612/proxy_provider2.png 1260w,
/static/20e2840b43919060efa6024c6f60185f/a628a/proxy_provider2.png 2170w&quot; sizes=&quot;(max-width: 630px) 100vw, 630px&quot; style=&quot;width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;&quot; loading=&quot;lazy&quot; decoding=&quot;async&quot;&gt;
  &lt;/a&gt;
    &lt;/span&gt;
&lt;/div&gt;
&lt;/br&gt;
&lt;p&gt;ProxyProvider2의 update 콜백은 빌드 context, Type T의 value, Type T2의 value, Optional인 Type R의 nullable value를 받아서 Type R의 값을 리턴하는 방식이다. 앞서 설명한 ProxyProvider와의 차이는 argument에 Type T2가 늘어났다는 점이다.&lt;/p&gt;
&lt;/br&gt;
&lt;div align=&quot;left&quot;&gt;
  &lt;span class=&quot;gatsby-resp-image-wrapper&quot; style=&quot;position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 630px; &quot;&gt;
      &lt;a class=&quot;gatsby-resp-image-link&quot; href=&quot;/static/89798ecae4c48fb0fac9a9d85baec3b2/c65fa/proxy_provider0.png&quot; style=&quot;display: block&quot; target=&quot;_blank&quot; rel=&quot;noopener&quot;&gt;
    &lt;span class=&quot;gatsby-resp-image-background-image&quot; style=&quot;padding-bottom: 70.25316455696203%; position: relative; bottom: 0; left: 0; background-image: url(&apos;data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAOCAYAAAAvxDzwAAAACXBIWXMAABYlAAAWJQFJUiTwAAABs0lEQVR42pVTiXKjMAzl//+uu0nI1bTZJIT7sA2+IK+S03am007DMvOQbcmS0HtEmXR4rS1OjUFR1WjqGlmWoSZbFAXapkHVSuQUlwqHSgwUUwUfo6oqlGUZ7DRNiGqpkTQKl0qgUwOMMbDWQmsN531Ye+/w03O73b6tIykEGKGT+l6toXVKXbZdhzzP0bZtuDAHkRo0TpcrrlmBM9s0R15UGLSF9RP8dINxIwbjHkJbh8hYj93+gMUyxpbsMl4j3uyw3u5DkeSaoZM9Bop7mJAQWaredBL/zgklyKnbBMfTBXlZI81LvBxPwa/nJuwHA9Hrz8/ii3e4cPaxZ19PY/gNg7E0w76HUj2kUvRpEp2QEFKBzwXtB2Kb12zHcXqIiBlkzTVkmeHinWVmOE3TT6Y7sh/y+JXlnipfaPAZzeucXEkuJFiaH49iJIYdVbV+nDdDZplfm90eT38W2D0f8JfYXsYbrAhMEEsqsDxHNkyKpw74l1us4pCAJbNab/H8csTh9Rj25yT9P5ZboSCJaZYHd8PgPTOnyM/ndxZnJNTaULAhifgv4FFwAAvfBvm4hzCEN48/NpT7up9hAAAAAElFTkSuQmCC&apos;); background-size: cover; display: block;&quot;&gt;&lt;/span&gt;
  &lt;img class=&quot;gatsby-resp-image-image&quot; alt=&quot;proxy provider0&quot; title=&quot;&quot; src=&quot;/static/89798ecae4c48fb0fac9a9d85baec3b2/f058b/proxy_provider0.png&quot; srcset=&quot;/static/89798ecae4c48fb0fac9a9d85baec3b2/c26ae/proxy_provider0.png 158w,
/static/89798ecae4c48fb0fac9a9d85baec3b2/6bdcf/proxy_provider0.png 315w,
/static/89798ecae4c48fb0fac9a9d85baec3b2/f058b/proxy_provider0.png 630w,
/static/89798ecae4c48fb0fac9a9d85baec3b2/40601/proxy_provider0.png 945w,
/static/89798ecae4c48fb0fac9a9d85baec3b2/78612/proxy_provider0.png 1260w,
/static/89798ecae4c48fb0fac9a9d85baec3b2/c65fa/proxy_provider0.png 1434w&quot; sizes=&quot;(max-width: 630px) 100vw, 630px&quot; style=&quot;width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;&quot; loading=&quot;lazy&quot; decoding=&quot;async&quot;&gt;
  &lt;/a&gt;
    &lt;/span&gt;
&lt;/div&gt;
&lt;/br&gt;
&lt;p&gt;이러한 ProxyProvider는 뒤에 숫자에따라 ProxyProviderN의 형태로 호출이 가능하다. N의 범위는 0~6까지이며 각각 T, T2 와 같은 여러 타입을 받아올 수 있는 형태이다. 그런데, ProxyProvider0의 경우 모든 케이스로 구현 가능하다.  ProxyProvider0는 모든 ProxyProvider의 &lt;code class=&quot;language-text&quot;&gt;Sugar Syntax&lt;/code&gt;라고 할 수 있다.&lt;/p&gt;
&lt;/br&gt;
&lt;h1&gt;2. ChangeNotifierProxyProvider&lt;/h1&gt;
&lt;div align=&quot;left&quot;&gt;
  &lt;span class=&quot;gatsby-resp-image-wrapper&quot; style=&quot;position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 630px; &quot;&gt;
      &lt;a class=&quot;gatsby-resp-image-link&quot; href=&quot;/static/d95ce5903e95de40ecf26cbafd169614/9f9a4/change_notifier_proxy_provider.png&quot; style=&quot;display: block&quot; target=&quot;_blank&quot; rel=&quot;noopener&quot;&gt;
    &lt;span class=&quot;gatsby-resp-image-background-image&quot; style=&quot;padding-bottom: 38.60759493670886%; position: relative; bottom: 0; left: 0; background-image: url(&apos;data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAICAYAAAD5nd/tAAAACXBIWXMAABYlAAAWJQFJUiTwAAABKElEQVR42l1Sya6CQBCc//8gDyCJBvVEDCIuyJagohBkUROO9VKdDJnnoVJD0+nqqhnl+z4OhwPO57PgcrmgqirB6/VC27bouk6473s5a7Bm/h/HEWq73YLYbDZYLBZYrVbwPA/L5RJBECBNU5xOJxHa7XY4Ho+TcJIkwgRr3+8Xar/fI89z3O/3f7jdbrher3Im87soCmHC7CNzILdUTdNMFmhpGAbB+/2eLJI1tM1f1HUNzlK0QUtZlok9WiJoN45j2YrqtMceZktBLWYOZV25riv5MUfLsmDbNmazGRzHwXw+x3q9hhalCC8xDEPJjVE8n09BWZb4fD5QbGQDb5pn5slNoiiatmXz4/EQ1pnpmjlQLoUfZnY6KzNLbc18Mr92+cT4bP4ANslHLa5g0RYAAAAASUVORK5CYII=&apos;); background-size: cover; display: block;&quot;&gt;&lt;/span&gt;
  &lt;img class=&quot;gatsby-resp-image-image&quot; alt=&quot;change notifier proxy provider&quot; title=&quot;&quot; src=&quot;/static/d95ce5903e95de40ecf26cbafd169614/f058b/change_notifier_proxy_provider.png&quot; srcset=&quot;/static/d95ce5903e95de40ecf26cbafd169614/c26ae/change_notifier_proxy_provider.png 158w,
/static/d95ce5903e95de40ecf26cbafd169614/6bdcf/change_notifier_proxy_provider.png 315w,
/static/d95ce5903e95de40ecf26cbafd169614/f058b/change_notifier_proxy_provider.png 630w,
/static/d95ce5903e95de40ecf26cbafd169614/40601/change_notifier_proxy_provider.png 945w,
/static/d95ce5903e95de40ecf26cbafd169614/78612/change_notifier_proxy_provider.png 1260w,
/static/d95ce5903e95de40ecf26cbafd169614/9f9a4/change_notifier_proxy_provider.png 1560w&quot; sizes=&quot;(max-width: 630px) 100vw, 630px&quot; style=&quot;width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;&quot; loading=&quot;lazy&quot; decoding=&quot;async&quot;&gt;
  &lt;/a&gt;
    &lt;/span&gt;
&lt;/div&gt;
&lt;/br&gt;
&lt;p&gt;&lt;code class=&quot;language-text&quot;&gt;ChangeNotifierProxyProvider&lt;/code&gt;는 외부 ChangeProvider와 값을 싱크로나이즈하는 ChangeNotifierProvider라고 할 수 있다. 이 개념에 대해 설명하기 위해 위의 예시를 가져왔다. ChangeNotifierProvider의 create 콜백에 MyChangeNotifier를 리턴하였는데, 이 위젯은 MyModel에 의존성을 가지며 Provider를 통해 의존성을 제공하였다. create()은 최초 생성될 때 한번만 호출되기 때문에 listen을 false로 주었다. 만약, listen이 true로 주어 MyModel이 변했을 때 MyChangeNotifier의 값도 변하길 바랄테지만 이건 불가능하다. 이를 해결하기 위해서는 아래의 ChangeNotifierProxyProvider와 같이 update 콜백을 제공해주면 된다.&lt;/p&gt;
&lt;/br&gt;
&lt;p&gt;&lt;code class=&quot;language-text&quot;&gt;ChangeNotifierProxyProvider&lt;/code&gt;를 사용함에 있어서 몇 가지 주의할 점이 있다.&lt;/p&gt;
&lt;/br&gt;
&lt;p&gt;첫 번째는, ChangeNotifier를 update 내부에서 직접적으로 만들지 말라는 것이다. 의존하는 값이 update될 때 state가 lost될 수 있다는 것이다. 즉, 잘못된 state의 값으로 update가 이루어질 수 있다. 또한, 이전에 ChangeNotifier가 dispose되면서 새로운 ChangeNotifier가 생성되는 오버헤드가 발생할 수 있다.&lt;/p&gt;
&lt;/br&gt;
&lt;p&gt;두 번째는, 가능하면 ProxyProvider를 사용하라는 점이다. 생성된 생성된 오브젝트가 http 호출이나 다른 유사한 사이드 이펙트들에 의해 합쳐진 오브젝트들이라면, 이것은 매번 ProxyProvider를 사용하여 영속적인 오브젝트들이 생성된다는 것을 의미한다.&lt;/p&gt;
&lt;/br&gt;
&lt;h1&gt;3. 참조&lt;/h1&gt;
&lt;p&gt;&lt;code class=&quot;language-text&quot;&gt;Sugar Syntax&lt;/code&gt;: Syntax Sugar는 한국어로 문법 설탕이라고 번역됩니다. JS뿐만 아니라 프로그래밍 언어 전반적으로 적용되는 개념이며, 달달한 이름에 걸맞게 읽는 사람 또는 작성하는 사람이 편하게 디자인 된 문법이라는 뜻을 갖고 있습니다. 직관적으로 작성자의 의도를 알 수 있는 코드라면 Syntax Sugar를 사용하는 것이 생산성을 높여줄 것입니다.&lt;/br&gt;&lt;/p&gt;
&lt;h1&gt;4. 출처&lt;/h1&gt;
&lt;p&gt;&lt;a href=&quot;https://www.udemy.com/course/flutter-provider-essential-korean/&quot;&gt;https://www.udemy.com/course/flutter-provider-essential-korean/&lt;/a&gt;&lt;/br&gt;
&lt;a href=&quot;https://dkje.github.io/2020/09/02/SyntaxSugar/&quot;&gt;https://dkje.github.io/2020/09/02/SyntaxSugar/&lt;/a&gt;&lt;/br&gt;&lt;/p&gt;</content:encoded></item><item><title><![CDATA[[Flutter] 04. Provider Access]]></title><description><![CDATA[1. Provider Access Provider의 화면 전환은 Navigator 위젯을 통해 이루어진다. 몇 가지 용어 설명을 덪붙이자면, Route: Flutter에서 page, screen은 Route Object로 대표되며, Route…]]></description><link>https://github.com/SiverPineValley/SiverPineValley.github.io/flutter/flutter_4/</link><guid isPermaLink="false">https://github.com/SiverPineValley/SiverPineValley.github.io/flutter/flutter_4/</guid><pubDate>Sun, 14 Jan 2024 17:00:00 GMT</pubDate><content:encoded>&lt;h1&gt;1. Provider Access&lt;/h1&gt;
&lt;p&gt;Provider의 화면 전환은 Navigator 위젯을 통해 이루어진다. 몇 가지 용어 설명을 덪붙이자면,&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;
&lt;ol&gt;
&lt;li&gt;Route: Flutter에서 page, screen은 Route Object로 대표되며, Route Object는 Navigator 위젯으로 관리된다.&lt;/li&gt;
&lt;/ol&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;ol start=&quot;2&quot;&gt;
&lt;li&gt;Navigator: Navigator 위젯은 Route Object 스택을 제어한다. 이 Navigator는 Route Obejct를 스택 내에 추가하고/제거할 수 있는 push/pop 함수를 제공한다. 이러한 기능을 통해 화면 전환이 가능하다.&lt;/li&gt;
&lt;/ol&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;ol start=&quot;3&quot;&gt;
&lt;li&gt;MatrialPageRoute: screen은 Route Object이다. 명령형 탐색(Imperative Navigation)에서는 이러한 route는 통상적으로 MaterialPageRoute같은 클래스를 implement한다. MaterialPageRoute는 modal route이다. modal route는 해당 경로가 플랫폼에 적응하는 전환과 함께 전체 화면을 대체한다는 것을 의미한다.&lt;/li&gt;
&lt;/ol&gt;
&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;Provider Access란 이러한 Navigator 위젯을 사용하여 기존 위젯의 화면과 다른 화면에서 Provider 인스턴스를 사용하는 기법들을 의미한다. 크게 3가지 기법이 존재하는데 다음과 같다.&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;Anonymous route access&lt;/li&gt;
&lt;li&gt;Named route access&lt;/li&gt;
&lt;li&gt;Generated route access&lt;/li&gt;
&lt;/ul&gt;
&lt;h2&gt;1.1. Anonymous Route Access&lt;/h2&gt;
&lt;p&gt;Route 이름이 없는 Dynamic하게 짜여지는 Router를 의미한다. 앞서 설명한 대로, 페이지 전환은 Navigator 위젯의 &lt;code class=&quot;language-text&quot;&gt;.push()&lt;/code&gt;, &lt;code class=&quot;language-text&quot;&gt;pop()&lt;/code&gt; 함수들을 통해 구현되는데, 해당 함수의 2번째 파라미터로 MaterialPageRoute()를 제공하고, 해당 위젯의 builder 함수로 Provider 위젯을 리턴하는 방식이다. 이 때 사용되는 Provider 위젯은 ChangeNotifierProvider.value() 와 같이 value 함수를 사용하는 방식으로 제공해야 한다. 기존의 ChangeNotifierProvider 생성자 방식과 다른 점은 &lt;code class=&quot;language-text&quot;&gt;create&lt;/code&gt;을 통해 새로운 구조체를 생성하는 것이 아닌, &lt;code class=&quot;language-text&quot;&gt;value&lt;/code&gt;를 통해 이미 생성된 인스턴스를 넘겨주는 방식이다. 또한, provider에서 사용되는 context가 MaterialPageRoute의 context가 들어가지 않도록 주의해야 할 필요가 있다. Anonymous Router의 특징은 Route 시 직접 위젯을 넣는 방식을 의미한다.&lt;/p&gt;
&lt;/br&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;dart&quot;&gt;&lt;pre class=&quot;language-dart&quot;&gt;&lt;code class=&quot;language-dart&quot;&gt;&lt;span class=&quot;token keyword&quot;&gt;class&lt;/span&gt; &lt;span class=&quot;token class-name&quot;&gt;MyApp&lt;/span&gt; &lt;span class=&quot;token keyword&quot;&gt;extends&lt;/span&gt; &lt;span class=&quot;token class-name&quot;&gt;StatelessWidget&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;
  &lt;span class=&quot;token keyword&quot;&gt;const&lt;/span&gt; &lt;span class=&quot;token class-name&quot;&gt;MyApp&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;&lt;span class=&quot;token class-name&quot;&gt;Key&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;?&lt;/span&gt; key&lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;token keyword&quot;&gt;super&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;key&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt; key&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;

  &lt;span class=&quot;token metadata function&quot;&gt;@override&lt;/span&gt;
  &lt;span class=&quot;token class-name&quot;&gt;Widget&lt;/span&gt; &lt;span class=&quot;token function&quot;&gt;build&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token class-name&quot;&gt;BuildContext&lt;/span&gt; context&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;
    &lt;span class=&quot;token keyword&quot;&gt;return&lt;/span&gt; &lt;span class=&quot;token class-name&quot;&gt;MaterialApp&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;
      title&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;token string-literal&quot;&gt;&lt;span class=&quot;token string&quot;&gt;&apos;Anonymous Route&apos;&lt;/span&gt;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt;
      debugShowCheckedModeBanner&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;token boolean&quot;&gt;false&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt;
      theme&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;token class-name&quot;&gt;ThemeData&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;
        primarySwatch&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;token class-name&quot;&gt;Colors&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;blue&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt;
      &lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt;
      home&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;token class-name&quot;&gt;ChangeNotifierProvider&lt;/span&gt;&lt;span class=&quot;token generics&quot;&gt;&lt;span class=&quot;token punctuation&quot;&gt;&amp;lt;&lt;/span&gt;&lt;span class=&quot;token class-name&quot;&gt;Counter&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;
        create&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;context&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;&gt;&lt;/span&gt; &lt;span class=&quot;token class-name&quot;&gt;Counter&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt;
        child&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;token keyword&quot;&gt;const&lt;/span&gt; &lt;span class=&quot;token class-name&quot;&gt;MyHomePage&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt;
      &lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt;
    &lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;
  &lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;
&lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;

&lt;span class=&quot;token keyword&quot;&gt;class&lt;/span&gt; &lt;span class=&quot;token class-name&quot;&gt;MyHomePage&lt;/span&gt; &lt;span class=&quot;token keyword&quot;&gt;extends&lt;/span&gt; &lt;span class=&quot;token class-name&quot;&gt;StatelessWidget&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;
  &lt;span class=&quot;token keyword&quot;&gt;const&lt;/span&gt; &lt;span class=&quot;token class-name&quot;&gt;MyHomePage&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;&lt;span class=&quot;token class-name&quot;&gt;Key&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;?&lt;/span&gt; key&lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;token keyword&quot;&gt;super&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;key&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt; key&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;

  &lt;span class=&quot;token metadata function&quot;&gt;@override&lt;/span&gt;
  &lt;span class=&quot;token class-name&quot;&gt;Widget&lt;/span&gt; &lt;span class=&quot;token function&quot;&gt;build&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token class-name&quot;&gt;BuildContext&lt;/span&gt; context&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;
    &lt;span class=&quot;token keyword&quot;&gt;return&lt;/span&gt; &lt;span class=&quot;token class-name&quot;&gt;Scaffold&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;
      body&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;token class-name&quot;&gt;Center&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;
        child&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;token class-name&quot;&gt;Column&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;
          mainAxisAlignment&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;token class-name&quot;&gt;MainAxisAlignment&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;center&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt;
          children&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;[&lt;/span&gt;
            &lt;span class=&quot;token class-name&quot;&gt;ElevatedButton&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;
              child&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;token class-name&quot;&gt;Text&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;
                &lt;span class=&quot;token string-literal&quot;&gt;&lt;span class=&quot;token string&quot;&gt;&apos;Show Me Counter&apos;&lt;/span&gt;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt;
                style&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;token class-name&quot;&gt;TextStyle&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;fontSize&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;token number&quot;&gt;20.0&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt;
              &lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt;
              onPressed&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;
                &lt;span class=&quot;token comment&quot;&gt;// Navigator.push() 사용&lt;/span&gt;
                &lt;span class=&quot;token class-name&quot;&gt;Navigator&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;push&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;
                  context&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt;
                  &lt;span class=&quot;token class-name&quot;&gt;MaterialPageRoute&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;builder&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;_&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;
                    &lt;span class=&quot;token keyword&quot;&gt;return&lt;/span&gt; &lt;span class=&quot;token class-name&quot;&gt;ChangeNotifierProvider&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;value&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;
                      value&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt; context&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;read&lt;span class=&quot;token generics&quot;&gt;&lt;span class=&quot;token punctuation&quot;&gt;&amp;lt;&lt;/span&gt;&lt;span class=&quot;token class-name&quot;&gt;Counter&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt;
                      child&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;token class-name&quot;&gt;ShowMeCounter&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt;
                    &lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;
                  &lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt;
                &lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;
              &lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt;
            &lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt;
            &lt;span class=&quot;token class-name&quot;&gt;SizedBox&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;height&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;token number&quot;&gt;20.0&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt;
            &lt;span class=&quot;token class-name&quot;&gt;ElevatedButton&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;
              child&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;token class-name&quot;&gt;Text&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;
                &lt;span class=&quot;token string-literal&quot;&gt;&lt;span class=&quot;token string&quot;&gt;&apos;Increment Counter&apos;&lt;/span&gt;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt;
                style&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;token class-name&quot;&gt;TextStyle&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;fontSize&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;token number&quot;&gt;20.0&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt;
              &lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt;
              onPressed&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;
                context&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;read&lt;span class=&quot;token generics&quot;&gt;&lt;span class=&quot;token punctuation&quot;&gt;&amp;lt;&lt;/span&gt;&lt;span class=&quot;token class-name&quot;&gt;Counter&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;increment&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;
              &lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt;
            &lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt;
          &lt;span class=&quot;token punctuation&quot;&gt;]&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt;
        &lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt;
      &lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt;
    &lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;
  &lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;
&lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;/br&gt;
&lt;h2&gt;1.2. Named Route Access&lt;/h2&gt;
&lt;p&gt;앞서 설명한 Anonymous Route Access와 다르게, Named Route Access는 이름에서 알 수 있듯이 각 위젯의 라우트 경로를 routes 프로퍼티에 사전에 정의하고, &lt;code class=&quot;language-text&quot;&gt;Navigator.pushNamed(context, &apos;/path&apos;)&lt;/code&gt;를 통해서 라우트 경로를 통해 위젯의 화면을 전환시키는 방법이다. 이 때, Provider를 통해 생성되던 생성자가 State 위젯 내에서 정의되며, 이미 생성된 인스턴스를 ChangeNotifierProvider.value()에 제공되는 방식이다.&lt;/p&gt;
&lt;/br&gt;
&lt;p&gt;이전의 방식보다는 보다 직관적이나, 미리 생성한 인스턴스를 value로 넣어주는 방식이다 보니 위젯이 dispose될 때 인스턴스가 같이 dispose되지 않는다. 따라서, &lt;code class=&quot;language-text&quot;&gt;dispose()&lt;/code&gt; 함수를 override해주어야 한다.&lt;/p&gt;
&lt;/br&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;dart&quot;&gt;&lt;pre class=&quot;language-dart&quot;&gt;&lt;code class=&quot;language-dart&quot;&gt;&lt;span class=&quot;token keyword&quot;&gt;class&lt;/span&gt; &lt;span class=&quot;token class-name&quot;&gt;MyApp&lt;/span&gt; &lt;span class=&quot;token keyword&quot;&gt;extends&lt;/span&gt; &lt;span class=&quot;token class-name&quot;&gt;StatefulWidget&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;
  &lt;span class=&quot;token keyword&quot;&gt;const&lt;/span&gt; &lt;span class=&quot;token class-name&quot;&gt;MyApp&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;&lt;span class=&quot;token class-name&quot;&gt;Key&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;?&lt;/span&gt; key&lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;token keyword&quot;&gt;super&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;key&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt; key&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;

  &lt;span class=&quot;token metadata function&quot;&gt;@override&lt;/span&gt;
  &lt;span class=&quot;token class-name&quot;&gt;State&lt;/span&gt;&lt;span class=&quot;token generics&quot;&gt;&lt;span class=&quot;token punctuation&quot;&gt;&amp;lt;&lt;/span&gt;&lt;span class=&quot;token class-name&quot;&gt;MyApp&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;&gt;&lt;/span&gt;&lt;/span&gt; &lt;span class=&quot;token function&quot;&gt;createState&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;&gt;&lt;/span&gt; &lt;span class=&quot;token function&quot;&gt;_MyAppState&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;
&lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;

&lt;span class=&quot;token keyword&quot;&gt;class&lt;/span&gt; _MyAppState &lt;span class=&quot;token keyword&quot;&gt;extends&lt;/span&gt; &lt;span class=&quot;token class-name&quot;&gt;State&lt;/span&gt;&lt;span class=&quot;token generics&quot;&gt;&lt;span class=&quot;token punctuation&quot;&gt;&amp;lt;&lt;/span&gt;&lt;span class=&quot;token class-name&quot;&gt;MyApp&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;&gt;&lt;/span&gt;&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;
  &lt;span class=&quot;token comment&quot;&gt;// Counter 인스턴스를 미리 생성&lt;/span&gt;
  &lt;span class=&quot;token keyword&quot;&gt;final&lt;/span&gt; &lt;span class=&quot;token class-name&quot;&gt;Counter&lt;/span&gt; _counter &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;token class-name&quot;&gt;Counter&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;

  &lt;span class=&quot;token metadata function&quot;&gt;@override&lt;/span&gt;
  &lt;span class=&quot;token class-name&quot;&gt;Widget&lt;/span&gt; &lt;span class=&quot;token function&quot;&gt;build&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token class-name&quot;&gt;BuildContext&lt;/span&gt; context&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;
    &lt;span class=&quot;token keyword&quot;&gt;return&lt;/span&gt; &lt;span class=&quot;token class-name&quot;&gt;MaterialApp&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;
        title&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;token string-literal&quot;&gt;&lt;span class=&quot;token string&quot;&gt;&apos;Anonymous Route&apos;&lt;/span&gt;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt;
        debugShowCheckedModeBanner&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;token boolean&quot;&gt;false&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt;
        theme&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;token class-name&quot;&gt;ThemeData&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;
          primarySwatch&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;token class-name&quot;&gt;Colors&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;blue&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt;
        &lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt;
        &lt;span class=&quot;token comment&quot;&gt;// home 부분을 routes로 교체&lt;/span&gt;
        routes&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;
          &lt;span class=&quot;token string-literal&quot;&gt;&lt;span class=&quot;token string&quot;&gt;&apos;/&apos;&lt;/span&gt;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;context&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;&gt;&lt;/span&gt; &lt;span class=&quot;token class-name&quot;&gt;ChangeNotifierProvider&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;value&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;
                value&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt; _counter&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt;
                child&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;token class-name&quot;&gt;MyHomePage&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt;
              &lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt;
          &lt;span class=&quot;token string-literal&quot;&gt;&lt;span class=&quot;token string&quot;&gt;&apos;/counter&apos;&lt;/span&gt;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;context&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;&gt;&lt;/span&gt; &lt;span class=&quot;token class-name&quot;&gt;ChangeNotifierProvider&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;value&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;
                value&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt; _counter&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt;
                child&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;token class-name&quot;&gt;ShowMeCounter&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt;
              &lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;
        &lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;
  &lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;

  &lt;span class=&quot;token comment&quot;&gt;// dispose() 함수 override 하여 Counter 인스턴스도 dispose()&lt;/span&gt;
  &lt;span class=&quot;token metadata function&quot;&gt;@override&lt;/span&gt;
  &lt;span class=&quot;token keyword&quot;&gt;void&lt;/span&gt; &lt;span class=&quot;token function&quot;&gt;dispose&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;
    _counter&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;dispose&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;
    &lt;span class=&quot;token keyword&quot;&gt;super&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;dispose&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;
  &lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;
&lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;

&lt;span class=&quot;token keyword&quot;&gt;class&lt;/span&gt; &lt;span class=&quot;token class-name&quot;&gt;MyHomePage&lt;/span&gt; &lt;span class=&quot;token keyword&quot;&gt;extends&lt;/span&gt; &lt;span class=&quot;token class-name&quot;&gt;StatelessWidget&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;
  &lt;span class=&quot;token keyword&quot;&gt;const&lt;/span&gt; &lt;span class=&quot;token class-name&quot;&gt;MyHomePage&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;&lt;span class=&quot;token class-name&quot;&gt;Key&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;?&lt;/span&gt; key&lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;token keyword&quot;&gt;super&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;key&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt; key&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;

  &lt;span class=&quot;token metadata function&quot;&gt;@override&lt;/span&gt;
  &lt;span class=&quot;token class-name&quot;&gt;Widget&lt;/span&gt; &lt;span class=&quot;token function&quot;&gt;build&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token class-name&quot;&gt;BuildContext&lt;/span&gt; context&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;
    &lt;span class=&quot;token keyword&quot;&gt;return&lt;/span&gt; &lt;span class=&quot;token class-name&quot;&gt;Scaffold&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;
      body&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;token class-name&quot;&gt;Center&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;
        child&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;token class-name&quot;&gt;Column&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;
          mainAxisAlignment&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;token class-name&quot;&gt;MainAxisAlignment&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;center&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt;
          children&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;[&lt;/span&gt;
            &lt;span class=&quot;token class-name&quot;&gt;ElevatedButton&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;
              child&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;token class-name&quot;&gt;Text&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;
                &lt;span class=&quot;token string-literal&quot;&gt;&lt;span class=&quot;token string&quot;&gt;&apos;Show Me Counter&apos;&lt;/span&gt;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt;
                style&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;token class-name&quot;&gt;TextStyle&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;fontSize&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;token number&quot;&gt;20.0&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt;
              &lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt;
              onPressed&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;
                &lt;span class=&quot;token comment&quot;&gt;// Navigator.pushNamed() 함수 사용&lt;/span&gt;
                &lt;span class=&quot;token class-name&quot;&gt;Navigator&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;pushNamed&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;context&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;token string-literal&quot;&gt;&lt;span class=&quot;token string&quot;&gt;&apos;/counter&apos;&lt;/span&gt;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;
              &lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt;
            &lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt;
            &lt;span class=&quot;token class-name&quot;&gt;SizedBox&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;height&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;token number&quot;&gt;20.0&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt;
            &lt;span class=&quot;token class-name&quot;&gt;ElevatedButton&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;
              child&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;token class-name&quot;&gt;Text&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;
                &lt;span class=&quot;token string-literal&quot;&gt;&lt;span class=&quot;token string&quot;&gt;&apos;Increment Counter&apos;&lt;/span&gt;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt;
                style&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;token class-name&quot;&gt;TextStyle&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;fontSize&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;token number&quot;&gt;20.0&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt;
              &lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt;
              onPressed&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;
                context&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;read&lt;span class=&quot;token generics&quot;&gt;&lt;span class=&quot;token punctuation&quot;&gt;&amp;lt;&lt;/span&gt;&lt;span class=&quot;token class-name&quot;&gt;Counter&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;increment&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;
              &lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt;
            &lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;
          &lt;span class=&quot;token punctuation&quot;&gt;]&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt;
        &lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt;
      &lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt;
    &lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;
  &lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;
&lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;/br&gt;
&lt;h2&gt;1.3 Generated Route Access&lt;/h2&gt;
&lt;p&gt;Named Route Access와 유사하나 routes 프로퍼티가 아니라 onGenerateRoute 프로퍼티를 사용한다.&lt;/p&gt;
&lt;/br&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;dart&quot;&gt;&lt;pre class=&quot;language-dart&quot;&gt;&lt;code class=&quot;language-dart&quot;&gt;
&lt;span class=&quot;token keyword&quot;&gt;class&lt;/span&gt; &lt;span class=&quot;token class-name&quot;&gt;MyApp&lt;/span&gt; &lt;span class=&quot;token keyword&quot;&gt;extends&lt;/span&gt; &lt;span class=&quot;token class-name&quot;&gt;StatefulWidget&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;
  &lt;span class=&quot;token class-name&quot;&gt;MyApp&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;&lt;span class=&quot;token class-name&quot;&gt;Key&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;?&lt;/span&gt; key&lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;token keyword&quot;&gt;super&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;key&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt; key&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;

  &lt;span class=&quot;token metadata function&quot;&gt;@override&lt;/span&gt;
  &lt;span class=&quot;token class-name&quot;&gt;State&lt;/span&gt;&lt;span class=&quot;token generics&quot;&gt;&lt;span class=&quot;token punctuation&quot;&gt;&amp;lt;&lt;/span&gt;&lt;span class=&quot;token class-name&quot;&gt;MyApp&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;&gt;&lt;/span&gt;&lt;/span&gt; &lt;span class=&quot;token function&quot;&gt;createState&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;&gt;&lt;/span&gt; &lt;span class=&quot;token function&quot;&gt;_MyAppState&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;
&lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;

&lt;span class=&quot;token keyword&quot;&gt;class&lt;/span&gt; _MyAppState &lt;span class=&quot;token keyword&quot;&gt;extends&lt;/span&gt; &lt;span class=&quot;token class-name&quot;&gt;State&lt;/span&gt;&lt;span class=&quot;token generics&quot;&gt;&lt;span class=&quot;token punctuation&quot;&gt;&amp;lt;&lt;/span&gt;&lt;span class=&quot;token class-name&quot;&gt;MyApp&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;&gt;&lt;/span&gt;&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;
  &lt;span class=&quot;token keyword&quot;&gt;final&lt;/span&gt; &lt;span class=&quot;token class-name&quot;&gt;Counter&lt;/span&gt; _counter &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;token class-name&quot;&gt;Counter&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;

  &lt;span class=&quot;token metadata function&quot;&gt;@override&lt;/span&gt;
  &lt;span class=&quot;token class-name&quot;&gt;Widget&lt;/span&gt; &lt;span class=&quot;token function&quot;&gt;build&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token class-name&quot;&gt;BuildContext&lt;/span&gt; context&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;
    &lt;span class=&quot;token keyword&quot;&gt;return&lt;/span&gt; &lt;span class=&quot;token class-name&quot;&gt;MaterialApp&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;
      title&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;token string-literal&quot;&gt;&lt;span class=&quot;token string&quot;&gt;&apos;Anonymous Route&apos;&lt;/span&gt;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt;
      debugShowCheckedModeBanner&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;token boolean&quot;&gt;false&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt;
      theme&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;token class-name&quot;&gt;ThemeData&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;
        primarySwatch&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;token class-name&quot;&gt;Colors&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;blue&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt;
      &lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt;
      &lt;span class=&quot;token comment&quot;&gt;// routes 대신 onGenerateRoute 사용 후 switch 케이스로 분기 처리&lt;/span&gt;
      onGenerateRoute&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token class-name&quot;&gt;RouteSettings&lt;/span&gt; settings&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;
        &lt;span class=&quot;token keyword&quot;&gt;switch&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;settings&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;name&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;
          &lt;span class=&quot;token keyword&quot;&gt;case&lt;/span&gt; &lt;span class=&quot;token string-literal&quot;&gt;&lt;span class=&quot;token string&quot;&gt;&apos;/&apos;&lt;/span&gt;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt;
            &lt;span class=&quot;token keyword&quot;&gt;return&lt;/span&gt; &lt;span class=&quot;token class-name&quot;&gt;MaterialPageRoute&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;
                builder&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;context&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;&gt;&lt;/span&gt; &lt;span class=&quot;token class-name&quot;&gt;ChangeNotifierProvider&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;value&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;
                      value&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt; _counter&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt;
                      child&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;token class-name&quot;&gt;MyHomePage&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt;
                    &lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;
          &lt;span class=&quot;token keyword&quot;&gt;case&lt;/span&gt; &lt;span class=&quot;token string-literal&quot;&gt;&lt;span class=&quot;token string&quot;&gt;&apos;/counter&apos;&lt;/span&gt;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt;
            &lt;span class=&quot;token keyword&quot;&gt;return&lt;/span&gt; &lt;span class=&quot;token class-name&quot;&gt;MaterialPageRoute&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;
                builder&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;context&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;&gt;&lt;/span&gt; &lt;span class=&quot;token class-name&quot;&gt;ChangeNotifierProvider&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;value&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;
                      value&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt; _counter&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt;
                      child&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;token class-name&quot;&gt;ShowMeCounter&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt;
                    &lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;
          &lt;span class=&quot;token keyword&quot;&gt;default&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt;
            &lt;span class=&quot;token keyword&quot;&gt;return&lt;/span&gt; &lt;span class=&quot;token keyword&quot;&gt;null&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt; 
        &lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;
      &lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt;
    &lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;
  &lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;

  &lt;span class=&quot;token metadata function&quot;&gt;@override&lt;/span&gt;
  &lt;span class=&quot;token keyword&quot;&gt;void&lt;/span&gt; &lt;span class=&quot;token function&quot;&gt;dispose&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;
    _counter&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;dispose&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;
    &lt;span class=&quot;token keyword&quot;&gt;super&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;dispose&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;
  &lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;
&lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;

&lt;span class=&quot;token keyword&quot;&gt;class&lt;/span&gt; &lt;span class=&quot;token class-name&quot;&gt;MyHomePage&lt;/span&gt; &lt;span class=&quot;token keyword&quot;&gt;extends&lt;/span&gt; &lt;span class=&quot;token class-name&quot;&gt;StatelessWidget&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;
  &lt;span class=&quot;token keyword&quot;&gt;const&lt;/span&gt; &lt;span class=&quot;token class-name&quot;&gt;MyHomePage&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;&lt;span class=&quot;token class-name&quot;&gt;Key&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;?&lt;/span&gt; key&lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;token keyword&quot;&gt;super&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;key&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt; key&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;

  &lt;span class=&quot;token metadata function&quot;&gt;@override&lt;/span&gt;
  &lt;span class=&quot;token class-name&quot;&gt;Widget&lt;/span&gt; &lt;span class=&quot;token function&quot;&gt;build&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token class-name&quot;&gt;BuildContext&lt;/span&gt; context&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;
    &lt;span class=&quot;token keyword&quot;&gt;return&lt;/span&gt; &lt;span class=&quot;token class-name&quot;&gt;Scaffold&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;
      body&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;token class-name&quot;&gt;Center&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;
        child&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;token class-name&quot;&gt;Column&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;
          mainAxisAlignment&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;token class-name&quot;&gt;MainAxisAlignment&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;center&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt;
          children&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;[&lt;/span&gt;
            &lt;span class=&quot;token class-name&quot;&gt;ElevatedButton&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;
              child&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;token class-name&quot;&gt;Text&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;
                &lt;span class=&quot;token string-literal&quot;&gt;&lt;span class=&quot;token string&quot;&gt;&apos;Show Me Counter&apos;&lt;/span&gt;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt;
                style&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;token class-name&quot;&gt;TextStyle&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;fontSize&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;token number&quot;&gt;20.0&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt;
              &lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt;
              onPressed&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;
                &lt;span class=&quot;token class-name&quot;&gt;Navigator&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;pushNamed&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;context&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;token string-literal&quot;&gt;&lt;span class=&quot;token string&quot;&gt;&apos;/counter&apos;&lt;/span&gt;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;
              &lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt;
            &lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt;
            &lt;span class=&quot;token class-name&quot;&gt;SizedBox&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;height&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;token number&quot;&gt;20.0&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt;
            &lt;span class=&quot;token class-name&quot;&gt;ElevatedButton&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;
              child&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;token class-name&quot;&gt;Text&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;
                &lt;span class=&quot;token string-literal&quot;&gt;&lt;span class=&quot;token string&quot;&gt;&apos;Increment Counter&apos;&lt;/span&gt;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt;
                style&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;token class-name&quot;&gt;TextStyle&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;fontSize&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;token number&quot;&gt;20.0&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt;
              &lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt;
              onPressed&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;
                context&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;read&lt;span class=&quot;token generics&quot;&gt;&lt;span class=&quot;token punctuation&quot;&gt;&amp;lt;&lt;/span&gt;&lt;span class=&quot;token class-name&quot;&gt;Counter&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;increment&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;
              &lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt;
            &lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;
          &lt;span class=&quot;token punctuation&quot;&gt;]&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt;
        &lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt;
      &lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt;
    &lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;
  &lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;
&lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;br&gt;
&lt;h2&gt;1.4 Global Access&lt;/h2&gt;
&lt;p&gt;Global Access란 방식은 말은 거창하지만 간단하게 최상위 MaterialApp 위젯에 Provider로 감싸는 기존에 배운 방식을 의미한다. 간단한 App이라면 각종 Provider Access 방식을 굳이 사용할 필요가 없겠으나, App의 규모가 커지고 복잡해진다면 바람직하지 않은 방식이다.&lt;/p&gt;
&lt;/br&gt;
&lt;div align=&quot;left&quot;&gt;
  &lt;span class=&quot;gatsby-resp-image-wrapper&quot; style=&quot;position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 630px; &quot;&gt;
      &lt;a class=&quot;gatsby-resp-image-link&quot; href=&quot;/static/f88be96cfb3d9b6080ceb3ecc261663a/e9d87/global_access.png&quot; style=&quot;display: block&quot; target=&quot;_blank&quot; rel=&quot;noopener&quot;&gt;
    &lt;span class=&quot;gatsby-resp-image-background-image&quot; style=&quot;padding-bottom: 46.835443037974684%; position: relative; bottom: 0; left: 0; background-image: url(&apos;data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAJCAYAAAAywQxIAAAACXBIWXMAABYlAAAWJQFJUiTwAAAA1UlEQVR42q2QyQqDQBBE/f8fEgQvKiK4oAjuC+7bR1SoBkMOiRGSQ8HUMPW6ppVt27CuK4qiEDVNg6qqkGWZ+CRJxOd5jnmese87mPkk5QT6vg/LshAEAcIwhOu6cBwHhmEgjmN4nicDjuOQ95dATuVDBk3TFNg0TQLouk5al2WJKIqwLMv3hhS/wza6rgvYtm2oqvpsyXtN09C27WVL5dWwFRsNwyDnvu8xjqN4nuu6vt+QExlkU0J4xyZcx6nT3wISxj3dCV0CGeb30jT9CfR2h//QA5BMkoTxdswcAAAAAElFTkSuQmCC&apos;); background-size: cover; display: block;&quot;&gt;&lt;/span&gt;
  &lt;img class=&quot;gatsby-resp-image-image&quot; alt=&quot;global access&quot; title=&quot;&quot; src=&quot;/static/f88be96cfb3d9b6080ceb3ecc261663a/f058b/global_access.png&quot; srcset=&quot;/static/f88be96cfb3d9b6080ceb3ecc261663a/c26ae/global_access.png 158w,
/static/f88be96cfb3d9b6080ceb3ecc261663a/6bdcf/global_access.png 315w,
/static/f88be96cfb3d9b6080ceb3ecc261663a/f058b/global_access.png 630w,
/static/f88be96cfb3d9b6080ceb3ecc261663a/40601/global_access.png 945w,
/static/f88be96cfb3d9b6080ceb3ecc261663a/e9d87/global_access.png 1176w&quot; sizes=&quot;(max-width: 630px) 100vw, 630px&quot; style=&quot;width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;&quot; loading=&quot;lazy&quot; decoding=&quot;async&quot;&gt;
  &lt;/a&gt;
    &lt;/span&gt;
&lt;/div&gt;
&lt;/br&gt;
&lt;h1&gt;2. 출처&lt;/h1&gt;
&lt;p&gt;&lt;a href=&quot;https://www.udemy.com/course/flutter-provider-essential-korean/&quot;&gt;https://www.udemy.com/course/flutter-provider-essential-korean/&lt;/a&gt;&lt;/br&gt;&lt;/p&gt;</content:encoded></item><item><title><![CDATA[6-4) 버로우]]></title><description><![CDATA[6-4-1) 카프카 버로우 버로우는 링크드인에서 개발하여 오픈소스로 공개한 컨슈머 랙 체크 툴로서 RestAPI…]]></description><link>https://github.com/SiverPineValley/SiverPineValley.github.io/kafka/kafka_6_4/</link><guid isPermaLink="false">https://github.com/SiverPineValley/SiverPineValley.github.io/kafka/kafka_6_4/</guid><pubDate>Thu, 11 Jan 2024 18:00:00 GMT</pubDate><content:encoded>&lt;h2&gt;6-4-1) 카프카 버로우&lt;/h2&gt;
&lt;ul&gt;
&lt;li&gt;버로우는 링크드인에서 개발하여 오픈소스로 공개한 컨슈머 랙 체크 툴로서 RestAPI를 통해 컨슈머 그룹 별로 컨슈머 랙을 확인할 수 있다. 외부 모니터링 툴을 사용하면 카프카 클러스터에 포함된 모든 컨슈머, 토픽들의 랙 정보를 한번에 모니터링할 수 있다는 장점이 있다. 또한, 모니터링 툴들은 클러스터와 연동되어 컨슈머의 데이터 처리와는 별개로 지표를 수집하기 때문에 데이터를 활용하는 프로듀서나 컨슈머의 동작에는 영향을 주지 않는다.&lt;/li&gt;
&lt;li&gt;버로우는 다수의 클러스터에 연결하여 동작할 수 있다. 버로우를 카프카 클러스터에 연동하면 REST API를 통해 컨슈머 그룹 별 랙을 조회할 수 있다.&lt;/li&gt;
&lt;/ul&gt;
&lt;/br&gt;
&lt;h2&gt;6-4-2) 컨슈머 랙 이슈 판별&lt;/h2&gt;
&lt;ul&gt;
&lt;li&gt;버로우의 기능 중 가장 돋보이는 점은 컨슈머와 파티션의 상태를 단순히 랙의 임계치(threshold)로 나타내지 않았다는 점이다. 특정 파티션의 랙이 100만이 넘었다고 해서 단순히 컨슈머 또는 파티션에 문제가 있다고 단정지을 수 없다. 왜냐하면 프로듀서가 데이터를 많이 보내면 일시적으로 임계치를 넘어가는 현상이 발생할 수 있기 때문이다. 컨슈머 애플리케이션을 운영할 때 컨슈머 랙이 임계치에 도달할 때마다 알람을 받는 것은 무의미한 일이다.&lt;/li&gt;
&lt;/ul&gt;
&lt;/br&gt;
&lt;h3&gt;6-5-2-1) 컨슈머 랙 평가 (Evaluation)&lt;/h3&gt;
&lt;ul&gt;
&lt;li&gt;버로우는 단순히 임계치를 통해 판별하는 것이 아닌 슬라이딩 윈도우 (Sliding Window) 계산을 통해 문제가 생긴 파티션과 컨슈머의 상태를 표현한다. 이렇게 버로우에서 컨슈머 랙 상태를 표현하는 것을 컨슈머 랙 평가 (evalution)이라고 한다. 컨슈머 랙과 파티션의 오프셋을 슬라이딩 윈도우로 계산하면 상태가 정해진다. 결과적으로 파티션의 상태를 OK, STALLED, STOPPED로 표시하고, 컨슈머의 상태를 OK, WARNING, ERROR로 표시한다.&lt;/li&gt;
&lt;/ul&gt;
&lt;/br&gt;
&lt;h3&gt;6-5-2-2) 정상적인 상태&lt;/h3&gt;
&lt;/br&gt;
&lt;div align=&quot;left&quot;&gt;
  &lt;span class=&quot;gatsby-resp-image-wrapper&quot; style=&quot;position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 564px; &quot;&gt;
      &lt;a class=&quot;gatsby-resp-image-link&quot; href=&quot;/static/515a81bb8726d87e1e27af3e4e0f8f76/ba4d9/normal_graph.png&quot; style=&quot;display: block&quot; target=&quot;_blank&quot; rel=&quot;noopener&quot;&gt;
    &lt;span class=&quot;gatsby-resp-image-background-image&quot; style=&quot;padding-bottom: 52.53164556962025%; position: relative; bottom: 0; left: 0; background-image: url(&apos;data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAALCAYAAAB/Ca1DAAAACXBIWXMAABYlAAAWJQFJUiTwAAABzUlEQVR42o1TyW7iUBD0/38BZw6jIAGZOIngYLYIgVmCWb0AZt+3C+KAWGpcjV6iSDnModSvn7urq7uftel0iuVyidls9l9g/Hw+x2KxkDwF3t9uN2jVahWmaUrAaDTCeDz+An0F+opkMBjAcRxUKhXUajUUzSI+a5+4XC7Q+IGku93uR1WqoN3v9wJ+I0EqlUKhUEC5XEY0GkUymUQkEkEmk8H9fiehK1XW67W0RBKeD4eD+LlcThLz+TzC4TBisZioZYt2x0a/3wc5ikUT1+sVGis0Gg0hINFwOES73UYoFIJhGMhms+JT4Wq1+mEZz/NmsxEOaTkej0t1z/NEQSKREJ9t+L4v7aqhq6X8drYs60FoGCkhsW1bCNQcWZXBbG8ymQRJ39tVUAoJjk0Ie72etHQ8HrHdboVoGQRzWaxMXyXRd2wHHbsDz/VQr9dlUd1uF81m80HIVtPBhlqtFsxSCfqLjlddB5W/6a/QA3Cz+t8XvL+9I51Ki58NlvX05wmlIKfX78kMz+czNLKzEiXz+dASLPCR+8Bz/PnrzqpbaDQbooYEnJt6syQ+nU4PhdwsH6uyCr4/QNfrgmNRoAB19oMnQ991XSHln/IP4CYJGjp6Xm4AAAAASUVORK5CYII=&apos;); background-size: cover; display: block;&quot;&gt;&lt;/span&gt;
  &lt;img class=&quot;gatsby-resp-image-image&quot; alt=&quot;normal graph&quot; title=&quot;&quot; src=&quot;/static/515a81bb8726d87e1e27af3e4e0f8f76/ba4d9/normal_graph.png&quot; srcset=&quot;/static/515a81bb8726d87e1e27af3e4e0f8f76/c26ae/normal_graph.png 158w,
/static/515a81bb8726d87e1e27af3e4e0f8f76/6bdcf/normal_graph.png 315w,
/static/515a81bb8726d87e1e27af3e4e0f8f76/ba4d9/normal_graph.png 564w&quot; sizes=&quot;(max-width: 564px) 100vw, 564px&quot; style=&quot;width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;&quot; loading=&quot;lazy&quot; decoding=&quot;async&quot;&gt;
  &lt;/a&gt;
    &lt;/span&gt;
&lt;/div&gt;
&lt;/br&gt;
&lt;ul&gt;
&lt;li&gt;일반적으로 컨슈머를 운영하면서 자주 볼 수 있는 그래프이다. 이렇게 컨슈머 랙이 낮은 상태가 유지되거나 거의 없는 경우 버로우는 파티션은 OK, 컨슈머도 OK로 표현한다.&lt;/li&gt;
&lt;/ul&gt;
&lt;/br&gt;
&lt;h3&gt;6-5-2-3) 컨슈머 처리량 이슈&lt;/h3&gt;
&lt;/br&gt;
&lt;div align=&quot;left&quot;&gt;
  &lt;span class=&quot;gatsby-resp-image-wrapper&quot; style=&quot;position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 630px; &quot;&gt;
      &lt;a class=&quot;gatsby-resp-image-link&quot; href=&quot;/static/50a3dec90ca51e6011c87666ae57c671/e9140/consumer_throghput_issue.png&quot; style=&quot;display: block&quot; target=&quot;_blank&quot; rel=&quot;noopener&quot;&gt;
    &lt;span class=&quot;gatsby-resp-image-background-image&quot; style=&quot;padding-bottom: 51.89873417721519%; position: relative; bottom: 0; left: 0; background-image: url(&apos;data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAKCAYAAAC0VX7mAAAACXBIWXMAABYlAAAWJQFJUiTwAAABh0lEQVR42oWSx44CQQxE5/9/gSscuCC4IJFEzkLAkHOcIQl+oXafR420pz2UZtp2l8vl9vb7vZbLpTabjU6nk47H4784n8+6Xq9WfzgcDPyPRiN5JJvNpubzuZ7Pp8Iw1O12M/Dv8Hg8LH+/34WI6XSq2WymarWqTqejcrmsdrstD+bxeKzdbmfFdA6CwPB6vQzEya9WK+VyOWWzWSMkxhes12tVKhV5BGu1mrbbramCADVgOBxas0QioVgsJt/3VSgUlM/nbUTuoBBlIJPJyIM9Ho+bMpRAgBetVkvJZNLG6fV6dibvfKYeK7CB5u/3O/IQ71DQ7XatSyqVMiVcggDVTrFbBrhcLgas4Uy+3+/Lw+BSqWTjkXAjuy1CEi0m+CUP/yyLGl4H3lI3GAyiLUOGIsjchiFFIXmeBaZzkbGwgIkmk4l5WCwWv1aZQtbfaDS+hQ74l06nzWMMB1yu1+u2SCxiOpp9Pp9oZDwkAKl7AoDu5CiChMe/WCws5t4gX/wmxugs7gfHCr2uqrY6GwAAAABJRU5ErkJggg==&apos;); background-size: cover; display: block;&quot;&gt;&lt;/span&gt;
  &lt;img class=&quot;gatsby-resp-image-image&quot; alt=&quot;consumer throghput issue&quot; title=&quot;&quot; src=&quot;/static/50a3dec90ca51e6011c87666ae57c671/f058b/consumer_throghput_issue.png&quot; srcset=&quot;/static/50a3dec90ca51e6011c87666ae57c671/c26ae/consumer_throghput_issue.png 158w,
/static/50a3dec90ca51e6011c87666ae57c671/6bdcf/consumer_throghput_issue.png 315w,
/static/50a3dec90ca51e6011c87666ae57c671/f058b/consumer_throghput_issue.png 630w,
/static/50a3dec90ca51e6011c87666ae57c671/40601/consumer_throghput_issue.png 945w,
/static/50a3dec90ca51e6011c87666ae57c671/e9140/consumer_throghput_issue.png 1226w&quot; sizes=&quot;(max-width: 630px) 100vw, 630px&quot; style=&quot;width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;&quot; loading=&quot;lazy&quot; decoding=&quot;async&quot;&gt;
  &lt;/a&gt;
    &lt;/span&gt;
&lt;/div&gt;
&lt;/br&gt;
&lt;ul&gt;
&lt;li&gt;프로듀서가 추가하는 최신 오프셋에 비해 컨슈머 오프셋이 따라가지 못하는 추이를 볼 수 있다. 이런 그래프가 나오는 이유는 컨슈머의 데이터 처리량이 프로듀서가 보내는 데이터 양에 비해 적기 때문이다. 이 경우 파티션은 OK, 컨슈머는 WARNING 상태로 나타낸다.&lt;/li&gt;
&lt;/ul&gt;
&lt;/br&gt;
&lt;h3&gt;6-5-2-4) 컨슈머 이슈&lt;/h3&gt;
&lt;/br&gt;
&lt;div align=&quot;left&quot;&gt;
  &lt;span class=&quot;gatsby-resp-image-wrapper&quot; style=&quot;position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 630px; &quot;&gt;
      &lt;a class=&quot;gatsby-resp-image-link&quot; href=&quot;/static/d225b11cc51f23c8b9ca92aabf32cfab/89048/consumer_issue.png&quot; style=&quot;display: block&quot; target=&quot;_blank&quot; rel=&quot;noopener&quot;&gt;
    &lt;span class=&quot;gatsby-resp-image-background-image&quot; style=&quot;padding-bottom: 51.26582278481012%; position: relative; bottom: 0; left: 0; background-image: url(&apos;data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAKCAYAAAC0VX7mAAAACXBIWXMAABYlAAAWJQFJUiTwAAABo0lEQVR42mWS147iQBBF/f//wBsSiDcWCY0JIpmcwSYNOUfxCXc4pfVqpH246m5Xdd9Qdubzufr9vqbTqdbrtVar1X9YLpf/wHm322m73Vp/4Afyg0DBJFCtVpOz3+9VKpXEw4/HQ5fLRdfr1cD+fD7rfr/r+Xrq+XzqcDgY+WAwMNSrdXkVT17Js9WBiQLMPHA8Hg3sIQDU6MGJ67pKJv981H4LMafTyQBpu92WM5vNlMvlTP7tdjMVAFudTkfdblf5fF7pdFqbzcYuv99v64WUFTev10u9Xk8OrLFYzIqo9TxP1WrVYohGo5pMJpbd+u9ji8VCvu+bdRRiH1FEBrGDlUgkokajoXq9rlQqZda4RAPNhJ3JZEwhfYVCwWIYjUbKZrNyv1wVi8VPFEk5FLgQfCZFDtgJh/PbDkARLobDoeXFCgHECOBsQ6GIFWyggm+APZaazaZFgYpyuWwDIorw9+FPQESr1ZLDMCiSGxdhBOEj8XhciUTCbHKB76xhj+tmNP+IwYFNmRywy6OAfQjUkWelUrEsf9fCXtbxeGyWUf8DnyG6At3nOtAAAAAASUVORK5CYII=&apos;); background-size: cover; display: block;&quot;&gt;&lt;/span&gt;
  &lt;img class=&quot;gatsby-resp-image-image&quot; alt=&quot;consumer issue&quot; title=&quot;&quot; src=&quot;/static/d225b11cc51f23c8b9ca92aabf32cfab/f058b/consumer_issue.png&quot; srcset=&quot;/static/d225b11cc51f23c8b9ca92aabf32cfab/c26ae/consumer_issue.png 158w,
/static/d225b11cc51f23c8b9ca92aabf32cfab/6bdcf/consumer_issue.png 315w,
/static/d225b11cc51f23c8b9ca92aabf32cfab/f058b/consumer_issue.png 630w,
/static/d225b11cc51f23c8b9ca92aabf32cfab/40601/consumer_issue.png 945w,
/static/d225b11cc51f23c8b9ca92aabf32cfab/89048/consumer_issue.png 1242w&quot; sizes=&quot;(max-width: 630px) 100vw, 630px&quot; style=&quot;width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;&quot; loading=&quot;lazy&quot; decoding=&quot;async&quot;&gt;
  &lt;/a&gt;
    &lt;/span&gt;
&lt;/div&gt;
&lt;/br&gt;
&lt;ul&gt;
&lt;li&gt;최신 오프셋이 지속적으로 증가하지만, 컨슈머 오프셋이 멈춘 상태이다. 이로 인해 컨슈머 랙이 증가하고 있는데, 컨슈머가 어떠한 이유로 데이터를 가져가지 않고 있는 것이다. 이 경우 파티션은 STALLED, 컨슈머는 ERROR 상태로 표신된다.&lt;/li&gt;
&lt;/ul&gt;</content:encoded></item><item><title><![CDATA[6-3) 컨슈머 랙]]></title><description><![CDATA[6-3-1) 컨슈머 랙 컨슈머 랙(Lag…]]></description><link>https://github.com/SiverPineValley/SiverPineValley.github.io/kafka/kafka_6_3/</link><guid isPermaLink="false">https://github.com/SiverPineValley/SiverPineValley.github.io/kafka/kafka_6_3/</guid><pubDate>Thu, 11 Jan 2024 17:30:00 GMT</pubDate><content:encoded>&lt;h2&gt;6-3-1) 컨슈머 랙&lt;/h2&gt;
&lt;/br&gt;
&lt;div align=&quot;left&quot;&gt;
  &lt;span class=&quot;gatsby-resp-image-wrapper&quot; style=&quot;position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 564px; &quot;&gt;
      &lt;a class=&quot;gatsby-resp-image-link&quot; href=&quot;/static/a1abcbad63a39e15704c439a7f695eed/ba4d9/consumer_lag.png&quot; style=&quot;display: block&quot; target=&quot;_blank&quot; rel=&quot;noopener&quot;&gt;
    &lt;span class=&quot;gatsby-resp-image-background-image&quot; style=&quot;padding-bottom: 37.34177215189873%; position: relative; bottom: 0; left: 0; background-image: url(&apos;data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAHCAYAAAAIy204AAAACXBIWXMAABYlAAAWJQFJUiTwAAABTUlEQVR42n2QyYpCQQxF3y+71Z0LcS2Iv6AuFHwqKCoOOD3nCQecFXTnynk4kjQ2Dd104FAhVbnJLSOfz+N2u3E4HNhsNlwuFx6Ph0QiwXa7ZTabMRqNmE6n/Bev14vn84khD1OpFIVCgWQyqULxeJx+v896vWa1WjEejwmHwywWi+/aT6S+3+9V1BgMBgQCAUzTpNPpMBwO2Ww2Kih0u12l1WpRKpVot9s0m81fFItFHo8HRq/XIxgMEolEyGazumm9XieXy5FOp6lUKpTLZSWTyVCr1RR502g0NK9Wq9qngofDgeVyqVbkv+QL5vM5lmWpTanJ1mJbrMmgaDRKKBRSJI/FYtovYYjvv+J+v6vYh8lkosP8fj8+nw+n04ndbsfr9Sq73e5L8Ha7cb1euVwuen5yqX/uhNPpxPl81kYRl23FmQwTR8fjUZd4A3B06SIR94LGAAAAAElFTkSuQmCC&apos;); background-size: cover; display: block;&quot;&gt;&lt;/span&gt;
  &lt;img class=&quot;gatsby-resp-image-image&quot; alt=&quot;consumer lag&quot; title=&quot;&quot; src=&quot;/static/a1abcbad63a39e15704c439a7f695eed/ba4d9/consumer_lag.png&quot; srcset=&quot;/static/a1abcbad63a39e15704c439a7f695eed/c26ae/consumer_lag.png 158w,
/static/a1abcbad63a39e15704c439a7f695eed/6bdcf/consumer_lag.png 315w,
/static/a1abcbad63a39e15704c439a7f695eed/ba4d9/consumer_lag.png 564w&quot; sizes=&quot;(max-width: 564px) 100vw, 564px&quot; style=&quot;width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;&quot; loading=&quot;lazy&quot; decoding=&quot;async&quot;&gt;
  &lt;/a&gt;
    &lt;/span&gt;
&lt;/div&gt;
&lt;/br&gt;
&lt;ul&gt;
&lt;li&gt;컨슈머 랙(Lag)은 파티션의 최신 오프셋과 컨슈머 오프셋간의 차이이다. 프로듀서는 계속해서 새로운 레코드를 파티션에 저장하고, 컨슈머는 처리할 수 있는 만큼 데이터를 가져간다. 컨슈머 랙은 컨슈머가 정상적으로 동작하는지 여부를 확인할 수 있기 때문에 컨슈머 애플리케이션을 운영하면 필수적으로 모니터링해야 하는 요소이다.&lt;/li&gt;
&lt;/ul&gt;
&lt;/br&gt;
&lt;div align=&quot;left&quot;&gt;
  &lt;span class=&quot;gatsby-resp-image-wrapper&quot; style=&quot;position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 630px; &quot;&gt;
      &lt;a class=&quot;gatsby-resp-image-link&quot; href=&quot;/static/8d0e8e232f84c2fa28993836dd23b3d1/c929c/consumer_lag_per_partition.png&quot; style=&quot;display: block&quot; target=&quot;_blank&quot; rel=&quot;noopener&quot;&gt;
    &lt;span class=&quot;gatsby-resp-image-background-image&quot; style=&quot;padding-bottom: 60.75949367088608%; position: relative; bottom: 0; left: 0; background-image: url(&apos;data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAMCAYAAABiDJ37AAAACXBIWXMAABYlAAAWJQFJUiTwAAACMUlEQVR42k2T6UtyURDG7x/vNxFBEZG03Pe0FFErzT3IpVwQwxI1FVM/iAslLk/vM2C8F4Z775w5M79nzhylWCzC4/FAr9fDaDTC5/MhkUhgNBrh8/MTg8FArN/vy//ZuP79/Y3D4YD9fv9nSr1eRzQahd/vF7u9vUWpVMJ2u8XPzw/G4zF6vR46nQ6WyyXW67UkGg6H+Pr6Ap/T6YTzozSbTTw8PCCbzaJQKCCXy+Hx8RHJZFL819fX8Hq9uLy8FB/XGBMOhxEIBJBOp3F/f494PI58Pg+F8gwGg2xgADczEYk+Pj5QrValULvdxvPzs/wTgolTqRRarRZeX1/F73K5oLCCw+GQRKwSi8WkBUxK+WwDAxnH4vRnMhmEQiGh5zcTk97tdkO5u7uDWq2G1WpFIBhAMBiUhCSw2+2IRCLyzw1MSmN7WIyy+c1YyhZCJlSpVP8onRJ0c3MjQZTFzY1GAzy4p6cnkVUul/Hy8iIFaFyrVCrSDk7In2Sn0yk0lGw2m6HRaKDVamGxWGSd/SU93yQjPVWdW8QWME4hKjcRl4Q0+mq1mhC9v7/LDL69vcn4dLtd8fGbpCSkGh6MEFIeT5gJWYWSr66ucHFxAZPJJEEkYiGq4BqJzj0kIQ/zvFfZ7XYyrKvVSgZ3s9nIMLMvnDeOD2l4W+hjL3lLOPxM5PP75HTZLvqU/6f8/ByPRywWC0wmE8xmM8znc7HpdCo+FuaVJbFOr4NOp4PNZhPiXzw9Er+dZiR3AAAAAElFTkSuQmCC&apos;); background-size: cover; display: block;&quot;&gt;&lt;/span&gt;
  &lt;img class=&quot;gatsby-resp-image-image&quot; alt=&quot;consumer lag per partition&quot; title=&quot;&quot; src=&quot;/static/8d0e8e232f84c2fa28993836dd23b3d1/f058b/consumer_lag_per_partition.png&quot; srcset=&quot;/static/8d0e8e232f84c2fa28993836dd23b3d1/c26ae/consumer_lag_per_partition.png 158w,
/static/8d0e8e232f84c2fa28993836dd23b3d1/6bdcf/consumer_lag_per_partition.png 315w,
/static/8d0e8e232f84c2fa28993836dd23b3d1/f058b/consumer_lag_per_partition.png 630w,
/static/8d0e8e232f84c2fa28993836dd23b3d1/40601/consumer_lag_per_partition.png 945w,
/static/8d0e8e232f84c2fa28993836dd23b3d1/c929c/consumer_lag_per_partition.png 1218w&quot; sizes=&quot;(max-width: 630px) 100vw, 630px&quot; style=&quot;width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;&quot; loading=&quot;lazy&quot; decoding=&quot;async&quot;&gt;
  &lt;/a&gt;
    &lt;/span&gt;
&lt;/div&gt;
&lt;/br&gt;
&lt;ul&gt;
&lt;li&gt;컨슈머 랙은 컨슈머 그룹과 토픽, 파티션 별로 생성된다.&lt;/li&gt;
&lt;/ul&gt;
&lt;h2&gt;6-3-2) 컨슈머 랙 모니터링&lt;/h2&gt;
&lt;ul&gt;
&lt;li&gt;컨슈머 랙을 모니터링하는 것은 카프카를 통해 데이터파이프라인을 운영하는 데 있어서는 핵심적인 역할을 한다. 컨슈머 랙을 모니터링함으로써 컨슈머의 장애를 확인할 수 있고 파티션 개수를 정하는 데 참고할 수 있다.&lt;/li&gt;
&lt;li&gt;프로듀서의 데이터 양이 일정함에도 컨슈머의 장애로 컨슈머 랙이 증가할 수도 있다. 컨슈머는 파티션 개수만큼 늘려서 병렬처리하며 파티션마다 컨슈머가 할당되어 데이터를 처리한다.&lt;/li&gt;
&lt;/ul&gt;
&lt;/br&gt;
&lt;h2&gt;6-3-3) 컨슈머 랙을 모니터링하는 방법 3가지&lt;/h2&gt;
&lt;/br&gt;
&lt;h3&gt;6-3-3-1) Kafka CLI를 사용하는 방법&lt;/h3&gt;
&lt;ul&gt;
&lt;li&gt;&lt;code class=&quot;language-text&quot;&gt;kafka-consuemr-groups.sh&lt;/code&gt; 명령어를 사용하면 컨슈머 랙을 포함하여 특정 컨슈머 그룹의 상태를 확인할 수 있다. 컨슈머 랙을 확인하기 위한 가장 기초적인 방법이라고 생각하면 된다.&lt;/li&gt;
&lt;/ul&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;sh&quot;&gt;&lt;pre class=&quot;language-sh&quot;&gt;&lt;code class=&quot;language-sh&quot;&gt;./kafka-consumer-groups.sh --bootstrap-server&lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt;my-kafka:19092 &lt;span class=&quot;token parameter variable&quot;&gt;--group&lt;/span&gt; test-group &lt;span class=&quot;token parameter variable&quot;&gt;--describe&lt;/span&gt;

Consumer group &lt;span class=&quot;token string&quot;&gt;&apos;test-group&apos;&lt;/span&gt; has no active members.

GROUP           TOPIC           PARTITION  CURRENT-OFFSET  LOG-END-OFFSET  LAG             CONSUMER-ID     HOST            CLIENT-ID
test-group      &lt;span class=&quot;token builtin class-name&quot;&gt;test&lt;/span&gt;            &lt;span class=&quot;token number&quot;&gt;0&lt;/span&gt;          &lt;span class=&quot;token number&quot;&gt;6&lt;/span&gt;               &lt;span class=&quot;token number&quot;&gt;6&lt;/span&gt;               &lt;span class=&quot;token number&quot;&gt;0&lt;/span&gt;               -               -               -%&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;/br&gt;
&lt;h3&gt;6-3-3-2) &lt;code class=&quot;language-text&quot;&gt;metrics()&lt;/code&gt; 메서드 사용&lt;/h3&gt;
&lt;ul&gt;
&lt;li&gt;컨슈머 애플리케이션의 &lt;code class=&quot;language-text&quot;&gt;KafkaConsumer&lt;/code&gt; 인스턴스의 &lt;code class=&quot;language-text&quot;&gt;metric()&lt;/code&gt; 메서드를 활용하면 컨슈머 랙 지표를 확인할 수 있다. 컨슈머 인스턴스가 제공하는 컨슈머 랙 관련 모니터링 지표는 3가지로 &lt;code class=&quot;language-text&quot;&gt;records-lag-max&lt;/code&gt;, &lt;code class=&quot;language-text&quot;&gt;records-lag&lt;/code&gt;, &lt;code class=&quot;language-text&quot;&gt;records-lag-avg&lt;/code&gt; 가 있다.&lt;/li&gt;
&lt;li&gt;다만 이 방법은 몇 가지 문제가 있는데, 첫 번째로는 컨슈머가 정상 동작할 때만 확인할 수 있다는 점이다. &lt;code class=&quot;language-text&quot;&gt;metric()&lt;/code&gt; 메서드는 컨슈머가 정상적으로 실행될 경우에만 호출된다. 그렇기 때문에 컨슈머 애플리케이션이 비정상적으로 종료된다면 더는 컨슈머 랙을 확인할 수 없다.&lt;/li&gt;
&lt;li&gt;두 번째로, 모든 컨슈머 애플리케이션에 컨슈머 랙 모니터링 코드를 중복해서 작성해야 한다. 왜냐하면 특정 컨슈머 그룹에 해당하는 애플리케이션이 수집하는 컨슈머 랙은 자기 자신 컨슈머 그룹의 컨슈머 랙에 한정되기 때문이다.&lt;/li&gt;
&lt;li&gt;세 번째로, 컨슈머 랙을 모니터링하는 코드를 추가할 수 없는 카프카 서드 파티 애플리케이션의 컨슈머 랙 모니터링이 불가능하다.&lt;/li&gt;
&lt;li&gt;마지막으로, 공식 java 라이브러리에서만 지원되므로 각 언어별로 지원되는지는 별도 확인이 필요하다.&lt;/li&gt;
&lt;/ul&gt;
&lt;/br&gt;
&lt;h3&gt;6-3-3-3) 외부 모니터링 툴 사용&lt;/h3&gt;
&lt;ul&gt;
&lt;li&gt;데이터 톡(Datadog), 컨플루언트 컨트롤 센터(Confluent Control Center), 버로우(Burrow), 펠리체(Felice) - 국내 기업용 등을 활용할 수 있다.&lt;/li&gt;
&lt;/ul&gt;</content:encoded></item><item><title><![CDATA[6-2) 컨슈머 애플리케이션 개발]]></title><description><![CDATA[6-2-1) java…]]></description><link>https://github.com/SiverPineValley/SiverPineValley.github.io/kafka/kafka_6_2/</link><guid isPermaLink="false">https://github.com/SiverPineValley/SiverPineValley.github.io/kafka/kafka_6_2/</guid><pubDate>Thu, 11 Jan 2024 17:00:00 GMT</pubDate><content:encoded>&lt;h2&gt;6-2-1) java를 이용한 컨슈머 애플리케이션 개발&lt;/h2&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;java&quot;&gt;&lt;pre class=&quot;language-java&quot;&gt;&lt;code class=&quot;language-java&quot;&gt;&lt;span class=&quot;token keyword&quot;&gt;package&lt;/span&gt; &lt;span class=&quot;token namespace&quot;&gt;com&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;example&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;  
  
&lt;span class=&quot;token keyword&quot;&gt;import&lt;/span&gt; &lt;span class=&quot;token import&quot;&gt;&lt;span class=&quot;token namespace&quot;&gt;org&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;apache&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;kafka&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;clients&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;consumer&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;/span&gt;&lt;span class=&quot;token class-name&quot;&gt;ConsumerConfig&lt;/span&gt;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;  
&lt;span class=&quot;token keyword&quot;&gt;import&lt;/span&gt; &lt;span class=&quot;token import&quot;&gt;&lt;span class=&quot;token namespace&quot;&gt;org&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;apache&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;kafka&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;clients&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;consumer&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;/span&gt;&lt;span class=&quot;token class-name&quot;&gt;ConsumerRecord&lt;/span&gt;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;  
&lt;span class=&quot;token keyword&quot;&gt;import&lt;/span&gt; &lt;span class=&quot;token import&quot;&gt;&lt;span class=&quot;token namespace&quot;&gt;org&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;apache&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;kafka&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;clients&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;consumer&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;/span&gt;&lt;span class=&quot;token class-name&quot;&gt;ConsumerRecords&lt;/span&gt;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;  
&lt;span class=&quot;token keyword&quot;&gt;import&lt;/span&gt; &lt;span class=&quot;token import&quot;&gt;&lt;span class=&quot;token namespace&quot;&gt;org&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;apache&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;kafka&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;clients&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;consumer&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;/span&gt;&lt;span class=&quot;token class-name&quot;&gt;KafkaConsumer&lt;/span&gt;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;  
&lt;span class=&quot;token keyword&quot;&gt;import&lt;/span&gt; &lt;span class=&quot;token import&quot;&gt;&lt;span class=&quot;token namespace&quot;&gt;org&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;apache&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;kafka&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;common&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;serialization&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;/span&gt;&lt;span class=&quot;token class-name&quot;&gt;StringDeserializer&lt;/span&gt;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;  
&lt;span class=&quot;token keyword&quot;&gt;import&lt;/span&gt; &lt;span class=&quot;token import&quot;&gt;&lt;span class=&quot;token namespace&quot;&gt;org&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;slf4j&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;/span&gt;&lt;span class=&quot;token class-name&quot;&gt;Logger&lt;/span&gt;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;  
&lt;span class=&quot;token keyword&quot;&gt;import&lt;/span&gt; &lt;span class=&quot;token import&quot;&gt;&lt;span class=&quot;token namespace&quot;&gt;org&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;slf4j&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;/span&gt;&lt;span class=&quot;token class-name&quot;&gt;LoggerFactory&lt;/span&gt;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;  
  
&lt;span class=&quot;token keyword&quot;&gt;import&lt;/span&gt; &lt;span class=&quot;token import&quot;&gt;&lt;span class=&quot;token namespace&quot;&gt;java&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;time&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;/span&gt;&lt;span class=&quot;token class-name&quot;&gt;Duration&lt;/span&gt;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;  
&lt;span class=&quot;token keyword&quot;&gt;import&lt;/span&gt; &lt;span class=&quot;token import&quot;&gt;&lt;span class=&quot;token namespace&quot;&gt;java&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;util&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;/span&gt;&lt;span class=&quot;token class-name&quot;&gt;Arrays&lt;/span&gt;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;  
&lt;span class=&quot;token keyword&quot;&gt;import&lt;/span&gt; &lt;span class=&quot;token import&quot;&gt;&lt;span class=&quot;token namespace&quot;&gt;java&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;util&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;/span&gt;&lt;span class=&quot;token class-name&quot;&gt;Properties&lt;/span&gt;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;  
  
&lt;span class=&quot;token keyword&quot;&gt;public&lt;/span&gt; &lt;span class=&quot;token keyword&quot;&gt;class&lt;/span&gt; &lt;span class=&quot;token class-name&quot;&gt;SimpleConsumer&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;  
    &lt;span class=&quot;token keyword&quot;&gt;private&lt;/span&gt; &lt;span class=&quot;token keyword&quot;&gt;final&lt;/span&gt; &lt;span class=&quot;token keyword&quot;&gt;static&lt;/span&gt; &lt;span class=&quot;token class-name&quot;&gt;Logger&lt;/span&gt; logger &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;token class-name&quot;&gt;LoggerFactory&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;getLogger&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token class-name&quot;&gt;SimpleConsumer&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token keyword&quot;&gt;class&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;  
    &lt;span class=&quot;token keyword&quot;&gt;private&lt;/span&gt; &lt;span class=&quot;token keyword&quot;&gt;final&lt;/span&gt; &lt;span class=&quot;token keyword&quot;&gt;static&lt;/span&gt; &lt;span class=&quot;token class-name&quot;&gt;String&lt;/span&gt; &lt;span class=&quot;token constant&quot;&gt;TOPIC_NAME&lt;/span&gt; &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;token string&quot;&gt;&quot;test&quot;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;  
    &lt;span class=&quot;token keyword&quot;&gt;private&lt;/span&gt; &lt;span class=&quot;token keyword&quot;&gt;final&lt;/span&gt; &lt;span class=&quot;token keyword&quot;&gt;static&lt;/span&gt; &lt;span class=&quot;token class-name&quot;&gt;String&lt;/span&gt; &lt;span class=&quot;token constant&quot;&gt;BOOTSTRAP_SERVERS&lt;/span&gt; &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;token string&quot;&gt;&quot;my-kafka:19092&quot;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;  
    &lt;span class=&quot;token keyword&quot;&gt;private&lt;/span&gt; &lt;span class=&quot;token keyword&quot;&gt;final&lt;/span&gt; &lt;span class=&quot;token keyword&quot;&gt;static&lt;/span&gt; &lt;span class=&quot;token class-name&quot;&gt;String&lt;/span&gt; &lt;span class=&quot;token constant&quot;&gt;GROUP_ID&lt;/span&gt; &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;token string&quot;&gt;&quot;test-group&quot;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;  
  
    &lt;span class=&quot;token keyword&quot;&gt;public&lt;/span&gt; &lt;span class=&quot;token keyword&quot;&gt;static&lt;/span&gt; &lt;span class=&quot;token keyword&quot;&gt;void&lt;/span&gt; &lt;span class=&quot;token function&quot;&gt;main&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token class-name&quot;&gt;String&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;[&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;]&lt;/span&gt; args&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;  
        &lt;span class=&quot;token class-name&quot;&gt;Properties&lt;/span&gt; configs &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;token keyword&quot;&gt;new&lt;/span&gt; &lt;span class=&quot;token class-name&quot;&gt;Properties&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;  
        configs&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;put&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token class-name&quot;&gt;ConsumerConfig&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token constant&quot;&gt;BOOTSTRAP_SERVERS_CONFIG&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;token constant&quot;&gt;BOOTSTRAP_SERVERS&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;  
        configs&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;put&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token class-name&quot;&gt;ConsumerConfig&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token constant&quot;&gt;GROUP_ID_CONFIG&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;token constant&quot;&gt;GROUP_ID&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;  
        configs&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;put&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token class-name&quot;&gt;ConsumerConfig&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token constant&quot;&gt;KEY_DESERIALIZER_CLASS_CONFIG&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;token class-name&quot;&gt;StringDeserializer&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token keyword&quot;&gt;class&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;getName&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;  
        configs&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;put&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token class-name&quot;&gt;ConsumerConfig&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token constant&quot;&gt;VALUE_DESERIALIZER_CLASS_CONFIG&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;token class-name&quot;&gt;StringDeserializer&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token keyword&quot;&gt;class&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;getName&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;  
  
        &lt;span class=&quot;token class-name&quot;&gt;KafkaConsumer&lt;/span&gt;&lt;span class=&quot;token generics&quot;&gt;&lt;span class=&quot;token punctuation&quot;&gt;&amp;lt;&lt;/span&gt;&lt;span class=&quot;token class-name&quot;&gt;String&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;token class-name&quot;&gt;String&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;&gt;&lt;/span&gt;&lt;/span&gt; consumer &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;token keyword&quot;&gt;new&lt;/span&gt; &lt;span class=&quot;token class-name&quot;&gt;KafkaConsumer&lt;/span&gt;&lt;span class=&quot;token generics&quot;&gt;&lt;span class=&quot;token punctuation&quot;&gt;&amp;lt;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;configs&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;  
  
        consumer&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;subscribe&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token class-name&quot;&gt;Arrays&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;asList&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token constant&quot;&gt;TOPIC_NAME&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;  
  
        &lt;span class=&quot;token keyword&quot;&gt;while&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token boolean&quot;&gt;true&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;  
            &lt;span class=&quot;token class-name&quot;&gt;ConsumerRecords&lt;/span&gt;&lt;span class=&quot;token generics&quot;&gt;&lt;span class=&quot;token punctuation&quot;&gt;&amp;lt;&lt;/span&gt;&lt;span class=&quot;token class-name&quot;&gt;String&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;token class-name&quot;&gt;String&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;&gt;&lt;/span&gt;&lt;/span&gt; records &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; consumer&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;poll&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token class-name&quot;&gt;Duration&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;ofSeconds&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token number&quot;&gt;1&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;  
            &lt;span class=&quot;token keyword&quot;&gt;for&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token class-name&quot;&gt;ConsumerRecord&lt;/span&gt;&lt;span class=&quot;token generics&quot;&gt;&lt;span class=&quot;token punctuation&quot;&gt;&amp;lt;&lt;/span&gt;&lt;span class=&quot;token class-name&quot;&gt;String&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;token class-name&quot;&gt;String&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;&gt;&lt;/span&gt;&lt;/span&gt; record &lt;span class=&quot;token operator&quot;&gt;:&lt;/span&gt; records&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;  
                logger&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;info&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token string&quot;&gt;&quot;record:{}&quot;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; record&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;  
            &lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;  
        &lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;  
    &lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;  
&lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;ul&gt;
&lt;li&gt;각 토픽을 컨슘하기 위해서는 &lt;code class=&quot;language-text&quot;&gt;subscribe()&lt;/code&gt;를 통해서 구독할 수 있다. 이후, 무한 루프 내에서 &lt;code class=&quot;language-text&quot;&gt;poll()&lt;/code&gt; 메소드를 사용하여 주기적으로 메시지를 가져올 수 있다. 여기서 &lt;code class=&quot;language-text&quot;&gt;poll()&lt;/code&gt; 메소드를 너무 오래 사용하게 되면 리밸런싱이 발생하므로 주의하여야 한다.&lt;/li&gt;
&lt;/ul&gt;
&lt;/br&gt;
&lt;h2&gt;6-2-2) 수동 커밋 컨슈머 애플리케이션&lt;/h2&gt;
&lt;/br&gt;
&lt;h3&gt;6-2-2-1) 동기 커밋 컨슈머&lt;/h3&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;java&quot;&gt;&lt;pre class=&quot;language-java&quot;&gt;&lt;code class=&quot;language-java&quot;&gt;&lt;span class=&quot;token keyword&quot;&gt;public&lt;/span&gt; &lt;span class=&quot;token keyword&quot;&gt;static&lt;/span&gt; &lt;span class=&quot;token keyword&quot;&gt;void&lt;/span&gt; &lt;span class=&quot;token function&quot;&gt;main&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token class-name&quot;&gt;String&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;[&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;]&lt;/span&gt; args&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;  
    &lt;span class=&quot;token class-name&quot;&gt;Properties&lt;/span&gt; configs &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;token keyword&quot;&gt;new&lt;/span&gt; &lt;span class=&quot;token class-name&quot;&gt;Properties&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;  
    configs&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;put&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token class-name&quot;&gt;ConsumerConfig&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token constant&quot;&gt;BOOTSTRAP_SERVERS_CONFIG&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;token constant&quot;&gt;BOOTSTRAP_SERVERS&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;  
    configs&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;put&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token class-name&quot;&gt;ConsumerConfig&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token constant&quot;&gt;GROUP_ID_CONFIG&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;token constant&quot;&gt;GROUP_ID&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;  
    configs&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;put&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token class-name&quot;&gt;ConsumerConfig&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token constant&quot;&gt;KEY_DESERIALIZER_CLASS_CONFIG&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;token class-name&quot;&gt;StringDeserializer&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token keyword&quot;&gt;class&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;getName&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;  
    configs&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;put&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token class-name&quot;&gt;ConsumerConfig&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token constant&quot;&gt;VALUE_DESERIALIZER_CLASS_CONFIG&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;token class-name&quot;&gt;StringDeserializer&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token keyword&quot;&gt;class&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;getName&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;  
    configs&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;put&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token class-name&quot;&gt;ConsumerConfig&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token constant&quot;&gt;ENABLE_AUTO_COMMIT_CONFIG&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;token boolean&quot;&gt;false&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;  
  
    &lt;span class=&quot;token class-name&quot;&gt;KafkaConsumer&lt;/span&gt;&lt;span class=&quot;token generics&quot;&gt;&lt;span class=&quot;token punctuation&quot;&gt;&amp;lt;&lt;/span&gt;&lt;span class=&quot;token class-name&quot;&gt;String&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;token class-name&quot;&gt;String&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;&gt;&lt;/span&gt;&lt;/span&gt; consumer &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;token keyword&quot;&gt;new&lt;/span&gt; &lt;span class=&quot;token class-name&quot;&gt;KafkaConsumer&lt;/span&gt;&lt;span class=&quot;token generics&quot;&gt;&lt;span class=&quot;token punctuation&quot;&gt;&amp;lt;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;configs&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;  
    consumer&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;subscribe&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token class-name&quot;&gt;Arrays&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;asList&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token constant&quot;&gt;TOPIC_NAME&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;  
  
    &lt;span class=&quot;token keyword&quot;&gt;while&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token boolean&quot;&gt;true&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;  
        &lt;span class=&quot;token class-name&quot;&gt;ConsumerRecords&lt;/span&gt;&lt;span class=&quot;token generics&quot;&gt;&lt;span class=&quot;token punctuation&quot;&gt;&amp;lt;&lt;/span&gt;&lt;span class=&quot;token class-name&quot;&gt;String&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;token class-name&quot;&gt;String&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;&gt;&lt;/span&gt;&lt;/span&gt; records &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; consumer&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;poll&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token class-name&quot;&gt;Duration&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;ofSeconds&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token number&quot;&gt;1&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;  
        &lt;span class=&quot;token keyword&quot;&gt;for&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token class-name&quot;&gt;ConsumerRecord&lt;/span&gt;&lt;span class=&quot;token generics&quot;&gt;&lt;span class=&quot;token punctuation&quot;&gt;&amp;lt;&lt;/span&gt;&lt;span class=&quot;token class-name&quot;&gt;String&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;token class-name&quot;&gt;String&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;&gt;&lt;/span&gt;&lt;/span&gt; record &lt;span class=&quot;token operator&quot;&gt;:&lt;/span&gt; records&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;  
            logger&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;info&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token string&quot;&gt;&quot;record:{}&quot;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; record&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;  
        &lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;  
        consumer&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;commitSync&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;  
    &lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;  
&lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;ul&gt;
&lt;li&gt;수동으로 커밋을 하기 위해서는 &lt;code class=&quot;language-text&quot;&gt;ENABLE_AUTO_COMMIT_CONFIG&lt;/code&gt;을 false로 설정하고, &lt;code class=&quot;language-text&quot;&gt;poll()&lt;/code&gt; 메소드 사용 이후 &lt;code class=&quot;language-text&quot;&gt;commitSync()&lt;/code&gt;를 통해 오프셋 커밋을 명시적으로 수행할 수 있다.&lt;/li&gt;
&lt;/ul&gt;
&lt;/br&gt;
&lt;h3&gt;6-2-2-2) 레코드 단위 동기 커밋 컨슈머&lt;/h3&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;java&quot;&gt;&lt;pre class=&quot;language-java&quot;&gt;&lt;code class=&quot;language-java&quot;&gt;&lt;span class=&quot;token keyword&quot;&gt;public&lt;/span&gt; &lt;span class=&quot;token keyword&quot;&gt;static&lt;/span&gt; &lt;span class=&quot;token keyword&quot;&gt;void&lt;/span&gt; &lt;span class=&quot;token function&quot;&gt;main&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token class-name&quot;&gt;String&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;[&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;]&lt;/span&gt; args&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;  
    &lt;span class=&quot;token class-name&quot;&gt;Properties&lt;/span&gt; configs &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;token keyword&quot;&gt;new&lt;/span&gt; &lt;span class=&quot;token class-name&quot;&gt;Properties&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;  
    configs&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;put&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token class-name&quot;&gt;ConsumerConfig&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token constant&quot;&gt;BOOTSTRAP_SERVERS_CONFIG&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;token constant&quot;&gt;BOOTSTRAP_SERVERS&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;  
    configs&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;put&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token class-name&quot;&gt;ConsumerConfig&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token constant&quot;&gt;GROUP_ID_CONFIG&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;token constant&quot;&gt;GROUP_ID&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;  
    configs&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;put&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token class-name&quot;&gt;ConsumerConfig&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token constant&quot;&gt;KEY_DESERIALIZER_CLASS_CONFIG&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;token class-name&quot;&gt;StringDeserializer&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token keyword&quot;&gt;class&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;getName&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;  
    configs&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;put&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token class-name&quot;&gt;ConsumerConfig&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token constant&quot;&gt;VALUE_DESERIALIZER_CLASS_CONFIG&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;token class-name&quot;&gt;StringDeserializer&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token keyword&quot;&gt;class&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;getName&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;  
    configs&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;put&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token class-name&quot;&gt;ConsumerConfig&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token constant&quot;&gt;ENABLE_AUTO_COMMIT_CONFIG&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;token boolean&quot;&gt;false&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;  
  
    &lt;span class=&quot;token class-name&quot;&gt;KafkaConsumer&lt;/span&gt;&lt;span class=&quot;token generics&quot;&gt;&lt;span class=&quot;token punctuation&quot;&gt;&amp;lt;&lt;/span&gt;&lt;span class=&quot;token class-name&quot;&gt;String&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;token class-name&quot;&gt;String&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;&gt;&lt;/span&gt;&lt;/span&gt; consumer &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;token keyword&quot;&gt;new&lt;/span&gt; &lt;span class=&quot;token class-name&quot;&gt;KafkaConsumer&lt;/span&gt;&lt;span class=&quot;token generics&quot;&gt;&lt;span class=&quot;token punctuation&quot;&gt;&amp;lt;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;configs&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;  
    consumer&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;subscribe&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token class-name&quot;&gt;Arrays&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;asList&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token constant&quot;&gt;TOPIC_NAME&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;  
  
    &lt;span class=&quot;token keyword&quot;&gt;while&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token boolean&quot;&gt;true&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;  
        &lt;span class=&quot;token class-name&quot;&gt;ConsumerRecords&lt;/span&gt;&lt;span class=&quot;token generics&quot;&gt;&lt;span class=&quot;token punctuation&quot;&gt;&amp;lt;&lt;/span&gt;&lt;span class=&quot;token class-name&quot;&gt;String&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;token class-name&quot;&gt;String&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;&gt;&lt;/span&gt;&lt;/span&gt; records &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; consumer&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;poll&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token class-name&quot;&gt;Duration&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;ofSeconds&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token number&quot;&gt;1&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;  
        &lt;span class=&quot;token class-name&quot;&gt;Map&lt;/span&gt;&lt;span class=&quot;token generics&quot;&gt;&lt;span class=&quot;token punctuation&quot;&gt;&amp;lt;&lt;/span&gt;&lt;span class=&quot;token class-name&quot;&gt;TopicPartition&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;token class-name&quot;&gt;OffsetAndMetadata&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;&gt;&lt;/span&gt;&lt;/span&gt; currentOffset &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;token keyword&quot;&gt;new&lt;/span&gt; &lt;span class=&quot;token class-name&quot;&gt;HashMap&lt;/span&gt;&lt;span class=&quot;token generics&quot;&gt;&lt;span class=&quot;token punctuation&quot;&gt;&amp;lt;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;  
  
        &lt;span class=&quot;token keyword&quot;&gt;for&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token class-name&quot;&gt;ConsumerRecord&lt;/span&gt;&lt;span class=&quot;token generics&quot;&gt;&lt;span class=&quot;token punctuation&quot;&gt;&amp;lt;&lt;/span&gt;&lt;span class=&quot;token class-name&quot;&gt;String&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;token class-name&quot;&gt;String&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;&gt;&lt;/span&gt;&lt;/span&gt; record &lt;span class=&quot;token operator&quot;&gt;:&lt;/span&gt; records&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;  
            logger&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;info&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token string&quot;&gt;&quot;record:{}&quot;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; record&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;  
            currentOffset&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;put&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;  
                    &lt;span class=&quot;token keyword&quot;&gt;new&lt;/span&gt; &lt;span class=&quot;token class-name&quot;&gt;TopicPartition&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;record&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;topic&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; record&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;partition&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt;  
                    &lt;span class=&quot;token keyword&quot;&gt;new&lt;/span&gt; &lt;span class=&quot;token class-name&quot;&gt;OffsetAndMetadata&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;record&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;offset&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;token operator&quot;&gt;+&lt;/span&gt; &lt;span class=&quot;token number&quot;&gt;1&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;token keyword&quot;&gt;null&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;  
            consumer&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;commitSync&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;currentOffset&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;  
        &lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;  
    &lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;  
&lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;ul&gt;
&lt;li&gt;레코드 단위 오프셋 커밋을 위해서는 &lt;code class=&quot;language-text&quot;&gt;Map&amp;lt;TopicPartition, OffsetAndMetadata&gt; currentOffset&lt;/code&gt;과 같이 현재의 파티션과 오프셋 정보의 맵을 생성하고, 레코드가 들어올 때 마다  토픽의 파티션을 키, 오프셋의 +1한 값을 값으로 맵에 설정한 뒤 해당 레코드의 오프셋을 커밋하는 방식으로도 커밋할 수 있다.&lt;/li&gt;
&lt;/ul&gt;
&lt;/br&gt;
&lt;h3&gt;6-2-2-3) 비동기 커밋 컨슈머&lt;/h3&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;java&quot;&gt;&lt;pre class=&quot;language-java&quot;&gt;&lt;code class=&quot;language-java&quot;&gt;&lt;span class=&quot;token keyword&quot;&gt;public&lt;/span&gt; &lt;span class=&quot;token keyword&quot;&gt;static&lt;/span&gt; &lt;span class=&quot;token keyword&quot;&gt;void&lt;/span&gt; &lt;span class=&quot;token function&quot;&gt;main&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token class-name&quot;&gt;String&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;[&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;]&lt;/span&gt; args&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;  
    &lt;span class=&quot;token class-name&quot;&gt;Properties&lt;/span&gt; configs &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;token keyword&quot;&gt;new&lt;/span&gt; &lt;span class=&quot;token class-name&quot;&gt;Properties&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;  
    configs&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;put&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token class-name&quot;&gt;ConsumerConfig&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token constant&quot;&gt;BOOTSTRAP_SERVERS_CONFIG&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;token constant&quot;&gt;BOOTSTRAP_SERVERS&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;  
    configs&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;put&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token class-name&quot;&gt;ConsumerConfig&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token constant&quot;&gt;GROUP_ID_CONFIG&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;token constant&quot;&gt;GROUP_ID&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;  
    configs&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;put&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token class-name&quot;&gt;ConsumerConfig&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token constant&quot;&gt;KEY_DESERIALIZER_CLASS_CONFIG&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;token class-name&quot;&gt;StringDeserializer&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token keyword&quot;&gt;class&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;getName&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;  
    configs&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;put&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token class-name&quot;&gt;ConsumerConfig&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token constant&quot;&gt;VALUE_DESERIALIZER_CLASS_CONFIG&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;token class-name&quot;&gt;StringDeserializer&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token keyword&quot;&gt;class&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;getName&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;  
    configs&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;put&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token class-name&quot;&gt;ConsumerConfig&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token constant&quot;&gt;ENABLE_AUTO_COMMIT_CONFIG&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;token boolean&quot;&gt;false&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;  
  
    &lt;span class=&quot;token class-name&quot;&gt;KafkaConsumer&lt;/span&gt;&lt;span class=&quot;token generics&quot;&gt;&lt;span class=&quot;token punctuation&quot;&gt;&amp;lt;&lt;/span&gt;&lt;span class=&quot;token class-name&quot;&gt;String&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;token class-name&quot;&gt;String&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;&gt;&lt;/span&gt;&lt;/span&gt; consumer &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;token keyword&quot;&gt;new&lt;/span&gt; &lt;span class=&quot;token class-name&quot;&gt;KafkaConsumer&lt;/span&gt;&lt;span class=&quot;token generics&quot;&gt;&lt;span class=&quot;token punctuation&quot;&gt;&amp;lt;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;configs&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;  
    consumer&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;subscribe&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token class-name&quot;&gt;Arrays&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;asList&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token constant&quot;&gt;TOPIC_NAME&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;  
  
    &lt;span class=&quot;token keyword&quot;&gt;while&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token boolean&quot;&gt;true&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;  
        &lt;span class=&quot;token class-name&quot;&gt;ConsumerRecords&lt;/span&gt;&lt;span class=&quot;token generics&quot;&gt;&lt;span class=&quot;token punctuation&quot;&gt;&amp;lt;&lt;/span&gt;&lt;span class=&quot;token class-name&quot;&gt;String&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;token class-name&quot;&gt;String&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;&gt;&lt;/span&gt;&lt;/span&gt; records &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; consumer&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;poll&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token class-name&quot;&gt;Duration&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;ofSeconds&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token number&quot;&gt;1&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;  
        &lt;span class=&quot;token keyword&quot;&gt;for&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token class-name&quot;&gt;ConsumerRecord&lt;/span&gt;&lt;span class=&quot;token generics&quot;&gt;&lt;span class=&quot;token punctuation&quot;&gt;&amp;lt;&lt;/span&gt;&lt;span class=&quot;token class-name&quot;&gt;String&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;token class-name&quot;&gt;String&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;&gt;&lt;/span&gt;&lt;/span&gt; record &lt;span class=&quot;token operator&quot;&gt;:&lt;/span&gt; records&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;  
            logger&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;info&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token string&quot;&gt;&quot;record:{}&quot;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; record&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;  
        &lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;  
        consumer&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;commitAsync&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token keyword&quot;&gt;new&lt;/span&gt; &lt;span class=&quot;token class-name&quot;&gt;OffsetCommitCallback&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;  
            &lt;span class=&quot;token keyword&quot;&gt;public&lt;/span&gt; &lt;span class=&quot;token keyword&quot;&gt;void&lt;/span&gt; &lt;span class=&quot;token function&quot;&gt;onComplete&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token class-name&quot;&gt;Map&lt;/span&gt;&lt;span class=&quot;token generics&quot;&gt;&lt;span class=&quot;token punctuation&quot;&gt;&amp;lt;&lt;/span&gt;&lt;span class=&quot;token class-name&quot;&gt;TopicPartition&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;token class-name&quot;&gt;OffsetAndMetadata&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;&gt;&lt;/span&gt;&lt;/span&gt; offsets&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;token class-name&quot;&gt;Exception&lt;/span&gt; e&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;  
                &lt;span class=&quot;token keyword&quot;&gt;if&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;e &lt;span class=&quot;token operator&quot;&gt;!=&lt;/span&gt; &lt;span class=&quot;token keyword&quot;&gt;null&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;  
                    &lt;span class=&quot;token class-name&quot;&gt;System&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;err&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;println&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token string&quot;&gt;&quot;Commit failed&quot;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;  
                &lt;span class=&quot;token keyword&quot;&gt;else&lt;/span&gt;  
                    &lt;span class=&quot;token class-name&quot;&gt;System&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;out&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;println&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token string&quot;&gt;&quot;Commit succeeded&quot;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;  
                &lt;span class=&quot;token keyword&quot;&gt;if&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;e &lt;span class=&quot;token operator&quot;&gt;!=&lt;/span&gt; &lt;span class=&quot;token keyword&quot;&gt;null&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;  
                    logger&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;error&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token string&quot;&gt;&quot;Commit failed for offsets {}&quot;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; offsets&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; e&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;  
            &lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;  
        &lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;  
    &lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;  
&lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;ul&gt;
&lt;li&gt;
&lt;p&gt;동기 오프셋 커밋은 커밋 응답을 기다리는 동안 데이터 처리 자체가 중단되게 된다. 단위 시간 당 더 많은 데이터를 처리하기 위해서는 비동기 오프셋 커밋을 사용해야 한다. 비동기 오프셋 커밋은 &lt;code class=&quot;language-text&quot;&gt;commitAsync()&lt;/code&gt; 메서드를 통해 가능하다.&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;비동기로 커밋을 처리하더라도 간혹 에러가 발생할 수도 있다. 해당 경우를 위해 &lt;code class=&quot;language-text&quot;&gt;commitAsync()&lt;/code&gt; 메서드에 파라미터로 &lt;code class=&quot;language-text&quot;&gt;OffsetCommitCallback()&lt;/code&gt; 메서드를 넘긴다.&lt;/p&gt;
&lt;/li&gt;
&lt;/ul&gt;
&lt;/br&gt;
&lt;h2&gt;6-2-3) 리밸런스 리스너를 가진 컨슈머 애플리케이션&lt;/h2&gt;
&lt;ul&gt;
&lt;li&gt;리밸런스 발생을 감지하기 위해서는 카프카 라이브러리는 &lt;code class=&quot;language-text&quot;&gt;ConsumerRebalanceListener&lt;/code&gt; 인터페이스를 지원하고 있다. &lt;code class=&quot;language-text&quot;&gt;ConsumerRebalanceListener&lt;/code&gt;로 구현된 클래스는 &lt;code class=&quot;language-text&quot;&gt;onPartitionAssigned()&lt;/code&gt;와 &lt;code class=&quot;language-text&quot;&gt;onPartitionRevoked()&lt;/code&gt; 메서드로 이루어져 있다.&lt;/li&gt;
&lt;li&gt;&lt;code class=&quot;language-text&quot;&gt;onPartitionAssigned()&lt;/code&gt;: 리밸런스가 끝난 뒤 파티션이 할당되면 호출되는 메서드&lt;/li&gt;
&lt;li&gt;&lt;code class=&quot;language-text&quot;&gt;onPartitionRevoked()&lt;/code&gt;: 리밸런스가 시작되기 직전에 호출되는 메서드로, 리밸런스 직전에 어떻게 파티션이 할당되어 있었는지 확인할 수 있다. 마지막에 처리한 레코드를 기준으로 커밋을 하기 위해서는 리밸런스가 시작하기 직전에 커밋을 하면 되므로 이 메서드에 커밋을 구현하여 처리할 수 있다.&lt;/li&gt;
&lt;/ul&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;java&quot;&gt;&lt;pre class=&quot;language-java&quot;&gt;&lt;code class=&quot;language-java&quot;&gt;&lt;span class=&quot;token keyword&quot;&gt;package&lt;/span&gt; &lt;span class=&quot;token namespace&quot;&gt;com&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;example&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;  
  
&lt;span class=&quot;token keyword&quot;&gt;import&lt;/span&gt; &lt;span class=&quot;token import&quot;&gt;&lt;span class=&quot;token namespace&quot;&gt;org&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;apache&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;kafka&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;clients&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;consumer&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;/span&gt;&lt;span class=&quot;token class-name&quot;&gt;ConsumerRebalanceListener&lt;/span&gt;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;  
&lt;span class=&quot;token keyword&quot;&gt;import&lt;/span&gt; &lt;span class=&quot;token import&quot;&gt;&lt;span class=&quot;token namespace&quot;&gt;org&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;apache&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;kafka&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;common&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;/span&gt;&lt;span class=&quot;token class-name&quot;&gt;TopicPartition&lt;/span&gt;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;  
&lt;span class=&quot;token keyword&quot;&gt;import&lt;/span&gt; &lt;span class=&quot;token import&quot;&gt;&lt;span class=&quot;token namespace&quot;&gt;org&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;slf4j&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;/span&gt;&lt;span class=&quot;token class-name&quot;&gt;Logger&lt;/span&gt;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;  
&lt;span class=&quot;token keyword&quot;&gt;import&lt;/span&gt; &lt;span class=&quot;token import&quot;&gt;&lt;span class=&quot;token namespace&quot;&gt;org&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;slf4j&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;/span&gt;&lt;span class=&quot;token class-name&quot;&gt;LoggerFactory&lt;/span&gt;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;  
  
&lt;span class=&quot;token keyword&quot;&gt;import&lt;/span&gt; &lt;span class=&quot;token import&quot;&gt;&lt;span class=&quot;token namespace&quot;&gt;java&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;util&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;/span&gt;&lt;span class=&quot;token class-name&quot;&gt;Collection&lt;/span&gt;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;  
  
&lt;span class=&quot;token keyword&quot;&gt;public&lt;/span&gt; &lt;span class=&quot;token keyword&quot;&gt;class&lt;/span&gt; &lt;span class=&quot;token class-name&quot;&gt;RebalanceListener&lt;/span&gt; &lt;span class=&quot;token keyword&quot;&gt;implements&lt;/span&gt; &lt;span class=&quot;token class-name&quot;&gt;ConsumerRebalanceListener&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;  
    &lt;span class=&quot;token keyword&quot;&gt;private&lt;/span&gt; &lt;span class=&quot;token keyword&quot;&gt;final&lt;/span&gt; &lt;span class=&quot;token keyword&quot;&gt;static&lt;/span&gt; &lt;span class=&quot;token class-name&quot;&gt;Logger&lt;/span&gt; logger &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;token class-name&quot;&gt;LoggerFactory&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;getLogger&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token class-name&quot;&gt;RebalanceListener&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token keyword&quot;&gt;class&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;  
  
    &lt;span class=&quot;token keyword&quot;&gt;public&lt;/span&gt; &lt;span class=&quot;token keyword&quot;&gt;void&lt;/span&gt; &lt;span class=&quot;token function&quot;&gt;onPartitionsAssigned&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token class-name&quot;&gt;Collection&lt;/span&gt;&lt;span class=&quot;token generics&quot;&gt;&lt;span class=&quot;token punctuation&quot;&gt;&amp;lt;&lt;/span&gt;&lt;span class=&quot;token class-name&quot;&gt;TopicPartition&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;&gt;&lt;/span&gt;&lt;/span&gt; partitions&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;  
        logger&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;warn&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token string&quot;&gt;&quot;Partitions are assigned : &quot;&lt;/span&gt; &lt;span class=&quot;token operator&quot;&gt;+&lt;/span&gt; partitions&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;toString&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;  
  
    &lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;  
  
    &lt;span class=&quot;token keyword&quot;&gt;public&lt;/span&gt; &lt;span class=&quot;token keyword&quot;&gt;void&lt;/span&gt; &lt;span class=&quot;token function&quot;&gt;onPartitionsRevoked&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token class-name&quot;&gt;Collection&lt;/span&gt;&lt;span class=&quot;token generics&quot;&gt;&lt;span class=&quot;token punctuation&quot;&gt;&amp;lt;&lt;/span&gt;&lt;span class=&quot;token class-name&quot;&gt;TopicPartition&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;&gt;&lt;/span&gt;&lt;/span&gt; partitions&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;  
        logger&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;warn&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token string&quot;&gt;&quot;Partitions are revoked : &quot;&lt;/span&gt; &lt;span class=&quot;token operator&quot;&gt;+&lt;/span&gt; partitions&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;toString&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;  
    &lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;  
&lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;java&quot;&gt;&lt;pre class=&quot;language-java&quot;&gt;&lt;code class=&quot;language-java&quot;&gt;&lt;span class=&quot;token keyword&quot;&gt;public&lt;/span&gt; &lt;span class=&quot;token keyword&quot;&gt;static&lt;/span&gt; &lt;span class=&quot;token keyword&quot;&gt;void&lt;/span&gt; &lt;span class=&quot;token function&quot;&gt;main&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token class-name&quot;&gt;String&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;[&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;]&lt;/span&gt; args&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;  
    &lt;span class=&quot;token class-name&quot;&gt;Properties&lt;/span&gt; configs &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;token keyword&quot;&gt;new&lt;/span&gt; &lt;span class=&quot;token class-name&quot;&gt;Properties&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;  
    configs&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;put&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token class-name&quot;&gt;ConsumerConfig&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token constant&quot;&gt;BOOTSTRAP_SERVERS_CONFIG&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;token constant&quot;&gt;BOOTSTRAP_SERVERS&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;  
    configs&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;put&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token class-name&quot;&gt;ConsumerConfig&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token constant&quot;&gt;GROUP_ID_CONFIG&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;token constant&quot;&gt;GROUP_ID&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;  
    configs&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;put&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token class-name&quot;&gt;ConsumerConfig&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token constant&quot;&gt;KEY_DESERIALIZER_CLASS_CONFIG&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;token class-name&quot;&gt;StringDeserializer&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token keyword&quot;&gt;class&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;getName&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;  
    configs&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;put&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token class-name&quot;&gt;ConsumerConfig&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token constant&quot;&gt;VALUE_DESERIALIZER_CLASS_CONFIG&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;token class-name&quot;&gt;StringDeserializer&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token keyword&quot;&gt;class&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;getName&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;  
  
    consumer &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;token keyword&quot;&gt;new&lt;/span&gt; &lt;span class=&quot;token class-name&quot;&gt;KafkaConsumer&lt;/span&gt;&lt;span class=&quot;token generics&quot;&gt;&lt;span class=&quot;token punctuation&quot;&gt;&amp;lt;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;configs&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;  
    consumer&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;subscribe&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token class-name&quot;&gt;Arrays&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;asList&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token constant&quot;&gt;TOPIC_NAME&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;token keyword&quot;&gt;new&lt;/span&gt; &lt;span class=&quot;token class-name&quot;&gt;RebalanceListener&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;  
    &lt;span class=&quot;token keyword&quot;&gt;while&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token boolean&quot;&gt;true&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;  
        &lt;span class=&quot;token class-name&quot;&gt;ConsumerRecords&lt;/span&gt;&lt;span class=&quot;token generics&quot;&gt;&lt;span class=&quot;token punctuation&quot;&gt;&amp;lt;&lt;/span&gt;&lt;span class=&quot;token class-name&quot;&gt;String&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;token class-name&quot;&gt;String&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;&gt;&lt;/span&gt;&lt;/span&gt; records &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; consumer&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;poll&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token class-name&quot;&gt;Duration&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;ofSeconds&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token number&quot;&gt;1&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;  
        &lt;span class=&quot;token keyword&quot;&gt;for&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token class-name&quot;&gt;ConsumerRecord&lt;/span&gt;&lt;span class=&quot;token generics&quot;&gt;&lt;span class=&quot;token punctuation&quot;&gt;&amp;lt;&lt;/span&gt;&lt;span class=&quot;token class-name&quot;&gt;String&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;token class-name&quot;&gt;String&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;&gt;&lt;/span&gt;&lt;/span&gt; record &lt;span class=&quot;token operator&quot;&gt;:&lt;/span&gt; records&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;  
            logger&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;info&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token string&quot;&gt;&quot;{}&quot;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; record&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;  
        &lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;  
    &lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;  
&lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;ul&gt;
&lt;li&gt;리밸런스 리스너를 사용하기 위해서는 &lt;code class=&quot;language-text&quot;&gt;subscribe()&lt;/code&gt;메소드를 호출할 때 &lt;code class=&quot;language-text&quot;&gt;RebalanceListener()&lt;/code&gt;에 리스너 클래스를 추가하여야 한다.&lt;/li&gt;
&lt;li&gt;위의 소스 코드를 사용하면 아래와 같은 로그가 발생한다. test-group 컨슈머 그룹 ID로 컨슈머가 새로 추가되어 리밸런스가 발생하고 0번 파티션을 할당받았기 때문이다.&lt;/li&gt;
&lt;/ul&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;text&quot;&gt;&lt;pre class=&quot;language-text&quot;&gt;&lt;code class=&quot;language-text&quot;&gt;[main] INFO org.apache.kafka.clients.consumer.internals.ConsumerRebalanceListenerInvoker - [Consumer clientId=consumer-test-group-1, groupId=test-group] Adding newly assigned partitions: test-0
[main] WARN com.example.RebalanceListener - Partitions are assigned : [test-0]&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;ul&gt;
&lt;li&gt;이 상황에서 같은 컨슈머 그룹 ID로 새롭게 컨슈머를 실행시키면 아래와 같이 로그가 발생한다. 파티션이 0번만 있는 상황에서 이미 파티션을 다른 컨슈머가 할당받고 있기 때문에 어떠한 파티션도 할당받지 못했다.&lt;/li&gt;
&lt;/ul&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;text&quot;&gt;&lt;pre class=&quot;language-text&quot;&gt;&lt;code class=&quot;language-text&quot;&gt;[main] WARN com.example.RebalanceListener - Partitions are assigned : []&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;ul&gt;
&lt;li&gt;이 때 기존 컨슈머가 종료되면 다시 리밸런스가 발생하면서 살아있는 컨슈머에 0번 파티션을 할당받게 된다. 이 때 Revoke, Assign 메서드가 모두 호출되는 것을 확인할 수 있다.&lt;/li&gt;
&lt;/ul&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;text&quot;&gt;&lt;pre class=&quot;language-text&quot;&gt;&lt;code class=&quot;language-text&quot;&gt;[main] WARN com.example.RebalanceListener - Partitions are revoked : []
...
[main] INFO org.apache.kafka.clients.consumer.internals.ConsumerRebalanceListenerInvoker - [Consumer clientId=consumer-test-group-1, groupId=test-group] Adding newly assigned partitions: test-0
[main] WARN com.example.RebalanceListener - Partitions are assigned : [test-0]&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;/br&gt;
&lt;h2&gt;6-2-4) 파티션 할당 컨슈머 애플리케이션&lt;/h2&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;java&quot;&gt;&lt;pre class=&quot;language-java&quot;&gt;&lt;code class=&quot;language-java&quot;&gt;&lt;span class=&quot;token keyword&quot;&gt;public&lt;/span&gt; &lt;span class=&quot;token keyword&quot;&gt;static&lt;/span&gt; &lt;span class=&quot;token keyword&quot;&gt;void&lt;/span&gt; &lt;span class=&quot;token function&quot;&gt;main&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token class-name&quot;&gt;String&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;[&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;]&lt;/span&gt; args&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;  
    &lt;span class=&quot;token class-name&quot;&gt;Properties&lt;/span&gt; configs &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;token keyword&quot;&gt;new&lt;/span&gt; &lt;span class=&quot;token class-name&quot;&gt;Properties&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;  
    configs&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;put&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token class-name&quot;&gt;ConsumerConfig&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token constant&quot;&gt;BOOTSTRAP_SERVERS_CONFIG&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;token constant&quot;&gt;BOOTSTRAP_SERVERS&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;  
    configs&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;put&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token class-name&quot;&gt;ConsumerConfig&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token constant&quot;&gt;KEY_DESERIALIZER_CLASS_CONFIG&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;token class-name&quot;&gt;StringDeserializer&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token keyword&quot;&gt;class&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;getName&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;  
    configs&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;put&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token class-name&quot;&gt;ConsumerConfig&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token constant&quot;&gt;VALUE_DESERIALIZER_CLASS_CONFIG&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;token class-name&quot;&gt;StringDeserializer&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token keyword&quot;&gt;class&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;getName&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;  
  
    &lt;span class=&quot;token class-name&quot;&gt;KafkaConsumer&lt;/span&gt;&lt;span class=&quot;token generics&quot;&gt;&lt;span class=&quot;token punctuation&quot;&gt;&amp;lt;&lt;/span&gt;&lt;span class=&quot;token class-name&quot;&gt;String&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;token class-name&quot;&gt;String&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;&gt;&lt;/span&gt;&lt;/span&gt; consumer &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;token keyword&quot;&gt;new&lt;/span&gt; &lt;span class=&quot;token class-name&quot;&gt;KafkaConsumer&lt;/span&gt;&lt;span class=&quot;token generics&quot;&gt;&lt;span class=&quot;token punctuation&quot;&gt;&amp;lt;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;configs&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;  
    consumer&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;assign&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token class-name&quot;&gt;Collections&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;singleton&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token keyword&quot;&gt;new&lt;/span&gt; &lt;span class=&quot;token class-name&quot;&gt;TopicPartition&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token constant&quot;&gt;TOPIC_NAME&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;token constant&quot;&gt;PARTITION_NUMBER&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;  
    &lt;span class=&quot;token keyword&quot;&gt;while&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token boolean&quot;&gt;true&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;  
        &lt;span class=&quot;token class-name&quot;&gt;ConsumerRecords&lt;/span&gt;&lt;span class=&quot;token generics&quot;&gt;&lt;span class=&quot;token punctuation&quot;&gt;&amp;lt;&lt;/span&gt;&lt;span class=&quot;token class-name&quot;&gt;String&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;token class-name&quot;&gt;String&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;&gt;&lt;/span&gt;&lt;/span&gt; records &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; consumer&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;poll&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token class-name&quot;&gt;Duration&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;ofSeconds&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token number&quot;&gt;1&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;  
        &lt;span class=&quot;token keyword&quot;&gt;for&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token class-name&quot;&gt;ConsumerRecord&lt;/span&gt;&lt;span class=&quot;token generics&quot;&gt;&lt;span class=&quot;token punctuation&quot;&gt;&amp;lt;&lt;/span&gt;&lt;span class=&quot;token class-name&quot;&gt;String&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;token class-name&quot;&gt;String&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;&gt;&lt;/span&gt;&lt;/span&gt; record &lt;span class=&quot;token operator&quot;&gt;:&lt;/span&gt; records&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;  
            logger&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;info&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token string&quot;&gt;&quot;record:{}&quot;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; record&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;  
        &lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;  
    &lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;  
&lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;ul&gt;
&lt;li&gt;컨슈머 역시 특정 파티션에 대해서만 지정해서 subscribe할 수 있다. 이 경우 &lt;code class=&quot;language-text&quot;&gt;assign()&lt;/code&gt; 메서드를 직접 할당하여 처리하도록 할 수 있다. 이 경우 컨슈머 그룹 ID를 필수로 넣지 않아도 된다.&lt;/li&gt;
&lt;/ul&gt;
&lt;/br&gt;
&lt;h2&gt;6-2-5) 컨슈머 애플리케이션의 안전한 종료&lt;/h2&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;java&quot;&gt;&lt;pre class=&quot;language-java&quot;&gt;&lt;code class=&quot;language-java&quot;&gt;&lt;span class=&quot;token keyword&quot;&gt;public&lt;/span&gt; &lt;span class=&quot;token keyword&quot;&gt;class&lt;/span&gt; &lt;span class=&quot;token class-name&quot;&gt;ConsumerWithSyncOffsetCommit&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;  
    &lt;span class=&quot;token keyword&quot;&gt;private&lt;/span&gt; &lt;span class=&quot;token keyword&quot;&gt;final&lt;/span&gt; &lt;span class=&quot;token keyword&quot;&gt;static&lt;/span&gt; &lt;span class=&quot;token class-name&quot;&gt;Logger&lt;/span&gt; logger &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;token class-name&quot;&gt;LoggerFactory&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;getLogger&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token class-name&quot;&gt;ConsumerWithSyncOffsetCommit&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token keyword&quot;&gt;class&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;  
    &lt;span class=&quot;token keyword&quot;&gt;private&lt;/span&gt; &lt;span class=&quot;token keyword&quot;&gt;final&lt;/span&gt; &lt;span class=&quot;token keyword&quot;&gt;static&lt;/span&gt; &lt;span class=&quot;token class-name&quot;&gt;String&lt;/span&gt; &lt;span class=&quot;token constant&quot;&gt;TOPIC_NAME&lt;/span&gt; &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;token string&quot;&gt;&quot;test&quot;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;  
    &lt;span class=&quot;token keyword&quot;&gt;private&lt;/span&gt; &lt;span class=&quot;token keyword&quot;&gt;final&lt;/span&gt; &lt;span class=&quot;token keyword&quot;&gt;static&lt;/span&gt; &lt;span class=&quot;token class-name&quot;&gt;String&lt;/span&gt; &lt;span class=&quot;token constant&quot;&gt;BOOTSTRAP_SERVERS&lt;/span&gt; &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;token string&quot;&gt;&quot;my-kafka:19092&quot;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;  
    &lt;span class=&quot;token keyword&quot;&gt;private&lt;/span&gt; &lt;span class=&quot;token keyword&quot;&gt;final&lt;/span&gt; &lt;span class=&quot;token keyword&quot;&gt;static&lt;/span&gt; &lt;span class=&quot;token class-name&quot;&gt;String&lt;/span&gt; &lt;span class=&quot;token constant&quot;&gt;GROUP_ID&lt;/span&gt; &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;token string&quot;&gt;&quot;test-group&quot;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;  
    &lt;span class=&quot;token keyword&quot;&gt;private&lt;/span&gt; &lt;span class=&quot;token keyword&quot;&gt;static&lt;/span&gt; &lt;span class=&quot;token class-name&quot;&gt;KafkaConsumer&lt;/span&gt;&lt;span class=&quot;token generics&quot;&gt;&lt;span class=&quot;token punctuation&quot;&gt;&amp;lt;&lt;/span&gt;&lt;span class=&quot;token class-name&quot;&gt;String&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;token class-name&quot;&gt;String&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;&gt;&lt;/span&gt;&lt;/span&gt; consumer&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;  
  
    &lt;span class=&quot;token keyword&quot;&gt;public&lt;/span&gt; &lt;span class=&quot;token keyword&quot;&gt;static&lt;/span&gt; &lt;span class=&quot;token keyword&quot;&gt;void&lt;/span&gt; &lt;span class=&quot;token function&quot;&gt;main&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token class-name&quot;&gt;String&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;[&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;]&lt;/span&gt; args&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;  
        &lt;span class=&quot;token class-name&quot;&gt;Runtime&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;getRuntime&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;addShutdownHook&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token keyword&quot;&gt;new&lt;/span&gt; &lt;span class=&quot;token class-name&quot;&gt;ShutdownThread&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;  
  
        &lt;span class=&quot;token class-name&quot;&gt;Properties&lt;/span&gt; configs &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;token keyword&quot;&gt;new&lt;/span&gt; &lt;span class=&quot;token class-name&quot;&gt;Properties&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;  
        configs&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;put&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token class-name&quot;&gt;ConsumerConfig&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token constant&quot;&gt;BOOTSTRAP_SERVERS_CONFIG&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;token constant&quot;&gt;BOOTSTRAP_SERVERS&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;  
        configs&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;put&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token class-name&quot;&gt;ConsumerConfig&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token constant&quot;&gt;GROUP_ID_CONFIG&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;token constant&quot;&gt;GROUP_ID&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;  
        configs&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;put&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token class-name&quot;&gt;ConsumerConfig&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token constant&quot;&gt;KEY_DESERIALIZER_CLASS_CONFIG&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;token class-name&quot;&gt;StringDeserializer&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token keyword&quot;&gt;class&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;getName&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;  
        configs&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;put&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token class-name&quot;&gt;ConsumerConfig&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token constant&quot;&gt;VALUE_DESERIALIZER_CLASS_CONFIG&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;token class-name&quot;&gt;StringDeserializer&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token keyword&quot;&gt;class&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;getName&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;  
        configs&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;put&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token class-name&quot;&gt;ConsumerConfig&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token constant&quot;&gt;ENABLE_AUTO_COMMIT_CONFIG&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;token boolean&quot;&gt;false&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;  
  
        consumer &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;token keyword&quot;&gt;new&lt;/span&gt; &lt;span class=&quot;token class-name&quot;&gt;KafkaConsumer&lt;/span&gt;&lt;span class=&quot;token generics&quot;&gt;&lt;span class=&quot;token punctuation&quot;&gt;&amp;lt;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;configs&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;  
        consumer&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;subscribe&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token class-name&quot;&gt;Arrays&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;asList&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token constant&quot;&gt;TOPIC_NAME&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;  
  
        &lt;span class=&quot;token keyword&quot;&gt;try&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;
            &lt;span class=&quot;token keyword&quot;&gt;while&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token boolean&quot;&gt;true&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;  
                &lt;span class=&quot;token class-name&quot;&gt;ConsumerRecords&lt;/span&gt;&lt;span class=&quot;token generics&quot;&gt;&lt;span class=&quot;token punctuation&quot;&gt;&amp;lt;&lt;/span&gt;&lt;span class=&quot;token class-name&quot;&gt;String&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;token class-name&quot;&gt;String&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;&gt;&lt;/span&gt;&lt;/span&gt; records &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; consumer&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;poll&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token class-name&quot;&gt;Duration&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;ofSeconds&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token number&quot;&gt;1&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;  
                &lt;span class=&quot;token keyword&quot;&gt;for&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token class-name&quot;&gt;ConsumerRecord&lt;/span&gt;&lt;span class=&quot;token generics&quot;&gt;&lt;span class=&quot;token punctuation&quot;&gt;&amp;lt;&lt;/span&gt;&lt;span class=&quot;token class-name&quot;&gt;String&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;token class-name&quot;&gt;String&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;&gt;&lt;/span&gt;&lt;/span&gt; record &lt;span class=&quot;token operator&quot;&gt;:&lt;/span&gt; records&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;  
                    logger&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;info&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token string&quot;&gt;&quot;{}&quot;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; record&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;  
                &lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;  
                consumer&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;commitSync&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;  
            &lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;  
        &lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt; &lt;span class=&quot;token keyword&quot;&gt;catch&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token class-name&quot;&gt;WakeupException&lt;/span&gt; e&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;  
            logger&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;warn&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token string&quot;&gt;&quot;Wakeup consumer&quot;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;  
        &lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt; &lt;span class=&quot;token keyword&quot;&gt;finally&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;  
            logger&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;warn&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token string&quot;&gt;&quot;Consumer close&quot;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;  
            consumer&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;close&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;  
        &lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;  
    &lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;  

	&lt;span class=&quot;token comment&quot;&gt;// ShutdownThread를 사용하여 종료 시 트리거되는 훅을 extend 해야 한다.&lt;/span&gt;
    &lt;span class=&quot;token keyword&quot;&gt;static&lt;/span&gt; &lt;span class=&quot;token keyword&quot;&gt;class&lt;/span&gt; &lt;span class=&quot;token class-name&quot;&gt;ShutdownThread&lt;/span&gt; &lt;span class=&quot;token keyword&quot;&gt;extends&lt;/span&gt; &lt;span class=&quot;token class-name&quot;&gt;Thread&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;  
        &lt;span class=&quot;token keyword&quot;&gt;public&lt;/span&gt; &lt;span class=&quot;token keyword&quot;&gt;void&lt;/span&gt; &lt;span class=&quot;token function&quot;&gt;run&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;  
            logger&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;info&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token string&quot;&gt;&quot;Shutdown hook&quot;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;  
            consumer&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;wakeup&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;  
        &lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;  
    &lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;  
&lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;ul&gt;
&lt;li&gt;컨슈머 역시 안전하게 종료되어야 한다. 정상적으로 종료되지 않은 컨슈머는 세션 타임아웃이 발생할 때 까지 컨슈머 그룹에 남게 된다. 컨슈머를 안전하게 종료하기 위해서는 KafkaConsumer 클래스는 &lt;code class=&quot;language-text&quot;&gt;wakeup()&lt;/code&gt; 메서드를 지원한다. &lt;code class=&quot;language-text&quot;&gt;wakeup()&lt;/code&gt; 메서드를 사용하여 KafkaConsumer 인스턴스를 안전하게 종료할 수 있다. &lt;code class=&quot;language-text&quot;&gt;wakeup()&lt;/code&gt; 메서드가 호출 된 이후 &lt;code class=&quot;language-text&quot;&gt;poll()&lt;/code&gt; 이 호출되면 &lt;code class=&quot;language-text&quot;&gt;WakeupException&lt;/code&gt; 예외가 발생하게 된다. 이 예외가 발생한 뒤 데이터 처리를 위해 사용된 자원을 해제하면 된다.&lt;/li&gt;
&lt;li&gt;런타임에서 훅을 지정하기 위해서는 &lt;code class=&quot;language-text&quot;&gt;Runtime.getRuntime().addShutdownHook(new ShutdownThread());&lt;/code&gt; 부분과 같이 설정할 수 있다.&lt;/li&gt;
&lt;li&gt;실행된 프로세스를 강제로 종료하면 아래와 같은 로그가 발생함을 확인할 수 있다.&lt;/li&gt;
&lt;/ul&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;sh&quot;&gt;&lt;pre class=&quot;language-sh&quot;&gt;&lt;code class=&quot;language-sh&quot;&gt;&lt;span class=&quot;token function&quot;&gt;kill&lt;/span&gt; &lt;span class=&quot;token parameter variable&quot;&gt;-term&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;프로세스 ID&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;text&quot;&gt;&lt;pre class=&quot;language-text&quot;&gt;&lt;code class=&quot;language-text&quot;&gt;[main] INFO org.apache.kafka.clients.consumer.internals.ConsumerRebalanceListenerInvoker - [Consumer clientId=consumer-test-group-1, groupId=test-group] Adding newly assigned partitions: 
[Thread-0] INFO com.example.ConsumerWithSyncOffsetCommit - Shutdown hook
[main] WARN com.example.ConsumerWithSyncOffsetCommit - Wakeup consumer
[main] WARN com.example.ConsumerWithSyncOffsetCommit - Consumer close&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;/br&gt;
&lt;h2&gt;6-2-6) 멀티스레드 컨슈머 애플리케이션&lt;/h2&gt;
&lt;ul&gt;
&lt;li&gt;기본적으로 카프카 컨슈머는 스레드 한개당 하나씩만 할당된다. 카프카 처리량을 늘리기 위해서는 파티션과 컨슈머 개수를 늘려야 가능한데, 파티션을 여러개 운영하는 경우 데이터 병렬 처리를 위해 파티션과 컨슈머 개수를 맞추는 것이 좋다. 이를 위해 보통 멀티 스레드를 이용하는데, 하나의 프로세스에 컨슈머 스레드를 여러 개 사용하거나, 한개의 컨슈머 스레드를 갖는 프로세스를 여러 개 띄우는 방법이 있다.&lt;/li&gt;
&lt;li&gt;첫 번째 방식은 스레드 간 에러에 대한 영향이 다른 프로세스에 영향을 주지 않는다. 다만 여러 프로세스를 띄워야 하므로 이에 대한 관리가 복잡해질 수 있다.&lt;/li&gt;
&lt;li&gt;두 번째 방식은 고사양 자원에서 활용할 수 있는데, 비교적 컨슈머에 대한 관리는 편할 수 있다. 다만 스레드에서 발생한 에러가 다른 스레드에도 영향을 끼칠 수 있다.&lt;/li&gt;
&lt;/ul&gt;
&lt;/br&gt;
&lt;div align=&quot;left&quot;&gt;
  &lt;span class=&quot;gatsby-resp-image-wrapper&quot; style=&quot;position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 630px; &quot;&gt;
      &lt;a class=&quot;gatsby-resp-image-link&quot; href=&quot;/static/81c006332a94c3dabace2ebbf6226651/669eb/multi_thread.png&quot; style=&quot;display: block&quot; target=&quot;_blank&quot; rel=&quot;noopener&quot;&gt;
    &lt;span class=&quot;gatsby-resp-image-background-image&quot; style=&quot;padding-bottom: 44.30379746835443%; position: relative; bottom: 0; left: 0; background-image: url(&apos;data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAJCAYAAAAywQxIAAAACXBIWXMAABYlAAAWJQFJUiTwAAABuUlEQVR42nVSR4uqQRD8/rtHT7K7mHNWVMw557CrhxURUdFVvCgIimKiHtWwe3sDRc9MT3dXd43SarWQyWRQrVZRKpWQzWZRq9Xwer3wv/V4PLBYLLDdbrHZbAS73Q6TyQRKMpmExWKB2WwWa7PZ8P7+jtVqheVyiXa7jUajARZuNpsYj8c4n88ol8tCpFAoIJ/Po1gsolKpQCErh8MBjUYDrVYLr9crjy6XiyQKBoPweDxwu92yJ/b7vRAwGo0IBALit9vtiEQiUNLpNFwuF2KxGMLhsDz4+PjAz88POp2O3POOvkQiIefD4QCn0ylJQqEQ/H6/FIrH41BI12AwQKVSQa1WS8scw+12w2AwkKoMomUAkx6PR2HFzliAPhblXsnlctLOL7tf+pxfvV5HNBqFz+cTMICgAOyK7wjOnjn49k+Ut7c36PX6PyeVnE6nsFqtIhKh0+nkB3BRALbNOIKzT6VSUIbDoVA2mUwCjoCzu16vIsx6vZZ50s7ncxHkdDphNpvh6+tLClBY5vn+/obCb9Dr9eRb0EkHz5zT/X7H8/kUS8YE90w4Go3w+fmJfr+PbrcrcSTyDxZJSKfX4W/2AAAAAElFTkSuQmCC&apos;); background-size: cover; display: block;&quot;&gt;&lt;/span&gt;
  &lt;img class=&quot;gatsby-resp-image-image&quot; alt=&quot;multi thread&quot; title=&quot;&quot; src=&quot;/static/81c006332a94c3dabace2ebbf6226651/f058b/multi_thread.png&quot; srcset=&quot;/static/81c006332a94c3dabace2ebbf6226651/c26ae/multi_thread.png 158w,
/static/81c006332a94c3dabace2ebbf6226651/6bdcf/multi_thread.png 315w,
/static/81c006332a94c3dabace2ebbf6226651/f058b/multi_thread.png 630w,
/static/81c006332a94c3dabace2ebbf6226651/40601/multi_thread.png 945w,
/static/81c006332a94c3dabace2ebbf6226651/669eb/multi_thread.png 1244w&quot; sizes=&quot;(max-width: 630px) 100vw, 630px&quot; style=&quot;width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;&quot; loading=&quot;lazy&quot; decoding=&quot;async&quot;&gt;
  &lt;/a&gt;
    &lt;/span&gt;
&lt;/div&gt;
&lt;/br&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;java&quot;&gt;&lt;pre class=&quot;language-java&quot;&gt;&lt;code class=&quot;language-java&quot;&gt;&lt;span class=&quot;token keyword&quot;&gt;package&lt;/span&gt; &lt;span class=&quot;token namespace&quot;&gt;com&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;example&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;  
  
&lt;span class=&quot;token keyword&quot;&gt;import&lt;/span&gt; &lt;span class=&quot;token import&quot;&gt;&lt;span class=&quot;token namespace&quot;&gt;org&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;apache&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;kafka&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;clients&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;consumer&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;/span&gt;&lt;span class=&quot;token class-name&quot;&gt;ConsumerRecord&lt;/span&gt;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;  
&lt;span class=&quot;token keyword&quot;&gt;import&lt;/span&gt; &lt;span class=&quot;token import&quot;&gt;&lt;span class=&quot;token namespace&quot;&gt;org&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;apache&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;kafka&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;clients&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;consumer&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;/span&gt;&lt;span class=&quot;token class-name&quot;&gt;ConsumerRecords&lt;/span&gt;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;  
&lt;span class=&quot;token keyword&quot;&gt;import&lt;/span&gt; &lt;span class=&quot;token import&quot;&gt;&lt;span class=&quot;token namespace&quot;&gt;org&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;apache&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;kafka&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;clients&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;consumer&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;/span&gt;&lt;span class=&quot;token class-name&quot;&gt;KafkaConsumer&lt;/span&gt;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;  
&lt;span class=&quot;token keyword&quot;&gt;import&lt;/span&gt; &lt;span class=&quot;token import&quot;&gt;&lt;span class=&quot;token namespace&quot;&gt;org&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;slf4j&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;/span&gt;&lt;span class=&quot;token class-name&quot;&gt;Logger&lt;/span&gt;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;  
&lt;span class=&quot;token keyword&quot;&gt;import&lt;/span&gt; &lt;span class=&quot;token import&quot;&gt;&lt;span class=&quot;token namespace&quot;&gt;org&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;slf4j&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;/span&gt;&lt;span class=&quot;token class-name&quot;&gt;LoggerFactory&lt;/span&gt;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;  
  
&lt;span class=&quot;token keyword&quot;&gt;import&lt;/span&gt; &lt;span class=&quot;token import&quot;&gt;&lt;span class=&quot;token namespace&quot;&gt;java&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;time&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;/span&gt;&lt;span class=&quot;token class-name&quot;&gt;Duration&lt;/span&gt;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;  
&lt;span class=&quot;token keyword&quot;&gt;import&lt;/span&gt; &lt;span class=&quot;token import&quot;&gt;&lt;span class=&quot;token namespace&quot;&gt;java&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;util&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;/span&gt;&lt;span class=&quot;token class-name&quot;&gt;Arrays&lt;/span&gt;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;  
&lt;span class=&quot;token keyword&quot;&gt;import&lt;/span&gt; &lt;span class=&quot;token import&quot;&gt;&lt;span class=&quot;token namespace&quot;&gt;java&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;util&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;/span&gt;&lt;span class=&quot;token class-name&quot;&gt;Properties&lt;/span&gt;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;  
  
&lt;span class=&quot;token keyword&quot;&gt;public&lt;/span&gt; &lt;span class=&quot;token keyword&quot;&gt;class&lt;/span&gt; &lt;span class=&quot;token class-name&quot;&gt;ConsumerWorker&lt;/span&gt; &lt;span class=&quot;token keyword&quot;&gt;implements&lt;/span&gt; &lt;span class=&quot;token class-name&quot;&gt;Runnable&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;  
    &lt;span class=&quot;token keyword&quot;&gt;private&lt;/span&gt; &lt;span class=&quot;token keyword&quot;&gt;final&lt;/span&gt; &lt;span class=&quot;token keyword&quot;&gt;static&lt;/span&gt; &lt;span class=&quot;token class-name&quot;&gt;Logger&lt;/span&gt; logger &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;token class-name&quot;&gt;LoggerFactory&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;getLogger&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token class-name&quot;&gt;ConsumerWorker&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token keyword&quot;&gt;class&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;  
    &lt;span class=&quot;token keyword&quot;&gt;private&lt;/span&gt; &lt;span class=&quot;token class-name&quot;&gt;Properties&lt;/span&gt; prop&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;  
    &lt;span class=&quot;token keyword&quot;&gt;private&lt;/span&gt; &lt;span class=&quot;token class-name&quot;&gt;String&lt;/span&gt; topic&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;  
    &lt;span class=&quot;token keyword&quot;&gt;private&lt;/span&gt; &lt;span class=&quot;token class-name&quot;&gt;String&lt;/span&gt; threadName&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;  
    &lt;span class=&quot;token keyword&quot;&gt;private&lt;/span&gt; &lt;span class=&quot;token class-name&quot;&gt;KafkaConsumer&lt;/span&gt;&lt;span class=&quot;token generics&quot;&gt;&lt;span class=&quot;token punctuation&quot;&gt;&amp;lt;&lt;/span&gt;&lt;span class=&quot;token class-name&quot;&gt;String&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;token class-name&quot;&gt;String&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;&gt;&lt;/span&gt;&lt;/span&gt; consumer&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;  
  
    &lt;span class=&quot;token class-name&quot;&gt;ConsumerWorker&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token class-name&quot;&gt;Properties&lt;/span&gt; prop&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;token class-name&quot;&gt;String&lt;/span&gt; topic&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;token keyword&quot;&gt;int&lt;/span&gt; number&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;  
        &lt;span class=&quot;token keyword&quot;&gt;this&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;prop &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; prop&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;  
        &lt;span class=&quot;token keyword&quot;&gt;this&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;topic &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; topic&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;  
        &lt;span class=&quot;token keyword&quot;&gt;this&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;threadName &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;token string&quot;&gt;&quot;consumer-thread-&quot;&lt;/span&gt; &lt;span class=&quot;token operator&quot;&gt;+&lt;/span&gt; number&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;  
    &lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;  
  
    &lt;span class=&quot;token annotation punctuation&quot;&gt;@Override&lt;/span&gt;  
    &lt;span class=&quot;token keyword&quot;&gt;public&lt;/span&gt; &lt;span class=&quot;token keyword&quot;&gt;void&lt;/span&gt; &lt;span class=&quot;token function&quot;&gt;run&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;  
        consumer &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;token keyword&quot;&gt;new&lt;/span&gt; &lt;span class=&quot;token class-name&quot;&gt;KafkaConsumer&lt;/span&gt;&lt;span class=&quot;token generics&quot;&gt;&lt;span class=&quot;token punctuation&quot;&gt;&amp;lt;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;prop&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;  
        consumer&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;subscribe&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token class-name&quot;&gt;Arrays&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;asList&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;topic&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;  
        &lt;span class=&quot;token keyword&quot;&gt;while&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token boolean&quot;&gt;true&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;  
            &lt;span class=&quot;token class-name&quot;&gt;ConsumerRecords&lt;/span&gt;&lt;span class=&quot;token generics&quot;&gt;&lt;span class=&quot;token punctuation&quot;&gt;&amp;lt;&lt;/span&gt;&lt;span class=&quot;token class-name&quot;&gt;String&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;token class-name&quot;&gt;String&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;&gt;&lt;/span&gt;&lt;/span&gt; records &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; consumer&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;poll&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token class-name&quot;&gt;Duration&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;ofSeconds&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token number&quot;&gt;1&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;  
            &lt;span class=&quot;token keyword&quot;&gt;for&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token class-name&quot;&gt;ConsumerRecord&lt;/span&gt;&lt;span class=&quot;token generics&quot;&gt;&lt;span class=&quot;token punctuation&quot;&gt;&amp;lt;&lt;/span&gt;&lt;span class=&quot;token class-name&quot;&gt;String&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;token class-name&quot;&gt;String&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;&gt;&lt;/span&gt;&lt;/span&gt; record &lt;span class=&quot;token operator&quot;&gt;:&lt;/span&gt; records&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;  
                logger&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;info&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token string&quot;&gt;&quot;{}&quot;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; record&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;  
            &lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;  
            consumer&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;commitSync&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;  
        &lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;  
    &lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;  
&lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;java&quot;&gt;&lt;pre class=&quot;language-java&quot;&gt;&lt;code class=&quot;language-java&quot;&gt;&lt;span class=&quot;token keyword&quot;&gt;public&lt;/span&gt; &lt;span class=&quot;token keyword&quot;&gt;class&lt;/span&gt; &lt;span class=&quot;token class-name&quot;&gt;MultiConsumerThread&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;  
  
    &lt;span class=&quot;token keyword&quot;&gt;private&lt;/span&gt; &lt;span class=&quot;token keyword&quot;&gt;final&lt;/span&gt; &lt;span class=&quot;token keyword&quot;&gt;static&lt;/span&gt; &lt;span class=&quot;token class-name&quot;&gt;String&lt;/span&gt; &lt;span class=&quot;token constant&quot;&gt;TOPIC_NAME&lt;/span&gt; &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;token string&quot;&gt;&quot;test&quot;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;  
    &lt;span class=&quot;token keyword&quot;&gt;private&lt;/span&gt; &lt;span class=&quot;token keyword&quot;&gt;final&lt;/span&gt; &lt;span class=&quot;token keyword&quot;&gt;static&lt;/span&gt; &lt;span class=&quot;token class-name&quot;&gt;String&lt;/span&gt; &lt;span class=&quot;token constant&quot;&gt;BOOTSTRAP_SERVERS&lt;/span&gt; &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;token string&quot;&gt;&quot;my-kafka:19092&quot;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;  
    &lt;span class=&quot;token keyword&quot;&gt;private&lt;/span&gt; &lt;span class=&quot;token keyword&quot;&gt;final&lt;/span&gt; &lt;span class=&quot;token keyword&quot;&gt;static&lt;/span&gt; &lt;span class=&quot;token class-name&quot;&gt;String&lt;/span&gt; &lt;span class=&quot;token constant&quot;&gt;GROUP_ID&lt;/span&gt; &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;token string&quot;&gt;&quot;test-group&quot;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;  
    &lt;span class=&quot;token keyword&quot;&gt;private&lt;/span&gt; &lt;span class=&quot;token keyword&quot;&gt;final&lt;/span&gt; &lt;span class=&quot;token keyword&quot;&gt;static&lt;/span&gt; &lt;span class=&quot;token keyword&quot;&gt;int&lt;/span&gt; &lt;span class=&quot;token constant&quot;&gt;CONSUMER_COUNT&lt;/span&gt; &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;token number&quot;&gt;3&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;  
  
    &lt;span class=&quot;token keyword&quot;&gt;public&lt;/span&gt; &lt;span class=&quot;token keyword&quot;&gt;static&lt;/span&gt; &lt;span class=&quot;token keyword&quot;&gt;void&lt;/span&gt; &lt;span class=&quot;token function&quot;&gt;main&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token class-name&quot;&gt;String&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;[&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;]&lt;/span&gt; args&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;  
        &lt;span class=&quot;token class-name&quot;&gt;Properties&lt;/span&gt; configs &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;token keyword&quot;&gt;new&lt;/span&gt; &lt;span class=&quot;token class-name&quot;&gt;Properties&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;  
        configs&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;put&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token class-name&quot;&gt;ConsumerConfig&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token constant&quot;&gt;BOOTSTRAP_SERVERS_CONFIG&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;token constant&quot;&gt;BOOTSTRAP_SERVERS&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;  
        configs&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;put&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token class-name&quot;&gt;ConsumerConfig&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token constant&quot;&gt;GROUP_ID_CONFIG&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;token constant&quot;&gt;GROUP_ID&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;  
        configs&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;put&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token class-name&quot;&gt;ConsumerConfig&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token constant&quot;&gt;KEY_DESERIALIZER_CLASS_CONFIG&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;token class-name&quot;&gt;StringDeserializer&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token keyword&quot;&gt;class&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;getName&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;  
        configs&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;put&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token class-name&quot;&gt;ConsumerConfig&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token constant&quot;&gt;VALUE_DESERIALIZER_CLASS_CONFIG&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;token class-name&quot;&gt;StringDeserializer&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token keyword&quot;&gt;class&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;getName&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;  
  
        &lt;span class=&quot;token class-name&quot;&gt;ExecutorService&lt;/span&gt; executorService &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;token class-name&quot;&gt;Executors&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;newCachedThreadPool&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;  
        &lt;span class=&quot;token keyword&quot;&gt;for&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token keyword&quot;&gt;int&lt;/span&gt; i &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;token number&quot;&gt;0&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt; i &lt;span class=&quot;token operator&quot;&gt;&amp;lt;&lt;/span&gt; &lt;span class=&quot;token constant&quot;&gt;CONSUMER_COUNT&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt; i&lt;span class=&quot;token operator&quot;&gt;++&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;  
            &lt;span class=&quot;token class-name&quot;&gt;ConsumerWorker&lt;/span&gt; worker &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;token keyword&quot;&gt;new&lt;/span&gt; &lt;span class=&quot;token class-name&quot;&gt;ConsumerWorker&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;configs&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;token constant&quot;&gt;TOPIC_NAME&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; i&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;  
            executorService&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;execute&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;worker&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;  
        &lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;  
    &lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;  
&lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;</content:encoded></item><item><title><![CDATA[6-1) 컨슈머]]></title><description><![CDATA[6-1-1) 카프카 컨슈머 소개 카프카 프로듀서가 전송한 데이터는 카프카 브로커에 적재된다. 컨슈머에 적재된 데이터를 사용하기 위해 브로커로부터 데이터를 가져와서 필요한 처리를 한다. 6-1-2) 컨슈머 내부 구조 (Java 라이브러리) Fetcher…]]></description><link>https://github.com/SiverPineValley/SiverPineValley.github.io/kafka/kafka_6_1/</link><guid isPermaLink="false">https://github.com/SiverPineValley/SiverPineValley.github.io/kafka/kafka_6_1/</guid><pubDate>Thu, 11 Jan 2024 16:00:00 GMT</pubDate><content:encoded>&lt;h2&gt;6-1-1) 카프카 컨슈머 소개&lt;/h2&gt;
&lt;ul&gt;
&lt;li&gt;카프카 프로듀서가 전송한 데이터는 카프카 브로커에 적재된다. 컨슈머에 적재된 데이터를 사용하기 위해 브로커로부터 데이터를 가져와서 필요한 처리를 한다.&lt;/li&gt;
&lt;/ul&gt;
&lt;/br&gt;
&lt;h2&gt;6-1-2) 컨슈머 내부 구조 (Java 라이브러리)&lt;/h2&gt;
&lt;div align=&quot;left&quot;&gt;
  &lt;span class=&quot;gatsby-resp-image-wrapper&quot; style=&quot;position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 630px; &quot;&gt;
      &lt;a class=&quot;gatsby-resp-image-link&quot; href=&quot;/static/1505f80eb4dc814a2155e46f315aadb9/6f278/%EC%8A%A4%ED%81%AC%EB%A6%B0%EC%83%B7%202025-01-11%20%EC%98%A4%ED%9B%84%202.50.08.png&quot; style=&quot;display: block&quot; target=&quot;_blank&quot; rel=&quot;noopener&quot;&gt;
    &lt;span class=&quot;gatsby-resp-image-background-image&quot; style=&quot;padding-bottom: 39.24050632911392%; position: relative; bottom: 0; left: 0; background-image: url(&apos;data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAICAYAAAD5nd/tAAAACXBIWXMAABYlAAAWJQFJUiTwAAABZElEQVR42l1SyarCQBCcfxbiVbxE8Oq+IMYFRTQq7qJxQVQED4LeBX9CXEqqIIH3BoqemfRUV3XHfD4fEO/3G1zn8xndbhfD4RCDwQCTyQTj8Vh7YjQa6fwfvJ/NZjAk+36/ASEJqtUqrteryJnseZ7Oh8MB2WwWtVoNjuOgXC4H4LlYLMLcbjf0+330ej1cLhes12vtj8cjdrudyDabDfb7vQrkcjk9JAGJfVBEqVSCWa1WCIVCCIfDqNfrukwkEoGy5XKpyDxG27aVm06n9c1vDZFMJmHo27IsRCIRNJtNWa5UKpjP51K7WCxEtt1uFQuFghRRJe1nMhkhlUopmsfjISun0wn3+12PKJ9tYHWCRabTqe7ooNVqqXij0fgDvjOv10tD4XC4qIyVqID9yufziMViiEajckHQdjweD4bhQ0PhdEn6fD5FSKWszsHw92Fkb9kGgpZ9ok6nA9d1hXa7LQc/R9byCgCr6wgAAAAASUVORK5CYII=&apos;); background-size: cover; display: block;&quot;&gt;&lt;/span&gt;
  &lt;img class=&quot;gatsby-resp-image-image&quot; alt=&quot;     2025 01 11    2 50 08&quot; title=&quot;&quot; src=&quot;/static/1505f80eb4dc814a2155e46f315aadb9/f058b/%EC%8A%A4%ED%81%AC%EB%A6%B0%EC%83%B7%202025-01-11%20%EC%98%A4%ED%9B%84%202.50.08.png&quot; srcset=&quot;/static/1505f80eb4dc814a2155e46f315aadb9/c26ae/%EC%8A%A4%ED%81%AC%EB%A6%B0%EC%83%B7%202025-01-11%20%EC%98%A4%ED%9B%84%202.50.08.png 158w,
/static/1505f80eb4dc814a2155e46f315aadb9/6bdcf/%EC%8A%A4%ED%81%AC%EB%A6%B0%EC%83%B7%202025-01-11%20%EC%98%A4%ED%9B%84%202.50.08.png 315w,
/static/1505f80eb4dc814a2155e46f315aadb9/f058b/%EC%8A%A4%ED%81%AC%EB%A6%B0%EC%83%B7%202025-01-11%20%EC%98%A4%ED%9B%84%202.50.08.png 630w,
/static/1505f80eb4dc814a2155e46f315aadb9/40601/%EC%8A%A4%ED%81%AC%EB%A6%B0%EC%83%B7%202025-01-11%20%EC%98%A4%ED%9B%84%202.50.08.png 945w,
/static/1505f80eb4dc814a2155e46f315aadb9/78612/%EC%8A%A4%ED%81%AC%EB%A6%B0%EC%83%B7%202025-01-11%20%EC%98%A4%ED%9B%84%202.50.08.png 1260w,
/static/1505f80eb4dc814a2155e46f315aadb9/6f278/%EC%8A%A4%ED%81%AC%EB%A6%B0%EC%83%B7%202025-01-11%20%EC%98%A4%ED%9B%84%202.50.08.png 1488w&quot; sizes=&quot;(max-width: 630px) 100vw, 630px&quot; style=&quot;width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;&quot; loading=&quot;lazy&quot; decoding=&quot;async&quot;&gt;
  &lt;/a&gt;
    &lt;/span&gt;
&lt;/div&gt;
&lt;ul&gt;
&lt;li&gt;&lt;strong&gt;Fetcher&lt;/strong&gt;: 리더 파티션으로 부터 데이터를 미리 가져와서 대기&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;poll()&lt;/strong&gt;: Fetcher에 있는 레코드들을 리턴하는 레코드.&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;ConsumerRecords&lt;/strong&gt;: 처리하고자 하는 레코드들의 모임. 오프셋이 포함되어 있다.&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;Commit&lt;/strong&gt;: 특정 레코드를 처리하였는지에 대한 여부.&lt;/li&gt;
&lt;/ul&gt;
&lt;/br&gt;
&lt;h2&gt;6-1-3) 컨슈머 그룹&lt;/h2&gt;
&lt;ul&gt;
&lt;li&gt;컨슈머 그룹은 각기 다른 로직을 가진 애플리케이션(컨슈머)들이 같은 데이터를 처리하고자 할 때 사용하는 운영 방식이다.&lt;/li&gt;
&lt;li&gt;컨슈머 그룹은 컨슈머를 각 컨슈머 그룹으로부터 격리된 환경에서 안전하게 운영할 수 있도록 도와주는 카프카의 독특한 방식이다. 컨슈머 그룹으로 묶인 컨슈머들은 1개 이상의 파티션들에 할당되어 데이터를 가져갈 수 있다. 컨슈머 그룹으로 묶인 컨슈머가 토픽을 구독해서 데이터를 가져갈 때 1개의 파티션은 최대 1개의 컨슈머에 할당 가능하다. 그리고 1개의 컨슈머는 여러 파티션에 할당될 수 있다. 이러한 특징으로 컨슈머 그룹의 컨슈머 개수는 가져가고자하는 토픽의 파티션 개수보다 같거나 작아야 한다.&lt;/li&gt;
&lt;li&gt;컨슈머의 개수가 파티션 수보다 많은 경우에는 파티션에 매핑되지 못한 컨슈머들은 유휴상태로 남아 어떠한 컨슈머 로직도 처리하지 않는 불필요한 쓰레드가 된다.&lt;/li&gt;
&lt;/ul&gt;
&lt;/br&gt;
&lt;h3&gt;6-1-3-1) 컨슈머 그룹을 활용하는 이유&lt;/h3&gt;
&lt;ul&gt;
&lt;li&gt;운영 서버의 주요 리소스 (CPU, Memory, Disk)를 모니터링하는 데이터 파이프라인을 구축한다고 하자. 실시간 리소스를 시간순으로 확인하기 위해 데이터를 엘라스틱서치에 저장하고 이와 동시에 대용량 적재를 위해 하둡에 적재할 것이다. 만약 카프카를 사용한 파이프라인이 아닐 경우 서버에서 수행되는 리소스 수집 및 전송 에이전트는 동기 방식으로 요청할 것이다. 이렇게 동기 방식으로 데이터를 적재하는 경우 장애 발생 시 적재가 불가능할 수 있다.&lt;/li&gt;
&lt;li&gt;컨슈머 개수가 파티션 개수보다 많은 경우 최종 적재되는 저장소의 장애에 유연하게 대처하기 위해 다른 저장소에 저장하는 컨슈머를 각기 다른 컨슈머 그룹으로 묶어서 운영할 수 있다. 이러한 방식을 통해 각 데이터 파이프라인을 디커플링하여 운영할 수 있다.&lt;/li&gt;
&lt;/ul&gt;
&lt;/br&gt;
&lt;h2&gt;6-1-4) 리밸런싱&lt;/h2&gt;
&lt;ul&gt;
&lt;li&gt;카프카 컨슈머 그룹의 일부 컨슈머에 장애가 발생하면 장애가 발생한 컨슈머에 할당된 파티션은 장애가 발생하지 않은 컨슈머에 소유권이 넘어간다. 이러한 과정을 리밸런싱(Rebalancing)이라고 한다. 리밸런싱은 크게 두 가지 상황에서 발생한다.&lt;/li&gt;
&lt;/ul&gt;
&lt;ol&gt;
&lt;li&gt;&lt;strong&gt;컨슈머가 추가되는 상황&lt;/strong&gt;&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;컨슈머가 제외되는 상황&lt;/strong&gt;&lt;/li&gt;
&lt;/ol&gt;
&lt;ul&gt;
&lt;li&gt;이러한 리밸런싱은 컨슈머가 데이터를 처리하는 동안 언제든 발생할 수 있으므로, 이에 대응하기 위한 코드를 작성해놓아야 한다. 이를 처리하는 함수를 RebalanceListener라고 한다.&lt;/li&gt;
&lt;/ul&gt;
&lt;/br&gt;
&lt;h2&gt;6-1-5) 커밋&lt;/h2&gt;
&lt;ul&gt;
&lt;li&gt;컨슈머는 카프카 브로커로부터 데이터를 어디까지 가져갔는지 커밋(commit)을 통해 기록한다. 특정 토픽의 파티션을 어떤 컨슈머 그룹이 몇 번째 까지 가져갔는지 카프카 브로커 내부에서 사용되는 내부 토픽 (consumer_offset)에 기록된다. 커밋이 제대로 이루어지지 않으면 중복 처리되는 로직이 발생할 수 있으므로, 컨슈머 로직 처리 후 반드시 커밋이 되어야 한다.&lt;/li&gt;
&lt;/ul&gt;
&lt;/br&gt;
&lt;h2&gt;6-1-6) Assigner&lt;/h2&gt;
&lt;ul&gt;
&lt;li&gt;컨슈머와 파티션 할당 정책은 컨슈머의 Assigner에 의해 발생한다. 카프카에서는 &lt;code class=&quot;language-text&quot;&gt;RangeAssigner&lt;/code&gt;, &lt;code class=&quot;language-text&quot;&gt;RoundRobinAssigner&lt;/code&gt;, &lt;code class=&quot;language-text&quot;&gt;StickyAssigner&lt;/code&gt;를 제공하고 있다.
&lt;code class=&quot;language-text&quot;&gt;RangeAssigner&lt;/code&gt;: 각 토픽에서 파티션을 숫자로 정렬. 컨슈머를 사전 순서로 정렬하여 할당.
&lt;code class=&quot;language-text&quot;&gt;RoundRobinAssigner&lt;/code&gt;: 모든 파티션을 컨슈머에서 번갈아가며 할당.
&lt;code class=&quot;language-text&quot;&gt;StickyAssigner&lt;/code&gt;: 최대한 파티션을 균등하게 분배하면서 할당&lt;/li&gt;
&lt;/ul&gt;
&lt;/br&gt;
&lt;h2&gt;6-1-7) 컨슈머의 주요 옵션&lt;/h2&gt;
&lt;ul&gt;
&lt;li&gt;&lt;code class=&quot;language-text&quot;&gt;bootstrap.servers&lt;/code&gt;: 프로듀서가 데이터를 전송할 대상 카프카 클러스터가 속한 브로커의 호스트:포트를 1개 이상 작성한다.&lt;/li&gt;
&lt;li&gt;&lt;code class=&quot;language-text&quot;&gt;key.deserilaizer&lt;/code&gt;: 레코드의 메시지 키를 역직렬화하는 클래스를 지정한다.&lt;/li&gt;
&lt;li&gt;&lt;code class=&quot;language-text&quot;&gt;value.deserializer&lt;/code&gt;: 레코드의 메시지 값을 역직렬화하는 클래스를 지정한다.&lt;/li&gt;
&lt;/ul&gt;
&lt;/br&gt;
&lt;h3&gt;6-1-7-1) 컨슈머의 선택 옵션&lt;/h3&gt;
&lt;ul&gt;
&lt;li&gt;&lt;code class=&quot;language-text&quot;&gt;group.id&lt;/code&gt;: 컨슈머 그룹 ID를 지정한다. subscribe()로 토픽을 구독하여 사용할 때는 필수적으로 넣어줘야 한다. 기본 값은 null이다.&lt;/li&gt;
&lt;li&gt;&lt;code class=&quot;language-text&quot;&gt;auto.offset.reset&lt;/code&gt;: 컨슈머 그룹이 특정 파티션을 읽을 때 저장된 파티션 오프셋이 없을 때 (커밋이 없는 경우) 어느 오프셋부터 읽을 지 선택하는 값이다. 이미 컨슈머 오프셋이 있다면, 이 옵션은 무시된다. 기본 값은 latest이다.&lt;/li&gt;
&lt;li&gt;&lt;code class=&quot;language-text&quot;&gt;enable.auto.commit&lt;/code&gt;: 자동 커밋으로 할지 수동 커밋으로 할지 지정한다. 기본 값은 true이다.&lt;/li&gt;
&lt;li&gt;&lt;code class=&quot;language-text&quot;&gt;auto.commit.interval.ms&lt;/code&gt;: 자동 커밋일 경우 커밋 간 간격을 지정한다. 기본 값은 5000ms(5초) 이다.&lt;/li&gt;
&lt;li&gt;&lt;code class=&quot;language-text&quot;&gt;max.poll.records&lt;/code&gt;: poll() 메서드를 통해 반환되는 레코드 수를 지정한다. 기본 값은 500이다.&lt;/li&gt;
&lt;li&gt;&lt;code class=&quot;language-text&quot;&gt;session.timeout.ms&lt;/code&gt;: 컨슈머와 브로커 연결이 끊기는 최대 시간이다. 기본 값은 10000ms(10초)이다.&lt;/li&gt;
&lt;li&gt;&lt;code class=&quot;language-text&quot;&gt;heartbeat.interval.ms&lt;/code&gt;: 하트비트를 전송하는 시간 간격이다. 기본 값은 3000ms(3초)이다.&lt;/li&gt;
&lt;li&gt;&lt;code class=&quot;language-text&quot;&gt;max.poll.interval.ms&lt;/code&gt;: poll() 메소드를 호출하는 간격의 최대 시간. 기본 값은 300000ms(5분)이다.&lt;/li&gt;
&lt;li&gt;&lt;code class=&quot;language-text&quot;&gt;isolation.level&lt;/code&gt;: 트랜잭션 프로듀서가 레코드를 트랜잭션 단위로 보낼 경우 사용된다.&lt;/li&gt;
&lt;/ul&gt;
&lt;/br&gt;
&lt;h2&gt;6-1-8) auto.offset.reset&lt;/h2&gt;
&lt;ul&gt;
&lt;li&gt;컨슈머 그룹이 특정 파티션을 읽을 때 저장된 컨슈머의 오프셋이 없을 때 어느 오프셋부터 읽을 지를 설정한다. 이미 컨슈머에 오프셋이 있다면 무시된다. 이 옵션은 latest, earliest, none 중 1개를 설정할 수 있다.&lt;/li&gt;
&lt;li&gt;&lt;code class=&quot;language-text&quot;&gt;latest&lt;/code&gt;: 설정하면 가장 높은 (가장 최근에 넣은) 오프셋부터 읽기 시작한다.&lt;/li&gt;
&lt;li&gt;&lt;code class=&quot;language-text&quot;&gt;earliest&lt;/code&gt;: 설정하면 가장 낮은 (가장 처음에 넣은) 오프셋부터 읽기 시작한다.&lt;/li&gt;
&lt;li&gt;&lt;code class=&quot;language-text&quot;&gt;none&lt;/code&gt;: 설정하면 컨슈머 그룹이 커밋한 기록이 있는지 찾아 본다. 커밋 기록이 없으면 오류를 반환하고, 커밋 기록이 있다면 기존 커밋 기록 오프셋부터 읽기 시작한다. 기본 값은 latest이다.&lt;/li&gt;
&lt;/ul&gt;</content:encoded></item><item><title><![CDATA[5-2) 프로듀서 애플리케이션 개발]]></title><description><![CDATA[5-2-1) java를 이용한 프로듀서 애플리케이션 개발  을 통해 프로듀서의 필수 설정(bootstrap_servers)을 설정한다.  객체 생성 후  함수를 통해 record…]]></description><link>https://github.com/SiverPineValley/SiverPineValley.github.io/kafka/kafka_5_2/</link><guid isPermaLink="false">https://github.com/SiverPineValley/SiverPineValley.github.io/kafka/kafka_5_2/</guid><pubDate>Thu, 11 Jan 2024 15:30:00 GMT</pubDate><content:encoded>&lt;h2&gt;5-2-1) java를 이용한 프로듀서 애플리케이션 개발&lt;/h2&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;gradle&quot;&gt;&lt;pre class=&quot;language-gradle&quot;&gt;&lt;code class=&quot;language-gradle&quot;&gt;&lt;span class=&quot;token keyword&quot;&gt;plugins&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;  
    id &lt;span class=&quot;token string&quot;&gt;&apos;java&apos;&lt;/span&gt;  
&lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;  
  
group &lt;span class=&quot;token string&quot;&gt;&apos;com.example&apos;&lt;/span&gt;  
version &lt;span class=&quot;token string&quot;&gt;&apos;1.0&apos;&lt;/span&gt;  
  
sourceCompatibility &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;token number&quot;&gt;1.8&lt;/span&gt;  
targetCompatibility &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;token number&quot;&gt;1.8&lt;/span&gt;  
  
&lt;span class=&quot;token keyword&quot;&gt;repositories&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;  
    &lt;span class=&quot;token function&quot;&gt;mavenCentral&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;  
&lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;  
  
&lt;span class=&quot;token keyword&quot;&gt;dependencies&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;  
    &lt;span class=&quot;token keyword&quot;&gt;implementation&lt;/span&gt; &lt;span class=&quot;token string&quot;&gt;&apos;org.apache.kafka:kafka-clients:3.9.0&apos;&lt;/span&gt;  
    &lt;span class=&quot;token keyword&quot;&gt;implementation&lt;/span&gt;  &lt;span class=&quot;token string&quot;&gt;&apos;org.slf4j:slf4j-simple:1.7.36&apos;&lt;/span&gt;  
&lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;java&quot;&gt;&lt;pre class=&quot;language-java&quot;&gt;&lt;code class=&quot;language-java&quot;&gt;&lt;span class=&quot;token keyword&quot;&gt;package&lt;/span&gt; &lt;span class=&quot;token namespace&quot;&gt;com&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;example&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;  
  
&lt;span class=&quot;token keyword&quot;&gt;import&lt;/span&gt; &lt;span class=&quot;token import&quot;&gt;&lt;span class=&quot;token namespace&quot;&gt;org&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;apache&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;kafka&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;clients&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;producer&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;/span&gt;&lt;span class=&quot;token class-name&quot;&gt;KafkaProducer&lt;/span&gt;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;  
&lt;span class=&quot;token keyword&quot;&gt;import&lt;/span&gt; &lt;span class=&quot;token import&quot;&gt;&lt;span class=&quot;token namespace&quot;&gt;org&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;apache&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;kafka&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;clients&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;producer&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;/span&gt;&lt;span class=&quot;token class-name&quot;&gt;ProducerConfig&lt;/span&gt;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;  
&lt;span class=&quot;token keyword&quot;&gt;import&lt;/span&gt; &lt;span class=&quot;token import&quot;&gt;&lt;span class=&quot;token namespace&quot;&gt;org&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;apache&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;kafka&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;clients&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;producer&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;/span&gt;&lt;span class=&quot;token class-name&quot;&gt;ProducerRecord&lt;/span&gt;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;  
&lt;span class=&quot;token keyword&quot;&gt;import&lt;/span&gt; &lt;span class=&quot;token import&quot;&gt;&lt;span class=&quot;token namespace&quot;&gt;org&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;apache&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;kafka&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;common&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;serialization&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;/span&gt;&lt;span class=&quot;token class-name&quot;&gt;StringSerializer&lt;/span&gt;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;  
&lt;span class=&quot;token keyword&quot;&gt;import&lt;/span&gt; &lt;span class=&quot;token import&quot;&gt;&lt;span class=&quot;token namespace&quot;&gt;org&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;slf4j&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;/span&gt;&lt;span class=&quot;token class-name&quot;&gt;Logger&lt;/span&gt;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;  
&lt;span class=&quot;token keyword&quot;&gt;import&lt;/span&gt; &lt;span class=&quot;token import&quot;&gt;&lt;span class=&quot;token namespace&quot;&gt;org&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;slf4j&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;/span&gt;&lt;span class=&quot;token class-name&quot;&gt;LoggerFactory&lt;/span&gt;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;  
  
&lt;span class=&quot;token keyword&quot;&gt;import&lt;/span&gt; &lt;span class=&quot;token import&quot;&gt;&lt;span class=&quot;token namespace&quot;&gt;java&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;util&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;/span&gt;&lt;span class=&quot;token class-name&quot;&gt;Properties&lt;/span&gt;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;  
  
&lt;span class=&quot;token keyword&quot;&gt;public&lt;/span&gt; &lt;span class=&quot;token keyword&quot;&gt;class&lt;/span&gt; &lt;span class=&quot;token class-name&quot;&gt;SimpleProducer&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;  
    &lt;span class=&quot;token keyword&quot;&gt;private&lt;/span&gt; &lt;span class=&quot;token keyword&quot;&gt;final&lt;/span&gt; &lt;span class=&quot;token keyword&quot;&gt;static&lt;/span&gt; &lt;span class=&quot;token class-name&quot;&gt;Logger&lt;/span&gt; logger &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;token class-name&quot;&gt;LoggerFactory&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;getLogger&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token class-name&quot;&gt;SimpleProducer&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token keyword&quot;&gt;class&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;  
    &lt;span class=&quot;token keyword&quot;&gt;private&lt;/span&gt; &lt;span class=&quot;token keyword&quot;&gt;final&lt;/span&gt; &lt;span class=&quot;token keyword&quot;&gt;static&lt;/span&gt; &lt;span class=&quot;token class-name&quot;&gt;String&lt;/span&gt; &lt;span class=&quot;token constant&quot;&gt;TOPIC_NAME&lt;/span&gt; &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;token string&quot;&gt;&quot;test&quot;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;  
    &lt;span class=&quot;token keyword&quot;&gt;private&lt;/span&gt; &lt;span class=&quot;token keyword&quot;&gt;final&lt;/span&gt; &lt;span class=&quot;token keyword&quot;&gt;static&lt;/span&gt; &lt;span class=&quot;token class-name&quot;&gt;String&lt;/span&gt; &lt;span class=&quot;token constant&quot;&gt;BOOTSTRAP_SERVERS&lt;/span&gt; &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;token string&quot;&gt;&quot;my-kafka:19092&quot;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;  
  
    &lt;span class=&quot;token keyword&quot;&gt;public&lt;/span&gt; &lt;span class=&quot;token keyword&quot;&gt;static&lt;/span&gt; &lt;span class=&quot;token keyword&quot;&gt;void&lt;/span&gt; &lt;span class=&quot;token function&quot;&gt;main&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token class-name&quot;&gt;String&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;[&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;]&lt;/span&gt; args&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;  
  
        &lt;span class=&quot;token class-name&quot;&gt;Properties&lt;/span&gt; configs &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;token keyword&quot;&gt;new&lt;/span&gt; &lt;span class=&quot;token class-name&quot;&gt;Properties&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;  
        configs&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;put&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token class-name&quot;&gt;ProducerConfig&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token constant&quot;&gt;BOOTSTRAP_SERVERS_CONFIG&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;token constant&quot;&gt;BOOTSTRAP_SERVERS&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;  
        configs&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;put&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token class-name&quot;&gt;ProducerConfig&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token constant&quot;&gt;KEY_SERIALIZER_CLASS_CONFIG&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;token class-name&quot;&gt;StringSerializer&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token keyword&quot;&gt;class&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;getName&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;  
        configs&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;put&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token class-name&quot;&gt;ProducerConfig&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token constant&quot;&gt;VALUE_SERIALIZER_CLASS_CONFIG&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;token class-name&quot;&gt;StringSerializer&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token keyword&quot;&gt;class&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;getName&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;  
  
        &lt;span class=&quot;token class-name&quot;&gt;KafkaProducer&lt;/span&gt;&lt;span class=&quot;token generics&quot;&gt;&lt;span class=&quot;token punctuation&quot;&gt;&amp;lt;&lt;/span&gt;&lt;span class=&quot;token class-name&quot;&gt;String&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;token class-name&quot;&gt;String&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;&gt;&lt;/span&gt;&lt;/span&gt; producer &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;token keyword&quot;&gt;new&lt;/span&gt; &lt;span class=&quot;token class-name&quot;&gt;KafkaProducer&lt;/span&gt;&lt;span class=&quot;token generics&quot;&gt;&lt;span class=&quot;token punctuation&quot;&gt;&amp;lt;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;configs&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;  
  
        &lt;span class=&quot;token class-name&quot;&gt;String&lt;/span&gt; messageValue &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;token string&quot;&gt;&quot;testMessage&quot;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;  
        &lt;span class=&quot;token class-name&quot;&gt;ProducerRecord&lt;/span&gt;&lt;span class=&quot;token generics&quot;&gt;&lt;span class=&quot;token punctuation&quot;&gt;&amp;lt;&lt;/span&gt;&lt;span class=&quot;token class-name&quot;&gt;String&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;token class-name&quot;&gt;String&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;&gt;&lt;/span&gt;&lt;/span&gt; record &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;token keyword&quot;&gt;new&lt;/span&gt; &lt;span class=&quot;token class-name&quot;&gt;ProducerRecord&lt;/span&gt;&lt;span class=&quot;token generics&quot;&gt;&lt;span class=&quot;token punctuation&quot;&gt;&amp;lt;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token constant&quot;&gt;TOPIC_NAME&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; messageValue&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;
        producer&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;send&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;record&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;
        logger&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;info&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token string&quot;&gt;&quot;{}&quot;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; record&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;
        producer&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;flush&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;  
        producer&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;close&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;  
    &lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;  
&lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;ul&gt;
&lt;li&gt;&lt;code class=&quot;language-text&quot;&gt;ProducerConfig&lt;/code&gt; 을 통해 프로듀서의 필수 설정(bootstrap_servers)을 설정한다.&lt;/li&gt;
&lt;li&gt;&lt;code class=&quot;language-text&quot;&gt;KafkaProducer&amp;lt;&gt;&lt;/code&gt; 객체 생성 후 &lt;code class=&quot;language-text&quot;&gt;send()&lt;/code&gt; 함수를 통해 record를 프로듀스 할 수 있다. &lt;code class=&quot;language-text&quot;&gt;flush()&lt;/code&gt; 함수는 배치를 강제로 전송하는 함수이고, &lt;code class=&quot;language-text&quot;&gt;close()&lt;/code&gt;는 프로듀서와의 연결을 종료한다.&lt;/li&gt;
&lt;/ul&gt;
&lt;/br&gt;
&lt;h2&gt;5-2-2) 메시지 키가 존재하는 레코드 프로듀스&lt;/h2&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;java&quot;&gt;&lt;pre class=&quot;language-java&quot;&gt;&lt;code class=&quot;language-java&quot;&gt;&lt;span class=&quot;token class-name&quot;&gt;KafkaProducer&lt;/span&gt;&lt;span class=&quot;token generics&quot;&gt;&lt;span class=&quot;token punctuation&quot;&gt;&amp;lt;&lt;/span&gt;&lt;span class=&quot;token class-name&quot;&gt;String&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;token class-name&quot;&gt;String&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;&gt;&lt;/span&gt;&lt;/span&gt; producer &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;token keyword&quot;&gt;new&lt;/span&gt; &lt;span class=&quot;token class-name&quot;&gt;KafkaProducer&lt;/span&gt;&lt;span class=&quot;token generics&quot;&gt;&lt;span class=&quot;token punctuation&quot;&gt;&amp;lt;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;configs&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;  
  
&lt;span class=&quot;token class-name&quot;&gt;ProducerRecord&lt;/span&gt;&lt;span class=&quot;token generics&quot;&gt;&lt;span class=&quot;token punctuation&quot;&gt;&amp;lt;&lt;/span&gt;&lt;span class=&quot;token class-name&quot;&gt;String&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;token class-name&quot;&gt;String&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;&gt;&lt;/span&gt;&lt;/span&gt; record &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;token keyword&quot;&gt;new&lt;/span&gt; &lt;span class=&quot;token class-name&quot;&gt;ProducerRecord&lt;/span&gt;&lt;span class=&quot;token generics&quot;&gt;&lt;span class=&quot;token punctuation&quot;&gt;&amp;lt;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token constant&quot;&gt;TOPIC_NAME&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;token string&quot;&gt;&quot;Pangyo&quot;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;token string&quot;&gt;&quot;Pangyo&quot;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;  
producer&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;send&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;record&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;  
&lt;span class=&quot;token class-name&quot;&gt;ProducerRecord&lt;/span&gt;&lt;span class=&quot;token generics&quot;&gt;&lt;span class=&quot;token punctuation&quot;&gt;&amp;lt;&lt;/span&gt;&lt;span class=&quot;token class-name&quot;&gt;String&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;token class-name&quot;&gt;String&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;&gt;&lt;/span&gt;&lt;/span&gt; record2 &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;token keyword&quot;&gt;new&lt;/span&gt; &lt;span class=&quot;token class-name&quot;&gt;ProducerRecord&lt;/span&gt;&lt;span class=&quot;token generics&quot;&gt;&lt;span class=&quot;token punctuation&quot;&gt;&amp;lt;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token constant&quot;&gt;TOPIC_NAME&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;token string&quot;&gt;&quot;Busan&quot;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;token string&quot;&gt;&quot;Busan&quot;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;  
producer&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;send&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;record2&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;  
producer&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;flush&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;  
producer&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;close&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;  
&lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;/br&gt;
&lt;ul&gt;
&lt;li&gt;&lt;code class=&quot;language-text&quot;&gt;ProducerRecord&amp;lt;&gt;&lt;/code&gt;를 통해 레코드 생성 시 파라미터를 3개 넣으면 키를 부여할 수 있다.&lt;/li&gt;
&lt;/ul&gt;
&lt;h2&gt;5-2-3) 레코드에 파티션 번호를 지정하여 전송하는 프로듀서&lt;/h2&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;java&quot;&gt;&lt;pre class=&quot;language-java&quot;&gt;&lt;code class=&quot;language-java&quot;&gt;&lt;span class=&quot;token class-name&quot;&gt;KafkaProducer&lt;/span&gt;&lt;span class=&quot;token generics&quot;&gt;&lt;span class=&quot;token punctuation&quot;&gt;&amp;lt;&lt;/span&gt;&lt;span class=&quot;token class-name&quot;&gt;String&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;token class-name&quot;&gt;String&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;&gt;&lt;/span&gt;&lt;/span&gt; producer &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;token keyword&quot;&gt;new&lt;/span&gt; &lt;span class=&quot;token class-name&quot;&gt;KafkaProducer&lt;/span&gt;&lt;span class=&quot;token generics&quot;&gt;&lt;span class=&quot;token punctuation&quot;&gt;&amp;lt;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;configs&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;  

&lt;span class=&quot;token keyword&quot;&gt;int&lt;/span&gt; partitionNo &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;token number&quot;&gt;0&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;  
&lt;span class=&quot;token class-name&quot;&gt;ProducerRecord&lt;/span&gt;&lt;span class=&quot;token generics&quot;&gt;&lt;span class=&quot;token punctuation&quot;&gt;&amp;lt;&lt;/span&gt;&lt;span class=&quot;token class-name&quot;&gt;String&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;token class-name&quot;&gt;String&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;&gt;&lt;/span&gt;&lt;/span&gt; record &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;token keyword&quot;&gt;new&lt;/span&gt; &lt;span class=&quot;token class-name&quot;&gt;ProducerRecord&lt;/span&gt;&lt;span class=&quot;token generics&quot;&gt;&lt;span class=&quot;token punctuation&quot;&gt;&amp;lt;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token constant&quot;&gt;TOPIC_NAME&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; partitionNo&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;token string&quot;&gt;&quot;Pangyo&quot;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;token string&quot;&gt;&quot;Pangyo&quot;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;  
producer&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;send&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;record&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;
producer&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;flush&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;  
producer&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;close&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;ul&gt;
&lt;li&gt;파티션을 지정해서 보내고 싶다면, &lt;code class=&quot;language-text&quot;&gt;ProducerRecord&amp;lt;&gt;&lt;/code&gt;를 통해 레코드 생성 시 토픽명, 파티션 번호, 키, 값 순서대로 넣어서 생성하면 된다.&lt;/li&gt;
&lt;/ul&gt;
&lt;/br&gt;
&lt;h2&gt;5-2-4) 커스텀 파티셔너를 가지는 프로듀서&lt;/h2&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;java&quot;&gt;&lt;pre class=&quot;language-java&quot;&gt;&lt;code class=&quot;language-java&quot;&gt;&lt;span class=&quot;token keyword&quot;&gt;package&lt;/span&gt; &lt;span class=&quot;token namespace&quot;&gt;com&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;example&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;  
  
&lt;span class=&quot;token keyword&quot;&gt;import&lt;/span&gt; &lt;span class=&quot;token import&quot;&gt;&lt;span class=&quot;token namespace&quot;&gt;org&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;apache&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;kafka&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;clients&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;producer&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;/span&gt;&lt;span class=&quot;token class-name&quot;&gt;Partitioner&lt;/span&gt;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;  
&lt;span class=&quot;token keyword&quot;&gt;import&lt;/span&gt; &lt;span class=&quot;token import&quot;&gt;&lt;span class=&quot;token namespace&quot;&gt;org&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;apache&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;kafka&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;common&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;/span&gt;&lt;span class=&quot;token class-name&quot;&gt;Cluster&lt;/span&gt;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;  
&lt;span class=&quot;token keyword&quot;&gt;import&lt;/span&gt; &lt;span class=&quot;token import&quot;&gt;&lt;span class=&quot;token namespace&quot;&gt;org&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;apache&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;kafka&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;common&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;/span&gt;&lt;span class=&quot;token class-name&quot;&gt;InvalidRecordException&lt;/span&gt;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;  
&lt;span class=&quot;token keyword&quot;&gt;import&lt;/span&gt; &lt;span class=&quot;token import&quot;&gt;&lt;span class=&quot;token namespace&quot;&gt;org&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;apache&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;kafka&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;common&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;/span&gt;&lt;span class=&quot;token class-name&quot;&gt;PartitionInfo&lt;/span&gt;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;  
&lt;span class=&quot;token keyword&quot;&gt;import&lt;/span&gt; &lt;span class=&quot;token import&quot;&gt;&lt;span class=&quot;token namespace&quot;&gt;org&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;apache&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;kafka&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;common&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;utils&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;/span&gt;&lt;span class=&quot;token class-name&quot;&gt;Utils&lt;/span&gt;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;  
  
&lt;span class=&quot;token keyword&quot;&gt;import&lt;/span&gt; &lt;span class=&quot;token import&quot;&gt;&lt;span class=&quot;token namespace&quot;&gt;java&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;util&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;/span&gt;&lt;span class=&quot;token class-name&quot;&gt;List&lt;/span&gt;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;  
&lt;span class=&quot;token keyword&quot;&gt;import&lt;/span&gt; &lt;span class=&quot;token import&quot;&gt;&lt;span class=&quot;token namespace&quot;&gt;java&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;util&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;/span&gt;&lt;span class=&quot;token class-name&quot;&gt;Map&lt;/span&gt;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;  
  
&lt;span class=&quot;token keyword&quot;&gt;public&lt;/span&gt; &lt;span class=&quot;token keyword&quot;&gt;class&lt;/span&gt; &lt;span class=&quot;token class-name&quot;&gt;CustomPartitioner&lt;/span&gt;  &lt;span class=&quot;token keyword&quot;&gt;implements&lt;/span&gt; &lt;span class=&quot;token class-name&quot;&gt;Partitioner&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;  
  
    &lt;span class=&quot;token annotation punctuation&quot;&gt;@Override&lt;/span&gt;  
    &lt;span class=&quot;token keyword&quot;&gt;public&lt;/span&gt; &lt;span class=&quot;token keyword&quot;&gt;int&lt;/span&gt; &lt;span class=&quot;token function&quot;&gt;partition&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token class-name&quot;&gt;String&lt;/span&gt; topic&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;token class-name&quot;&gt;Object&lt;/span&gt; key&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;token keyword&quot;&gt;byte&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;[&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;]&lt;/span&gt; keyBytes&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;token class-name&quot;&gt;Object&lt;/span&gt; value&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;token keyword&quot;&gt;byte&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;[&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;]&lt;/span&gt; valueBytes&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt;  
                         &lt;span class=&quot;token class-name&quot;&gt;Cluster&lt;/span&gt; cluster&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;  
  
        &lt;span class=&quot;token keyword&quot;&gt;if&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;keyBytes &lt;span class=&quot;token operator&quot;&gt;==&lt;/span&gt; &lt;span class=&quot;token keyword&quot;&gt;null&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;  
            &lt;span class=&quot;token keyword&quot;&gt;throw&lt;/span&gt; &lt;span class=&quot;token keyword&quot;&gt;new&lt;/span&gt; &lt;span class=&quot;token class-name&quot;&gt;InvalidRecordException&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token string&quot;&gt;&quot;Need message key&quot;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;  
        &lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;  

		&lt;span class=&quot;token comment&quot;&gt;// Pangyo 키를 가지면 파티션을 0으로 보냄&lt;/span&gt;
        &lt;span class=&quot;token keyword&quot;&gt;if&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token class-name&quot;&gt;String&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;key&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;equals&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token string&quot;&gt;&quot;Pangyo&quot;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;  
            &lt;span class=&quot;token keyword&quot;&gt;return&lt;/span&gt; &lt;span class=&quot;token number&quot;&gt;0&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;  

		&lt;span class=&quot;token comment&quot;&gt;// 그 외에는 해시 값대로 전송&lt;/span&gt;
        &lt;span class=&quot;token class-name&quot;&gt;List&lt;/span&gt;&lt;span class=&quot;token generics&quot;&gt;&lt;span class=&quot;token punctuation&quot;&gt;&amp;lt;&lt;/span&gt;&lt;span class=&quot;token class-name&quot;&gt;PartitionInfo&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;&gt;&lt;/span&gt;&lt;/span&gt; partitions &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; cluster&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;partitionsForTopic&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;topic&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;  
        &lt;span class=&quot;token keyword&quot;&gt;int&lt;/span&gt; numPartitions &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; partitions&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;size&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;  
        &lt;span class=&quot;token keyword&quot;&gt;return&lt;/span&gt; &lt;span class=&quot;token class-name&quot;&gt;Utils&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;toPositive&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token class-name&quot;&gt;Utils&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;murmur2&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;keyBytes&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;token operator&quot;&gt;%&lt;/span&gt; numPartitions&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;  
    &lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;  
  
  
    &lt;span class=&quot;token annotation punctuation&quot;&gt;@Override&lt;/span&gt;  
    &lt;span class=&quot;token keyword&quot;&gt;public&lt;/span&gt; &lt;span class=&quot;token keyword&quot;&gt;void&lt;/span&gt; &lt;span class=&quot;token function&quot;&gt;configure&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token class-name&quot;&gt;Map&lt;/span&gt;&lt;span class=&quot;token generics&quot;&gt;&lt;span class=&quot;token punctuation&quot;&gt;&amp;lt;&lt;/span&gt;&lt;span class=&quot;token class-name&quot;&gt;String&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;token operator&quot;&gt;?&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;&gt;&lt;/span&gt;&lt;/span&gt; configs&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;  
  
    &lt;span class=&quot;token annotation punctuation&quot;&gt;@Override&lt;/span&gt;  
    &lt;span class=&quot;token keyword&quot;&gt;public&lt;/span&gt; &lt;span class=&quot;token keyword&quot;&gt;void&lt;/span&gt; &lt;span class=&quot;token function&quot;&gt;close&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;  
&lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;java&quot;&gt;&lt;pre class=&quot;language-java&quot;&gt;&lt;code class=&quot;language-java&quot;&gt;&lt;span class=&quot;token keyword&quot;&gt;public&lt;/span&gt; &lt;span class=&quot;token keyword&quot;&gt;static&lt;/span&gt; &lt;span class=&quot;token keyword&quot;&gt;void&lt;/span&gt; &lt;span class=&quot;token function&quot;&gt;main&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token class-name&quot;&gt;String&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;[&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;]&lt;/span&gt; args&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;  
  
    &lt;span class=&quot;token class-name&quot;&gt;Properties&lt;/span&gt; configs &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;token keyword&quot;&gt;new&lt;/span&gt; &lt;span class=&quot;token class-name&quot;&gt;Properties&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;  
    configs&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;put&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token class-name&quot;&gt;ProducerConfig&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token constant&quot;&gt;BOOTSTRAP_SERVERS_CONFIG&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;token constant&quot;&gt;BOOTSTRAP_SERVERS&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;  
    configs&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;put&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token class-name&quot;&gt;ProducerConfig&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token constant&quot;&gt;KEY_SERIALIZER_CLASS_CONFIG&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;token class-name&quot;&gt;StringSerializer&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token keyword&quot;&gt;class&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;getName&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;  
    configs&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;put&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token class-name&quot;&gt;ProducerConfig&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token constant&quot;&gt;VALUE_SERIALIZER_CLASS_CONFIG&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;token class-name&quot;&gt;StringSerializer&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token keyword&quot;&gt;class&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;getName&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;  
    configs&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;put&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token class-name&quot;&gt;ProducerConfig&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token constant&quot;&gt;PARTITIONER_CLASS_CONFIG&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;token class-name&quot;&gt;CustomPartitioner&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token keyword&quot;&gt;class&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;  
  
    &lt;span class=&quot;token class-name&quot;&gt;KafkaProducer&lt;/span&gt;&lt;span class=&quot;token generics&quot;&gt;&lt;span class=&quot;token punctuation&quot;&gt;&amp;lt;&lt;/span&gt;&lt;span class=&quot;token class-name&quot;&gt;String&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;token class-name&quot;&gt;String&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;&gt;&lt;/span&gt;&lt;/span&gt; producer &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;token keyword&quot;&gt;new&lt;/span&gt; &lt;span class=&quot;token class-name&quot;&gt;KafkaProducer&lt;/span&gt;&lt;span class=&quot;token generics&quot;&gt;&lt;span class=&quot;token punctuation&quot;&gt;&amp;lt;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;configs&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;  
  
    &lt;span class=&quot;token class-name&quot;&gt;ProducerRecord&lt;/span&gt;&lt;span class=&quot;token generics&quot;&gt;&lt;span class=&quot;token punctuation&quot;&gt;&amp;lt;&lt;/span&gt;&lt;span class=&quot;token class-name&quot;&gt;String&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;token class-name&quot;&gt;String&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;&gt;&lt;/span&gt;&lt;/span&gt; record &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;token keyword&quot;&gt;new&lt;/span&gt; &lt;span class=&quot;token class-name&quot;&gt;ProducerRecord&lt;/span&gt;&lt;span class=&quot;token generics&quot;&gt;&lt;span class=&quot;token punctuation&quot;&gt;&amp;lt;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token constant&quot;&gt;TOPIC_NAME&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;token string&quot;&gt;&quot;Pangyo&quot;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;token string&quot;&gt;&quot;Pangyo&quot;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;  
    producer&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;send&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;record&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;  
    producer&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;flush&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;  
    producer&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;close&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;  
&lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;ul&gt;
&lt;li&gt;프로듀서 사용 환경에 따라 특정 데이터를 가지는 레코드를 특정 파티션에만 프로듀스해야할 필요가 있다. 이런 경우를 위해 커스텀 파티셔너를 설정할 수 있다. &lt;code class=&quot;language-text&quot;&gt;PARTITIONER_CLASS_CONFIG&lt;/code&gt; 설정에 특정 파티셔너 클래스를 지정함으로써 설정 가능하다.&lt;/li&gt;
&lt;/ul&gt;
&lt;/br&gt;
&lt;h2&gt;5-2-5) 레코드 전송 결과를 확인하는 프로듀서 애플리케이션&lt;/h2&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;java&quot;&gt;&lt;pre class=&quot;language-java&quot;&gt;&lt;code class=&quot;language-java&quot;&gt;&lt;span class=&quot;token keyword&quot;&gt;public&lt;/span&gt; &lt;span class=&quot;token keyword&quot;&gt;static&lt;/span&gt; &lt;span class=&quot;token keyword&quot;&gt;void&lt;/span&gt; &lt;span class=&quot;token function&quot;&gt;main&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token class-name&quot;&gt;String&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;[&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;]&lt;/span&gt; args&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;  
  
    &lt;span class=&quot;token class-name&quot;&gt;Properties&lt;/span&gt; configs &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;token keyword&quot;&gt;new&lt;/span&gt; &lt;span class=&quot;token class-name&quot;&gt;Properties&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;  
    configs&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;put&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token class-name&quot;&gt;ProducerConfig&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token constant&quot;&gt;BOOTSTRAP_SERVERS_CONFIG&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;token constant&quot;&gt;BOOTSTRAP_SERVERS&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;  
    configs&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;put&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token class-name&quot;&gt;ProducerConfig&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token constant&quot;&gt;KEY_SERIALIZER_CLASS_CONFIG&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;token class-name&quot;&gt;StringSerializer&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token keyword&quot;&gt;class&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;getName&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;  
    configs&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;put&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token class-name&quot;&gt;ProducerConfig&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token constant&quot;&gt;VALUE_SERIALIZER_CLASS_CONFIG&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;token class-name&quot;&gt;StringSerializer&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token keyword&quot;&gt;class&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;getName&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;  
    &lt;span class=&quot;token comment&quot;&gt;//configs.put(ProducerConfig.ACKS_CONFIG, &quot;0&quot;);  &lt;/span&gt;
  
    &lt;span class=&quot;token class-name&quot;&gt;KafkaProducer&lt;/span&gt;&lt;span class=&quot;token generics&quot;&gt;&lt;span class=&quot;token punctuation&quot;&gt;&amp;lt;&lt;/span&gt;&lt;span class=&quot;token class-name&quot;&gt;String&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;token class-name&quot;&gt;String&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;&gt;&lt;/span&gt;&lt;/span&gt; producer &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;token keyword&quot;&gt;new&lt;/span&gt; &lt;span class=&quot;token class-name&quot;&gt;KafkaProducer&lt;/span&gt;&lt;span class=&quot;token generics&quot;&gt;&lt;span class=&quot;token punctuation&quot;&gt;&amp;lt;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;configs&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;  
  
    &lt;span class=&quot;token class-name&quot;&gt;ProducerRecord&lt;/span&gt;&lt;span class=&quot;token generics&quot;&gt;&lt;span class=&quot;token punctuation&quot;&gt;&amp;lt;&lt;/span&gt;&lt;span class=&quot;token class-name&quot;&gt;String&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;token class-name&quot;&gt;String&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;&gt;&lt;/span&gt;&lt;/span&gt; record &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;token keyword&quot;&gt;new&lt;/span&gt; &lt;span class=&quot;token class-name&quot;&gt;ProducerRecord&lt;/span&gt;&lt;span class=&quot;token generics&quot;&gt;&lt;span class=&quot;token punctuation&quot;&gt;&amp;lt;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token constant&quot;&gt;TOPIC_NAME&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;token string&quot;&gt;&quot;Pangyo&quot;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;token string&quot;&gt;&quot;Pangyo&quot;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;  
    &lt;span class=&quot;token keyword&quot;&gt;try&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;  
        &lt;span class=&quot;token class-name&quot;&gt;RecordMetadata&lt;/span&gt; metadata &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; producer&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;send&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;record&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;get&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;  
        logger&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;info&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;metadata&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;toString&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;  
    &lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt; &lt;span class=&quot;token keyword&quot;&gt;catch&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token class-name&quot;&gt;Exception&lt;/span&gt; e&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;  
        logger&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;error&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;e&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;getMessage&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt;e&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;  
    &lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt; &lt;span class=&quot;token keyword&quot;&gt;finally&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;  
        producer&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;flush&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;  
        producer&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;close&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;  
    &lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;  
&lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;ul&gt;
&lt;li&gt;
&lt;p&gt;KafkaProducer의 &lt;code class=&quot;language-text&quot;&gt;send()&lt;/code&gt; 메소드는 &lt;code class=&quot;language-text&quot;&gt;Future&lt;/code&gt; 객체를 반환한다. 이 객체는 &lt;code class=&quot;language-text&quot;&gt;RecordMetadata&lt;/code&gt;의 비동기 결과를 표현한 것으로, ProducerRecord가 카프카 브로커에 정상적으로 적재되었는지에 대한 데이터가 포함되어 있다. 위와 같이 &lt;code class=&quot;language-text&quot;&gt;get()&lt;/code&gt;메서드를 사용하면, 프로듀서에서 보낸 데이터의 결과를 동기적으로 가져올 수 있다.&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;위 소스 코드를 실행하면 다음과 같은 RecordMetadata의 로그를 확인할 수 있다. test 토픽의 0번 파티션으로 전송하였고, 4번 offset으로 저장되었다는 의미이다. 이는 &lt;code class=&quot;language-text&quot;&gt;acks=1&lt;/code&gt;로 설정되어 리더 파티션의 결과까지 기다리기 때문에 확인 가능하다. 만약, &lt;code class=&quot;language-text&quot;&gt;acks=0&lt;/code&gt;으로 설정된다면, 오프셋 값이 -1과 같이 의미 없는 값으로 표출된다.&lt;/p&gt;
&lt;/li&gt;
&lt;/ul&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;text&quot;&gt;&lt;pre class=&quot;language-text&quot;&gt;&lt;code class=&quot;language-text&quot;&gt;[main] INFO com.example.ProducerWithSyncCallback - test-0@4&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;/br&gt;
&lt;h2&gt;5-2-6) 프로듀서 애플리케이션의 안전한 종료&lt;/h2&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;java&quot;&gt;&lt;pre class=&quot;language-java&quot;&gt;&lt;code class=&quot;language-java&quot;&gt;producer&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;close&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;ul&gt;
&lt;li&gt;프로듀서를 안전하게 종료하기 위해서는 꼭 &lt;code class=&quot;language-text&quot;&gt;close()&lt;/code&gt; 메소드를 사용하여 Accumulator에 남아 있는 레코드를 카프카 클러스터로 전송하면서 종료하는 것이 좋다.&lt;/li&gt;
&lt;/ul&gt;</content:encoded></item><item><title><![CDATA[[Flutter] 03. Consumer, ProviderNotFoundException, Selector]]></title><description><![CDATA[1. Consumer flutter의 공식 홈페이지를 살펴보면 Consumer의 정의는 다음과 같다.  즉, Consumer를 상위 위젯으로 지정해놓으면 하위 위젯에서는 Provier.of나 extension 메소드 없이 바로 Provider…]]></description><link>https://github.com/SiverPineValley/SiverPineValley.github.io/flutter/flutter_3/</link><guid isPermaLink="false">https://github.com/SiverPineValley/SiverPineValley.github.io/flutter/flutter_3/</guid><pubDate>Mon, 08 Jan 2024 23:40:00 GMT</pubDate><content:encoded>&lt;h1&gt;1. Consumer&lt;/h1&gt;
&lt;/br&gt;
&lt;div align=&quot;left&quot;&gt;
  &lt;span class=&quot;gatsby-resp-image-wrapper&quot; style=&quot;position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 630px; &quot;&gt;
      &lt;a class=&quot;gatsby-resp-image-link&quot; href=&quot;/static/e969802fd79c70a533750b09be837faf/599ea/consumer.png&quot; style=&quot;display: block&quot; target=&quot;_blank&quot; rel=&quot;noopener&quot;&gt;
    &lt;span class=&quot;gatsby-resp-image-background-image&quot; style=&quot;padding-bottom: 21.51898734177215%; position: relative; bottom: 0; left: 0; background-image: url(&apos;data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAECAYAAACOXx+WAAAACXBIWXMAABYlAAAWJQFJUiTwAAAAjklEQVR42l2P3QqAIBSDff9H8y4pVEwqLUHLZ1jsQBFdfO7MDX/UNE0YhgExRvTecZ4nrut69YH+C7vfjNpagwohQGst8GDvPXiJtVaUjOMI9rhHnedZus45GGPEs7csC1QpBdu2gbquK1JK4qn0nMm+78g5C8dxSMaZhzB7OooLn1prfb9DT77znyf76w0YRCQ8gL9e9wAAAABJRU5ErkJggg==&apos;); background-size: cover; display: block;&quot;&gt;&lt;/span&gt;
  &lt;img class=&quot;gatsby-resp-image-image&quot; alt=&quot;consumer&quot; title=&quot;&quot; src=&quot;/static/e969802fd79c70a533750b09be837faf/f058b/consumer.png&quot; srcset=&quot;/static/e969802fd79c70a533750b09be837faf/c26ae/consumer.png 158w,
/static/e969802fd79c70a533750b09be837faf/6bdcf/consumer.png 315w,
/static/e969802fd79c70a533750b09be837faf/f058b/consumer.png 630w,
/static/e969802fd79c70a533750b09be837faf/40601/consumer.png 945w,
/static/e969802fd79c70a533750b09be837faf/78612/consumer.png 1260w,
/static/e969802fd79c70a533750b09be837faf/599ea/consumer.png 1926w&quot; sizes=&quot;(max-width: 630px) 100vw, 630px&quot; style=&quot;width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;&quot; loading=&quot;lazy&quot; decoding=&quot;async&quot;&gt;
  &lt;/a&gt;
    &lt;/span&gt;
&lt;/div&gt;
&lt;/br&gt;
&lt;p&gt;flutter의 공식 홈페이지를 살펴보면 Consumer의 정의는 다음과 같다. &lt;code class=&quot;language-text&quot;&gt;개발자가 Provider&amp;lt;T&gt;가 제공하는 타입을 명시적으로 builder에 제공해 줄 필요가 없다. 컨슈머 위젯은 굉장한 일을 하는 것이 아니라, 새로운 위젯에서 Provider.of를 호출하고 builder에게 이것의 구현을 위임한다. builder는 null이 될 수 없고, 값이 변할 때마다 호출되어야 한다&lt;/code&gt; 즉, Consumer를 상위 위젯으로 지정해놓으면 하위 위젯에서는 Provier.of나 extension 메소드 없이 바로 Provider로 정의된 인스턴스에 접근할 수 있다는 것이다.&lt;/p&gt;
&lt;/br&gt;
&lt;p&gt;여기서 BuilderContext와 Widget을 사용하지 않는다면 언더바(_)로 생략 가능하다. child의 경우에는 변경이 일어나지 않아야 할 하위 위젯이 있을 때 사용된다.&lt;/p&gt;
&lt;/br&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;dart&quot;&gt;&lt;pre class=&quot;language-dart&quot;&gt;&lt;code class=&quot;language-dart&quot;&gt;&lt;span class=&quot;token class-name&quot;&gt;Consumer&lt;/span&gt;&lt;span class=&quot;token generics&quot;&gt;&lt;span class=&quot;token punctuation&quot;&gt;&amp;lt;&lt;/span&gt;&lt;span class=&quot;token class-name&quot;&gt;Dog&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;
  builder&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token class-name&quot;&gt;BuildContext&lt;/span&gt; _&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;token class-name&quot;&gt;T&lt;/span&gt; t&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;token class-name&quot;&gt;Widget&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;?&lt;/span&gt; child&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;
    &lt;span class=&quot;token keyword&quot;&gt;return&lt;/span&gt; &lt;span class=&quot;token class-name&quot;&gt;Center&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;
      child&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;token class-name&quot;&gt;Column&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;
        mainAxisAlignment&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;token class-name&quot;&gt;MainAxisAlignment&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;center&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt;
        mainAxisSize&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;token class-name&quot;&gt;MainAxisSize&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;min&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt;
        children&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;[&lt;/span&gt;
          child&lt;span class=&quot;token operator&quot;&gt;!&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt;
          &lt;span class=&quot;token class-name&quot;&gt;SizedBox&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;height&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;token number&quot;&gt;10&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt;
          &lt;span class=&quot;token class-name&quot;&gt;Text&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;
            &lt;span class=&quot;token string-literal&quot;&gt;&lt;span class=&quot;token string&quot;&gt;&apos;- name: &lt;/span&gt;&lt;span class=&quot;token interpolation&quot;&gt;&lt;span class=&quot;token punctuation&quot;&gt;${&lt;/span&gt;&lt;span class=&quot;token expression&quot;&gt;&lt;span class=&quot;token class-name&quot;&gt;T&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;name&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;&lt;/span&gt;&lt;span class=&quot;token string&quot;&gt;&apos;&lt;/span&gt;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt;
            style&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;token class-name&quot;&gt;TextStyle&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;fontSize&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;token number&quot;&gt;20.0&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt;
          &lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt;
          &lt;span class=&quot;token class-name&quot;&gt;SizedBox&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;height&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;token number&quot;&gt;10.0&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt;
          &lt;span class=&quot;token class-name&quot;&gt;BreedAndAge&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt;
        &lt;span class=&quot;token punctuation&quot;&gt;]&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt;
      &lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt;
    &lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;
  &lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt;
  child&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt;
      &lt;span class=&quot;token class-name&quot;&gt;Text&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token string-literal&quot;&gt;&lt;span class=&quot;token string&quot;&gt;&apos;I likes T very much&apos;&lt;/span&gt;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; style&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;token class-name&quot;&gt;TextStyle&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;fontSize&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;token number&quot;&gt;20.0&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt;
&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;/br&gt;
&lt;h2&gt;1.1. ProviderNotFoundException&lt;/h2&gt;
&lt;p&gt;ProviderNotFoundException이란 Provider를 생성할 때 context를 현재 위젯보다 상위 위젯(MaterialApp)의 context에 선언된 값을 가져와야 하는데, 상위 위젯에서는 Provider가 선언되어 있지 않을 때 발생한다. 즉, Provider에 접근하는 위젯이 Provider를 선언한 현재 위젯이거나, 그보다 상위에서 접근했다는 의미이다.&lt;/p&gt;
&lt;/br&gt;
&lt;ol&gt;
&lt;li&gt;
&lt;p&gt;더 상위 위젯에 Provider를 선언한다. Provider에 접근하는 위젯이 현재 Provider를 선언한 위젯이라면, child부분을 하위 위젯으로 분리한다.&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;Builder를 사용한다. build 콜백 함수를 통해 Builder라는 하위 위젯을 생성하므로, Provider에 접근 가능하다.&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;Consumer를 사용한다.&lt;/p&gt;
&lt;/li&gt;
&lt;/ol&gt;
&lt;/br&gt;
&lt;h1&gt;2. Selector&lt;/h1&gt;
&lt;p&gt;Selector 위젯은 Consumer와 유사한데, 한정된 수의 value들을 선택하여 값이 변하지 않으면 리빌드 하지 않는 위젯이다.&lt;/p&gt;
&lt;/br&gt;
&lt;div align=&quot;left&quot;&gt;
  &lt;span class=&quot;gatsby-resp-image-wrapper&quot; style=&quot;position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 630px; &quot;&gt;
      &lt;a class=&quot;gatsby-resp-image-link&quot; href=&quot;/static/d6ba7af33ed2814d2c73fecabdeac26a/ad1ae/selector.png&quot; style=&quot;display: block&quot; target=&quot;_blank&quot; rel=&quot;noopener&quot;&gt;
    &lt;span class=&quot;gatsby-resp-image-background-image&quot; style=&quot;padding-bottom: 21.51898734177215%; position: relative; bottom: 0; left: 0; background-image: url(&apos;data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAECAYAAACOXx+WAAAACXBIWXMAABYlAAAWJQFJUiTwAAAAtUlEQVR42oWPWw6CMBBF2f++CAmER0sDaCutRLAFKku4tmPQTz9O7jwyM3cSIQSqqkLXddi2Dd57Yt/3L7Eecc79JdFaI01TFEWBpmmQZRnyPCfKsgTnHIwzMMawPBcass7CWktKubW/hdM00WB02Pc96rpG27bkuokxF5BSQY8GfvdYXXC7BuebJ844auwlxhh663yT1H/0eB2YZg2p+8CA4SYwPiSuOhxXglD3C9WlGaBnhTeDuiIiKeaGcwAAAABJRU5ErkJggg==&apos;); background-size: cover; display: block;&quot;&gt;&lt;/span&gt;
  &lt;img class=&quot;gatsby-resp-image-image&quot; alt=&quot;selector&quot; title=&quot;&quot; src=&quot;/static/d6ba7af33ed2814d2c73fecabdeac26a/f058b/selector.png&quot; srcset=&quot;/static/d6ba7af33ed2814d2c73fecabdeac26a/c26ae/selector.png 158w,
/static/d6ba7af33ed2814d2c73fecabdeac26a/6bdcf/selector.png 315w,
/static/d6ba7af33ed2814d2c73fecabdeac26a/f058b/selector.png 630w,
/static/d6ba7af33ed2814d2c73fecabdeac26a/40601/selector.png 945w,
/static/d6ba7af33ed2814d2c73fecabdeac26a/78612/selector.png 1260w,
/static/d6ba7af33ed2814d2c73fecabdeac26a/ad1ae/selector.png 2270w&quot; sizes=&quot;(max-width: 630px) 100vw, 630px&quot; style=&quot;width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;&quot; loading=&quot;lazy&quot; decoding=&quot;async&quot;&gt;
  &lt;/a&gt;
    &lt;/span&gt;
&lt;/div&gt;
&lt;/br&gt;
&lt;p&gt;Consumer와 거의 유사하나, selector 함수가 추가되었다. Extension method의 &lt;code class=&quot;language-text&quot;&gt;select()&lt;/code&gt;와 유사하게, Provider로 제공할 클래스, 리턴받을 값의 타입을 지정한다. builder 함수 역시 거의 유사하나, 타입 T가 아닌 앞서 selector에서 리턴받은 타입을 넣어준다.&lt;/p&gt;
&lt;h1&gt;3. 출처&lt;/h1&gt;
&lt;p&gt;&lt;a href=&quot;https://www.udemy.com/course/flutter-provider-essential-korean/&quot;&gt;https://www.udemy.com/course/flutter-provider-essential-korean/&lt;/a&gt;&lt;/br&gt;&lt;/p&gt;</content:encoded></item><item><title><![CDATA[[Flutter] 02. 상태 관리 기법과 Provider]]></title><description><![CDATA[1. FE 상태 관리의 필요성 FE 개발을 하다 보면 위와 같이 트리 구조의 위젯의 여러 부분에서 같은 값을 사용해야할 필요가 있다. 예를 들어 WidgetA의 카운터 값을 WidgetB…]]></description><link>https://github.com/SiverPineValley/SiverPineValley.github.io/flutter/flutter_2/</link><guid isPermaLink="false">https://github.com/SiverPineValley/SiverPineValley.github.io/flutter/flutter_2/</guid><pubDate>Sun, 07 Jan 2024 21:00:00 GMT</pubDate><content:encoded>&lt;h1&gt;1. FE 상태 관리의 필요성&lt;/h1&gt;
&lt;div align=&quot;left&quot;&gt;
  &lt;span class=&quot;gatsby-resp-image-wrapper&quot; style=&quot;position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 630px; &quot;&gt;
      &lt;a class=&quot;gatsby-resp-image-link&quot; href=&quot;/static/4549249743669326590ba561fc552dea/6f464/neccesity_of_provider.png&quot; style=&quot;display: block&quot; target=&quot;_blank&quot; rel=&quot;noopener&quot;&gt;
    &lt;span class=&quot;gatsby-resp-image-background-image&quot; style=&quot;padding-bottom: 77.84810126582278%; position: relative; bottom: 0; left: 0; background-image: url(&apos;data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAQCAYAAAAWGF8bAAAACXBIWXMAABYlAAAWJQFJUiTwAAACIUlEQVR42o1Uy47TQBD0V/EjSJz4CCQkJK5wQ1y4ckA5ouXIAQmOiCgSJFllyWbjxd4EZ52QNY7fjxnPFD0TO/vIYxmpNdGoU13VXW0D9xx545d9GeBs4oNXYm++sUmX8iAw4xWG9grH5x7SnN0ptgNwm5pEyQXigutbVBJBUmIV5QQum5T9gGma6kiSRIeqH2QcfTfF+E9KoNcIlZAoymqndKOROhqN0Ol00O120W63YVu/kFO+9/ktpq8fIVt5G+aMGJ9e+LqfQsjdDPM8RxRFiOMYYRgiXPko6d19/wLT5w8QL90aUBA7Tv30Kf5usTQ456gqok+3Ci0/yzBfLHSEVCCmQqxas2sUqcFk9XBuAfZ6PQyHQ/T7fQwGA82OsxIT24I9mZKkNQOu+8YpSggFKuVOdxiO48B1XSyIzWRyAedyjrPuD3z/9BFBmNQqBRRBp/UMzpvHOB+PKXcKy7JgmuYtUOOOU/RpfWjj6csjzK/i+l1ANcN99wS/Xz1ERi5QuU27tqasQssgq4Q5NXwew5xHa+Pe6FtSMERpUb/fsynNUVPzU/pjUdVFmk0h2SRdgZfsP1Zv38nJ7IHnkbHlpi/K2H6YI0yK3YCNJOVD1Wg1IJvuIMnhn3zF8ksLSRBcFyHpfdPDsXlFfaz2M2SMaduoFYyiUFslnFlYnnwDK8tNntoOexbor8+WbQ59sgrq289Fju4sQ1IKHJjF5vwDmpbUzJcy3oYAAAAASUVORK5CYII=&apos;); background-size: cover; display: block;&quot;&gt;&lt;/span&gt;
  &lt;img class=&quot;gatsby-resp-image-image&quot; alt=&quot;neccesity of provider&quot; title=&quot;&quot; src=&quot;/static/4549249743669326590ba561fc552dea/f058b/neccesity_of_provider.png&quot; srcset=&quot;/static/4549249743669326590ba561fc552dea/c26ae/neccesity_of_provider.png 158w,
/static/4549249743669326590ba561fc552dea/6bdcf/neccesity_of_provider.png 315w,
/static/4549249743669326590ba561fc552dea/f058b/neccesity_of_provider.png 630w,
/static/4549249743669326590ba561fc552dea/40601/neccesity_of_provider.png 945w,
/static/4549249743669326590ba561fc552dea/78612/neccesity_of_provider.png 1260w,
/static/4549249743669326590ba561fc552dea/6f464/neccesity_of_provider.png 1464w&quot; sizes=&quot;(max-width: 630px) 100vw, 630px&quot; style=&quot;width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;&quot; loading=&quot;lazy&quot; decoding=&quot;async&quot;&gt;
  &lt;/a&gt;
    &lt;/span&gt;
&lt;/div&gt;
&lt;p&gt;FE 개발을 하다 보면 위와 같이 트리 구조의 위젯의 여러 부분에서 같은 값을 사용해야할 필요가 있다. 예를 들어 WidgetA의 카운터 값을 WidgetB에서도 사용하여 보여줄 필요가 있다는 말이다. 이를 위해서는, 두 위젯의 공통 부모인 WidgetC에서 counter 변수를 정의하고, 카운터 값을 변화시킬 수 있는 increment() 함수를 선언해줘야 한다. 또한, 실제 값의 변화 동작이 일어나는 WidgetA에는 counter 변수와 increment() 함수를 넘겨줘야 하고, WidgetB에도 counter 변수를 넘겨줘야 한다. 하지만, 트리구조 상 WidgetC -&gt; WidgetB로 바로 넘겨주는 것이 불가능하니, 실제로 counter를 사용하지 않음에도 이를 받아서 WidgetB로 넘기는 구조가 되어야 한다.&lt;/p&gt;
&lt;/br&gt;
&lt;p&gt;이러한 구조를 inversion of control이라고 한다. 실제 동작과 값을 사용하지 않음에도 동작에 대한 부분과 동작을 통해 값이 변화하는 비즈니스 로직이 다른 곳에 구현되어야 하고, 실제 사용되지도 않는 위젯을 거쳐서 값을 전달해야 하는 이러한 상황을 의미한다. FE 개발을 하면서도 너무나도 직관적이지 못하고 쓸데 없이 복잡한 구조를 만들어낼 수 있다고 생각한 부분이었다.&lt;/p&gt;
&lt;/br&gt;
&lt;p&gt;이러한 구조에서는 다음과 같은 문제들이 있을 수 있다.&lt;/p&gt;
&lt;h2&gt;1.1. 복잡한 위젯일 수록 기하급수적으로 복잡해지는 상태 관리&lt;/h2&gt;
&lt;p&gt;위의 트리 이미지처럼 3-4 Depth의 UI 구조에서는 급하게 구현한다고 하면 그래도 관리할 수 있을 것이다. 하지만 Depth가 기하급수적으로 증가한다면, 상태 관리 시 관여되는 위젯의 수도 기하급수적으로 늘어나며, 코드 구현이 매우 어려워진다.&lt;/p&gt;
&lt;/br&gt;
&lt;h2&gt;1.2. 유지보수의 어려움&lt;/h2&gt;
&lt;p&gt;마찬가지로, 실제로는 값을 사용하지 않음에도 값을 들고 있는 위젯 수가 많아지므로 실제로 값이 사용되고 변화하는 위젯들에 대한 코드 상의 추적 관리가 어려워진다. Dependency가 여기저기 있으므로 한번 수정할 때 모든 위젯의 전수 조사가 필요해지므로 그만큼 유지보수가 어려워진다.&lt;/p&gt;
&lt;/br&gt;
&lt;h2&gt;1.3. 렌더링 오버헤드&lt;/h2&gt;
&lt;p&gt;여러 위젯이 같은 값이 존재하는 만큼 값이 변화할 때마다 불필요한 렌더링이 발생할 수 있다. 이는 화면상의 성능 저하에도 많은 부분관여될 것이다.&lt;/p&gt;
&lt;h1&gt;2. 이를 해결하기 위한 상태 관리 기법&lt;/h1&gt;
&lt;p&gt;이러한 문제들을 해결하기 위해 Flutter에서는 여러 가지 상태 기법들이 존재한다. 그 중 가장 대중적이면서 Google에서 공식적인 상태 관리 기법으로 이야기되는 것이 Provider이다. 사실 이 부분에서 여러 가지 상태 관리 기법들을 소개하고 비교해보고 싶었으나, 각 상태 관리 기법들의 차이점에 대해 자세히 알지는 못하기 때문에 정량적인 부분만 비교를 진행하겠다.&lt;/p&gt;
&lt;h4&gt;flutter 상태 관리 기법별 정량적 비교 (2024/01/06 기준)&lt;/h4&gt;
&lt;table&gt;
&lt;thead&gt;
&lt;tr&gt;
&lt;th&gt;Name&lt;/th&gt;
&lt;th&gt;Recent Stable Version&lt;/th&gt;
&lt;th&gt;Star&lt;/th&gt;
&lt;th&gt;Recent Update&lt;/th&gt;
&lt;/tr&gt;
&lt;/thead&gt;
&lt;tbody&gt;
&lt;tr&gt;
&lt;td&gt;Provider&lt;/td&gt;
&lt;td&gt;6.1.1&lt;/td&gt;
&lt;td&gt;5k&lt;/td&gt;
&lt;td&gt;2023/11/26&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;GetX&lt;/td&gt;
&lt;td&gt;4.6.6&lt;/td&gt;
&lt;td&gt;9.5k&lt;/td&gt;
&lt;td&gt;2023/11/02&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;Bloc&lt;/td&gt;
&lt;td&gt;0.2.3&lt;/td&gt;
&lt;td&gt;11.1k&lt;/td&gt;
&lt;td&gt;2023/12/18&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;Redux&lt;/td&gt;
&lt;td&gt;0.6.0&lt;/td&gt;
&lt;td&gt;1.6k&lt;/td&gt;
&lt;td&gt;2022/7/7&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;RiverPod&lt;/td&gt;
&lt;td&gt;3.0.0&lt;/td&gt;
&lt;td&gt;5.4k&lt;/td&gt;
&lt;td&gt;2023/12/27&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;flutter_hooks&lt;/td&gt;
&lt;td&gt;0.20.4&lt;/td&gt;
&lt;td&gt;2.9k&lt;/td&gt;
&lt;td&gt;2024/01/03&lt;/td&gt;
&lt;/tr&gt;
&lt;/tbody&gt;
&lt;/table&gt;
&lt;p&gt;이러한 상태 관리 기법들에서는 코드 상의 컨벤션이나 용어/방법의 차이는 조금씩 존재한다. 일부는 기존의 Vuex나 Redux같은 상태 관리 기법에서 방법을 가져온 것도 있을 것이다. 요점은 방식은 다르나, &lt;code class=&quot;language-text&quot;&gt;1) Dependency Injection&lt;/code&gt;, &lt;code class=&quot;language-text&quot;&gt;2) Synchronizing data and UI&lt;/code&gt; 을 제공한다는 점은 공통적이다.&lt;/p&gt;
&lt;h2&gt;2.1. Dependency Injection&lt;/h2&gt;
&lt;p&gt;위의 예제 사례와 다르게 필요한 UI 위젯에서만 값과 비즈니스 로직을 가져간다는 점이다. 불필요하게 값을 가지는 위젯을 줄일 수 있어야 한다.&lt;/p&gt;
&lt;/br&gt;
&lt;h2&gt;2.2. Synchronizing data and UI&lt;/h2&gt;
&lt;p&gt;값이 변경되었을 때, 이를 UI에서 인지하고 바로 반영할 수 있어야 한다. 한가지 중요한 점은 렌더링 시 정말로 사용되는 곳만 정확하게 변경될 수 있어야 한다는 점이다.&lt;/p&gt;
&lt;/br&gt;
&lt;h1&gt;3. 상태 관리 기법 적용 (Provider)&lt;/h1&gt;
&lt;p&gt;본 예시에서는 위의 기법들 중 &lt;code class=&quot;language-text&quot;&gt;Provider&lt;/code&gt;를 사용하여 상태 관리 방식을 적용해보겠다.&lt;/p&gt;
&lt;/br&gt;
&lt;p&gt;위의 예제에서 상태 관리 기법을 적용하면 아래와 같은 이미지가 될 수 있다. 이미지에는 표시되지 않았지만, Provider는 위젯의 한 종류로 사용되는데 Provider 하단의 모든 위젯에 상태가 제공될 수 있다. 따라서, MyApp 상단에 Provider으로 감싸준다. 그리고, 별도 class를 정의하여 상태를 공유할 값들을 정한다. Provider 위젯 내의 create에는 생성할 클래스를 넣어줄 수 있는데 여기에 생성한 class의 인스턴스를 넣어준다. (&lt;code class=&quot;language-text&quot;&gt;create: (context) =&gt; T()&lt;/code&gt;) 상태를 공유할 하단의 위젯에서는 &lt;code class=&quot;language-text&quot;&gt;Provider&amp;lt;T&gt;.of(context).Something&lt;/code&gt;의 형태로 Method나 상태에 접근할 수 있다.&lt;/p&gt;
&lt;div align=&quot;left&quot;&gt;
  &lt;span class=&quot;gatsby-resp-image-wrapper&quot; style=&quot;position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 630px; &quot;&gt;
      &lt;a class=&quot;gatsby-resp-image-link&quot; href=&quot;/static/94899503693a343e1e3628553f59eb02/dcb79/use_provider.png&quot; style=&quot;display: block&quot; target=&quot;_blank&quot; rel=&quot;noopener&quot;&gt;
    &lt;span class=&quot;gatsby-resp-image-background-image&quot; style=&quot;padding-bottom: 65.18987341772153%; position: relative; bottom: 0; left: 0; background-image: url(&apos;data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAANCAYAAACpUE5eAAAACXBIWXMAABYlAAAWJQFJUiTwAAABrElEQVR42pVUXU/qQBTs//8nvMEjz14eSYyCUVpF8AKK/e52u9/j2QWbe1H8OMlJ00l29szMaSOclFIKUkoYY2CtDZgxFvOHHLP7DM+VhDQO5yo6BabTKUajEcbjMeI4DphzDttXhm3KwJWFtr8kHAwGGA6HmM1mPV42AhWTxwvwc8L5/AYXF38wmUyQJEnApDa4TlJcxim2pcBTIVByfZ7wfwWul+m909qGZ1GL0JZwTR4ae2ZCQ8Y/FwxCSGqBXdpin/NwiEuDx6zDuuiw2jPkVYfvKvJJ1k2Dtm1RlBUuFyniddlPamj8joivkgw3y7z38JyPHzxsOw1BBME7c0jUH264REmhSO2+nvDdr/fWtIeK9lCS/KxusdzV+PvSHC5T3p4OyVOJTujecdfr+WxCks45B2MMDVlx+5jjjtodNe7zFtPbV2RHP0+lR859LUFIjbJV4aCixKUyYTofmn/XZEsjDK0R4aTgw4T/yg8rRaHt8wo1EyEUvwG+PNFiVWC5rfFScdzvcjAijjabTU/0WR1gWiGh6HvOekK/m4t1gRV5TLfSP+DwFb0ByLn0Ht+YXeMAAAAASUVORK5CYII=&apos;); background-size: cover; display: block;&quot;&gt;&lt;/span&gt;
  &lt;img class=&quot;gatsby-resp-image-image&quot; alt=&quot;use provider&quot; title=&quot;&quot; src=&quot;/static/94899503693a343e1e3628553f59eb02/f058b/use_provider.png&quot; srcset=&quot;/static/94899503693a343e1e3628553f59eb02/c26ae/use_provider.png 158w,
/static/94899503693a343e1e3628553f59eb02/6bdcf/use_provider.png 315w,
/static/94899503693a343e1e3628553f59eb02/f058b/use_provider.png 630w,
/static/94899503693a343e1e3628553f59eb02/40601/use_provider.png 945w,
/static/94899503693a343e1e3628553f59eb02/78612/use_provider.png 1260w,
/static/94899503693a343e1e3628553f59eb02/dcb79/use_provider.png 1700w&quot; sizes=&quot;(max-width: 630px) 100vw, 630px&quot; style=&quot;width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;&quot; loading=&quot;lazy&quot; decoding=&quot;async&quot;&gt;
  &lt;/a&gt;
    &lt;/span&gt;
&lt;/div&gt;
&lt;/br&gt;
&lt;p&gt;만약, 동일한 클래스의 인스턴스를 여러 개 생성하게 된다면 어떻게 될까? 이 경우에는 트리상 가장 가까운 곳에서 생성한 인스턴스에 접근하게 된다.&lt;/p&gt;
&lt;/br&gt;
&lt;h1&gt;4. ChangeNotifierProvider 적용&lt;/h1&gt;
&lt;p&gt;Provider를 적용하면 최상단에 정의된 인스턴스의 값을 깊은 depth의 모든 위젯에서 접근이 가능하다. 다만, 실제 값이 변화하는 부분을 UI에서 바로 반영시키지는 않는다. 이러한 기능은 ChangeNotifier를 통해 해결할 수 있다. ChangeNotifer에는 그냥 ChangeNotifier와 ChangeNotifierProvider가 있는데, 전자는 최상위 위젯에 Provider를 적용하지 않고 StatefulWidget 내에서 &lt;code class=&quot;language-text&quot;&gt;initState&lt;/code&gt;(addListener), &lt;code class=&quot;language-text&quot;&gt;dispose&lt;/code&gt;(deleteListener), &lt;code class=&quot;language-text&quot;&gt;TListener&lt;/code&gt;(Listener Callback) 함수들을 overrider 해주고, 각 위젯에 상태 class를 생성자로 넣어줘야 한다. 또한, 행위에 대한 비즈니스 로직을 수행하는 함수 내에서 &lt;code class=&quot;language-text&quot;&gt;notifyListenr()&lt;/code&gt;를 호출해줘서 위젯이 적용된 모든 UI의 화면을 갱신해줘야 한다.&lt;/p&gt;
&lt;/br&gt;
&lt;p&gt;반면, ChangeNotifierProvider는 Provider처럼 최상위 위젯으로 적용한 뒤, &lt;code class=&quot;language-text&quot;&gt;notifyListenr()&lt;/code&gt;만 제때 사용해주면 Provider를 통해 값을 가져오는 모든 UI에서 화면에 바로 반영되게 된다.&lt;/p&gt;
&lt;/br&gt;
&lt;p&gt;이러한 방법들을 통해 &lt;code class=&quot;language-text&quot;&gt;Dependency Injection&lt;/code&gt;과 &lt;code class=&quot;language-text&quot;&gt;Synchronizing data and UI&lt;/code&gt; 방식 구현이 가능하다.&lt;/p&gt;
&lt;h2&gt;4.1. Extension Methods&lt;/h2&gt;
&lt;p&gt;앞서 설명한 ChangeNotifierProvider는 Provider를 Consume하고 있는 모든 위젯이 상태를 보고 있다가, 변화가 있으면 화면에 적용할 수 있다. 이 때 Class 내에 정의된 값 하나만 변해도 화면이 갱신되게 되는데, 실제로는 값이 변하지 않았을 때도 화면이 갱신되므로 쓸데 없는 오버헤드가 발생된다.&lt;/p&gt;
&lt;/br&gt;
&lt;p&gt;이를 해결하는 방법으로는 Provider에서 제공하는 extension method를 사용하면 해결할 수 있다.&lt;/p&gt;
&lt;ol&gt;
&lt;li&gt;&lt;code class=&quot;language-text&quot;&gt;context.read&amp;lt;T&gt;() -&gt; T&lt;/code&gt;&lt;/li&gt;
&lt;/ol&gt;
&lt;ul&gt;
&lt;li&gt;타입 T인 인스턴스를 가장 가까운 상위 Provider 위젯으로부터 가져옴&lt;/li&gt;
&lt;li&gt;&lt;code class=&quot;language-text&quot;&gt;Provider&amp;lt;T&gt;.of(context, listen: false).Something&lt;/code&gt;&lt;/li&gt;
&lt;/ul&gt;
&lt;ol start=&quot;2&quot;&gt;
&lt;li&gt;&lt;code class=&quot;language-text&quot;&gt;context.watch&amp;lt;T&gt;() -&gt; T&lt;/code&gt;&lt;/li&gt;
&lt;/ol&gt;
&lt;ul&gt;
&lt;li&gt;타입 T인 인스턴스를 가장 가까운 상위 Provider 위젯으로부터 가져옴. 또한, Provider 값을 구독함&lt;/li&gt;
&lt;li&gt;&lt;code class=&quot;language-text&quot;&gt;Provider&amp;lt;T&gt;.of(context).Something&lt;/code&gt;&lt;/li&gt;
&lt;/ul&gt;
&lt;ol start=&quot;3&quot;&gt;
&lt;li&gt;&lt;code class=&quot;language-text&quot;&gt;context.select&amp;lt;T, R&gt;(R selector(T value)) -&gt; R&lt;/code&gt;&lt;/li&gt;
&lt;/ol&gt;
&lt;ul&gt;
&lt;li&gt;Provider를 통해 노출된 T 타입 값 중 한 부분만을 Listen함&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;1, 2는 값을 가져온 뒤 다시 렌더링을 할지 말지에 대한 차이가 있다면, 3은 인스턴스 내의 특정 value 하나만을 watch하는 방식이라고 볼 수 있다.&lt;/p&gt;
&lt;h2&gt;4.2. 그 외 Provider의 종류&lt;/h2&gt;
&lt;h3&gt;4.2.1. MultiProvider&lt;/h3&gt;
&lt;p&gt;MultiProvider는 여러 타입으로 Provider를 먹이고 싶을 때 사용한다. 아래 예제를 보면 어떤 의미인지 바로 파악이 가능할 것이다.&lt;/p&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;dart&quot;&gt;&lt;pre class=&quot;language-dart&quot;&gt;&lt;code class=&quot;language-dart&quot;&gt;&lt;span class=&quot;token class-name&quot;&gt;MultiProvider&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;
  providers&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;[&lt;/span&gt;
    &lt;span class=&quot;token class-name&quot;&gt;ChangeNotifierProvider&lt;/span&gt;&lt;span class=&quot;token generics&quot;&gt;&lt;span class=&quot;token punctuation&quot;&gt;&amp;lt;&lt;/span&gt;&lt;span class=&quot;token class-name&quot;&gt;T&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;
      create&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;context&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;&gt;&lt;/span&gt; &lt;span class=&quot;token class-name&quot;&gt;T&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt;
    &lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt;
    &lt;span class=&quot;token class-name&quot;&gt;ChangeNotifierProvider&lt;/span&gt;&lt;span class=&quot;token generics&quot;&gt;&lt;span class=&quot;token punctuation&quot;&gt;&amp;lt;&lt;/span&gt;&lt;span class=&quot;token class-name&quot;&gt;S&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;
    &lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt;create&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;context&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;&gt;&lt;/span&gt; &lt;span class=&quot;token class-name&quot;&gt;S&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt;
    &lt;span class=&quot;token class-name&quot;&gt;ChangeNotifierProvider&lt;/span&gt;&lt;span class=&quot;token generics&quot;&gt;&lt;span class=&quot;token punctuation&quot;&gt;&amp;lt;&lt;/span&gt;&lt;span class=&quot;token class-name&quot;&gt;R&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;
    &lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt;create&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;context&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;&gt;&lt;/span&gt; &lt;span class=&quot;token class-name&quot;&gt;R&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt;
  &lt;span class=&quot;token punctuation&quot;&gt;]&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt;
&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;/br&gt;
&lt;h3&gt;4.2.2. FutureProvider&lt;/h3&gt;
&lt;div align=&quot;left&quot;&gt;
  &lt;span class=&quot;gatsby-resp-image-wrapper&quot; style=&quot;position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 630px; &quot;&gt;
      &lt;a class=&quot;gatsby-resp-image-link&quot; href=&quot;/static/9a8978080ba497678df93ff6d74436c1/7321b/future_provider.png&quot; style=&quot;display: block&quot; target=&quot;_blank&quot; rel=&quot;noopener&quot;&gt;
    &lt;span class=&quot;gatsby-resp-image-background-image&quot; style=&quot;padding-bottom: 40.50632911392405%; position: relative; bottom: 0; left: 0; background-image: url(&apos;data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAICAYAAAD5nd/tAAAACXBIWXMAABYlAAAWJQFJUiTwAAABA0lEQVR42qVRx46DUAzk/78IFMohiBYQvQsRJHr7Ba/GK9BKm1sOI9vz7HF5guu6ZFkWOY5Dj8eDbNtmSJLE3DRNNM/zRyzL8i8WhmEgXddJURSKoohEUWTb9z1j2zba951xHMftg7/ewAPrupIAsigKej6flCQJGYZBQRBQVVWUZRmlaUp5nrNFDP+y7/eb8+I4pjAMCcOxIEhN0+j1evH6mBAJ8NHA8zwyTZN9nAGCGKJpGm501bVt+ytYliWpqsq3Q5Hv+/wIUYghGQ1lWebia1WsCHueJ+NeGYfH+Bj5+gQceBxHjmEv/2/Op08Suq7j4yMJHUB+A6Gu6/s3vxUDfgD/G0AB8gP9FQAAAABJRU5ErkJggg==&apos;); background-size: cover; display: block;&quot;&gt;&lt;/span&gt;
  &lt;img class=&quot;gatsby-resp-image-image&quot; alt=&quot;future provider&quot; title=&quot;&quot; src=&quot;/static/9a8978080ba497678df93ff6d74436c1/f058b/future_provider.png&quot; srcset=&quot;/static/9a8978080ba497678df93ff6d74436c1/c26ae/future_provider.png 158w,
/static/9a8978080ba497678df93ff6d74436c1/6bdcf/future_provider.png 315w,
/static/9a8978080ba497678df93ff6d74436c1/f058b/future_provider.png 630w,
/static/9a8978080ba497678df93ff6d74436c1/40601/future_provider.png 945w,
/static/9a8978080ba497678df93ff6d74436c1/7321b/future_provider.png 1184w&quot; sizes=&quot;(max-width: 630px) 100vw, 630px&quot; style=&quot;width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;&quot; loading=&quot;lazy&quot; decoding=&quot;async&quot;&gt;
  &lt;/a&gt;
    &lt;/span&gt;
&lt;/div&gt;
&lt;/br&gt;
&lt;p&gt;FutureProvider는 위젯 트리에서는 이미 빌드되었는데, 사용하는 값이 아직 준비되지 않았을 때 사용하는 Provider이다. initialData가 required인데, 값을 가져올 때 까지 initialData를 보여주다가 Future가 Resolve되면 갱신된 값을 표시해준다. 이 때, 값은 두 번만 리빌드된다. (initialData로 한 번, Resolve된 Future 값으로 두 번) 여러 번 연속적으로 리빌드 되는 값을 사용하고 싶다면 StreamProvider를 사용하면 된다. 또한, 에러가 발생 가능한 FutureProvider일 경우 에러를 catch할 수 있는 함수로 제공해야 한다.&lt;/p&gt;
&lt;/br&gt;
&lt;h3&gt;4.2.3. StreamProvider&lt;/h3&gt;
&lt;div align=&quot;left&quot;&gt;
  &lt;span class=&quot;gatsby-resp-image-wrapper&quot; style=&quot;position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 630px; &quot;&gt;
      &lt;a class=&quot;gatsby-resp-image-link&quot; href=&quot;/static/1f62b3437bbae97a9bc2abb7764ad4f9/c929c/stream_provider.png&quot; style=&quot;display: block&quot; target=&quot;_blank&quot; rel=&quot;noopener&quot;&gt;
    &lt;span class=&quot;gatsby-resp-image-background-image&quot; style=&quot;padding-bottom: 41.77215189873418%; position: relative; bottom: 0; left: 0; background-image: url(&apos;data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAICAYAAAD5nd/tAAAACXBIWXMAABYlAAAWJQFJUiTwAAABDUlEQVR42p1S2YqDQBD0///HVw2KYiJeeCUeiAfeF/mBDtUwQRaWhX0oeqbaqa6aUXo+n/R4POh+v5OqquR5HrmuS7quk+M4NE0TLcvyJ+Z5pvM8ScLCMAySZZl832dRDKiqitq25Y/XdeW6bRtDiGAYevu+syCq9H6/Kc9zFo3jmGzbZodZllGSJMxdEYYhV/TquqY0TdkI9sdxkASbOKwoCseGO0QNgoBM0+ToGGJZFt1uN96/Xi8WKsuSrwg9VLhnwaIoSNO0rzsIInIURbwGj6sQBxFPREdMaCD612Hf99Q0DQ3DwPciMI4jQ/BiLfgrwLNg13UsBvIqcsVv/E9BfhS4g6h4yf9C/DYfFmRCSjt3Y3kAAAAASUVORK5CYII=&apos;); background-size: cover; display: block;&quot;&gt;&lt;/span&gt;
  &lt;img class=&quot;gatsby-resp-image-image&quot; alt=&quot;stream provider&quot; title=&quot;&quot; src=&quot;/static/1f62b3437bbae97a9bc2abb7764ad4f9/f058b/stream_provider.png&quot; srcset=&quot;/static/1f62b3437bbae97a9bc2abb7764ad4f9/c26ae/stream_provider.png 158w,
/static/1f62b3437bbae97a9bc2abb7764ad4f9/6bdcf/stream_provider.png 315w,
/static/1f62b3437bbae97a9bc2abb7764ad4f9/f058b/stream_provider.png 630w,
/static/1f62b3437bbae97a9bc2abb7764ad4f9/40601/stream_provider.png 945w,
/static/1f62b3437bbae97a9bc2abb7764ad4f9/c929c/stream_provider.png 1218w&quot; sizes=&quot;(max-width: 630px) 100vw, 630px&quot; style=&quot;width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;&quot; loading=&quot;lazy&quot; decoding=&quot;async&quot;&gt;
  &lt;/a&gt;
    &lt;/span&gt;
&lt;/div&gt;
&lt;/br&gt;
&lt;p&gt;StreamProvider는 특정 값이 연속적으로 변경이 있을 때 주기적으로 이 값을 변경하여 적용하도록 사용된다. 보통은 이러한 기능은 StreamBuilder를 통해서도 가능하지만, 여러 위젯에서 동시에 사용하려면 StreamProvider를 사용하는 것이 편리하다. FutureProvider와 마찬가지로 계속 사용되는 타입이 StreamProvider의 타입으로도 사용된다.&lt;/p&gt;
&lt;/br&gt;
&lt;p&gt;이러한 StreamProvider는 Firebase처럼 Stream 형식으로 값을 주고받거나, 지속적인 값의 변화가 나타나는 기능들에서 사용될 수 있다.&lt;/p&gt;
&lt;h1&gt;5. 출처&lt;/h1&gt;
&lt;p&gt;&lt;a href=&quot;https://www.udemy.com/course/flutter-provider-essential-korean/&quot;&gt;https://www.udemy.com/course/flutter-provider-essential-korean/&lt;/a&gt;&lt;/br&gt;&lt;/p&gt;</content:encoded></item><item><title><![CDATA[5-1) 프로듀서]]></title><description><![CDATA[5-1-…]]></description><link>https://github.com/SiverPineValley/SiverPineValley.github.io/kafka/kafka_5_1/</link><guid isPermaLink="false">https://github.com/SiverPineValley/SiverPineValley.github.io/kafka/kafka_5_1/</guid><pubDate>Sat, 06 Jan 2024 21:00:00 GMT</pubDate><content:encoded>&lt;h2&gt;5-1-1) 카프카 프로듀서 소개&lt;/h2&gt;
&lt;ul&gt;
&lt;li&gt;카프카의 데이터 시작점은 프로듀서이다. 프로듀서 애플리케이션은 카프카에 필요한 데이터를 선언하고 특정 토픽의 파티션에 데이터를 전송한다. 프로듀서는 데이터를 전송할 때 리더 파티션을 가지고 있는 카프카 프로듀서와 직접 통신한다. 프로듀서는 카프카 브로커로 데이터를 전송할 때 내부적으로 파티셔너, 배치 단계를 거친다.&lt;/li&gt;
&lt;/ul&gt;
&lt;/br&gt;
&lt;h2&gt;5-1-2) 카프카 프로듀서 내부 구조 (Java 라이브러리)&lt;/h2&gt;
&lt;/br&gt;
&lt;div align=&quot;left&quot;&gt;
  &lt;span class=&quot;gatsby-resp-image-wrapper&quot; style=&quot;position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 630px; &quot;&gt;
      &lt;a class=&quot;gatsby-resp-image-link&quot; href=&quot;/static/fb9462269ac1914e65f1ba314143a3a5/52576/%EC%8A%A4%ED%81%AC%EB%A6%B0%EC%83%B7%202025-01-11%20%EC%98%A4%ED%9B%84%202.43.56.png&quot; style=&quot;display: block&quot; target=&quot;_blank&quot; rel=&quot;noopener&quot;&gt;
    &lt;span class=&quot;gatsby-resp-image-background-image&quot; style=&quot;padding-bottom: 48.734177215189874%; position: relative; bottom: 0; left: 0; background-image: url(&apos;data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAKCAYAAAC0VX7mAAAACXBIWXMAABYlAAAWJQFJUiTwAAABu0lEQVR42mVSx4qyQRD8Htkn8KKgghe9iJhzXHMWRPEzh4ugIqaDjyCCsXarYX7+ZQeK6Zmerq7uHq1er6PRaAiazeYfKL86K7vVaqFWq+FyuYDr+Xzi9XpBC4fDiEajiEQiCIVCAt7x7PP50O12oeu6ENHu9/vyhjFerxfr9VoI3+83Pp8PtHa7LZmoJJFIIJVKCZlKRP9yucRoNJK91+shFouJPxAIYLvdCtntdsPj8YBGMj6oVCpwuVyw2+3odDqYTCYSQBW6PkAul8NwOEI6nYbH48F8Pkc2m0W1WhXFNptNYrRisSilFQoFIbRYLFgsFtjv90JG1ePxGKVS6Ydw+PMuD7/fj/P5jHK5DLfbDZPJBIPBIH3VmJlKuDM4mUyKzUSqV4PBQPrH/esrJwpZUTwex3Q6lUTs8W63g8YAEv7fN9qE6uFsNkM+n5eSSMwWqbjNZiND4UBkKAxkJgWqVDZ9HFImk/mnnDYJeaaA1Wol34VDud/v0JhFfZdgMCgkTqcTZrMZVqsVRqNRbIfDIX72j0QES1ffhmQy5cPhgOPx+Au841C4K//pdBJwGMrm/fV6lVL5dYhvphJ76EykpRAAAAAASUVORK5CYII=&apos;); background-size: cover; display: block;&quot;&gt;&lt;/span&gt;
  &lt;img class=&quot;gatsby-resp-image-image&quot; alt=&quot;     2025 01 11    2 43 56&quot; title=&quot;&quot; src=&quot;/static/fb9462269ac1914e65f1ba314143a3a5/f058b/%EC%8A%A4%ED%81%AC%EB%A6%B0%EC%83%B7%202025-01-11%20%EC%98%A4%ED%9B%84%202.43.56.png&quot; srcset=&quot;/static/fb9462269ac1914e65f1ba314143a3a5/c26ae/%EC%8A%A4%ED%81%AC%EB%A6%B0%EC%83%B7%202025-01-11%20%EC%98%A4%ED%9B%84%202.43.56.png 158w,
/static/fb9462269ac1914e65f1ba314143a3a5/6bdcf/%EC%8A%A4%ED%81%AC%EB%A6%B0%EC%83%B7%202025-01-11%20%EC%98%A4%ED%9B%84%202.43.56.png 315w,
/static/fb9462269ac1914e65f1ba314143a3a5/f058b/%EC%8A%A4%ED%81%AC%EB%A6%B0%EC%83%B7%202025-01-11%20%EC%98%A4%ED%9B%84%202.43.56.png 630w,
/static/fb9462269ac1914e65f1ba314143a3a5/40601/%EC%8A%A4%ED%81%AC%EB%A6%B0%EC%83%B7%202025-01-11%20%EC%98%A4%ED%9B%84%202.43.56.png 945w,
/static/fb9462269ac1914e65f1ba314143a3a5/78612/%EC%8A%A4%ED%81%AC%EB%A6%B0%EC%83%B7%202025-01-11%20%EC%98%A4%ED%9B%84%202.43.56.png 1260w,
/static/fb9462269ac1914e65f1ba314143a3a5/52576/%EC%8A%A4%ED%81%AC%EB%A6%B0%EC%83%B7%202025-01-11%20%EC%98%A4%ED%9B%84%202.43.56.png 1412w&quot; sizes=&quot;(max-width: 630px) 100vw, 630px&quot; style=&quot;width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;&quot; loading=&quot;lazy&quot; decoding=&quot;async&quot;&gt;
  &lt;/a&gt;
    &lt;/span&gt;
&lt;/div&gt;
&lt;/br&gt;
&lt;ul&gt;
&lt;li&gt;&lt;strong&gt;ProducerRecord&lt;/strong&gt;: 프로듀서에서 생성하는 레코드. 오프셋은 미포함. offset은 카프카 클러스터의 특정 파티션에 저장되고 나서 지정된다.&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;send()&lt;/strong&gt;: 레코드 전송 요청 메소드.&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;Partitioner&lt;/strong&gt;: 어느 파티션으로 전송할 지 지정하는 파티셔너. 기본값으로 DefaultPartitioner로 설정됨.&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;Accumulator&lt;/strong&gt;: 배치로 묶어 전송할 데이터를 모으는 버퍼.&lt;/li&gt;
&lt;/ul&gt;
&lt;/br&gt;
&lt;h2&gt;5-1-3) 파티셔너 (Partitioner)&lt;/h2&gt;
&lt;ul&gt;
&lt;li&gt;
&lt;p&gt;프로듀서 API를 사용하면, &lt;code class=&quot;language-text&quot;&gt;UniformStickyPartitioner&lt;/code&gt;와 &lt;code class=&quot;language-text&quot;&gt;RoundRobinPartitioner&lt;/code&gt;가 기본 파티셔너로 제공된다.&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;메시지 키가 있을 경우 두 파티셔너 모두 키에 대한 해시 값으로 특정 파티션에 전송한다. 파티션 개수가 추가되면 이러한 기존의 해시 매핑은 깨지게 된다.&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;메시지 키가 없을 경우에는 각 파티셔너의 알고리즘에 따라 분배된다. 두 파티셔너 모두 레코드를 최대한 동일하게 분배하는데, &lt;code class=&quot;language-text&quot;&gt;UniformStickyPartitioner&lt;/code&gt;는 &lt;code class=&quot;language-text&quot;&gt;RoundRobinPartitioner&lt;/code&gt;의 단점을 개선하였다는 점이 다르다.&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;&lt;code class=&quot;language-text&quot;&gt;RoundRobinPartitioner&lt;/code&gt;: ProducerRecord가 들어오는 순서대로 파티션을 순회하면서 전송. Accumulator에서 묶이는 정도가 적기 때문에 전송 성능이 낮음.&lt;/li&gt;
&lt;li&gt;&lt;code class=&quot;language-text&quot;&gt;UniformStickyPartitioner&lt;/code&gt;: Accumulator에서 레코드들이 배치로 묶일 때까지 기다렸다가 전송. 배치로 묶일 뿐 전송 시에는 순회하면서 보내기 때문에 모든 파티션에 고르게 전송. RoundRobinPartitioner에 비해 나은 성능을 보임. RoundRobinPartitoner과 다른 점은 전송 효율에서의 차이점이 크다.&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;카프카 클라이언트 라이브러리에서는 사용자 정의 파티셔너를 생성하기 위한 Partitioner 인터페이스를 제공하고 있다. Partitioner 인터페이스를 상속받은 사용자 정의 클래스에서 메시지 키 또는 메시지 값에 따른 파티션 지정 로직을 생성할 수 있다. 파티셔너를 통해 파티션이 지정된 데이터는 Accumulator에 버퍼로 쌓인다. Sender 쓰레드는 Accumulator에 쌓인 배치 데이터를 가져가 카프카 브로커로 전송한다.&lt;/p&gt;
&lt;/li&gt;
&lt;/ul&gt;
&lt;/br&gt;
&lt;h2&gt;5-1-4) 프로듀서의 주요 옵션&lt;/h2&gt;
&lt;ul&gt;
&lt;li&gt;&lt;code class=&quot;language-text&quot;&gt;bootstrap.servers&lt;/code&gt;: 프로듀서가 데이터를 전송할 대상 카프카 클러스터에 속한 브로커의 hostname:port를 1개 이상 작성한다. 2개 이상의 브로커를 작성하더라도 일부 브로커에 문제가 생겨도 접속에 문제 없다.&lt;/li&gt;
&lt;li&gt;&lt;code class=&quot;language-text&quot;&gt;key.serializer&lt;/code&gt;: 메시지 키를 직렬화하는 클래스를 지정한다.&lt;/li&gt;
&lt;li&gt;&lt;code class=&quot;language-text&quot;&gt;value.serializer&lt;/code&gt;: 메시지 값을 직렬화하는 클래스를 지정한다.&lt;/li&gt;
&lt;li&gt;보통 serializer로는 string 직렬화를 사용하는데,  int나 floatd으로도 사용 가능하다. string 직렬화는 데이터 사용량이나 통신 사용량이 더 발생하는데, string이 아닌 값들을 모두 string으로 변환하기 때문이다. 하지만 운영상 이점이 있는데, string이 아닌 방식을 사용할 때 발생하는 문제점은 &lt;code class=&quot;language-text&quot;&gt;kafka-console-consumer.sh&lt;/code&gt; 를 통해 메시지를 역직렬화된 모습으로 확인 불가능하다.&lt;/li&gt;
&lt;/ul&gt;
&lt;/br&gt;
&lt;h3&gt;5-1-4-1) 프로듀서의 선택 옵션&lt;/h3&gt;
&lt;ul&gt;
&lt;li&gt;&lt;code class=&quot;language-text&quot;&gt;acks&lt;/code&gt;: 프로듀서가 전송한 데이터가  브로커들에 정상적으로 저장되었는지 전송 여부를 확인하는 데 사용하는 옵션이다. 0, 1, -1로 지정 가능하며 기본 값은 1이다.&lt;/li&gt;
&lt;li&gt;&lt;code class=&quot;language-text&quot;&gt;linger.ms&lt;/code&gt;: 배치를 전송하기 전까지 기다리는 최소 시간이다. 기본 값은 0이다.&lt;/li&gt;
&lt;li&gt;&lt;code class=&quot;language-text&quot;&gt;retries&lt;/code&gt;: 브로커로부터 에러를 받고 난 뒤 재전송을 시도하는 횟수이다. 기본값은 2147483647이다.&lt;/li&gt;
&lt;li&gt;&lt;code class=&quot;language-text&quot;&gt;max.in.flight.requests.per.connection&lt;/code&gt;: 한 번에 요청하는 최대 커넥션 수. 설정된 만큼 동시에 전송을 시도한다. 기본 값은 5이다.&lt;/li&gt;
&lt;li&gt;&lt;code class=&quot;language-text&quot;&gt;partitioner.class&lt;/code&gt;: 레코드를 파티션에 전송할 때 적용하는 파티셔너 클래스를 지정한다. 기본 값은 &lt;code class=&quot;language-text&quot;&gt;org.apache.kafka.clients.producer.internals.DefaultPartitioner&lt;/code&gt;이다.&lt;/li&gt;
&lt;li&gt;&lt;code class=&quot;language-text&quot;&gt;enable.idempotence&lt;/code&gt;: 멱등성 프로듀서로 동작할지에 대한 여부이다. 기본 값은 false이다.&lt;/li&gt;
&lt;li&gt;&lt;code class=&quot;language-text&quot;&gt;transactional.id&lt;/code&gt;: 프로듀서가 레코드를 전송할 때 트랜잭션 단위로 묶을지에 대한 여부를 설정한다. 기본 값은 null이다.&lt;/li&gt;
&lt;/ul&gt;
&lt;/br&gt;
&lt;h2&gt;5-1-5) ISR(In-Sync Replicas) 와 acks 옵션&lt;/h2&gt;
&lt;/br&gt;
&lt;div align=&quot;left&quot;&gt;
  &lt;span class=&quot;gatsby-resp-image-wrapper&quot; style=&quot;position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 630px; &quot;&gt;
      &lt;a class=&quot;gatsby-resp-image-link&quot; href=&quot;/static/36736c322babf98fbd18eac78b0053de/86a1e/%EC%8A%A4%ED%81%AC%EB%A6%B0%EC%83%B7%202025-01-11%20%EC%98%A4%ED%9B%84%202.45.32.png&quot; style=&quot;display: block&quot; target=&quot;_blank&quot; rel=&quot;noopener&quot;&gt;
    &lt;span class=&quot;gatsby-resp-image-background-image&quot; style=&quot;padding-bottom: 45.56962025316456%; position: relative; bottom: 0; left: 0; background-image: url(&apos;data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAJCAYAAAAywQxIAAAACXBIWXMAABYlAAAWJQFJUiTwAAABqklEQVR42lWSSa9BQRSE/XMWlhY2JIgxhpBgYYghMY8xBMHCwsxGJOaZeqkjvPducnL63r5d/XVVK+LxOKxWKzweD1wuF+x2u4wbjQZsNpuMnU6ndIPBgH6/j9vtht1uh/1+j8PhIJ3f+Ch8Ph8SiQR6vR7a7TZKpRKMRiNyuRyCwSC63a6Is5tMJtTrdVlIgefzicfjgePxiNPp9BYMBALI5/NYLpeYz+ciSuJisYhIJILZbIbxeCyd9K1WSxau12sMBgMZXy4XnM/nt6Df7xcaCi4WCxE0m80oFAqIRqNfwel0KpbQotFohGq1ilQqJTDc5Hq9/hImk0mUy2WZpBAJOfZ6vbJZNptFpVKRjZrNphyT3pHq4+GXkD6RJBQKgbSxWAwWiwWZTEaIOEdh+sxQarWa0Gy3228oDIjHFkEKcTGFKZhOp+F2uyWccDgs7w6HQ/5h2iTkQ9H7/f6vGJKCxmu1WiiVSimNRiPmk0Sv10OtVkOlUsl3nU6HTqcjC0lGqk8gLIoqVqvV13TWZDKRcHgcvnOOIbAPh0NsNhu5Mn+vDTvr9XrhB37magd90maJAAAAAElFTkSuQmCC&apos;); background-size: cover; display: block;&quot;&gt;&lt;/span&gt;
  &lt;img class=&quot;gatsby-resp-image-image&quot; alt=&quot;     2025 01 11    2 45 32&quot; title=&quot;&quot; src=&quot;/static/36736c322babf98fbd18eac78b0053de/f058b/%EC%8A%A4%ED%81%AC%EB%A6%B0%EC%83%B7%202025-01-11%20%EC%98%A4%ED%9B%84%202.45.32.png&quot; srcset=&quot;/static/36736c322babf98fbd18eac78b0053de/c26ae/%EC%8A%A4%ED%81%AC%EB%A6%B0%EC%83%B7%202025-01-11%20%EC%98%A4%ED%9B%84%202.45.32.png 158w,
/static/36736c322babf98fbd18eac78b0053de/6bdcf/%EC%8A%A4%ED%81%AC%EB%A6%B0%EC%83%B7%202025-01-11%20%EC%98%A4%ED%9B%84%202.45.32.png 315w,
/static/36736c322babf98fbd18eac78b0053de/f058b/%EC%8A%A4%ED%81%AC%EB%A6%B0%EC%83%B7%202025-01-11%20%EC%98%A4%ED%9B%84%202.45.32.png 630w,
/static/36736c322babf98fbd18eac78b0053de/40601/%EC%8A%A4%ED%81%AC%EB%A6%B0%EC%83%B7%202025-01-11%20%EC%98%A4%ED%9B%84%202.45.32.png 945w,
/static/36736c322babf98fbd18eac78b0053de/78612/%EC%8A%A4%ED%81%AC%EB%A6%B0%EC%83%B7%202025-01-11%20%EC%98%A4%ED%9B%84%202.45.32.png 1260w,
/static/36736c322babf98fbd18eac78b0053de/86a1e/%EC%8A%A4%ED%81%AC%EB%A6%B0%EC%83%B7%202025-01-11%20%EC%98%A4%ED%9B%84%202.45.32.png 1296w&quot; sizes=&quot;(max-width: 630px) 100vw, 630px&quot; style=&quot;width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;&quot; loading=&quot;lazy&quot; decoding=&quot;async&quot;&gt;
  &lt;/a&gt;
    &lt;/span&gt;
&lt;/div&gt;
&lt;/br&gt;
&lt;ul&gt;
&lt;li&gt;&lt;code class=&quot;language-text&quot;&gt;ISR(In-Sync Replicas)&lt;/code&gt;는 리더 파티션과 팔로워 파티션이 모두 싱크된 상태를 의미한다. 즉, 리더 파티션과 모든 팔로워 파티션에 존재하는 오프셋 개수가 동일한 상태를 의미한다.&lt;/li&gt;
&lt;li&gt;ISR이라는 용어가 발생한 이유는 리더 파티션으로부터 데이터를 복제해가는데 시간이 걸리기 때문이다. 프로듀서가 특정 파티션에 데이터를 저장하는 작업은 리더 파티션을 통해 처리한다. 이때 리더 파티션에 새로운 오프셋이 추가되면 팔로워 파티션이 위치한 브로커는 리더 파티션의 데이터를 복제한다. 리더 파티션과 팔로워 파티션에 복제되는 시간차이 때문에 리더 파티션과 팔로워 파티션간에 오프셋 차이가 발생한다.&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;![[스크린샷 2025-01-01 오후 9.00.25.png]]&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;카프카 프로듀서의 &lt;code class=&quot;language-text&quot;&gt;acks&lt;/code&gt; 옵션은 0, 1, -1 (또는 all) 값을 가질 수 있다. 이 옵션을 통해 프로듀서가 전송한 데이터가 카프카에 얼마나 신뢰성 높게 저장할지 지정할 수 있다. 또한 이 때문에 처리 성능이 달라질 수 있다. 복제 개수가 1인 경우에는 큰 차이가 없다. 복제 개수가 2 이상인 경우부터 차이가 발생하므로 2 이상인 경우로 acks별 동작 방식에 대해 알아본다.&lt;/li&gt;
&lt;/ul&gt;
&lt;/br&gt;
&lt;h3&gt;&lt;strong&gt;5-1-5-1) acks = 0&lt;/strong&gt;&lt;/h3&gt;
&lt;ul&gt;
&lt;li&gt;acks를 0으로 설정하는 것은 프로듀서가 리더 파티션으로 데이터를 전송했을 때 리더 파티션에 데이터가 저장되어 있는지 확인하지 않는다는 뜻이다. 리더 파티션은 데이터가 저장된 이후에 데이터가 몇 번재 오프셋에 저장되었는지 리턴하는데, acks가 0으로 설정되어 있다면 프로듀서는 리더 파티션에 데이터가 저장되어 있는지 확인하지 않는다. 데이터 전송 속도는 1 혹은 all인 경우보다 훨씬 빠르다. 데이터 유실이 발생하더라도 전송 속도가 중요하다면 이 옵션을 사용한다.&lt;/li&gt;
&lt;/ul&gt;
&lt;/br&gt;
&lt;h3&gt;&lt;strong&gt;5-1-5-2) acks = 1&lt;/strong&gt;&lt;/h3&gt;
&lt;ul&gt;
&lt;li&gt;acks를 1로 설정하는 것은 프로듀서가 리더 파티션으로 데이터를 전송했을 때 리더 파티션에만 데이터가 저장되어 있는지 확인한다. 리더 파티션에 정상적으로 적재되지 않아다면 리더 파티션에 적재될 때 까지 재시도한다. 그러나 리더 파티션에 적재되더라도 데이터가 유실될 수 있다. 리더 파티션에 적재되었더라도 팔로워 파티션에 적재되기 전에 리더 파티션이 존재하는 브로커에 장애가 발생하면 데이터의 유실이 발생할 수 있다.&lt;/li&gt;
&lt;li&gt;일반적으로는 acks를 1로 설정한다.&lt;/li&gt;
&lt;/ul&gt;
&lt;/br&gt;
&lt;h3&gt;&lt;strong&gt;5-1-5-3) acks = all (or -1)&lt;/strong&gt;&lt;/h3&gt;
&lt;ul&gt;
&lt;li&gt;acks를 -1 혹은 all로 설정하면 프로듀서가 리더 파티션으로 데이터를 전송했을 때 모든 파티션에 데이터가 저장되어 있는지를 확인한다. 리더 파티션과 팔로워 파티션 모두에 적재되었는지를 확인하기 때문에 0 또는 1보다도 처리속도가 느리다. 그럼에도 파티션에 데이터가 정상적으로 적재되었는지 확인하기 때문에 일부 브로커에 장애가 발생하더라도 프로듀서는 안전하게 데이터를 저장하고 전송할 수 있음을 보장한다.&lt;/li&gt;
&lt;li&gt;acks를 all로 설정한 경우 토픽 단위로 설정 가능한 &lt;code class=&quot;language-text&quot;&gt;min.insync.replicas&lt;/code&gt; 옵션값에 따라 안정성이 달라진다. 이 값 만큼 복제본의 개수를 확인하기 때문이다. 이 값을 replication factor 값보다 낮은 값으로 설정하면 모든 팔로워 파티션이 아닌, &lt;code class=&quot;language-text&quot;&gt;min.insync.replicas&lt;/code&gt; 의 값만큼 파티션만 확인한다.&lt;/li&gt;
&lt;/ul&gt;</content:encoded></item><item><title><![CDATA[[Flutter] 01. 왜 Flutter인가?]]></title><description><![CDATA[1. Flutter란? Flutter는 구글에서 개발한 dart 기반의 FE 개발 GUI SDK로, 하나의 코드 베이스로 플랫폼에 무관하게 모두 동작되는 앱을 위해 개발되었다. 즉 Android, Kotlin, Swift, Object-C…]]></description><link>https://github.com/SiverPineValley/SiverPineValley.github.io/flutter/flutter_1/</link><guid isPermaLink="false">https://github.com/SiverPineValley/SiverPineValley.github.io/flutter/flutter_1/</guid><pubDate>Sat, 06 Jan 2024 17:00:00 GMT</pubDate><content:encoded>&lt;h1&gt;1. Flutter란?&lt;/h1&gt;
&lt;p&gt;Flutter는 구글에서 개발한 dart 기반의 FE 개발 GUI SDK로, 하나의 코드 베이스로 플랫폼에 무관하게 모두 동작되는 앱을 위해 개발되었다. 즉 Android, Kotlin, Swift, Object-C와 같은 Native 앱 개발 언어들과 다르게 크로스 플랫폼을 지향한다고 볼 수 있다. 시장에서의 위치는 React Native와 유사한 위치라고 보여진다.&lt;/p&gt;
&lt;/br&gt;
&lt;p&gt;React Native와 Flutter는 실제로도 많은 부분에서 유사점이 존재한다. React는 페이스북에서 만들어져있으며, 개발자에게 렌더링보다는 구현 코드와 상태 관리에만 더욱 신경쓸 수 있도록 렌더링의 복잡도를 줄일 수 있는 방법을 사용하였다. 흔히 DOM을 사용하여 화면을 렌더링하는데, 화면이 수정될 때마다 DOM 전체를 새로 그리는 방식이 아닌, 수정된 부분을 비교하여 반영하는 방식이다. Dart기반의 Flutter는 이러한 방식과 유사하게 Skia를 사용하여 렌더링한다. 물론 성능 면에서는 Flutter가 훨씬 낫다는 평가가 많다.&lt;/p&gt;
&lt;/br&gt;
&lt;p&gt;또한, Reactive는 각 컴포넌트들을 부품화하여 관리하는데 Dart에서도 Widget 단위로 관리한다. 구조상 많은 부분이 React에서 차용되었음을 알 수 있다.&lt;/p&gt;
&lt;/br&gt;
&lt;h1&gt;2. 왜 FE 언어로 Flutter를 선택하였는가?&lt;/h1&gt;
&lt;p&gt;이 부분은 FE언어로 Flutter를 선택하였을 때 설득할 수 있는 내용들을 담아봤다.&lt;/p&gt;
&lt;h2&gt;2.1 비교적 짧은 러닝 커브&lt;/h2&gt;
&lt;p&gt;나같은 경우 깊게는 아니지만 짧게 나마 React Native도 사용해보았다. 둘 다 사용해본 결과 어느 정도 구조에 대한 이해와 문법 등에서 Flutter를 통해 동일한 기능을 구현해내는데 더 짧은 시간이 걸렸던 것 같다. 물론, Flutter를 React Native 사용 이후에 배우면서 어느 정도 FE 개발 개념이 자리잡힌 상태라서 더 생산성이 좋았을 순 있을 것 같다.&lt;/p&gt;
&lt;/br&gt;
&lt;h2&gt;2.2 Google에서 공식적으로 관리하는 언어&lt;/h2&gt;
&lt;p&gt;특정 기업의 기술을 맹신하는 것은 아니지만, Go를 사용하여 수 년 간 BE 개발을 진행해본 결과 상당히 좋은 성능과 신뢰성을 얻을 수 있었다. 업데이트도 주기적으로 자주 발생하며 성능적인 이슈도 자주 사용되는 언어들에 비해 더 나은 편이라고 생각된다. 또한, 다시 한 번 언급하지만 다양한 언어의 장단점을 고려하여 비교적 최근에 만들어지다 보니 러닝 커브 역시 비교적 짧은 편이었던 것 같다.&lt;/p&gt;
&lt;/br&gt;
&lt;h2&gt;2.3 생태계 이슈&lt;/h2&gt;
&lt;p&gt;그럼에도 불구하고 Reactive나 Native 앱들이 구축해온 생태계에 비하면 아직 작은 수준이라고 할 수는 있다. 특히 아무리 성능적으로 좋은 편이라고 해도 Native 앱들이 지원하는 수준에 비하면 아직 덜 지원되거나 성능적으로 열화판인 경우가 종종 존재하기는 한다. 이러한 부분은 시간이 지나면서 어느 정도 메워지기 때문에 (차후 크로스 플랫폼들에서도 지원되는 경우가 많은 것 같다.) 급한 기능이 아니라면 크로스 플랫폼을 사용함에 있어서 감수해야 하는 페널티라고 생각된다. 솔직히 한 번의 개발으로 모든 플랫폼에서 돌아간다는데... 이 정도 패널티는 있어야 하지 않을까?&lt;/p&gt;
&lt;/br&gt;
&lt;h2&gt;2.4 직관적인 구조&lt;/h2&gt;
&lt;p&gt;FE 초보자인 나는 화면 개발 시 항상 맞이하게 되는 난관은 상태 관리와 화면에서의 UI 배치에서 많은 어려움을 겪었던 것 같다. 특히 수직, 수평배치 시 화면의 크기에 따라 화면이 이상하게 깨지는 경우가 많았는데, 이를 위해서 다양한 플랫폼에서의 테스트도 필요했던 것으로 기억한다. Flutter를 사용하면서 이러한 불편함이 많이 개선되었다고 느껴졌다. Native한 위젯을 사용하여 직관적으로 화면을 분리하고 관리할 수 있다는 점이 인상깊었던 것 같다.&lt;/p&gt;
&lt;/br&gt;
&lt;p&gt;또한, 상태관리 기법이 여러 가지 존재하는데, 개념은 비슷하지만 각 기법마다 중요시되는 개념과 용어가 조금씩 다르다. 결론적으로는 어느 기법을 사용하더라도 동일한 기능의 구현은 가능하나, 중요시되는 관점의 차이인 것 같았다. 이만큼 Flutter는 상태 관리에 진심인 편이다.&lt;/p&gt;
&lt;/br&gt;
&lt;h2&gt;2.5 디버깅&lt;/h2&gt;
&lt;p&gt;Javascript 기반의 언어에 비해 눈에 띄게 좋아진 점이라고 생각된다. Typescript를 통해 이러한 문제를 어느 정도 잡았다고는 하나, 그럼에도 불편한 것이 많았는데 특히, 디버깅 시에도 잡아주는 에러가 많다는 것. 앱 개발 시 발생하는 시행착오와 생산성에서 매우 중요한 부분이라고 생각된다.&lt;/p&gt;
&lt;/br&gt;
&lt;h2&gt;2.6 Firebase 지원&lt;/h2&gt;
&lt;p&gt;다른 FE 개발 언어에 비해 비교적 최근이긴 하지만, Flutter3.0이 릴리즈되면서 공식적으로 Firebase에서도 지원이 가능해졌다. 이로써 Flutter를 선택할만한 이유가 하나 더 추가되었다.&lt;/p&gt;
&lt;/br&gt;
&lt;h1&gt;3. 출처&lt;/h1&gt;
&lt;p&gt;&lt;a href=&quot;https://yozm.wishket.com/magazine/detail/1566/&quot;&gt;https://yozm.wishket.com/magazine/detail/1566/&lt;/a&gt;&lt;/br&gt;
&lt;a href=&quot;https://namu.wiki/w/Flutter(%ED%94%84%EB%A0%88%EC%9E%84%EC%9B%8C%ED%81%AC)#s-2.1&quot;&gt;https://namu.wiki/w/Flutter(%ED%94%84%EB%A0%88%EC%9E%84%EC%9B%8C%ED%81%AC)#s-2.1&lt;/a&gt;&lt;/br&gt;&lt;/p&gt;</content:encoded></item><item><title><![CDATA[[k8s] Vagrant + VirtualBox + Kubeadm으로 Local Lab 환경 구축]]></title><description><![CDATA[얼마 전 wsl2 커널을 잘못 건드렸다가 설치된 리눅스가 먹통이 되면서 재설치를 한 적이 있다. 재설치가 끝난 후 Virtual Box로 구성해놓은 k8s…]]></description><link>https://github.com/SiverPineValley/SiverPineValley.github.io/kubernetes/k8s_local_lab/</link><guid isPermaLink="false">https://github.com/SiverPineValley/SiverPineValley.github.io/kubernetes/k8s_local_lab/</guid><pubDate>Mon, 21 Aug 2023 20:30:00 GMT</pubDate><content:encoded>&lt;p&gt;얼마 전 wsl2 커널을 잘못 건드렸다가 설치된 리눅스가 먹통이 되면서 재설치를 한 적이 있다. 재설치가 끝난 후 Virtual Box로 구성해놓은 k8s 클러스터 랩 환경이 박살나 있어서 다시 구축하려니 기존과 똑같이 하는데도 잘 안되는 부분이 있었다. 기존에는 &lt;a href=&quot;https://autoever.udemy.com/course/certified-kubernetes-administrator-with-practice-tests/learn/lecture/20666298?start=1410#overview&quot;&gt;CKA 강의&lt;/a&gt;를 보며 쉽게 구축했었는데, 다시 하려니 자꾸 뭔가가 안되는 것이다.&lt;/p&gt;
&lt;/br&gt;
&lt;p&gt;구체적으로는 kubeadm으로 초기 클러스터를 구성하고, CNI를 설치하였는데 &lt;code class=&quot;language-text&quot;&gt;kube-system&lt;/code&gt; 네임 스페이스의 Pod들이 제대로 기동되지 않고 자꾸 재기동되는 현상이 발생하는 것이다. 또한, &lt;code class=&quot;language-text&quot;&gt;kube-apiserver&lt;/code&gt; 역시 자꾸 다운되다보니 kubectl 명령어도 먹통이되고 트러블 슈팅 자체가 안되서 2주간 엄청난 삽질을 거듭했었다.&lt;/p&gt;
&lt;/br&gt;
&lt;p&gt;그러다 우연하게 세팅한 것이 제대로 적용되지 않았던 점이 문제였던 것을 발견하게 되었고, 나처럼 삽질하는 사람이 없었으면 하는 마음에 블로그에 끄적이게 되었다.&lt;/p&gt;
&lt;/br&gt;
&lt;h1&gt;Vagrant + VirtualBox + kubeadm 으로 Local Lab 환경을 구축해보자&lt;/h1&gt;
&lt;p&gt;사실 로컬 환경에서 도커만 설치되어 있다면 쿠버네티스 클러스터를 구축하여 실습 가능한 여러 방법들이 있다. 다만 여러 이유에서 이러한 방법들을 제하고 Vagrant를 이용한 프로비저닝을 선택하게 되었다.&lt;/p&gt;
&lt;/br&gt;
&lt;h2&gt;Tools for setting up Kubernetes clusters in a local environment&lt;/h2&gt;
&lt;/br&gt;
&lt;h3&gt;Minikube&lt;/h3&gt;
&lt;/br&gt;
&lt;p&gt;&lt;a href=&quot;https://minikube.sigs.k8s.io/docs/start/&quot;&gt;minikube&lt;/a&gt;&lt;/p&gt;
&lt;/br&gt;
&lt;p&gt;가장 많이 사용되는 방법인데, CLI를 다운받아 설치하고 Virtual Box에 단일 클러스터로 구축된다. 사용 방법이 쉽고 간단하나 단일 클러스터로 구축된다. 멀티 클러스터를 구축하여 실습하고 싶은 나에게는 좋은 선택지가 아니였다.&lt;/p&gt;
&lt;/br&gt;
&lt;h3&gt;Kind&lt;/h3&gt;
&lt;/br&gt;
&lt;p&gt;&lt;a href=&quot;https://kind.sigs.k8s.io/&quot;&gt;kind&lt;/a&gt;&lt;/p&gt;
&lt;/br&gt;
&lt;p&gt;로컬에 Docker 데몬이 돌아간다면 역시나 쉽게 구축이 가능하다. YAML 파일에 마니페스트를 작성하여 멀티 클러스터로 구축 가능하다. 다만, MacOS나 Windows 환경일 경우에 일부 기능이 제한된다. 대표적으로 로드밸런스나 인그레스 기능을 사용하려다가 머리가 터질 뻔한 적이 있다. 간단하게 Pod를 배포하고 클러스터 내에서 잘 동작하는지 확인하는 것이 목적이라면 Kind를 사용해도 어느 정도 실습은 가능하다.&lt;/p&gt;
&lt;/br&gt;
&lt;h3&gt;Vagrant&lt;/h3&gt;
&lt;p&gt;Vagrant는 HashCorp에서 만든 프로비저닝 툴로, Vagrantfile에 이미지와 생성될 VM의 설정 파일을 미리 스크립트화 하여 이를 제공한다. 즉, 가상화 소프트웨어를 사용하여 Vagrantfile에 작성된 대로 VM을 생성하여 설정을 프로비저닝해주는 역할이라고 할 수 있다. Vagrant에는 Vagrantfile이라는 VM에 대한 설정 정보를 담는 파일이 있는데, Ruby 문법을 따르나 문법 자체가 복잡하지는 않다 보니 대충 찾아서 해봐도 어느 정도 쉽게 설정이 가능하다. 제목이 &lt;code class=&quot;language-text&quot;&gt;Vagrant + VirtualBox + kubeadm 으로 Local Loab 환경을 구축해보자&lt;/code&gt;인 만큼 필수로 설치가 필요하다.&lt;/p&gt;
&lt;p&gt;Vagrant는 기존 Virtual Box를 사용하는 것과 다르게 다음과 같은 특징들을 가진다.&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;커맨드 하나로 가상 구축이 완료된다.&lt;/li&gt;
&lt;li&gt;가상 머신의 설정이 간단하다.&lt;/li&gt;
&lt;li&gt;설정 정보의 공유가 가능하다.&lt;/li&gt;
&lt;li&gt;환경 구축을 자동화할 수 있다.&lt;/li&gt;
&lt;/ul&gt;
&lt;/br&gt;
&lt;p&gt;Vagrantfile은 앞서 설명한 대로 Vagrant를 통해 구축할 VM의 설정 정보가 담기는데, 보통 설정하는 부분은 대부분 각 VM이 가질 네트워크 I/F의 IP 주소, 각 VM의 hostname, VM에서 사용할 이미지 정보, 22번 포트를 로컬 PC로 포워딩할 때 사용할 포트 정보, 프로비저닝 후 VM에서 실행할 sh 파일 등에 대한 정의, 접속 정보 등을 설정할 수 있다.&lt;/p&gt;
&lt;/br&gt;
&lt;h2&gt;Prerequisite&lt;/h2&gt;
&lt;p&gt;본격적인 설치 과정에 앞서, 다음과 같은 것들이 준비되어 있어야 한다. Virtual Box는 Vagrant를 통해 프로비저닝되는 VM이 올라갈 하이퍼바이저 역할을 한다. 다른 가상화 툴도 사용이 가능하다고는 하나, Virtual Box에서 가장 안정적으로 구축된다고 한다. Tabby는 SSH를 통해 VM에 접속할 때 사용할 툴로, Putty와 같은 간단한 툴로도 대체 가능하다.&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;&lt;a href=&quot;https://www.virtualbox.org/&quot;&gt;Virtual Box&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href=&quot;https://www.vagrantup.com/&quot;&gt;Vagrant&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href=&quot;https://tabby.sh/&quot;&gt;Tabby&lt;/a&gt;&lt;/li&gt;
&lt;/ul&gt;
&lt;/br&gt;
&lt;h2&gt;Installation&lt;/h2&gt;
&lt;h3&gt;1. Vagrant Manifest clone and Vagrant up&lt;/h3&gt;
&lt;p&gt;먼저, Vagrant와 Virtual Box를 사용하여 VM을 프로비저닝 해야 한다. 리눅스 버전은 Ubuntu 22.04.3 (Jammy Jellyfish)을 사용하였고, 최대한 깨끗한 형태로 준비하였다. Vagrantfile의 설정에서 볼 수 있듯이, k8s 클러스터 내의 Pod 네트워크 구성을 위해 enp0s8 I/F를 추가하였고, 각 VM의 IP주소와 호스트네임을 매핑하여 로컬 DNS 파일(/etc/hosts)에 추가하였다. 이는 구성된 VM에 접속하여 &lt;code class=&quot;language-text&quot;&gt;ip add&lt;/code&gt; 명령어를 통해 확인 가능하다.&lt;/p&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;sh&quot;&gt;&lt;pre class=&quot;language-sh&quot;&gt;&lt;code class=&quot;language-sh&quot;&gt;&lt;span class=&quot;token function&quot;&gt;git&lt;/span&gt; clone https://github.com/SiverPineValley/k8s_installation_by_kubeadm.git
&lt;span class=&quot;token builtin class-name&quot;&gt;cd&lt;/span&gt; k8s_installation_by_kubeadm
vagrant up&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;br&gt;
&lt;h4&gt;1-1. Troubleshooting &apos;vagrant up&apos; in the Windows environment&lt;/h4&gt;
&lt;p&gt;vagrant up으로 모든 환경에서 한 번에 구축이 되면 참 좋을 것 같지만, Windows 환경에서 간혹 네트워크 구성 에러가 발생하기도 한다. 그럴 경우 아래와 같이 [파일 탐색기 네트워크 오른쪽 버튼] -&gt; [&lt;code class=&quot;language-text&quot;&gt;네트워크 및 공유 센터&lt;/code&gt;] -&gt; [좌측 하단 &lt;code class=&quot;language-text&quot;&gt;어댑터 설정 변경&lt;/code&gt;] -&gt; [Vagrant로 추가된 이더넷 사용 안 함] -&gt; [다시 사용] 설정한 뒤, 다시 &lt;code class=&quot;language-text&quot;&gt;vagrant up&lt;/code&gt; 해주면 다음으로 진행된다. 아마 Virtual Box를 통해 이더넷이 제대로 구성되기 전에 다음으로 넘어가다가 에러가 나는 듯 싶다.&lt;/p&gt;
&lt;/br&gt;
&lt;div align=&quot;left&quot;&gt;
  &lt;span class=&quot;gatsby-resp-image-wrapper&quot; style=&quot;position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 630px; &quot;&gt;
      &lt;a class=&quot;gatsby-resp-image-link&quot; href=&quot;/static/8349db4651ffb03e82283f4fa1250979/374ac/vagrant_ethernet.png&quot; style=&quot;display: block&quot; target=&quot;_blank&quot; rel=&quot;noopener&quot;&gt;
    &lt;span class=&quot;gatsby-resp-image-background-image&quot; style=&quot;padding-bottom: 63.291139240506325%; position: relative; bottom: 0; left: 0; background-image: url(&apos;data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAANCAYAAACpUE5eAAAACXBIWXMAAA7DAAAOwwHHb6hkAAABrElEQVR42p2T63KbMBCFef8n6WO0P9qZZNofsYMBg+M4AYSQuAls7pyulLS1p+2MnZ05aJDQp9XZxWIpB+ccQkgMfQ8dy7JgmZe38UzzPF/OYfnr3dIPHV3XQeQSqqpQvSuTEmkqUNc1yrIEYwx5nv/zALyP1rFRqJsGqjniJeKImATjEiFLIbICDa2zhEOp2ojRfMIFMlrruxY8lYjp+ziRKKsG1r1XIUwVXTsh8BHDOJFG9MNIec/4EdS4CxQenlM8hgWeigm7fMAu6xGQpOrM7TqyS++z7myOVcAgRUqnZmjb1uh0OhngF6fEp28hPm9zfH1wsXJ8fF85sINnRKIkm0oURWFs0WHBGDtjmmaMdMKlJkzky2mcodoJija5Gxues0FdlSjzjGA5JHmtvTXA5a0m/4+z9ZiK4rgOfN9HFMUGJISgwqV/gLiC90txksAloG3bWK/XOBwOBqrb7mrgeRxeX7DdugYUhqFpI+2fhurxZqD/tKPsHuF53u/sdGb62h/K8DUKsaGi7Pd741tCFujr6kx1498M1H+GrrzugGEYLqTXbgZeEz8BdKPrmr8YYycAAAAASUVORK5CYII=&apos;); background-size: cover; display: block;&quot;&gt;&lt;/span&gt;
  &lt;img class=&quot;gatsby-resp-image-image&quot; alt=&quot;vagrant ethernet&quot; title=&quot;&quot; src=&quot;/static/8349db4651ffb03e82283f4fa1250979/f058b/vagrant_ethernet.png&quot; srcset=&quot;/static/8349db4651ffb03e82283f4fa1250979/c26ae/vagrant_ethernet.png 158w,
/static/8349db4651ffb03e82283f4fa1250979/6bdcf/vagrant_ethernet.png 315w,
/static/8349db4651ffb03e82283f4fa1250979/f058b/vagrant_ethernet.png 630w,
/static/8349db4651ffb03e82283f4fa1250979/374ac/vagrant_ethernet.png 634w&quot; sizes=&quot;(max-width: 630px) 100vw, 630px&quot; style=&quot;width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;&quot; loading=&quot;lazy&quot; decoding=&quot;async&quot;&gt;
  &lt;/a&gt;
    &lt;/span&gt;
&lt;/div&gt;
&lt;/br&gt;
&lt;h3&gt;2. SSH Connection&lt;/h3&gt;
&lt;p&gt;vagrant로 구성한 VM은 &lt;code class=&quot;language-text&quot;&gt;vagrant ssh&lt;/code&gt; 명령어를 통해 접속이 가능하다. 다만, 이 방법은 매번 번거로운데 tabby를 통해 쉽게 접속하는 방법이 있다. 내가 구성한 이미지의 경우 SSH 접속을 private_key를 통해서만 가능하도록 설정되어 있는데, 이 key 파일은 &lt;code class=&quot;language-text&quot;&gt;{Installation Path}/certified-kubernetes-administrator-course-master/.vagrant/machines/kubemaster/virtualbox/private_key&lt;/code&gt; 에 있다.&lt;/p&gt;
&lt;/br&gt;
&lt;p&gt;Tabby에서 새로운 프로필을 생성하면서, 인증 방법에서 키를 선택하고 위의 경로대로 private key를 선택해주면 tabby에서 인증 정보를 저장해줘서 쉽게 접속이 가능하다. 접속 포트 정보는 Vagrant에서 설정한대로 &lt;code class=&quot;language-text&quot;&gt;kubemaster: 2711&lt;/code&gt;, &lt;code class=&quot;language-text&quot;&gt;kubenode01: 2721&lt;/code&gt;, &lt;code class=&quot;language-text&quot;&gt;kubenode02: 2722&lt;/code&gt;로 설정하면 된다.&lt;/p&gt;
&lt;/br&gt;
&lt;div align=&quot;left&quot;&gt;
  &lt;span class=&quot;gatsby-resp-image-wrapper&quot; style=&quot;position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 630px; &quot;&gt;
      &lt;a class=&quot;gatsby-resp-image-link&quot; href=&quot;/static/5488283cf2ba363bda418b59739cbc76/898f6/tabby.png&quot; style=&quot;display: block&quot; target=&quot;_blank&quot; rel=&quot;noopener&quot;&gt;
    &lt;span class=&quot;gatsby-resp-image-background-image&quot; style=&quot;padding-bottom: 70.25316455696203%; position: relative; bottom: 0; left: 0; background-image: url(&apos;data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAOCAYAAAAvxDzwAAAACXBIWXMAAA7EAAAOxAGVKw4bAAACV0lEQVR42n1T2VLbQBDUhwDGYFv3LVmSZUvygS+IzU0oXlJ8Tf4gL/nXTu/4KKAqPHS1dlfTO9Mzq+XTFaabB0x/3MMvG3SCFL0oE3TDjOu+8Ecc9g7ci3JBl2stGE1hFw3svIbZH0JPBgKDsLh2ixpWWsq3k1fESNjql3se7kWLnWBULTEYrxlU49zNcOHnaDkZ3HKGcn6NpL5Cf7xAOJwgYzX9yQLFbI1wNEE+WSJt5tDjQtANVYYMdBLeEhRoK0FvJ+oWYyzunhHXM0TDMQxacKq7ODM9nBkeWpaPE8NBx0/gF5WsL5wImpkUCAY1vGyIgAceSzrVHRhxjgl9rddbltOnYC4BF65CvOcIl16MHjOTMyUY0cNgMJZNJaIzsOOnzDhDWs3kopbp49wO0P4PjmdOuMswZIYW+bRn46Rrwavm0qioHMOkN6qcth1K4GeEn3gvOBBDD23X2bE2S7KzEVaPr1g9vGJ++4zZ5lH46vZpx9sn2VvcvRw5ZQOlZNX6HkUtivsUOjNcGRUlpkSvn96wuP+JJdfL/d7i/kVE1PeczVP/ZJwGTbW9Wm5QrbYyDnpccg4r+lkgrqY4Zxktc1eW8lZ5rBqkf4Cq7tJLpEGaDCyzsvdsMrNuWEBZMZyvOTINwrLm7Ve8+Ia+NoJw0MCn9xHnM+C3rhpJUe3rsxIvyeqiarXB+ObuCFVBJ9g9uY48vRQdzyN8tDghLa61wzv8iq4aHwZdquAPOP7DMdOTGnbzDrP5hW0wwsj9RvB7cCrCBEa+QvD4F+7DH/x2Zng3U/wDiK7HUdG2ePkAAAAASUVORK5CYII=&apos;); background-size: cover; display: block;&quot;&gt;&lt;/span&gt;
  &lt;img class=&quot;gatsby-resp-image-image&quot; alt=&quot;tabby&quot; title=&quot;&quot; src=&quot;/static/5488283cf2ba363bda418b59739cbc76/f058b/tabby.png&quot; srcset=&quot;/static/5488283cf2ba363bda418b59739cbc76/c26ae/tabby.png 158w,
/static/5488283cf2ba363bda418b59739cbc76/6bdcf/tabby.png 315w,
/static/5488283cf2ba363bda418b59739cbc76/f058b/tabby.png 630w,
/static/5488283cf2ba363bda418b59739cbc76/898f6/tabby.png 798w&quot; sizes=&quot;(max-width: 630px) 100vw, 630px&quot; style=&quot;width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;&quot; loading=&quot;lazy&quot; decoding=&quot;async&quot;&gt;
  &lt;/a&gt;
    &lt;/span&gt;
&lt;/div&gt;
&lt;/br&gt;
&lt;h3&gt;3. CRI (Container Runtime Interface)&lt;/h3&gt;
&lt;/br&gt;
&lt;p&gt;&lt;a href=&quot;https://kubernetes.io/docs/setup/production-environment/container-runtimes/#containerd&quot;&gt;CRI (Container Runtime Interface)&lt;/a&gt;&lt;/p&gt;
&lt;/br&gt;
&lt;p&gt;앞선 방법을 잘 따라왔으면, Virtual Box에 kubemaster, kubenode01, kubenode02 와 같이 세 개의 VM이 구성되어 있는 것을 볼 수 있다. 이제부터 본격적으로 k8s 클러스터를 구성할 예정인데, 각 VM에서 모두 동일한 방법으로 설치를 진행해야 한다.&lt;/p&gt;
&lt;/br&gt;
&lt;p&gt;kubeadm을 본격적으로 설치하기 전에 사전에 &lt;code class=&quot;language-text&quot;&gt;CRI(Container Runtime Interface)&lt;/code&gt;을 설치해줘야 한다. 각 노드에서 k8s에서 Scheduler를 통해 전송된 컨테이너 생성 요청을 kubelet이 전달받고, kubelet이 해당 노드에 컨테이너를 생성하기 위해 사용하는 플러그인 인터페이스이다. 즉, 컨테이너 런타임(실제로 컨테이너 생성)과 kubelet(각 노드에서 엔드포인트 역할을 하며 컨테이너 생성에 관여) 사이에서 통신을 위한 주요 프로토콜이라고 보면 된다.&lt;/p&gt;
&lt;/br&gt;
&lt;p&gt;k8s에서는 이러한 CRI 표준을 따르는 대부분의 플러그인들을 지원하는데, 대표적으로 &lt;a href=&quot;https://kubernetes.io/docs/setup/production-environment/container-runtimes/#docker&quot;&gt;Docker Engine&lt;/a&gt;, &lt;a href=&quot;https://kubernetes.io/docs/setup/production-environment/container-runtimes/#cri-o&quot;&gt;CRI-O&lt;/a&gt;, &lt;a href=&quot;https://kubernetes.io/docs/setup/production-environment/container-runtimes/#containerd&quot;&gt;containerd&lt;/a&gt; 등이 있는데, 우리는 여기서 &lt;code class=&quot;language-text&quot;&gt;containerd&lt;/code&gt;를 사용할 예정이다.&lt;/p&gt;
&lt;/br&gt;
&lt;p&gt;과거에는 k8s에서도 Docker Engine만을 지원했었다. 하지만, Docker에는 컨테이너를 생성하고 관리하는 역할 뿐만 아니라, API, CLI, 네트워크, 스토리지 등 다양한 기능들이 한데 뭉쳐 있었다. Docker 측에서는 이러한 &lt;code class=&quot;language-text&quot;&gt;Monolithic&lt;/code&gt;한 구조를 탈피하고자 기능별로 나누는 작업을 시작했다. Docker 버전이 올라가면서 많은 부분이 변경되었고 이에 종속되어 있던 k8s에도 큰 영향을 끼치게 되자, Docker를 중심으로 구글 등 컨테이너에 관심이 있는 여러 집단이 모여 Open Container Initiative, 일명 OCI 프로젝트를 시작하게 된다. OCI는 Container Runtime에 대한 표준을 정하였고, Docker에서는 이러한 표준을 지키기 위해 Container Runtime으로 containerd를 만들게 된다.&lt;/p&gt;
&lt;/br&gt;
&lt;p&gt;요약하자면, containerd는 Docker에서 Container Runtime 기능만을 수행하는 플러그인이라고 보면 된다. 최근 버전의 k8s에서는 이러한 OCI 표준을 지키는 거의 모든 CRI를 지원하므로, Docker 보다 훨씬 가벼운 containerd 만 설치할 예정이다. 참고로, containerd의 CLI는 &lt;code class=&quot;language-text&quot;&gt;crictl&lt;/code&gt; 이다. &lt;code class=&quot;language-text&quot;&gt;docker&lt;/code&gt; 명령어와 매우 유사한 I/F를 가지므로 찾아보길 권장한다. k8s가 비정상 작동할 때 이러한 &lt;code class=&quot;language-text&quot;&gt;crictl&lt;/code&gt; 명령어를 쓸 일이 많을 것이다.&lt;/p&gt;
&lt;/br&gt;
&lt;p&gt;먼저, IPv4를 포워딩하여 iptables가 브리지된 트래픽을 보게 하는 작업을 수행해줘야 한다.&lt;/p&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;sh&quot;&gt;&lt;pre class=&quot;language-sh&quot;&gt;&lt;code class=&quot;language-sh&quot;&gt;&lt;span class=&quot;token function&quot;&gt;cat&lt;/span&gt; &lt;span class=&quot;token operator&quot;&gt;&amp;lt;&amp;lt;&lt;/span&gt;&lt;span class=&quot;token string&quot;&gt;EOF&lt;span class=&quot;token bash punctuation&quot;&gt; &lt;span class=&quot;token operator&quot;&gt;|&lt;/span&gt; &lt;span class=&quot;token function&quot;&gt;sudo&lt;/span&gt; &lt;span class=&quot;token function&quot;&gt;tee&lt;/span&gt; /etc/modules-load.d/k8s.conf&lt;/span&gt;
overlay
br_netfilter
EOF&lt;/span&gt;

&lt;span class=&quot;token function&quot;&gt;sudo&lt;/span&gt; modprobe overlay
&lt;span class=&quot;token function&quot;&gt;sudo&lt;/span&gt; modprobe br_netfilter

&lt;span class=&quot;token comment&quot;&gt;# sysctl params required by setup, params persist across reboots&lt;/span&gt;
&lt;span class=&quot;token function&quot;&gt;cat&lt;/span&gt; &lt;span class=&quot;token operator&quot;&gt;&amp;lt;&amp;lt;&lt;/span&gt;&lt;span class=&quot;token string&quot;&gt;EOF&lt;span class=&quot;token bash punctuation&quot;&gt; &lt;span class=&quot;token operator&quot;&gt;|&lt;/span&gt; &lt;span class=&quot;token function&quot;&gt;sudo&lt;/span&gt; &lt;span class=&quot;token function&quot;&gt;tee&lt;/span&gt; /etc/sysctl.d/k8s.conf&lt;/span&gt;
net.bridge.bridge-nf-call-iptables  = 1
net.bridge.bridge-nf-call-ip6tables = 1
net.ipv4.ip_forward                 = 1
EOF&lt;/span&gt;

&lt;span class=&quot;token comment&quot;&gt;# Apply sysctl params without reboot&lt;/span&gt;
&lt;span class=&quot;token function&quot;&gt;sudo&lt;/span&gt; &lt;span class=&quot;token function&quot;&gt;sysctl&lt;/span&gt; &lt;span class=&quot;token parameter variable&quot;&gt;--system&lt;/span&gt;

lsmod &lt;span class=&quot;token operator&quot;&gt;|&lt;/span&gt; &lt;span class=&quot;token function&quot;&gt;grep&lt;/span&gt; br_netfilter
lsmod &lt;span class=&quot;token operator&quot;&gt;|&lt;/span&gt; &lt;span class=&quot;token function&quot;&gt;grep&lt;/span&gt; overlay

&lt;span class=&quot;token function&quot;&gt;sysctl&lt;/span&gt; net.bridge.bridge-nf-call-iptables net.bridge.bridge-nf-call-ip6tables net.ipv4.ip_forward&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;/br&gt;
&lt;p&gt;다음으로는, &lt;a href=&quot;https://docs.docker.com/engine/install/ubuntu/&quot;&gt;containerd&lt;/a&gt;를 설치하면 된다.&lt;/p&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;sh&quot;&gt;&lt;pre class=&quot;language-sh&quot;&gt;&lt;code class=&quot;language-sh&quot;&gt;&lt;span class=&quot;token comment&quot;&gt;# Remove Previous Docker&lt;/span&gt;
&lt;span class=&quot;token keyword&quot;&gt;for&lt;/span&gt; &lt;span class=&quot;token for-or-select variable&quot;&gt;pkg&lt;/span&gt; &lt;span class=&quot;token keyword&quot;&gt;in&lt;/span&gt; docker.io docker-doc &lt;span class=&quot;token function&quot;&gt;docker-compose&lt;/span&gt; podman-docker containerd runc&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt; &lt;span class=&quot;token keyword&quot;&gt;do&lt;/span&gt; &lt;span class=&quot;token function&quot;&gt;sudo&lt;/span&gt; &lt;span class=&quot;token function&quot;&gt;apt-get&lt;/span&gt; remove &lt;span class=&quot;token variable&quot;&gt;$pkg&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt; &lt;span class=&quot;token keyword&quot;&gt;done&lt;/span&gt;

&lt;span class=&quot;token function&quot;&gt;sudo&lt;/span&gt; &lt;span class=&quot;token function&quot;&gt;apt-get&lt;/span&gt; update
&lt;span class=&quot;token function&quot;&gt;sudo&lt;/span&gt; &lt;span class=&quot;token function&quot;&gt;apt-get&lt;/span&gt; &lt;span class=&quot;token function&quot;&gt;install&lt;/span&gt; ca-certificates &lt;span class=&quot;token function&quot;&gt;curl&lt;/span&gt; gnupg
&lt;span class=&quot;token function&quot;&gt;sudo&lt;/span&gt; &lt;span class=&quot;token function&quot;&gt;install&lt;/span&gt; &lt;span class=&quot;token parameter variable&quot;&gt;-m&lt;/span&gt; 0755 &lt;span class=&quot;token parameter variable&quot;&gt;-d&lt;/span&gt; /etc/apt/keyrings
&lt;span class=&quot;token function&quot;&gt;curl&lt;/span&gt; &lt;span class=&quot;token parameter variable&quot;&gt;-fsSL&lt;/span&gt; https://download.docker.com/linux/ubuntu/gpg &lt;span class=&quot;token operator&quot;&gt;|&lt;/span&gt; &lt;span class=&quot;token function&quot;&gt;sudo&lt;/span&gt; gpg &lt;span class=&quot;token parameter variable&quot;&gt;--dearmor&lt;/span&gt; &lt;span class=&quot;token parameter variable&quot;&gt;-o&lt;/span&gt; /etc/apt/keyrings/docker.gpg
&lt;span class=&quot;token function&quot;&gt;sudo&lt;/span&gt; &lt;span class=&quot;token function&quot;&gt;chmod&lt;/span&gt; a+r /etc/apt/keyrings/docker.gpg
&lt;span class=&quot;token builtin class-name&quot;&gt;echo&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;\&lt;/span&gt;
  &lt;span class=&quot;token string&quot;&gt;&quot;deb [arch=&quot;&lt;/span&gt;&lt;span class=&quot;token variable&quot;&gt;&lt;span class=&quot;token variable&quot;&gt;$(&lt;/span&gt;dpkg --print-architecture&lt;span class=&quot;token variable&quot;&gt;)&lt;/span&gt;&lt;/span&gt;&lt;span class=&quot;token string&quot;&gt;&quot; signed-by=/etc/apt/keyrings/docker.gpg] https://download.docker.com/linux/ubuntu \
  &quot;&lt;/span&gt;&lt;span class=&quot;token variable&quot;&gt;&lt;span class=&quot;token variable&quot;&gt;$(&lt;/span&gt;&lt;span class=&quot;token builtin class-name&quot;&gt;.&lt;/span&gt; /etc/os-release &lt;span class=&quot;token operator&quot;&gt;&amp;amp;&amp;amp;&lt;/span&gt; &lt;span class=&quot;token builtin class-name&quot;&gt;echo&lt;/span&gt; &lt;span class=&quot;token string&quot;&gt;&quot;&lt;span class=&quot;token variable&quot;&gt;$VERSION_CODENAME&lt;/span&gt;&quot;&lt;/span&gt;&lt;span class=&quot;token variable&quot;&gt;)&lt;/span&gt;&lt;/span&gt;&lt;span class=&quot;token string&quot;&gt;&quot; stable&quot;&lt;/span&gt; &lt;span class=&quot;token operator&quot;&gt;|&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;\&lt;/span&gt;
  &lt;span class=&quot;token function&quot;&gt;sudo&lt;/span&gt; &lt;span class=&quot;token function&quot;&gt;tee&lt;/span&gt; /etc/apt/sources.list.d/docker.list &lt;span class=&quot;token operator&quot;&gt;&gt;&lt;/span&gt; /dev/null

&lt;span class=&quot;token comment&quot;&gt;# install containerd&lt;/span&gt;
&lt;span class=&quot;token function&quot;&gt;sudo&lt;/span&gt; &lt;span class=&quot;token function&quot;&gt;apt-get&lt;/span&gt; update
&lt;span class=&quot;token function&quot;&gt;sudo&lt;/span&gt; &lt;span class=&quot;token function&quot;&gt;apt-get&lt;/span&gt; &lt;span class=&quot;token function&quot;&gt;install&lt;/span&gt; containerd.io

&lt;span class=&quot;token comment&quot;&gt;# check installed containerd&lt;/span&gt;
crictl &lt;span class=&quot;token function&quot;&gt;ps&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;/br&gt;
&lt;p&gt;다음으로는, &lt;code class=&quot;language-text&quot;&gt;cgroup&lt;/code&gt; 설정을 해주어야 한다. &lt;code class=&quot;language-text&quot;&gt;cgroup&lt;/code&gt; 이란 단일 또는 태스크 단위의 프로세스 그룹에 대한 자원 할당을 제어하는 커널 모듈이다. &lt;code class=&quot;language-text&quot;&gt;cgroup을&lt;/code&gt; 이용하면 다음의 자원들을 제한할 수 있다. &lt;code class=&quot;language-text&quot;&gt;cgroup&lt;/code&gt;을 관리하는 방법은 다음과 같다. &lt;code class=&quot;language-text&quot;&gt;1) cgroup 파일 시스템에 직접 접근&lt;/code&gt;, &lt;code class=&quot;language-text&quot;&gt;2) cgmanager 이용&lt;/code&gt;, &lt;code class=&quot;language-text&quot;&gt;3) cgroup-tools 이용&lt;/code&gt;&lt;/p&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;text&quot;&gt;&lt;pre class=&quot;language-text&quot;&gt;&lt;code class=&quot;language-text&quot;&gt;- Memory
- CPU
- Network
- Device
- I/O&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;/br&gt;
&lt;p&gt;k8s에서는 컨테이너 런타임이 &lt;code class=&quot;language-text&quot;&gt;cgroup&lt;/code&gt;을 사용하여 컨테이너에 자원을 할당한다. cgroup을 관리하기 위한 기술에는 크게 &lt;code class=&quot;language-text&quot;&gt;cgroupfs&lt;/code&gt;와 &lt;code class=&quot;language-text&quot;&gt;systemd&lt;/code&gt;가 있다. cgroup이 관리할 수 있는 자원의 컨트롤러는 파일의 형태로 관리되고 있다. 이와 같이 관련된 정보를 파일 시스템의 형태로 변환시켜 주는 매니저가 &lt;code class=&quot;language-text&quot;&gt;cgroupfs&lt;/code&gt;이다. &lt;code class=&quot;language-text&quot;&gt;cgroupfs&lt;/code&gt;는 &lt;code class=&quot;language-text&quot;&gt;/sys/fs/group&lt;/code&gt; 경로의 하위에 이 정보를 마운트하여 관리한다. &lt;code class=&quot;language-text&quot;&gt;systemd&lt;/code&gt; 역시 &lt;code class=&quot;language-text&quot;&gt;cgroup&lt;/code&gt;을 관리하기 위해 동작하지만, &lt;code class=&quot;language-text&quot;&gt;cgroupfs&lt;/code&gt;와는 차이점이 있다.&lt;/p&gt;
&lt;/br&gt;
&lt;p&gt;&lt;code class=&quot;language-text&quot;&gt;cgroupfs&lt;/code&gt;는 cgroup(v1) 디렉터리 하위에 리소스를 직접 매핑한다. &lt;code class=&quot;language-text&quot;&gt;systemd&lt;/code&gt;는 slice &gt; scope &gt; system 단위의 계층 구조를 만들어 각 단위에 자원을 할당한다. 이러한 계층 구조는 &lt;code class=&quot;language-text&quot;&gt;systemd-cgls&lt;/code&gt; 명령어가 표현해주는 구조 혹은 &lt;code class=&quot;language-text&quot;&gt;/sys/fs/cgroup/systemd&lt;/code&gt; 하위의 파일 시스템 계층 구조를 통해 확인할 수 있다.&lt;/p&gt;
&lt;div align=&quot;left&quot;&gt;
  &lt;span class=&quot;gatsby-resp-image-wrapper&quot; style=&quot;position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 511px; &quot;&gt;
      &lt;a class=&quot;gatsby-resp-image-link&quot; href=&quot;/static/227ed581a9b9df10ea325746acffe741/92e00/cgroup.png&quot; style=&quot;display: block&quot; target=&quot;_blank&quot; rel=&quot;noopener&quot;&gt;
    &lt;span class=&quot;gatsby-resp-image-background-image&quot; style=&quot;padding-bottom: 110.75949367088609%; position: relative; bottom: 0; left: 0; background-image: url(&apos;data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAWCAYAAADAQbwGAAAACXBIWXMAAA7DAAAOwwHHb6hkAAADnklEQVR42m1U2XLaWhDkT+6tin2T3CRgg0FiE4sktKAdxA4Gb0mcyv8/dqaPwA5OHqaETok+Pd09U2o6NrK7OcJdCnPiwohtNCypgYdyqwfNdNEeBTC8CGY0wWfdwMVVA5fXmqr/qvpZlW76Nqw4R70/wv+NDrShi8axOm6kwFgdJ5QK0LR86Kan3vn7LXCpZljoBylqPQuVVh/hfINwscV4tsb09kFVvLpVNTs8YfX4jHz/hPXjD6TrPVr2WIi0X0BL1SNg1TDxpdlTbO0kl/amCAR8PNvAyebwpktEix2i5U5dSLbX3SHqgxE+3LRweWLIw660xhbLwtDJFnAmC4zSGRJhQGYE8PO1MDogWcmZgLJt6kkiH+u/Maz1bAzDCaoCTIaOAI2EEVnyjwT085WSgBcoQDnLNnfQLU+Z9knrvGl5LBrKk66yPbK0k9mxvR386QqBtO4JMN/dyVKZ+M+nKv79XDs3pSysGkNHfUCG1IpF4BMjahlI28lKLhCmZpiK8z7seIKeHysNX10Wd3lI6pV2Xz7KMRJ2hSlbpZ8rmpKVM93CzraIN9/l9w7jxQOG0Rzva81XwP44USwGQaYcY6ujdK6A42URF7ZOHVvjA9rJMzrJDzSDR+j+Hh/qxnnLDCj/0PVipSPbpaNkRVdZZEqDBskeRigs869iSCBADVVnk1LtmsoUPqkh3SVLK56qkFM/gvMintlSdFwXiQqw5l9GLylG75RD9/ccStsEDYUlQXlJIjI0Bs7fZ5nMDAn2jeSxAJwXGiaFhko/iQ1lsDNJQL6VVHi46loCqP8JSHfJsC2jxEwWOZy/5JBFhjTFzO5gTb+h6c7Q8hYy+4M/NbwmQ4kNGaocTt7kcF3kkMCbp2dMtnfIWJuD2jbvKo3z2LBNziW1/NI0VKuj43IIjzmkrp60nQoIn5GcaTIMF1f1Qke1wshUO7YszrVtbg+zyKGUyqHk87RdyHKY7ND2JPTpDp1giZo5xVU/QsUIULdn+NgwUOJiyPePam3RudccLlUGuQQIzDWm+zto3q0876UO6E9+oifVCh+ge1sB7KHE1cXgUkeaYkmrL/twVsSFhtB5zVmoaWn6twJyj27yXeoZ5a6Pi0rtNHqpEplMKfIpxCNlyuFlBwYS5k64Rzt+QkdKE0aau1asq4P0dX1x9Mig64aq5WGYKXZWlEqbK8VerbM0F2Yb1J2VAG1khrt4V66KMTe4FHNOLv8Cwj0kwcRSnfEAAAAASUVORK5CYII=&apos;); background-size: cover; display: block;&quot;&gt;&lt;/span&gt;
  &lt;img class=&quot;gatsby-resp-image-image&quot; alt=&quot;cgroup&quot; title=&quot;&quot; src=&quot;/static/227ed581a9b9df10ea325746acffe741/92e00/cgroup.png&quot; srcset=&quot;/static/227ed581a9b9df10ea325746acffe741/c26ae/cgroup.png 158w,
/static/227ed581a9b9df10ea325746acffe741/6bdcf/cgroup.png 315w,
/static/227ed581a9b9df10ea325746acffe741/92e00/cgroup.png 511w&quot; sizes=&quot;(max-width: 511px) 100vw, 511px&quot; style=&quot;width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;&quot; loading=&quot;lazy&quot; decoding=&quot;async&quot;&gt;
  &lt;/a&gt;
    &lt;/span&gt;
  &lt;span class=&quot;gatsby-resp-image-wrapper&quot; style=&quot;position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 341px; &quot;&gt;
      &lt;a class=&quot;gatsby-resp-image-link&quot; href=&quot;/static/540283ce1c4415162994d4f4037133aa/4c0ad/systemd-cgls.png&quot; style=&quot;display: block&quot; target=&quot;_blank&quot; rel=&quot;noopener&quot;&gt;
    &lt;span class=&quot;gatsby-resp-image-background-image&quot; style=&quot;padding-bottom: 132.27848101265823%; position: relative; bottom: 0; left: 0; background-image: url(&apos;data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAaCAYAAAC3g3x9AAAACXBIWXMAAA7DAAAOwwHHb6hkAAADVUlEQVR42pVV2VbaUBTtp7QWtSoyBwghZGIKEEZBAYuo1a6u2tW3vvTjd8++JDgAah/uupDk7pw9nJMPWtVGe9FBdeJj9nuMYBmgfuGjcdGC3W/A9Aew2gNUe2foXixkH6M9uUTWqiGWyuMgU3y2PthBF1e/7tGdzzC4mmL58AOT2yW8QQ9Js4JEyUHa9ASgCs1pIFupoug2ES+Y2E8XNgHjBQu13jmGlzfI2z6SJRcpw8NBWsdeQpOVU5V8Tuaxl9Rk19S+DUwBpsouil4TbruPjOkiXXagSTVZ+Z2TPe/U14cPs8WtIM8ANbuO1tkM9f4YZrOL3vQKvPYlV8JJvozjvCFA+ptAjxUaDox6RwHZIv5AqE+WdyhWfbjBCKfFiqL9X4DHUonTGahK53c/8fDnL0aLW7TGM+WsEwzfXaUCPNUr4qQLq9XD5PpeAfemC/RnSzHJRtKwERMd98MVC9dB+H8DMCGHGAPSI2ip1lLLbtEoTxlVcBsqLowNjeL/I9E5W1nd309vAeQFPkCXCZ6zPBTkMMF5/+WiDNyPNONpbBzE5bCKjmjVnsyVdjXpCFZ4tviGcjPAx3hmRVVlUlt3ySblEDAvFCy/i2p3BLMRKHrcS/W27B2VSVJjVjVpOzLY2inKFLnJ1qIuPMwDOdFK93xFyZHQ87onSbBFY2rIZOwEjCu9akLbR0XoRdUYot1JqFGkF4Fei9AjoF2DLmG2W10xoqGo6aJrqdpaGSX3DzP6Ki7vySHjwUhEepF+WfQ7KZTV4jPvCbcy5VS57CuX6TCXLbr5oykC6RT2NSdM5Or+K1WuKVNoXegZoaukzZAbtbYyh5SpK+lT73jR3D5gI0BNAFkt6dJhakjanDh22D2R28wsY8WXvIzPYw7DaczKeICA1DChW2uneZgvOIpGm7Y52kJTrLBn3VUFUlmyZMl87Ih+Oj6F40sNiPDgLi3VxGa2SLnWn4SmzGWcDVXLDb/eCN32eia+aQrHVhRamkCnaUxBaJelWmrHsK9McdeZZIy2VvgUkFOah0k5U1kFm/pZfqAC7spEj8B3th7fyh/MGr8lPMAIRaawEh6mKTSP3xg++wplD/XBudKPWp1ff1d55NvZIaw+mtaxVKhfenen/APpFGlgVBXRIwAAAABJRU5ErkJggg==&apos;); background-size: cover; display: block;&quot;&gt;&lt;/span&gt;
  &lt;img class=&quot;gatsby-resp-image-image&quot; alt=&quot;systemd cgls&quot; title=&quot;&quot; src=&quot;/static/540283ce1c4415162994d4f4037133aa/4c0ad/systemd-cgls.png&quot; srcset=&quot;/static/540283ce1c4415162994d4f4037133aa/c26ae/systemd-cgls.png 158w,
/static/540283ce1c4415162994d4f4037133aa/6bdcf/systemd-cgls.png 315w,
/static/540283ce1c4415162994d4f4037133aa/4c0ad/systemd-cgls.png 341w&quot; sizes=&quot;(max-width: 341px) 100vw, 341px&quot; style=&quot;width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;&quot; loading=&quot;lazy&quot; decoding=&quot;async&quot;&gt;
  &lt;/a&gt;
    &lt;/span&gt;
&lt;/div&gt;
&lt;/br&gt;
&lt;p&gt;갑자기 왜 이런 복잡한 설명을 했냐하면... 쿠버네티스 v1.22 부터는 cgroup으로 &lt;code class=&quot;language-text&quot;&gt;systemd&lt;/code&gt;를 사용하도록 강제해두었기 때문이다. 따라서 containerd를 설치한 뒤, cgroup 설정을 변경해주어야 하기 때문이다. &lt;code class=&quot;language-text&quot;&gt;/etc/containerd/config.toml&lt;/code&gt; 경로의 설정 파일을 열어서 전체 삭제 후, 아래와 설정을 복사 붙여넣기 한다.&lt;/p&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;toml&quot;&gt;&lt;pre class=&quot;language-toml&quot;&gt;&lt;code class=&quot;language-toml&quot;&gt;&lt;span class=&quot;token punctuation&quot;&gt;[&lt;/span&gt;&lt;span class=&quot;token table class-name&quot;&gt;plugins.&quot;io.containerd.grpc.v1.cri&quot;.containerd.runtimes.runc&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;]&lt;/span&gt;
  &lt;span class=&quot;token punctuation&quot;&gt;[&lt;/span&gt;&lt;span class=&quot;token table class-name&quot;&gt;plugins.&quot;io.containerd.grpc.v1.cri&quot;.containerd.runtimes.runc.options&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;]&lt;/span&gt;
    &lt;span class=&quot;token key property&quot;&gt;SystemdCgroup&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;token boolean&quot;&gt;true&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;/br&gt;
&lt;p&gt;그 다음으로는, containerd를 재기동한다.&lt;/p&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;sh&quot;&gt;&lt;pre class=&quot;language-sh&quot;&gt;&lt;code class=&quot;language-sh&quot;&gt;&lt;span class=&quot;token function&quot;&gt;sudo&lt;/span&gt; systemctl restart containerd
&lt;span class=&quot;token function&quot;&gt;sudo&lt;/span&gt; systemctl status containerd&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;/br&gt;
&lt;h3&gt;4. kubeadm Installation&lt;/h3&gt;
&lt;/br&gt;
&lt;p&gt;&lt;a href=&quot;https://kubernetes.io/docs/setup/production-environment/tools/kubeadm/install-kubeadm/&quot;&gt;kubeadm 설치&lt;/a&gt;&lt;/p&gt;
&lt;/br&gt;
&lt;p&gt;먼저, kube-apiserver가 사용할 6443 포트가 미사용중인지 확인한다.&lt;/p&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;sh&quot;&gt;&lt;pre class=&quot;language-sh&quot;&gt;&lt;code class=&quot;language-sh&quot;&gt;&lt;span class=&quot;token function&quot;&gt;nc&lt;/span&gt; &lt;span class=&quot;token number&quot;&gt;127.0&lt;/span&gt;.0.1 &lt;span class=&quot;token number&quot;&gt;6443&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;6443 포트를 점유하는 프로세스가 없다면 다음으로 진행한다. 여기서는 쿠버네티스의 필수 도구들인 kubeadm, kubelet, kubectl을 설치할 예정이다. 아래와 같은 절차대로 진행하면 된다. 한 가지 주의할 점은 쿠버네티스 버전에 따라 인증서 파일의 위치가 다른데, 설치 시 오류가 지속적으로 발생한다면 최신 공식 문서를 확인해보는 것이 좋다.&lt;/p&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;sh&quot;&gt;&lt;pre class=&quot;language-sh&quot;&gt;&lt;code class=&quot;language-sh&quot;&gt;&lt;span class=&quot;token function&quot;&gt;sudo&lt;/span&gt; &lt;span class=&quot;token function&quot;&gt;apt-get&lt;/span&gt; update
&lt;span class=&quot;token comment&quot;&gt;# apt-transport-https may be a dummy package; if so, you can skip that package&lt;/span&gt;
&lt;span class=&quot;token function&quot;&gt;sudo&lt;/span&gt; &lt;span class=&quot;token function&quot;&gt;apt-get&lt;/span&gt; &lt;span class=&quot;token function&quot;&gt;install&lt;/span&gt; &lt;span class=&quot;token parameter variable&quot;&gt;-y&lt;/span&gt; apt-transport-https ca-certificates &lt;span class=&quot;token function&quot;&gt;curl&lt;/span&gt;

&lt;span class=&quot;token function&quot;&gt;curl&lt;/span&gt; &lt;span class=&quot;token parameter variable&quot;&gt;-fsSL&lt;/span&gt; https://pkgs.k8s.io/core:/stable:/v1.28/deb/Release.key &lt;span class=&quot;token operator&quot;&gt;|&lt;/span&gt; &lt;span class=&quot;token function&quot;&gt;sudo&lt;/span&gt; gpg &lt;span class=&quot;token parameter variable&quot;&gt;--dearmor&lt;/span&gt; &lt;span class=&quot;token parameter variable&quot;&gt;-o&lt;/span&gt; /etc/apt/keyrings/kubernetes-apt-keyring.gpg

&lt;span class=&quot;token comment&quot;&gt;# This overwrites any existing configuration in /etc/apt/sources.list.d/kubernetes.list&lt;/span&gt;
&lt;span class=&quot;token builtin class-name&quot;&gt;echo&lt;/span&gt; &lt;span class=&quot;token string&quot;&gt;&apos;deb [signed-by=/etc/apt/keyrings/kubernetes-apt-keyring.gpg] https://pkgs.k8s.io/core:/stable:/v1.28/deb/ /&apos;&lt;/span&gt; &lt;span class=&quot;token operator&quot;&gt;|&lt;/span&gt; &lt;span class=&quot;token function&quot;&gt;sudo&lt;/span&gt; &lt;span class=&quot;token function&quot;&gt;tee&lt;/span&gt; /etc/apt/sources.list.d/kubernetes.list

&lt;span class=&quot;token function&quot;&gt;sudo&lt;/span&gt; &lt;span class=&quot;token function&quot;&gt;apt-get&lt;/span&gt; update
&lt;span class=&quot;token function&quot;&gt;sudo&lt;/span&gt; &lt;span class=&quot;token function&quot;&gt;apt-get&lt;/span&gt; &lt;span class=&quot;token function&quot;&gt;install&lt;/span&gt; &lt;span class=&quot;token parameter variable&quot;&gt;-y&lt;/span&gt; kubelet kubeadm kubectl
&lt;span class=&quot;token function&quot;&gt;sudo&lt;/span&gt; apt-mark hold kubelet kubeadm kubectl

&lt;span class=&quot;token comment&quot;&gt;# Check installation success&lt;/span&gt;
kubeadm version&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;/br&gt;
&lt;h3&gt;5. kubeadm init&lt;/h3&gt;
&lt;/br&gt;
&lt;p&gt;&lt;a href=&quot;https://kubernetes.io/docs/setup/production-environment/tools/kubeadm/create-cluster-kubeadm/&quot;&gt;kubeadm init&lt;/a&gt;&lt;/p&gt;
&lt;/br&gt;
&lt;p&gt;이제 쿠버네티스 클러스터를 올리기 직전이다. 본 작업은 Control Plane 노드에서만 진행할 작업이므로, Worker 노드에서는 진행하면 안된다. Control Plane 노드에서 처음 쿠버네티스 클러스터를 올리기 위해서는 &lt;code class=&quot;language-text&quot;&gt;kubeadm init&lt;/code&gt; 명령어를 사용한다.
이 명령어를 사용할 때 여러 옵션들이 존재하지만, 우리는 여기서 두 가지 옵션만을 사용할 예정이다.&lt;/p&gt;
&lt;/br&gt;
&lt;p&gt;&lt;code class=&quot;language-text&quot;&gt;--apiserver-advertise-address&lt;/code&gt;는 특정 Control Plane 노드의 API 서버를 알리기 위한 엔드포인트를 세팅한다. 여기서는 단일 Control Plane 노드를 사용하므로 &lt;code class=&quot;language-text&quot;&gt;--control-plane-endpoint&lt;/code&gt; 와 같은 설정은 사용하지 않는다. &lt;code class=&quot;language-text&quot;&gt;--pod-network-cidr&lt;/code&gt;은 파드 네트워크를 구성할 때 사용할 IP 대역대를 설정한다.&lt;/p&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;sh&quot;&gt;&lt;pre class=&quot;language-sh&quot;&gt;&lt;code class=&quot;language-sh&quot;&gt;&lt;span class=&quot;token function&quot;&gt;sudo&lt;/span&gt; kubeadm init --apiserver-advertise-address&lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;token number&quot;&gt;192.168&lt;/span&gt;.56.2 --pod-network-cidr&lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;token number&quot;&gt;10.244&lt;/span&gt;.0.0/16&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;위의 명령어를 치고 나서 시간이 좀 지나면 완료되었다는 문구를 볼 수 있다. 해당 문구에는 추가로 진행할 작업에 대해 설명하는데, 우선 아래 명령어로 &lt;code class=&quot;language-text&quot;&gt;~/.kube/config&lt;/code&gt; 경로에 설정 파일을 생성하고 쿠버네티스에서 설정을 잘 가져오는지 확인하자.&lt;/p&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;sh&quot;&gt;&lt;pre class=&quot;language-sh&quot;&gt;&lt;code class=&quot;language-sh&quot;&gt;&lt;span class=&quot;token function&quot;&gt;mkdir&lt;/span&gt; &lt;span class=&quot;token parameter variable&quot;&gt;-p&lt;/span&gt; &lt;span class=&quot;token environment constant&quot;&gt;$HOME&lt;/span&gt;/.kube
&lt;span class=&quot;token function&quot;&gt;sudo&lt;/span&gt; &lt;span class=&quot;token function&quot;&gt;cp&lt;/span&gt; &lt;span class=&quot;token parameter variable&quot;&gt;-i&lt;/span&gt; /etc/kubernetes/admin.conf &lt;span class=&quot;token environment constant&quot;&gt;$HOME&lt;/span&gt;/.kube/config
&lt;span class=&quot;token function&quot;&gt;sudo&lt;/span&gt; &lt;span class=&quot;token function&quot;&gt;chown&lt;/span&gt; &lt;span class=&quot;token variable&quot;&gt;&lt;span class=&quot;token variable&quot;&gt;$(&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;id&lt;/span&gt; &lt;span class=&quot;token parameter variable&quot;&gt;-u&lt;/span&gt;&lt;span class=&quot;token variable&quot;&gt;)&lt;/span&gt;&lt;/span&gt;&lt;span class=&quot;token builtin class-name&quot;&gt;:&lt;/span&gt;&lt;span class=&quot;token variable&quot;&gt;&lt;span class=&quot;token variable&quot;&gt;$(&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;id&lt;/span&gt; &lt;span class=&quot;token parameter variable&quot;&gt;-g&lt;/span&gt;&lt;span class=&quot;token variable&quot;&gt;)&lt;/span&gt;&lt;/span&gt; &lt;span class=&quot;token environment constant&quot;&gt;$HOME&lt;/span&gt;/.kube/config

&lt;span class=&quot;token comment&quot;&gt;# Check Setting Import&lt;/span&gt;
kubectl config view&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;/br&gt;
&lt;p&gt;&lt;code class=&quot;language-text&quot;&gt;kubectl config view&lt;/code&gt;의 결과로 아래와 같은 문구가 보인다면 제대로 설정된 것이다.&lt;/p&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;yaml&quot;&gt;&lt;pre class=&quot;language-yaml&quot;&gt;&lt;code class=&quot;language-yaml&quot;&gt;&lt;span class=&quot;token key atrule&quot;&gt;apiVersion&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt; v1
&lt;span class=&quot;token key atrule&quot;&gt;clusters&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt;
&lt;span class=&quot;token punctuation&quot;&gt;-&lt;/span&gt; &lt;span class=&quot;token key atrule&quot;&gt;cluster&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt;
    &lt;span class=&quot;token key atrule&quot;&gt;certificate-authority-data&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt; DATA+OMITTED
    &lt;span class=&quot;token key atrule&quot;&gt;server&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt; https&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt;//192.168.56.2&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt;&lt;span class=&quot;token number&quot;&gt;6443&lt;/span&gt;
  &lt;span class=&quot;token key atrule&quot;&gt;name&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt; kubernetes
&lt;span class=&quot;token key atrule&quot;&gt;contexts&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt;
&lt;span class=&quot;token punctuation&quot;&gt;-&lt;/span&gt; &lt;span class=&quot;token key atrule&quot;&gt;context&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt;
    &lt;span class=&quot;token key atrule&quot;&gt;cluster&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt; kubernetes
    &lt;span class=&quot;token key atrule&quot;&gt;user&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt; kubernetes&lt;span class=&quot;token punctuation&quot;&gt;-&lt;/span&gt;admin
  &lt;span class=&quot;token key atrule&quot;&gt;name&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt; kubernetes&lt;span class=&quot;token punctuation&quot;&gt;-&lt;/span&gt;admin@kubernetes
&lt;span class=&quot;token key atrule&quot;&gt;current-context&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt; kubernetes&lt;span class=&quot;token punctuation&quot;&gt;-&lt;/span&gt;admin@kubernetes
&lt;span class=&quot;token key atrule&quot;&gt;kind&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt; Config
&lt;span class=&quot;token key atrule&quot;&gt;preferences&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;
&lt;span class=&quot;token key atrule&quot;&gt;users&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt;
&lt;span class=&quot;token punctuation&quot;&gt;-&lt;/span&gt; &lt;span class=&quot;token key atrule&quot;&gt;name&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt; kubernetes&lt;span class=&quot;token punctuation&quot;&gt;-&lt;/span&gt;admin
  &lt;span class=&quot;token key atrule&quot;&gt;user&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt;
    &lt;span class=&quot;token key atrule&quot;&gt;client-certificate-data&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt; DATA+OMITTED
    &lt;span class=&quot;token key atrule&quot;&gt;client-key-data&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt; DATA+OMITTED&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;추가로 진행해야할 부분으로는 &lt;code class=&quot;language-text&quot;&gt;CNI(Container Network Interface)&lt;/code&gt; 플러그인을 설치하라는 문구가 있는데, 진행하기 전에 제일 하단부에 아래와 같은 &lt;code class=&quot;language-text&quot;&gt;kubeadm join ...&lt;/code&gt; 문구를 복사해놓는다. 나중에 Worker 노드들을 클러스터에 합류시킬 때 사용할 명령어이다.&lt;/p&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;sh&quot;&gt;&lt;pre class=&quot;language-sh&quot;&gt;&lt;code class=&quot;language-sh&quot;&gt;You can now &lt;span class=&quot;token function&quot;&gt;join&lt;/span&gt; any number of machines by running the following on each &lt;span class=&quot;token function&quot;&gt;node&lt;/span&gt;
as root:

  kubeadm &lt;span class=&quot;token function&quot;&gt;join&lt;/span&gt; &lt;span class=&quot;token operator&quot;&gt;&amp;lt;&lt;/span&gt;control-plane-host&lt;span class=&quot;token operator&quot;&gt;&gt;&lt;/span&gt;:&lt;span class=&quot;token operator&quot;&gt;&amp;lt;&lt;/span&gt;control-plane-port&lt;span class=&quot;token operator&quot;&gt;&gt;&lt;/span&gt; &lt;span class=&quot;token parameter variable&quot;&gt;--token&lt;/span&gt; &lt;span class=&quot;token operator&quot;&gt;&amp;lt;&lt;/span&gt;token&lt;span class=&quot;token operator&quot;&gt;&gt;&lt;/span&gt; --discovery-token-ca-cert-hash sha256:&lt;span class=&quot;token operator&quot;&gt;&amp;lt;&lt;/span&gt;hash&lt;span class=&quot;token operator&quot;&gt;&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;/br&gt;
&lt;h3&gt;6. CNI(Container Network Interface)&lt;/h3&gt;
&lt;/br&gt;
&lt;p&gt;&lt;a href=&quot;https://kubernetes.io/docs/concepts/cluster-administration/addons/&quot;&gt;CNI(Container Network Interface)&lt;/a&gt;&lt;/p&gt;
&lt;/br&gt;
&lt;p&gt;다음으로는 CNI 플러그인을 설치한다. 쿠버네티스에서는 빌트인으로 kubelet을 이용한 자체 네트워크를 지원하나, 파드 네트워크와 같이 클러스터의 필수 네트워킹을 지원하지 않는다. 위의 링크에 접속해보면 쿠버네티스에서 지원하는 다양한 플러그인들을 확인할 수 있다. 보통 &lt;code class=&quot;language-text&quot;&gt;Calico&lt;/code&gt;나 &lt;code class=&quot;language-text&quot;&gt;Flannel&lt;/code&gt;을 많이 사용하는데, 매우 빠르고 간단한 설치를 위해 우리는 &lt;code class=&quot;language-text&quot;&gt;Weave net&lt;/code&gt;을 설치할 예정이다. 각 플러그인들은 기능상으로는 거의 동일하나 약간의 성능 차를 갖는다고 한다.&lt;/p&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;sh&quot;&gt;&lt;pre class=&quot;language-sh&quot;&gt;&lt;code class=&quot;language-sh&quot;&gt;&lt;span class=&quot;token comment&quot;&gt;# https://www.weave.works/docs/net/latest/kubernetes/kube-addon/&lt;/span&gt;
kubectl apply &lt;span class=&quot;token parameter variable&quot;&gt;-f&lt;/span&gt; https://github.com/weaveworks/weave/releases/download/v2.8.1/weave-daemonset-k8s.yaml&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;시간이 조금 흐르면 완료되었다는 문구를 볼 수 있다. &lt;code class=&quot;language-text&quot;&gt;kubectl get&lt;/code&gt; 명령어를 통해 제대로 배포되었는지 확인한다.&lt;/p&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;sh&quot;&gt;&lt;pre class=&quot;language-sh&quot;&gt;&lt;code class=&quot;language-sh&quot;&gt;kubectl get po &lt;span class=&quot;token parameter variable&quot;&gt;-n&lt;/span&gt; kube-system
coredns-5dd5756b68-bvcr9             &lt;span class=&quot;token number&quot;&gt;1&lt;/span&gt;/1     Running   &lt;span class=&quot;token number&quot;&gt;2&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;32h ago&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;    33h
coredns-5dd5756b68-psv44             &lt;span class=&quot;token number&quot;&gt;1&lt;/span&gt;/1     Running   &lt;span class=&quot;token number&quot;&gt;7&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;32h ago&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;    33h
etcd-kubemaster                      &lt;span class=&quot;token number&quot;&gt;1&lt;/span&gt;/1     Running   &lt;span class=&quot;token number&quot;&gt;27&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;31h ago&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;   33h
kube-apiserver-kubemaster            &lt;span class=&quot;token number&quot;&gt;1&lt;/span&gt;/1     Running   &lt;span class=&quot;token number&quot;&gt;29&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;31h ago&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;   33h
kube-controller-manager-kubemaster   &lt;span class=&quot;token number&quot;&gt;1&lt;/span&gt;/1     Running   &lt;span class=&quot;token number&quot;&gt;32&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;31h ago&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;   33h
kube-proxy-65ckq                     &lt;span class=&quot;token number&quot;&gt;1&lt;/span&gt;/1     Running   &lt;span class=&quot;token number&quot;&gt;0&lt;/span&gt;              31h
kube-proxy-jvm9g                     &lt;span class=&quot;token number&quot;&gt;1&lt;/span&gt;/1     Running   &lt;span class=&quot;token number&quot;&gt;0&lt;/span&gt;              31h
kube-proxy-lvhn2                     &lt;span class=&quot;token number&quot;&gt;1&lt;/span&gt;/1     Running   &lt;span class=&quot;token number&quot;&gt;30&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;31h ago&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;   33h
kube-scheduler-kubemaster            &lt;span class=&quot;token number&quot;&gt;1&lt;/span&gt;/1     Running   &lt;span class=&quot;token number&quot;&gt;38&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;31h ago&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;   33h
weave-net-5mk7n                      &lt;span class=&quot;token number&quot;&gt;2&lt;/span&gt;/2     Running   &lt;span class=&quot;token number&quot;&gt;0&lt;/span&gt;              31h
weave-net-cm7w8                      &lt;span class=&quot;token number&quot;&gt;2&lt;/span&gt;/2     Running   &lt;span class=&quot;token number&quot;&gt;0&lt;/span&gt;              31h
weave-net-j9qf7                      &lt;span class=&quot;token number&quot;&gt;2&lt;/span&gt;/2     Running   &lt;span class=&quot;token number&quot;&gt;19&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;31h ago&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;   32h&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;Weave net의 설치 페이지에서 조금 내려다보면, 파드 네트워크에 사용할 CIDR을 &lt;code class=&quot;language-text&quot;&gt;IPALLOC_RANGE&lt;/code&gt;를 통해 설정해야 한다고 되어 있다. 따라서 우리는 Weave net Pod의 설정을 건드려야 한다. 하지만 위의 명령어 결과에서도 알 수 있듯이, Weave net은 단순히 Pod로만 배포된 오브젝트가 아니다. 아래와 같이 Weave-net은 각 노드마다 하나씩 배포되어 있는 데몬 셋 오브젝트이다. 따라서 이 데몬 셋 오브젝트를 수정한다.&lt;/p&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;sh&quot;&gt;&lt;pre class=&quot;language-sh&quot;&gt;&lt;code class=&quot;language-sh&quot;&gt;kubectl get ds &lt;span class=&quot;token parameter variable&quot;&gt;-n&lt;/span&gt; kube-system weave-net
NAME         DESIRED   CURRENT   READY   UP-TO-DATE   AVAILABLE   NODE SELECTOR            AGE
weave-net    &lt;span class=&quot;token number&quot;&gt;3&lt;/span&gt;         &lt;span class=&quot;token number&quot;&gt;3&lt;/span&gt;         &lt;span class=&quot;token number&quot;&gt;3&lt;/span&gt;       &lt;span class=&quot;token number&quot;&gt;3&lt;/span&gt;            &lt;span class=&quot;token number&quot;&gt;3&lt;/span&gt;           &lt;span class=&quot;token operator&quot;&gt;&amp;lt;&lt;/span&gt;none&lt;span class=&quot;token operator&quot;&gt;&gt;&lt;/span&gt;                   32h

kubectl edit ds &lt;span class=&quot;token parameter variable&quot;&gt;-n&lt;/span&gt; kube-system weave-net&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;파일을 아래로 내리다 보면 &lt;code class=&quot;language-text&quot;&gt;.spec.template.spec.containers[].env&lt;/code&gt;가 있다. 이 부분에 환경변수를 추가해주면 된다. 저장하고 닫으면, 자동으로 Pod들을 재배포하게 된다.&lt;/p&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;yaml&quot;&gt;&lt;pre class=&quot;language-yaml&quot;&gt;&lt;code class=&quot;language-yaml&quot;&gt;&lt;span class=&quot;token punctuation&quot;&gt;...&lt;/span&gt;
    &lt;span class=&quot;token key atrule&quot;&gt;spec&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt;
      &lt;span class=&quot;token key atrule&quot;&gt;containers&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt;
      &lt;span class=&quot;token punctuation&quot;&gt;-&lt;/span&gt; &lt;span class=&quot;token key atrule&quot;&gt;command&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt;
        &lt;span class=&quot;token punctuation&quot;&gt;-&lt;/span&gt; /home/weave/launch.sh
        &lt;span class=&quot;token key atrule&quot;&gt;env&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt;
        &lt;span class=&quot;token punctuation&quot;&gt;-&lt;/span&gt; &lt;span class=&quot;token key atrule&quot;&gt;name&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt; IPALLOC_RANGE       &lt;span class=&quot;token comment&quot;&gt;# 이 부분 추가&lt;/span&gt;
          &lt;span class=&quot;token key atrule&quot;&gt;value&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt; 10.244.0.0/16      &lt;span class=&quot;token comment&quot;&gt;# 이 부분 추가&lt;/span&gt;
        &lt;span class=&quot;token punctuation&quot;&gt;-&lt;/span&gt; &lt;span class=&quot;token key atrule&quot;&gt;name&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt; INIT_CONTAINER
          &lt;span class=&quot;token key atrule&quot;&gt;value&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;token string&quot;&gt;&quot;true&quot;&lt;/span&gt;
        &lt;span class=&quot;token punctuation&quot;&gt;-&lt;/span&gt; &lt;span class=&quot;token key atrule&quot;&gt;name&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt; HOSTNAME
          &lt;span class=&quot;token key atrule&quot;&gt;valueFrom&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt;
            &lt;span class=&quot;token key atrule&quot;&gt;fieldRef&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt;
              &lt;span class=&quot;token key atrule&quot;&gt;apiVersion&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt; v1
              &lt;span class=&quot;token key atrule&quot;&gt;fieldPath&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt; spec.nodeName
&lt;span class=&quot;token punctuation&quot;&gt;...&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;sh&quot;&gt;&lt;pre class=&quot;language-sh&quot;&gt;&lt;code class=&quot;language-sh&quot;&gt;k get po &lt;span class=&quot;token parameter variable&quot;&gt;-n&lt;/span&gt; kube-system
NAME                                 READY   STATUS    RESTARTS       AGE
coredns-5dd5756b68-bvcr9             &lt;span class=&quot;token number&quot;&gt;1&lt;/span&gt;/1     Running   &lt;span class=&quot;token number&quot;&gt;2&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;32h ago&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;    33h
coredns-5dd5756b68-psv44             &lt;span class=&quot;token number&quot;&gt;1&lt;/span&gt;/1     Running   &lt;span class=&quot;token number&quot;&gt;7&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;32h ago&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;    33h
etcd-kubemaster                      &lt;span class=&quot;token number&quot;&gt;1&lt;/span&gt;/1     Running   &lt;span class=&quot;token number&quot;&gt;27&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;32h ago&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;   33h
kube-apiserver-kubemaster            &lt;span class=&quot;token number&quot;&gt;1&lt;/span&gt;/1     Running   &lt;span class=&quot;token number&quot;&gt;29&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;32h ago&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;   33h
kube-controller-manager-kubemaster   &lt;span class=&quot;token number&quot;&gt;1&lt;/span&gt;/1     Running   &lt;span class=&quot;token number&quot;&gt;32&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;31h ago&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;   33h
kube-proxy-65ckq                     &lt;span class=&quot;token number&quot;&gt;1&lt;/span&gt;/1     Running   &lt;span class=&quot;token number&quot;&gt;0&lt;/span&gt;              31h
kube-proxy-jvm9g                     &lt;span class=&quot;token number&quot;&gt;1&lt;/span&gt;/1     Running   &lt;span class=&quot;token number&quot;&gt;0&lt;/span&gt;              31h
kube-proxy-lvhn2                     &lt;span class=&quot;token number&quot;&gt;1&lt;/span&gt;/1     Running   &lt;span class=&quot;token number&quot;&gt;30&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;32h ago&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;   33h
kube-scheduler-kubemaster            &lt;span class=&quot;token number&quot;&gt;1&lt;/span&gt;/1     Running   &lt;span class=&quot;token number&quot;&gt;38&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;31h ago&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;   33h
weave-net-bpxqj                      &lt;span class=&quot;token number&quot;&gt;2&lt;/span&gt;/2     Running   &lt;span class=&quot;token number&quot;&gt;0&lt;/span&gt;              56s
weave-net-j9qf7                      &lt;span class=&quot;token number&quot;&gt;2&lt;/span&gt;/2     Running   &lt;span class=&quot;token number&quot;&gt;19&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;32h ago&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;   32h
weave-net-pkn85                      &lt;span class=&quot;token number&quot;&gt;2&lt;/span&gt;/2     Running   &lt;span class=&quot;token number&quot;&gt;0&lt;/span&gt;              13s&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;/br&gt;
&lt;h3&gt;7. kubeadm join&lt;/h3&gt;
&lt;/br&gt;
&lt;p&gt;&lt;a href=&quot;https://kubernetes.io/docs/setup/production-environment/tools/kubeadm/create-cluster-kubeadm/&quot;&gt;kubeadm join&lt;/a&gt;&lt;/p&gt;
&lt;/br&gt;
&lt;p&gt;이제 대망의 Worker 노드들을 클러스터에 join 시키는 작업만 남았다. 아까 복사해둔 &lt;code class=&quot;language-text&quot;&gt;kubeadm join&lt;/code&gt; 부분을 각 Worker 노드에서 sudo로 동작시킨다. 네트워크가 잘 구성되었다면 금방 join이 되며 모두 join되고 나서 &lt;code class=&quot;language-text&quot;&gt;kubectl get no&lt;/code&gt; 명령어로 확인해보자. 또한, 파드가 잘 배포되는지 확인해보면서 설치 작업을 마무리할 수 있을 것 같다.&lt;/p&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;sh&quot;&gt;&lt;pre class=&quot;language-sh&quot;&gt;&lt;code class=&quot;language-sh&quot;&gt;kubectl get no
NAME         STATUS   ROLES           AGE   VERSION
kubemaster   Ready    control-plane   33h   v1.28.0
kubenode01   Ready    &lt;span class=&quot;token operator&quot;&gt;&amp;lt;&lt;/span&gt;none&lt;span class=&quot;token operator&quot;&gt;&gt;&lt;/span&gt;          31h   v1.28.0
kubenode02   Ready    &lt;span class=&quot;token operator&quot;&gt;&amp;lt;&lt;/span&gt;none&lt;span class=&quot;token operator&quot;&gt;&gt;&lt;/span&gt;          31h   v1.28.0

kubectl run nginx &lt;span class=&quot;token parameter variable&quot;&gt;--image&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt;nginx:latest
pod &lt;span class=&quot;token string&quot;&gt;&quot;nginx&quot;&lt;/span&gt; created

kubectl get po
NAME    READY   STATUS    RESTARTS   AGE
nginx   &lt;span class=&quot;token number&quot;&gt;1&lt;/span&gt;/1     Running   &lt;span class=&quot;token number&quot;&gt;0&lt;/span&gt;          14s&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;/br&gt;
&lt;h3&gt;8. Troubleshooting kubeadm&lt;/h3&gt;
&lt;/br&gt;
&lt;p&gt;&lt;a href=&quot;https://kubernetes.io/docs/setup/production-environment/tools/kubeadm/troubleshooting-kubeadm/&quot;&gt;Troubleshooting kubeadm&lt;/a&gt;&lt;/p&gt;
&lt;/br&gt;
&lt;p&gt;설치 과정 시 발생하는 거의 대부분의 에러는 위의 링크에서 조치할 수 있다. 나같은 경우 최초 설치 때는 문제가 없었는데, 재설치할 때 발생한 문제가 있다. 정확한 원인이 뭐였는지는 잘 모르겠지만... 짐작컨데 쿠버네티스 버전을 올려서 혹은 Ubuntu 버전을 올려서 설치한 것이 문제였는지는 잘 모르겠지만, 아무튼 최초 설치때와는 확연히 다른 현상이 있었다.&lt;/p&gt;
&lt;/br&gt;
&lt;p&gt;다른 절차는 다 잘 되었는데, &lt;code class=&quot;language-text&quot;&gt;kubeadm init&lt;/code&gt;을 진행하고 나서 Control Plane 노드를 구성하였는데, kube-system 네임스페이스의 Pod들이 자꾸 종료되었다가 재시작하는 현상이 있던 것이다. 특히 kube-apiserver가 종료되면 로그도 볼 수 없어서 치명적이였는데, &lt;code class=&quot;language-text&quot;&gt;crictl ps&lt;/code&gt; 명령어를 통해 살펴보면 컨테이너가 아예 죽은 것으로 보였다. 원인을 찾기 위해 쿠버네티스 포럼부터 시작해서 스택오버플로우를 뒤져봤지만 하나같이 &lt;code class=&quot;language-text&quot;&gt;swapoff -a&lt;/code&gt;와 같은 메모리 스왑 방지 명령어만 알려주었다.&lt;/p&gt;
&lt;/br&gt;
&lt;p&gt;하지만, 내가 설치한 모든 VM에서는 당연하게도 swap 관련 기능이 켜져있지 않았다. 그러다가 스택오버플로우에 올라온 한 가지 질문을 확인하다가 원인을 발견할 수 있었다.&lt;/p&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;sh&quot;&gt;&lt;pre class=&quot;language-sh&quot;&gt;&lt;code class=&quot;language-sh&quot;&gt;&lt;span class=&quot;token function&quot;&gt;cat&lt;/span&gt; /etc/fstab
&lt;span class=&quot;token assign-left variable&quot;&gt;LABEL&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt;cloudimg-rootfs   /        ext4   discard,errors&lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt;remount-ro       &lt;span class=&quot;token number&quot;&gt;0&lt;/span&gt; &lt;span class=&quot;token number&quot;&gt;1&lt;/span&gt;
&lt;span class=&quot;token comment&quot;&gt;#VAGRANT-BEGIN&lt;/span&gt;
&lt;span class=&quot;token comment&quot;&gt;# The contents below are automatically generated by Vagrant. Do not modify.&lt;/span&gt;
vagrant /vagrant vboxsf &lt;span class=&quot;token assign-left variable&quot;&gt;uid&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;token number&quot;&gt;1000&lt;/span&gt;,gid&lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;token number&quot;&gt;1000&lt;/span&gt;,_netdev &lt;span class=&quot;token number&quot;&gt;0&lt;/span&gt; &lt;span class=&quot;token number&quot;&gt;0&lt;/span&gt;
&lt;span class=&quot;token comment&quot;&gt;#VAGRANT-END&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;/br&gt;
&lt;p&gt;&lt;a href=&quot;https://stackoverflow.com/questions/76041535/control-plane-pods-in-restart-loop-after-installation-with-kube-adm&quot;&gt;Control Plane Pods in restart loop after installation with kubeadm&lt;/a&gt;&lt;/p&gt;
&lt;/br&gt;
&lt;p&gt;위 링크의 질문을 올린 사람은 나와 비슷한 현상을 겪고 있었는데, 그에 대한 답변은 cgroup이 제대로 설정되지 않았을 테니 cgroup을 확인해보라는 것이었다. 실제로 확인 결과 &lt;code class=&quot;language-text&quot;&gt;SystemdCgroup&lt;/code&gt; 설정이 false로 되어 있는 것이 아닌가... 앞에서 쿠버네티스 가이드대로 설정한 것이 제대로 먹히지 않은 것이다. 바로 아래 답변에서는 해결 방법도 알려주었는데, containerd의 기본 설정을 복사 붙여넣기 해서 &lt;code class=&quot;language-text&quot;&gt;SystemdCgroup&lt;/code&gt; 만 &lt;code class=&quot;language-text&quot;&gt;true&lt;/code&gt;로 설정해주라는 것이었다. 아래 방법대로 따라하니 &lt;code class=&quot;language-text&quot;&gt;kube-system&lt;/code&gt; 네임 스페이스의 파드들이 하나씩 재기동되면서 전체 다 정상적으로 돌아가게 되었다.&lt;/p&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;sh&quot;&gt;&lt;pre class=&quot;language-sh&quot;&gt;&lt;code class=&quot;language-sh&quot;&gt;containerd config dump &lt;span class=&quot;token operator&quot;&gt;|&lt;/span&gt; &lt;span class=&quot;token function&quot;&gt;grep&lt;/span&gt; SystemdCgroup
            SystemdCgroup &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;token boolean&quot;&gt;false&lt;/span&gt;

containerd config default &lt;span class=&quot;token operator&quot;&gt;&gt;&lt;/span&gt; /etc/containerd/config.toml

containerd config dump &lt;span class=&quot;token operator&quot;&gt;|&lt;/span&gt; &lt;span class=&quot;token function&quot;&gt;grep&lt;/span&gt; SystemdCgroup
            SystemdCgroup &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;token boolean&quot;&gt;true&lt;/span&gt;

&lt;span class=&quot;token function&quot;&gt;sudo&lt;/span&gt; sytemctl restart containerd&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;/br&gt;
&lt;p&gt;적다 보니 매우 긴 글이 되었는데, 요지는 반복해보면 생각보다 어렵지 않다는 것이다. 사실 이 장문의 글을 적게 된 이유는 마지막 트러블슈팅 때 발견한 사실 때문이었다. 2주간 원인을 찾지 못해서 맘썩히다가 겨우 찾아낸 기쁨을 기록으로 남기고자 이렇게 장문으로 설치 방법을 작성하게 되었다. 아무쪼록 다른 사람들도 같은 이유로 이렇게 해메지 않도록 하는 마음으로 글을 마치고자 한다.&lt;/p&gt;
&lt;/br&gt;
&lt;h2&gt;출처&lt;/h2&gt;
&lt;p&gt;&lt;a href=&quot;https://engineer-mole.tistory.com/324&quot;&gt;Vagrant 설명&lt;/a&gt;&lt;/br&gt;
&lt;a href=&quot;https://kubernetes.io/docs/concepts/architecture/cri/&quot;&gt;CRI(Container Runtime Interface)&lt;/a&gt;&lt;/br&gt;
&lt;a href=&quot;https://kr.linkedin.com/pulse/containerd%EB%8A%94-%EB%AC%B4%EC%97%87%EC%9D%B4%EA%B3%A0-%EC%99%9C-%EC%A4%91%EC%9A%94%ED%95%A0%EA%B9%8C-sean-lee&quot;&gt;containerd&lt;/a&gt;&lt;/br&gt;
&lt;a href=&quot;https://hwwwi.tistory.com/12&quot;&gt;cgroup&lt;/a&gt;&lt;/br&gt;
&lt;a href=&quot;https://www.slideshare.net/JoHoon1/systemd-cgroup&quot;&gt;cgroup과 systemd&lt;/a&gt;&lt;/br&gt;&lt;/p&gt;</content:encoded></item><item><title><![CDATA[[MicroPython] RaspberryPi Pico에서 MicroPython 사용하기]]></title><description><![CDATA[RaspberryPi Pico는 라이베리파이 재단에서 소형 MCU 보드로, 기존 라즈베리파이가 MPU를 사용하여 OS를 올리는 방식과 달리 마이크로컨트롤러를 이용하였다. 또한, 자체 설계한 RP204…]]></description><link>https://github.com/SiverPineValley/SiverPineValley.github.io/embedded/micropython_raspberrypi/</link><guid isPermaLink="false">https://github.com/SiverPineValley/SiverPineValley.github.io/embedded/micropython_raspberrypi/</guid><pubDate>Mon, 14 Aug 2023 17:30:00 GMT</pubDate><content:encoded>&lt;p&gt;RaspberryPi Pico는 라이베리파이 재단에서 소형 MCU 보드로, 기존 라즈베리파이가 MPU를 사용하여 OS를 올리는 방식과 달리 마이크로컨트롤러를 이용하였다. 또한, 자체 설계한 RP2040 프로세서로 작지만 강력한 성능을 보여주는 장치이다. 내가 프로젝트를 하면서 이 녀석을 사용하게 된 이유는 가성비가 엄청나다는 점이었다. 단순하게 가격 비교만 해봐도 아래와 같이 비교가 된다.&lt;/p&gt;
&lt;div align=&quot;center&quot;&gt;
  &lt;span class=&quot;gatsby-resp-image-wrapper&quot; style=&quot;position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 630px; &quot;&gt;
      &lt;a class=&quot;gatsby-resp-image-link&quot; href=&quot;/static/cb596737907dd45c40f3992288ffdb26/8de58/raspberrypi4.png&quot; style=&quot;display: block&quot; target=&quot;_blank&quot; rel=&quot;noopener&quot;&gt;
    &lt;span class=&quot;gatsby-resp-image-background-image&quot; style=&quot;padding-bottom: 51.26582278481012%; position: relative; bottom: 0; left: 0; background-image: url(&apos;data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAKCAYAAAC0VX7mAAAACXBIWXMAAA7DAAAOwwHHb6hkAAACOElEQVR42lVSS2sTURTO7xEFwYqLiGIJ2ICID4IiQmPFRyvUhaJF1E1XQlaK0YXFXbtyI4iodVmMaW1jSKSJ0zbJNJN55zGPzEwm+Tz3hoZ44HBf53z3+845EVmRIUr70HQNdUlCo9GAruswDAOqpkHTVL5vWRaMponBYDByZkEQ0LvJV3YXURsylJ0arI6FTqcDmxJ1WYUmK2hSoKYbqIt16MIOxGoVlZYJx3Vg2zbcbheu68I0TViU16VzxNsTsZV6h+21DQiZTezlipBLJUiCgHZdQUC/7ldEeMIu5EoFv+sSZ9Pv9/9jGoYhv49sSTlcnruE6LUpHE+exdHrMcRmJvF17Rt8L6DAHlqtJuzAR59Y0QGe53HAcWNnDpjdzSP+aBq3Fu9h5kESRxKTOJQ4jSfPnyJfKKBHgBrVMuz10CUgm2QNOQ1GYONMI9ulPzj37AauvpjH+YfTiCYv4DABJh/PIrOeQ0BSHMeG7we8Rg6xZAx93+c+2tPKGf4sZnEsPoETC1cwkbqN+J0EohdP4ebCXayufudSWMKwmzpEsQZFUfg0SDQVqqpy0OBAsmlJWFpJI/X+Jd6svMXr9Cuk0otY/riMcvkvl3IA2CPZzBmA5w1ZhWx0WMdpAlhZIuN1YNakH4sfPsP4lEH9yw8MeiEHZHJZJ8djubHRkRpo0udhuzMEZLI2cusQqgJqtSp+bWZRLuQRmhZ/cxyHDzufU2LD3KBGuZTbmp1H+2QM7TNTsObu4x8FXsVHXFyBagAAAABJRU5ErkJggg==&apos;); background-size: cover; display: block;&quot;&gt;&lt;/span&gt;
  &lt;img class=&quot;gatsby-resp-image-image&quot; alt=&quot;raspberrypi4&quot; title=&quot;&quot; src=&quot;/static/cb596737907dd45c40f3992288ffdb26/f058b/raspberrypi4.png&quot; srcset=&quot;/static/cb596737907dd45c40f3992288ffdb26/c26ae/raspberrypi4.png 158w,
/static/cb596737907dd45c40f3992288ffdb26/6bdcf/raspberrypi4.png 315w,
/static/cb596737907dd45c40f3992288ffdb26/f058b/raspberrypi4.png 630w,
/static/cb596737907dd45c40f3992288ffdb26/40601/raspberrypi4.png 945w,
/static/cb596737907dd45c40f3992288ffdb26/8de58/raspberrypi4.png 1219w&quot; sizes=&quot;(max-width: 630px) 100vw, 630px&quot; style=&quot;width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;&quot; loading=&quot;lazy&quot; decoding=&quot;async&quot;&gt;
  &lt;/a&gt;
    &lt;/span&gt;
  &lt;span class=&quot;gatsby-resp-image-wrapper&quot; style=&quot;position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 630px; &quot;&gt;
      &lt;a class=&quot;gatsby-resp-image-link&quot; href=&quot;/static/e161958e295b61493e913443848b899b/9239a/picowh.png&quot; style=&quot;display: block&quot; target=&quot;_blank&quot; rel=&quot;noopener&quot;&gt;
    &lt;span class=&quot;gatsby-resp-image-background-image&quot; style=&quot;padding-bottom: 52.53164556962025%; position: relative; bottom: 0; left: 0; background-image: url(&apos;data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAALCAYAAAB/Ca1DAAAACXBIWXMAAA7DAAAOwwHHb6hkAAACHElEQVR42l1TS2sUQRCeH+RZ/AGevHgR9RLwJIiClxA8iIInHxdFyUXEQyKCkT1orsHEBfEQhQ0uya5kJ3FfM5vdefS8ex6fVbU7sNozNT1d0/XVV1/1GEedDgaDAcwTE6Zpot//g5PTU/R6PYyGQ1hk47GNNMuQZSlZJqa1RlmWsG0bruuKr6oqGEmSIIoixHGMkOYwDGXN/jRNceBMMR12kQcu4ryEXgDWoLwnpUS8v6xKGIzKmYqiACq+5xcP9h8TA8+xkHMSP0Ke5+LnODaJoJmBhWFOQPMPwEwnePdzBx/2GogjT3zK8+ATa01Wnp1JoCT/b3AiAeSFl8ZotL/h2tM1XHl8B+dXr+Ph5hNikmPmOFIeJ1ZRLOxkLEjUTGtSxla7ifub69j4+Aa3XtzDubUVPNp4hcNuRzawpgzIGgVKycxrZio6L2nKyYzb289x4fUqVl4+wN23z7B/8ANlpufZ6WLhtc7hKx/9wRCTyQSWZVHnLdj0zo2sEwggB75vNrC18xkZfZRmcKO4DNJFE0hBzLTnIyM9E18hpjlmXxCgYG0priCrGFD6xLosNFjWhX2aykooqCAWy3vqwe0JxyNkdBZFw2rBaDSjUhwymmuB+VmfNU1subti/M5gVHqy+xX+lz2Eu01UKpiXnNDB/N5tYf+ohdbv9j9MGYw7rajE+gdwp1PEzOzTNtTFSwhv3IS6fBX5rzb+AlLyObta6QHsAAAAAElFTkSuQmCC&apos;); background-size: cover; display: block;&quot;&gt;&lt;/span&gt;
  &lt;img class=&quot;gatsby-resp-image-image&quot; alt=&quot;picowh&quot; title=&quot;&quot; src=&quot;/static/e161958e295b61493e913443848b899b/f058b/picowh.png&quot; srcset=&quot;/static/e161958e295b61493e913443848b899b/c26ae/picowh.png 158w,
/static/e161958e295b61493e913443848b899b/6bdcf/picowh.png 315w,
/static/e161958e295b61493e913443848b899b/f058b/picowh.png 630w,
/static/e161958e295b61493e913443848b899b/40601/picowh.png 945w,
/static/e161958e295b61493e913443848b899b/9239a/picowh.png 1246w&quot; sizes=&quot;(max-width: 630px) 100vw, 630px&quot; style=&quot;width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;&quot; loading=&quot;lazy&quot; decoding=&quot;async&quot;&gt;
  &lt;/a&gt;
    &lt;/span&gt;
&lt;/div&gt;
&lt;/br&gt;
&lt;p&gt;위 사진은 본체 단위의 단순 가격을 비교한건데, 본체만 했을 때 거의 1/8 가격으로 구매 가능하다. Pico WH의 경우 헤더핀을 장착한 모델인데, 헤더핀을 빼고 구매하면 더 저렴하게 구매 가능하다. 불과 수 년 전만 해도 라즈베리파이가 이정도 가격은 아니였던 때도 있었는데, 코로나 시기 반도체 물량 부족으로 인해 가격이 천정부지로 올라버렸다.&lt;/p&gt;
&lt;/br&gt;
&lt;p&gt;물론, 기존 Raspberry Pi 4가 성능적으로도 더 우월하며, OS가 올라가 있어 각종 설정이 쉽다. 또한, 레퍼런스가 많아 다양한 작업을 빠르게 찾아 적용 가능하다는 점에서 구현 면에서는 훨씬 쉬울 것이다. 하지만, OS에서 제공하는 대부분의 기능은 내가 원하는 프로젝트에서는 너무 무겁게 느껴지게 되었고 Pico의 경우 아두이노보다도 더 저렴한 MCU다 보니 선택하게 되었다.&lt;/p&gt;
&lt;/br&gt;
&lt;p&gt;Pico는 아래와 같은 Pinout을 갖는다. I2C, SPI, UART 2개, 12 Bit ADC 3개, 16채널 PWM을 제공하며 USB 1.1 포트를 제공한다. USB 1.1 포트를 통해서 전원을 공급하거나 각종 파일 전달이 가능하다. Pico W의 경우 각종 무선 네트워크 기능이 추가로 제공된다. 지원되는 인터페이스로는 단일 밴드 2.4GHz 무선 인터페이스 (Wi-fi), WPA3, Blooth 5.2 (Blooth Classic, BLE 모두 지원)가 있다.&lt;/p&gt;
&lt;div align=&quot;center&quot;&gt;
  &lt;img src=&quot;./images/pico-pinout.svg&quot; width=&quot;600px&quot;&gt;
&lt;/div&gt;
&lt;/br&gt;
&lt;p&gt;Pico는 기본적으로 C, C++ 기반의 임베디드 언어를 지원한다. 다만, 이를 위해서는 &lt;a href=&quot;https://github.com/raspberrypi/pico-sdk&quot;&gt;pico SDK&lt;/a&gt;를 사용하거나 &lt;a href=&quot;https://www.freertos.org/index.html&quot;&gt;RTOS&lt;/a&gt;와 같은 오픈소스 프로젝트를 공부해야 한다는 점에서 빠른 기능 구현을 위해 포기하게 되었다.&lt;/p&gt;
&lt;/br&gt;
&lt;p&gt;C나 C++을 제외한다면 가장 대중적으로 사용되는 언어는 &lt;a href=&quot;https://micropython.org/&quot;&gt;MicroPython&lt;/a&gt;이다. 라즈베리파이 재단에서 공식적으로 지원하는 언어는 이렇게 두 종류이다. 파이썬이라면 학부때 사용했던 기억이 있기에 이를 채택하게 되었다. 레퍼런스도 pico SDK 다음으로 많았기 때문에 대부분의 기능을 쉽게 구현 가능했다. (물론 성능을 고려한다면 C/C++를 사용하는게 좋다.)&lt;/p&gt;
&lt;/br&gt;
&lt;p&gt;앞서 너무 많은 TMI를 서술하였는데, 제목의 내용을 간단하게 설명해보고자 한다. C++/C 코드를 구현하는 방법은 차후에 다시 작성할 예정이다.&lt;/p&gt;
&lt;/br&gt;
&lt;h2&gt;1. MicroPhton SDK 다운로드&lt;/h2&gt;
&lt;p&gt;먼저, SDK의 경우 &lt;a href=&quot;https://www.raspberrypi.com/documentation/microcontrollers/micropython.html#what-is-micropython&quot;&gt;링크&lt;/a&gt;에서 다운로드 가능하다. 페이지에 접속하여, 화면을 좀 내리다 보면 아래와 같은 부분을 발견할 수 있다.&lt;/p&gt;
&lt;/br&gt;
&lt;div align=&quot;center&quot;&gt;
  &lt;span class=&quot;gatsby-resp-image-wrapper&quot; style=&quot;position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 630px; &quot;&gt;
      &lt;a class=&quot;gatsby-resp-image-link&quot; href=&quot;/static/bd76d053e746e1534eb720649b760ef9/146da/micropython_install.png&quot; style=&quot;display: block&quot; target=&quot;_blank&quot; rel=&quot;noopener&quot;&gt;
    &lt;span class=&quot;gatsby-resp-image-background-image&quot; style=&quot;padding-bottom: 77.21518987341771%; position: relative; bottom: 0; left: 0; background-image: url(&apos;data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAPCAYAAADkmO9VAAAACXBIWXMAAA7DAAAOwwHHb6hkAAAB50lEQVR42pVU227aQBD1p6bqBySNeEBB6ieA+gEtIuQHmuf0rbxWFUUlQCUQaYBdX9b2mgU7mJOZRW6tCid0pePZi+fs2dmZdcTDI370+7j/OcR4PMZoNMJwOMRkMsFgMMB0OsV2u8Vms3kVxhg4sdYQyyXcpYDv+wj8AEEQHPolW0ApRVZZG4ahhZ0jrNdrODrR8KIQYiUgpYTruhZC0tiVFq7nIY41oigiG/+xLCaOaBwfxpbQ6AR6NMVTlsGQbN4gJgdeLCNJEmvZMaN/0zQ9fmRDO6jedyDfI9ExElKy3+9R1fI8t+tMyBswSRkOB5xbSru+v2rg7dkbnF+co9FooNlsotVqoV6v493lJc1foFar2ZAwKauuJMzSDJ9vb9HtdnHd6aBDuPtyh6+9HtrtNj4QcfvjJ9zcdG0Md7vdywq58Y1xfBgcE3ZkFch2wFP+f0fmNpvNIISwR5rP53hcLLB4+I1f3/qUWiusaE1RyjDpq4S8K98gK9KcDtS3uacIpJznirWTCYsg/5sKpuTIJBy/SsJyjhX9QkkxX1Vmx+Cwo0sV4kv3ACq1Q3n9LbdjSioJzcZAU6C19JB4AXQYQRH4xllJ8TCcTLimT0yKtOtD08OgSKGkW5aCHwsPfuDb9DmV8BnRtGsAa2xTywAAAABJRU5ErkJggg==&apos;); background-size: cover; display: block;&quot;&gt;&lt;/span&gt;
  &lt;img class=&quot;gatsby-resp-image-image&quot; alt=&quot;micropython install&quot; title=&quot;&quot; src=&quot;/static/bd76d053e746e1534eb720649b760ef9/f058b/micropython_install.png&quot; srcset=&quot;/static/bd76d053e746e1534eb720649b760ef9/c26ae/micropython_install.png 158w,
/static/bd76d053e746e1534eb720649b760ef9/6bdcf/micropython_install.png 315w,
/static/bd76d053e746e1534eb720649b760ef9/f058b/micropython_install.png 630w,
/static/bd76d053e746e1534eb720649b760ef9/146da/micropython_install.png 943w&quot; sizes=&quot;(max-width: 630px) 100vw, 630px&quot; style=&quot;width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;&quot; loading=&quot;lazy&quot; decoding=&quot;async&quot;&gt;
  &lt;/a&gt;
    &lt;/span&gt;
&lt;/div&gt;
&lt;/br&gt;
&lt;p&gt;각 링크는 라즈베리파이 피코, 라즈베리파이 피코 W (BLE 기능 제외 Wi-fi만 제공), 라즈베리파이 피코 W (BLE 기능 추가 지원)으로, 사용하고자 하는 라즈베리파이 버전과 용도에 맞게 다운로드를 하면 된다. 다운로드를 하면 &lt;code class=&quot;language-text&quot;&gt;.uf2&lt;/code&gt; 파일이 받아진다.&lt;/p&gt;
&lt;/br&gt;
&lt;h2&gt;2. Raspberry Pi Pico 연결&lt;/h2&gt;
&lt;p&gt;Pico를 연결하면 Windows의 경우 자동으로 드라이버를 설치해준다. Mac이나 Linux의 경우 COM Port를 붙어서 진행하거나 &lt;a href=&quot;https://thonny.org/&quot;&gt;Thonny IDE&lt;/a&gt;를 통해서도 설치 가능하다. 처음 연결하면 바로 가능하나, 다시 SDK를 설치하고자 하면 pico의 &lt;code class=&quot;language-text&quot;&gt;BOOTSET&lt;/code&gt; 버튼을 꾹 누르면 SDK가 초기화되어 설치 가능하다.&lt;/p&gt;
&lt;/br&gt;
&lt;h2&gt;3. SDK 설치&lt;/h2&gt;
&lt;p&gt;라즈베리파이가 연결되었고 내PC에서 연결된 것이 보이면 아까 다운받았던 &lt;code class=&quot;language-text&quot;&gt;uf2&lt;/code&gt; 파일을 넣어주면 끝이다. Thonny IDE로 다운받을 경우 pico를 연결한 뒤, 화면 우측 하단에서 &lt;code class=&quot;language-text&quot;&gt;Install MicroPython&lt;/code&gt;을 통해 설치 가능하다. 다만, 이 경로로 설치를 하면 pico W의 경우, BLE 기능이 지원되는 SDK를 설치할 수 없다는 단점이 있다.&lt;/p&gt;
&lt;/br&gt;
&lt;p&gt;코드 작성은 Visual Studio Code나 Thonny IDE를 통해서 가능하다. IDE로서의 기능은 VS Code가 좋지만, pico에 파일을 전달하거나 하는 UI는 Thonny가 더 낫다. 취향대로 사용하면 된다. 두 IDE 모두 pico 내부 혹은 PC의 &lt;code class=&quot;language-text&quot;&gt;.py&lt;/code&gt; 파일을 동작하도록 하는 것도 가능하다. 외부 전원을 넣고 전원이 들어올때마다 자동으로 동작시키고자 한다면 &lt;code class=&quot;language-text&quot;&gt;main.py&lt;/code&gt; 파일 내에 main 함수를 작성해주면 된다.&lt;/p&gt;
&lt;/br&gt;
&lt;h2&gt;4. 초기화&lt;/h2&gt;
&lt;p&gt;만약, &lt;code class=&quot;language-text&quot;&gt;main.py&lt;/code&gt; 파일을 작성하여 동작시키도록 하였는데, 반복 루프를 걸어서 PC에 연결을 해도 동작이 멈추지 않는다면 어떻게 해야할까? 보통은 인터럽트를 걸어서 코드를 중단시키는 방법이 있으나 통하지 않는 경우도 있다. 이 경우 SDK 재설치 방법은 통하지 않는다. SDK 재설치는 SDK 파일만 날리는 거라 &lt;code class=&quot;language-text&quot;&gt;.py&lt;/code&gt; 파일들은 그대로 남아 있어 설치한 뒤에 바로 또 빠져나올 수 없는 루프로 진입하게 된다.&lt;/p&gt;
&lt;p&gt;이때는 &lt;a href=&quot;https://github.com/dwelch67/raspberrypi-pico/blob/main/flash_nuke.uf2&quot;&gt;flash_nuke.uf2&lt;/a&gt; 파일을 넣어주면 된다. SDK 초기화와 마찬가지로 &lt;code class=&quot;language-text&quot;&gt;BOOTSET&lt;/code&gt; 버튼을 누른 뒤, 화면을 통해 flash_nuke.uf2 파일을 넣어주기만 하면 된다.&lt;/p&gt;
&lt;/br&gt;
&lt;h2&gt;끝마치며&lt;/h2&gt;
&lt;p&gt;위 내용들은 사실 &lt;a href=&quot;https://www.raspberrypi.com/documentation/microcontrollers/raspberry-pi-pico.html&quot;&gt;메뉴얼&lt;/a&gt;만 천천히 읽어봐도 쉽게 확인 가능한 내용들이다. 나처럼 삽질하면서 하나씩 알아가는 사람이 없기를 바라며 이렇게 정리해보았다.&lt;/p&gt;
&lt;/br&gt;
&lt;p&gt;추가로, 지원되는 언어를 찾아보다 보니 Go언어에서도 이러한 임베디드 프로그래밍을 지원하기 위한 프로젝트가 있는 모양이다. &lt;a href=&quot;https://tinygo.org/&quot;&gt;TinyGo&lt;/a&gt;라고 하는데, 예시 코드가 돌아가는 MCU가 Raspberry Pi를 이용한 것 같다. 라이브러리를 대충 보니 공식 지원되는 언어와 비슷한 기능들이 대부분 지원되는 것 같아서 한번 고려해 보는 것도 좋을 것 같다. 빌드 후 바이너리의 형태를 pico에 넣는 방식인 것을 보니 MicroPython 보다는 성능적으로 더 좋지 않을까 싶다.&lt;/p&gt;</content:encoded></item><item><title><![CDATA[[MicroPython] mip를 통한 MicroPython 라이브러리 받기]]></title><description><![CDATA[최근 Raspberry Pi Pico W와 MicroPython을 사용한 작은 프로젝트를 하나 하고 있다. Thonny라는 IDE를 사용해서 Raspberry Pi Pico…]]></description><link>https://github.com/SiverPineValley/SiverPineValley.github.io/embedded/micropython_mip/</link><guid isPermaLink="false">https://github.com/SiverPineValley/SiverPineValley.github.io/embedded/micropython_mip/</guid><pubDate>Mon, 14 Aug 2023 17:00:00 GMT</pubDate><content:encoded>&lt;p&gt;최근 Raspberry Pi Pico W와 MicroPython을 사용한 작은 프로젝트를 하나 하고 있다. Thonny라는 IDE를 사용해서 Raspberry Pi Pico 의 파일을 옮기거나 빼올 수 있는데, 몇 개월 동안 씨름하고 나서야 외부 라이브러리를 받아오는 방법을 발견하였다. 직접 &lt;code class=&quot;language-text&quot;&gt;.py&lt;/code&gt; 코드 파일을 넣어주고, 이 파일을 import하는 방법도 가능하지만, 대부분의 라이브러리들이 단일 파일로 작성되어 있지 않으므로 매우 번거롭다.&lt;/p&gt;
&lt;/br&gt;
&lt;p&gt;mip를 사용하면 &lt;code class=&quot;language-text&quot;&gt;/lib&lt;/code&gt; 디렉토리 내에 모듈별로 .mpy 파일로 저장되며 소스 코드 내에서 라이브러리명을 import하여 받아올 수 있다.&lt;/p&gt;
&lt;/br&gt;
&lt;p&gt;자세한 방법은 &lt;a href=&quot;https://github.com/micropython/micropython-lib/tree/master&quot;&gt;github.com/micropython/micropython-lib&lt;/a&gt; 에서 메뉴얼을 찾아볼 수도 있지만, 보다 명확하고 간단하게 설명해보고자 한다.&lt;/p&gt;
&lt;/br&gt;
&lt;h2&gt;1. 인터넷이 바로 사용 가능한 MCU의 경우,&lt;/h2&gt;
&lt;p&gt;MCU 자체적으로 인터넷에 연결된 경우에는 매우 간단하다. 그냥 python 스크립트를 열어서 아래와 같이 입력하면 되기 때문이다. 다운로드 가능한 라이브러리의 패키지 목록은 &lt;a href=&quot;https://github.com/micropython/micropython-lib/tree/master/micropython&quot;&gt;github.com/micropython/micropython-lib/micropython&lt;/a&gt; 에서 확인 가능하다.&lt;/p&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;python&quot;&gt;&lt;pre class=&quot;language-python&quot;&gt;&lt;code class=&quot;language-python&quot;&gt;&lt;span class=&quot;token keyword&quot;&gt;import&lt;/span&gt; mip
mip&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;install&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token string&quot;&gt;&quot;package-name&quot;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;/br&gt;
&lt;h2&gt;2. PC에서 다운받아서 옮기는 경우,&lt;/h2&gt;
&lt;p&gt;위의 케이스와 다르게 Rasbperry Pi Pico의 경우 &lt;code class=&quot;language-text&quot;&gt;wlan&lt;/code&gt;을 통해 인터넷을 잡아준 것이 아니라면, PC를 통해 라이브러리를 받아올 수도 있다. 매번 wlan 설정을 해주는 것 보다, 아래 절차대로 하는게 맘 편하므로 아래 방법을 추천한다.&lt;/p&gt;
&lt;/br&gt;
&lt;h3&gt;2.1 Python3 설치 (공홈 참고)&lt;/h3&gt;
&lt;p&gt;&lt;a href=&quot;https://www.python.org/downloads/&quot;&gt;Python&lt;/a&gt;&lt;/p&gt;
&lt;/br&gt;
&lt;h3&gt;2.2 pip 업그레이드&lt;/h3&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;sh&quot;&gt;&lt;pre class=&quot;language-sh&quot;&gt;&lt;code class=&quot;language-sh&quot;&gt;python &lt;span class=&quot;token parameter variable&quot;&gt;-m&lt;/span&gt; pip &lt;span class=&quot;token function&quot;&gt;install&lt;/span&gt; &lt;span class=&quot;token parameter variable&quot;&gt;--upgrade&lt;/span&gt; pip&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;/br&gt;
&lt;h3&gt;2.3 mpremote 모듈 설치&lt;/h3&gt;
&lt;p&gt;PC에서 설치할 경우 mpremote의 install 기능을 사용하여 전달 가능하다. mpremote를 설치를 하더라도 바로 명령어가 먹지 않을 수도 있는데, 실체 설치된 경로의 바이너리를 환경변수에 설정해주어야 한다.&lt;/p&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;sh&quot;&gt;&lt;pre class=&quot;language-sh&quot;&gt;&lt;code class=&quot;language-sh&quot;&gt;pip &lt;span class=&quot;token function&quot;&gt;install&lt;/span&gt; &lt;span class=&quot;token parameter variable&quot;&gt;--user&lt;/span&gt; mpremote&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;/br&gt;
&lt;h3&gt;2.4 패키지 설치&lt;/h3&gt;
&lt;p&gt;아래와 같이 설치하면 PC에 연결된 MCU를 인식하여 라이브러리를 전송해준다. 만약, 인식되지 않았다면 &lt;code class=&quot;language-text&quot;&gt;mpreote link&lt;/code&gt; 명령어등을 사용하여 연결을 먼저 한 뒤 전송해주어야 한다.&lt;/p&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;sh&quot;&gt;&lt;pre class=&quot;language-sh&quot;&gt;&lt;code class=&quot;language-sh&quot;&gt;mpremote mip &lt;span class=&quot;token function&quot;&gt;install&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;package-name&lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;/br&gt;</content:encoded></item><item><title><![CDATA[[k8s] Jsonpath]]></title><description><![CDATA[1. JSONPath k8s에서는 각종 오브젝트의 세팅 정보를 YAML과 JSON 형태로 보여주는 경우가 많다. 대부분의 매니페스트 파일들이 YAML 형식이지만, YAML은 JSON으로도 쉽게 변경 가능하다. k8s…]]></description><link>https://github.com/SiverPineValley/SiverPineValley.github.io/kubernetes/k8s_jsonpath/</link><guid isPermaLink="false">https://github.com/SiverPineValley/SiverPineValley.github.io/kubernetes/k8s_jsonpath/</guid><pubDate>Fri, 11 Aug 2023 22:00:00 GMT</pubDate><content:encoded>&lt;h1&gt;1. JSONPath&lt;/h1&gt;
&lt;p&gt;k8s에서는 각종 오브젝트의 세팅 정보를 YAML과 JSON 형태로 보여주는 경우가 많다. 대부분의 매니페스트 파일들이 YAML 형식이지만, YAML은 JSON으로도 쉽게 변경 가능하다. k8s 오브젝트를 운영하면서 &lt;code class=&quot;language-text&quot;&gt;kubectl get {obejct}&lt;/code&gt; 명령어는 엄청 자주 사용하게 되는데, 특정 오브젝트의 핵심적인 정보들은 &lt;code class=&quot;language-text&quot;&gt;kubectl get {obejct} -o=wide&lt;/code&gt; 명령어를 사용하여 조회 가능하다. 하지만, 내가 보고 싶은 정보만을 가져오기 위해서는 &lt;code class=&quot;language-text&quot;&gt;kubectl get {obejct} -o=jsonpath=&lt;/code&gt; 옵션을 사용해야 한다. 이 옵션으로 조회하기 위해서는 Json path라는 쿼리 명령어를 사용해야 한다.&lt;/p&gt;
&lt;/br&gt;
&lt;h2&gt;1.1 JSONPath의 기본 문법&lt;/h2&gt;
&lt;p&gt;Json 파일은 key 와 value로 구성되며, key는 String 형식으로, value에는 Number, String, Boolean, Dictionary 형식으로 구성된다. 여기서 Dictionary란 key와 value로 구성된 Object이며, Json path는 특정 value를 찾아내기 위한 경로를 나타내는 표현식을 말한다.&lt;/p&gt;
&lt;p&gt;기본적으로는 아래와 같은 문법을 가진다.&lt;/p&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;json&quot;&gt;&lt;pre class=&quot;language-json&quot;&gt;&lt;code class=&quot;language-json&quot;&gt;&lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;
  &lt;span class=&quot;token property&quot;&gt;&quot;vehicles&quot;&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;
      &lt;span class=&quot;token property&quot;&gt;&quot;car&quot;&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;
      &lt;span class=&quot;token property&quot;&gt;&quot;color&quot;&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;token string&quot;&gt;&quot;blue&quot;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt;
      &lt;span class=&quot;token property&quot;&gt;&quot;price&quot;&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;token string&quot;&gt;&quot;$20,000&quot;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt;
      &lt;span class=&quot;token property&quot;&gt;&quot;wheels&quot;&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;[&lt;/span&gt;
        &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;
          &lt;span class=&quot;token property&quot;&gt;&quot;model&quot;&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;token string&quot;&gt;&quot;X345ERT&quot;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt;
          &lt;span class=&quot;token property&quot;&gt;&quot;location&quot;&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;token string&quot;&gt;&quot;front-right&quot;&lt;/span&gt;
        &lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt;
        &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;
          &lt;span class=&quot;token property&quot;&gt;&quot;model&quot;&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;token string&quot;&gt;&quot;X346GRX&quot;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt;
          &lt;span class=&quot;token property&quot;&gt;&quot;location&quot;&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;token string&quot;&gt;&quot;front-left&quot;&lt;/span&gt;
        &lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt;
        &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;
          &lt;span class=&quot;token property&quot;&gt;&quot;model&quot;&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;token string&quot;&gt;&quot;X236DEM&quot;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt;
          &lt;span class=&quot;token property&quot;&gt;&quot;location&quot;&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;token string&quot;&gt;&quot;rear-right&quot;&lt;/span&gt;
        &lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;
      &lt;span class=&quot;token punctuation&quot;&gt;]&lt;/span&gt;
    &lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt;
    &lt;span class=&quot;token property&quot;&gt;&quot;bus&quot;&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;
      &lt;span class=&quot;token property&quot;&gt;&quot;color&quot;&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;token string&quot;&gt;&quot;white&quot;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt;
      &lt;span class=&quot;token property&quot;&gt;&quot;price&quot;&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;token string&quot;&gt;&quot;$120,000&quot;&lt;/span&gt;
    &lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;
  &lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;
&lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;/br&gt;
&lt;ul&gt;
&lt;li&gt;Json path에서 각 키 값을 통해 쿼리 가능하다.&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;&lt;/br&gt; &lt;code class=&quot;language-text&quot;&gt;vehicles.car&lt;/code&gt;&lt;/p&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;json&quot;&gt;&lt;pre class=&quot;language-json&quot;&gt;&lt;code class=&quot;language-json&quot;&gt;&lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;
  &lt;span class=&quot;token property&quot;&gt;&quot;color&quot;&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;token string&quot;&gt;&quot;blue&quot;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt;
  &lt;span class=&quot;token property&quot;&gt;&quot;price&quot;&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;token string&quot;&gt;&quot;$20,000&quot;&lt;/span&gt;
&lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;ul&gt;
&lt;li&gt;가장 바깥쪽 중괄호&lt;code class=&quot;language-text&quot;&gt;({})&lt;/code&gt;는 Root를 의미한다.&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;&lt;/br&gt; &lt;code class=&quot;language-text&quot;&gt;$.vehicles.car.color&lt;/code&gt;&lt;/p&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;json&quot;&gt;&lt;pre class=&quot;language-json&quot;&gt;&lt;code class=&quot;language-json&quot;&gt;&lt;span class=&quot;token string&quot;&gt;&quot;blue&quot;&lt;/span&gt; &lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;ul&gt;
&lt;li&gt;Array 요소는 대괄호&lt;code class=&quot;language-text&quot;&gt;[]&lt;/code&gt;를 통해 접근 가능하다.&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;&lt;/br&gt; &lt;code class=&quot;language-text&quot;&gt;$.vehicles.car.wheels[1].model&lt;/code&gt;&lt;/p&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;json&quot;&gt;&lt;pre class=&quot;language-json&quot;&gt;&lt;code class=&quot;language-json&quot;&gt;&lt;span class=&quot;token string&quot;&gt;&quot;X346GRX&quot;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;ul&gt;
&lt;li&gt;Array 요소의 Filter는 &lt;code class=&quot;language-text&quot;&gt;?()&lt;/code&gt;를 통해 가능하다. 각 요소를 나타내는 표현은 &lt;code class=&quot;language-text&quot;&gt;@&lt;/code&gt; 이다.&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;&lt;/br&gt; &lt;code class=&quot;language-text&quot;&gt;$.vehicles.car.wheels[?(@.location == &quot;rear-right&quot;)]&lt;/code&gt;&lt;/p&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;json&quot;&gt;&lt;pre class=&quot;language-json&quot;&gt;&lt;code class=&quot;language-json&quot;&gt;&lt;span class=&quot;token string&quot;&gt;&quot;X236DEM&quot;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;/br&gt;
&lt;h2&gt;1.2 Wildcard&lt;/h2&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;json&quot;&gt;&lt;pre class=&quot;language-json&quot;&gt;&lt;code class=&quot;language-json&quot;&gt;&lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;
  &lt;span class=&quot;token property&quot;&gt;&quot;vehicles&quot;&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;
      &lt;span class=&quot;token property&quot;&gt;&quot;car&quot;&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;
      &lt;span class=&quot;token property&quot;&gt;&quot;color&quot;&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;token string&quot;&gt;&quot;blue&quot;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt;
      &lt;span class=&quot;token property&quot;&gt;&quot;price&quot;&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;token string&quot;&gt;&quot;$20,000&quot;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt;
      &lt;span class=&quot;token property&quot;&gt;&quot;wheels&quot;&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;[&lt;/span&gt;
        &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;
          &lt;span class=&quot;token property&quot;&gt;&quot;model&quot;&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;token string&quot;&gt;&quot;X345ERT&quot;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt;
          &lt;span class=&quot;token property&quot;&gt;&quot;location&quot;&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;token string&quot;&gt;&quot;front-right&quot;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt;
          &lt;span class=&quot;token property&quot;&gt;&quot;brand&quot;&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;token string&quot;&gt;&quot;K&quot;&lt;/span&gt;
        &lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt;
        &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;
          &lt;span class=&quot;token property&quot;&gt;&quot;model&quot;&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;token string&quot;&gt;&quot;X346GRX&quot;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt;
          &lt;span class=&quot;token property&quot;&gt;&quot;location&quot;&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;token string&quot;&gt;&quot;front-left&quot;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt;
          &lt;span class=&quot;token property&quot;&gt;&quot;brand&quot;&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;token string&quot;&gt;&quot;K&quot;&lt;/span&gt;
        &lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;
      &lt;span class=&quot;token punctuation&quot;&gt;]&lt;/span&gt;
    &lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt;
    &lt;span class=&quot;token property&quot;&gt;&quot;bus&quot;&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;
      &lt;span class=&quot;token property&quot;&gt;&quot;color&quot;&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;token string&quot;&gt;&quot;white&quot;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt;
      &lt;span class=&quot;token property&quot;&gt;&quot;price&quot;&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;token string&quot;&gt;&quot;$120,000&quot;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt;
      &lt;span class=&quot;token property&quot;&gt;&quot;wheels&quot;&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;[&lt;/span&gt;
        &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;
          &lt;span class=&quot;token property&quot;&gt;&quot;model&quot;&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;token string&quot;&gt;&quot;Z227KLJ&quot;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt;
          &lt;span class=&quot;token property&quot;&gt;&quot;location&quot;&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;token string&quot;&gt;&quot;front-right&quot;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt;
          &lt;span class=&quot;token property&quot;&gt;&quot;brand&quot;&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;token string&quot;&gt;&quot;N&quot;&lt;/span&gt;
        &lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt;
        &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;
          &lt;span class=&quot;token property&quot;&gt;&quot;model&quot;&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;token string&quot;&gt;&quot;Z226KLJ&quot;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt;
          &lt;span class=&quot;token property&quot;&gt;&quot;location&quot;&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;token string&quot;&gt;&quot;front-left&quot;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt;
          &lt;span class=&quot;token property&quot;&gt;&quot;brand&quot;&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;token string&quot;&gt;&quot;K&quot;&lt;/span&gt;
        &lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;
      &lt;span class=&quot;token punctuation&quot;&gt;]&lt;/span&gt;
    &lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;
  &lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;
&lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;ul&gt;
&lt;li&gt;모든 요소를 표현할 때는 와일드카드&lt;code class=&quot;language-text&quot;&gt;(*)&lt;/code&gt;를 사용한다.&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;&lt;/br&gt; &lt;code class=&quot;language-text&quot;&gt;$.vehicles.*.color.&lt;/code&gt;&lt;/p&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;json&quot;&gt;&lt;pre class=&quot;language-json&quot;&gt;&lt;code class=&quot;language-json&quot;&gt;&lt;span class=&quot;token punctuation&quot;&gt;[&lt;/span&gt; &lt;span class=&quot;token string&quot;&gt;&quot;blue&quot;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;token string&quot;&gt;&quot;white&quot;&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;]&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;ul&gt;
&lt;li&gt;List 내부에서도 와일드카드&lt;code class=&quot;language-text&quot;&gt;(*)&lt;/code&gt;를 사용하여 접근 가능하다.&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;&lt;/br&gt; &lt;code class=&quot;language-text&quot;&gt;$.vehicles.*.wheels[*].model&lt;/code&gt;&lt;/p&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;json&quot;&gt;&lt;pre class=&quot;language-json&quot;&gt;&lt;code class=&quot;language-json&quot;&gt;&lt;span class=&quot;token punctuation&quot;&gt;[&lt;/span&gt; &lt;span class=&quot;token string&quot;&gt;&quot;X345ERT&quot;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;token string&quot;&gt;&quot;X346GRX&quot;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;token string&quot;&gt;&quot;Z227KLJ&quot;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;token string&quot;&gt;&quot;Z226KLJ&quot;&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;]&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;ul&gt;
&lt;li&gt;Filter 내부의 And 조건은 &lt;code class=&quot;language-text&quot;&gt;&amp;amp;&amp;amp;&lt;/code&gt;를 통해서 가능하다.&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;&lt;/br&gt; &lt;code class=&quot;language-text&quot;&gt;$.vehicles.*.wheels[?(@.location == &quot;front-left&quot; &amp;amp;&amp;amp; @.brand == &quot;K&quot;)]&lt;/code&gt;&lt;/p&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;json&quot;&gt;&lt;pre class=&quot;language-json&quot;&gt;&lt;code class=&quot;language-json&quot;&gt;&lt;span class=&quot;token punctuation&quot;&gt;[&lt;/span&gt; &lt;span class=&quot;token string&quot;&gt;&quot;X346GRX&quot;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;token string&quot;&gt;&quot;Z226KLJ&quot;&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;]&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;/br&gt;
&lt;h2&gt;1.3 Lists&lt;/h2&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;json&quot;&gt;&lt;pre class=&quot;language-json&quot;&gt;&lt;code class=&quot;language-json&quot;&gt;&lt;span class=&quot;token punctuation&quot;&gt;[&lt;/span&gt;
  &lt;span class=&quot;token string&quot;&gt;&quot;Apple&quot;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt;
  &lt;span class=&quot;token string&quot;&gt;&quot;Google&quot;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt;
  &lt;span class=&quot;token string&quot;&gt;&quot;Microsoft&quot;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt;
  &lt;span class=&quot;token string&quot;&gt;&quot;Amazon&quot;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt;
  &lt;span class=&quot;token string&quot;&gt;&quot;Facebook&quot;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt;
  &lt;span class=&quot;token string&quot;&gt;&quot;Coca-Cola&quot;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt;
  &lt;span class=&quot;token string&quot;&gt;&quot;Samsung&quot;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt;
  &lt;span class=&quot;token string&quot;&gt;&quot;Disney&quot;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt;
  &lt;span class=&quot;token string&quot;&gt;&quot;Toyota&quot;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt;
  &lt;span class=&quot;token string&quot;&gt;&quot;McDonald&apos;s&quot;&lt;/span&gt;
&lt;span class=&quot;token punctuation&quot;&gt;]&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;ul&gt;
&lt;li&gt;List에서 특정 범위 내의 요소는 &lt;code class=&quot;language-text&quot;&gt;(:)&lt;/code&gt;를 통해 조회 가능하다. 예를 들어, [0:8:2]의 경우 0번째 요소부터, 8번째 요소까지, 2번씩 건너뛰어서 조회를 하게 된다.&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;&lt;/br&gt; &lt;code class=&quot;language-text&quot;&gt;$[0:8:2]&lt;/code&gt;&lt;/p&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;json&quot;&gt;&lt;pre class=&quot;language-json&quot;&gt;&lt;code class=&quot;language-json&quot;&gt;&lt;span class=&quot;token punctuation&quot;&gt;[&lt;/span&gt;
  &lt;span class=&quot;token string&quot;&gt;&quot;Apple&quot;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt;
  &lt;span class=&quot;token string&quot;&gt;&quot;Microsoft&quot;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt;
  &lt;span class=&quot;token string&quot;&gt;&quot;Facebook&quot;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt;
  &lt;span class=&quot;token string&quot;&gt;&quot;Samsung&quot;&lt;/span&gt;
&lt;span class=&quot;token punctuation&quot;&gt;]&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;ul&gt;
&lt;li&gt;뒤에서부터 조회할 때는 -1부터 시작하게 된다. 즉, 항상 맨 마지막 요소를 조회하기 위해서는 -1 인덱스를 사용한다.&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;&lt;/br&gt; &lt;code class=&quot;language-text&quot;&gt;$[-3:]&lt;/code&gt;&lt;/p&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;json&quot;&gt;&lt;pre class=&quot;language-json&quot;&gt;&lt;code class=&quot;language-json&quot;&gt;&lt;span class=&quot;token punctuation&quot;&gt;[&lt;/span&gt;
  &lt;span class=&quot;token string&quot;&gt;&quot;Disney&quot;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt;
  &lt;span class=&quot;token string&quot;&gt;&quot;Toyota&quot;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt;
  &lt;span class=&quot;token string&quot;&gt;&quot;McDonald&apos;s&quot;&lt;/span&gt;
&lt;span class=&quot;token punctuation&quot;&gt;]&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;div align=&quot;left&quot;&gt;
  &lt;span class=&quot;gatsby-resp-image-wrapper&quot; style=&quot;position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 443px; &quot;&gt;
      &lt;a class=&quot;gatsby-resp-image-link&quot; href=&quot;/static/8f6f16ec73159425e2f0b42c41af0108/a120c/jsonpath-lists.png&quot; style=&quot;display: block&quot; target=&quot;_blank&quot; rel=&quot;noopener&quot;&gt;
    &lt;span class=&quot;gatsby-resp-image-background-image&quot; style=&quot;padding-bottom: 108.22784810126582%; position: relative; bottom: 0; left: 0; background-image: url(&apos;data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAWCAYAAADAQbwGAAAACXBIWXMAAA7DAAAOwwHHb6hkAAADMUlEQVR42q1V227bOhDM58QSuReSkm05SZ30JOj9ghYt0P7/d2xnl1LjU+A8nT4QpmhxODszS13lnI2IbBgGG8fxf48rFbVSq11f7wA62rAbAjzG7r8PGRL+z/4e9iWMDZCXYvq6WTmq1aamRUwKGwuZNjatbONwAeZzSpaPYnlPxq/U8gvMG8V/V/xQTX8cjPGCMtty22w6NIDiuQEcmwtn2w0XgJyMHqvJQ7HybW/8frK8SFR0RScwfFet3IJh0QBxVnUuJipWZrWGteRlXgKe1fikJh9nIzCkDTDdYPHTZLywCXuJOADAZdIAJJReAMCULYFtsMQvPxbj87r3ESWfIM0GmMFQjmzHZbJ2KKGjFgBVsXkPpmBY9/2QJtkyDsggEBp+rpYOhPkKyChVvs4mC36hVTckx5wZxgCUsZZSZydptOSMXcN7HAb9BHPXsDPEJL8tRjClTGz7k5tSAqj6cFYKVsMaq1XDfAM59hhnCbB82Eo+SeigMKfoGhnlXnbtGirWKsr2KPmmkUeje0h1h/fftzDlN8Pswv6E9QCuStagmSKPpbnDmINhxZofMukYbvfYFMsvAfgFLuPXGY/XDggNCSUXRMAZuhEeG4EpjFI97CQJjuc4TNztteQ0471/oJ+bspWczzj9e2coLFGeRJnYkCG+cMhQJjBCrCqNcQA9Qfd77PnQjDHPp43hubtc0ILOZjpU2y8NpbohxWYYNM09Lmkcnk25k4gOf0CX3F6Y4g/0Ga3mpqxsfBBKJsSmAUwrGOMyyOm5U1w/wl5+XY0eNHq7AyLQ9KTRy5sRdRYAwQQPM54nmEXI4dZ63jEBhr3yCmQiQitDAnX+isXFDen9G8GGjrLpB4fzH7dNRMV1f/LY6EXJL1zDyQhOCTYKHJ7AqlSs+3DWXuKqn18A4TK0p1vE6o0DopOOntHRAXEKrqByU9G3NTTz7tDSu4W193TFurOeZ2iGNU+H6+Yt6IAuXe8UNHiC7anmuBBcvzABTLWtl2zzjsnRKYQcjohTWjpIvtN+UbTcL1j/BFRtttvtnq/+6NvL5yFeHsbh39+e9MevfwKIPMj61z5SvwC7X7DqzRAgSAAAAABJRU5ErkJggg==&apos;); background-size: cover; display: block;&quot;&gt;&lt;/span&gt;
  &lt;img class=&quot;gatsby-resp-image-image&quot; alt=&quot;jsonpath lists&quot; title=&quot;&quot; src=&quot;/static/8f6f16ec73159425e2f0b42c41af0108/a120c/jsonpath-lists.png&quot; srcset=&quot;/static/8f6f16ec73159425e2f0b42c41af0108/c26ae/jsonpath-lists.png 158w,
/static/8f6f16ec73159425e2f0b42c41af0108/6bdcf/jsonpath-lists.png 315w,
/static/8f6f16ec73159425e2f0b42c41af0108/a120c/jsonpath-lists.png 443w&quot; sizes=&quot;(max-width: 443px) 100vw, 443px&quot; style=&quot;width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;&quot; loading=&quot;lazy&quot; decoding=&quot;async&quot;&gt;
  &lt;/a&gt;
    &lt;/span&gt;
&lt;/div&gt;
&lt;/br&gt;
&lt;h2&gt;1.4 K8S에서의 JSONPath&lt;/h2&gt;
&lt;p&gt;k8s 공식 문서에서 설명하는 JSONPath는 아래와 같다.&lt;/p&gt;
&lt;ol&gt;
&lt;li&gt;큰따옴표를 사용하여 JSONPath 표현식 내부의 텍스트를 인용한다.&lt;/li&gt;
&lt;li&gt;목록을 반복하려면 range, end 오퍼레이터를 사용한다.&lt;/li&gt;
&lt;li&gt;목록에서 뒤로 이동하려면 negative slice 인덱스를 사용한다. negative 인덱스는 목록을 &quot;순환(wrap around)&quot; 하지 않으며, -index + listLength &gt;= 0 인 한 유효하다.&lt;/li&gt;
&lt;li&gt;표현식은 항상 루트 오브젝트에서 시작하므로 $ 오퍼레이터는 선택 사항이다.&lt;/li&gt;
&lt;li&gt;결과 오브젝트는 String() 함수로 출력된다.&lt;/li&gt;
&lt;/ol&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;json&quot;&gt;&lt;pre class=&quot;language-json&quot;&gt;&lt;code class=&quot;language-json&quot;&gt;&lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;
  &lt;span class=&quot;token property&quot;&gt;&quot;kind&quot;&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;token string&quot;&gt;&quot;List&quot;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt;
  &lt;span class=&quot;token property&quot;&gt;&quot;items&quot;&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;:&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;[&lt;/span&gt;
    &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;
      &lt;span class=&quot;token property&quot;&gt;&quot;kind&quot;&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;:&lt;/span&gt;&lt;span class=&quot;token string&quot;&gt;&quot;None&quot;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt;
      &lt;span class=&quot;token property&quot;&gt;&quot;metadata&quot;&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;:&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;&lt;span class=&quot;token property&quot;&gt;&quot;name&quot;&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;:&lt;/span&gt;&lt;span class=&quot;token string&quot;&gt;&quot;127.0.0.1&quot;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt;
      &lt;span class=&quot;token property&quot;&gt;&quot;status&quot;&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;:&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;
        &lt;span class=&quot;token property&quot;&gt;&quot;capacity&quot;&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;:&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;&lt;span class=&quot;token property&quot;&gt;&quot;cpu&quot;&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;:&lt;/span&gt;&lt;span class=&quot;token string&quot;&gt;&quot;4&quot;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt;
        &lt;span class=&quot;token property&quot;&gt;&quot;addresses&quot;&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;:&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;[&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;&lt;span class=&quot;token property&quot;&gt;&quot;type&quot;&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;token string&quot;&gt;&quot;LegacyHostIP&quot;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;token property&quot;&gt;&quot;address&quot;&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;:&lt;/span&gt;&lt;span class=&quot;token string&quot;&gt;&quot;127.0.0.1&quot;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;]&lt;/span&gt;
      &lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;
    &lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt;
    &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;
      &lt;span class=&quot;token property&quot;&gt;&quot;kind&quot;&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;:&lt;/span&gt;&lt;span class=&quot;token string&quot;&gt;&quot;None&quot;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt;
      &lt;span class=&quot;token property&quot;&gt;&quot;metadata&quot;&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;:&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;&lt;span class=&quot;token property&quot;&gt;&quot;name&quot;&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;:&lt;/span&gt;&lt;span class=&quot;token string&quot;&gt;&quot;127.0.0.2&quot;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt;
      &lt;span class=&quot;token property&quot;&gt;&quot;status&quot;&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;:&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;
        &lt;span class=&quot;token property&quot;&gt;&quot;capacity&quot;&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;:&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;&lt;span class=&quot;token property&quot;&gt;&quot;cpu&quot;&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;:&lt;/span&gt;&lt;span class=&quot;token string&quot;&gt;&quot;8&quot;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt;
        &lt;span class=&quot;token property&quot;&gt;&quot;addresses&quot;&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;:&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;[&lt;/span&gt;
          &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;&lt;span class=&quot;token property&quot;&gt;&quot;type&quot;&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;token string&quot;&gt;&quot;LegacyHostIP&quot;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;token property&quot;&gt;&quot;address&quot;&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;:&lt;/span&gt;&lt;span class=&quot;token string&quot;&gt;&quot;127.0.0.2&quot;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt;
          &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;&lt;span class=&quot;token property&quot;&gt;&quot;type&quot;&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;token string&quot;&gt;&quot;another&quot;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;token property&quot;&gt;&quot;address&quot;&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;:&lt;/span&gt;&lt;span class=&quot;token string&quot;&gt;&quot;127.0.0.3&quot;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;
        &lt;span class=&quot;token punctuation&quot;&gt;]&lt;/span&gt;
      &lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;
    &lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;
  &lt;span class=&quot;token punctuation&quot;&gt;]&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt;
  &lt;span class=&quot;token property&quot;&gt;&quot;users&quot;&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;:&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;[&lt;/span&gt;
    &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;
      &lt;span class=&quot;token property&quot;&gt;&quot;name&quot;&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;token string&quot;&gt;&quot;myself&quot;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt;
      &lt;span class=&quot;token property&quot;&gt;&quot;user&quot;&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;
    &lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt;
    &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;
      &lt;span class=&quot;token property&quot;&gt;&quot;name&quot;&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;token string&quot;&gt;&quot;e2e&quot;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt;
      &lt;span class=&quot;token property&quot;&gt;&quot;user&quot;&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;&lt;span class=&quot;token property&quot;&gt;&quot;username&quot;&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;token string&quot;&gt;&quot;admin&quot;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;token property&quot;&gt;&quot;password&quot;&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;token string&quot;&gt;&quot;secret&quot;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;
    &lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;
  &lt;span class=&quot;token punctuation&quot;&gt;]&lt;/span&gt;
&lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;table&gt;
&lt;thead&gt;
&lt;tr&gt;
&lt;th&gt;기능&lt;/th&gt;
&lt;th&gt;설명&lt;/th&gt;
&lt;th&gt;예시&lt;/th&gt;
&lt;th&gt;결과&lt;/th&gt;
&lt;/tr&gt;
&lt;/thead&gt;
&lt;tbody&gt;
&lt;tr&gt;
&lt;td&gt;text&lt;/td&gt;
&lt;td&gt;일반 텍스트&lt;/td&gt;
&lt;td&gt;kind is {.kind}&lt;/td&gt;
&lt;td&gt;kind is List&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;@&lt;/td&gt;
&lt;td&gt;현재 오브젝트&lt;/td&gt;
&lt;td&gt;{@}&lt;/td&gt;
&lt;td&gt;입력과 동일&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;. or []&lt;/td&gt;
&lt;td&gt;자식 오퍼레이터&lt;/td&gt;
&lt;td&gt;{.kind}, {[&apos;kind&apos;]} or {[&apos;name.type&apos;]}&lt;/td&gt;
&lt;td&gt;List&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;..&lt;/td&gt;
&lt;td&gt;재귀 하향(recursive descent)&lt;/td&gt;
&lt;td&gt;{..name}&lt;/td&gt;
&lt;td&gt;127.0.0.1 127.0.0.2 myself e2e&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;*&lt;/td&gt;
&lt;td&gt;와일드 카드. 모든 오브젝트 가져오기&lt;/td&gt;
&lt;td&gt;{.items[*].metadata.name}&lt;/td&gt;
&lt;td&gt;[127.0.0.1 127.0.0.2]&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;[start:end:step]&lt;/td&gt;
&lt;td&gt;아래 첨자 오퍼레이터&lt;/td&gt;
&lt;td&gt;{.users[0].name}&lt;/td&gt;
&lt;td&gt;myself&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;[,]&lt;/td&gt;
&lt;td&gt;조합 오퍼레이터&lt;/td&gt;
&lt;td&gt;{.items[*][&apos;metadata.name&apos;, &apos;status.capacity&apos;]}&lt;/td&gt;
&lt;td&gt;127.0.0.1 127.0.0.2 map[cpu:4] map[cpu:8]&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;?()&lt;/td&gt;
&lt;td&gt;필터&lt;/td&gt;
&lt;td&gt;{.users[?(@.name==&quot;e2e&quot;)].user.password}&lt;/td&gt;
&lt;td&gt;secret&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;range, end&lt;/td&gt;
&lt;td&gt;반복 목록&lt;/td&gt;
&lt;td&gt;{range .items[*]}[{.metadata.name}, {.status.capacity}] {end}&lt;/td&gt;
&lt;td&gt;[127.0.0.1, map[cpu:4]] [127.0.0.2, map[cpu:8]]&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;&apos;&apos;&lt;/td&gt;
&lt;td&gt;해석된 문자열 인용&lt;/td&gt;
&lt;td&gt;{range .items[*]}{.metadata.name}{&apos;\t&apos;}{end}&lt;/td&gt;
&lt;td&gt;127.0.0.1 127.0.0.2&lt;/td&gt;
&lt;/tr&gt;
&lt;/tbody&gt;
&lt;/table&gt;
&lt;p&gt;kubectl 명령어에서는 JSONPATH를 지원하는데, 다음과 같은 방법으로 사용 가능하다.&lt;/p&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;text&quot;&gt;&lt;pre class=&quot;language-text&quot;&gt;&lt;code class=&quot;language-text&quot;&gt;- JSONPATH를 사용할 kubectl 명령어를 식별한다.
- json output 결과의 위치를 확인한다.
- JSONPATH를 설정한다.
- `kubectl get {object} -o=jsonpath=`에 생성한 JSONPATH를 붙여넣는다.&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;/br&gt;
&lt;ul&gt;
&lt;li&gt;각 결과를 별도 row로 표현하려면 &lt;code class=&quot;language-text&quot;&gt;{\n}&lt;/code&gt;을 사용한다.&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;&lt;/br&gt; &lt;code class=&quot;language-text&quot;&gt;kubectl get nodes -o=jsonpath=&apos;{.items[*].metadata.name}{&quot;\n&quot;}{.items[*].status.capacity.cpu}&apos;&lt;/code&gt;&lt;/p&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;sh&quot;&gt;&lt;pre class=&quot;language-sh&quot;&gt;&lt;code class=&quot;language-sh&quot;&gt;master  node01
&lt;span class=&quot;token number&quot;&gt;4&lt;/span&gt;       &lt;span class=&quot;token number&quot;&gt;4&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;/br&gt;
&lt;ul&gt;
&lt;li&gt;위와 동일한 결과를 &lt;code class=&quot;language-text&quot;&gt;range&lt;/code&gt;를 통해서도 출력 가능하다.&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;&lt;/br&gt; &lt;code class=&quot;language-text&quot;&gt;kubectl get nodes -o=jsonpath=&apos;{range .items[*]}{.metadata.name}{&quot;\t&quot;}{.status.capacity.cpu}{&quot;\n&quot;}{end}&apos;&lt;/code&gt;&lt;/p&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;sh&quot;&gt;&lt;pre class=&quot;language-sh&quot;&gt;&lt;code class=&quot;language-sh&quot;&gt;master  &lt;span class=&quot;token number&quot;&gt;4&lt;/span&gt;
node01  &lt;span class=&quot;token number&quot;&gt;4&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;ul&gt;
&lt;li&gt;&lt;code class=&quot;language-text&quot;&gt;-o=jsonpath&lt;/code&gt; 옵션 말고, &lt;code class=&quot;language-text&quot;&gt;-o=custom-columns&lt;/code&gt; 옵션을 통해서도 사용 가능하다.&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;&lt;/br&gt; &lt;code class=&quot;language-text&quot;&gt;kubectl get nodes -o=custom-columns=NODE:.metadata.name,CPU:.status.capacity.cpu&lt;/code&gt;&lt;/p&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;sh&quot;&gt;&lt;pre class=&quot;language-sh&quot;&gt;&lt;code class=&quot;language-sh&quot;&gt;NODE    CPU
master  &lt;span class=&quot;token number&quot;&gt;4&lt;/span&gt;
node01  &lt;span class=&quot;token number&quot;&gt;4&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;ul&gt;
&lt;li&gt;&lt;code class=&quot;language-text&quot;&gt;--sort-by=&lt;/code&gt; 옵션을 통해서는 특정 필드로 정렬 가능하다.&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;&lt;/br&gt; &lt;code class=&quot;language-text&quot;&gt;kubectl get nodes -o=custom-columns=NODE:.metadata.name,CPU:.status.capacity.cpu --sort-by=.status.capacity.cpu&lt;/code&gt;&lt;/p&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;sh&quot;&gt;&lt;pre class=&quot;language-sh&quot;&gt;&lt;code class=&quot;language-sh&quot;&gt;NODE    CPU
master  &lt;span class=&quot;token number&quot;&gt;2&lt;/span&gt;
node01  &lt;span class=&quot;token number&quot;&gt;3&lt;/span&gt;
node02  &lt;span class=&quot;token number&quot;&gt;4&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;</content:encoded></item><item><title><![CDATA[[Database] ACID 원칙]]></title><description><![CDATA[트랜잭션? ACID 원칙? Database에는 ACID…]]></description><link>https://github.com/SiverPineValley/SiverPineValley.github.io/db/acid/</link><guid isPermaLink="false">https://github.com/SiverPineValley/SiverPineValley.github.io/db/acid/</guid><pubDate>Mon, 17 Oct 2022 18:00:00 GMT</pubDate><content:encoded>&lt;h2&gt;트랜잭션? ACID 원칙?&lt;/h2&gt;
&lt;p&gt;Database에는 ACID 원칙이란 것이 있다. 데이터베이스 트랜잭션이 안전하게 수행되는 것을 보장하기 위한 원칙을 말한다. 트랜잭션이란 데이터베이스에서 작업의 단위를 말하며 한 트랜잭션 안에는 여러 쿼리가 동작할 수 있다. 위키에 등록된 데이터베이스 트랜잭션의 정의에는 &lt;code class=&quot;language-text&quot;&gt;데이터베이스 트랜잭션(Database Transaction)은 데이터베이스 관리 시스템 또는 유사한 시스템에서 상호작용의 단위이다. 여기서 유사한 시스템이란 트랜잭션이 성공과 실패가 분명하고 상호 독립적이며, 일관되고 믿을 수 있는 시스템을 의미한다.&lt;/code&gt; 라고 되어 있다. 트랜잭션에는 이러한 성질히 안전하게 수행되기 위해 앞서 말한 ACID 원칙을 고려하여 개발되어 있다. 각각의 의미는 다음과 같다.&lt;/p&gt;
&lt;h2&gt;ACID 원칙의 종류&lt;/h2&gt;
&lt;ul&gt;
&lt;li&gt;원자성(Atomicity)은 트랜잭션과 관련된 작업들이 부분적으로 실행되다가 중단되지 않는 것을 보장하는 능력이다.&lt;/li&gt;
&lt;li&gt;일관성(Consistency)은 트랜잭션이 실행을 성공적으로 완료하면 언제나 일관성 있는 데이터베이스 상태로 유지하는 것을 의미한다.&lt;/li&gt;
&lt;li&gt;독립성(Isolation)은 트랜잭션을 수행 시 다른 트랜잭션의 연산 작업이 끼어들지 못하도록 보장하는 것을 의미한다. 이것은 트랜잭션 밖에 있는 어떤 연산도 중간 단계의 데이터를 볼 수 없음을 의미한다.&lt;/li&gt;
&lt;li&gt;지속성(Durability)은 성공적으로 수행된 트랜잭션은 영원히 반영되어야 함을 의미한다. 시스템 문제, DB 일관성 체크 등을 하더라도 유지되어야 함을 의미한다. 전형적으로 모든 트랜잭션은 로그로 남고 시스템 장애 발생 전 상태로 되돌릴 수 있다. 트랜잭션은 로그에 모든 것이 저장된 후에만 commit 상태로 간주될 수 있다.&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;좀 더 알기 쉽게 풀어쓰지만, 원자성이란 한 트랜잭션은 내부 동작이 모두 완료되어야 종료된다는 것이다. &lt;code class=&quot;language-text&quot;&gt;BEGIN&lt;/code&gt;으로 시작해서, &lt;code class=&quot;language-text&quot;&gt;COMMIT&lt;/code&gt; 혹은 &lt;code class=&quot;language-text&quot;&gt;ROLLBACK&lt;/code&gt; 사이에 있는 모든 쿼리들은 하나의 트랜잭션에 묶여 하나의 동작 단위로 작동한다. 중간에 동작을 완료하지 못한 쿼리가 있다면 이전의 동작은 모두 취소된다. 일관성이란 트랜잭션의 이전과 이후 데이터베이스의 상태는 이전과 같이 유효해야 한다는 것이다. 즉, 제약(Constraint)이 위반되는 쿼리는 용납하지 않는다는 것이다. 독립성(혹은 고립성)이란 각 트랜잭션이 상호간에 영향을 주지 말아야 한다는 점이다. 마지막으로 지속성이란, 성공한 트랜잭션은 영원히 기록이 남아 있어야 한다는 점이다.&lt;/p&gt;
&lt;p&gt;이러한 성질을 유지하기 위해 데이터베이스에는 Lock이 구현되어 있다. 동시성이 요구되는 소프트웨어를 개발하다 보면 서로 영향을 줄 수 있는 데이터 (Foriegn Key, Primary Key)에 동시에 접근하여 읽고 쓰는 작업을 수행하는 경우가 발생한다. 이러한 상황에서 경우에 따라서는 ACID 원칙이 위배되는 상황이 발생할 수 있는데, Lock을 통해 각 트랜잭션 간의 영향을 줄 수 있는 상황을 방지할 수 있다. 물론, Lock이 발생하면 소프트웨어가 먹통이 되므로 개발자는 이러한 상황이 발생하지 않도록 개발해야 한다.&lt;/p&gt;
&lt;p&gt;하지만 실제 데이터베이스들은 ACID 원칙이 종종 지켜지지 않는다. ACID 원칙을 너무 확고하게 지키게 되면 동시성이 매우 떨어기지 때문이다. 동시성을 확보하기 위해 데이터베이스는 독립성의 수준을 유연하게 조절한다. 그로 인해 Read Phenomena라고 하는 하나의 데이터에 읽기/수정이 동시에 발생할때 나타나는 현상이 발생한다. 현재 많이 사용되고 있는 데이터베이스들은 각각 독립성 수준에 차이가 있으나, 이러한 현상을 해결하기 위한 방법을 가지고 있다.&lt;/p&gt;
&lt;h2&gt;Read Phenomena&lt;/h2&gt;
&lt;p&gt;Read Phenomena는 독립성의 수준에 따라 트랜잭션간의 읽기/쓰기에 영향을 받아 발생하는 현상을 의미한다. 크게 4가지가 존재하며, 데이터베이스 엔진마다 적용되는 수준은 조금씩 다르다.&lt;/p&gt;
&lt;h3&gt;Dirty Read&lt;/h3&gt;
&lt;p&gt;Dirty Read란 한 트랜잭션은 다른 트랜잭션에 아직 커밋하지 않은 자료도 읽을 수 있다. 동시에 실행중인 두 트랜잭션에서 한 트랜잭션이 데이터를 수정한 뒤, 아직 커밋을 찍지 않은 상황에서 다른 트랜잭션에서 그 데이터를 읽을 때 발생한다. 이 경우 한 트랜잭션은 다른 트랜잭션이 커밋했는지, 롤백했는지를 알 수 없기 때문에 부정확한 데이터를 가지고 쿼리를 수행하게 된다.&lt;/p&gt;
&lt;div align=&quot;left&quot;&gt;
  &lt;img src=&quot;./images/dirty_read.png&quot; width=&quot;450px&quot; /&gt;
&lt;/div&gt;
&lt;h3&gt;Non-Repeatable Read&lt;/h3&gt;
&lt;p&gt;Non-Repeatable Read란 한 트랜잭션은 다른 트랜잭션에서 커밋한 자료를 읽을 수 있다. 한 트랜잭션에서 한 row를 두 번 읽을 때, 그 사이 다른 트랜잭션에 의애 수정되고 커밋되어 다른 값을 보게 되는 현상을 의미한다.&lt;/p&gt;
&lt;h3&gt;Phantom Read&lt;/h3&gt;
&lt;p&gt;Phantom Read란 위와 같은 상황에서 다른 트랜잭션에 의한 커밋된 자료가 있다 하더라도, 항상 자신의 트랜잭션에서 조회 했던 그 자료값 그대로 보여준다. 한 트랜잭션에서 특정 조건에 부합하는 row들을 찾을 때, 그 사이 다른 트랜잭션에 의해 수정되고 커밋되어 다른 row들의 결과를 보게 되는 현상이다.&lt;/p&gt;
&lt;h3&gt;Serialization Anomaly&lt;/h3&gt;
&lt;p&gt;Serialization Anomaly란 두 트랜잭션이 순서에 상관 없이 순차적으로 동작할 때 일관성이 없는 현상이다.&lt;/p&gt;
&lt;h2&gt;격리수준 (Isolation Level)&lt;/h2&gt;
&lt;p&gt;이 네 가지 현상들은 트랜잭션의 격리 수준에 따라 다르게 발생한다. 각 격리수준은 Consistent Read(일관성 있는 읽기)를 어느 정도 보장하느냐에 따라 달라진다. 격리수준은 ANSI(American National Standars Institue)에서 정의한 내용으로 각각 다음과 같다.&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;Read Uncommited: 커밋되지 않는 트랜잭션에 의해 쓰여진 데이터를 읽을 수 있다. 공유 Lock 없음.&lt;/li&gt;
&lt;li&gt;Read Commited: 커밋된 트랜잭션에 의해 쓰여진 데이터만 읽을 수 있다. 공유 Lock 설정 후 완료 시 해제.&lt;/li&gt;
&lt;li&gt;Repeatable Read: 같은 읽기 쿼리는 항상 같은 결과를 보여준다. (다른 트랜잭션의 Update 금지) 공유 Lock 설정 후 트랜잭션 끝까지 유지.&lt;/li&gt;
&lt;li&gt;Serializable: Reapetable Read와 거의 동일하나 SELECT문이 모두 SELECT ... FOR SHARE로 변경된다. (다른 트랜잭션의 Insert, Delete, Update 금지) 공유 Lock 설정 후 트랜잭션 끝까지 유지.&lt;/li&gt;
&lt;/ul&gt;
&lt;table&gt;
&lt;thead&gt;
&lt;tr&gt;
&lt;th&gt;격리수준&lt;/th&gt;
&lt;th&gt;Dirty Read&lt;/th&gt;
&lt;th&gt;Non-Repeatable Read&lt;/th&gt;
&lt;th&gt;Phantom Read&lt;/th&gt;
&lt;th&gt;Serialization Anomaly&lt;/th&gt;
&lt;/tr&gt;
&lt;/thead&gt;
&lt;tbody&gt;
&lt;tr&gt;
&lt;td&gt;Read Uncommited&lt;/td&gt;
&lt;td&gt;가능. PG에서는 불가능&lt;/td&gt;
&lt;td&gt;가능&lt;/td&gt;
&lt;td&gt;가능&lt;/td&gt;
&lt;td&gt;가능&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;Read Commited&lt;/td&gt;
&lt;td&gt;불가능&lt;/td&gt;
&lt;td&gt;가능&lt;/td&gt;
&lt;td&gt;가능&lt;/td&gt;
&lt;td&gt;가능&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;Repeatable Read&lt;/td&gt;
&lt;td&gt;불가능&lt;/td&gt;
&lt;td&gt;불가능&lt;/td&gt;
&lt;td&gt;불가능&lt;/td&gt;
&lt;td&gt;가능&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;Serializable&lt;/td&gt;
&lt;td&gt;불가능&lt;/td&gt;
&lt;td&gt;불가능&lt;/td&gt;
&lt;td&gt;불가능&lt;/td&gt;
&lt;td&gt;불가능&lt;/td&gt;
&lt;/tr&gt;
&lt;/tbody&gt;
&lt;/table&gt;
&lt;h2&gt;출처&lt;/h2&gt;
&lt;p&gt;&lt;a href=&quot;http://blog.skby.net/dirty-read/&quot;&gt;http://blog.skby.net/dirty-read/&lt;/a&gt;&lt;/br&gt;
&lt;a href=&quot;https://dev.to/techschoolguru/understand-isolation-levels-read-phenomena-in-mysql-postgres-c2e&quot;&gt;https://dev.to/techschoolguru/understand-isolation-levels-read-phenomena-in-mysql-postgres-c2e&lt;/a&gt;&lt;/br&gt;
&lt;a href=&quot;https://suhwan.dev/2019/06/09/transaction-isolation-level-and-lock/&quot;&gt;https://suhwan.dev/2019/06/09/transaction-isolation-level-and-lock/&lt;/a&gt;&lt;/p&gt;</content:encoded></item><item><title><![CDATA[[쿠버네티스 완벽 가이드] 15. 컨피그 & 스토리지 API 카테고리 (1) - 환경변수, 시크릿, 컨피그맵]]></title><description><![CDATA[7.1 컨피그 & 스토리지 API 카테고리 컨피그 & 스토리지 API 카테고리는 컨테이너에 대한 설정 파일, 패스워드 같은 기밀 정보를 추가하거나 영구 볼륨을 제공하기 위한 리소스이다. 시크릿 컨피그맵 영구 볼륨 클레임 7.…]]></description><link>https://github.com/SiverPineValley/SiverPineValley.github.io/kubernetes/kubernetes_7_1/</link><guid isPermaLink="false">https://github.com/SiverPineValley/SiverPineValley.github.io/kubernetes/kubernetes_7_1/</guid><pubDate>Sun, 16 Oct 2022 20:00:00 GMT</pubDate><content:encoded>&lt;h1&gt;7.1 컨피그 &amp;#x26; 스토리지 API 카테고리&lt;/h1&gt;
&lt;p&gt;컨피그 &amp;#x26; 스토리지 API 카테고리는 컨테이너에 대한 설정 파일, 패스워드 같은 기밀 정보를 추가하거나 영구 볼륨을 제공하기 위한 리소스이다.&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;시크릿&lt;/li&gt;
&lt;li&gt;컨피그맵&lt;/li&gt;
&lt;li&gt;영구 볼륨 클레임&lt;/li&gt;
&lt;/ul&gt;
&lt;h1&gt;7.2 환경 변수 사용&lt;/h1&gt;
&lt;p&gt;쿠버네티스에서 개별 컨테이너의 설정 내용은 환경 변수나 파일이 저장되어 있는 영역을 마운트하여 전달하는 것이 일반적이다. 환경 변수를 전달할 때는 파드 템플릿에 &lt;code class=&quot;language-text&quot;&gt;env&lt;/code&gt; 또는 &lt;code class=&quot;language-text&quot;&gt;envForm&lt;/code&gt;을 사용한다. 크게 아래 다섯가지 정보를 환경 변수에 저장한다.&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;정적 설정&lt;/li&gt;
&lt;li&gt;파드 정보&lt;/li&gt;
&lt;li&gt;컨테이너 정보&lt;/li&gt;
&lt;li&gt;시크릿 리소스 기밀 정보&lt;/li&gt;
&lt;li&gt;컨피그맵 리소스 설정값&lt;/li&gt;
&lt;/ul&gt;
&lt;h2&gt;7.2.1 정적 설정&lt;/h2&gt;
&lt;p&gt;정적 설정에서는 그 이름 그대로 &lt;code class=&quot;language-text&quot;&gt;spec.containers[].env&lt;/code&gt;에 정적인 값을 설정한다. 컨테이너 내부에 보면 환경 변수가 설정된 것을 확인할 수 있다.&lt;/p&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;yaml&quot;&gt;&lt;pre class=&quot;language-yaml&quot;&gt;&lt;code class=&quot;language-yaml&quot;&gt;&lt;span class=&quot;token key atrule&quot;&gt;apiVersion&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt; v1
&lt;span class=&quot;token key atrule&quot;&gt;kind&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt; Pod
&lt;span class=&quot;token key atrule&quot;&gt;metadata&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt;
  &lt;span class=&quot;token key atrule&quot;&gt;name&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt; sample&lt;span class=&quot;token punctuation&quot;&gt;-&lt;/span&gt;env
  &lt;span class=&quot;token key atrule&quot;&gt;labels&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt;
    &lt;span class=&quot;token key atrule&quot;&gt;app&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt; sample&lt;span class=&quot;token punctuation&quot;&gt;-&lt;/span&gt;app
&lt;span class=&quot;token key atrule&quot;&gt;spec&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt;
  &lt;span class=&quot;token key atrule&quot;&gt;containers&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt;
    &lt;span class=&quot;token punctuation&quot;&gt;-&lt;/span&gt; &lt;span class=&quot;token key atrule&quot;&gt;name&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt; nginx&lt;span class=&quot;token punctuation&quot;&gt;-&lt;/span&gt;container
      &lt;span class=&quot;token key atrule&quot;&gt;image&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt; nginx&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt;&lt;span class=&quot;token number&quot;&gt;1.16&lt;/span&gt;
      &lt;span class=&quot;token key atrule&quot;&gt;env&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt;
        &lt;span class=&quot;token punctuation&quot;&gt;-&lt;/span&gt; &lt;span class=&quot;token key atrule&quot;&gt;name&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt; MAX_CONNECTION
          &lt;span class=&quot;token key atrule&quot;&gt;value&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;token string&quot;&gt;&quot;100&quot;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;sh&quot;&gt;&lt;pre class=&quot;language-sh&quot;&gt;&lt;code class=&quot;language-sh&quot;&gt;&lt;span class=&quot;token comment&quot;&gt;# sample-env 파드의 환경 변수 확인&lt;/span&gt;
$ kubectl &lt;span class=&quot;token builtin class-name&quot;&gt;exec&lt;/span&gt; &lt;span class=&quot;token parameter variable&quot;&gt;-it&lt;/span&gt; sample-env -- &lt;span class=&quot;token function&quot;&gt;env&lt;/span&gt; &lt;span class=&quot;token operator&quot;&gt;|&lt;/span&gt; &lt;span class=&quot;token function&quot;&gt;grep&lt;/span&gt; MAX_CONNECTION
&lt;span class=&quot;token assign-left variable&quot;&gt;MAX_CONNECTION&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;token number&quot;&gt;100&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;h2&gt;7.2.2 파드 정보&lt;/h2&gt;
&lt;p&gt;어떤 노드에서 파드가 기동하고 있는지와 파드 자신의 IP 주소, 기동 시간 등 파드에 관한 정보는 &lt;code class=&quot;language-text&quot;&gt;spec.containers[].env.valueFrom.fieldRef&lt;/code&gt;를 사용하면 참조할 수 있다. 이번에는 기동 중인 쿠버네티스 노드 이름을 &lt;code class=&quot;language-text&quot;&gt;K8S_NODE&lt;/code&gt; 환경 변수로 등록해보자. 위에서 출력한 YAML 형식에 따라 키를 지정하기 위해 &lt;code class=&quot;language-text&quot;&gt;spec.nodeName&lt;/code&gt;을 지정한다.&lt;/p&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;yaml&quot;&gt;&lt;pre class=&quot;language-yaml&quot;&gt;&lt;code class=&quot;language-yaml&quot;&gt;&lt;span class=&quot;token key atrule&quot;&gt;apiVersion&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt; v1
&lt;span class=&quot;token key atrule&quot;&gt;kind&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt; Pod
&lt;span class=&quot;token key atrule&quot;&gt;metadata&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt;
  &lt;span class=&quot;token key atrule&quot;&gt;name&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt; sample&lt;span class=&quot;token punctuation&quot;&gt;-&lt;/span&gt;env&lt;span class=&quot;token punctuation&quot;&gt;-&lt;/span&gt;pod
  &lt;span class=&quot;token key atrule&quot;&gt;labels&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt;
    &lt;span class=&quot;token key atrule&quot;&gt;app&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt; sample&lt;span class=&quot;token punctuation&quot;&gt;-&lt;/span&gt;app
&lt;span class=&quot;token key atrule&quot;&gt;spec&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt;
  &lt;span class=&quot;token key atrule&quot;&gt;containers&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt;
    &lt;span class=&quot;token punctuation&quot;&gt;-&lt;/span&gt; &lt;span class=&quot;token key atrule&quot;&gt;name&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt; nginx&lt;span class=&quot;token punctuation&quot;&gt;-&lt;/span&gt;container
      &lt;span class=&quot;token key atrule&quot;&gt;image&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt; nginx&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt;&lt;span class=&quot;token number&quot;&gt;1.16&lt;/span&gt;
      &lt;span class=&quot;token key atrule&quot;&gt;env&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt;
        &lt;span class=&quot;token punctuation&quot;&gt;-&lt;/span&gt; &lt;span class=&quot;token key atrule&quot;&gt;name&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt; K8S_NODE
          &lt;span class=&quot;token key atrule&quot;&gt;valueFrom&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt;
            &lt;span class=&quot;token key atrule&quot;&gt;fieldRef&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt;
              &lt;span class=&quot;token key atrule&quot;&gt;fieldPath&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt; spec.nodeName&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;sh&quot;&gt;&lt;pre class=&quot;language-sh&quot;&gt;&lt;code class=&quot;language-sh&quot;&gt;&lt;span class=&quot;token comment&quot;&gt;# 파드가 기동 중인 노드 확인&lt;/span&gt;
$ kubectl get pods &lt;span class=&quot;token parameter variable&quot;&gt;-o&lt;/span&gt; wide sample-env-pod
NAME             READY   STATUS    RESTARTS   AGE   IP           NODE                   NOMINATED NODE   READINESS GATES
sample-env-pod   &lt;span class=&quot;token number&quot;&gt;1&lt;/span&gt;/1     Running   &lt;span class=&quot;token number&quot;&gt;0&lt;/span&gt;          46s   &lt;span class=&quot;token number&quot;&gt;10.244&lt;/span&gt;.3.4   kind-clusetr-worker2   &lt;span class=&quot;token operator&quot;&gt;&amp;lt;&lt;/span&gt;none&lt;span class=&quot;token operator&quot;&gt;&gt;&lt;/span&gt;           &lt;span class=&quot;token operator&quot;&gt;&amp;lt;&lt;/span&gt;none&lt;span class=&quot;token operator&quot;&gt;&gt;&lt;/span&gt;

&lt;span class=&quot;token comment&quot;&gt;# sample-env-pod 환경 변수 &apos;K8S_NODE&apos; 확인&lt;/span&gt;
$ kubectl &lt;span class=&quot;token builtin class-name&quot;&gt;exec&lt;/span&gt; &lt;span class=&quot;token parameter variable&quot;&gt;-it&lt;/span&gt; sample-env-pod -- &lt;span class=&quot;token function&quot;&gt;env&lt;/span&gt; &lt;span class=&quot;token operator&quot;&gt;|&lt;/span&gt; &lt;span class=&quot;token function&quot;&gt;grep&lt;/span&gt; K8S_NODE
&lt;span class=&quot;token assign-left variable&quot;&gt;K8S_NODE&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt;kind-clusetr-worker2&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;h2&gt;7.2.3 컨테이너 정보&lt;/h2&gt;
&lt;p&gt;컨테이너 리소스 정보는 &lt;code class=&quot;language-text&quot;&gt;spec.containers[].env.valueFrom.resourceFieldRef&lt;/code&gt;를 통해 확인할 수 있다. 파드에는 여러 컨테이너 정보가 포함되어 있으므로, 각 컨테이너 정보에 대해서는 &lt;code class=&quot;language-text&quot;&gt;fieldRef&lt;/code&gt;에서 확인할 수 없는 점에 주의해야 한다.&lt;/p&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;yaml&quot;&gt;&lt;pre class=&quot;language-yaml&quot;&gt;&lt;code class=&quot;language-yaml&quot;&gt;&lt;span class=&quot;token key atrule&quot;&gt;apiVersion&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt; v1
&lt;span class=&quot;token key atrule&quot;&gt;kind&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt; Pod
&lt;span class=&quot;token key atrule&quot;&gt;metadata&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt;
  &lt;span class=&quot;token key atrule&quot;&gt;name&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt; sample&lt;span class=&quot;token punctuation&quot;&gt;-&lt;/span&gt;env&lt;span class=&quot;token punctuation&quot;&gt;-&lt;/span&gt;container
  &lt;span class=&quot;token key atrule&quot;&gt;labels&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt;
    &lt;span class=&quot;token key atrule&quot;&gt;app&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt; sample&lt;span class=&quot;token punctuation&quot;&gt;-&lt;/span&gt;app
&lt;span class=&quot;token key atrule&quot;&gt;spec&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt;
  &lt;span class=&quot;token key atrule&quot;&gt;containers&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt;
    &lt;span class=&quot;token punctuation&quot;&gt;-&lt;/span&gt; &lt;span class=&quot;token key atrule&quot;&gt;name&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt; nginx&lt;span class=&quot;token punctuation&quot;&gt;-&lt;/span&gt;container
      &lt;span class=&quot;token key atrule&quot;&gt;image&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt; nginx&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt;&lt;span class=&quot;token number&quot;&gt;1.16&lt;/span&gt;
      &lt;span class=&quot;token key atrule&quot;&gt;env&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt;
        &lt;span class=&quot;token punctuation&quot;&gt;-&lt;/span&gt; &lt;span class=&quot;token key atrule&quot;&gt;name&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt; CPU_REQUESTS
          &lt;span class=&quot;token key atrule&quot;&gt;valueFrom&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt;
            &lt;span class=&quot;token key atrule&quot;&gt;resourceFieldRef&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt;
              &lt;span class=&quot;token key atrule&quot;&gt;containerName&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt; nginx&lt;span class=&quot;token punctuation&quot;&gt;-&lt;/span&gt;container
              &lt;span class=&quot;token key atrule&quot;&gt;resource&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt; requests.cpu
        &lt;span class=&quot;token punctuation&quot;&gt;-&lt;/span&gt; &lt;span class=&quot;token key atrule&quot;&gt;name&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt; CPU_LIMITS
          &lt;span class=&quot;token key atrule&quot;&gt;valueFrom&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt;
            &lt;span class=&quot;token key atrule&quot;&gt;resourceFieldRef&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt;
              &lt;span class=&quot;token key atrule&quot;&gt;containerName&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt; nginx&lt;span class=&quot;token punctuation&quot;&gt;-&lt;/span&gt;container
              &lt;span class=&quot;token key atrule&quot;&gt;resource&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt; limits.cpu&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;sh&quot;&gt;&lt;pre class=&quot;language-sh&quot;&gt;&lt;code class=&quot;language-sh&quot;&gt;&lt;span class=&quot;token comment&quot;&gt;# sample-env-container 파드에 지정한 CPU_REQUESTS와 CPU_LIMITS 환경 변수 확인&lt;/span&gt;
$ kubectl &lt;span class=&quot;token builtin class-name&quot;&gt;exec&lt;/span&gt; &lt;span class=&quot;token parameter variable&quot;&gt;-it&lt;/span&gt; sample-env-container -- &lt;span class=&quot;token function&quot;&gt;env&lt;/span&gt; &lt;span class=&quot;token operator&quot;&gt;|&lt;/span&gt; &lt;span class=&quot;token function&quot;&gt;grep&lt;/span&gt; CPU
&lt;span class=&quot;token assign-left variable&quot;&gt;CPU_REQUESTS&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;token number&quot;&gt;0&lt;/span&gt;
&lt;span class=&quot;token assign-left variable&quot;&gt;CPU_LIMITS&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;token number&quot;&gt;4&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;h2&gt;7.2.4 환경 변수 이용 시 주의 사항&lt;/h2&gt;
&lt;p&gt;쿠버네티스로 전달되는 환경 변수에는 주의 사항이 있다. 예를 들어, 아래 파드 매니페스트를 보면, 환경 변수가 설정되고 컨테이너가 기동된 후 &apos;100&apos;과 &apos;호스트명&apos;이 출력될 것 처럼 보인다. 그러나, 이 파드를 기동하면 [${TESTENV}, ${HOSTNAME}]이라는 문자열이 그대로 출력된다.&lt;/p&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;yaml&quot;&gt;&lt;pre class=&quot;language-yaml&quot;&gt;&lt;code class=&quot;language-yaml&quot;&gt;&lt;span class=&quot;token key atrule&quot;&gt;apiVersion&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt; v1
&lt;span class=&quot;token key atrule&quot;&gt;kind&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt; Pod
&lt;span class=&quot;token key atrule&quot;&gt;metadata&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt;
  &lt;span class=&quot;token key atrule&quot;&gt;name&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt; sample&lt;span class=&quot;token punctuation&quot;&gt;-&lt;/span&gt;env&lt;span class=&quot;token punctuation&quot;&gt;-&lt;/span&gt;fail
  &lt;span class=&quot;token key atrule&quot;&gt;labels&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt;
    &lt;span class=&quot;token key atrule&quot;&gt;app&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt; sample&lt;span class=&quot;token punctuation&quot;&gt;-&lt;/span&gt;app
&lt;span class=&quot;token key atrule&quot;&gt;spec&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt;
  &lt;span class=&quot;token key atrule&quot;&gt;containers&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt;
    &lt;span class=&quot;token punctuation&quot;&gt;-&lt;/span&gt; &lt;span class=&quot;token key atrule&quot;&gt;name&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt; nginx&lt;span class=&quot;token punctuation&quot;&gt;-&lt;/span&gt;container
      &lt;span class=&quot;token key atrule&quot;&gt;image&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt; nginx&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt;&lt;span class=&quot;token number&quot;&gt;1.16&lt;/span&gt;
      &lt;span class=&quot;token key atrule&quot;&gt;command&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;[&lt;/span&gt;&lt;span class=&quot;token string&quot;&gt;&quot;echo&quot;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;]&lt;/span&gt;
      &lt;span class=&quot;token key atrule&quot;&gt;args&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;[&lt;/span&gt;&lt;span class=&quot;token string&quot;&gt;&quot;${TESTENV}&quot;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;token string&quot;&gt;&quot;${HOSTNAME}&quot;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;]&lt;/span&gt;
      &lt;span class=&quot;token key atrule&quot;&gt;env&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt;
        &lt;span class=&quot;token punctuation&quot;&gt;-&lt;/span&gt; &lt;span class=&quot;token key atrule&quot;&gt;name&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt; TESTENV
          &lt;span class=&quot;token key atrule&quot;&gt;value&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;token string&quot;&gt;&quot;100&quot;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;쿠버네티스에서 &lt;code class=&quot;language-text&quot;&gt;command&lt;/code&gt;나 &lt;code class=&quot;language-text&quot;&gt;args&lt;/code&gt;로 실행할 명령어를 지정할 때는 일반적인 방식으로 환경 변수를 사용할 수 없다. 파드 매니페스트 내부에 정의된 환경 변수에만 &lt;code class=&quot;language-text&quot;&gt;$(TESTENV)&lt;/code&gt;라는 형태로 불러올 수 있다. 이에 따라 매니페스트 파일을 수정하면 다음과 같다.&lt;/p&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;yaml&quot;&gt;&lt;pre class=&quot;language-yaml&quot;&gt;&lt;code class=&quot;language-yaml&quot;&gt;&lt;span class=&quot;token key atrule&quot;&gt;apiVersion&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt; v1
&lt;span class=&quot;token key atrule&quot;&gt;kind&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt; Pod
&lt;span class=&quot;token key atrule&quot;&gt;metadata&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt;
  &lt;span class=&quot;token key atrule&quot;&gt;name&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt; sample&lt;span class=&quot;token punctuation&quot;&gt;-&lt;/span&gt;env&lt;span class=&quot;token punctuation&quot;&gt;-&lt;/span&gt;fail2
  &lt;span class=&quot;token key atrule&quot;&gt;labels&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt;
    &lt;span class=&quot;token key atrule&quot;&gt;app&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt; sample&lt;span class=&quot;token punctuation&quot;&gt;-&lt;/span&gt;app
&lt;span class=&quot;token key atrule&quot;&gt;spec&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt;
  &lt;span class=&quot;token key atrule&quot;&gt;containers&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt;
    &lt;span class=&quot;token punctuation&quot;&gt;-&lt;/span&gt; &lt;span class=&quot;token key atrule&quot;&gt;name&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt; nginx&lt;span class=&quot;token punctuation&quot;&gt;-&lt;/span&gt;container
      &lt;span class=&quot;token key atrule&quot;&gt;image&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt; nginx&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt;&lt;span class=&quot;token number&quot;&gt;1.16&lt;/span&gt;
      &lt;span class=&quot;token key atrule&quot;&gt;command&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;[&lt;/span&gt;&lt;span class=&quot;token string&quot;&gt;&quot;echo&quot;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;]&lt;/span&gt;
      &lt;span class=&quot;token key atrule&quot;&gt;args&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;[&lt;/span&gt;&lt;span class=&quot;token string&quot;&gt;&quot;$(TESTENV)&quot;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;token string&quot;&gt;&quot;$(HOSTNAME)&quot;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;]&lt;/span&gt;
      &lt;span class=&quot;token key atrule&quot;&gt;env&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt;
        &lt;span class=&quot;token punctuation&quot;&gt;-&lt;/span&gt; &lt;span class=&quot;token key atrule&quot;&gt;name&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt; TESTENV
          &lt;span class=&quot;token key atrule&quot;&gt;value&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;token string&quot;&gt;&quot;100&quot;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;sh&quot;&gt;&lt;pre class=&quot;language-sh&quot;&gt;&lt;code class=&quot;language-sh&quot;&gt;&lt;span class=&quot;token comment&quot;&gt;# 일부 환경 변수가 설정되지 않음&lt;/span&gt;
$ kubectl logs sample-env-fail2
&lt;span class=&quot;token number&quot;&gt;100&lt;/span&gt; &lt;span class=&quot;token variable&quot;&gt;&lt;span class=&quot;token variable&quot;&gt;$(&lt;/span&gt;&lt;span class=&quot;token environment constant&quot;&gt;HOSTNAME&lt;/span&gt;&lt;span class=&quot;token variable&quot;&gt;)&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;어디까지나 &lt;code class=&quot;language-text&quot;&gt;command&lt;/code&gt;나 &lt;code class=&quot;language-text&quot;&gt;args&lt;/code&gt;에서 참조 가능한 것은 그 파드의 매니페스트 내부에 정의된 환경 변수만이다. 만약 OS에서만 참조할 수 있는 환경 변수를 사용하는 경우 &lt;code class=&quot;language-text&quot;&gt;Entrypoint(spec.containers[].command)&lt;/code&gt;를 entrypoint.sh 등의 셸 스크립트로 하여 셸 스크립트 내부에서 처리할 수 있도록 한다.&lt;/p&gt;
&lt;p&gt;여기서는 정적 환경 변수(TESTENC=100)를 예제로 설명했다. 시크릿이나 컨피그맵에서 정의한 env, 파드나 컨테이너 정보를 &lt;code class=&quot;language-text&quot;&gt;fieldRef&lt;/code&gt;나 &lt;code class=&quot;language-text&quot;&gt;resourceFieldRef&lt;/code&gt;에서 참조한 env도 마찬가지로 [$(SOME_ENVIRONMENT)] 형식으로만 사용할 수 있다.&lt;/p&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;yaml&quot;&gt;&lt;pre class=&quot;language-yaml&quot;&gt;&lt;code class=&quot;language-yaml&quot;&gt;&lt;span class=&quot;token key atrule&quot;&gt;apiVersion&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt; v1
&lt;span class=&quot;token key atrule&quot;&gt;kind&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt; Pod
&lt;span class=&quot;token key atrule&quot;&gt;metadata&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt;
  &lt;span class=&quot;token key atrule&quot;&gt;name&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt; sample&lt;span class=&quot;token punctuation&quot;&gt;-&lt;/span&gt;env&lt;span class=&quot;token punctuation&quot;&gt;-&lt;/span&gt;fail3
  &lt;span class=&quot;token key atrule&quot;&gt;labels&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt;
    &lt;span class=&quot;token key atrule&quot;&gt;app&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt; sample&lt;span class=&quot;token punctuation&quot;&gt;-&lt;/span&gt;app
&lt;span class=&quot;token key atrule&quot;&gt;spec&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt;
  &lt;span class=&quot;token key atrule&quot;&gt;containers&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt;
    &lt;span class=&quot;token punctuation&quot;&gt;-&lt;/span&gt; &lt;span class=&quot;token key atrule&quot;&gt;name&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt; nginx&lt;span class=&quot;token punctuation&quot;&gt;-&lt;/span&gt;container
      &lt;span class=&quot;token key atrule&quot;&gt;image&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt; nginx&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt;&lt;span class=&quot;token number&quot;&gt;1.16&lt;/span&gt;
      &lt;span class=&quot;token key atrule&quot;&gt;command&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;[&lt;/span&gt;&lt;span class=&quot;token string&quot;&gt;&quot;echo&quot;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;]&lt;/span&gt;
      &lt;span class=&quot;token key atrule&quot;&gt;args&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;[&lt;/span&gt;&lt;span class=&quot;token string&quot;&gt;&quot;$(K8S_NODE)&quot;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;token string&quot;&gt;&quot;${K8S_NODE}&quot;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;]&lt;/span&gt;
      &lt;span class=&quot;token key atrule&quot;&gt;env&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt;
      &lt;span class=&quot;token punctuation&quot;&gt;-&lt;/span&gt; &lt;span class=&quot;token key atrule&quot;&gt;name&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt; K8S_NODE
        &lt;span class=&quot;token key atrule&quot;&gt;valueFrom&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt;
          &lt;span class=&quot;token key atrule&quot;&gt;fieldRef&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt;
            &lt;span class=&quot;token key atrule&quot;&gt;fieldPath&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt; spec.nodeName&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;sh&quot;&gt;&lt;pre class=&quot;language-sh&quot;&gt;&lt;code class=&quot;language-sh&quot;&gt;&lt;span class=&quot;token comment&quot;&gt;# 외부 정보를 바탕으로 정의된 환경 변수 사용&lt;/span&gt;
$ kubectl logs sample-env-fail3
kind-clusetr-worker &lt;span class=&quot;token variable&quot;&gt;${K8S_NODE}&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;h1&gt;7.3 시크릿&lt;/h1&gt;
&lt;p&gt;시크릿은 아래와 같이 몇 가지 타입으로 나눌 수 있다.&lt;/p&gt;
&lt;table&gt;
&lt;thead&gt;
&lt;tr&gt;
&lt;th&gt;종류&lt;/th&gt;
&lt;th&gt;개요&lt;/th&gt;
&lt;/tr&gt;
&lt;/thead&gt;
&lt;tbody&gt;
&lt;tr&gt;
&lt;td&gt;Opaque&lt;/td&gt;
&lt;td&gt;일반적인 범용 용도&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;kubernetes.io/tls&lt;/td&gt;
&lt;td&gt;TLS 인증 사용&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;kubernetes.io/basic-auth&lt;/td&gt;
&lt;td&gt;기본 인증용&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;kubernetes.io/dockerconfigjson&lt;/td&gt;
&lt;td&gt;도커 레지스트리 인증 정보용&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;kubernetes.io/ssh-auth&lt;/td&gt;
&lt;td&gt;SSH 인증 정보용&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;kubernetes.io/service-account-token&lt;/td&gt;
&lt;td&gt;서비스 어카운트 토큰용&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;kubernetes.io/token&lt;/td&gt;
&lt;td&gt;Bootstrap 토큰용&lt;/td&gt;
&lt;/tr&gt;
&lt;/tbody&gt;
&lt;/table&gt;
&lt;h2&gt;7.3.1 일반적인 범용 용도의 시크릿 (Opaque)&lt;/h2&gt;
&lt;p&gt;일반적인 스키마리스 시크릿을 생성하는 경우 타입에 Opaque를 지정한다. 생성 방법에는 다음과 같은 네 가지 패턴이 있다.&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;kubectl로 파일에서 값을 참조하여 생성 (--from-file)&lt;/li&gt;
&lt;li&gt;kubectl로 envfile에서 값을 참조하여 생성 (--from-env-file)&lt;/li&gt;
&lt;li&gt;kubectl로 직접 값을 전달하여 생성 (--from-literal)&lt;/li&gt;
&lt;li&gt;매니페스트에서 생성 (-f)&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;시크릿 리소스에서는 하나의 시크릿 안에 여러 키-밸류 값이 저장된다. 하나의 시크릿당 저장 가능한 데이터 사이즈는 총 1MB이다. 예를 들어, 데이터베이스 인증 정보를 생성하는 경우 시크릿명은 &lt;code class=&quot;language-text&quot;&gt;db-auth&lt;/code&gt;, key는 &lt;code class=&quot;language-text&quot;&gt;username&lt;/code&gt;, &lt;code class=&quot;language-text&quot;&gt;password&lt;/code&gt; 두 가지를 지정한다. 물론 쿠버네티스 클러스터 내부에서 여러 데이터베이스 인증 정보를 사용하는 경우도 있으므로, 이런 경우 시크릿명을 유니크한 이름으로 정의하거나 시스템별로 네임스페이스를 분리해야 한다.&lt;/p&gt;
&lt;h3&gt;kubectl로 파일에서 값을 참조하여 생성 (--from-file)&lt;/h3&gt;
&lt;p&gt;kubectl을 사용하여 파일에 값을 참조함으로써 생성하는 경우에는 &lt;code class=&quot;language-text&quot;&gt;--from-file&lt;/code&gt; 옵션을 지정한다. 일반적으로 파일명이 그대로 키가 되기 때문에 확장자는 붙이지 않는 것이 좋다. 확장자를 붙이는 경우 &lt;code class=&quot;language-text&quot;&gt;--from-file=username=username.txt&lt;/code&gt;와 같이 지정한다. 또한, 파일 생성 시 개행 코드가 들어가지 않도록 주의한다.&lt;/p&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;sh&quot;&gt;&lt;pre class=&quot;language-sh&quot;&gt;&lt;code class=&quot;language-sh&quot;&gt;&lt;span class=&quot;token comment&quot;&gt;# 시크릿에 포함된 값을 파일로 내보내기&lt;/span&gt;
$ &lt;span class=&quot;token builtin class-name&quot;&gt;echo&lt;/span&gt; &lt;span class=&quot;token parameter variable&quot;&gt;-n&lt;/span&gt; &lt;span class=&quot;token string&quot;&gt;&quot;root&quot;&lt;/span&gt; &lt;span class=&quot;token operator&quot;&gt;&gt;&lt;/span&gt; ./username
$ &lt;span class=&quot;token builtin class-name&quot;&gt;echo&lt;/span&gt; &lt;span class=&quot;token parameter variable&quot;&gt;-n&lt;/span&gt; &lt;span class=&quot;token string&quot;&gt;&quot;rootpassword&quot;&lt;/span&gt; &lt;span class=&quot;token operator&quot;&gt;&gt;&lt;/span&gt; ./password

&lt;span class=&quot;token comment&quot;&gt;# 파일에서 값을 참조하여 시크릿 생성&lt;/span&gt;
$ kubectl create secret generic --save-config sample-db-auth &lt;span class=&quot;token punctuation&quot;&gt;\&lt;/span&gt;
--from-file&lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt;./username --from-file&lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt;./password
secret/sample-db-auth created

&lt;span class=&quot;token comment&quot;&gt;# 시크릿 확인 (base64 인코드)&lt;/span&gt;
$ kubectl get secrets sample-db-auth &lt;span class=&quot;token parameter variable&quot;&gt;-o&lt;/span&gt; json &lt;span class=&quot;token operator&quot;&gt;|&lt;/span&gt; jq .data
kubectl get secrets sample-db-auth &lt;span class=&quot;token parameter variable&quot;&gt;-o&lt;/span&gt; json &lt;span class=&quot;token operator&quot;&gt;|&lt;/span&gt; jq .data
&lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;
  &lt;span class=&quot;token string&quot;&gt;&quot;password&quot;&lt;/span&gt;&lt;span class=&quot;token builtin class-name&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;token string&quot;&gt;&quot;cm9vdHBhc3N3b3Jk&quot;&lt;/span&gt;,
  &lt;span class=&quot;token string&quot;&gt;&quot;username&quot;&lt;/span&gt;&lt;span class=&quot;token builtin class-name&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;token string&quot;&gt;&quot;cm9vdA==&quot;&lt;/span&gt;
&lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;

&lt;span class=&quot;token comment&quot;&gt;# 일반 텍스트로 변경하려면 base64로 디코드가 필요하다.&lt;/span&gt;
$ kubectl get secrets sample-db-auth &lt;span class=&quot;token parameter variable&quot;&gt;-o&lt;/span&gt; json &lt;span class=&quot;token operator&quot;&gt;|&lt;/span&gt; jq &lt;span class=&quot;token parameter variable&quot;&gt;-r&lt;/span&gt; .data.username &lt;span class=&quot;token operator&quot;&gt;|&lt;/span&gt; base64 &lt;span class=&quot;token parameter variable&quot;&gt;--decode&lt;/span&gt;
root&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;h3&gt;kubectl로 envfile에서 값을 참조하여 생성(--from-env-file)&lt;/h3&gt;
&lt;p&gt;하나의 파일에서 일괄적으로 생성하는 경우에는 envfile로 생성하는 방법도 있다. 도커에서 &lt;code class=&quot;language-text&quot;&gt;--env-file&lt;/code&gt; 옵션을 사용하여 컨테이너를 기동한 경우 이 방법을 사용하면 그대로 시크릿을 이관할 수 있다.&lt;/p&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;text&quot;&gt;&lt;pre class=&quot;language-text&quot;&gt;&lt;code class=&quot;language-text&quot;&gt;username=root
password=rootpassword&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;sh&quot;&gt;&lt;pre class=&quot;language-sh&quot;&gt;&lt;code class=&quot;language-sh&quot;&gt;&lt;span class=&quot;token comment&quot;&gt;# envfile로 시크릿 생성&lt;/span&gt;
$ kubectl create secret generic --save-config sample-db-auth &lt;span class=&quot;token punctuation&quot;&gt;\&lt;/span&gt;
--from-env-file ./env-secret.txt
secret/sample-db-auth created&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;h3&gt;kubectl로 값을 직접 전달하여 생성(--from-literal)&lt;/h3&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;sh&quot;&gt;&lt;pre class=&quot;language-sh&quot;&gt;&lt;code class=&quot;language-sh&quot;&gt;&lt;span class=&quot;token comment&quot;&gt;# 직접 옵션으로 값을 지정하여 시크릿 생성&lt;/span&gt;
$ kubectl create secret generic --save-config sample-db-auth &lt;span class=&quot;token punctuation&quot;&gt;\&lt;/span&gt;
--from-literal&lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt;username&lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt;root --from-literal&lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt;password&lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt;rootpassword
secret/sample-db-auth created&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;h3&gt;매니페스트에서 생성(-f)&lt;/h3&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;yaml&quot;&gt;&lt;pre class=&quot;language-yaml&quot;&gt;&lt;code class=&quot;language-yaml&quot;&gt;&lt;span class=&quot;token key atrule&quot;&gt;apiVersion&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt; v1
&lt;span class=&quot;token key atrule&quot;&gt;kind&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt; Secret
&lt;span class=&quot;token key atrule&quot;&gt;metadata&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt;
  &lt;span class=&quot;token key atrule&quot;&gt;name&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt; sample&lt;span class=&quot;token punctuation&quot;&gt;-&lt;/span&gt;db&lt;span class=&quot;token punctuation&quot;&gt;-&lt;/span&gt;auth
&lt;span class=&quot;token key atrule&quot;&gt;type&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt; Opaque
&lt;span class=&quot;token key atrule&quot;&gt;data&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt;
  &lt;span class=&quot;token key atrule&quot;&gt;username&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt; cm9vdA== &lt;span class=&quot;token comment&quot;&gt;# root&lt;/span&gt;
  &lt;span class=&quot;token key atrule&quot;&gt;password&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt; cm9vdHBhc3N3b3Jk &lt;span class=&quot;token comment&quot;&gt;# rootpassword&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;yaml&quot;&gt;&lt;pre class=&quot;language-yaml&quot;&gt;&lt;code class=&quot;language-yaml&quot;&gt;&lt;span class=&quot;token key atrule&quot;&gt;apiVersion&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt; v1
&lt;span class=&quot;token key atrule&quot;&gt;kind&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt; Secret
&lt;span class=&quot;token key atrule&quot;&gt;metadata&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt;
  &lt;span class=&quot;token key atrule&quot;&gt;name&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt; sample&lt;span class=&quot;token punctuation&quot;&gt;-&lt;/span&gt;db&lt;span class=&quot;token punctuation&quot;&gt;-&lt;/span&gt;auth&lt;span class=&quot;token punctuation&quot;&gt;-&lt;/span&gt;nobase64
&lt;span class=&quot;token key atrule&quot;&gt;type&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt; Opaque
&lt;span class=&quot;token key atrule&quot;&gt;stringData&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt;
  &lt;span class=&quot;token key atrule&quot;&gt;username&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt; root
  &lt;span class=&quot;token key atrule&quot;&gt;password&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt; rootpassword&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;매니페스트에서 생성하는 경우 base64로 인코드한 값을 매니페스트에 추가한다. base64 인코드되지 않은 경우 &lt;code class=&quot;language-text&quot;&gt;stringData&lt;/code&gt; 필드를 사용하여 일반 텍스트로 작성할 수 있다.&lt;/p&gt;
&lt;h2&gt;7.3.3 TLS 타입 시크릿&lt;/h2&gt;
&lt;p&gt;인증서로 사용할 시크릿을 생성하는 경우 &lt;code class=&quot;language-text&quot;&gt;type&lt;/code&gt;에 &lt;code class=&quot;language-text&quot;&gt;tls&lt;/code&gt;를 지정한다. TLS 타입의 시크릿은 인그레스 리소스 등에서 사용하는 것이 일반적이다. TLS 타입의 시크릿도 매니페스트로 생성할 수 있지만, 기본적으로 비밀키와 인증서 파일을 생성하는 것을 추천한다.&lt;/p&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;sh&quot;&gt;&lt;pre class=&quot;language-sh&quot;&gt;&lt;code class=&quot;language-sh&quot;&gt;&lt;span class=&quot;token comment&quot;&gt;# 자체 서명된 인증서 생성&lt;/span&gt;
$ openssl req &lt;span class=&quot;token parameter variable&quot;&gt;-x509&lt;/span&gt; &lt;span class=&quot;token parameter variable&quot;&gt;-nodes&lt;/span&gt; &lt;span class=&quot;token parameter variable&quot;&gt;-days&lt;/span&gt; &lt;span class=&quot;token number&quot;&gt;365&lt;/span&gt; &lt;span class=&quot;token parameter variable&quot;&gt;-newkey&lt;/span&gt; rsa:2048 &lt;span class=&quot;token punctuation&quot;&gt;\&lt;/span&gt;
&lt;span class=&quot;token parameter variable&quot;&gt;-keyout&lt;/span&gt; ~/tls.key &lt;span class=&quot;token parameter variable&quot;&gt;-out&lt;/span&gt; ~/tls.crt &lt;span class=&quot;token parameter variable&quot;&gt;-subj&lt;/span&gt; &lt;span class=&quot;token string&quot;&gt;&quot;/CN=sample1.example.com&quot;&lt;/span&gt;

&lt;span class=&quot;token comment&quot;&gt;# TLS 시크릿 생성&lt;/span&gt;
$ kubectl create secret tls --save-config tls-sample &lt;span class=&quot;token parameter variable&quot;&gt;--key&lt;/span&gt; ./tls.key &lt;span class=&quot;token parameter variable&quot;&gt;--cert&lt;/span&gt; ./tls.crt
secret/tls-sample created&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;h2&gt;7.3.4 도커 레지스트리 타입의 시크릿&lt;/h2&gt;
&lt;p&gt;사용하고 있는 컨테이너 레지스트리가 프라이빗 저장소인 경우, 도커 이미지를 가져오려면 인증이 필요하다. 쿠버네티스에서는 이 인증 정보를 시크릿으로 정의하여 사용할 수 있다. 도커 인증용 시크릿을 생성하는 경우 &lt;code class=&quot;language-text&quot;&gt;type&lt;/code&gt;에 &lt;code class=&quot;language-text&quot;&gt;docker-registry&lt;/code&gt;를 지정한다.&lt;/p&gt;
&lt;h3&gt;kubectl로 직접 생성&lt;/h3&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;sh&quot;&gt;&lt;pre class=&quot;language-sh&quot;&gt;&lt;code class=&quot;language-sh&quot;&gt;&lt;span class=&quot;token comment&quot;&gt;# 도커 레지스트리 인증 정보의 시크릿 생성&lt;/span&gt;
$ kubectl create secret docker-registry --save-config sample-registry-auth &lt;span class=&quot;token punctuation&quot;&gt;\&lt;/span&gt;
--docker-server&lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt;REGISTRY_SERVER &lt;span class=&quot;token punctuation&quot;&gt;\&lt;/span&gt;
--docker-username&lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt;REGISTRY_USER &lt;span class=&quot;token punctuation&quot;&gt;\&lt;/span&gt;
--docker-password&lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt;REGISTRY_USER_PASSWORD &lt;span class=&quot;token punctuation&quot;&gt;\&lt;/span&gt;
--docker-email&lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt;REGISTRY_USER_EMAIL
secret/sample-registry-auth created

&lt;span class=&quot;token comment&quot;&gt;# base64로 인코드된 dockercfg 형식의 JSON 데이터&lt;/span&gt;
$ kubectl get secrets &lt;span class=&quot;token parameter variable&quot;&gt;-o&lt;/span&gt; json sample-registry-auth &lt;span class=&quot;token operator&quot;&gt;|&lt;/span&gt; jq .data
&lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;
  &lt;span class=&quot;token string&quot;&gt;&quot;.dockerconfigjson&quot;&lt;/span&gt;&lt;span class=&quot;token builtin class-name&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;token string&quot;&gt;&quot;eyJhdXRocyI6eyJSRUdJU1RSWV9TRVJWRVIiOnsidXNlcm5hbWUiOiJSRUdJU1RSWV9VU0VSIiwicGFzc3dvcmQiOiJSRUdJU1RSWV9VU0VSX1BBU1NXT1JEIiwiZW1haWwiOiJSRUdJU1RSWV9VU0VSX0VNQUlMIiwiYXV0aCI6IlVrVkhTVk5VVWxsZlZWTkZVanBTUlVkSlUxUlNXVjlWVTBWU1gxQkJVMU5YVDFKRSJ9fX0=&quot;&lt;/span&gt;
&lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;

&lt;span class=&quot;token comment&quot;&gt;# base64로 디코드한 dockercfg 형식의 JSON 데이터&lt;/span&gt;
$ kubectl get secrets sample-registry-auth &lt;span class=&quot;token parameter variable&quot;&gt;-o&lt;/span&gt; yaml &lt;span class=&quot;token operator&quot;&gt;|&lt;/span&gt; &lt;span class=&quot;token function&quot;&gt;grep&lt;/span&gt; &lt;span class=&quot;token string&quot;&gt;&quot;\.dockerconfigjson&quot;&lt;/span&gt; &lt;span class=&quot;token operator&quot;&gt;|&lt;/span&gt; &lt;span class=&quot;token function&quot;&gt;awk&lt;/span&gt; -F&lt;span class=&quot;token string&quot;&gt;&apos; &apos;&lt;/span&gt; &lt;span class=&quot;token string&quot;&gt;&apos;{print $2}&apos;&lt;/span&gt; &lt;span class=&quot;token operator&quot;&gt;|&lt;/span&gt; base64 &lt;span class=&quot;token parameter variable&quot;&gt;--decode&lt;/span&gt;
&lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;&lt;span class=&quot;token string&quot;&gt;&quot;auths&quot;&lt;/span&gt;:&lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;&lt;span class=&quot;token string&quot;&gt;&quot;REGISTRY_SERVER&quot;&lt;/span&gt;:&lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;&lt;span class=&quot;token string&quot;&gt;&quot;username&quot;&lt;/span&gt;&lt;span class=&quot;token builtin class-name&quot;&gt;:&lt;/span&gt;&lt;span class=&quot;token string&quot;&gt;&quot;REGISTRY_USER&quot;&lt;/span&gt;,&lt;span class=&quot;token string&quot;&gt;&quot;password&quot;&lt;/span&gt;&lt;span class=&quot;token builtin class-name&quot;&gt;:&lt;/span&gt;&lt;span class=&quot;token string&quot;&gt;&quot;REGISTRY_USER_PASSWORD&quot;&lt;/span&gt;,&lt;span class=&quot;token string&quot;&gt;&quot;email&quot;&lt;/span&gt;&lt;span class=&quot;token builtin class-name&quot;&gt;:&lt;/span&gt;&lt;span class=&quot;token string&quot;&gt;&quot;REGISTRY_USER_EMAIL&quot;&lt;/span&gt;,&lt;span class=&quot;token string&quot;&gt;&quot;auth&quot;&lt;/span&gt;&lt;span class=&quot;token builtin class-name&quot;&gt;:&lt;/span&gt;&lt;span class=&quot;token string&quot;&gt;&quot;UkVHSVNUUllfVVNFUjpSRUdJU1RSWV9VU0VSX1BBU1NXT1JE&quot;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;h3&gt;이미지 다운로드 시 시크릿 사용&lt;/h3&gt;
&lt;p&gt;인증이 필요한 도커 레지스트리의 프라이빗 저장소에 저장된 이미지를 다운로드 하는 경우, 시크릿을 사전에 생성한 후 파드 정의 &lt;code class=&quot;language-text&quot;&gt;spec.imagePullSecrets&lt;/code&gt;에 docker-registry 타입의 시크릿을 지정해야 한다.&lt;/p&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;yaml&quot;&gt;&lt;pre class=&quot;language-yaml&quot;&gt;&lt;code class=&quot;language-yaml&quot;&gt;&lt;span class=&quot;token key atrule&quot;&gt;apiVersion&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt; v1
&lt;span class=&quot;token key atrule&quot;&gt;kind&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt; Pod
&lt;span class=&quot;token key atrule&quot;&gt;metadata&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt;
  &lt;span class=&quot;token key atrule&quot;&gt;name&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt; sample&lt;span class=&quot;token punctuation&quot;&gt;-&lt;/span&gt;pull&lt;span class=&quot;token punctuation&quot;&gt;-&lt;/span&gt;secret
&lt;span class=&quot;token key atrule&quot;&gt;spec&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt;
  &lt;span class=&quot;token key atrule&quot;&gt;containers&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt;
    &lt;span class=&quot;token punctuation&quot;&gt;-&lt;/span&gt; &lt;span class=&quot;token key atrule&quot;&gt;name&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt; secret&lt;span class=&quot;token punctuation&quot;&gt;-&lt;/span&gt;image&lt;span class=&quot;token punctuation&quot;&gt;-&lt;/span&gt;container
      &lt;span class=&quot;token key atrule&quot;&gt;image&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt; REGISTRY_NAME/secret&lt;span class=&quot;token punctuation&quot;&gt;-&lt;/span&gt;image&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt;latest
  &lt;span class=&quot;token key atrule&quot;&gt;imagePullSecrets&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt;
    &lt;span class=&quot;token punctuation&quot;&gt;-&lt;/span&gt; &lt;span class=&quot;token key atrule&quot;&gt;name&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt; sample&lt;span class=&quot;token punctuation&quot;&gt;-&lt;/span&gt;registry&lt;span class=&quot;token punctuation&quot;&gt;-&lt;/span&gt;auth&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;h2&gt;7.3.5 기본 인증 타입 시크릿&lt;/h2&gt;
&lt;p&gt;사용자명과 패스워드로 인증하는 시스템을 사용하는 경우 기본 인증용 스키마를 가진 시크릿을 생성한다.&lt;/p&gt;
&lt;h3&gt;kubectl로 직접 값을 전달하여 생성(--from-literal)&lt;/h3&gt;
&lt;p&gt;kubectl로 직접 값을 전달하여 생성하려면 &lt;code class=&quot;language-text&quot;&gt;--from-literal&lt;/code&gt; 옵션을 사용한다. 기본 인증 타입은 &lt;code class=&quot;language-text&quot;&gt;--type&lt;/code&gt; 옵션에서 지정한다.&lt;/p&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;sh&quot;&gt;&lt;pre class=&quot;language-sh&quot;&gt;&lt;code class=&quot;language-sh&quot;&gt;&lt;span class=&quot;token comment&quot;&gt;# 직접 옵션에서 type과 함께 지정하여 생성&lt;/span&gt;
$ kubectl create secret generic --save-config sample-basic-auth &lt;span class=&quot;token punctuation&quot;&gt;\&lt;/span&gt;
&lt;span class=&quot;token parameter variable&quot;&gt;--type&lt;/span&gt; kubernetes.io/basic-auth &lt;span class=&quot;token punctuation&quot;&gt;\&lt;/span&gt;
--from-literal&lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt;username&lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt;root --from-literal&lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt;password&lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt;rootpassword&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;h3&gt;매니페스트에서 생성(-f)&lt;/h3&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;yaml&quot;&gt;&lt;pre class=&quot;language-yaml&quot;&gt;&lt;code class=&quot;language-yaml&quot;&gt;&lt;span class=&quot;token key atrule&quot;&gt;apiVersion&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt; v1
&lt;span class=&quot;token key atrule&quot;&gt;kind&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt; Secret
&lt;span class=&quot;token key atrule&quot;&gt;metadata&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt;
  &lt;span class=&quot;token key atrule&quot;&gt;name&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt; sample&lt;span class=&quot;token punctuation&quot;&gt;-&lt;/span&gt;basic&lt;span class=&quot;token punctuation&quot;&gt;-&lt;/span&gt;auth
&lt;span class=&quot;token key atrule&quot;&gt;type&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt; kubernetes.io/basic&lt;span class=&quot;token punctuation&quot;&gt;-&lt;/span&gt;auth
&lt;span class=&quot;token key atrule&quot;&gt;data&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt;
  &lt;span class=&quot;token key atrule&quot;&gt;username&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt; cm9vdA== &lt;span class=&quot;token comment&quot;&gt;# root&lt;/span&gt;
  &lt;span class=&quot;token key atrule&quot;&gt;password&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt; cm9vdHBhc3N3b3Jk &lt;span class=&quot;token comment&quot;&gt;# rootpassword&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;h2&gt;7.3.6 SSH 인증 타입의 시크릿&lt;/h2&gt;
&lt;p&gt;비밀키로 인증하는 시스템을 사용하는 경우 SSH 인증용 스키마를 가진 시크릿을 생성한다.&lt;/p&gt;
&lt;h3&gt;kubectl로 파일에서 값을 참조하여 생성(--from-file)&lt;/h3&gt;
&lt;p&gt;비밀키 파일은 크기 때문에 Opaque 타입처럼 --from-file 옵션을 사용하여 생성하는 것이 좋다. 그리고 SSH 인증 타입은 --type 옵션에서 지정한다. 또한, 리소스를 생성하지 않고 매니페스트를 출력하는 경우 &lt;code class=&quot;language-text&quot;&gt;--dry-run&lt;/code&gt;, &lt;code class=&quot;language-text&quot;&gt;-o yaml&lt;/code&gt; 옵션을 함께 사용한다.&lt;/p&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;sh&quot;&gt;&lt;pre class=&quot;language-sh&quot;&gt;&lt;code class=&quot;language-sh&quot;&gt;&lt;span class=&quot;token comment&quot;&gt;# SSH 비밀키 생성&lt;/span&gt;
$ ssh-keygen &lt;span class=&quot;token parameter variable&quot;&gt;-t&lt;/span&gt; rsa &lt;span class=&quot;token parameter variable&quot;&gt;-b&lt;/span&gt; &lt;span class=&quot;token number&quot;&gt;2048&lt;/span&gt; &lt;span class=&quot;token parameter variable&quot;&gt;-f&lt;/span&gt; sample-key &lt;span class=&quot;token parameter variable&quot;&gt;-C&lt;/span&gt; &lt;span class=&quot;token string&quot;&gt;&quot;sample&quot;&lt;/span&gt;

&lt;span class=&quot;token comment&quot;&gt;# 파일에서 type과 값을 참조하여 시크릿 생성&lt;/span&gt;
$ kubectl create secret generic --save-config sample-ssh-auth &lt;span class=&quot;token punctuation&quot;&gt;\&lt;/span&gt;
&lt;span class=&quot;token parameter variable&quot;&gt;--type&lt;/span&gt; kubernetes.io/ssh-auth &lt;span class=&quot;token punctuation&quot;&gt;\&lt;/span&gt;
--from-file&lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt;ssh-privatekey&lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt;./sample-key
secret/sample-ssh-auth created&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;h3&gt;매니페스트에서 생성(-f)&lt;/h3&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;yaml&quot;&gt;&lt;pre class=&quot;language-yaml&quot;&gt;&lt;code class=&quot;language-yaml&quot;&gt;&lt;span class=&quot;token key atrule&quot;&gt;apiVersion&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt; v1
&lt;span class=&quot;token key atrule&quot;&gt;kind&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt; Secret
&lt;span class=&quot;token key atrule&quot;&gt;metadata&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt;
  &lt;span class=&quot;token key atrule&quot;&gt;name&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt; sample&lt;span class=&quot;token punctuation&quot;&gt;-&lt;/span&gt;ssh&lt;span class=&quot;token punctuation&quot;&gt;-&lt;/span&gt;auth
&lt;span class=&quot;token key atrule&quot;&gt;type&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt; kubernetes.io/ssh&lt;span class=&quot;token punctuation&quot;&gt;-&lt;/span&gt;auth
&lt;span class=&quot;token key atrule&quot;&gt;data&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt;
  &lt;span class=&quot;token key atrule&quot;&gt;ssh-privatekey&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt; LS0tLS1CRUdJTi&lt;span class=&quot;token punctuation&quot;&gt;...&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;h2&gt;7.3.7 시크릿 사용&lt;/h2&gt;
&lt;p&gt;시크릿을 컨테이너에서 사용할 경우 다음과 같이 크게 두 패턴으로 나뉜다.&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;환경 변수로 전달: 시크릿의 특정 키만, 시크릿의 전체 키&lt;/li&gt;
&lt;li&gt;볼륨으로 마운트: 시크릿의 특정 키만, 시크릿의 전체 키&lt;/li&gt;
&lt;/ul&gt;
&lt;h3&gt;환경 변수로 전달&lt;/h3&gt;
&lt;p&gt;환경 변수로 전달할 경우 특정 키만 전달하거나 시크릿 전체를 전달하는 두 가지 방법이 있다. 시크릿의 특정 키를 전달할 경우에는 &lt;code class=&quot;language-text&quot;&gt;spec.containers[].env&lt;/code&gt;의 &lt;code class=&quot;language-text&quot;&gt;valueFrom.secretKeyRef&lt;/code&gt;를 사용하여 지정한다. env로 하나씩 정의하기 때문에 환경 변수명을 지정할 수 있는 것이 특징이다.&lt;/p&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;yaml&quot;&gt;&lt;pre class=&quot;language-yaml&quot;&gt;&lt;code class=&quot;language-yaml&quot;&gt;&lt;span class=&quot;token key atrule&quot;&gt;apiVersion&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt; v1
&lt;span class=&quot;token key atrule&quot;&gt;kind&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt; Pod
&lt;span class=&quot;token key atrule&quot;&gt;metadata&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt;
  &lt;span class=&quot;token key atrule&quot;&gt;name&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt; sample&lt;span class=&quot;token punctuation&quot;&gt;-&lt;/span&gt;secret&lt;span class=&quot;token punctuation&quot;&gt;-&lt;/span&gt;single&lt;span class=&quot;token punctuation&quot;&gt;-&lt;/span&gt;env
&lt;span class=&quot;token key atrule&quot;&gt;spec&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt;
  &lt;span class=&quot;token key atrule&quot;&gt;containers&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt;
    &lt;span class=&quot;token punctuation&quot;&gt;-&lt;/span&gt; &lt;span class=&quot;token key atrule&quot;&gt;name&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt; secret&lt;span class=&quot;token punctuation&quot;&gt;-&lt;/span&gt;container
      &lt;span class=&quot;token key atrule&quot;&gt;image&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt; nginx&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt;&lt;span class=&quot;token number&quot;&gt;1.16&lt;/span&gt;
      &lt;span class=&quot;token key atrule&quot;&gt;env&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt;
        &lt;span class=&quot;token punctuation&quot;&gt;-&lt;/span&gt; &lt;span class=&quot;token key atrule&quot;&gt;name&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt; DB_USERNAME
          &lt;span class=&quot;token key atrule&quot;&gt;valueFrom&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt;
            &lt;span class=&quot;token key atrule&quot;&gt;secretKeyRef&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt;
              &lt;span class=&quot;token key atrule&quot;&gt;name&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt; sample&lt;span class=&quot;token punctuation&quot;&gt;-&lt;/span&gt;db&lt;span class=&quot;token punctuation&quot;&gt;-&lt;/span&gt;auth
              &lt;span class=&quot;token key atrule&quot;&gt;key&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt; username&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;sh&quot;&gt;&lt;pre class=&quot;language-sh&quot;&gt;&lt;code class=&quot;language-sh&quot;&gt;&lt;span class=&quot;token comment&quot;&gt;# sample-seret-single-env 파드의 DB_USERNAME 환경 변수 확인&lt;/span&gt;
$ kubectl &lt;span class=&quot;token builtin class-name&quot;&gt;exec&lt;/span&gt; &lt;span class=&quot;token parameter variable&quot;&gt;-it&lt;/span&gt; sample-secret-single-env -- &lt;span class=&quot;token function&quot;&gt;env&lt;/span&gt; &lt;span class=&quot;token operator&quot;&gt;|&lt;/span&gt; &lt;span class=&quot;token function&quot;&gt;grep&lt;/span&gt; DB_USERNAME
&lt;span class=&quot;token assign-left variable&quot;&gt;DB_USERNAME&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt;root&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;&lt;code class=&quot;language-text&quot;&gt;envFrom&lt;/code&gt;에서 여러 시크릿을 가져오면 키가 충돌할 가능성이 있다. 이런 경우 접두사를 붙여 충돌을 방지할 수 있다.&lt;/p&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;yaml&quot;&gt;&lt;pre class=&quot;language-yaml&quot;&gt;&lt;code class=&quot;language-yaml&quot;&gt;&lt;span class=&quot;token key atrule&quot;&gt;apiVersion&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt; v1
&lt;span class=&quot;token key atrule&quot;&gt;kind&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt; Pod
&lt;span class=&quot;token key atrule&quot;&gt;metadata&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt;
  &lt;span class=&quot;token key atrule&quot;&gt;name&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt; sample&lt;span class=&quot;token punctuation&quot;&gt;-&lt;/span&gt;secret&lt;span class=&quot;token punctuation&quot;&gt;-&lt;/span&gt;prefix&lt;span class=&quot;token punctuation&quot;&gt;-&lt;/span&gt;env
&lt;span class=&quot;token key atrule&quot;&gt;spec&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt;
  &lt;span class=&quot;token key atrule&quot;&gt;containers&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt;
    &lt;span class=&quot;token punctuation&quot;&gt;-&lt;/span&gt; &lt;span class=&quot;token key atrule&quot;&gt;name&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt; secret&lt;span class=&quot;token punctuation&quot;&gt;-&lt;/span&gt;container
      &lt;span class=&quot;token key atrule&quot;&gt;image&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt; nginx&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt;&lt;span class=&quot;token number&quot;&gt;1.16&lt;/span&gt;
      &lt;span class=&quot;token key atrule&quot;&gt;envFrom&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt;
      &lt;span class=&quot;token punctuation&quot;&gt;-&lt;/span&gt; &lt;span class=&quot;token key atrule&quot;&gt;secretRef&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt;
          &lt;span class=&quot;token key atrule&quot;&gt;name&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt; sample&lt;span class=&quot;token punctuation&quot;&gt;-&lt;/span&gt;db&lt;span class=&quot;token punctuation&quot;&gt;-&lt;/span&gt;auth
        &lt;span class=&quot;token key atrule&quot;&gt;prefix&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt; DB1_
      &lt;span class=&quot;token punctuation&quot;&gt;-&lt;/span&gt; &lt;span class=&quot;token key atrule&quot;&gt;secretRef&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt;
          &lt;span class=&quot;token key atrule&quot;&gt;name&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt; sample&lt;span class=&quot;token punctuation&quot;&gt;-&lt;/span&gt;db&lt;span class=&quot;token punctuation&quot;&gt;-&lt;/span&gt;auth
        &lt;span class=&quot;token key atrule&quot;&gt;prefix&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt; DB2_&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;sh&quot;&gt;&lt;pre class=&quot;language-sh&quot;&gt;&lt;code class=&quot;language-sh&quot;&gt;&lt;span class=&quot;token comment&quot;&gt;# sample-secret-prefix-env 파드의 접두사가 DB인 환경 변수 확인&lt;/span&gt;
$ kubectl &lt;span class=&quot;token builtin class-name&quot;&gt;exec&lt;/span&gt; &lt;span class=&quot;token parameter variable&quot;&gt;-it&lt;/span&gt; sample-secret-prefix-env -- &lt;span class=&quot;token function&quot;&gt;env&lt;/span&gt; &lt;span class=&quot;token operator&quot;&gt;|&lt;/span&gt; &lt;span class=&quot;token function&quot;&gt;grep&lt;/span&gt; ^DB
&lt;span class=&quot;token assign-left variable&quot;&gt;DB2_password&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt;rootpassword
&lt;span class=&quot;token assign-left variable&quot;&gt;DB2_username&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt;root
&lt;span class=&quot;token assign-left variable&quot;&gt;DB1_password&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt;rootpassword
&lt;span class=&quot;token assign-left variable&quot;&gt;DB1_username&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt;root&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;h3&gt;볼륨으로 마운트&lt;/h3&gt;
&lt;p&gt;볼륨으로 마운트하는 경우에도 특정 키만 마운트하거나 시크릿 전체를 마운트하는 두 가지 방법이 있다. 시크릿의 특정 키를 사용하는 경우 &lt;code class=&quot;language-text&quot;&gt;spec.volumes[]&lt;/code&gt;의 &lt;code class=&quot;language-text&quot;&gt;secret.items[]&lt;/code&gt;를 사용하여 저장한다.&lt;/p&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;yaml&quot;&gt;&lt;pre class=&quot;language-yaml&quot;&gt;&lt;code class=&quot;language-yaml&quot;&gt;&lt;span class=&quot;token key atrule&quot;&gt;apiVersion&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt; v1
&lt;span class=&quot;token key atrule&quot;&gt;kind&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt; Pod
&lt;span class=&quot;token key atrule&quot;&gt;metadata&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt;
  &lt;span class=&quot;token key atrule&quot;&gt;name&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt; sample&lt;span class=&quot;token punctuation&quot;&gt;-&lt;/span&gt;secret&lt;span class=&quot;token punctuation&quot;&gt;-&lt;/span&gt;single&lt;span class=&quot;token punctuation&quot;&gt;-&lt;/span&gt;volume
&lt;span class=&quot;token key atrule&quot;&gt;spec&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt;
  &lt;span class=&quot;token key atrule&quot;&gt;containers&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt;
    &lt;span class=&quot;token punctuation&quot;&gt;-&lt;/span&gt; &lt;span class=&quot;token key atrule&quot;&gt;name&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt; secret&lt;span class=&quot;token punctuation&quot;&gt;-&lt;/span&gt;container
      &lt;span class=&quot;token key atrule&quot;&gt;image&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt; nginx&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt;&lt;span class=&quot;token number&quot;&gt;1.16&lt;/span&gt;
      &lt;span class=&quot;token key atrule&quot;&gt;volumeMounts&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt;
      &lt;span class=&quot;token punctuation&quot;&gt;-&lt;/span&gt; &lt;span class=&quot;token key atrule&quot;&gt;name&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt; config&lt;span class=&quot;token punctuation&quot;&gt;-&lt;/span&gt;volume
        &lt;span class=&quot;token key atrule&quot;&gt;mountPath&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt; /config
  &lt;span class=&quot;token key atrule&quot;&gt;volumes&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt;
    &lt;span class=&quot;token punctuation&quot;&gt;-&lt;/span&gt; &lt;span class=&quot;token key atrule&quot;&gt;name&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt; config&lt;span class=&quot;token punctuation&quot;&gt;-&lt;/span&gt;volume
      &lt;span class=&quot;token key atrule&quot;&gt;secret&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt;
        &lt;span class=&quot;token key atrule&quot;&gt;secretName&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt; sample&lt;span class=&quot;token punctuation&quot;&gt;-&lt;/span&gt;db&lt;span class=&quot;token punctuation&quot;&gt;-&lt;/span&gt;auth
        &lt;span class=&quot;token key atrule&quot;&gt;items&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt;
        &lt;span class=&quot;token punctuation&quot;&gt;-&lt;/span&gt; &lt;span class=&quot;token key atrule&quot;&gt;key&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt; username
          &lt;span class=&quot;token key atrule&quot;&gt;path&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt; username.txt&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;sh&quot;&gt;&lt;pre class=&quot;language-sh&quot;&gt;&lt;code class=&quot;language-sh&quot;&gt;&lt;span class=&quot;token comment&quot;&gt;# sample-secret-single-volume 파드의 /config/username.txt 파일 확인&lt;/span&gt;
$ kubectl &lt;span class=&quot;token builtin class-name&quot;&gt;exec&lt;/span&gt; &lt;span class=&quot;token parameter variable&quot;&gt;-it&lt;/span&gt; sample-secret-single-volume -- &lt;span class=&quot;token function&quot;&gt;cat&lt;/span&gt; /config/username.txt
root&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;시크릿 전체를 마운트할 수 있으나, 시크릿에 어떤 값이 저장되어 있는지 매니페스트 정의에서 판단하기 힘든 것이 단점이다.&lt;/p&gt;
&lt;h3&gt;동적 시크릿 업데이트&lt;/h3&gt;
&lt;p&gt;볼륨 마운트를 사용한 시크릿에서는 일정 기간마다(kubelet의 Sync Loop 타이밍) kubeapiserver로 변경을 확인하고 변경이 있을 경우 파일을 교체한다. 기본 업데이트 주기는 60초로 설정되어 있다. 이 주기를 조정하려면 kubelet의 --sync-frequency 옵션을 지정해야 한다. 또한, 환경 변수를 사용한 시크릿의 경우 파드를 기동할 때 환경 변수가 정해지기 때문에 동적으로 변경할 수 없다.&lt;/p&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;sh&quot;&gt;&lt;pre class=&quot;language-sh&quot;&gt;&lt;code class=&quot;language-sh&quot;&gt;&lt;span class=&quot;token comment&quot;&gt;# 시크릿에 마운트된 디렉터리 확인&lt;/span&gt;
$ kubectl &lt;span class=&quot;token builtin class-name&quot;&gt;exec&lt;/span&gt; &lt;span class=&quot;token parameter variable&quot;&gt;-it&lt;/span&gt; sample-secret-multi-volume -- &lt;span class=&quot;token function&quot;&gt;ls&lt;/span&gt; &lt;span class=&quot;token parameter variable&quot;&gt;-la&lt;/span&gt; /config
total &lt;span class=&quot;token number&quot;&gt;4&lt;/span&gt;
drwxrwxrwt &lt;span class=&quot;token number&quot;&gt;3&lt;/span&gt; root root  &lt;span class=&quot;token number&quot;&gt;120&lt;/span&gt; Oct &lt;span class=&quot;token number&quot;&gt;10&lt;/span&gt; &lt;span class=&quot;token number&quot;&gt;10&lt;/span&gt;:49 &lt;span class=&quot;token builtin class-name&quot;&gt;.&lt;/span&gt;
drwxr-xr-x &lt;span class=&quot;token number&quot;&gt;1&lt;/span&gt; root root &lt;span class=&quot;token number&quot;&gt;4096&lt;/span&gt; Oct &lt;span class=&quot;token number&quot;&gt;10&lt;/span&gt; &lt;span class=&quot;token number&quot;&gt;10&lt;/span&gt;:49 &lt;span class=&quot;token punctuation&quot;&gt;..&lt;/span&gt;
drwxr-xr-x &lt;span class=&quot;token number&quot;&gt;2&lt;/span&gt; root root   &lt;span class=&quot;token number&quot;&gt;80&lt;/span&gt; Oct &lt;span class=&quot;token number&quot;&gt;10&lt;/span&gt; &lt;span class=&quot;token number&quot;&gt;10&lt;/span&gt;:49 &lt;span class=&quot;token punctuation&quot;&gt;..&lt;/span&gt;2022_10_10_10_49_22.2776941385
lrwxrwxrwx &lt;span class=&quot;token number&quot;&gt;1&lt;/span&gt; root root   &lt;span class=&quot;token number&quot;&gt;32&lt;/span&gt; Oct &lt;span class=&quot;token number&quot;&gt;10&lt;/span&gt; &lt;span class=&quot;token number&quot;&gt;10&lt;/span&gt;:49 &lt;span class=&quot;token punctuation&quot;&gt;..&lt;/span&gt;data -&lt;span class=&quot;token operator&quot;&gt;&gt;&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;..&lt;/span&gt;2022_10_10_10_49_22.2776941385
lrwxrwxrwx &lt;span class=&quot;token number&quot;&gt;1&lt;/span&gt; root root   &lt;span class=&quot;token number&quot;&gt;15&lt;/span&gt; Oct &lt;span class=&quot;token number&quot;&gt;10&lt;/span&gt; &lt;span class=&quot;token number&quot;&gt;10&lt;/span&gt;:49 password -&lt;span class=&quot;token operator&quot;&gt;&gt;&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;..&lt;/span&gt;data/password
lrwxrwxrwx &lt;span class=&quot;token number&quot;&gt;1&lt;/span&gt; root root   &lt;span class=&quot;token number&quot;&gt;15&lt;/span&gt; Oct &lt;span class=&quot;token number&quot;&gt;10&lt;/span&gt; &lt;span class=&quot;token number&quot;&gt;10&lt;/span&gt;:49 username -&lt;span class=&quot;token operator&quot;&gt;&gt;&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;..&lt;/span&gt;data/username

&lt;span class=&quot;token comment&quot;&gt;# 파드의 /config/username 파일 내용 확인&lt;/span&gt;
$ kubectl &lt;span class=&quot;token builtin class-name&quot;&gt;exec&lt;/span&gt; &lt;span class=&quot;token parameter variable&quot;&gt;-it&lt;/span&gt; sample-secret-multi-volume -- &lt;span class=&quot;token function&quot;&gt;cat&lt;/span&gt; /config/username
root

&lt;span class=&quot;token comment&quot;&gt;# 시크릿 변경 전 경과 시간 확인&lt;/span&gt;
$ kubectl get pods sample-secret-multi-volume
NAME                         READY   STATUS    RESTARTS   AGE
sample-secret-multi-volume   &lt;span class=&quot;token number&quot;&gt;1&lt;/span&gt;/1     Running   &lt;span class=&quot;token number&quot;&gt;0&lt;/span&gt;          94s

&lt;span class=&quot;token comment&quot;&gt;# 시크릿 내용 업데이트&lt;/span&gt;
$ &lt;span class=&quot;token function&quot;&gt;cat&lt;/span&gt; &lt;span class=&quot;token operator&quot;&gt;&amp;lt;&amp;lt;&lt;/span&gt; &lt;span class=&quot;token string&quot;&gt;EOF&lt;span class=&quot;token bash punctuation&quot;&gt; &lt;span class=&quot;token operator&quot;&gt;|&lt;/span&gt; kubectl apply &lt;span class=&quot;token parameter variable&quot;&gt;-f&lt;/span&gt; -&lt;/span&gt;
apiVersion: v1
kind: Secret
metadata:
    name: sample-db-auth
type: Opaque
data:
    # root &gt; admin으로 변경
    username: YWRtaW4=
EOF&lt;/span&gt;
secret/sample-db-auth configured

&lt;span class=&quot;token comment&quot;&gt;# 시크릿에 마운트된 디렉터리를 확인&lt;/span&gt;
$ kubectl &lt;span class=&quot;token builtin class-name&quot;&gt;exec&lt;/span&gt; &lt;span class=&quot;token parameter variable&quot;&gt;-it&lt;/span&gt; sample-secret-multi-volume -- &lt;span class=&quot;token function&quot;&gt;ls&lt;/span&gt; &lt;span class=&quot;token parameter variable&quot;&gt;-la&lt;/span&gt; /config
total &lt;span class=&quot;token number&quot;&gt;4&lt;/span&gt;
drwxrwxrwt &lt;span class=&quot;token number&quot;&gt;3&lt;/span&gt; root root  &lt;span class=&quot;token number&quot;&gt;120&lt;/span&gt; Oct &lt;span class=&quot;token number&quot;&gt;10&lt;/span&gt; &lt;span class=&quot;token number&quot;&gt;10&lt;/span&gt;:49 &lt;span class=&quot;token builtin class-name&quot;&gt;.&lt;/span&gt;
drwxr-xr-x &lt;span class=&quot;token number&quot;&gt;1&lt;/span&gt; root root &lt;span class=&quot;token number&quot;&gt;4096&lt;/span&gt; Oct &lt;span class=&quot;token number&quot;&gt;10&lt;/span&gt; &lt;span class=&quot;token number&quot;&gt;10&lt;/span&gt;:49 &lt;span class=&quot;token punctuation&quot;&gt;..&lt;/span&gt;
drwxr-xr-x &lt;span class=&quot;token number&quot;&gt;2&lt;/span&gt; root root   &lt;span class=&quot;token number&quot;&gt;80&lt;/span&gt; Oct &lt;span class=&quot;token number&quot;&gt;10&lt;/span&gt; &lt;span class=&quot;token number&quot;&gt;10&lt;/span&gt;:49 &lt;span class=&quot;token punctuation&quot;&gt;..&lt;/span&gt;2022_10_10_10_49_22.2776941385
lrwxrwxrwx &lt;span class=&quot;token number&quot;&gt;1&lt;/span&gt; root root   &lt;span class=&quot;token number&quot;&gt;32&lt;/span&gt; Oct &lt;span class=&quot;token number&quot;&gt;10&lt;/span&gt; &lt;span class=&quot;token number&quot;&gt;10&lt;/span&gt;:49 &lt;span class=&quot;token punctuation&quot;&gt;..&lt;/span&gt;data -&lt;span class=&quot;token operator&quot;&gt;&gt;&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;..&lt;/span&gt;2022_10_10_10_49_22.2776941385
lrwxrwxrwx &lt;span class=&quot;token number&quot;&gt;1&lt;/span&gt; root root   &lt;span class=&quot;token number&quot;&gt;15&lt;/span&gt; Oct &lt;span class=&quot;token number&quot;&gt;10&lt;/span&gt; &lt;span class=&quot;token number&quot;&gt;10&lt;/span&gt;:49 username -&lt;span class=&quot;token operator&quot;&gt;&gt;&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;..&lt;/span&gt;data/username

&lt;span class=&quot;token comment&quot;&gt;# root에서 admin으로 변경됨&lt;/span&gt;
$ kubectl &lt;span class=&quot;token builtin class-name&quot;&gt;exec&lt;/span&gt; &lt;span class=&quot;token parameter variable&quot;&gt;-it&lt;/span&gt; sample-secret-multi-volume -- &lt;span class=&quot;token function&quot;&gt;cat&lt;/span&gt; /config/username
admin

&lt;span class=&quot;token comment&quot;&gt;# 동적으로 파일이 변경된 후의 경과 시간 확인&lt;/span&gt;
$ kubectl get pods sample-secret-multi-volume
NAME                         READY   STATUS    RESTARTS   AGE
sample-secret-multi-volume   &lt;span class=&quot;token number&quot;&gt;1&lt;/span&gt;/1     Running   &lt;span class=&quot;token number&quot;&gt;0&lt;/span&gt;          4m38s&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;h1&gt;7.4 컨피그맵&lt;/h1&gt;
&lt;p&gt;컨피그맵은 설정 정보 등을 키-밸류 값으로 저장할 수 있는 데이터 저장 리소스이다. 키-밸류 형식 외에도 nginx.conf나 httpd.conf 같은 설정 파일 자체도 저장할 수 있다.&lt;/p&gt;
&lt;h2&gt;7.4.1 컨피그맵 생성&lt;/h2&gt;
&lt;p&gt;컨피그맵은 Generic 타입의 시크릿과 거의 동일한 방법으로 생성된다.&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;kubectl로 파일에서 값을 참조하여 생성 (--from-file)&lt;/li&gt;
&lt;li&gt;kubectl로 직접 값을 전달하여 생성 (--from-literal)&lt;/li&gt;
&lt;li&gt;매니페스트로 생성 (-f)&lt;/li&gt;
&lt;/ul&gt;
&lt;h3&gt;kubectl로 파일에서 값을 참조하여 생성 (--from-file)&lt;/h3&gt;
&lt;p&gt;이 방식의 경우 일반적으로 파일명이 그대로 키가 된다. 키 이름을 변경하고 싶은 경우에는 &lt;code class=&quot;language-text&quot;&gt;--from-file=nginx.conf=sample-nginx.conf&lt;/code&gt; 등과 같이 지정하면 된다. 컨피그맵 매니페스트는 data가 아닌 binaryData 필드를 사용하여 UTF-8 이외의 데이터를 포함하는 바이너리 데이터를 저장할 수 있다. 쿠버네티스에 직접 등록하는 것이 아니라 매니페스트 파일로 저장하려면 &lt;code class=&quot;language-text&quot;&gt;--dry-run=client -o yaml&lt;/code&gt; 옵션을 사용한다.&lt;/p&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;sh&quot;&gt;&lt;pre class=&quot;language-sh&quot;&gt;&lt;code class=&quot;language-sh&quot;&gt;&lt;span class=&quot;token comment&quot;&gt;# 파일로 컨피그맵 생성&lt;/span&gt;
$ kubectl create configmap --save-config sample-configmap --from-file&lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt;./nginx.conf&lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt;sample-nginx.conf
configmap/sample-configmap created

&lt;span class=&quot;token comment&quot;&gt;# 컨피그맵에 등록된 데이터 확인&lt;/span&gt;
$ kubectl get configmaps sample-configmap &lt;span class=&quot;token parameter variable&quot;&gt;-o&lt;/span&gt; json &lt;span class=&quot;token operator&quot;&gt;|&lt;/span&gt; jq.data
&lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;
  &lt;span class=&quot;token string&quot;&gt;&quot;sample-nginx.conf&quot;&lt;/span&gt;&lt;span class=&quot;token builtin class-name&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;token string&quot;&gt;&quot;user  nginx;&lt;span class=&quot;token entity&quot; title=&quot;\n&quot;&gt;\n&lt;/span&gt;worker_processes  auto;&lt;span class=&quot;token entity&quot; title=&quot;\n&quot;&gt;\n&lt;/span&gt;error_log  /var/log/nginx/error.log warn;&lt;span class=&quot;token entity&quot; title=&quot;\n&quot;&gt;\n&lt;/span&gt;pid        /var/run/nginx.pid;&lt;span class=&quot;token entity&quot; title=&quot;\n&quot;&gt;\n&lt;/span&gt;&quot;&lt;/span&gt;
&lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;

&lt;span class=&quot;token comment&quot;&gt;# 컨피그맵에 등록된 데이터 확인 (describe)&lt;/span&gt;
$ kubectl describe configmaps sample-configmap
Name:         sample-configmap
Namespace:    default
Labels:       &lt;span class=&quot;token operator&quot;&gt;&amp;lt;&lt;/span&gt;none&lt;span class=&quot;token operator&quot;&gt;&gt;&lt;/span&gt;
Annotations:  &lt;span class=&quot;token operator&quot;&gt;&amp;lt;&lt;/span&gt;none&lt;span class=&quot;token operator&quot;&gt;&gt;&lt;/span&gt;

Data
&lt;span class=&quot;token operator&quot;&gt;==&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;==&lt;/span&gt;
sample-nginx.conf:
----
user  nginx&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;
worker_processes  auto&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;
error_log  /var/log/nginx/error.log warn&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;
pid        /var/run/nginx.pid&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;


BinaryData
&lt;span class=&quot;token operator&quot;&gt;==&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;==&lt;/span&gt;

Events:  &lt;span class=&quot;token operator&quot;&gt;&amp;lt;&lt;/span&gt;none&lt;span class=&quot;token operator&quot;&gt;&gt;&lt;/span&gt;

$ kubectl create configmap sample-configmap-binary &lt;span class=&quot;token punctuation&quot;&gt;\&lt;/span&gt;
--from-file image.jpg &lt;span class=&quot;token punctuation&quot;&gt;\&lt;/span&gt;
--from-literal&lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt;index.html&lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;token string&quot;&gt;&quot;Hello, Kubernetes&quot;&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;\&lt;/span&gt;
--dry-run&lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt;client &lt;span class=&quot;token parameter variable&quot;&gt;-o&lt;/span&gt; yaml &lt;span class=&quot;token punctuation&quot;&gt;\&lt;/span&gt;
&lt;span class=&quot;token operator&quot;&gt;&gt;&lt;/span&gt; sample-configmap-binary.yaml

$ &lt;span class=&quot;token function&quot;&gt;cat&lt;/span&gt; sample-configmap-binary.yaml
apiVersion: v1
binaryData:
  image.jpg: /9j/4AAQSk&lt;span class=&quot;token punctuation&quot;&gt;..&lt;/span&gt;.
data:
  index.html: Hello, Kubernetes
kind: ConfigMap
metadata:
  creationTimestamp: null
  name: sample-configmap-binary&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;컨피그맵에 저장된 컨텐츠를 웹 서버에서도 사용할 수 있다.&lt;/p&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;yaml&quot;&gt;&lt;pre class=&quot;language-yaml&quot;&gt;&lt;code class=&quot;language-yaml&quot;&gt;&lt;span class=&quot;token key atrule&quot;&gt;apiVersion&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt; v1
&lt;span class=&quot;token key atrule&quot;&gt;kind&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt; Pod
&lt;span class=&quot;token key atrule&quot;&gt;metadata&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt;
  &lt;span class=&quot;token key atrule&quot;&gt;name&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt; sample&lt;span class=&quot;token punctuation&quot;&gt;-&lt;/span&gt;configmap&lt;span class=&quot;token punctuation&quot;&gt;-&lt;/span&gt;binary&lt;span class=&quot;token punctuation&quot;&gt;-&lt;/span&gt;webserver
&lt;span class=&quot;token key atrule&quot;&gt;spec&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt;
  &lt;span class=&quot;token key atrule&quot;&gt;containers&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt;
  &lt;span class=&quot;token punctuation&quot;&gt;-&lt;/span&gt; &lt;span class=&quot;token key atrule&quot;&gt;name&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt; nginx&lt;span class=&quot;token punctuation&quot;&gt;-&lt;/span&gt;container
    &lt;span class=&quot;token key atrule&quot;&gt;image&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt; nginx&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt;&lt;span class=&quot;token number&quot;&gt;1.16&lt;/span&gt;
    &lt;span class=&quot;token key atrule&quot;&gt;volumeMounts&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt;
    &lt;span class=&quot;token punctuation&quot;&gt;-&lt;/span&gt; &lt;span class=&quot;token key atrule&quot;&gt;name&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt; config&lt;span class=&quot;token punctuation&quot;&gt;-&lt;/span&gt;volume
      &lt;span class=&quot;token key atrule&quot;&gt;mountPath&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt; /usr/share/nginx/html
  &lt;span class=&quot;token key atrule&quot;&gt;volumes&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt;
  &lt;span class=&quot;token punctuation&quot;&gt;-&lt;/span&gt; &lt;span class=&quot;token key atrule&quot;&gt;name&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt; config&lt;span class=&quot;token punctuation&quot;&gt;-&lt;/span&gt;volume
    &lt;span class=&quot;token key atrule&quot;&gt;configMap&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt;
      &lt;span class=&quot;token key atrule&quot;&gt;name&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt; sample&lt;span class=&quot;token punctuation&quot;&gt;-&lt;/span&gt;configmap&lt;span class=&quot;token punctuation&quot;&gt;-&lt;/span&gt;binary&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;sh&quot;&gt;&lt;pre class=&quot;language-sh&quot;&gt;&lt;code class=&quot;language-sh&quot;&gt;$ kubectl apply &lt;span class=&quot;token parameter variable&quot;&gt;-f&lt;/span&gt; sample-configmap-binary-webserver.yaml
pod/sample-configmap-binary-webserver created

&lt;span class=&quot;token comment&quot;&gt;# 로컬 머신 8080 포트에서 파드의 80번 포트로 포트 포워딩&lt;/span&gt;
$ kubectl port-forward sample-configmap-binary-webserver &lt;span class=&quot;token number&quot;&gt;8080&lt;/span&gt;:80
Forwarding from &lt;span class=&quot;token punctuation&quot;&gt;[&lt;/span&gt;::1&lt;span class=&quot;token punctuation&quot;&gt;]&lt;/span&gt;:8080 -&lt;span class=&quot;token operator&quot;&gt;&gt;&lt;/span&gt; &lt;span class=&quot;token number&quot;&gt;80&lt;/span&gt;

&lt;span class=&quot;token comment&quot;&gt;# 브라우저로 표시&lt;/span&gt;
$ &lt;span class=&quot;token function&quot;&gt;open&lt;/span&gt; http://localhost:8080/image.jpg&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;h3&gt;kubectl로 직접 값을 전달하여 생성(--from-literal)&lt;/h3&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;sh&quot;&gt;&lt;pre class=&quot;language-sh&quot;&gt;&lt;code class=&quot;language-sh&quot;&gt;$ kubectl create configmap --save-config web-config &lt;span class=&quot;token punctuation&quot;&gt;\&lt;/span&gt;
&lt;span class=&quot;token operator&quot;&gt;&gt;&lt;/span&gt; --from-literal&lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt;connection.max&lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;token number&quot;&gt;100&lt;/span&gt; --from-literal&lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt;connection.min&lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;token number&quot;&gt;10&lt;/span&gt;
configmap/web-config created&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;h3&gt;매니페스트로 생성(-f)&lt;/h3&gt;
&lt;p&gt;매니페스트로 생성할 경우 시크릿과 다르게 base64로 인코드되지 않고 추가된다. 밸류를 여러 행으로 전달하는 경우 YAML 문법 스타일에 맞춰 &lt;code class=&quot;language-text&quot;&gt;Key: |&lt;/code&gt;등과 같이 다음 행부터 정의한다. 그리고 숫자는 큰따옴표로 둘러싸도록 한다.&lt;/p&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;yaml&quot;&gt;&lt;pre class=&quot;language-yaml&quot;&gt;&lt;code class=&quot;language-yaml&quot;&gt;&lt;span class=&quot;token key atrule&quot;&gt;apiVersion&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt; v1
&lt;span class=&quot;token key atrule&quot;&gt;kind&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt; ConfigMap
&lt;span class=&quot;token key atrule&quot;&gt;metadata&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt;
  &lt;span class=&quot;token key atrule&quot;&gt;name&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt; sample&lt;span class=&quot;token punctuation&quot;&gt;-&lt;/span&gt;configmap
&lt;span class=&quot;token key atrule&quot;&gt;data&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt;
  &lt;span class=&quot;token key atrule&quot;&gt;thread&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;token string&quot;&gt;&quot;16&quot;&lt;/span&gt;
  &lt;span class=&quot;token key atrule&quot;&gt;connection.max&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;token string&quot;&gt;&quot;100&quot;&lt;/span&gt;
  &lt;span class=&quot;token key atrule&quot;&gt;connection.min&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;token string&quot;&gt;&quot;10&quot;&lt;/span&gt;
  &lt;span class=&quot;token key atrule&quot;&gt;sample.properties&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;|&lt;/span&gt;&lt;span class=&quot;token scalar string&quot;&gt;
    property.1=value-1
    property.2=value-2
    property.3=value-3&lt;/span&gt;
  &lt;span class=&quot;token key atrule&quot;&gt;nginx.conf&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;|&lt;/span&gt;&lt;span class=&quot;token scalar string&quot;&gt;
    user nginx;
    worker_processes auto;
    error_log /var/log/nginx/error.log;
    pid /run/nginx.pid;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;h2&gt;7.4.2 컨피그맵 사용&lt;/h2&gt;
&lt;p&gt;컨피그맵을 컨테이너에서 사용하는 경우 크게 두 가지 방법이 있다.&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;환경 변수로 전달: 컨피그맵의 특정 키만, 컨피그맵의 전체 키&lt;/li&gt;
&lt;li&gt;볼륨으로 마운트: 컨피그맵의 특정 키만, 컨피그맵의 전체 키&lt;/li&gt;
&lt;/ul&gt;
&lt;h3&gt;환경 변수로 전달&lt;/h3&gt;
&lt;p&gt;컨피그맵의 특정 키를 전달하는 경우 &lt;code class=&quot;language-text&quot;&gt;spec.containers[].env&lt;/code&gt;의 &lt;code class=&quot;language-text&quot;&gt;valueFrom.configMapKeyRef&lt;/code&gt;를 사용하여 지정한다.&lt;/p&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;yaml&quot;&gt;&lt;pre class=&quot;language-yaml&quot;&gt;&lt;code class=&quot;language-yaml&quot;&gt;&lt;span class=&quot;token key atrule&quot;&gt;apiVersion&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt; v1
&lt;span class=&quot;token key atrule&quot;&gt;kind&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt; Pod
&lt;span class=&quot;token key atrule&quot;&gt;metadata&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt;
  &lt;span class=&quot;token key atrule&quot;&gt;name&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt; sample&lt;span class=&quot;token punctuation&quot;&gt;-&lt;/span&gt;configmap&lt;span class=&quot;token punctuation&quot;&gt;-&lt;/span&gt;single&lt;span class=&quot;token punctuation&quot;&gt;-&lt;/span&gt;env
&lt;span class=&quot;token key atrule&quot;&gt;spec&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt;
  &lt;span class=&quot;token key atrule&quot;&gt;containers&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt;
    &lt;span class=&quot;token punctuation&quot;&gt;-&lt;/span&gt; &lt;span class=&quot;token key atrule&quot;&gt;name&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt; configmap&lt;span class=&quot;token punctuation&quot;&gt;-&lt;/span&gt;container
      &lt;span class=&quot;token key atrule&quot;&gt;image&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt; nginx&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt;&lt;span class=&quot;token number&quot;&gt;1.16&lt;/span&gt;
      &lt;span class=&quot;token key atrule&quot;&gt;env&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt;
        &lt;span class=&quot;token punctuation&quot;&gt;-&lt;/span&gt; &lt;span class=&quot;token key atrule&quot;&gt;name&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt; CONNECTION_MAX
          &lt;span class=&quot;token key atrule&quot;&gt;valueFrom&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt;
            &lt;span class=&quot;token key atrule&quot;&gt;configMapKeyRef&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt;
              &lt;span class=&quot;token key atrule&quot;&gt;name&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt; sample&lt;span class=&quot;token punctuation&quot;&gt;-&lt;/span&gt;configmap
              &lt;span class=&quot;token key atrule&quot;&gt;key&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt; connection.max&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;sh&quot;&gt;&lt;pre class=&quot;language-sh&quot;&gt;&lt;code class=&quot;language-sh&quot;&gt;&lt;span class=&quot;token comment&quot;&gt;# 파드의 CONNECTION_MAX 환경 변수 내용 확인&lt;/span&gt;
$ kubectl &lt;span class=&quot;token builtin class-name&quot;&gt;exec&lt;/span&gt; &lt;span class=&quot;token parameter variable&quot;&gt;-it&lt;/span&gt; sample-configmap-single-env -- &lt;span class=&quot;token function&quot;&gt;env&lt;/span&gt; &lt;span class=&quot;token operator&quot;&gt;|&lt;/span&gt; &lt;span class=&quot;token function&quot;&gt;grep&lt;/span&gt; CONNECTION_MAX
&lt;span class=&quot;token assign-left variable&quot;&gt;CONNECTION_MAX&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;token number&quot;&gt;100&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;컨피그맵 전체 키를 환경 변수로 전달하는 것도 가능하다. 키마다 각각의 env를 지정할 필요가 없다.&lt;/p&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;yaml&quot;&gt;&lt;pre class=&quot;language-yaml&quot;&gt;&lt;code class=&quot;language-yaml&quot;&gt;&lt;span class=&quot;token key atrule&quot;&gt;apiVersion&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt; v1
&lt;span class=&quot;token key atrule&quot;&gt;kind&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt; Pod
&lt;span class=&quot;token key atrule&quot;&gt;metadata&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt;
  &lt;span class=&quot;token key atrule&quot;&gt;name&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt; sample&lt;span class=&quot;token punctuation&quot;&gt;-&lt;/span&gt;configmap&lt;span class=&quot;token punctuation&quot;&gt;-&lt;/span&gt;multi&lt;span class=&quot;token punctuation&quot;&gt;-&lt;/span&gt;env
&lt;span class=&quot;token key atrule&quot;&gt;spec&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt;
  &lt;span class=&quot;token key atrule&quot;&gt;containers&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt;
    &lt;span class=&quot;token punctuation&quot;&gt;-&lt;/span&gt; &lt;span class=&quot;token key atrule&quot;&gt;name&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt; configmap&lt;span class=&quot;token punctuation&quot;&gt;-&lt;/span&gt;container
      &lt;span class=&quot;token key atrule&quot;&gt;image&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt; nginx&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt;&lt;span class=&quot;token number&quot;&gt;1.16&lt;/span&gt;
      &lt;span class=&quot;token key atrule&quot;&gt;envFrom&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt;
      &lt;span class=&quot;token punctuation&quot;&gt;-&lt;/span&gt; &lt;span class=&quot;token key atrule&quot;&gt;configMapRef&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt;
          &lt;span class=&quot;token key atrule&quot;&gt;name&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt; sample&lt;span class=&quot;token punctuation&quot;&gt;-&lt;/span&gt;configmap&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;h3&gt;볼륨으로 마운트&lt;/h3&gt;
&lt;p&gt;볼륨으로 마운트하는 경우도 특정 키만 마운트하거나 컨피그맵 전체를 마운트하는 두 가지 방법이 있다. 컨피그맵의 특정 키만 마운트할 경우에는 &lt;code class=&quot;language-text&quot;&gt;spec.volumes[]&lt;/code&gt;의 &lt;code class=&quot;language-text&quot;&gt;configMap.items[]&lt;/code&gt;를 사용하여 지정한다.&lt;/p&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;yaml&quot;&gt;&lt;pre class=&quot;language-yaml&quot;&gt;&lt;code class=&quot;language-yaml&quot;&gt;&lt;span class=&quot;token key atrule&quot;&gt;apiVersion&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt; v1
&lt;span class=&quot;token key atrule&quot;&gt;kind&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt; Pod
&lt;span class=&quot;token key atrule&quot;&gt;metadata&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt;
  &lt;span class=&quot;token key atrule&quot;&gt;name&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt; sample&lt;span class=&quot;token punctuation&quot;&gt;-&lt;/span&gt;configmap&lt;span class=&quot;token punctuation&quot;&gt;-&lt;/span&gt;single&lt;span class=&quot;token punctuation&quot;&gt;-&lt;/span&gt;volume
&lt;span class=&quot;token key atrule&quot;&gt;spec&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt;
  &lt;span class=&quot;token key atrule&quot;&gt;containers&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt;
    &lt;span class=&quot;token punctuation&quot;&gt;-&lt;/span&gt; &lt;span class=&quot;token key atrule&quot;&gt;name&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt; configmap&lt;span class=&quot;token punctuation&quot;&gt;-&lt;/span&gt;container
      &lt;span class=&quot;token key atrule&quot;&gt;image&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt; nginx&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt;&lt;span class=&quot;token number&quot;&gt;1.16&lt;/span&gt;
      &lt;span class=&quot;token key atrule&quot;&gt;volumeMounts&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt;
      &lt;span class=&quot;token punctuation&quot;&gt;-&lt;/span&gt; &lt;span class=&quot;token key atrule&quot;&gt;name&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt; config&lt;span class=&quot;token punctuation&quot;&gt;-&lt;/span&gt;volume
        &lt;span class=&quot;token key atrule&quot;&gt;mountPath&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt; /config
  &lt;span class=&quot;token key atrule&quot;&gt;volumes&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt;
    &lt;span class=&quot;token punctuation&quot;&gt;-&lt;/span&gt; &lt;span class=&quot;token key atrule&quot;&gt;name&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt; config&lt;span class=&quot;token punctuation&quot;&gt;-&lt;/span&gt;volume
      &lt;span class=&quot;token key atrule&quot;&gt;configMap&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt;
        &lt;span class=&quot;token key atrule&quot;&gt;name&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt; sample&lt;span class=&quot;token punctuation&quot;&gt;-&lt;/span&gt;configmap
        &lt;span class=&quot;token key atrule&quot;&gt;items&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt;
        &lt;span class=&quot;token punctuation&quot;&gt;-&lt;/span&gt; &lt;span class=&quot;token key atrule&quot;&gt;key&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt; nginx.conf
          &lt;span class=&quot;token key atrule&quot;&gt;path&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt; nginx&lt;span class=&quot;token punctuation&quot;&gt;-&lt;/span&gt;sample.conf&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;sh&quot;&gt;&lt;pre class=&quot;language-sh&quot;&gt;&lt;code class=&quot;language-sh&quot;&gt;&lt;span class=&quot;token comment&quot;&gt;# 파일로 저장된 컨피그맵 확인&lt;/span&gt;
$ kubectl &lt;span class=&quot;token builtin class-name&quot;&gt;exec&lt;/span&gt; &lt;span class=&quot;token parameter variable&quot;&gt;-it&lt;/span&gt; sample-configmap-single-volume -- &lt;span class=&quot;token function&quot;&gt;cat&lt;/span&gt; /config/nginx-sample.conf
user nginx&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;
worker_processes auto&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;
error_log /var/log/nginx/error.log&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;
pid /run/nginx.pid&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;컨피그맵 전체를 지정할 때는 아래와 같은 매니페스트를 사용한다.&lt;/p&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;yaml&quot;&gt;&lt;pre class=&quot;language-yaml&quot;&gt;&lt;code class=&quot;language-yaml&quot;&gt;&lt;span class=&quot;token key atrule&quot;&gt;apiVersion&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt; v1
&lt;span class=&quot;token key atrule&quot;&gt;kind&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt; Pod
&lt;span class=&quot;token key atrule&quot;&gt;metadata&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt;
  &lt;span class=&quot;token key atrule&quot;&gt;name&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt; sample&lt;span class=&quot;token punctuation&quot;&gt;-&lt;/span&gt;configmap&lt;span class=&quot;token punctuation&quot;&gt;-&lt;/span&gt;multi&lt;span class=&quot;token punctuation&quot;&gt;-&lt;/span&gt;volume
&lt;span class=&quot;token key atrule&quot;&gt;spec&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt;
  &lt;span class=&quot;token key atrule&quot;&gt;containers&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt;
    &lt;span class=&quot;token punctuation&quot;&gt;-&lt;/span&gt; &lt;span class=&quot;token key atrule&quot;&gt;name&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt; configmap&lt;span class=&quot;token punctuation&quot;&gt;-&lt;/span&gt;container
      &lt;span class=&quot;token key atrule&quot;&gt;image&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt; nginx&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt;&lt;span class=&quot;token number&quot;&gt;1.16&lt;/span&gt;
      &lt;span class=&quot;token key atrule&quot;&gt;volumeMounts&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt;
      &lt;span class=&quot;token punctuation&quot;&gt;-&lt;/span&gt; &lt;span class=&quot;token key atrule&quot;&gt;name&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt; config&lt;span class=&quot;token punctuation&quot;&gt;-&lt;/span&gt;volume
        &lt;span class=&quot;token key atrule&quot;&gt;mountPath&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt; /config
  &lt;span class=&quot;token key atrule&quot;&gt;volumes&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt;
    &lt;span class=&quot;token punctuation&quot;&gt;-&lt;/span&gt; &lt;span class=&quot;token key atrule&quot;&gt;name&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt; config&lt;span class=&quot;token punctuation&quot;&gt;-&lt;/span&gt;volume
      &lt;span class=&quot;token key atrule&quot;&gt;configMap&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt;
        &lt;span class=&quot;token key atrule&quot;&gt;name&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt; sample&lt;span class=&quot;token punctuation&quot;&gt;-&lt;/span&gt;configmap&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;h2&gt;7.4.3 시크릿과 컨피그맵&lt;/h2&gt;
&lt;h3&gt;시크릿과 컨피그맵 사용 구분&lt;/h3&gt;
&lt;p&gt;앞서 설명한 시크릿과 컨피그맵은 모두 설정 정보나 프리셋을 저장한다는 점에서 유사하지만, 시크릿은 기밀 정보를 취급하기 위한 리소스라는 차이점이 있다. 시크릿 데이터는 쿠버네티스 마스터가 사용하는 분산 KVS(Key-Value Store)의 etcd에 저장된다. 실제 시크릿을 사용하는 파드가 있을 경우에만 etcd에서 쿠버네티스 노드로 데이터를 보낸다. 이때 쿠버네티스 노드상에 영구적으로 데이터가 남지 않도록 하기 위해 시크릿 데이터는 메모리상에 구축된 임시 파일 시스템인 tmpfs 영역에 저장된다. 또한, 시크릿이 안전한 이유는 &lt;code class=&quot;language-text&quot;&gt;kubectl&lt;/code&gt; 명령어로 표시했을 때 값이 보기 어렵게 되어 있다는 점이다. 실제로 조회를 해보면 base64로 인코딩되어 사람이 바로 읽을 수 없게 되어 있다.&lt;/p&gt;
&lt;p&gt;매니페스트에 저장된 데이터는 base64로 인코드되어 있을 뿐이다. 따라서 그대로 깃 저장소에 업로드하는 것은 피하는 것이 좋다.&lt;/p&gt;
&lt;h3&gt;컨피그맵과 시크릿의 데이터 마운트 시 퍼미션 변경&lt;/h3&gt;
&lt;p&gt;컨피그맵에 저장된 스크립트를 파드에서 실행하는 경우 컨피그맵 데이터에서 볼륨을 생성할 때 실행 권한을 부여할 수 있다. 시크릿도 작성된 기밀 데이터를 파드에 마운트하는 경우 데이터에서 볼륨을 생성할 때 퍼미션을 부여할 수 있다. 둘 다 기본 값 0644(rw-r--r--)로 마운트된다. 퍼미션은 8진수 표기에서 10진수 표기로 기술해야 한다.&lt;/p&gt;
&lt;table&gt;
&lt;thead&gt;
&lt;tr&gt;
&lt;th&gt;10진수 표기&lt;/th&gt;
&lt;th&gt;8진수 표기&lt;/th&gt;
&lt;th&gt;raw 표기&lt;/th&gt;
&lt;/tr&gt;
&lt;/thead&gt;
&lt;tbody&gt;
&lt;tr&gt;
&lt;td&gt;256&lt;/td&gt;
&lt;td&gt;0400&lt;/td&gt;
&lt;td&gt;r--------&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;384&lt;/td&gt;
&lt;td&gt;0600&lt;/td&gt;
&lt;td&gt;rw-------&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;420&lt;/td&gt;
&lt;td&gt;0644&lt;/td&gt;
&lt;td&gt;rw-r--r--&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;448&lt;/td&gt;
&lt;td&gt;0700&lt;/td&gt;
&lt;td&gt;rwx------&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;493&lt;/td&gt;
&lt;td&gt;0755&lt;/td&gt;
&lt;td&gt;rwxr-xr-x&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;511&lt;/td&gt;
&lt;td&gt;0777&lt;/td&gt;
&lt;td&gt;rwxrwxrwx&lt;/td&gt;
&lt;/tr&gt;
&lt;/tbody&gt;
&lt;/table&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;yaml&quot;&gt;&lt;pre class=&quot;language-yaml&quot;&gt;&lt;code class=&quot;language-yaml&quot;&gt;&lt;span class=&quot;token key atrule&quot;&gt;apiVersion&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt; v1
&lt;span class=&quot;token key atrule&quot;&gt;kind&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt; Pod
&lt;span class=&quot;token key atrule&quot;&gt;metadata&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt;
  &lt;span class=&quot;token key atrule&quot;&gt;name&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt; sample&lt;span class=&quot;token punctuation&quot;&gt;-&lt;/span&gt;configmap&lt;span class=&quot;token punctuation&quot;&gt;-&lt;/span&gt;scripts
&lt;span class=&quot;token key atrule&quot;&gt;spec&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt;
  &lt;span class=&quot;token key atrule&quot;&gt;containers&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt;
  &lt;span class=&quot;token punctuation&quot;&gt;-&lt;/span&gt; &lt;span class=&quot;token key atrule&quot;&gt;name&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt; configmap&lt;span class=&quot;token punctuation&quot;&gt;-&lt;/span&gt;container
    &lt;span class=&quot;token key atrule&quot;&gt;image&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt; nginx&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt;&lt;span class=&quot;token number&quot;&gt;1.16&lt;/span&gt;
    &lt;span class=&quot;token key atrule&quot;&gt;command&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;[&lt;/span&gt;&lt;span class=&quot;token string&quot;&gt;&quot;/config/test.sh&quot;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;]&lt;/span&gt;
    &lt;span class=&quot;token key atrule&quot;&gt;volumeMounts&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt;
    &lt;span class=&quot;token punctuation&quot;&gt;-&lt;/span&gt; &lt;span class=&quot;token key atrule&quot;&gt;name&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt; config&lt;span class=&quot;token punctuation&quot;&gt;-&lt;/span&gt;volume
      &lt;span class=&quot;token key atrule&quot;&gt;mountPath&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt; /config
  &lt;span class=&quot;token key atrule&quot;&gt;volumes&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt;
  &lt;span class=&quot;token punctuation&quot;&gt;-&lt;/span&gt; &lt;span class=&quot;token key atrule&quot;&gt;name&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt; config&lt;span class=&quot;token punctuation&quot;&gt;-&lt;/span&gt;volume
    &lt;span class=&quot;token key atrule&quot;&gt;configMap&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt;
      &lt;span class=&quot;token key atrule&quot;&gt;name&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt; sample&lt;span class=&quot;token punctuation&quot;&gt;-&lt;/span&gt;configmap
      &lt;span class=&quot;token key atrule&quot;&gt;items&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt;
      &lt;span class=&quot;token punctuation&quot;&gt;-&lt;/span&gt; &lt;span class=&quot;token key atrule&quot;&gt;key&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt; test.sh
        &lt;span class=&quot;token key atrule&quot;&gt;path&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt; test.sh
        &lt;span class=&quot;token key atrule&quot;&gt;mode&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;token number&quot;&gt;493&lt;/span&gt; &lt;span class=&quot;token comment&quot;&gt;# 0755&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;sh&quot;&gt;&lt;pre class=&quot;language-sh&quot;&gt;&lt;code class=&quot;language-sh&quot;&gt;$ kubectl apply &lt;span class=&quot;token parameter variable&quot;&gt;-f&lt;/span&gt; sample-configmap-scripts.yaml
pod/sample-configmap-scripts created

$ kubectl logs sample-configmap-scripts
Hello, Kubernetes&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;아래 매니페스트에서는 시크릿 내부의 모든 데이터를 0400으로 마운트한다.&lt;/p&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;yaml&quot;&gt;&lt;pre class=&quot;language-yaml&quot;&gt;&lt;code class=&quot;language-yaml&quot;&gt;&lt;span class=&quot;token key atrule&quot;&gt;apiVersion&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt; v1
&lt;span class=&quot;token key atrule&quot;&gt;kind&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt; Pod
&lt;span class=&quot;token key atrule&quot;&gt;metadata&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt;
  &lt;span class=&quot;token key atrule&quot;&gt;name&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt; sample&lt;span class=&quot;token punctuation&quot;&gt;-&lt;/span&gt;secret&lt;span class=&quot;token punctuation&quot;&gt;-&lt;/span&gt;secure
&lt;span class=&quot;token key atrule&quot;&gt;spec&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt;
  &lt;span class=&quot;token key atrule&quot;&gt;containers&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt;
  &lt;span class=&quot;token punctuation&quot;&gt;-&lt;/span&gt; &lt;span class=&quot;token key atrule&quot;&gt;name&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt; secret&lt;span class=&quot;token punctuation&quot;&gt;-&lt;/span&gt;container
    &lt;span class=&quot;token key atrule&quot;&gt;image&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt; nginx&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt;&lt;span class=&quot;token number&quot;&gt;1.16&lt;/span&gt;
    &lt;span class=&quot;token key atrule&quot;&gt;volumeMounts&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt;
    &lt;span class=&quot;token punctuation&quot;&gt;-&lt;/span&gt; &lt;span class=&quot;token key atrule&quot;&gt;name&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt; config&lt;span class=&quot;token punctuation&quot;&gt;-&lt;/span&gt;volume
      &lt;span class=&quot;token key atrule&quot;&gt;mountPath&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt; /config
  &lt;span class=&quot;token key atrule&quot;&gt;volumes&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt;
  &lt;span class=&quot;token punctuation&quot;&gt;-&lt;/span&gt; &lt;span class=&quot;token key atrule&quot;&gt;name&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt; config&lt;span class=&quot;token punctuation&quot;&gt;-&lt;/span&gt;volume
    &lt;span class=&quot;token key atrule&quot;&gt;secret&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt;
      &lt;span class=&quot;token key atrule&quot;&gt;secretName&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt; sample&lt;span class=&quot;token punctuation&quot;&gt;-&lt;/span&gt;db&lt;span class=&quot;token punctuation&quot;&gt;-&lt;/span&gt;auth
      &lt;span class=&quot;token key atrule&quot;&gt;defaultMode&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;token number&quot;&gt;256&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;sh&quot;&gt;&lt;pre class=&quot;language-sh&quot;&gt;&lt;code class=&quot;language-sh&quot;&gt;$ kubectl &lt;span class=&quot;token builtin class-name&quot;&gt;exec&lt;/span&gt; &lt;span class=&quot;token parameter variable&quot;&gt;-it&lt;/span&gt; sample-secret-secure -- &lt;span class=&quot;token function&quot;&gt;ls&lt;/span&gt; &lt;span class=&quot;token parameter variable&quot;&gt;-l&lt;/span&gt; /config
total &lt;span class=&quot;token number&quot;&gt;0&lt;/span&gt;
lrwxrwxrwx &lt;span class=&quot;token number&quot;&gt;1&lt;/span&gt; root root &lt;span class=&quot;token number&quot;&gt;15&lt;/span&gt; Oct &lt;span class=&quot;token number&quot;&gt;16&lt;/span&gt; 08:57 password -&lt;span class=&quot;token operator&quot;&gt;&gt;&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;..&lt;/span&gt;data/password
lrwxrwxrwx &lt;span class=&quot;token number&quot;&gt;1&lt;/span&gt; root root &lt;span class=&quot;token number&quot;&gt;15&lt;/span&gt; Oct &lt;span class=&quot;token number&quot;&gt;16&lt;/span&gt; 08:57 username -&lt;span class=&quot;token operator&quot;&gt;&gt;&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;..&lt;/span&gt;data/username

$ kubectl &lt;span class=&quot;token builtin class-name&quot;&gt;exec&lt;/span&gt; &lt;span class=&quot;token parameter variable&quot;&gt;-it&lt;/span&gt; sample-secret-secure -- &lt;span class=&quot;token function&quot;&gt;ls&lt;/span&gt; &lt;span class=&quot;token parameter variable&quot;&gt;-l&lt;/span&gt; /config/&lt;span class=&quot;token punctuation&quot;&gt;..&lt;/span&gt;data/
total &lt;span class=&quot;token number&quot;&gt;8&lt;/span&gt;
-r-------- &lt;span class=&quot;token number&quot;&gt;1&lt;/span&gt; root root &lt;span class=&quot;token number&quot;&gt;12&lt;/span&gt; Oct &lt;span class=&quot;token number&quot;&gt;16&lt;/span&gt; 08:57 password
-r-------- &lt;span class=&quot;token number&quot;&gt;1&lt;/span&gt; root root  &lt;span class=&quot;token number&quot;&gt;4&lt;/span&gt; Oct &lt;span class=&quot;token number&quot;&gt;16&lt;/span&gt; 08:57 username&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;h3&gt;동적 컨피그맵 업데이트&lt;/h3&gt;
&lt;p&gt;볼륨 마운트를 사용한 컨피그맵에서는 일정 시간마다 kubeapiserver로 변경을 확인하고 변경이 있을 경우 파일을 교체한다. 기본 업데이트 간격은 60초로 설정되어 있다. 이 간격을 조정하기 위해서는 kubelet의 &lt;code class=&quot;language-text&quot;&gt;--sync-frequency&lt;/code&gt; 옵션을 설정한다. 한편 환경 변수를 사용한 컨피그맵은 기동할 때 환경 변수가 정해지기 때문에 동적으로 업데이트를 할 수 없다. 따라서 4장에서 설명한 &lt;code class=&quot;language-text&quot;&gt;kubectl rollout restart&lt;/code&gt; 명령어를 사용하여 파드를 재기동한다.&lt;/p&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;sh&quot;&gt;&lt;pre class=&quot;language-sh&quot;&gt;&lt;code class=&quot;language-sh&quot;&gt;&lt;span class=&quot;token comment&quot;&gt;# 컨피그맵이 마운트되어 있는 디렉터리 확인&lt;/span&gt;
$ kubectl &lt;span class=&quot;token builtin class-name&quot;&gt;exec&lt;/span&gt; &lt;span class=&quot;token parameter variable&quot;&gt;-it&lt;/span&gt; sample-configmap-multi-volume -- &lt;span class=&quot;token function&quot;&gt;ls&lt;/span&gt; &lt;span class=&quot;token parameter variable&quot;&gt;-al&lt;/span&gt; /config
total &lt;span class=&quot;token number&quot;&gt;12&lt;/span&gt;
drwxrwxrwx &lt;span class=&quot;token number&quot;&gt;3&lt;/span&gt; root root &lt;span class=&quot;token number&quot;&gt;4096&lt;/span&gt; Oct &lt;span class=&quot;token number&quot;&gt;16&lt;/span&gt; 09:01 &lt;span class=&quot;token builtin class-name&quot;&gt;.&lt;/span&gt;
drwxr-xr-x &lt;span class=&quot;token number&quot;&gt;1&lt;/span&gt; root root &lt;span class=&quot;token number&quot;&gt;4096&lt;/span&gt; Oct &lt;span class=&quot;token number&quot;&gt;16&lt;/span&gt; 09:01 &lt;span class=&quot;token punctuation&quot;&gt;..&lt;/span&gt;
drwxr-xr-x &lt;span class=&quot;token number&quot;&gt;2&lt;/span&gt; root root &lt;span class=&quot;token number&quot;&gt;4096&lt;/span&gt; Oct &lt;span class=&quot;token number&quot;&gt;16&lt;/span&gt; 09:01 &lt;span class=&quot;token punctuation&quot;&gt;..&lt;/span&gt;2022_10_16_09_01_08.2265248405
lrwxrwxrwx &lt;span class=&quot;token number&quot;&gt;1&lt;/span&gt; root root   &lt;span class=&quot;token number&quot;&gt;32&lt;/span&gt; Oct &lt;span class=&quot;token number&quot;&gt;16&lt;/span&gt; 09:01 &lt;span class=&quot;token punctuation&quot;&gt;..&lt;/span&gt;data -&lt;span class=&quot;token operator&quot;&gt;&gt;&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;..&lt;/span&gt;2022_10_16_09_01_08.2265248405
lrwxrwxrwx &lt;span class=&quot;token number&quot;&gt;1&lt;/span&gt; root root   &lt;span class=&quot;token number&quot;&gt;21&lt;/span&gt; Oct &lt;span class=&quot;token number&quot;&gt;16&lt;/span&gt; 09:01 connection.max -&lt;span class=&quot;token operator&quot;&gt;&gt;&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;..&lt;/span&gt;data/connection.max
lrwxrwxrwx &lt;span class=&quot;token number&quot;&gt;1&lt;/span&gt; root root   &lt;span class=&quot;token number&quot;&gt;21&lt;/span&gt; Oct &lt;span class=&quot;token number&quot;&gt;16&lt;/span&gt; 09:01 connection.min -&lt;span class=&quot;token operator&quot;&gt;&gt;&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;..&lt;/span&gt;data/connection.min
lrwxrwxrwx &lt;span class=&quot;token number&quot;&gt;1&lt;/span&gt; root root   &lt;span class=&quot;token number&quot;&gt;17&lt;/span&gt; Oct &lt;span class=&quot;token number&quot;&gt;16&lt;/span&gt; 09:01 nginx.conf -&lt;span class=&quot;token operator&quot;&gt;&gt;&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;..&lt;/span&gt;data/nginx.conf
lrwxrwxrwx &lt;span class=&quot;token number&quot;&gt;1&lt;/span&gt; root root   &lt;span class=&quot;token number&quot;&gt;24&lt;/span&gt; Oct &lt;span class=&quot;token number&quot;&gt;16&lt;/span&gt; 09:01 sample.properties -&lt;span class=&quot;token operator&quot;&gt;&gt;&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;..&lt;/span&gt;data/sample.properties
lrwxrwxrwx &lt;span class=&quot;token number&quot;&gt;1&lt;/span&gt; root root   &lt;span class=&quot;token number&quot;&gt;14&lt;/span&gt; Oct &lt;span class=&quot;token number&quot;&gt;16&lt;/span&gt; 09:01 test.sh -&lt;span class=&quot;token operator&quot;&gt;&gt;&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;..&lt;/span&gt;data/test.sh
lrwxrwxrwx &lt;span class=&quot;token number&quot;&gt;1&lt;/span&gt; root root   &lt;span class=&quot;token number&quot;&gt;13&lt;/span&gt; Oct &lt;span class=&quot;token number&quot;&gt;16&lt;/span&gt; 09:01 thread -&lt;span class=&quot;token operator&quot;&gt;&gt;&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;..&lt;/span&gt;data/thread

&lt;span class=&quot;token comment&quot;&gt;# 파드의 /config/thread 파일 내용 확인&lt;/span&gt;
$ kubectl &lt;span class=&quot;token builtin class-name&quot;&gt;exec&lt;/span&gt; &lt;span class=&quot;token parameter variable&quot;&gt;-it&lt;/span&gt; sample-configmap-multi-volume -- &lt;span class=&quot;token function&quot;&gt;cat&lt;/span&gt; /config/thread
&lt;span class=&quot;token number&quot;&gt;16&lt;/span&gt;

&lt;span class=&quot;token comment&quot;&gt;# 컨피그맵 변경 전의 경과 시간(AGE)확인&lt;/span&gt;
$ kubectl get pods sample-configmap-multi-volume
NAME                            READY   STATUS    RESTARTS   AGE
sample-configmap-multi-volume   &lt;span class=&quot;token number&quot;&gt;1&lt;/span&gt;/1     Running   &lt;span class=&quot;token number&quot;&gt;0&lt;/span&gt;          88s

&lt;span class=&quot;token comment&quot;&gt;# 컨피그맵 업데이트&lt;/span&gt;
$ &lt;span class=&quot;token function&quot;&gt;cat&lt;/span&gt; &lt;span class=&quot;token operator&quot;&gt;&amp;lt;&amp;lt;&lt;/span&gt; &lt;span class=&quot;token string&quot;&gt;EOF&lt;span class=&quot;token bash punctuation&quot;&gt; &lt;span class=&quot;token operator&quot;&gt;|&lt;/span&gt; kubectl apply &lt;span class=&quot;token parameter variable&quot;&gt;-f&lt;/span&gt; -&lt;/span&gt;
apiVersion: v1
kind: ConfigMap
metadata:
  name: sample-configmap
data:
  thread: &quot;32&quot;
EOF&lt;/span&gt;
configmap/sample-configmap configured

&lt;span class=&quot;token comment&quot;&gt;# 컨피그맵이 마운트되어 있는 디렉터리 확인&lt;/span&gt;
$ kubectl &lt;span class=&quot;token builtin class-name&quot;&gt;exec&lt;/span&gt; &lt;span class=&quot;token parameter variable&quot;&gt;-it&lt;/span&gt; sample-configmap-multi-volume -- &lt;span class=&quot;token function&quot;&gt;ls&lt;/span&gt; &lt;span class=&quot;token parameter variable&quot;&gt;-al&lt;/span&gt; /config
total &lt;span class=&quot;token number&quot;&gt;12&lt;/span&gt;
drwxrwxrwx &lt;span class=&quot;token number&quot;&gt;3&lt;/span&gt; root root &lt;span class=&quot;token number&quot;&gt;4096&lt;/span&gt; Oct &lt;span class=&quot;token number&quot;&gt;16&lt;/span&gt; 09:01 &lt;span class=&quot;token builtin class-name&quot;&gt;.&lt;/span&gt;
drwxr-xr-x &lt;span class=&quot;token number&quot;&gt;1&lt;/span&gt; root root &lt;span class=&quot;token number&quot;&gt;4096&lt;/span&gt; Oct &lt;span class=&quot;token number&quot;&gt;16&lt;/span&gt; 09:01 &lt;span class=&quot;token punctuation&quot;&gt;..&lt;/span&gt;
drwxr-xr-x &lt;span class=&quot;token number&quot;&gt;2&lt;/span&gt; root root &lt;span class=&quot;token number&quot;&gt;4096&lt;/span&gt; Oct &lt;span class=&quot;token number&quot;&gt;16&lt;/span&gt; 09:01 &lt;span class=&quot;token punctuation&quot;&gt;..&lt;/span&gt;2022_10_16_09_01_08.2265248405
lrwxrwxrwx &lt;span class=&quot;token number&quot;&gt;1&lt;/span&gt; root root   &lt;span class=&quot;token number&quot;&gt;32&lt;/span&gt; Oct &lt;span class=&quot;token number&quot;&gt;16&lt;/span&gt; 09:01 &lt;span class=&quot;token punctuation&quot;&gt;..&lt;/span&gt;data -&lt;span class=&quot;token operator&quot;&gt;&gt;&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;..&lt;/span&gt;2022_10_16_09_01_08.2265248405
lrwxrwxrwx &lt;span class=&quot;token number&quot;&gt;1&lt;/span&gt; root root   &lt;span class=&quot;token number&quot;&gt;21&lt;/span&gt; Oct &lt;span class=&quot;token number&quot;&gt;16&lt;/span&gt; 09:01 connection.max -&lt;span class=&quot;token operator&quot;&gt;&gt;&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;..&lt;/span&gt;data/connection.max
lrwxrwxrwx &lt;span class=&quot;token number&quot;&gt;1&lt;/span&gt; root root   &lt;span class=&quot;token number&quot;&gt;21&lt;/span&gt; Oct &lt;span class=&quot;token number&quot;&gt;16&lt;/span&gt; 09:01 connection.min -&lt;span class=&quot;token operator&quot;&gt;&gt;&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;..&lt;/span&gt;data/connection.min
lrwxrwxrwx &lt;span class=&quot;token number&quot;&gt;1&lt;/span&gt; root root   &lt;span class=&quot;token number&quot;&gt;17&lt;/span&gt; Oct &lt;span class=&quot;token number&quot;&gt;16&lt;/span&gt; 09:01 nginx.conf -&lt;span class=&quot;token operator&quot;&gt;&gt;&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;..&lt;/span&gt;data/nginx.conf
lrwxrwxrwx &lt;span class=&quot;token number&quot;&gt;1&lt;/span&gt; root root   &lt;span class=&quot;token number&quot;&gt;24&lt;/span&gt; Oct &lt;span class=&quot;token number&quot;&gt;16&lt;/span&gt; 09:01 sample.properties -&lt;span class=&quot;token operator&quot;&gt;&gt;&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;..&lt;/span&gt;data/sample.properties
lrwxrwxrwx &lt;span class=&quot;token number&quot;&gt;1&lt;/span&gt; root root   &lt;span class=&quot;token number&quot;&gt;14&lt;/span&gt; Oct &lt;span class=&quot;token number&quot;&gt;16&lt;/span&gt; 09:01 test.sh -&lt;span class=&quot;token operator&quot;&gt;&gt;&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;..&lt;/span&gt;data/test.sh
lrwxrwxrwx &lt;span class=&quot;token number&quot;&gt;1&lt;/span&gt; root root   &lt;span class=&quot;token number&quot;&gt;13&lt;/span&gt; Oct &lt;span class=&quot;token number&quot;&gt;16&lt;/span&gt; 09:01 thread -&lt;span class=&quot;token operator&quot;&gt;&gt;&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;..&lt;/span&gt;data/thread

&lt;span class=&quot;token comment&quot;&gt;# 변경된 내용 확인&lt;/span&gt;
$ kubectl &lt;span class=&quot;token builtin class-name&quot;&gt;exec&lt;/span&gt; &lt;span class=&quot;token parameter variable&quot;&gt;-it&lt;/span&gt; sample-configmap-multi-volume -- &lt;span class=&quot;token function&quot;&gt;cat&lt;/span&gt; /config/thread
&lt;span class=&quot;token number&quot;&gt;32&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;h3&gt;시크릿이나 컨피그맵의 데이터 변경 거부&lt;/h3&gt;
&lt;p&gt;시크릿이나 컨피그맵은 여러 디플로이먼트 등에서 참조되는 경우가 많고, 변경하게 되면 여러 애플리케이션에 영향을 준다. 시크릿이나 컨피그맵의 &lt;code class=&quot;language-text&quot;&gt;immutable&lt;/code&gt;설정을 변경하면 데이터가 변경되는 것을 방지하고 예상치 못한 시스템 변경도 방지할 수 있다. 변경이 거부된 시크릿이나 컨피그맵의 데이터를 변경하는 경우에는 리소스를 한 번 삭제하고 다시 생성하면 된다. 또, 볼륨으로 마운트하고 있는 경우 파드 재생성이 필요하다. 또한, 설정값 자체를 false로 변경하는 것도 불가능하다.&lt;/p&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;yaml&quot;&gt;&lt;pre class=&quot;language-yaml&quot;&gt;&lt;code class=&quot;language-yaml&quot;&gt;&lt;span class=&quot;token key atrule&quot;&gt;apiVersion&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt; v1
&lt;span class=&quot;token key atrule&quot;&gt;kind&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt; Secret
&lt;span class=&quot;token key atrule&quot;&gt;metadata&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt;
  &lt;span class=&quot;token key atrule&quot;&gt;name&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt; sample&lt;span class=&quot;token punctuation&quot;&gt;-&lt;/span&gt;secret&lt;span class=&quot;token punctuation&quot;&gt;-&lt;/span&gt;immutable
&lt;span class=&quot;token key atrule&quot;&gt;type&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt; Opaque
&lt;span class=&quot;token key atrule&quot;&gt;data&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt;
  &lt;span class=&quot;token key atrule&quot;&gt;username&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt; cm9vdA== &lt;span class=&quot;token comment&quot;&gt;# root&lt;/span&gt;
  &lt;span class=&quot;token key atrule&quot;&gt;password&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt; cm9vdHBhc3N3b3Jk &lt;span class=&quot;token comment&quot;&gt;# rootpassword&lt;/span&gt;
&lt;span class=&quot;token key atrule&quot;&gt;immutable&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;token boolean important&quot;&gt;true&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;sh&quot;&gt;&lt;pre class=&quot;language-sh&quot;&gt;&lt;code class=&quot;language-sh&quot;&gt;$ kubectl patch secret sample-secret-immutable &lt;span class=&quot;token parameter variable&quot;&gt;-p&lt;/span&gt; &lt;span class=&quot;token string&quot;&gt;&apos;{&quot;data&quot;: {&quot;username&quot;: &quot;a69nZQ==&quot;}}&apos;&lt;/span&gt;
The Secret &lt;span class=&quot;token string&quot;&gt;&quot;sample-secret-immutable&quot;&lt;/span&gt; is invalid: data: Forbidden: field is immutable when &lt;span class=&quot;token variable&quot;&gt;&lt;span class=&quot;token variable&quot;&gt;`&lt;/span&gt;immutable&lt;span class=&quot;token variable&quot;&gt;`&lt;/span&gt;&lt;/span&gt; is &lt;span class=&quot;token builtin class-name&quot;&gt;set&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;</content:encoded></item><item><title><![CDATA[[쿠버네티스 완벽 가이드] 14. 서비스 API 카테고리 (3) - 헤드리스, ExternalName, None-Selector, 인그레스]]></title><description><![CDATA[6.8 헤드리스 서비스(None) 헤드리스(Headless) 서비스는 대상이 되는 개별 파드의 IP주소가 직접 반환되는 서비스이다. 지금까지 소개한 다른 서비스에서 부하 분산을 위해 제고오디는 엔드포인트는 가상 IP…]]></description><link>https://github.com/SiverPineValley/SiverPineValley.github.io/kubernetes/kubernetes_6_3/</link><guid isPermaLink="false">https://github.com/SiverPineValley/SiverPineValley.github.io/kubernetes/kubernetes_6_3/</guid><pubDate>Sun, 18 Sep 2022 18:00:00 GMT</pubDate><content:encoded>&lt;h1&gt;6.8 헤드리스 서비스(None)&lt;/h1&gt;
&lt;p&gt;헤드리스(Headless) 서비스는 대상이 되는 개별 파드의 IP주소가 직접 반환되는 서비스이다. 지금까지 소개한 다른 서비스에서 부하 분산을 위해 제고오디는 엔드포인트는 가상 IP로 로드 밸런싱 동작을 하기 위해 여러 파드로 전송되는 IP 엔드포인트였다면, 헤드리스 서비스는 로드 밸런싱을 하기 위한 IP 주소는 제공되지 않고 DNS 라운드 로빈을 사용한 엔드포인트를 제공한다. 헤드리스 서비스의 DNS 라운드 로빈에서는 목적지 파드 IP 주소가 클러스터 내부 DNS에서 반환되는 형태로 부하 분산을 하기 때문에 클라이언트 DNS 캐시에 주의해야 한다. 또한, 스테이트풀셋이 헤드리스 서비스를 사용하는 경우에만 파드명으로 IP 주소를 디스커버리할 수 있다. 즉, sample-statefulset-0 등의 파드명으로 IP 주소를 가져올 수 있다.&lt;/p&gt;
&lt;table&gt;
&lt;thead&gt;
&lt;tr&gt;
&lt;th&gt;서비스 종류&lt;/th&gt;
&lt;th&gt;IP 엔드포인트 내용&lt;/th&gt;
&lt;/tr&gt;
&lt;/thead&gt;
&lt;tbody&gt;
&lt;tr&gt;
&lt;td&gt;ClusterIP&lt;/td&gt;
&lt;td&gt;쿠버네티스 클러스터 내부에서만 통신이 가능한 가상 IP&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;ExternalIP&lt;/td&gt;
&lt;td&gt;특정 쿠버네티스 노드의 IP&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;NodePort&lt;/td&gt;
&lt;td&gt;모든 쿠버네티스 노드의 모든 IP 주소 (0.0.0.0)&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;ClusterIP&lt;/td&gt;
&lt;td&gt;클러스터 외부에서 제공되는 로드 밸런서의 가상 IP&lt;/td&gt;
&lt;/tr&gt;
&lt;/tbody&gt;
&lt;/table&gt;
&lt;h2&gt;6.8.1 헤드리스 서비스 생성&lt;/h2&gt;
&lt;p&gt;헤드리스 서비스를 생성하려면 다음 두 가지 조건을 만족해야 한다. 또, 스테이트풀셋과 조합하여 사용하는 경우 특정 조건에서 파드명으로 이름을 해석할 수 있다.&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;서비스의 &lt;code class=&quot;language-text&quot;&gt;spec.type&lt;/code&gt;이 &lt;code class=&quot;language-text&quot;&gt;ClusterIP&lt;/code&gt;일 것&lt;/li&gt;
&lt;li&gt;서비스의 &lt;code class=&quot;language-text&quot;&gt;spec.clusterIP&lt;/code&gt;가 &lt;code class=&quot;language-text&quot;&gt;None&lt;/code&gt;일 것&lt;/li&gt;
&lt;li&gt;[옵션] 서비스의 &lt;code class=&quot;language-text&quot;&gt;metadata.name&lt;/code&gt;이 스테이트풀셋의 &lt;code class=&quot;language-text&quot;&gt;spec.serviceName&lt;/code&gt;과 같을 것&lt;/li&gt;
&lt;/ul&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;yaml&quot;&gt;&lt;pre class=&quot;language-yaml&quot;&gt;&lt;code class=&quot;language-yaml&quot;&gt;&lt;span class=&quot;token punctuation&quot;&gt;---&lt;/span&gt;
&lt;span class=&quot;token key atrule&quot;&gt;apiVersion&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt; v1
&lt;span class=&quot;token key atrule&quot;&gt;kind&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt; Service
&lt;span class=&quot;token key atrule&quot;&gt;metadata&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt;
  &lt;span class=&quot;token key atrule&quot;&gt;name&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt; sample&lt;span class=&quot;token punctuation&quot;&gt;-&lt;/span&gt;headless
&lt;span class=&quot;token key atrule&quot;&gt;spec&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt;
  &lt;span class=&quot;token key atrule&quot;&gt;type&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt; ClusterIP
  &lt;span class=&quot;token key atrule&quot;&gt;clusterIP&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt; None
  &lt;span class=&quot;token key atrule&quot;&gt;ports&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt;
    &lt;span class=&quot;token punctuation&quot;&gt;-&lt;/span&gt; &lt;span class=&quot;token key atrule&quot;&gt;name&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;token string&quot;&gt;&quot;http-port&quot;&lt;/span&gt;
      &lt;span class=&quot;token key atrule&quot;&gt;protocol&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;token string&quot;&gt;&quot;TCP&quot;&lt;/span&gt;
      &lt;span class=&quot;token key atrule&quot;&gt;port&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;token number&quot;&gt;80&lt;/span&gt;
      &lt;span class=&quot;token key atrule&quot;&gt;targetPort&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;token number&quot;&gt;80&lt;/span&gt;
  &lt;span class=&quot;token key atrule&quot;&gt;selector&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt;
    &lt;span class=&quot;token key atrule&quot;&gt;app&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt; sample&lt;span class=&quot;token punctuation&quot;&gt;-&lt;/span&gt;app
&lt;span class=&quot;token punctuation&quot;&gt;---&lt;/span&gt;
&lt;span class=&quot;token key atrule&quot;&gt;apiVersion&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt; apps/v1
&lt;span class=&quot;token key atrule&quot;&gt;kind&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt; StatefulSet
&lt;span class=&quot;token key atrule&quot;&gt;metadata&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt;
  &lt;span class=&quot;token key atrule&quot;&gt;name&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt; sample&lt;span class=&quot;token punctuation&quot;&gt;-&lt;/span&gt;statefulset&lt;span class=&quot;token punctuation&quot;&gt;-&lt;/span&gt;headless
&lt;span class=&quot;token key atrule&quot;&gt;spec&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt;
  &lt;span class=&quot;token key atrule&quot;&gt;serviceName&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt; sample&lt;span class=&quot;token punctuation&quot;&gt;-&lt;/span&gt;headless
  &lt;span class=&quot;token key atrule&quot;&gt;replicas&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;token number&quot;&gt;3&lt;/span&gt;
  &lt;span class=&quot;token key atrule&quot;&gt;selector&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt;
    &lt;span class=&quot;token key atrule&quot;&gt;matchLabels&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt;
      &lt;span class=&quot;token key atrule&quot;&gt;app&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt; sample&lt;span class=&quot;token punctuation&quot;&gt;-&lt;/span&gt;app
  &lt;span class=&quot;token key atrule&quot;&gt;template&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt;
    &lt;span class=&quot;token key atrule&quot;&gt;metadata&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt;
      &lt;span class=&quot;token key atrule&quot;&gt;labels&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt;
        &lt;span class=&quot;token key atrule&quot;&gt;app&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt; sample&lt;span class=&quot;token punctuation&quot;&gt;-&lt;/span&gt;app
    &lt;span class=&quot;token key atrule&quot;&gt;spec&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt;
      &lt;span class=&quot;token key atrule&quot;&gt;containers&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt;
        &lt;span class=&quot;token punctuation&quot;&gt;-&lt;/span&gt; &lt;span class=&quot;token key atrule&quot;&gt;name&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt; nginx&lt;span class=&quot;token punctuation&quot;&gt;-&lt;/span&gt;container
          &lt;span class=&quot;token key atrule&quot;&gt;image&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt; amsy810/echo&lt;span class=&quot;token punctuation&quot;&gt;-&lt;/span&gt;nginx&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt;v2.0
&lt;span class=&quot;token punctuation&quot;&gt;---&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;h2&gt;6.8.2 헤드리스 서비스로 파드명 이름 해석&lt;/h2&gt;
&lt;p&gt;서비스 이름 해석은 &apos;서비스명.네임스페이스명.svc.clutser.local`으로 질의한다. 헤드리스 서비스의 경우에느 FQDN에 대해 정방향으로 질의하면 ClusterIP 대신 DNS 라운드 로빈에서 여러 파드의 IP 주소가 반환되기 때문에 부하 분산 때는 클라이언트 캐시 등을 생각해야 한다. 레플리카셋 등의 리소스에도 다음과 같이 DNS 라운드 로빈에서 IP 주소가 반환되도록 할 수 있다.&lt;/p&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;sh&quot;&gt;&lt;pre class=&quot;language-sh&quot;&gt;&lt;code class=&quot;language-sh&quot;&gt;&lt;span class=&quot;token comment&quot;&gt;# 파드 IP 주소 확인&lt;/span&gt;
$ kubectl get pods &lt;span class=&quot;token parameter variable&quot;&gt;-o&lt;/span&gt; wide
NAME                                 READY   STATUS    RESTARTS      AGE     IP           NODE                   NOMINATED NODE   READINESS GATES
sample-statefulset-headless-0        &lt;span class=&quot;token number&quot;&gt;1&lt;/span&gt;/1     Running   &lt;span class=&quot;token number&quot;&gt;0&lt;/span&gt;             2m30s   &lt;span class=&quot;token number&quot;&gt;10.244&lt;/span&gt;.1.3   kind-clusetr-worker3   &lt;span class=&quot;token operator&quot;&gt;&amp;lt;&lt;/span&gt;none&lt;span class=&quot;token operator&quot;&gt;&gt;&lt;/span&gt;           &lt;span class=&quot;token operator&quot;&gt;&amp;lt;&lt;/span&gt;none&lt;span class=&quot;token operator&quot;&gt;&gt;&lt;/span&gt;
sample-statefulset-headless-1        &lt;span class=&quot;token number&quot;&gt;1&lt;/span&gt;/1     Running   &lt;span class=&quot;token number&quot;&gt;0&lt;/span&gt;             2m29s   &lt;span class=&quot;token number&quot;&gt;10.244&lt;/span&gt;.3.4   kind-clusetr-worker2   &lt;span class=&quot;token operator&quot;&gt;&amp;lt;&lt;/span&gt;none&lt;span class=&quot;token operator&quot;&gt;&gt;&lt;/span&gt;           &lt;span class=&quot;token operator&quot;&gt;&amp;lt;&lt;/span&gt;none&lt;span class=&quot;token operator&quot;&gt;&gt;&lt;/span&gt;
sample-statefulset-headless-2        &lt;span class=&quot;token number&quot;&gt;1&lt;/span&gt;/1     Running   &lt;span class=&quot;token number&quot;&gt;0&lt;/span&gt;             2m28s   &lt;span class=&quot;token number&quot;&gt;10.244&lt;/span&gt;.2.4   kind-clusetr-worker    &lt;span class=&quot;token operator&quot;&gt;&amp;lt;&lt;/span&gt;none&lt;span class=&quot;token operator&quot;&gt;&gt;&lt;/span&gt;           &lt;span class=&quot;token operator&quot;&gt;&amp;lt;&lt;/span&gt;none&lt;span class=&quot;token operator&quot;&gt;&gt;&lt;/span&gt;

&lt;span class=&quot;token comment&quot;&gt;# 스테이트풀셋의 서비스 디스커버리에서는 DNS 라운드 로빈으로 IP 주소를 반환&lt;/span&gt;
$ kubectl &lt;span class=&quot;token builtin class-name&quot;&gt;exec&lt;/span&gt; &lt;span class=&quot;token parameter variable&quot;&gt;-it&lt;/span&gt; sample-pod -- &lt;span class=&quot;token function&quot;&gt;dig&lt;/span&gt; sample-headless.default.svc.cluster.local
&lt;span class=&quot;token punctuation&quot;&gt;..&lt;/span&gt;.
&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt; QUESTION SECTION:
&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;sample-headless.default.svc.cluster.local. IN A

&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt; ANSWER SECTION:
sample-headless.default.svc.cluster.local. &lt;span class=&quot;token number&quot;&gt;30&lt;/span&gt; IN A &lt;span class=&quot;token number&quot;&gt;10.244&lt;/span&gt;.2.4
sample-headless.default.svc.cluster.local. &lt;span class=&quot;token number&quot;&gt;30&lt;/span&gt; IN A &lt;span class=&quot;token number&quot;&gt;10.244&lt;/span&gt;.2.3
sample-headless.default.svc.cluster.local. &lt;span class=&quot;token number&quot;&gt;30&lt;/span&gt; IN A &lt;span class=&quot;token number&quot;&gt;10.244&lt;/span&gt;.1.2
sample-headless.default.svc.cluster.local. &lt;span class=&quot;token number&quot;&gt;30&lt;/span&gt; IN A &lt;span class=&quot;token number&quot;&gt;10.244&lt;/span&gt;.3.3
sample-headless.default.svc.cluster.local. &lt;span class=&quot;token number&quot;&gt;30&lt;/span&gt; IN A &lt;span class=&quot;token number&quot;&gt;10.244&lt;/span&gt;.1.3
sample-headless.default.svc.cluster.local. &lt;span class=&quot;token number&quot;&gt;30&lt;/span&gt; IN A &lt;span class=&quot;token number&quot;&gt;10.244&lt;/span&gt;.3.4

&lt;span class=&quot;token comment&quot;&gt;# 파드명으로 서비스 디스커버리&lt;/span&gt;
$ kubectl &lt;span class=&quot;token builtin class-name&quot;&gt;exec&lt;/span&gt; &lt;span class=&quot;token parameter variable&quot;&gt;-it&lt;/span&gt; sample-pod -- &lt;span class=&quot;token function&quot;&gt;dig&lt;/span&gt; sample-statefulset-headless-0.sample-headless.default.svc.cluster.local
&lt;span class=&quot;token punctuation&quot;&gt;..&lt;/span&gt;.
&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt; QUESTION SECTION:
&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;sample-statefulset-headless-0.sample-headless.default.svc.cluster.local. IN A

&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt; ANSWER SECTION:
sample-statefulset-headless-0.sample-headless.default.svc.cluster.local. &lt;span class=&quot;token number&quot;&gt;10&lt;/span&gt; IN A &lt;span class=&quot;token number&quot;&gt;10.244&lt;/span&gt;.1.3

&lt;span class=&quot;token comment&quot;&gt;# 컨테이너 내부 resolv.conf 확인&lt;/span&gt;
$ kubectl &lt;span class=&quot;token builtin class-name&quot;&gt;exec&lt;/span&gt; &lt;span class=&quot;token parameter variable&quot;&gt;-it&lt;/span&gt; sample-pod -- &lt;span class=&quot;token function&quot;&gt;cat&lt;/span&gt; /etc/resolv.conf
search default.svc.cluster.local svc.cluster.local cluster.local
nameserver &lt;span class=&quot;token number&quot;&gt;10.96&lt;/span&gt;.0.10
options ndots:5&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;일반적으로는 클러스터 내부 DNS에서 파드명으로는 해석할 수 없다. 서비스를 생성할 때 ClusterIP 등과 같은 여러 파드에 대해 엔드포이트가 할당되어 그 엔드포인트의 이름 해석은 불가능하다. 스테이트풀셋이 헤드리스 서비스를 사용하고 서비스의 &lt;code class=&quot;language-text&quot;&gt;metadata.name&lt;/code&gt;이 스테이트풀셋의 &lt;code class=&quot;language-text&quot;&gt;spec.serviceName&lt;/code&gt;이 같은 경우 추가로 &lt;code class=&quot;language-text&quot;&gt;파드명.서비스명.네임스페이스명.svc.cluster.local&lt;/code&gt;를 해석할 수 있다. 또한, 컨테이너 내부의 resolv.conf 등에는 search 지시자로 다음과 같은 엔트리가 들어 있어 &lt;code class=&quot;language-text&quot;&gt;파드명.서비스명&lt;/code&gt;이나 &lt;code class=&quot;language-text&quot;&gt;파드명.서비스명.네임스페이스명&lt;/code&gt; 등으로 질의할 수 있다.&lt;/p&gt;
&lt;h2&gt;6.8.3 스테이트풀셋 외의 파드명으로 이름 해석&lt;/h2&gt;
&lt;p&gt;스테이트풀셋을 사용하지 않고 해석이 가능하도록 하려면 파드에 설정을 추가해야 한다. 파드에 &lt;code class=&quot;language-text&quot;&gt;spec.hostname&lt;/code&gt;과 해드레스 서비스명과 동일한 &lt;code class=&quot;language-text&quot;&gt;spec.domain&lt;/code&gt; 설정을 추가한다. 이때 &lt;code class=&quot;language-text&quot;&gt;spec.hostname&lt;/code&gt;은 파드명이 아니여도 된다. 이 설정을 추가하면 다음과 같이 파드 단위로 이름 해석이 가능하다.&lt;/br&gt;
&lt;code class=&quot;language-text&quot;&gt;Hostname명.Subdomain/서비스명.네임스페이스명.svc.cluster.local&lt;/code&gt;&lt;/br&gt;
디플로이먼트 등에서 이 설정을 할 경우, 매니페스트 구조상 여러 레프릴카에서는 같은 hostname만 설정할 수 있다. 또한, 같은 hostname이 지정된 경우 하나의 A 레코드만 반환되기 때문에 디플로이먼트 등에서는 개별 파드명으로 해석이 불가능하다.&lt;/p&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;yaml&quot;&gt;&lt;pre class=&quot;language-yaml&quot;&gt;&lt;code class=&quot;language-yaml&quot;&gt;&lt;span class=&quot;token punctuation&quot;&gt;---&lt;/span&gt;
&lt;span class=&quot;token key atrule&quot;&gt;apiVersion&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt; v1
&lt;span class=&quot;token key atrule&quot;&gt;kind&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt; Pod
&lt;span class=&quot;token key atrule&quot;&gt;metadata&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt;
  &lt;span class=&quot;token key atrule&quot;&gt;name&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt; sample&lt;span class=&quot;token punctuation&quot;&gt;-&lt;/span&gt;subdomain
  &lt;span class=&quot;token key atrule&quot;&gt;labels&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt;
    &lt;span class=&quot;token key atrule&quot;&gt;app&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt; sample&lt;span class=&quot;token punctuation&quot;&gt;-&lt;/span&gt;app
&lt;span class=&quot;token key atrule&quot;&gt;spec&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt;
  &lt;span class=&quot;token key atrule&quot;&gt;hostname&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt; sample&lt;span class=&quot;token punctuation&quot;&gt;-&lt;/span&gt;hostname
  &lt;span class=&quot;token key atrule&quot;&gt;subdomain&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt; sample&lt;span class=&quot;token punctuation&quot;&gt;-&lt;/span&gt;subdomain
  &lt;span class=&quot;token key atrule&quot;&gt;containers&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt;
  &lt;span class=&quot;token punctuation&quot;&gt;-&lt;/span&gt; &lt;span class=&quot;token key atrule&quot;&gt;name&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt; nginx&lt;span class=&quot;token punctuation&quot;&gt;-&lt;/span&gt;container
    &lt;span class=&quot;token key atrule&quot;&gt;image&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt; amsy810/tools&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt;v2.0
&lt;span class=&quot;token punctuation&quot;&gt;---&lt;/span&gt;
&lt;span class=&quot;token key atrule&quot;&gt;apiVersion&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt; v1
&lt;span class=&quot;token key atrule&quot;&gt;kind&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt; Service
&lt;span class=&quot;token key atrule&quot;&gt;metadata&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt;
  &lt;span class=&quot;token key atrule&quot;&gt;name&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt; sample&lt;span class=&quot;token punctuation&quot;&gt;-&lt;/span&gt;subdomain
&lt;span class=&quot;token key atrule&quot;&gt;spec&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt;
  &lt;span class=&quot;token key atrule&quot;&gt;type&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt; ClusterIP
  &lt;span class=&quot;token key atrule&quot;&gt;clusterIP&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt; None
  &lt;span class=&quot;token key atrule&quot;&gt;ports&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;[&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;]&lt;/span&gt;
  &lt;span class=&quot;token key atrule&quot;&gt;selector&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt;
    &lt;span class=&quot;token key atrule&quot;&gt;app&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt; sample&lt;span class=&quot;token punctuation&quot;&gt;-&lt;/span&gt;app&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;sh&quot;&gt;&lt;pre class=&quot;language-sh&quot;&gt;&lt;code class=&quot;language-sh&quot;&gt;&lt;span class=&quot;token comment&quot;&gt;# 파드 IP 주소 확인&lt;/span&gt;
$ kubectl get pod sample-subdomain &lt;span class=&quot;token parameter variable&quot;&gt;-o&lt;/span&gt; wide
NAME               READY   STATUS    RESTARTS   AGE   IP           NODE                   NOMINATED NODE   READINESS GATES
sample-subdomain   &lt;span class=&quot;token number&quot;&gt;1&lt;/span&gt;/1     Running   &lt;span class=&quot;token number&quot;&gt;0&lt;/span&gt;          10s   &lt;span class=&quot;token number&quot;&gt;10.244&lt;/span&gt;.1.5   kind-clusetr-worker3   &lt;span class=&quot;token operator&quot;&gt;&amp;lt;&lt;/span&gt;none&lt;span class=&quot;token operator&quot;&gt;&gt;&lt;/span&gt;           &lt;span class=&quot;token operator&quot;&gt;&amp;lt;&lt;/span&gt;none&lt;span class=&quot;token operator&quot;&gt;&gt;&lt;/span&gt;

&lt;span class=&quot;token comment&quot;&gt;# 파드명으로 서비스 디스커버리&lt;/span&gt;
$ kubectl &lt;span class=&quot;token builtin class-name&quot;&gt;exec&lt;/span&gt; &lt;span class=&quot;token parameter variable&quot;&gt;-it&lt;/span&gt; sample-pod -- &lt;span class=&quot;token function&quot;&gt;dig&lt;/span&gt; sample-hostname.sample-subdomain.default.svc.cluster.local
&lt;span class=&quot;token punctuation&quot;&gt;..&lt;/span&gt;.
&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt; QUESTION SECTION:
&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;sample-hostname.sample-subdomain.default.svc.cluster.local. IN A

&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt; ANSWER SECTION:
sample-hostname.sample-subdomain.default.svc.cluster.local. &lt;span class=&quot;token number&quot;&gt;30&lt;/span&gt; IN A &lt;span class=&quot;token number&quot;&gt;10.244&lt;/span&gt;.1.5&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;h1&gt;6.9 ExternalName 서비스&lt;/h1&gt;
&lt;p&gt;ExternalName 서비스는 일반적인 서비스의 리소스와 달리 서비스명의 이름 해석에 있어 외부 도메인으로 CNAME을 반환한다. 사용 용도를 살펴보면, 다른 이름을 설정하고 싶은 경우, 클러스터 내부에서의 엔드포인트를 쉽게 변경하고 싶을 때 사용한다.&lt;/p&gt;
&lt;h2&gt;6.9.1 ExternalName 서비스 생성&lt;/h2&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;yaml&quot;&gt;&lt;pre class=&quot;language-yaml&quot;&gt;&lt;code class=&quot;language-yaml&quot;&gt;&lt;span class=&quot;token key atrule&quot;&gt;kind&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt; Service
&lt;span class=&quot;token key atrule&quot;&gt;apiVersion&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt; v1
&lt;span class=&quot;token key atrule&quot;&gt;metadata&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt;
  &lt;span class=&quot;token key atrule&quot;&gt;name&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt; sample&lt;span class=&quot;token punctuation&quot;&gt;-&lt;/span&gt;externalname
  &lt;span class=&quot;token key atrule&quot;&gt;namespace&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt; default
&lt;span class=&quot;token key atrule&quot;&gt;spec&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt;
  &lt;span class=&quot;token key atrule&quot;&gt;type&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt; ExternalName
  &lt;span class=&quot;token key atrule&quot;&gt;externalName&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt; external.example.com&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;sh&quot;&gt;&lt;pre class=&quot;language-sh&quot;&gt;&lt;code class=&quot;language-sh&quot;&gt;&lt;span class=&quot;token comment&quot;&gt;# 서비스 목록 표시&lt;/span&gt;
$ kubectl get &lt;span class=&quot;token function&quot;&gt;service&lt;/span&gt; sample-externalname
NAME                  TYPE           CLUSTER-IP   EXTERNAL-IP            PORT&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;S&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;   AGE
sample-externalname   ExternalName   &lt;span class=&quot;token operator&quot;&gt;&amp;lt;&lt;/span&gt;none&lt;span class=&quot;token operator&quot;&gt;&gt;&lt;/span&gt;       external.example.com   &lt;span class=&quot;token operator&quot;&gt;&amp;lt;&lt;/span&gt;none&lt;span class=&quot;token operator&quot;&gt;&gt;&lt;/span&gt;    14s

&lt;span class=&quot;token comment&quot;&gt;# 일시적으로 파드를 기동하여 ExternalName의 CNAME 이름 해석을 확인&lt;/span&gt;
$ kubectl &lt;span class=&quot;token builtin class-name&quot;&gt;exec&lt;/span&gt; &lt;span class=&quot;token parameter variable&quot;&gt;-it&lt;/span&gt; sample-pod -- &lt;span class=&quot;token function&quot;&gt;dig&lt;/span&gt; sample-externalname.default.svc.cluster.local CNAME
&lt;span class=&quot;token punctuation&quot;&gt;..&lt;/span&gt;.
&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt; QUESTION SECTION:
&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;sample-externalname.default.svc.cluster.local. IN CNAME

&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt; ANSWER SECTION:
sample-externalname.default.svc.cluster.local. &lt;span class=&quot;token number&quot;&gt;30&lt;/span&gt; IN CNAME external.example.com.&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;클러스터 내부에서는 파드와 통신에 서비스 이름 해석을 사용하여 느슨한 결합을 유지하고 있다. 그리고 SaaS나 IaaS 등 외부에 있는 서비스를 사용할 때도 가틍하면 느슨한 결합으로 구성해야 한다.&lt;/br&gt;
예를 들어, 애플리케이션 외부의 엔드포인트를 설정에 등록해 두면 외부 애플리케이션 측의 엔드포인트 주소가 변경되면 설정도 변경해줘야 한다. 하지만, ExternalName을 사용했을 경우 목적지가 변경되어도 ExternalName 서비스만 변경하는 것만으로도 대응이 가능하다. 이를 통해 외부 서비스와 느슨한 결합을 유지할 수 있다. &lt;/br&gt;&lt;/p&gt;
&lt;p&gt;또한, ExternalName 서비스를 사용하면 외부 서비스와 쿠버네티스에 배포된 클러스터 내부 서비스와의 전환도 유연하게 할 수 있게 된다. 외부 애플리케이션 측은 서비스의 FQDN을 지정해 두고 이름 해석이 되면 ExternalName의 CNAME 레코드 또는 ClusterIP의 A 레코드가 반환되는 형태가 되어 애플리케이션 측은 변경 없이 내부 서비스와 외부 서비스를 전화할 수 있다. 한 가지 주의할 점은 ClusterIP 서비스에서 ExternalName 서비스로 전환할 경우 &lt;code class=&quot;language-text&quot;&gt;spec.clusterIP&lt;/code&gt;를 명시적으로 공란으로 만들어 두어야 한다는 것이다.&lt;/p&gt;
&lt;h1&gt;6.10 None-Selector 서비스&lt;/h1&gt;
&lt;p&gt;ExternalName 서비스에서는 서비스명으로 이름 해석을 하면 외부 도메인에 전송되었다. None-Selector 서비스는 서비스명으로 이름 해석을 하면 자신이 설정한 멤버에 대해 로드 밸런싱을 한다. 즉, 쿠버네티스 내에 원하는 목적지로 지금까지 설명했던 형태의 로드 밸런서를 생성할 수 있는 기능이다. 클라이언트 사이드 로드 밸런싱용 엔드포인트를 제공하는 서비스라고도 할 수 있다. 기본적으로 ClusterIP를 사용하여 클러스터 내부 로드 밸런서를 사용하는 경우가 많기 때문에 이 책에서는 ClusterIP를 전제로 하여 설명한다. &lt;code class=&quot;language-text&quot;&gt;type: LoadBalancer&lt;/code&gt;를 지정하는 것도 가능하지만, 쿠버네티스 클러스터의 외부 로드 밸런서에서 수신한 트래픽이 쿠버네티스 클러스터로 전송된 후에 다시 쿠버네티스 클러스터 외부로 전송하는 형태가 되기 때문에 유용하지 못하다. 이는 &lt;code class=&quot;language-text&quot;&gt;type: NodePort&lt;/code&gt;도 마찬가지이다.&lt;/br&gt;
&lt;code class=&quot;language-text&quot;&gt;externalName&lt;/code&gt;을 지정하지 않고 셀렉터가 존재하지 않는 서비스를 생성한 후 엔드포인트 리소스를 수동으로 만들면 유연한 서비스를 만들 수 있다.&lt;/p&gt;
&lt;h2&gt;6.10.1 None-Selector 서비스 생성&lt;/h2&gt;
&lt;p&gt;매니페스트로 생성한 서비스에는 다음과 같이 엔드포인트에 로드 밸런싱 대상 멤버가 등록되어 있다. 멤버를 등록하고 삭제할 경우에는 엔드포인트 리소스만 수정하면 된다.&lt;/p&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;yaml&quot;&gt;&lt;pre class=&quot;language-yaml&quot;&gt;&lt;code class=&quot;language-yaml&quot;&gt;&lt;span class=&quot;token punctuation&quot;&gt;---&lt;/span&gt;
&lt;span class=&quot;token key atrule&quot;&gt;kind&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt; Service
&lt;span class=&quot;token key atrule&quot;&gt;apiVersion&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt; v1
&lt;span class=&quot;token key atrule&quot;&gt;metadata&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt;
  &lt;span class=&quot;token key atrule&quot;&gt;name&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt; sample&lt;span class=&quot;token punctuation&quot;&gt;-&lt;/span&gt;none&lt;span class=&quot;token punctuation&quot;&gt;-&lt;/span&gt;selector
&lt;span class=&quot;token key atrule&quot;&gt;spec&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt;
  &lt;span class=&quot;token key atrule&quot;&gt;type&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt; ClusterIP
  &lt;span class=&quot;token key atrule&quot;&gt;ports&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt;
  &lt;span class=&quot;token punctuation&quot;&gt;-&lt;/span&gt; &lt;span class=&quot;token key atrule&quot;&gt;protocol&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt; TCP
    &lt;span class=&quot;token key atrule&quot;&gt;port&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;token number&quot;&gt;8080&lt;/span&gt;
    &lt;span class=&quot;token key atrule&quot;&gt;targetPort&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;token number&quot;&gt;80&lt;/span&gt;
&lt;span class=&quot;token punctuation&quot;&gt;---&lt;/span&gt;
&lt;span class=&quot;token key atrule&quot;&gt;kind&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt; Endpoints
&lt;span class=&quot;token key atrule&quot;&gt;apiVersion&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt; v1
&lt;span class=&quot;token key atrule&quot;&gt;metadata&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt;
  &lt;span class=&quot;token key atrule&quot;&gt;name&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt; sample&lt;span class=&quot;token punctuation&quot;&gt;-&lt;/span&gt;none&lt;span class=&quot;token punctuation&quot;&gt;-&lt;/span&gt;selector
&lt;span class=&quot;token key atrule&quot;&gt;subsets&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt;
  &lt;span class=&quot;token punctuation&quot;&gt;-&lt;/span&gt; &lt;span class=&quot;token key atrule&quot;&gt;addresses&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt;
    &lt;span class=&quot;token punctuation&quot;&gt;-&lt;/span&gt; &lt;span class=&quot;token key atrule&quot;&gt;ip&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt; 192.168.1.1
    &lt;span class=&quot;token punctuation&quot;&gt;-&lt;/span&gt; &lt;span class=&quot;token key atrule&quot;&gt;ip&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt; 192.168.1.2
    &lt;span class=&quot;token key atrule&quot;&gt;ports&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt;
      &lt;span class=&quot;token punctuation&quot;&gt;-&lt;/span&gt; &lt;span class=&quot;token key atrule&quot;&gt;protocol&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt; TCP
        &lt;span class=&quot;token key atrule&quot;&gt;port&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;token number&quot;&gt;80&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;sh&quot;&gt;&lt;pre class=&quot;language-sh&quot;&gt;&lt;code class=&quot;language-sh&quot;&gt;&lt;span class=&quot;token comment&quot;&gt;# 생성한 서비스 확인&lt;/span&gt;
$ kubectl describe svc sample-none-selector
Name:              sample-none-selector
Namespace:         default
Labels:            &lt;span class=&quot;token operator&quot;&gt;&amp;lt;&lt;/span&gt;none&lt;span class=&quot;token operator&quot;&gt;&gt;&lt;/span&gt;
Annotations:       &lt;span class=&quot;token operator&quot;&gt;&amp;lt;&lt;/span&gt;none&lt;span class=&quot;token operator&quot;&gt;&gt;&lt;/span&gt;
Selector:          &lt;span class=&quot;token operator&quot;&gt;&amp;lt;&lt;/span&gt;none&lt;span class=&quot;token operator&quot;&gt;&gt;&lt;/span&gt;
Type:              ClusterIP
IP Family Policy:  SingleStack
IP Families:       IPv4
IP:                &lt;span class=&quot;token number&quot;&gt;10.96&lt;/span&gt;.23.49
IPs:               &lt;span class=&quot;token number&quot;&gt;10.96&lt;/span&gt;.23.49
Port:              &lt;span class=&quot;token operator&quot;&gt;&amp;lt;&lt;/span&gt;unset&lt;span class=&quot;token operator&quot;&gt;&gt;&lt;/span&gt;  &lt;span class=&quot;token number&quot;&gt;8080&lt;/span&gt;/TCP
TargetPort:        &lt;span class=&quot;token number&quot;&gt;80&lt;/span&gt;/TCP
Endpoints:         &lt;span class=&quot;token number&quot;&gt;192.168&lt;/span&gt;.1.1:80,192.168.1.2:80
Session Affinity:  None
Events:            &lt;span class=&quot;token operator&quot;&gt;&amp;lt;&lt;/span&gt;none&lt;span class=&quot;token operator&quot;&gt;&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;h1&gt;6.11 인그레스&lt;/h1&gt;
&lt;p&gt;지금까지 설명했던 ClusterIP, NodePort, ExternalName, None-Selector, Headless Service, LoadBalancer 등은 L4 로드 밸런싱을 제공하는 리소스였다면, 인그레스는 L7 로드 밸런싱을 제공하는 리소스이다. 인그레스는 서비스들을 묶는 서비스들의 상위 객체로, 서비스 종류의 하나로서가 아닌 독립된 리소스로 구성되어 있다. 인그레스를 사용할 때는 &lt;code class=&quot;language-text&quot;&gt;kind: Service&lt;/code&gt; 타입이 아닌, &lt;code class=&quot;language-text&quot;&gt;kind: Ingress&lt;/code&gt; 타입 리소스를 지정한다. 쿠버네티스 Network Policy 리소스에 Ingress/Egress라는 설정 항목이 있지만, 이 인그레스와는 관계가 없다.&lt;/p&gt;
&lt;h2&gt;6.11.1 리소스와 컨트롤러&lt;/h2&gt;
&lt;p&gt;쿠버네티스는 분산 시스템이며, 매니페스트로 정의한 리소스를 쿠버네티스에 등록하는 것으로 시작된다. 등록만으로는 아무런 처리가 이뤄지지 않으며, 실제 처리를 하는 컨트롤러라는 시스템 구성 요소가 필요하다. 즉, 인그레스가 실제로 가리키는 것은 다양한 개념의 집합이다.&lt;/br&gt;
인그레스 리소스란 매니페스트에 등록된 API 리소스르르 의미하고, 인그레스 컨트롤러는 인그레스 리소스가 쿠버네티스에 등록되었을 때 어떤 처리를 한다. GCP에서는 GCLB를 조작하여 L7 로드 밸런서를 설정하거나 Nginx 설정을 변경하여 리로드 하는 등의 처리를 말한다.&lt;/p&gt;
&lt;h2&gt;6.11.2 인그레스의 종류&lt;/h2&gt;
&lt;p&gt;인그레스의 구현 방법에는 여러 가지가 있고 편의성도 다르지만, 여기서는 실제로 많이 사용되는 GKE 인그레스 컨트롤러와 Nginx 인그레스 컨트롤러를 소개한다. 이 두가지 컨트롤러는 인그레스 리소스를 생성했을 때 처리를 담당하는 리소스이다. 어떤 L7 로드밸런서를 생성할지는 이 인그레스 컨트롤러에 따라 달라진다.&lt;/p&gt;
&lt;p&gt;또한, 인그레스는 다음과 같이 크게 두 가지로 분류된다.&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;클러스터 외부 로드 밸런서를 사용한 인그레스: GKE 인그레스&lt;/li&gt;
&lt;li&gt;클러스터 내부 인그레스용 파드를 배포하는 인그레스: Nginx 인그레스&lt;/li&gt;
&lt;/ul&gt;
&lt;h3&gt;클러스터 외부 로드 밸런서를 사용한 인그레스&lt;/h3&gt;
&lt;p&gt;GKE처럼 외부 로드 밸런서를 사용한 인그레스의 경우 인그레스 리소스 생성만으로 로드 밸런서의 가상 IP가 할당되어 사용할 수 있다. 따라서 인그레스의 트래픽은 GCP의 GCLB가 트래픽을 수신한 후 GCLB에서 SSL 터미네이션이나 경로 기반 라우팅을 통해 NodePort에 트래픽을 전송함으로써 대상 파드까지 도달한다.&lt;/p&gt;
&lt;ol&gt;
&lt;li&gt;클라이언트&lt;/li&gt;
&lt;li&gt;-&gt; L7 로드밸런서(NodePort 사용)&lt;/li&gt;
&lt;li&gt;-&gt; 목적지 파드&lt;/li&gt;
&lt;/ol&gt;
&lt;h3&gt;클러스터 내부에 인그레스용 파드를 배포하는 인그레스&lt;/h3&gt;
&lt;p&gt;이 패턴은 인그레스 리소스에서 정의한 L7 수준의 로드 밸런싱 처리를 위해 인그레스용 파드를 클러스터 내부에 생성해야 한다. 또 생성한 인그레스용 파드에 대해 클러스터 외부에서 접속할 수 있도록 별도의 인그레스용 파드에 LoadBalancer 서비스를 생성하는 등의 준비가 필요하다. 그리고 인그레스용 파드가 SSL 터미테이션 경로 기반 라우팅 등과 같은 L7 수준의 처리를 하기 위해 부하에 따른 레플리카 수의 오토 스케일링도 고려해야 한다.&lt;/br&gt;
인그레스용 파드에 Nginx를 사용한 Nginx 인그레스의 경우 로드 밸런서가 Nginx 파드까지 전송하고, 그 다음에는 Nginx가 L7 수준의 처리를 수행할 파드에 전송한다. 이때 Nginx 파드에서 대상 파드까지는 NodePort를 통과하지 않고 직접 파드 IP 주소로 전송된다. 그 순서를 간략히 하면 다음과 같다.&lt;/p&gt;
&lt;ol&gt;
&lt;li&gt;클라이언트&lt;/li&gt;
&lt;li&gt;-&gt; L4 로드밸런서(LoadBalancer 사용)&lt;/li&gt;
&lt;li&gt;-&gt; Nginx 파드(Nginx 인그레스 컨트롤러)&lt;/li&gt;
&lt;li&gt;-&gt; 목적지 파드&lt;/li&gt;
&lt;/ol&gt;
&lt;h2&gt;6.11.3 인그레스 컨트롤러 배포&lt;/h2&gt;
&lt;h3&gt;GKE 인그레스 컨트롤러 배포&lt;/h3&gt;
&lt;p&gt;GKE의 경우 클러스터 생성 시 HttpLoadBalancing 애드온을 활성화하면 배포된다. 또 이 애드온은 기본값으로 활성화되어 있기 때문에 4장에서 설명한 순서대로 클러스터를 구축했다면 이미 인그레스를 사용할 수 있다.&lt;/p&gt;
&lt;h3&gt;Nginx 인그레스 컨트롤러 배포&lt;/h3&gt;
&lt;p&gt;Nginx 인그레스를 사용하는 경우에는 Nginx 인그레스 컨트롤러를 배포해야 한다. Nginx 인그레스에는 인그레스 컨트롤러 자체가 L7 수준의 처리를 하는 파드이기도 하므로, 이름은 컨트롤러이지만 실제 처리도 한다.&lt;/br&gt;
클러스터 외부로부터의 통신을 확보하기 위해 Nginx 인그레스 컨트롤러의 파드에 로드 밸런서 서비스(NodePort)를 생성해야 한다. 인그레스 컨트롤러를 한 번 배포하기 위한 매니페스트는 깃허브에 공개되어 있으므로 쉽게 도입할 수 있다.&lt;/p&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;sh&quot;&gt;&lt;pre class=&quot;language-sh&quot;&gt;&lt;code class=&quot;language-sh&quot;&gt;&lt;span class=&quot;token comment&quot;&gt;# Nginx 인그레스 컨트롤러 설치(ingress-nginx 네임스페이스에 설치됨)&lt;/span&gt;
$ kubectl apply &lt;span class=&quot;token parameter variable&quot;&gt;-f&lt;/span&gt; https://raw.githubusercontent.com/kubernetes/ingress-nginx/controller-v0.44.0/deploy/static/provider/cloud/deploy.yaml
namespace/ingress-nginx created
serviceaccount/ingress-nginx created
configmap/ingress-nginx-controller created
clusterrole.rbac.authorization.k8s.io/ingress-nginx created
clusterrolebinding.rbac.authorization.k8s.io/ingress-nginx created
role.rbac.authorization.k8s.io/ingress-nginx created
rolebinding.rbac.authorization.k8s.io/ingress-nginx created
service/ingress-nginx-controller-admission created
service/ingress-nginx-controller created
deployment.apps/ingress-nginx-controller created
validatingwebhookconfiguration.admissionregistration.k8s.io/ingress-nginx-admission created
serviceaccount/ingress-nginx-admission created
clusterrole.rbac.authorization.k8s.io/ingress-nginx-admission created
clusterrolebinding.rbac.authorization.k8s.io/ingress-nginx-admission created
role.rbac.authorization.k8s.io/ingress-nginx-admission created
rolebinding.rbac.authorization.k8s.io/ingress-nginx-admission created
job.batch/ingress-nginx-admission-create created
job.batch/ingress-nginx-admission-patch created&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;h2&gt;6.11.4 인그레스 리소스 생성&lt;/h2&gt;
&lt;p&gt;인그레스 리소스를 생성하려면 사전 준비가 필요하다. 인그레스는 먼저 생성된 서비스를 백엔드로 전송하는 구조로 되어 있어 아래 매니페스트에 있는 서비스를 생성해야 한다. 백엔드에서 사용하는 서비스는 &lt;code class=&quot;language-text&quot;&gt;type: NodePort&lt;/code&gt;를 지정한다.&lt;/p&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;yaml&quot;&gt;&lt;pre class=&quot;language-yaml&quot;&gt;&lt;code class=&quot;language-yaml&quot;&gt;&lt;span class=&quot;token punctuation&quot;&gt;---&lt;/span&gt;
&lt;span class=&quot;token key atrule&quot;&gt;apiVersion&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt; v1
&lt;span class=&quot;token key atrule&quot;&gt;kind&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt; Service
&lt;span class=&quot;token key atrule&quot;&gt;metadata&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt;
  &lt;span class=&quot;token key atrule&quot;&gt;name&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt; sample&lt;span class=&quot;token punctuation&quot;&gt;-&lt;/span&gt;ingress&lt;span class=&quot;token punctuation&quot;&gt;-&lt;/span&gt;svc&lt;span class=&quot;token punctuation&quot;&gt;-&lt;/span&gt;&lt;span class=&quot;token number&quot;&gt;1&lt;/span&gt;
&lt;span class=&quot;token key atrule&quot;&gt;spec&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt;
  &lt;span class=&quot;token key atrule&quot;&gt;type&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt; NodePort
  &lt;span class=&quot;token key atrule&quot;&gt;ports&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt;
    &lt;span class=&quot;token punctuation&quot;&gt;-&lt;/span&gt; &lt;span class=&quot;token key atrule&quot;&gt;name&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;token string&quot;&gt;&quot;http-port&quot;&lt;/span&gt;
      &lt;span class=&quot;token key atrule&quot;&gt;protocol&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;token string&quot;&gt;&quot;TCP&quot;&lt;/span&gt;
      &lt;span class=&quot;token key atrule&quot;&gt;port&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;token number&quot;&gt;8888&lt;/span&gt;
      &lt;span class=&quot;token key atrule&quot;&gt;targetPort&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;token number&quot;&gt;80&lt;/span&gt;
  &lt;span class=&quot;token key atrule&quot;&gt;selector&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt;
    &lt;span class=&quot;token key atrule&quot;&gt;ingress-app&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt; sample1
&lt;span class=&quot;token punctuation&quot;&gt;---&lt;/span&gt;
&lt;span class=&quot;token key atrule&quot;&gt;apiVersion&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt; v1
&lt;span class=&quot;token key atrule&quot;&gt;kind&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt; Pod
&lt;span class=&quot;token key atrule&quot;&gt;metadata&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt;
  &lt;span class=&quot;token key atrule&quot;&gt;name&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt; sample&lt;span class=&quot;token punctuation&quot;&gt;-&lt;/span&gt;ingress&lt;span class=&quot;token punctuation&quot;&gt;-&lt;/span&gt;apps&lt;span class=&quot;token punctuation&quot;&gt;-&lt;/span&gt;&lt;span class=&quot;token number&quot;&gt;1&lt;/span&gt;
  &lt;span class=&quot;token key atrule&quot;&gt;labels&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt;
    &lt;span class=&quot;token key atrule&quot;&gt;ingress-app&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt; sample1
&lt;span class=&quot;token key atrule&quot;&gt;spec&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt;
  &lt;span class=&quot;token key atrule&quot;&gt;containers&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt;
    &lt;span class=&quot;token punctuation&quot;&gt;-&lt;/span&gt; &lt;span class=&quot;token key atrule&quot;&gt;name&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt; nginx&lt;span class=&quot;token punctuation&quot;&gt;-&lt;/span&gt;container
      &lt;span class=&quot;token key atrule&quot;&gt;image&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt; amsy810/echo&lt;span class=&quot;token punctuation&quot;&gt;-&lt;/span&gt;nginx&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt;v2.0
      &lt;span class=&quot;token key atrule&quot;&gt;ports&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt;
        &lt;span class=&quot;token punctuation&quot;&gt;-&lt;/span&gt; &lt;span class=&quot;token key atrule&quot;&gt;containerPort&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;token number&quot;&gt;80&lt;/span&gt;
&lt;span class=&quot;token punctuation&quot;&gt;---&lt;/span&gt;
&lt;span class=&quot;token key atrule&quot;&gt;apiVersion&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt; v1
&lt;span class=&quot;token key atrule&quot;&gt;kind&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt; Service
&lt;span class=&quot;token key atrule&quot;&gt;metadata&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt;
  &lt;span class=&quot;token key atrule&quot;&gt;name&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt; sample&lt;span class=&quot;token punctuation&quot;&gt;-&lt;/span&gt;ingress&lt;span class=&quot;token punctuation&quot;&gt;-&lt;/span&gt;svc&lt;span class=&quot;token punctuation&quot;&gt;-&lt;/span&gt;&lt;span class=&quot;token number&quot;&gt;2&lt;/span&gt;
&lt;span class=&quot;token key atrule&quot;&gt;spec&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt;
  &lt;span class=&quot;token key atrule&quot;&gt;type&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt; NodePort
  &lt;span class=&quot;token key atrule&quot;&gt;ports&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt;
    &lt;span class=&quot;token punctuation&quot;&gt;-&lt;/span&gt; &lt;span class=&quot;token key atrule&quot;&gt;name&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;token string&quot;&gt;&quot;http-port&quot;&lt;/span&gt;
      &lt;span class=&quot;token key atrule&quot;&gt;protocol&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;token string&quot;&gt;&quot;TCP&quot;&lt;/span&gt;
      &lt;span class=&quot;token key atrule&quot;&gt;port&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;token number&quot;&gt;8888&lt;/span&gt;
      &lt;span class=&quot;token key atrule&quot;&gt;targetPort&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;token number&quot;&gt;80&lt;/span&gt;
  &lt;span class=&quot;token key atrule&quot;&gt;selector&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt;
    &lt;span class=&quot;token key atrule&quot;&gt;ingress-app&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt; sample2
&lt;span class=&quot;token punctuation&quot;&gt;---&lt;/span&gt;
&lt;span class=&quot;token key atrule&quot;&gt;apiVersion&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt; v1
&lt;span class=&quot;token key atrule&quot;&gt;kind&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt; Pod
&lt;span class=&quot;token key atrule&quot;&gt;metadata&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt;
  &lt;span class=&quot;token key atrule&quot;&gt;name&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt; sample&lt;span class=&quot;token punctuation&quot;&gt;-&lt;/span&gt;ingress&lt;span class=&quot;token punctuation&quot;&gt;-&lt;/span&gt;apps&lt;span class=&quot;token punctuation&quot;&gt;-&lt;/span&gt;&lt;span class=&quot;token number&quot;&gt;2&lt;/span&gt;
  &lt;span class=&quot;token key atrule&quot;&gt;labels&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt;
    &lt;span class=&quot;token key atrule&quot;&gt;ingress-app&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt; sample2
&lt;span class=&quot;token key atrule&quot;&gt;spec&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt;
  &lt;span class=&quot;token key atrule&quot;&gt;containers&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt;
    &lt;span class=&quot;token punctuation&quot;&gt;-&lt;/span&gt; &lt;span class=&quot;token key atrule&quot;&gt;name&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt; nginx&lt;span class=&quot;token punctuation&quot;&gt;-&lt;/span&gt;container
      &lt;span class=&quot;token key atrule&quot;&gt;image&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt; amsy810/echo&lt;span class=&quot;token punctuation&quot;&gt;-&lt;/span&gt;nginx&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt;v2.0
      &lt;span class=&quot;token key atrule&quot;&gt;ports&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt;
        &lt;span class=&quot;token punctuation&quot;&gt;-&lt;/span&gt; &lt;span class=&quot;token key atrule&quot;&gt;containerPort&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;token number&quot;&gt;80&lt;/span&gt;
&lt;span class=&quot;token punctuation&quot;&gt;---&lt;/span&gt;
&lt;span class=&quot;token key atrule&quot;&gt;apiVersion&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt; v1
&lt;span class=&quot;token key atrule&quot;&gt;kind&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt; Service
&lt;span class=&quot;token key atrule&quot;&gt;metadata&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt;
  &lt;span class=&quot;token key atrule&quot;&gt;name&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt; sample&lt;span class=&quot;token punctuation&quot;&gt;-&lt;/span&gt;ingress&lt;span class=&quot;token punctuation&quot;&gt;-&lt;/span&gt;default
&lt;span class=&quot;token key atrule&quot;&gt;spec&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt;
  &lt;span class=&quot;token key atrule&quot;&gt;type&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt; NodePort
  &lt;span class=&quot;token key atrule&quot;&gt;ports&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt;
    &lt;span class=&quot;token punctuation&quot;&gt;-&lt;/span&gt; &lt;span class=&quot;token key atrule&quot;&gt;name&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;token string&quot;&gt;&quot;http-port&quot;&lt;/span&gt;
      &lt;span class=&quot;token key atrule&quot;&gt;protocol&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;token string&quot;&gt;&quot;TCP&quot;&lt;/span&gt;
      &lt;span class=&quot;token key atrule&quot;&gt;port&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;token number&quot;&gt;8888&lt;/span&gt;
      &lt;span class=&quot;token key atrule&quot;&gt;targetPort&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;token number&quot;&gt;80&lt;/span&gt;
  &lt;span class=&quot;token key atrule&quot;&gt;selector&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt;
    &lt;span class=&quot;token key atrule&quot;&gt;ingress-app&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt; default
&lt;span class=&quot;token punctuation&quot;&gt;---&lt;/span&gt;
&lt;span class=&quot;token key atrule&quot;&gt;apiVersion&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt; v1
&lt;span class=&quot;token key atrule&quot;&gt;kind&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt; Pod
&lt;span class=&quot;token key atrule&quot;&gt;metadata&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt;
  &lt;span class=&quot;token key atrule&quot;&gt;name&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt; sample&lt;span class=&quot;token punctuation&quot;&gt;-&lt;/span&gt;ingress&lt;span class=&quot;token punctuation&quot;&gt;-&lt;/span&gt;default
  &lt;span class=&quot;token key atrule&quot;&gt;labels&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt;
    &lt;span class=&quot;token key atrule&quot;&gt;ingress-app&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt; default
&lt;span class=&quot;token key atrule&quot;&gt;spec&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt;
  &lt;span class=&quot;token key atrule&quot;&gt;containers&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt;
    &lt;span class=&quot;token punctuation&quot;&gt;-&lt;/span&gt; &lt;span class=&quot;token key atrule&quot;&gt;name&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt; nginx&lt;span class=&quot;token punctuation&quot;&gt;-&lt;/span&gt;container
      &lt;span class=&quot;token key atrule&quot;&gt;image&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt; amsy810/echo&lt;span class=&quot;token punctuation&quot;&gt;-&lt;/span&gt;nginx&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt;v2.0
      &lt;span class=&quot;token key atrule&quot;&gt;ports&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt;
        &lt;span class=&quot;token punctuation&quot;&gt;-&lt;/span&gt; &lt;span class=&quot;token key atrule&quot;&gt;containerPort&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;token number&quot;&gt;80&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;위 매니페스트는 각 서비스와 파드가 1:1로 매핑되어 있다. 인그레스에서는 HTTPS를 사용하는 경우 사전에 인증서를 시크릿 리소스로 생성해야 한다. 시크릿은 인증서 정보로 매니페스트를 작성하고 등록하거나 인증서 파일을 지정하여 kubectl create secret 명령어로 생성한다. 여기에서는 서명된 인증서를 생성하여 테스트한다.&lt;/p&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;sh&quot;&gt;&lt;pre class=&quot;language-sh&quot;&gt;&lt;code class=&quot;language-sh&quot;&gt;&lt;span class=&quot;token comment&quot;&gt;# 자체 생성된 인증서 생성&lt;/span&gt;
$ openssl req &lt;span class=&quot;token parameter variable&quot;&gt;-x509&lt;/span&gt; &lt;span class=&quot;token parameter variable&quot;&gt;-nodes&lt;/span&gt; &lt;span class=&quot;token parameter variable&quot;&gt;-days&lt;/span&gt; &lt;span class=&quot;token number&quot;&gt;365&lt;/span&gt; &lt;span class=&quot;token parameter variable&quot;&gt;-newkey&lt;/span&gt; rsa:2048 &lt;span class=&quot;token punctuation&quot;&gt;\&lt;/span&gt;
&lt;span class=&quot;token parameter variable&quot;&gt;-keyout&lt;/span&gt; ./tls.key &lt;span class=&quot;token parameter variable&quot;&gt;-out&lt;/span&gt; ./tls.crt &lt;span class=&quot;token parameter variable&quot;&gt;-subj&lt;/span&gt; &lt;span class=&quot;token string&quot;&gt;&quot;/CN=sample.example.com&quot;&lt;/span&gt;
Generating a &lt;span class=&quot;token number&quot;&gt;2048&lt;/span&gt; bit RSA private key
&lt;span class=&quot;token punctuation&quot;&gt;..&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;..&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;..&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;..&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;..&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;..&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;..&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;..&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;..&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;..&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;..&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;..&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;..&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;..&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;..&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;..&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;..&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;..&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;..&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;..&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;..&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;..&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;..&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;..&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;..&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;..&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;..&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;..&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;..&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;..&lt;/span&gt;.+++
&lt;span class=&quot;token punctuation&quot;&gt;..&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;..&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;..&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;..&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;..&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;..&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;..&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;..&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;..&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;..&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;..&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;..&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;..&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;..&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;..&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;..&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;..&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;..&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;..&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;..&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;..&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;..&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;..&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;..&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;..&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;..&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;..&lt;/span&gt;.+++
writing new private key to &lt;span class=&quot;token string&quot;&gt;&apos;./tls.key&apos;&lt;/span&gt;
-----

&lt;span class=&quot;token comment&quot;&gt;# 시크릿 생성(인증서 파일을 지정한 경우)&lt;/span&gt;
$ kubectl create secret tls --save-config tls-sample &lt;span class=&quot;token parameter variable&quot;&gt;--key&lt;/span&gt; ./tls.key &lt;span class=&quot;token parameter variable&quot;&gt;--cert&lt;/span&gt; ./tls.crt
secret/tls-sample created&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;위의 사전 준비를 마쳤다면, 이제는 실제 인그레스 리소스를 생성할 차례이다. 사전 준비에서는 인그레스에서 사용할 서비스 백엔드를 생성했다. 인그레스 리소스는 L7 로드 밸런서이기 때문에 특정 호스트명에 대해 &apos;요청 경로 &gt; 서비스 백엔드&apos; 형태의 쌍으로 전송 규칙을 설정한다. 또한, 하나의 IP 주소에서 여러 호스트명을 처리할 수 있다. &lt;code class=&quot;language-text&quot;&gt;spec.rules[].http.paths[].backend.servicePort&lt;/code&gt;에 설정할 포트 번호는 &lt;code class=&quot;language-text&quot;&gt;spec.ports[].port&lt;/code&gt;를 지정한다. 인그레스 리소스 매니페스트에 정의 가능한 설정은 &apos;클러스터 외부 로드 밸런서를 사용한 인그레스&apos;와 &apos;클러스터 내부에 인그레스용 파드를 배포하는 인그레스&apos;라는 두 가지 방식 중 어떤 방법을 사용하든 거의 비슷하다.&lt;/p&gt;
&lt;h3&gt;GKE용 인그레스 리소스 생성&lt;/h3&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;yaml&quot;&gt;&lt;pre class=&quot;language-yaml&quot;&gt;&lt;code class=&quot;language-yaml&quot;&gt;&lt;span class=&quot;token key atrule&quot;&gt;apiVersion&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt; networking.k8s.io/v1
&lt;span class=&quot;token key atrule&quot;&gt;kind&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt; Ingress
&lt;span class=&quot;token key atrule&quot;&gt;metadata&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt;
  &lt;span class=&quot;token key atrule&quot;&gt;name&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt; sample&lt;span class=&quot;token punctuation&quot;&gt;-&lt;/span&gt;ingress
&lt;span class=&quot;token key atrule&quot;&gt;spec&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt;
  &lt;span class=&quot;token key atrule&quot;&gt;defaultBackend&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt;
    &lt;span class=&quot;token key atrule&quot;&gt;service&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt;
      &lt;span class=&quot;token key atrule&quot;&gt;name&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt; sample&lt;span class=&quot;token punctuation&quot;&gt;-&lt;/span&gt;ingress&lt;span class=&quot;token punctuation&quot;&gt;-&lt;/span&gt;default
      &lt;span class=&quot;token key atrule&quot;&gt;port&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt;
        &lt;span class=&quot;token key atrule&quot;&gt;number&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;token number&quot;&gt;8888&lt;/span&gt;
  &lt;span class=&quot;token key atrule&quot;&gt;rules&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt;
  &lt;span class=&quot;token punctuation&quot;&gt;-&lt;/span&gt; &lt;span class=&quot;token key atrule&quot;&gt;host&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt; sample.example.com
    &lt;span class=&quot;token key atrule&quot;&gt;http&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt;
      &lt;span class=&quot;token key atrule&quot;&gt;paths&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt;
      &lt;span class=&quot;token punctuation&quot;&gt;-&lt;/span&gt; &lt;span class=&quot;token key atrule&quot;&gt;pathType&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt; Prefix
        &lt;span class=&quot;token key atrule&quot;&gt;path&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt; /path1
        &lt;span class=&quot;token key atrule&quot;&gt;backend&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt;
          &lt;span class=&quot;token key atrule&quot;&gt;service&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt;
            &lt;span class=&quot;token key atrule&quot;&gt;name&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt; sample&lt;span class=&quot;token punctuation&quot;&gt;-&lt;/span&gt;ingress&lt;span class=&quot;token punctuation&quot;&gt;-&lt;/span&gt;svc&lt;span class=&quot;token punctuation&quot;&gt;-&lt;/span&gt;&lt;span class=&quot;token number&quot;&gt;1&lt;/span&gt;
            &lt;span class=&quot;token key atrule&quot;&gt;port&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt;
              &lt;span class=&quot;token key atrule&quot;&gt;number&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;token number&quot;&gt;8888&lt;/span&gt;
  &lt;span class=&quot;token punctuation&quot;&gt;-&lt;/span&gt; &lt;span class=&quot;token key atrule&quot;&gt;host&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt; sample.example.com
    &lt;span class=&quot;token key atrule&quot;&gt;http&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt;
      &lt;span class=&quot;token key atrule&quot;&gt;paths&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt;
      &lt;span class=&quot;token punctuation&quot;&gt;-&lt;/span&gt; &lt;span class=&quot;token key atrule&quot;&gt;pathType&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt; Prefix
        &lt;span class=&quot;token key atrule&quot;&gt;path&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt; /path2
        &lt;span class=&quot;token key atrule&quot;&gt;backend&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt;
          &lt;span class=&quot;token key atrule&quot;&gt;service&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt;
            &lt;span class=&quot;token key atrule&quot;&gt;name&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt; sample&lt;span class=&quot;token punctuation&quot;&gt;-&lt;/span&gt;ingress&lt;span class=&quot;token punctuation&quot;&gt;-&lt;/span&gt;svc&lt;span class=&quot;token punctuation&quot;&gt;-&lt;/span&gt;&lt;span class=&quot;token number&quot;&gt;2&lt;/span&gt;
            &lt;span class=&quot;token key atrule&quot;&gt;port&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt;
              &lt;span class=&quot;token key atrule&quot;&gt;number&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;token number&quot;&gt;8888&lt;/span&gt;
  &lt;span class=&quot;token key atrule&quot;&gt;tls&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt;
  &lt;span class=&quot;token punctuation&quot;&gt;-&lt;/span&gt; &lt;span class=&quot;token key atrule&quot;&gt;hosts&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt;
    &lt;span class=&quot;token punctuation&quot;&gt;-&lt;/span&gt; sample.example.com
    &lt;span class=&quot;token key atrule&quot;&gt;secretName&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt; tls&lt;span class=&quot;token punctuation&quot;&gt;-&lt;/span&gt;sample
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;위의 매니페스트에는 각 경로를 앞에서 생성한 서비스에 전송하게 되어 있다. 또 &lt;code class=&quot;language-text&quot;&gt;spec.backend&lt;/code&gt; 설정에 따라 경로에 일치하지 않을 경우 기본적으로 sample-ingress-default 서비스에 전송한다. 위 매니페스트의 경우 쿠버네티스 1.22 버전 이후에 apiVersion이 networking.k8s.io/v1beta1 -&gt; networking.k8s.io/v1 으로 변경되었기 때문에 backend 하위의 serviceName, servicePort, rules 하위의 backend가 각각 name, port, defaultBackend로 변경되었다.&lt;/p&gt;
&lt;ol&gt;
&lt;li&gt;/path1/*&lt;/li&gt;
&lt;li&gt;-&gt; sample-ingress-svc-1 서비스&lt;/li&gt;
&lt;li&gt;-&gt; sample-ingress-apps-1 파드&lt;/li&gt;
&lt;/ol&gt;
&lt;/br&gt;
&lt;ol&gt;
&lt;li&gt;/path2/*&lt;/li&gt;
&lt;li&gt;-&gt; sample-ingress-svc-2 서비스&lt;/li&gt;
&lt;li&gt;-&gt; sample-ingress-apps-2 파드&lt;/li&gt;
&lt;/ol&gt;
&lt;/br&gt;
&lt;ol&gt;
&lt;li&gt;
&lt;ul&gt;
&lt;li&gt;&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;li&gt;-&gt; sample-ingress-default 서비스&lt;/li&gt;
&lt;li&gt;-&gt; sample-ingress-default 파드&lt;/li&gt;
&lt;/ol&gt;
&lt;p&gt;GKE의 경우 특별히 의식하지 않아도 인그레스 리소스마다 자동으로 로드 밸런서의 가상 IP가 할당된다. 따라서 sample-ingress.yaml 매니페스트를 적용하면 다음과 같이 인그레스 리소스가 생성되는 것을 확인할 수 있다. 여러 인그레스 리소스를 생성하면 인그레스 리소스마다 IP주소가 할당된다.&lt;/p&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;sh&quot;&gt;&lt;pre class=&quot;language-sh&quot;&gt;&lt;code class=&quot;language-sh&quot;&gt;&lt;span class=&quot;token comment&quot;&gt;# 리소스별 API 버전 확인&lt;/span&gt;
$ kubectl api-resources &lt;span class=&quot;token operator&quot;&gt;|&lt;/span&gt; &lt;span class=&quot;token function&quot;&gt;grep&lt;/span&gt; ingress
ingressclasses                                 networking.k8s.io/v1                   &lt;span class=&quot;token boolean&quot;&gt;false&lt;/span&gt;        IngressClass
ingresses                         ing          networking.k8s.io/v1                   &lt;span class=&quot;token boolean&quot;&gt;true&lt;/span&gt;         Ingress

&lt;span class=&quot;token comment&quot;&gt;# 인그레스 리소스 확인&lt;/span&gt;
$ kubectl apply &lt;span class=&quot;token parameter variable&quot;&gt;-f&lt;/span&gt;  sample-ingress.yaml
ingress.networking.k8s.io/sample-ingress created

$ kubectl get ingresses
NAME             CLASS    HOSTS                                   ADDRESS         PORTS     AGE
sample-ingress   &lt;span class=&quot;token operator&quot;&gt;&amp;lt;&lt;/span&gt;none&lt;span class=&quot;token operator&quot;&gt;&gt;&lt;/span&gt;   sample.example.com,sample.example.com   xx.xx.xx.xx   &lt;span class=&quot;token number&quot;&gt;80&lt;/span&gt;, &lt;span class=&quot;token number&quot;&gt;443&lt;/span&gt;   3m36s

&lt;span class=&quot;token comment&quot;&gt;# L7 로드밸런서의 가상 IP를 환경 변수에 저장&lt;/span&gt;
$ &lt;span class=&quot;token assign-left variable&quot;&gt;INGRESS_IP&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;token variable&quot;&gt;&lt;span class=&quot;token variable&quot;&gt;`&lt;/span&gt;kubectl get ingress sample-ingress &lt;span class=&quot;token punctuation&quot;&gt;\&lt;/span&gt;
&lt;span class=&quot;token parameter variable&quot;&gt;-o&lt;/span&gt; &lt;span class=&quot;token assign-left variable&quot;&gt;jsonpath&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;token string&quot;&gt;&apos;{.status.loadBalancer.ingress[0].ip}&apos;&lt;/span&gt;&lt;span class=&quot;token variable&quot;&gt;`&lt;/span&gt;&lt;/span&gt;

&lt;span class=&quot;token comment&quot;&gt;# 인그레스 리소스 경유의 HTTP 요청(/path1/* &gt; sample-ingress-svc-1)&lt;/span&gt;
$ &lt;span class=&quot;token function&quot;&gt;curl&lt;/span&gt; &lt;span class=&quot;token parameter variable&quot;&gt;-ivk&lt;/span&gt; http://&lt;span class=&quot;token variable&quot;&gt;${INGRESS_IP}&lt;/span&gt;/path1/ &lt;span class=&quot;token parameter variable&quot;&gt;-H&lt;/span&gt; &lt;span class=&quot;token string&quot;&gt;&quot;Host: sample.example.com&quot;&lt;/span&gt;
&lt;span class=&quot;token punctuation&quot;&gt;..&lt;/span&gt;.
&lt;span class=&quot;token assign-left variable&quot;&gt;Host&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt;sample.example.com  &lt;span class=&quot;token assign-left variable&quot;&gt;Path&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt;/path1/  &lt;span class=&quot;token assign-left variable&quot;&gt;From&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt;sample-ingress-default  &lt;span class=&quot;token assign-left variable&quot;&gt;ClientIP&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;token number&quot;&gt;10.178&lt;/span&gt;.0.6  &lt;span class=&quot;token assign-left variable&quot;&gt;XFF&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt;xx.xx.xx.xx, xx.xx.xx.xx

&lt;span class=&quot;token comment&quot;&gt;# 인그레스 리소스 경유의 HTTP 요청(/path1/* &gt; sample-ingress-svc-2)&lt;/span&gt;
$ &lt;span class=&quot;token function&quot;&gt;curl&lt;/span&gt; &lt;span class=&quot;token parameter variable&quot;&gt;-ivk&lt;/span&gt; http://&lt;span class=&quot;token variable&quot;&gt;${INGRESS_IP}&lt;/span&gt;/path2/ &lt;span class=&quot;token parameter variable&quot;&gt;-H&lt;/span&gt; &lt;span class=&quot;token string&quot;&gt;&quot;Host: sample.example.com&quot;&lt;/span&gt;
&lt;span class=&quot;token punctuation&quot;&gt;..&lt;/span&gt;.
&lt;span class=&quot;token assign-left variable&quot;&gt;Host&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt;sample.example.com  &lt;span class=&quot;token assign-left variable&quot;&gt;Path&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt;/path2/  &lt;span class=&quot;token assign-left variable&quot;&gt;From&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt;sample-ingress-apps-2  &lt;span class=&quot;token assign-left variable&quot;&gt;ClientIP&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;token number&quot;&gt;10.178&lt;/span&gt;.0.3  &lt;span class=&quot;token assign-left variable&quot;&gt;XFF&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt;xx.xx.xx.xx, xx.xx.xx.xx

&lt;span class=&quot;token comment&quot;&gt;# 인그레스 리소스 경유의 HTTP 요청(/path1/* &gt; sample-ingress-default)&lt;/span&gt;
$ &lt;span class=&quot;token function&quot;&gt;curl&lt;/span&gt; &lt;span class=&quot;token parameter variable&quot;&gt;-ivk&lt;/span&gt; http://&lt;span class=&quot;token variable&quot;&gt;${INGRESS_IP}&lt;/span&gt;/ &lt;span class=&quot;token parameter variable&quot;&gt;-H&lt;/span&gt; &lt;span class=&quot;token string&quot;&gt;&quot;Host: sample.example.com&quot;&lt;/span&gt;
&lt;span class=&quot;token assign-left variable&quot;&gt;Host&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt;sample.example.com  &lt;span class=&quot;token assign-left variable&quot;&gt;Path&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt;/  &lt;span class=&quot;token assign-left variable&quot;&gt;From&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt;sample-ingress-default  &lt;span class=&quot;token assign-left variable&quot;&gt;ClientIP&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;token number&quot;&gt;10.178&lt;/span&gt;.0.5  &lt;span class=&quot;token assign-left variable&quot;&gt;XFF&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt;xx.xx.xx.xx, xx.xx.xx.xx

&lt;span class=&quot;token comment&quot;&gt;# 인그레스 리소스 경유의 HTTPS 요청&lt;/span&gt;
$ &lt;span class=&quot;token function&quot;&gt;curl&lt;/span&gt; &lt;span class=&quot;token parameter variable&quot;&gt;-ivk&lt;/span&gt; http://&lt;span class=&quot;token variable&quot;&gt;${INGRESS_IP}&lt;/span&gt;/path1/ &lt;span class=&quot;token parameter variable&quot;&gt;-H&lt;/span&gt; &lt;span class=&quot;token string&quot;&gt;&quot;Host: sample.example.com&quot;&lt;/span&gt; &lt;span class=&quot;token parameter variable&quot;&gt;--insecure&lt;/span&gt;
&lt;span class=&quot;token assign-left variable&quot;&gt;Host&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt;sample.example.com  &lt;span class=&quot;token assign-left variable&quot;&gt;Path&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt;/path1/  &lt;span class=&quot;token assign-left variable&quot;&gt;From&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt;sample-ingress-default  &lt;span class=&quot;token assign-left variable&quot;&gt;ClientIP&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;token number&quot;&gt;10.178&lt;/span&gt;.0.3  &lt;span class=&quot;token assign-left variable&quot;&gt;XFF&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt;xx.xx.xx.xx, xx.xx.xx.xx&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;h3&gt;Nginx 인그레스용 인그레스 리소스 생성&lt;/h3&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;yaml&quot;&gt;&lt;pre class=&quot;language-yaml&quot;&gt;&lt;code class=&quot;language-yaml&quot;&gt;&lt;span class=&quot;token key atrule&quot;&gt;apiVersion&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt; networking.k8s.io/v1
&lt;span class=&quot;token key atrule&quot;&gt;kind&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt; Ingress
&lt;span class=&quot;token key atrule&quot;&gt;metadata&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt;
  &lt;span class=&quot;token key atrule&quot;&gt;name&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt; sample&lt;span class=&quot;token punctuation&quot;&gt;-&lt;/span&gt;ingress&lt;span class=&quot;token punctuation&quot;&gt;-&lt;/span&gt;by&lt;span class=&quot;token punctuation&quot;&gt;-&lt;/span&gt;nginx
  &lt;span class=&quot;token key atrule&quot;&gt;annotations&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt;
    &lt;span class=&quot;token key atrule&quot;&gt;kubernetes.io/ingress.class&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt; nginx
    &lt;span class=&quot;token key atrule&quot;&gt;nginx.ingress.kubernetes.io/ssl-redirect&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;token string&quot;&gt;&quot;false&quot;&lt;/span&gt;
&lt;span class=&quot;token key atrule&quot;&gt;spec&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt;
  &lt;span class=&quot;token key atrule&quot;&gt;defaultBackend&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt;
    &lt;span class=&quot;token key atrule&quot;&gt;service&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt;
      &lt;span class=&quot;token key atrule&quot;&gt;name&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt; sample&lt;span class=&quot;token punctuation&quot;&gt;-&lt;/span&gt;ingress&lt;span class=&quot;token punctuation&quot;&gt;-&lt;/span&gt;default
      &lt;span class=&quot;token key atrule&quot;&gt;port&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt;
        &lt;span class=&quot;token key atrule&quot;&gt;number&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;token number&quot;&gt;8888&lt;/span&gt;
  &lt;span class=&quot;token key atrule&quot;&gt;rules&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt;
  &lt;span class=&quot;token punctuation&quot;&gt;-&lt;/span&gt; &lt;span class=&quot;token key atrule&quot;&gt;host&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt; sample.example.com
    &lt;span class=&quot;token key atrule&quot;&gt;http&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt;
      &lt;span class=&quot;token key atrule&quot;&gt;paths&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt;
      &lt;span class=&quot;token punctuation&quot;&gt;-&lt;/span&gt; &lt;span class=&quot;token key atrule&quot;&gt;pathType&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt; Prefix
        &lt;span class=&quot;token key atrule&quot;&gt;path&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt; /path1
        &lt;span class=&quot;token key atrule&quot;&gt;backend&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt;
          &lt;span class=&quot;token key atrule&quot;&gt;service&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt;
            &lt;span class=&quot;token key atrule&quot;&gt;name&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt; sample&lt;span class=&quot;token punctuation&quot;&gt;-&lt;/span&gt;ingress&lt;span class=&quot;token punctuation&quot;&gt;-&lt;/span&gt;svc&lt;span class=&quot;token punctuation&quot;&gt;-&lt;/span&gt;&lt;span class=&quot;token number&quot;&gt;1&lt;/span&gt;
            &lt;span class=&quot;token key atrule&quot;&gt;port&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt;
              &lt;span class=&quot;token key atrule&quot;&gt;number&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;token number&quot;&gt;8888&lt;/span&gt;
  &lt;span class=&quot;token punctuation&quot;&gt;-&lt;/span&gt; &lt;span class=&quot;token key atrule&quot;&gt;host&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt; sample.example.com
    &lt;span class=&quot;token key atrule&quot;&gt;http&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt;
      &lt;span class=&quot;token key atrule&quot;&gt;paths&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt;
      &lt;span class=&quot;token punctuation&quot;&gt;-&lt;/span&gt; &lt;span class=&quot;token key atrule&quot;&gt;pathType&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt; Prefix
        &lt;span class=&quot;token key atrule&quot;&gt;path&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt; /path2
        &lt;span class=&quot;token key atrule&quot;&gt;backend&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt;
          &lt;span class=&quot;token key atrule&quot;&gt;service&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt;
            &lt;span class=&quot;token key atrule&quot;&gt;name&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt; sample&lt;span class=&quot;token punctuation&quot;&gt;-&lt;/span&gt;ingress&lt;span class=&quot;token punctuation&quot;&gt;-&lt;/span&gt;svc&lt;span class=&quot;token punctuation&quot;&gt;-&lt;/span&gt;&lt;span class=&quot;token number&quot;&gt;2&lt;/span&gt;
            &lt;span class=&quot;token key atrule&quot;&gt;port&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt;
              &lt;span class=&quot;token key atrule&quot;&gt;number&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;token number&quot;&gt;8888&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;Nginx 인그레스도 인그레스 리소스 설정은 기본적으로 GKE와 같다. GKE 환경에서 Nginx 인그레스를 사용하는 경우에는 GKE 인그레스가 아닌 Nginx 인그레스를 사용하도록 &lt;code class=&quot;language-text&quot;&gt;kubernetes.io/ingress.class: nginx&lt;/code&gt;의 어노테이션을 지정해야 한다. 또한, Nginx 인그레스가 GKE 인그레스용으로 생성한 인그레스 리소스 sample-ingress를 보고 있어서 동시에 동작하는 경우에는 sample-ingress에도 &lt;code class=&quot;language-text&quot;&gt;kubernetes.io/ingress.class: gce&lt;/code&gt;의 어노테이션을 지정해야 한다. 추가로, Nginx 인그레스는 기본값으로 HTTP로부터의 요청을 HTTPS로 리다이렉트하도록 설정되어 있기 때문에 이번에는 비활성화 한다.&lt;/br&gt;
Nginx 인그레스의 경우 인그레스 컨트롤러 디플로이먼트에 대한 LoadBalancer 서비스 IP 주소가 인그레스에도 등록되도록 되어 있다. 그래서 sample-ingress-by-nginx.yaml 매니페스트를 적용하면 다음과 같이 인그레스 리소스가 생성된 것을 확인할 수 있다. 여러 인그레스 리소스를 생성해도 같은 IP 주소를 사용한다.&lt;/p&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;sh&quot;&gt;&lt;pre class=&quot;language-sh&quot;&gt;&lt;code class=&quot;language-sh&quot;&gt;&lt;span class=&quot;token comment&quot;&gt;# 인그레스 리소스 목록 확인&lt;/span&gt;
$ kubectl get ingresses
NAME                      CLASS    HOSTS                                   ADDRESS         PORTS     AGE
sample-ingress-by-nginx   &lt;span class=&quot;token operator&quot;&gt;&amp;lt;&lt;/span&gt;none&lt;span class=&quot;token operator&quot;&gt;&gt;&lt;/span&gt;   sample.example.com,sample.example.com   xx.xx.xx.xx     &lt;span class=&quot;token number&quot;&gt;80&lt;/span&gt;        55s

&lt;span class=&quot;token comment&quot;&gt;# 서비스에서 해당 IP 주소를 확인해야 함&lt;/span&gt;
$ kubectl get services &lt;span class=&quot;token parameter variable&quot;&gt;-n&lt;/span&gt; ingress-nginx
NAME                                 TYPE           CLUSTER-IP    EXTERNAL-IP     PORT&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;S&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;                      AGE
ingress-nginx-controller             LoadBalancer   &lt;span class=&quot;token number&quot;&gt;10.52&lt;/span&gt;.2.120   xx.xx.xx.xx     &lt;span class=&quot;token number&quot;&gt;80&lt;/span&gt;:32139/TCP,443:32223/TCP   61s
ingress-nginx-controller-admission   ClusterIP      &lt;span class=&quot;token number&quot;&gt;10.52&lt;/span&gt;.11.86   &lt;span class=&quot;token operator&quot;&gt;&amp;lt;&lt;/span&gt;none&lt;span class=&quot;token operator&quot;&gt;&gt;&lt;/span&gt;          &lt;span class=&quot;token number&quot;&gt;443&lt;/span&gt;/TCP                      61s

&lt;span class=&quot;token comment&quot;&gt;# L7 로드밸런서의 가상 IP를 환경 변수에 저장&lt;/span&gt;
$ &lt;span class=&quot;token assign-left variable&quot;&gt;INGRESS_IP&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;token variable&quot;&gt;&lt;span class=&quot;token variable&quot;&gt;`&lt;/span&gt;kubectl get ingress sample-ingress-by-nginx &lt;span class=&quot;token punctuation&quot;&gt;\&lt;/span&gt;
&lt;span class=&quot;token parameter variable&quot;&gt;-o&lt;/span&gt; &lt;span class=&quot;token assign-left variable&quot;&gt;jsonpath&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;token string&quot;&gt;&apos;{.status.loadBalancer.ingress[0].ip}&apos;&lt;/span&gt;&lt;span class=&quot;token variable&quot;&gt;`&lt;/span&gt;&lt;/span&gt;

&lt;span class=&quot;token comment&quot;&gt;# 인그레스 리소스 경유의 HTTP 요청(/path1/* &gt; sample-ingress-svc-1)&lt;/span&gt;
$ &lt;span class=&quot;token function&quot;&gt;curl&lt;/span&gt; &lt;span class=&quot;token parameter variable&quot;&gt;-ivk&lt;/span&gt; http://&lt;span class=&quot;token variable&quot;&gt;${INGRESS_IP}&lt;/span&gt;/path1/ &lt;span class=&quot;token parameter variable&quot;&gt;-H&lt;/span&gt; &lt;span class=&quot;token string&quot;&gt;&quot;Host: sample.example.com&quot;&lt;/span&gt;
&lt;span class=&quot;token punctuation&quot;&gt;..&lt;/span&gt;.
&lt;span class=&quot;token assign-left variable&quot;&gt;Host&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt;sample.example.com  &lt;span class=&quot;token assign-left variable&quot;&gt;Path&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt;/path1/  &lt;span class=&quot;token assign-left variable&quot;&gt;From&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt;sample-ingress-default  &lt;span class=&quot;token assign-left variable&quot;&gt;ClientIP&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;token number&quot;&gt;10.178&lt;/span&gt;.0.6  &lt;span class=&quot;token assign-left variable&quot;&gt;XFF&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt;xx.xx.xx.xx, xx.xx.xx.xx

&lt;span class=&quot;token comment&quot;&gt;# 인그레스 리소스 경유의 HTTP 요청(/path1/* &gt; sample-ingress-svc-2)&lt;/span&gt;
$ &lt;span class=&quot;token function&quot;&gt;curl&lt;/span&gt; &lt;span class=&quot;token parameter variable&quot;&gt;-ivk&lt;/span&gt; http://&lt;span class=&quot;token variable&quot;&gt;${INGRESS_IP}&lt;/span&gt;/path2/ &lt;span class=&quot;token parameter variable&quot;&gt;-H&lt;/span&gt; &lt;span class=&quot;token string&quot;&gt;&quot;Host: sample.example.com&quot;&lt;/span&gt;
&lt;span class=&quot;token punctuation&quot;&gt;..&lt;/span&gt;.
&lt;span class=&quot;token assign-left variable&quot;&gt;Host&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt;sample.example.com  &lt;span class=&quot;token assign-left variable&quot;&gt;Path&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt;/path2/  &lt;span class=&quot;token assign-left variable&quot;&gt;From&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt;sample-ingress-apps-2  &lt;span class=&quot;token assign-left variable&quot;&gt;ClientIP&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;token number&quot;&gt;10.178&lt;/span&gt;.0.3  &lt;span class=&quot;token assign-left variable&quot;&gt;XFF&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt;xx.xx.xx.xx, xx.xx.xx.xx

&lt;span class=&quot;token comment&quot;&gt;# 인그레스 리소스 경유의 HTTP 요청(/path1/* &gt; sample-ingress-default)&lt;/span&gt;
$ &lt;span class=&quot;token function&quot;&gt;curl&lt;/span&gt; &lt;span class=&quot;token parameter variable&quot;&gt;-ivk&lt;/span&gt; http://&lt;span class=&quot;token variable&quot;&gt;${INGRESS_IP}&lt;/span&gt;/ &lt;span class=&quot;token parameter variable&quot;&gt;-H&lt;/span&gt; &lt;span class=&quot;token string&quot;&gt;&quot;Host: sample.example.com&quot;&lt;/span&gt;
&lt;span class=&quot;token assign-left variable&quot;&gt;Host&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt;sample.example.com  &lt;span class=&quot;token assign-left variable&quot;&gt;Path&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt;/  &lt;span class=&quot;token assign-left variable&quot;&gt;From&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt;sample-ingress-default  &lt;span class=&quot;token assign-left variable&quot;&gt;ClientIP&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;token number&quot;&gt;10.178&lt;/span&gt;.0.5  &lt;span class=&quot;token assign-left variable&quot;&gt;XFF&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt;xx.xx.xx.xx, xx.xx.xx.xx

&lt;span class=&quot;token comment&quot;&gt;# 인그레스 리소스 경유의 HTTPS 요청&lt;/span&gt;
$ &lt;span class=&quot;token function&quot;&gt;curl&lt;/span&gt; &lt;span class=&quot;token parameter variable&quot;&gt;-ivk&lt;/span&gt; http://&lt;span class=&quot;token variable&quot;&gt;${INGRESS_IP}&lt;/span&gt;/path1/ &lt;span class=&quot;token parameter variable&quot;&gt;-H&lt;/span&gt; &lt;span class=&quot;token string&quot;&gt;&quot;Host: sample.example.com&quot;&lt;/span&gt; &lt;span class=&quot;token parameter variable&quot;&gt;--insecure&lt;/span&gt;
&lt;span class=&quot;token assign-left variable&quot;&gt;Host&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt;sample.example.com  &lt;span class=&quot;token assign-left variable&quot;&gt;Path&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt;/path1/  &lt;span class=&quot;token assign-left variable&quot;&gt;From&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt;sample-ingress-default  &lt;span class=&quot;token assign-left variable&quot;&gt;ClientIP&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;token number&quot;&gt;10.178&lt;/span&gt;.0.3  &lt;span class=&quot;token assign-left variable&quot;&gt;XFF&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt;xx.xx.xx.xx, xx.xx.xx.xx&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;h2&gt;6.11.5 X-Forwarded-For 헤더에 의한 클라이언트 IP 주소 참조&lt;/h2&gt;
&lt;p&gt;인그레스 경유로 들어오는 트래픽에는 기본적으로 X-Forwarded-For(XFF) 헤더가 지정되어 있으므로 클라이언트 IP 주소 (발신 측 IP 주소)를 참조할 수 있게 되어 있다. 환경이나 사용하는 구현에 따라 지정되지 않거나 NAT되어 정확한 값을 참조할 수 없는 경우도 있다.&lt;/p&gt;
&lt;h2&gt;6.11.6 인그레스 클래스에 의한 인그레스 분리&lt;/h2&gt;
&lt;p&gt;배포한 인그레스 컨트롤러는 클러스터에 등록된 모든 인그레스 리소스를 볼 수 있어 충돌이 발생할 가능성이 있다. 이런 경우 인그레스 클래스를 사용하여 처리하는 대상의 인그레스 리소스를 분리할 수 있다. 예를 들어 서비스 A와 서비스 B가 각각 존재하고 GKE 인그레스 컨트롤러에서 인그레스 리소스를 두 개 생성한 경우, 두 개의 GCLB가 생성되고 엔드포인트는 두 개를 할당받게 된다. 그러나, Nginx 컨트롤러에서도 위의 예상되는 동작만 기대하면 예상치 못한 상황이 발생한다. 인그레스 컨트롤러 자체가 L7 로드 밸런서인 것처럼 구현되어 있어서 아무 설정을 하지 않을 경우 전체 인그레스 리소스를 watch하여 Nginx 파드 설정을 업데이트하므로 분리가 되지 않기 때문이다. &lt;/br&gt;&lt;/p&gt;
&lt;p&gt;이런 분리성을 확보하기 위해 인그레스 리소스에 인그레스 클래스의 어노테이션을 지정하고 Nginx 인그레스 컨트롤러에 해당하는 인그레스 클래스를 설정하여 대상을 분리할 수 있다.&lt;/p&gt;
&lt;h1&gt;6.12 정리&lt;/h1&gt;
&lt;table&gt;
&lt;thead&gt;
&lt;tr&gt;
&lt;th&gt;서비스 종류&lt;/th&gt;
&lt;th&gt;IP 엔드포인트 내용&lt;/th&gt;
&lt;/tr&gt;
&lt;/thead&gt;
&lt;tbody&gt;
&lt;tr&gt;
&lt;td&gt;ClusterIP&lt;/td&gt;
&lt;td&gt;쿠버네티스 노드 내부에서만 통신 가능한 가상 IP&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;ExternalIP&lt;/td&gt;
&lt;td&gt;특정 쿠버네티스 노드의 IP 주소&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;NodePort&lt;/td&gt;
&lt;td&gt;모든 쿠버네티스 노드의 모든 IP 주소(0.0.0.0)&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;LoadBalancer&lt;/td&gt;
&lt;td&gt;클러스터 외부에 제공되는 로드 밸런서의 가상 IP&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;Headless(None)&lt;/td&gt;
&lt;td&gt;파드의 IP 주소를 사용한 DNS 라운드 로빈&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;ExternalName&lt;/td&gt;
&lt;td&gt;CNAME을 사용한 느슨한 연결 확보&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;None-Selector&lt;/td&gt;
&lt;td&gt;원하는 목적지 멤버를 설정할 수 있는 다양한 엔드포인트&lt;/td&gt;
&lt;/tr&gt;
&lt;/tbody&gt;
&lt;/table&gt;
&lt;table&gt;
&lt;thead&gt;
&lt;tr&gt;
&lt;th&gt;인그레스 종류&lt;/th&gt;
&lt;th&gt;구현 예제&lt;/th&gt;
&lt;/tr&gt;
&lt;/thead&gt;
&lt;tbody&gt;
&lt;tr&gt;
&lt;td&gt;클러스터 외부 로드 밸런서를 사용한 인그레스&lt;/td&gt;
&lt;td&gt;GKE&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;클러스터 내부에 인그레스용 파드를 배포하는 인그레스&lt;/td&gt;
&lt;td&gt;Nginx 인그레스&lt;/td&gt;
&lt;/tr&gt;
&lt;/tbody&gt;
&lt;/table&gt;</content:encoded></item><item><title><![CDATA[[쿠버네티스 완벽 가이드] 13. 서비스 API 카테고리 (2) - NodePort, LoadBalancer, 그 외 서비스]]></title><description><![CDATA[6.5 NodePort NodePort 서비스는 ExternalIP와 비슷하다. 앞서 설명한 ExternalIP는 지정한 쿠버네티스 노드의 IP 주소:포트에서 수신한 트래픽을 컨테이너로 전송하는 형태로 외부와 통신할 수 있었다. 반면 NodePort…]]></description><link>https://github.com/SiverPineValley/SiverPineValley.github.io/kubernetes/kubernetes_6_2/</link><guid isPermaLink="false">https://github.com/SiverPineValley/SiverPineValley.github.io/kubernetes/kubernetes_6_2/</guid><pubDate>Mon, 12 Sep 2022 18:00:00 GMT</pubDate><content:encoded>&lt;h1&gt;6.5 NodePort&lt;/h1&gt;
&lt;p&gt;NodePort 서비스는 ExternalIP와 비슷하다. 앞서 설명한 ExternalIP는 지정한 쿠버네티스 노드의 IP 주소:포트에서 수신한 트래픽을 컨테이너로 전송하는 형태로 외부와 통신할 수 있었다. 반면 NodePort는 모든 쿠버네티스 노드의 IP 주소:포트에서 수신한 트래픽을 컨테이너에 전송하는 형태로 외부와 통신할 수 있다. ExternalIP와 유사하지만, Listen할 때 0.0.0.0:포트를 사용하여 모든 IP주소로 바인드하는 형태이다. 여기서 주의할 점은 외부라는 것이 클러스터 외부를 뜻하는 것이 아니라, 파드 네트워크(내부 네트워크) 외부의 클러스터 네트워크를 의미한다. &lt;/br&gt;
생성한 NodePort를 확인해보면 컨테이너 내부에서의 통신에 ClusterIP를 사용하기 위해 ClusterIP도 자동으로 확보된다. 컨테이너 내부에서 확인해보면 클러스터 내부 DNS에서 반환하는 서비스 디스커버리 IP 주소는 ClusterIP가 된다.&lt;/p&gt;
&lt;div align=&quot;center&quot;&gt;
  &lt;span class=&quot;gatsby-resp-image-wrapper&quot; style=&quot;position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 446px; &quot;&gt;
      &lt;a class=&quot;gatsby-resp-image-link&quot; href=&quot;/static/df126666647f8770d2c581b3773e814a/6244b/nodeport.png&quot; style=&quot;display: block&quot; target=&quot;_blank&quot; rel=&quot;noopener&quot;&gt;
    &lt;span class=&quot;gatsby-resp-image-background-image&quot; style=&quot;padding-bottom: 80.37974683544303%; position: relative; bottom: 0; left: 0; background-image: url(&apos;data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAQCAYAAAAWGF8bAAAACXBIWXMAAAsTAAALEwEAmpwYAAADBUlEQVR42nWT63PaRhTF+fv7qTPOTD518pgkjdPYTmqnxQkNJmAHAhghHoYIkBAKL1kIsIQQD/+6ErQmbqrRmd3ZPffsvbv3RKqaTUIecl42SYUYbmHySe5z8umK3+MVDmMS0c+NLee/CDRq+phIs+uQV8YUmvcx4VKxOf7rkl/fJtg/SXISLyK1pv/u7yInNNS+Q8Sf+/jzOQvfZ/kD3K5vxd6C9Wol5utwbbHF7nyj4xOZOS6+N8eeuFi2w0jA+gdjh4E5ptu36A9HmNY0XBtteaPx3ejNPGauSySYLBdL1O6YatsS9zDaQMyVzpiLyzqxlMTx+wtyJRXFGId7dcGpb7lKx8bzfOaedyeode8RBUk2bCTdIlFUSJaaSB0rXKuLvbq+4dbaO4Kz/xFsiCzO8nUOq0MOsm1+evoHe6/jvC10eVPpcZat0uxOQ/5uht53gj0hqNt8FWKVlmijYpODdJMX70s8eZfjF4HH0SLHeZ2MrFJqDEJuENMw7me4XIV3mJNb5EVpn/NVUpkSUrmFVFVpfLO56ozI1lqcVxqkS3XOcxWKVzqFqhaW73mLO8H1ak1NG5IvlDHabQy9I2Cga22yeZlSayCCplxIceLSU9HIL6mrWbSGhlSscHnVwfdX3wsafZsvOYmyLHMaPSX2IUa1XCGTyaP3J/Qsj3Q2Qzof4zR+SOxjlIpcplCQUbS+uLYVnrsjGDx5MpHk+esoP+89Yu/hMw7enJJMplgvlwRf7kuOZ/tRHj0+4sHDFzx/9Y4PsTOcyTTUmLmzjeBK3GHgBtO8Rq03Sfx2xMdXR2i1rwyG1ziOhzvzGZqiN8tV4vsHpI7/pCW4g4EZxq/EoeErB6rBK2/sdQvid25cesIZ7mwh2skWZVYolBWM4RTH9VGNa1p6n8l0xrV9Q9sYMrRuRIbbkncRLM6FFRfCl44zE0GBvW5CjIXFggQC+ymKgnRZIJPO0FY1YU07PCASZPdD+JtxJbAWJa23ZQWjaU1QmgYV0UYN9RvmyKEnPO/PF/wNf5SPpNnVhtwAAAAASUVORK5CYII=&apos;); background-size: cover; display: block;&quot;&gt;&lt;/span&gt;
  &lt;img class=&quot;gatsby-resp-image-image&quot; alt=&quot;nodeport&quot; title=&quot;&quot; src=&quot;/static/df126666647f8770d2c581b3773e814a/6244b/nodeport.png&quot; srcset=&quot;/static/df126666647f8770d2c581b3773e814a/c26ae/nodeport.png 158w,
/static/df126666647f8770d2c581b3773e814a/6bdcf/nodeport.png 315w,
/static/df126666647f8770d2c581b3773e814a/6244b/nodeport.png 446w&quot; sizes=&quot;(max-width: 446px) 100vw, 446px&quot; style=&quot;width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;&quot; loading=&quot;lazy&quot; decoding=&quot;async&quot;&gt;
  &lt;/a&gt;
    &lt;/span&gt;
&lt;/div&gt;
&lt;h2&gt;6.5.1 NodePort 생성&lt;/h2&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;yaml&quot;&gt;&lt;pre class=&quot;language-yaml&quot;&gt;&lt;code class=&quot;language-yaml&quot;&gt;&lt;span class=&quot;token key atrule&quot;&gt;apiVersion&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt; v1
&lt;span class=&quot;token key atrule&quot;&gt;kind&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt; Service
&lt;span class=&quot;token key atrule&quot;&gt;metadata&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt;
  &lt;span class=&quot;token key atrule&quot;&gt;name&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt; sample&lt;span class=&quot;token punctuation&quot;&gt;-&lt;/span&gt;nodeport
&lt;span class=&quot;token key atrule&quot;&gt;spec&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt;
  &lt;span class=&quot;token key atrule&quot;&gt;type&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt; NodePort
  &lt;span class=&quot;token key atrule&quot;&gt;ports&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt;
    &lt;span class=&quot;token punctuation&quot;&gt;-&lt;/span&gt; &lt;span class=&quot;token key atrule&quot;&gt;name&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;token string&quot;&gt;&quot;http-port&quot;&lt;/span&gt;
      &lt;span class=&quot;token key atrule&quot;&gt;protocol&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;token string&quot;&gt;&quot;TCP&quot;&lt;/span&gt;
      &lt;span class=&quot;token key atrule&quot;&gt;port&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;token number&quot;&gt;8080&lt;/span&gt;
      &lt;span class=&quot;token key atrule&quot;&gt;targetPort&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;token number&quot;&gt;80&lt;/span&gt;
      &lt;span class=&quot;token key atrule&quot;&gt;nodePort&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;token number&quot;&gt;30080&lt;/span&gt;
  &lt;span class=&quot;token key atrule&quot;&gt;selector&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt;
    &lt;span class=&quot;token key atrule&quot;&gt;app&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt; sample&lt;span class=&quot;token punctuation&quot;&gt;-&lt;/span&gt;app&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;ul&gt;
&lt;li&gt;&lt;code class=&quot;language-text&quot;&gt;spec.ports[].port&lt;/code&gt;: ClusterIP에서 수신할 포트 번호&lt;/li&gt;
&lt;li&gt;&lt;code class=&quot;language-text&quot;&gt;spec.ports[].targetPort&lt;/code&gt;: 목적지 컨테이너 포트 번호&lt;/li&gt;
&lt;li&gt;&lt;code class=&quot;language-text&quot;&gt;spec.ports[].nodePort&lt;/code&gt;: 모든 쿠버네티스 노드에서 수신할 포트 번호. 명시적으로 지정하지 않으면 빈 포트 번호가 자동으로 할당된다.&lt;/li&gt;
&lt;/ul&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;sh&quot;&gt;&lt;pre class=&quot;language-sh&quot;&gt;&lt;code class=&quot;language-sh&quot;&gt;&lt;span class=&quot;token comment&quot;&gt;# NodePort 서비스 확인&lt;/span&gt;
$ kubectl apply &lt;span class=&quot;token parameter variable&quot;&gt;-f&lt;/span&gt; sample-nodeport.yaml
service/sample-nodeport created

$ kubectl get services
NAME                TYPE        CLUSTER-IP      EXTERNAL-IP             PORT&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;S&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;          AGE
kubernetes          ClusterIP   &lt;span class=&quot;token number&quot;&gt;10.96&lt;/span&gt;.0.1       &lt;span class=&quot;token operator&quot;&gt;&amp;lt;&lt;/span&gt;none&lt;span class=&quot;token operator&quot;&gt;&gt;&lt;/span&gt;                  &lt;span class=&quot;token number&quot;&gt;443&lt;/span&gt;/TCP          43d
sample-nodeport     NodePort    &lt;span class=&quot;token number&quot;&gt;10.96&lt;/span&gt;.235.205   &lt;span class=&quot;token operator&quot;&gt;&amp;lt;&lt;/span&gt;none&lt;span class=&quot;token operator&quot;&gt;&gt;&lt;/span&gt;                  &lt;span class=&quot;token number&quot;&gt;8080&lt;/span&gt;:30080/TCP   5s

$ kubectl &lt;span class=&quot;token builtin class-name&quot;&gt;exec&lt;/span&gt; &lt;span class=&quot;token parameter variable&quot;&gt;-it&lt;/span&gt; sample-pod -- &lt;span class=&quot;token function&quot;&gt;dig&lt;/span&gt; sample-nodeport.default.svc.cluster.local
&lt;span class=&quot;token punctuation&quot;&gt;..&lt;/span&gt;.
&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt; QUESTION SECTION:
&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;sample-nodeport.default.svc.cluster.local. IN A

&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt; ANSWER SECTION:
sample-nodeport.default.svc.cluster.local. &lt;span class=&quot;token number&quot;&gt;30&lt;/span&gt; IN A &lt;span class=&quot;token number&quot;&gt;10.96&lt;/span&gt;.235.205

&lt;span class=&quot;token comment&quot;&gt;# Kind Cluster에서 요청&lt;/span&gt;
$ &lt;span class=&quot;token function&quot;&gt;curl&lt;/span&gt; &lt;span class=&quot;token parameter variable&quot;&gt;-s&lt;/span&gt; http://localhost:30080
&lt;span class=&quot;token assign-left variable&quot;&gt;Host&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt;localhost  &lt;span class=&quot;token assign-left variable&quot;&gt;Path&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt;/  &lt;span class=&quot;token assign-left variable&quot;&gt;From&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt;sample-deployment-65b84c8657-nfhch  &lt;span class=&quot;token assign-left variable&quot;&gt;ClientIP&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;token number&quot;&gt;172.18&lt;/span&gt;.0.3  &lt;span class=&quot;token assign-left variable&quot;&gt;XFF&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;h2&gt;6.5.2 NodePort 주의점&lt;/h2&gt;
&lt;p&gt;NodePort에서 사용할 수 있는 포트 범위는 통상적으로 30000 ~ 32767(쿠버네티스 기본값)이며, 범위 외의 포트를 지정하려고 하면 에러가 발생한다.&lt;/br&gt;
또만, 당연하게도 같은 포트로 여러 서비스를 띄울 수 없다.&lt;/p&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;yaml&quot;&gt;&lt;pre class=&quot;language-yaml&quot;&gt;&lt;code class=&quot;language-yaml&quot;&gt;&lt;span class=&quot;token key atrule&quot;&gt;apiVersion&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt; v1
&lt;span class=&quot;token key atrule&quot;&gt;kind&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt; Service
&lt;span class=&quot;token key atrule&quot;&gt;metadata&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt;
  &lt;span class=&quot;token key atrule&quot;&gt;name&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt; sample&lt;span class=&quot;token punctuation&quot;&gt;-&lt;/span&gt;nodeport&lt;span class=&quot;token punctuation&quot;&gt;-&lt;/span&gt;fail
&lt;span class=&quot;token key atrule&quot;&gt;spec&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt;
  &lt;span class=&quot;token key atrule&quot;&gt;type&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt; NodePort
  &lt;span class=&quot;token key atrule&quot;&gt;ports&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt;
    &lt;span class=&quot;token punctuation&quot;&gt;-&lt;/span&gt; &lt;span class=&quot;token key atrule&quot;&gt;name&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;token string&quot;&gt;&quot;http-port&quot;&lt;/span&gt;
      &lt;span class=&quot;token key atrule&quot;&gt;protocol&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;token string&quot;&gt;&quot;TCP&quot;&lt;/span&gt;
      &lt;span class=&quot;token key atrule&quot;&gt;port&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;token number&quot;&gt;8080&lt;/span&gt;
      &lt;span class=&quot;token key atrule&quot;&gt;targetPort&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;token number&quot;&gt;80&lt;/span&gt;
      &lt;span class=&quot;token key atrule&quot;&gt;nodePort&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;token number&quot;&gt;8888&lt;/span&gt;
  &lt;span class=&quot;token key atrule&quot;&gt;selector&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt;
    &lt;span class=&quot;token key atrule&quot;&gt;app&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt; sample&lt;span class=&quot;token punctuation&quot;&gt;-&lt;/span&gt;app&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;sh&quot;&gt;&lt;pre class=&quot;language-sh&quot;&gt;&lt;code class=&quot;language-sh&quot;&gt;$ kubectl apply &lt;span class=&quot;token parameter variable&quot;&gt;-f&lt;/span&gt; sample-nodeport-fail.yaml
The Service &lt;span class=&quot;token string&quot;&gt;&quot;sample-nodeport-fail&quot;&lt;/span&gt; is invalid: spec.ports&lt;span class=&quot;token punctuation&quot;&gt;[&lt;/span&gt;&lt;span class=&quot;token number&quot;&gt;0&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;]&lt;/span&gt;.nodePort: Invalid value: &lt;span class=&quot;token number&quot;&gt;8888&lt;/span&gt;: provided port is not &lt;span class=&quot;token keyword&quot;&gt;in&lt;/span&gt; the valid range. The range of valid ports is &lt;span class=&quot;token number&quot;&gt;30000&lt;/span&gt;-32767&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;h1&gt;6.6 LoadBalancer&lt;/h1&gt;
&lt;p&gt;LoadBalancer 서비스는 서비스 환경에서 클러스터 외부로부터 트래픽을 수신할 때 가장 실용적이고 사용하기 편리한 서비스이다. LoadBalancer는 쿠버네티스 클러스터 외부의 로드 밸런서에 외부 통신이 가능한 가상 IP 주소를 엔드포인트로 할당할 수 있다. 외부 로드 밸런서를 사용하려면 쿠버네티스 클러스터가 구축된 인프라가 이 구조에 맞도록 설계되어 있어야 한다. 현재는 GCP/AWS/애저(Azhure)/OpenStack을 비롯한 클라우드 프로바이저가 LoadBalancer 서비스를 사용할 수 있는 환경을 제공하고 있다. Docker Desktop for Mac/Windows에서는 LoadBalancer 서비스를 생성하면 localhost(127.0.0.1)의 IP주소를 사용하여 접속할 수 있게 한다. 따라서 같은 포트 번호를 사용하여 여러 LoadBalancer 서비스를 생성할 수 없으므로 주의하자.&lt;/br&gt;
NodePort나 ExternalIP에서는 결국 하나의 쿠버네티스 노드에 할당된 IP주소로 통신하기 때문에 그 노드가 단일 장애점이 되어 버린다. 하지만 LoadBalancer의 경우 쿠버네티스 노드와 별도로 외부 로드 밸런서를 사용하기 때문에 노드 장애가 발생해도 크게 문제가 되지 않는다. 구조는 NodePort를 생성하고 클러스터 외부로 로드 밸런서에 쿠버네티스 노드로 밸런싱을 하는 형태이다. 쿠버네티스 노드에 장애가 발생한 경우에는 그 노드에 트래픽을 전송하지 않음으로써 자동으로 복구하게 되어 있다.&lt;/p&gt;
&lt;div align=&quot;center&quot;&gt;
  &lt;span class=&quot;gatsby-resp-image-wrapper&quot; style=&quot;position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 478px; &quot;&gt;
      &lt;a class=&quot;gatsby-resp-image-link&quot; href=&quot;/static/13133a7c5a73e7f3d438a7f7f2aa59a5/50978/loadbalancer.png&quot; style=&quot;display: block&quot; target=&quot;_blank&quot; rel=&quot;noopener&quot;&gt;
    &lt;span class=&quot;gatsby-resp-image-background-image&quot; style=&quot;padding-bottom: 82.27848101265823%; position: relative; bottom: 0; left: 0; background-image: url(&apos;data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAQCAYAAAAWGF8bAAAACXBIWXMAAAsTAAALEwEAmpwYAAADPUlEQVR42o2U+08bRxSF+f8rtVUiVZWqRE1aUtrmQRDgUAgYDNj4tX7iN16wzdpeg1/rfXhtf72zIWlafulKRzt798yZO/eembXyzYTDTJ9I3uTkAZHCgEPNYGM3wa/vz/nl3Sm/bcd5c5D7wvmHa8r8Hu2+BcsFa+bQ5cqYoXf/javbKcl8g3RRJ5lrBMiWW494AdewGE09lr7Pmuc4+J6L7/4HElstl7LoAn8+Z7VaBRPmrvOIq2KeI+O5CNozh445RTfG3PQmX9DuTWlc90llKiS0MvnLJu3umNZXHAU1r39v4X4WdCTDpjEiWzUEt2Rr8i63+VjQOeo5PDtM8u3rD/yerhG+tYhk6uTrXTIB3yBX73FrWsw9j7kSHA/H5Mo3XGRrUqc68WyDuFYnlKiymdF5dZpl/STLH7Eyb5JXHCVr8r/BRUZxa8QyNaqNDrZl4fvSlIE5CIqvZYvUKg0qeoJC65Cz4g7lmzCappGQ7LKFKNpViGhxl5oR5rKSo1KqEk8Xuay2GA9HLJSg63qyxWtOz2IUcgUOwtu8/PMp70I/k8gdcHYeJRLLE4tHiGo7bIZe8HrnmXyfk8tkOY5coLcH0hjvUw1VMR3bI3p2zl8HR2xs7PLkm5949XKL0N4xx+FjqtUGhx+P2NoO8/zHDX74/gVvNw8Ifdgnnc4gZhAN56EpMlCpLuRjsVwxu7sjHtqlmU4hvhGsAsuox7dt0vt7lKJRvJkd1GyhrOTNv+ryg6DqkCc/Voslfcsl0RmSlq0kr7skmgYpvUu6c0dO7GS780BICSg8ElSDIEMxscr/Snz1tj3jebzGk70k3+3GeLqfYr3YJWTYTMW7ihfsTOA/CAZN+ZyhJaThcMpkYjMYWTT7kqH47f1RnvWtc/ajJU7ERrrEJ9MZ44kVYGa7uJ4fvB1pTCCojpjeGXCWLKEVm5gjG89Vq3o4AnX8lguf3t2UZrNFLHpBIpGShmiUShUMo0fntot5P1VHT032grYHkPQ9cb2KBXEZK+G5LHAvmZvmPelSg1RFR6t3KDQ7cmp0mtcthqPZJ9v8H3hyCYzHFv3BmMK1XFuXbU5LLUo3A3qDKd2BRdcc8zdYjo+8syD65QAAAABJRU5ErkJggg==&apos;); background-size: cover; display: block;&quot;&gt;&lt;/span&gt;
  &lt;img class=&quot;gatsby-resp-image-image&quot; alt=&quot;loadbalancer&quot; title=&quot;&quot; src=&quot;/static/13133a7c5a73e7f3d438a7f7f2aa59a5/50978/loadbalancer.png&quot; srcset=&quot;/static/13133a7c5a73e7f3d438a7f7f2aa59a5/c26ae/loadbalancer.png 158w,
/static/13133a7c5a73e7f3d438a7f7f2aa59a5/6bdcf/loadbalancer.png 315w,
/static/13133a7c5a73e7f3d438a7f7f2aa59a5/50978/loadbalancer.png 478w&quot; sizes=&quot;(max-width: 478px) 100vw, 478px&quot; style=&quot;width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;&quot; loading=&quot;lazy&quot; decoding=&quot;async&quot;&gt;
  &lt;/a&gt;
    &lt;/span&gt;
&lt;/div&gt;
&lt;h2&gt;6.6.1 LoadBalancer 생성&lt;/h2&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;yaml&quot;&gt;&lt;pre class=&quot;language-yaml&quot;&gt;&lt;code class=&quot;language-yaml&quot;&gt;&lt;span class=&quot;token key atrule&quot;&gt;apiVersion&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt; v1
&lt;span class=&quot;token key atrule&quot;&gt;kind&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt; Service
&lt;span class=&quot;token key atrule&quot;&gt;metadata&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt;
  &lt;span class=&quot;token key atrule&quot;&gt;name&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt; sample&lt;span class=&quot;token punctuation&quot;&gt;-&lt;/span&gt;lb
&lt;span class=&quot;token key atrule&quot;&gt;spec&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt;
  &lt;span class=&quot;token key atrule&quot;&gt;type&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt; LoadBalancer
  &lt;span class=&quot;token key atrule&quot;&gt;ports&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt;
    &lt;span class=&quot;token punctuation&quot;&gt;-&lt;/span&gt; &lt;span class=&quot;token key atrule&quot;&gt;name&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;token string&quot;&gt;&quot;http-port&quot;&lt;/span&gt;
      &lt;span class=&quot;token key atrule&quot;&gt;protocol&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;token string&quot;&gt;&quot;TCP&quot;&lt;/span&gt;
      &lt;span class=&quot;token key atrule&quot;&gt;port&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;token number&quot;&gt;8080&lt;/span&gt;
      &lt;span class=&quot;token key atrule&quot;&gt;targetPort&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;token number&quot;&gt;80&lt;/span&gt;
      &lt;span class=&quot;token key atrule&quot;&gt;nodePort&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;token number&quot;&gt;30082&lt;/span&gt;
  &lt;span class=&quot;token key atrule&quot;&gt;selector&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt;
    &lt;span class=&quot;token key atrule&quot;&gt;app&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt; sample&lt;span class=&quot;token punctuation&quot;&gt;-&lt;/span&gt;app&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;ul&gt;
&lt;li&gt;&lt;code class=&quot;language-text&quot;&gt;spec.ports[].port&lt;/code&gt;: 로드 밸런서에 할당되는 가상 IP와 ClusterIP에서 수신할 포트 번호.&lt;/li&gt;
&lt;li&gt;&lt;code class=&quot;language-text&quot;&gt;spec.ports[].targetPort&lt;/code&gt;: 목적지 컨테이너 포트 번호&lt;/li&gt;
&lt;li&gt;&lt;code class=&quot;language-text&quot;&gt;spec.ports[].nodePort&lt;/code&gt;: 모든 쿠버네티스 노드 IP주소에서 수신할 포트 번호&lt;/li&gt;
&lt;/ul&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;sh&quot;&gt;&lt;pre class=&quot;language-sh&quot;&gt;&lt;code class=&quot;language-sh&quot;&gt;$ kubectl apply &lt;span class=&quot;token parameter variable&quot;&gt;-f&lt;/span&gt; sample-lb.yaml
service/sample-lb created

&lt;span class=&quot;token comment&quot;&gt;# 서비스 확인&lt;/span&gt;
$ kubectl get services sample-lb &lt;span class=&quot;token parameter variable&quot;&gt;-o&lt;/span&gt; wide
NAME        TYPE           CLUSTER-IP     EXTERNAL-IP   PORT&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;S&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;          AGE     SELECTOR
sample-lb   LoadBalancer   &lt;span class=&quot;token number&quot;&gt;10.96&lt;/span&gt;.83.102   &lt;span class=&quot;token operator&quot;&gt;&amp;lt;&lt;/span&gt;pending&lt;span class=&quot;token operator&quot;&gt;&gt;&lt;/span&gt;     &lt;span class=&quot;token number&quot;&gt;8080&lt;/span&gt;:30082/TCP   2m35s   &lt;span class=&quot;token assign-left variable&quot;&gt;app&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt;sample-app&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;LoadBalancer 생성 직후에는 가상 IP 할당이 완료되지 않아 pending 상태로 보이지만, 몇 초에서 수십 초 경이 지나면 생성이 완료된다. LoadBalancer 서비스를 생성하게 되면, 컨테이너 내부에서의 통신은 ClusterIP를 사용하므로 ClusterIP와 클러스터-파드간 통신에 관여하는 NodePort도 생성된다. (kind를 사용했을 경우 metalLB를 사용하여 추가적으로 서비스를 올려야 LoadBalancer 사용이 가능하다.)&lt;/p&gt;
&lt;h2&gt;6.6.2 로드 밸런서에 할당디는 가상 IP 정적 지정&lt;/h2&gt;
&lt;p&gt;실제 서비스 운영 환경에서는 외부로부터 요청을 수신하는 IP 주소에 대해 DNS 설정 등의 이유로 고정 IP를 사용하려는 경우가 많다. 이런 경우 &lt;code class=&quot;language-text&quot;&gt;spec.loadBalancerIP&lt;/code&gt;로 외부 LoadBalancer에서 사용하는 IP 주소를 지정할 수 있다.&lt;/p&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;yaml&quot;&gt;&lt;pre class=&quot;language-yaml&quot;&gt;&lt;code class=&quot;language-yaml&quot;&gt;&lt;span class=&quot;token key atrule&quot;&gt;apiVersion&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt; v1
&lt;span class=&quot;token key atrule&quot;&gt;kind&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt; Service
&lt;span class=&quot;token key atrule&quot;&gt;metadata&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt;
  &lt;span class=&quot;token key atrule&quot;&gt;name&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt; sample&lt;span class=&quot;token punctuation&quot;&gt;-&lt;/span&gt;lb&lt;span class=&quot;token punctuation&quot;&gt;-&lt;/span&gt;fixip
&lt;span class=&quot;token key atrule&quot;&gt;spec&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt;
  &lt;span class=&quot;token key atrule&quot;&gt;type&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt; LoadBalancer
  &lt;span class=&quot;token key atrule&quot;&gt;loadBalancerIP&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt; 127.0.0.1
  &lt;span class=&quot;token key atrule&quot;&gt;ports&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt;
    &lt;span class=&quot;token punctuation&quot;&gt;-&lt;/span&gt; &lt;span class=&quot;token key atrule&quot;&gt;name&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;token string&quot;&gt;&quot;http-port&quot;&lt;/span&gt;
      &lt;span class=&quot;token key atrule&quot;&gt;protocol&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;token string&quot;&gt;&quot;TCP&quot;&lt;/span&gt;
      &lt;span class=&quot;token key atrule&quot;&gt;port&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;token number&quot;&gt;8080&lt;/span&gt;
      &lt;span class=&quot;token key atrule&quot;&gt;targetPort&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;token number&quot;&gt;80&lt;/span&gt;
  &lt;span class=&quot;token key atrule&quot;&gt;selector&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt;
    &lt;span class=&quot;token key atrule&quot;&gt;app&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt; sample&lt;span class=&quot;token punctuation&quot;&gt;-&lt;/span&gt;app&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;h2&gt;6.6.3 로드 밸런서 뱡화벽 정책 설정&lt;/h2&gt;
&lt;p&gt;LoadBalancer 서비스를 생성하면 기본적으로 외부로 완전 공개된다. GKE와 아마존 EKS에서는 LoadBalancer 서비스의 &lt;code class=&quot;language-text&quot;&gt;spec.loadBalancerSourceRanges&lt;/code&gt;에 접속을 허가하는 발신 측 네트워크를 지정하면 클러스터 밖의 외부 로드 밸런서에 클라우드 프로바이더가 제공하는 방화벽 기능을 사용하여 접속 제한을 설정할 수 있다. 지정하지 않을 경우, 0.0.0.0/0이 지정되어 전 세계에 공개된다.&lt;/p&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;yaml&quot;&gt;&lt;pre class=&quot;language-yaml&quot;&gt;&lt;code class=&quot;language-yaml&quot;&gt;&lt;span class=&quot;token key atrule&quot;&gt;apiVersion&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt; v1
&lt;span class=&quot;token key atrule&quot;&gt;kind&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt; Service
&lt;span class=&quot;token key atrule&quot;&gt;metadata&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt;
  &lt;span class=&quot;token key atrule&quot;&gt;name&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt; sample&lt;span class=&quot;token punctuation&quot;&gt;-&lt;/span&gt;lb&lt;span class=&quot;token punctuation&quot;&gt;-&lt;/span&gt;fw
&lt;span class=&quot;token key atrule&quot;&gt;spec&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt;
  &lt;span class=&quot;token key atrule&quot;&gt;type&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt; LoadBalancer
  &lt;span class=&quot;token key atrule&quot;&gt;ports&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt;
    &lt;span class=&quot;token punctuation&quot;&gt;-&lt;/span&gt; &lt;span class=&quot;token key atrule&quot;&gt;name&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;token string&quot;&gt;&quot;http-port&quot;&lt;/span&gt;
      &lt;span class=&quot;token key atrule&quot;&gt;protocol&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;token string&quot;&gt;&quot;TCP&quot;&lt;/span&gt;
      &lt;span class=&quot;token key atrule&quot;&gt;port&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;token number&quot;&gt;8080&lt;/span&gt;
      &lt;span class=&quot;token key atrule&quot;&gt;targetPort&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;token number&quot;&gt;80&lt;/span&gt;
  &lt;span class=&quot;token key atrule&quot;&gt;selector&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt;
    &lt;span class=&quot;token key atrule&quot;&gt;app&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt; sample&lt;span class=&quot;token punctuation&quot;&gt;-&lt;/span&gt;app
  &lt;span class=&quot;token key atrule&quot;&gt;loadBalancerSourceRanges&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt;
  &lt;span class=&quot;token punctuation&quot;&gt;-&lt;/span&gt; 10.0.0.0/8&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;h1&gt;6.7 그 외의 기능 (세션 어피니티 등)&lt;/h1&gt;
&lt;h2&gt;6.7.1 세션 어피니티&lt;/h2&gt;
&lt;p&gt;서비스에서는 세션 어피니티(Session Affinity)를 설정할 수 있다. 예를 들어, ClusterIP 서비스에서 활성화한 경우 ClusterIP로 보내진 트래픽은 서비스에 연결된 어느 하나의 파드에 전송된 후 다음 트래픽도 계속 같은 파드에 보내진다. 서비스에 대한 설정은 &lt;code class=&quot;language-text&quot;&gt;spec.sessionAffinity&lt;/code&gt;와 &lt;code class=&quot;language-text&quot;&gt;spec.sessionAffinityConfig&lt;/code&gt;을 사용한다. 현재 구현된 ClusterIP에서는 클라이언트 IP 주소(발신 측 IP 주소)를 바탕으로 목적지를 결정하게 된다. 이 세션 어피니티의 기능은 각 쿠버네티스 노드에 iptables로 구현되어 있으며, 최대 세션 고정 시간(&lt;code class=&quot;language-text&quot;&gt;sessionAffinityConfig.clientIP.timeoutSeconds&lt;/code&gt;)을 설정할 수 있다. 그리고 &lt;code class=&quot;language-text&quot;&gt;spec.sesisonAffinity&lt;/code&gt; 기본값은 0이다.&lt;/p&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;yaml&quot;&gt;&lt;pre class=&quot;language-yaml&quot;&gt;&lt;code class=&quot;language-yaml&quot;&gt;&lt;span class=&quot;token key atrule&quot;&gt;apiVersion&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt; v1
&lt;span class=&quot;token key atrule&quot;&gt;kind&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt; Service
&lt;span class=&quot;token key atrule&quot;&gt;metadata&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt;
  &lt;span class=&quot;token key atrule&quot;&gt;name&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt; sample&lt;span class=&quot;token punctuation&quot;&gt;-&lt;/span&gt;session&lt;span class=&quot;token punctuation&quot;&gt;-&lt;/span&gt;affinity
&lt;span class=&quot;token key atrule&quot;&gt;spec&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt;
  &lt;span class=&quot;token key atrule&quot;&gt;type&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt; LoadBalancer
  &lt;span class=&quot;token key atrule&quot;&gt;selector&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt;
    &lt;span class=&quot;token key atrule&quot;&gt;app&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt; sample&lt;span class=&quot;token punctuation&quot;&gt;-&lt;/span&gt;app
  &lt;span class=&quot;token key atrule&quot;&gt;ports&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt;
  &lt;span class=&quot;token punctuation&quot;&gt;-&lt;/span&gt; &lt;span class=&quot;token key atrule&quot;&gt;name&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt; http&lt;span class=&quot;token punctuation&quot;&gt;-&lt;/span&gt;port
    &lt;span class=&quot;token key atrule&quot;&gt;protocol&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt; TCP
    &lt;span class=&quot;token key atrule&quot;&gt;port&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;token number&quot;&gt;8080&lt;/span&gt;
    &lt;span class=&quot;token key atrule&quot;&gt;targetPort&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;token number&quot;&gt;80&lt;/span&gt;
    &lt;span class=&quot;token key atrule&quot;&gt;nodePort&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;token number&quot;&gt;30084&lt;/span&gt;
  &lt;span class=&quot;token key atrule&quot;&gt;sessionAffinity&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt; ClientIP
  &lt;span class=&quot;token key atrule&quot;&gt;sessionAffinityConfig&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt;
    &lt;span class=&quot;token key atrule&quot;&gt;clientIP&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt;
      &lt;span class=&quot;token key atrule&quot;&gt;timeoutSeconds&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;token number&quot;&gt;10&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;sh&quot;&gt;&lt;pre class=&quot;language-sh&quot;&gt;&lt;code class=&quot;language-sh&quot;&gt;&lt;span class=&quot;token comment&quot;&gt;# Session Affinity 생성&lt;/span&gt;
$ kubectl apply &lt;span class=&quot;token parameter variable&quot;&gt;-f&lt;/span&gt; sample-session-affinity.yaml
service/sample-session-affinity created

&lt;span class=&quot;token comment&quot;&gt;# 첫 번째 요청&lt;/span&gt;
$ kubectl &lt;span class=&quot;token builtin class-name&quot;&gt;exec&lt;/span&gt; &lt;span class=&quot;token parameter variable&quot;&gt;-it&lt;/span&gt; sample-pod -- &lt;span class=&quot;token function&quot;&gt;curl&lt;/span&gt; http://sample-session-affinity.default.svc.cluster.local:8080
&lt;span class=&quot;token assign-left variable&quot;&gt;Host&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt;sample-session-affinity.default.svc.cluster.local  &lt;span class=&quot;token assign-left variable&quot;&gt;Path&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt;/  &lt;span class=&quot;token assign-left variable&quot;&gt;From&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt;sample-deployment-65b84c8657-b5795  &lt;span class=&quot;token assign-left variable&quot;&gt;ClientIP&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;token number&quot;&gt;10.244&lt;/span&gt;.1.2  &lt;span class=&quot;token assign-left variable&quot;&gt;XFF&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt;

&lt;span class=&quot;token comment&quot;&gt;# 두 번째 요청&lt;/span&gt;
$ kubectl &lt;span class=&quot;token builtin class-name&quot;&gt;exec&lt;/span&gt; &lt;span class=&quot;token parameter variable&quot;&gt;-it&lt;/span&gt; sample-pod -- &lt;span class=&quot;token function&quot;&gt;curl&lt;/span&gt; http://sample-session-affinity.default.svc.cluster.local:8080
&lt;span class=&quot;token assign-left variable&quot;&gt;Host&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt;sample-session-affinity.default.svc.cluster.local  &lt;span class=&quot;token assign-left variable&quot;&gt;Path&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt;/  &lt;span class=&quot;token assign-left variable&quot;&gt;From&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt;sample-deployment-65b84c8657-b5795  &lt;span class=&quot;token assign-left variable&quot;&gt;ClientIP&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;token number&quot;&gt;10.244&lt;/span&gt;.1.2  &lt;span class=&quot;token assign-left variable&quot;&gt;XFF&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt;

&lt;span class=&quot;token comment&quot;&gt;# 세 번째 요청&lt;/span&gt;
$ kubectl &lt;span class=&quot;token builtin class-name&quot;&gt;exec&lt;/span&gt; &lt;span class=&quot;token parameter variable&quot;&gt;-it&lt;/span&gt; sample-pod -- &lt;span class=&quot;token function&quot;&gt;curl&lt;/span&gt; http://sample-session-affinity.default.svc.cluster.local:8080
&lt;span class=&quot;token assign-left variable&quot;&gt;Host&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt;sample-session-affinity.default.svc.cluster.local  &lt;span class=&quot;token assign-left variable&quot;&gt;Path&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt;/  &lt;span class=&quot;token assign-left variable&quot;&gt;From&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt;sample-deployment-65b84c8657-b5795  &lt;span class=&quot;token assign-left variable&quot;&gt;ClientIP&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;token number&quot;&gt;10.244&lt;/span&gt;.1.2  &lt;span class=&quot;token assign-left variable&quot;&gt;XFF&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt;

&lt;span class=&quot;token comment&quot;&gt;# 10초 뒤 요청&lt;/span&gt;
$ kubectl &lt;span class=&quot;token builtin class-name&quot;&gt;exec&lt;/span&gt; &lt;span class=&quot;token parameter variable&quot;&gt;-it&lt;/span&gt; sample-pod -- &lt;span class=&quot;token function&quot;&gt;curl&lt;/span&gt; http://sample-session-affinity.default.svc.cluster.local:8080
&lt;span class=&quot;token assign-left variable&quot;&gt;Host&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt;sample-session-affinity.default.svc.cluster.local  &lt;span class=&quot;token assign-left variable&quot;&gt;Path&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt;/  &lt;span class=&quot;token assign-left variable&quot;&gt;From&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt;sample-deployment-65b84c8657-v244g  &lt;span class=&quot;token assign-left variable&quot;&gt;ClientIP&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;token number&quot;&gt;10.244&lt;/span&gt;.1.2  &lt;span class=&quot;token assign-left variable&quot;&gt;XFF&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;NodePort나 LoadBalancer 레벨에서도 세션 어피니티를 활성화할 수 있으나, 같은 노드의 같은 ClientIP라도 같은 파드에 전송된다고 보장할 수 없으므로 잘 사용되지 않는다.&lt;/p&gt;
&lt;h2&gt;6.7.2 노드 간 통신 제외와 발신 측 IP 주소 유지&lt;/h2&gt;
&lt;p&gt;NodePort와 LoadBalancer 서비스에서 쿠버네티스 노드에 도착한 요청은 노드를 통해 파드에서 로드 밸런싱하게 되어 있으므로 불필요한 2단계 로드 밸런싱이 이루어진다. 예를 들어, LoadBalancer 서비스에서 로드 밸런서가 로드 밸런싱하여 노드에 도착한 요청은 노드를 통해 파드에도 로드 밸런싱되는 형태이다. 이 2단계 로드 밸런싱은 균일하게 요청을 분산하기에는 쉽지만, 불필요한 Latency Overhead가 발생하거나 밸런싱을 수행할 때 네트워크 주소 변환이 이루어져 발신 측 IP 주소가 유실되는 특징이 있다.&lt;/br&gt;&lt;/p&gt;
&lt;p&gt;반면 데몬셋은 하나의 노드에 하나의 파드가 배치되므로, 굳이 다른 노드의 파드에 전송하지 않고 같은 노드에만 통신하고 싶은 경우가 있다. 그런 경우 &lt;code class=&quot;language-text&quot;&gt;spec.externalTrraficPolicy&lt;/code&gt;를 이용할 수 있다. 단, ClusterIP에서는 사용할 수 없다.&lt;/p&gt;
&lt;table&gt;
&lt;thead&gt;
&lt;tr&gt;
&lt;th&gt;externalTrafficPolicy 설정값&lt;/th&gt;
&lt;th&gt;설명&lt;/th&gt;
&lt;/tr&gt;
&lt;/thead&gt;
&lt;tbody&gt;
&lt;tr&gt;
&lt;td&gt;Cluster(기본값)&lt;/td&gt;
&lt;td&gt;노드에 트래픽이 도착한 후 다른 노드에 있는 파드를 포함하여 다시 로드 밸런싱함으로써 파드 부하를 균등하게 분산.&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;Local&lt;/td&gt;
&lt;td&gt;노드에 트래픽이 도착한 후 노드 간 로드 밸런싱을 하지 않는다.&lt;/td&gt;
&lt;/tr&gt;
&lt;/tbody&gt;
&lt;/table&gt;
&lt;p&gt;&lt;code class=&quot;language-text&quot;&gt;spec.externalTrafficPolicy&lt;/code&gt;가 Cluster인 경우 앞서 설명한 바와 같고, Local인 경우 LoadBalancer 서비스와 NodePort 서비스 둘 다 외부에서 해당 노드에 도착한 요청은 그 노드상에 있는 파드에만 전송된다. 만약, 해당 노드상에 파드가 없다면 요청에 응답할 수 없다. LoadBalancer 서비스에서 사용하면 별도로 헬스 체크용 NodePort가 할당되기 때문에 파드가 존재하지 않는 노드에는 로드 밸런서에서 요청이 전송되지 않는다. 헬스 체크용 NodePort는 &lt;code class=&quot;language-text&quot;&gt;spec.healthCheckNodePort&lt;/code&gt;에서 설정할 수 있다. 이 설정은 LoadBalancer 서비스와 &lt;code class=&quot;language-text&quot;&gt;externalTrafficPolicy&lt;/code&gt;가 Local인 경우에만 설정 가능하다.&lt;/p&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;yaml&quot;&gt;&lt;pre class=&quot;language-yaml&quot;&gt;&lt;code class=&quot;language-yaml&quot;&gt;&lt;span class=&quot;token key atrule&quot;&gt;apiVersion&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt; v1
&lt;span class=&quot;token key atrule&quot;&gt;kind&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt; Service
&lt;span class=&quot;token key atrule&quot;&gt;metadata&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt;
  &lt;span class=&quot;token key atrule&quot;&gt;name&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt; sample&lt;span class=&quot;token punctuation&quot;&gt;-&lt;/span&gt;lb&lt;span class=&quot;token punctuation&quot;&gt;-&lt;/span&gt;local
  &lt;span class=&quot;token key atrule&quot;&gt;type&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt; LoadBalancer
  &lt;span class=&quot;token key atrule&quot;&gt;externalTrafficPolicy&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt; Local
  &lt;span class=&quot;token key atrule&quot;&gt;healthCheckNodePort&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;token number&quot;&gt;30086&lt;/span&gt;
  &lt;span class=&quot;token key atrule&quot;&gt;ports&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt;
  &lt;span class=&quot;token punctuation&quot;&gt;-&lt;/span&gt; &lt;span class=&quot;token key atrule&quot;&gt;name&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;token string&quot;&gt;&quot;http-port&quot;&lt;/span&gt;
    &lt;span class=&quot;token key atrule&quot;&gt;protocol&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;token string&quot;&gt;&quot;TCP&quot;&lt;/span&gt;
    &lt;span class=&quot;token key atrule&quot;&gt;port&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;token number&quot;&gt;8080&lt;/span&gt;
    &lt;span class=&quot;token key atrule&quot;&gt;targetPort&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;token number&quot;&gt;80&lt;/span&gt;
    &lt;span class=&quot;token key atrule&quot;&gt;nodePort&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;token number&quot;&gt;30085&lt;/span&gt;
  &lt;span class=&quot;token key atrule&quot;&gt;selector&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt;
    &lt;span class=&quot;token key atrule&quot;&gt;app&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt; sample&lt;span class=&quot;token punctuation&quot;&gt;-&lt;/span&gt;app&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;h2&gt;출처&lt;/h2&gt;
&lt;p&gt;&lt;a href=&quot;https://dev-youngjun.tistory.com/20&quot;&gt;https://dev-youngjun.tistory.com/20&lt;/a&gt;&lt;/p&gt;</content:encoded></item><item><title><![CDATA[[쿠버네티스 완벽 가이드] 12. 서비스 API 카테고리 (1) - 서비스 API 카테고리 개요 및 쿠버네티스 클러스터 네트워크와 서비스]]></title><description><![CDATA[6.1 서비스 API 카테고리 서비스 API 카테고리는 클러스터상 컨테이너에 대한 엔드포인트를 제공하거나 레이블과 일치하는 컨테이너의 디스커버리에 사용되는 리소스이다. 내부적으로 사용되는 리소스를 제외하고 사용자가 직접 사용하는 것은 L…]]></description><link>https://github.com/SiverPineValley/SiverPineValley.github.io/kubernetes/kubernetes_6_1/</link><guid isPermaLink="false">https://github.com/SiverPineValley/SiverPineValley.github.io/kubernetes/kubernetes_6_1/</guid><pubDate>Fri, 09 Sep 2022 18:00:00 GMT</pubDate><content:encoded>&lt;h1&gt;6.1 서비스 API 카테고리&lt;/h1&gt;
&lt;p&gt;서비스 API 카테고리는 클러스터상 컨테이너에 대한 엔드포인트를 제공하거나 레이블과 일치하는 컨테이너의 디스커버리에 사용되는 리소스이다. 내부적으로 사용되는 리소스를 제외하고 사용자가 직접 사용하는 것은 L4 로드밸런싱을 제공하는 서비스 리소스와 L7 로드밸런싱을 제공하는 인그레스 리소스가 있다. 또한, 서비스 리소스에는 제공 목적에 따라 클러스터 내부나 클러스터 외부에서 접속할 수 있는, 접속 창구가 되는 가상 IP 등의 엔드포인트를 제공하고 있다. 그리고 제공 목적에 따라 일곱 가지 서비스 타입을 가지고 있다.&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;Cluster IP&lt;/li&gt;
&lt;li&gt;External IP(Cluster IP의 한 종류)&lt;/li&gt;
&lt;li&gt;NodePort&lt;/li&gt;
&lt;li&gt;LoadBalancer&lt;/li&gt;
&lt;li&gt;Headless(None)&lt;/li&gt;
&lt;li&gt;ExternalName&lt;/li&gt;
&lt;li&gt;None-Selector&lt;/li&gt;
&lt;li&gt;인그레스&lt;/li&gt;
&lt;/ul&gt;
&lt;h1&gt;6.2 쿠버네티스 클러스터 네트워크와 서비스&lt;/h1&gt;
&lt;p&gt;쿠버네티스 네트워크를 설명하기 전 이전에 설명했던 내용을 다시 한 번 상기시켜보자. 파드 내부에는 여러 컨테이너가 존재할 수 있는데, 하나의 파드 내부의 컨테이너들은 모두 같은 IP주소를 공유한다. 즉, 파드 내부 컨테이너들간의 통신은 localhost로 통신하고, 다른 파드에 있는 컨테이너는 파드의 IP주소로 통신한다.  쿠버네티스 클러스터를 생성하면 노드상에 파드를 위한 내부 네트워크가 자동으로 구성된다. 내부 네트워크 구성은 사용할 CNI(Container Network Interface)라는 플러그형 모듈 구현에 따라 다르지만, 기본적으로 노드별로 다른 네트워크를 구성하고 노드 간 트래픽은 VXLAN이나 L2 Routing 등의 기술로 전송한다. 노드별 네트워크 세그먼트는 쿠버네티스 클러스터 전체에 할당된 네트워크 세그먼트를 자동으로 분할해 할당하므로, 사용자가 설정하지 않아도 된다.&lt;/br&gt;&lt;/p&gt;
&lt;p&gt;이러한 내부 네트워크가 자동으로 구성되기 때문에 파다는 서비스를 사용하지 않고도 파드 간 통신이 가능하다. 서비스를 사용하면 다음 두 가지 장점을 얻을 수 있다.&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;파드에 트래픽 로드 밸런싱&lt;/li&gt;
&lt;li&gt;서비스 디스커버리와 클러스터 내부 DNS&lt;/li&gt;
&lt;/ul&gt;
&lt;h2&gt;6.2.1 파드에 트래픽 로드 밸런싱&lt;/h2&gt;
&lt;p&gt;서비스는 수신한 트래픽을 여러 파드에 로드밸런싱 하는 기능을 제공한다. 디플로이먼트를 사용하여 여러 파드를 구성하면, 각 파드에는 서로 다른 IP주소가 부여되기 때문에 로드 밸런싱 구조를 자체적으로 구현하려면 각 파드의 IP주소를 매번 조회하거나 전송 대상의 목적지를 설정해야 한다. 하지만, 서비스를 사용하면 여러 파드에 대한 로드밸런싱을 자동으로 구현할 수 있다. 또한, 서비스는 로드 밸런싱의 엔드포인트를 제공한다.&lt;/p&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;yaml&quot;&gt;&lt;pre class=&quot;language-yaml&quot;&gt;&lt;code class=&quot;language-yaml&quot;&gt;&lt;span class=&quot;token key atrule&quot;&gt;apiVersion&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt; apps/v1
&lt;span class=&quot;token key atrule&quot;&gt;kind&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt; Deployment
&lt;span class=&quot;token key atrule&quot;&gt;metadata&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt;
  &lt;span class=&quot;token key atrule&quot;&gt;name&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt; sample&lt;span class=&quot;token punctuation&quot;&gt;-&lt;/span&gt;deployment
&lt;span class=&quot;token key atrule&quot;&gt;spec&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt;
  &lt;span class=&quot;token key atrule&quot;&gt;replicas&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;token number&quot;&gt;3&lt;/span&gt;
  &lt;span class=&quot;token key atrule&quot;&gt;selector&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt;
    &lt;span class=&quot;token key atrule&quot;&gt;matchLabels&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt;
      &lt;span class=&quot;token key atrule&quot;&gt;app&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt; sample&lt;span class=&quot;token punctuation&quot;&gt;-&lt;/span&gt;app
  &lt;span class=&quot;token key atrule&quot;&gt;template&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt;
    &lt;span class=&quot;token key atrule&quot;&gt;metadata&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt;
      &lt;span class=&quot;token key atrule&quot;&gt;labels&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt;
        &lt;span class=&quot;token key atrule&quot;&gt;app&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt; sample&lt;span class=&quot;token punctuation&quot;&gt;-&lt;/span&gt;app
    &lt;span class=&quot;token key atrule&quot;&gt;spec&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt;
      &lt;span class=&quot;token key atrule&quot;&gt;containers&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt;
        &lt;span class=&quot;token punctuation&quot;&gt;-&lt;/span&gt; &lt;span class=&quot;token key atrule&quot;&gt;name&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt; nginx&lt;span class=&quot;token punctuation&quot;&gt;-&lt;/span&gt;container
          &lt;span class=&quot;token key atrule&quot;&gt;image&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt; amsy810/echo&lt;span class=&quot;token punctuation&quot;&gt;-&lt;/span&gt;nginx&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt;v2.0&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;sh&quot;&gt;&lt;pre class=&quot;language-sh&quot;&gt;&lt;code class=&quot;language-sh&quot;&gt;&lt;span class=&quot;token comment&quot;&gt;# 디플로이먼트 생성&lt;/span&gt;
$ kubectl apply &lt;span class=&quot;token parameter variable&quot;&gt;-f&lt;/span&gt; sample-deployment.yaml
deployment.apps/sample-deployment configured

&lt;span class=&quot;token comment&quot;&gt;# 생성된 파드 레이블 출력&lt;/span&gt;
$ kubectl get pods &lt;span class=&quot;token parameter variable&quot;&gt;-o&lt;/span&gt; custom-columns&lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;token string&quot;&gt;&quot;NAME:{.metadata.name},LABEL:{.metadata.labels}&quot;&lt;/span&gt;
NAME                                 LABEL
sample-deployment-65b84c8657-b5795   map&lt;span class=&quot;token punctuation&quot;&gt;[&lt;/span&gt;app:sample-app pod-template-hash:65b84c8657&lt;span class=&quot;token punctuation&quot;&gt;]&lt;/span&gt;
sample-deployment-65b84c8657-nfhch   map&lt;span class=&quot;token punctuation&quot;&gt;[&lt;/span&gt;app:sample-app pod-template-hash:65b84c8657&lt;span class=&quot;token punctuation&quot;&gt;]&lt;/span&gt;
sample-deployment-65b84c8657-v244g   map&lt;span class=&quot;token punctuation&quot;&gt;[&lt;/span&gt;app:sample-app pod-template-hash:65b84c8657&lt;span class=&quot;token punctuation&quot;&gt;]&lt;/span&gt;
sample-pod                           &lt;span class=&quot;token operator&quot;&gt;&amp;lt;&lt;/span&gt;none&lt;span class=&quot;token operator&quot;&gt;&gt;&lt;/span&gt;

&lt;span class=&quot;token comment&quot;&gt;# 출력 시 특정 JSON Path(예제에서는 레이블) 값만을 출력&lt;/span&gt;
$ kubectl get pods sample-deployment-65b84c8657-b5795 &lt;span class=&quot;token parameter variable&quot;&gt;-o&lt;/span&gt; &lt;span class=&quot;token assign-left variable&quot;&gt;jsonpath&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;token string&quot;&gt;&apos;{.metadata.labels}&apos;&lt;/span&gt;
&lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;&lt;span class=&quot;token string&quot;&gt;&quot;app&quot;&lt;/span&gt;&lt;span class=&quot;token builtin class-name&quot;&gt;:&lt;/span&gt;&lt;span class=&quot;token string&quot;&gt;&quot;sample-app&quot;&lt;/span&gt;,&lt;span class=&quot;token string&quot;&gt;&quot;pod-template-hash&quot;&lt;/span&gt;&lt;span class=&quot;token builtin class-name&quot;&gt;:&lt;/span&gt;&lt;span class=&quot;token string&quot;&gt;&quot;65b84c8657&quot;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;%&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;다음으로는, 엔드포인트의 서비스 종류에 ClusterIP를 사용하는 서비스를 생성해보겠다. 서비스 종류는 나중에 자세히 설명하겠지만, ClusterIP는 클러스터 내부에서만 사용 가능한 가상 IP를 가진 엔드포인트를 제공하는 로드 밸런서를 구성한다. 서비스는 &lt;code class=&quot;language-text&quot;&gt;.spec.selector&lt;/code&gt;에 정의할 셀렉터 조건에 따라 트래픽을 전송한다.&lt;/p&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;yaml&quot;&gt;&lt;pre class=&quot;language-yaml&quot;&gt;&lt;code class=&quot;language-yaml&quot;&gt;&lt;span class=&quot;token key atrule&quot;&gt;apiVersion&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt; v1
&lt;span class=&quot;token key atrule&quot;&gt;kind&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt; Service
&lt;span class=&quot;token key atrule&quot;&gt;metadata&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt;
  &lt;span class=&quot;token key atrule&quot;&gt;name&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt; sample&lt;span class=&quot;token punctuation&quot;&gt;-&lt;/span&gt;clusterip
&lt;span class=&quot;token key atrule&quot;&gt;spec&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt;
  &lt;span class=&quot;token key atrule&quot;&gt;type&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt; ClusterIP
  &lt;span class=&quot;token key atrule&quot;&gt;ports&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt;
    &lt;span class=&quot;token punctuation&quot;&gt;-&lt;/span&gt; &lt;span class=&quot;token key atrule&quot;&gt;name&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;token string&quot;&gt;&quot;http-port&quot;&lt;/span&gt;
      &lt;span class=&quot;token key atrule&quot;&gt;protocol&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;token string&quot;&gt;&quot;TCP&quot;&lt;/span&gt;
      &lt;span class=&quot;token key atrule&quot;&gt;port&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;token number&quot;&gt;8080&lt;/span&gt;
      &lt;span class=&quot;token key atrule&quot;&gt;targetPort&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;token number&quot;&gt;80&lt;/span&gt;
  &lt;span class=&quot;token key atrule&quot;&gt;selector&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt;
    &lt;span class=&quot;token key atrule&quot;&gt;app&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt; sample&lt;span class=&quot;token punctuation&quot;&gt;-&lt;/span&gt;app&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;서비스를 생성하면 로드 밸런서의 트래픽이 전송되는 파드를 확인해보자. 먼저 &lt;code class=&quot;language-text&quot;&gt;app: sample-app&lt;/code&gt; 레이블을 가진 파드 IP 주소를 확인해야 한다.&lt;/p&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;sh&quot;&gt;&lt;pre class=&quot;language-sh&quot;&gt;&lt;code class=&quot;language-sh&quot;&gt;&lt;span class=&quot;token comment&quot;&gt;# 서비스 생성&lt;/span&gt;
$ kubectl apply &lt;span class=&quot;token parameter variable&quot;&gt;-f&lt;/span&gt; sample-clusterip.yaml
service/sample-clusterip created

&lt;span class=&quot;token comment&quot;&gt;# 지정한 레이블을 가진 파드 정보 중 특정 JSON Path를 컬럼으로 출력&lt;/span&gt;
$ kubectl get pods &lt;span class=&quot;token parameter variable&quot;&gt;-l&lt;/span&gt; &lt;span class=&quot;token assign-left variable&quot;&gt;app&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt;sample-app &lt;span class=&quot;token parameter variable&quot;&gt;-o&lt;/span&gt; custom-columns&lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;token string&quot;&gt;&quot;NAME:{metadata.name},IP:{status.podIP}&quot;&lt;/span&gt;
NAME                                 IP
sample-deployment-65b84c8657-b5795   &lt;span class=&quot;token number&quot;&gt;10.244&lt;/span&gt;.2.8
sample-deployment-65b84c8657-nfhch   &lt;span class=&quot;token number&quot;&gt;10.244&lt;/span&gt;.1.8
sample-deployment-65b84c8657-v244g   &lt;span class=&quot;token number&quot;&gt;10.244&lt;/span&gt;.3.35

&lt;span class=&quot;token comment&quot;&gt;# 서비스 정보 확인 (엔드포인트: 10.96.214.33)&lt;/span&gt;
$ kubectl get services sample-clusterip
NAME               TYPE        CLUSTER-IP     EXTERNAL-IP   PORT&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;S&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;    AGE
sample-clusterip   ClusterIP   &lt;span class=&quot;token number&quot;&gt;10.96&lt;/span&gt;.214.33   &lt;span class=&quot;token operator&quot;&gt;&amp;lt;&lt;/span&gt;none&lt;span class=&quot;token operator&quot;&gt;&gt;&lt;/span&gt;        &lt;span class=&quot;token number&quot;&gt;8080&lt;/span&gt;/TCP   46s

&lt;span class=&quot;token comment&quot;&gt;# 서비스 상세 정보 확인&lt;/span&gt;
$ kubectl describe &lt;span class=&quot;token function&quot;&gt;service&lt;/span&gt; sample-clusterip
Name:              sample-clusterip
Namespace:         default
Labels:            &lt;span class=&quot;token operator&quot;&gt;&amp;lt;&lt;/span&gt;none&lt;span class=&quot;token operator&quot;&gt;&gt;&lt;/span&gt;
Annotations:       &lt;span class=&quot;token operator&quot;&gt;&amp;lt;&lt;/span&gt;none&lt;span class=&quot;token operator&quot;&gt;&gt;&lt;/span&gt;
Selector:          &lt;span class=&quot;token assign-left variable&quot;&gt;app&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt;sample-app
Type:              ClusterIP
IP Family Policy:  SingleStack
IP Families:       IPv4
IP:                &lt;span class=&quot;token number&quot;&gt;10.96&lt;/span&gt;.214.33
IPs:               &lt;span class=&quot;token number&quot;&gt;10.96&lt;/span&gt;.214.33
Port:              http-port  &lt;span class=&quot;token number&quot;&gt;8080&lt;/span&gt;/TCP
TargetPort:        &lt;span class=&quot;token number&quot;&gt;80&lt;/span&gt;/TCP
Endpoints:         &lt;span class=&quot;token number&quot;&gt;10.244&lt;/span&gt;.1.8:80,10.244.2.8:80,10.244.3.35:80
Session Affinity:  None
Events:            &lt;span class=&quot;token operator&quot;&gt;&amp;lt;&lt;/span&gt;none&lt;span class=&quot;token operator&quot;&gt;&gt;&lt;/span&gt;

&lt;span class=&quot;token comment&quot;&gt;# 별도 파드를 생성하여 접속&lt;/span&gt;
$ kubectl apply &lt;span class=&quot;token parameter variable&quot;&gt;-f&lt;/span&gt; sample-pod.yaml
pod/sample-pod created

$ kubectl &lt;span class=&quot;token builtin class-name&quot;&gt;exec&lt;/span&gt; &lt;span class=&quot;token parameter variable&quot;&gt;-it&lt;/span&gt; sample-pod -- /bin/bash

&lt;span class=&quot;token comment&quot;&gt;# 서비스 엔드포인트로 요청&lt;/span&gt;
root@sample-pod: &lt;span class=&quot;token function&quot;&gt;curl&lt;/span&gt; &lt;span class=&quot;token parameter variable&quot;&gt;-s&lt;/span&gt; http://10.96.214.33:8080
&lt;span class=&quot;token assign-left variable&quot;&gt;Host&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;token number&quot;&gt;10.96&lt;/span&gt;.214.33  &lt;span class=&quot;token assign-left variable&quot;&gt;Path&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt;/  &lt;span class=&quot;token assign-left variable&quot;&gt;From&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt;sample-deployment-65b84c8657-v244g  &lt;span class=&quot;token assign-left variable&quot;&gt;ClientIP&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;token number&quot;&gt;10.244&lt;/span&gt;.1.9  &lt;span class=&quot;token assign-left variable&quot;&gt;XFF&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;Endpoints 부분에 아무 것도 표시되지 않았을 경우 셀렉터 조건이 맞지 않을 가능성이 있다. 이번 예제에서는 서비스 엔드포인트 타입을 ClusterIP로 설정했기 때문에 가상 엔드포인트는 클러스터 내부에서만 호출 가능하다.&lt;/p&gt;
&lt;h3&gt;여러 포트 할당&lt;/h3&gt;
&lt;p&gt;이전 예제에서는 서비스에 하나의 포트만 할당했었는데, 서비스에 여러 포트를 할당 가능하다. 아래 예제에서는 ClusterIP의 8080 포트를 파드 80포트로, ClusterIP의 8443 포트를 파드 443 포트로 로드밸런싱한다.&lt;/p&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;yaml&quot;&gt;&lt;pre class=&quot;language-yaml&quot;&gt;&lt;code class=&quot;language-yaml&quot;&gt;&lt;span class=&quot;token key atrule&quot;&gt;apiVersion&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt; v1
&lt;span class=&quot;token key atrule&quot;&gt;kind&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt; Service
&lt;span class=&quot;token key atrule&quot;&gt;metadata&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt;
  &lt;span class=&quot;token key atrule&quot;&gt;name&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt; sample&lt;span class=&quot;token punctuation&quot;&gt;-&lt;/span&gt;clusterip&lt;span class=&quot;token punctuation&quot;&gt;-&lt;/span&gt;multi
&lt;span class=&quot;token key atrule&quot;&gt;spec&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt;
  &lt;span class=&quot;token key atrule&quot;&gt;type&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt; ClusterIP
  &lt;span class=&quot;token key atrule&quot;&gt;ports&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt;
    &lt;span class=&quot;token punctuation&quot;&gt;-&lt;/span&gt; &lt;span class=&quot;token key atrule&quot;&gt;name&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;token string&quot;&gt;&quot;http-port&quot;&lt;/span&gt;
      &lt;span class=&quot;token key atrule&quot;&gt;protocol&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;token string&quot;&gt;&quot;TCP&quot;&lt;/span&gt;
      &lt;span class=&quot;token key atrule&quot;&gt;port&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;token number&quot;&gt;8080&lt;/span&gt;
      &lt;span class=&quot;token key atrule&quot;&gt;targetPort&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;token number&quot;&gt;80&lt;/span&gt;
    &lt;span class=&quot;token punctuation&quot;&gt;-&lt;/span&gt; &lt;span class=&quot;token key atrule&quot;&gt;name&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;token string&quot;&gt;&quot;https-port&quot;&lt;/span&gt;
      &lt;span class=&quot;token key atrule&quot;&gt;protocol&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;token string&quot;&gt;&quot;TCP&quot;&lt;/span&gt;
      &lt;span class=&quot;token key atrule&quot;&gt;port&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;token number&quot;&gt;8443&lt;/span&gt;
      &lt;span class=&quot;token key atrule&quot;&gt;targetPort&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;token number&quot;&gt;443&lt;/span&gt;
  &lt;span class=&quot;token key atrule&quot;&gt;selector&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt;
    &lt;span class=&quot;token key atrule&quot;&gt;app&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt; sample&lt;span class=&quot;token punctuation&quot;&gt;-&lt;/span&gt;app&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;h3&gt;이름을 사용한 포트 참조&lt;/h3&gt;
&lt;p&gt;위 예제에서는 &lt;code class=&quot;language-text&quot;&gt;targetPort&lt;/code&gt;를 직접 지정했는데, 파드의 포트 정의에 이름을 지정해 놓으면 이름을 사용하여 참조할 수 있다. 디플로이먼트의 포트 정의에서 80 포트를 http로 명명하고, 서비스에서 참조할 때는 targetPort에서 http를 참조한다.&lt;/p&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;yaml&quot;&gt;&lt;pre class=&quot;language-yaml&quot;&gt;&lt;code class=&quot;language-yaml&quot;&gt;&lt;span class=&quot;token punctuation&quot;&gt;---&lt;/span&gt;
&lt;span class=&quot;token key atrule&quot;&gt;apiVersion&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt; v1
&lt;span class=&quot;token key atrule&quot;&gt;kind&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt; Pod
&lt;span class=&quot;token key atrule&quot;&gt;metadata&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt;
  &lt;span class=&quot;token key atrule&quot;&gt;name&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt; sample&lt;span class=&quot;token punctuation&quot;&gt;-&lt;/span&gt;named&lt;span class=&quot;token punctuation&quot;&gt;-&lt;/span&gt;port&lt;span class=&quot;token punctuation&quot;&gt;-&lt;/span&gt;pod&lt;span class=&quot;token punctuation&quot;&gt;-&lt;/span&gt;&lt;span class=&quot;token number&quot;&gt;80&lt;/span&gt;
  &lt;span class=&quot;token key atrule&quot;&gt;labels&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt;
    &lt;span class=&quot;token key atrule&quot;&gt;app&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt; sample&lt;span class=&quot;token punctuation&quot;&gt;-&lt;/span&gt;app
&lt;span class=&quot;token key atrule&quot;&gt;spec&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt;
  &lt;span class=&quot;token key atrule&quot;&gt;containers&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt;
  &lt;span class=&quot;token punctuation&quot;&gt;-&lt;/span&gt; &lt;span class=&quot;token key atrule&quot;&gt;name&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt; nginx&lt;span class=&quot;token punctuation&quot;&gt;-&lt;/span&gt;container
    &lt;span class=&quot;token key atrule&quot;&gt;image&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt; amsy810/echo&lt;span class=&quot;token punctuation&quot;&gt;-&lt;/span&gt;nginx&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt;v2.0
    &lt;span class=&quot;token key atrule&quot;&gt;ports&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt;
    &lt;span class=&quot;token punctuation&quot;&gt;-&lt;/span&gt; &lt;span class=&quot;token key atrule&quot;&gt;name&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt; http &lt;span class=&quot;token comment&quot;&gt;# 포트에 이름 지정&lt;/span&gt;
      &lt;span class=&quot;token key atrule&quot;&gt;containerPort&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;token number&quot;&gt;80&lt;/span&gt;
&lt;span class=&quot;token punctuation&quot;&gt;---&lt;/span&gt;
&lt;span class=&quot;token key atrule&quot;&gt;apiVersion&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt; v1
&lt;span class=&quot;token key atrule&quot;&gt;kind&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt; Pod
&lt;span class=&quot;token key atrule&quot;&gt;metadata&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt;
  &lt;span class=&quot;token key atrule&quot;&gt;name&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt; sample&lt;span class=&quot;token punctuation&quot;&gt;-&lt;/span&gt;named&lt;span class=&quot;token punctuation&quot;&gt;-&lt;/span&gt;port&lt;span class=&quot;token punctuation&quot;&gt;-&lt;/span&gt;pod&lt;span class=&quot;token punctuation&quot;&gt;-&lt;/span&gt;&lt;span class=&quot;token number&quot;&gt;81&lt;/span&gt;
  &lt;span class=&quot;token key atrule&quot;&gt;labels&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt;
    &lt;span class=&quot;token key atrule&quot;&gt;app&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt; sample&lt;span class=&quot;token punctuation&quot;&gt;-&lt;/span&gt;app
&lt;span class=&quot;token key atrule&quot;&gt;spec&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt;
  &lt;span class=&quot;token key atrule&quot;&gt;containers&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt;
  &lt;span class=&quot;token punctuation&quot;&gt;-&lt;/span&gt; &lt;span class=&quot;token key atrule&quot;&gt;name&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt; nginx&lt;span class=&quot;token punctuation&quot;&gt;-&lt;/span&gt;container
    &lt;span class=&quot;token key atrule&quot;&gt;image&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt; amsy810/echo&lt;span class=&quot;token punctuation&quot;&gt;-&lt;/span&gt;nginx&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt;v2.0
    &lt;span class=&quot;token key atrule&quot;&gt;env&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt;
    &lt;span class=&quot;token punctuation&quot;&gt;-&lt;/span&gt; &lt;span class=&quot;token key atrule&quot;&gt;name&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt; NGINX_PORT
      &lt;span class=&quot;token key atrule&quot;&gt;value&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;token string&quot;&gt;&quot;81&quot;&lt;/span&gt;
    &lt;span class=&quot;token key atrule&quot;&gt;ports&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt;
    &lt;span class=&quot;token punctuation&quot;&gt;-&lt;/span&gt; &lt;span class=&quot;token key atrule&quot;&gt;name&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt; http &lt;span class=&quot;token comment&quot;&gt;# 포트에 이름 지정&lt;/span&gt;
      &lt;span class=&quot;token key atrule&quot;&gt;containerPort&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;token number&quot;&gt;81&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;yaml&quot;&gt;&lt;pre class=&quot;language-yaml&quot;&gt;&lt;code class=&quot;language-yaml&quot;&gt;&lt;span class=&quot;token key atrule&quot;&gt;apiVersion&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt; v1
&lt;span class=&quot;token key atrule&quot;&gt;kind&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt; Service
&lt;span class=&quot;token key atrule&quot;&gt;metadata&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt;
  &lt;span class=&quot;token key atrule&quot;&gt;name&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt; sample&lt;span class=&quot;token punctuation&quot;&gt;-&lt;/span&gt;named&lt;span class=&quot;token punctuation&quot;&gt;-&lt;/span&gt;port&lt;span class=&quot;token punctuation&quot;&gt;-&lt;/span&gt;service
&lt;span class=&quot;token key atrule&quot;&gt;spec&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt;
  &lt;span class=&quot;token key atrule&quot;&gt;type&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt; ClusterIP
  &lt;span class=&quot;token key atrule&quot;&gt;ports&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt;
  &lt;span class=&quot;token punctuation&quot;&gt;-&lt;/span&gt; &lt;span class=&quot;token key atrule&quot;&gt;name&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;token string&quot;&gt;&quot;http-port&quot;&lt;/span&gt;
    &lt;span class=&quot;token key atrule&quot;&gt;protocol&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;token string&quot;&gt;&quot;TCP&quot;&lt;/span&gt;
    &lt;span class=&quot;token key atrule&quot;&gt;port&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;token number&quot;&gt;8080&lt;/span&gt;
    &lt;span class=&quot;token key atrule&quot;&gt;targetPort&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt; http
  &lt;span class=&quot;token key atrule&quot;&gt;selector&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt;
    &lt;span class=&quot;token key atrule&quot;&gt;app&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt; sample&lt;span class=&quot;token punctuation&quot;&gt;-&lt;/span&gt;app&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;sh&quot;&gt;&lt;pre class=&quot;language-sh&quot;&gt;&lt;code class=&quot;language-sh&quot;&gt;&lt;span class=&quot;token comment&quot;&gt;# 파드 생성&lt;/span&gt;
$ kubectl apply &lt;span class=&quot;token parameter variable&quot;&gt;-f&lt;/span&gt; sample-named-port-pods.yaml
pod/sample-named-port-pod-80 created
pod/sample-named-port-pod-81 created

&lt;span class=&quot;token comment&quot;&gt;# 서비스 생성&lt;/span&gt;
$ kubectl apply &lt;span class=&quot;token parameter variable&quot;&gt;-f&lt;/span&gt; sample-named-port-service.yaml
service/sample-named-port-service created

&lt;span class=&quot;token comment&quot;&gt;# 서비스 목적지 엔드포인트 확인&lt;/span&gt;
$ kubectl describe &lt;span class=&quot;token function&quot;&gt;service&lt;/span&gt; sample-named-port-service
Name:              sample-named-port-service
Namespace:         default
Labels:            &lt;span class=&quot;token operator&quot;&gt;&amp;lt;&lt;/span&gt;none&lt;span class=&quot;token operator&quot;&gt;&gt;&lt;/span&gt;
Annotations:       &lt;span class=&quot;token operator&quot;&gt;&amp;lt;&lt;/span&gt;none&lt;span class=&quot;token operator&quot;&gt;&gt;&lt;/span&gt;
Selector:          &lt;span class=&quot;token assign-left variable&quot;&gt;app&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt;sample-app
Type:              ClusterIP
IP Family Policy:  SingleStack
IP Families:       IPv4
IP:                &lt;span class=&quot;token number&quot;&gt;10.96&lt;/span&gt;.197.223
IPs:               &lt;span class=&quot;token number&quot;&gt;10.96&lt;/span&gt;.197.223
Port:              http-port  &lt;span class=&quot;token number&quot;&gt;8080&lt;/span&gt;/TCP
TargetPort:        http/TCP
Endpoints:         &lt;span class=&quot;token number&quot;&gt;10.244&lt;/span&gt;.3.36:80,10.244.2.9:81
Session Affinity:  None
Events:            &lt;span class=&quot;token operator&quot;&gt;&amp;lt;&lt;/span&gt;none&lt;span class=&quot;token operator&quot;&gt;&gt;&lt;/span&gt;

&lt;span class=&quot;token comment&quot;&gt;# 파드 IP 주소 확인&lt;/span&gt;
$ kubectl get pods &lt;span class=&quot;token parameter variable&quot;&gt;-o&lt;/span&gt; wide
NAME                                 READY   STATUS    RESTARTS   AGE    IP            NODE                   NOMINATED NODE   READINESS GATES
sample-named-port-pod-80             &lt;span class=&quot;token number&quot;&gt;1&lt;/span&gt;/1     Running   &lt;span class=&quot;token number&quot;&gt;0&lt;/span&gt;          117s   &lt;span class=&quot;token number&quot;&gt;10.244&lt;/span&gt;.3.36   kind-cluster-worker    &lt;span class=&quot;token operator&quot;&gt;&amp;lt;&lt;/span&gt;none&lt;span class=&quot;token operator&quot;&gt;&gt;&lt;/span&gt;           &lt;span class=&quot;token operator&quot;&gt;&amp;lt;&lt;/span&gt;none&lt;span class=&quot;token operator&quot;&gt;&gt;&lt;/span&gt;
sample-named-port-pod-81             &lt;span class=&quot;token number&quot;&gt;1&lt;/span&gt;/1     Running   &lt;span class=&quot;token number&quot;&gt;0&lt;/span&gt;          117s   &lt;span class=&quot;token number&quot;&gt;10.244&lt;/span&gt;.2.9    kind-cluster-worker3   &lt;span class=&quot;token operator&quot;&gt;&amp;lt;&lt;/span&gt;none&lt;span class=&quot;token operator&quot;&gt;&gt;&lt;/span&gt;           &lt;span class=&quot;token operator&quot;&gt;&amp;lt;&lt;/span&gt;none&lt;span class=&quot;token operator&quot;&gt;&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;h2&gt;6.2.2 클러스터 내부 DNS와 서비스 디스커버리&lt;/h2&gt;
&lt;p&gt;서비스 디스커버리란 특정 조건의 대상이 되는 멤버를 보여주거나 이름에서 엔드포인트를 판별하는 기능이다. 쿠버네티스에서 서비스 디스커버리란 서비스에 속해 있는 파드를 보여주거나 서비스명에서 엔드포인트 정보를 반환하는 것을 말한다. &lt;/br&gt;&lt;/p&gt;
&lt;p&gt;서비스 디스커버리 방법은 크게 세가지가 있다.&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;환경 변수를 사용한 서비스 디스커버리&lt;/li&gt;
&lt;li&gt;DNS A 레코드를 사용한 서비스 디스커버리&lt;/li&gt;
&lt;li&gt;DNS SRV 레코드를 사용한 서비스 디스커버리&lt;/li&gt;
&lt;/ul&gt;
&lt;h3&gt;환경 변수를 사용한 서비스 디스커버리&lt;/h3&gt;
&lt;p&gt;파드 내부에서는 환경 변수에서도 같은 네임 스페이스 서비스를 확인할 수 있다. &lt;code class=&quot;language-text&quot;&gt;-&lt;/code&gt;이 포함된 서비스명은 _로 변경된 후 대문자로 변환된다. &lt;code class=&quot;language-text&quot;&gt;docker --links ...&lt;/code&gt;로 실행했을 때와 같은 형식으로 환경 변수가 저장되기 때문에 도커 자체에서 사용하던 환경에서 마이그레이션할 때도 사용하기 편하다. 그러나 파드가 생성된 후 생성이나 삭제에 따라 변경된 환경 변수가 먼저 기동한 파드 환경에서 자동으로 다시 등록되지 않기 때문에 예기치 못한 장애로 이어질 수 있다. 그런 경우에는 먼저 생성한 파드를 다시 생성하면 된다. &lt;/br&gt;&lt;/p&gt;
&lt;p&gt;&lt;code class=&quot;language-text&quot;&gt;sepc.enableServiceLinks&lt;/code&gt;를 false로 설정하면 환경 변수 추가를 비활성화할 수 있다. 이 파라미터의 기본값은 true로 설정되어 있다.&lt;/p&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;sh&quot;&gt;&lt;pre class=&quot;language-sh&quot;&gt;&lt;code class=&quot;language-sh&quot;&gt;&lt;span class=&quot;token comment&quot;&gt;# pod 확인&lt;/span&gt;
$ kubectl get pods
NAME                                 READY   STATUS    RESTARTS   AGE
sample-deployment-65b84c8657-b5795   &lt;span class=&quot;token number&quot;&gt;1&lt;/span&gt;/1     Running   &lt;span class=&quot;token number&quot;&gt;0&lt;/span&gt;          59m
sample-deployment-65b84c8657-nfhch   &lt;span class=&quot;token number&quot;&gt;1&lt;/span&gt;/1     Running   &lt;span class=&quot;token number&quot;&gt;0&lt;/span&gt;          59m
sample-deployment-65b84c8657-v244g   &lt;span class=&quot;token number&quot;&gt;1&lt;/span&gt;/1     Running   &lt;span class=&quot;token number&quot;&gt;0&lt;/span&gt;          59m

&lt;span class=&quot;token comment&quot;&gt;# 환경 변수에 등록된 서비스 정보 확인&lt;/span&gt;
$ kubectl &lt;span class=&quot;token builtin class-name&quot;&gt;exec&lt;/span&gt; &lt;span class=&quot;token parameter variable&quot;&gt;-it&lt;/span&gt; sample-deployment-65b84c8657-b5795 -- &lt;span class=&quot;token function&quot;&gt;env&lt;/span&gt; &lt;span class=&quot;token operator&quot;&gt;|&lt;/span&gt; &lt;span class=&quot;token function&quot;&gt;grep&lt;/span&gt; &lt;span class=&quot;token parameter variable&quot;&gt;-i&lt;/span&gt; kubernetes
&lt;span class=&quot;token assign-left variable&quot;&gt;KUBERNETES_PORT&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt;tcp://10.96.0.1:443
&lt;span class=&quot;token assign-left variable&quot;&gt;KUBERNETES_SERVICE_PORT_HTTPS&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;token number&quot;&gt;443&lt;/span&gt;
&lt;span class=&quot;token assign-left variable&quot;&gt;KUBERNETES_SERVICE_PORT&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;token number&quot;&gt;443&lt;/span&gt;
&lt;span class=&quot;token assign-left variable&quot;&gt;KUBERNETES_SERVICE_HOST&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;token number&quot;&gt;10.96&lt;/span&gt;.0.1
&lt;span class=&quot;token assign-left variable&quot;&gt;KUBERNETES_PORT_443_TCP_ADDR&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;token number&quot;&gt;10.96&lt;/span&gt;.0.1
&lt;span class=&quot;token assign-left variable&quot;&gt;KUBERNETES_PORT_443_TCP_PORT&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;token number&quot;&gt;443&lt;/span&gt;
&lt;span class=&quot;token assign-left variable&quot;&gt;KUBERNETES_PORT_443_TCP_PROTO&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt;tcp
&lt;span class=&quot;token assign-left variable&quot;&gt;KUBERNETES_PORT_443_TCP&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt;tcp://10.96.0.1:443&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;h3&gt;DNS A 레코드를 사용한 서비스 디스커버리&lt;/h3&gt;
&lt;p&gt;다른 파드에서 서비스로 할당되는 엔드포인트에 접속하려면 당연히 목적지가 필요하지만, 할당된 IP 주소를 사용하는 방법 외에도 자동 등록된 DNS 레코드를 사용할 수 있다. 쿠버네티스에서 IP 주소를 사용하는 방법 외에도 자동 등록되 DNS 레코드를 사용할 수 있다. 쿠버네티스에서 IP 주소를 편하게 관리하려면 기본적으로 자동 할당된 IP 주소에 연결된 DNS명을 사용하는 것이 바람직하다. 할당되는 IP 주소는 서비스를 생성할 때마다 변경되므로 IP 주소를 송신 측 컨테이너 설정 파일 등에서 명시적으로 설정하면 변경될 때마다 설정 파일 등을 변경해야 하기 때문에 컨테이너를 변경 불가능한 상태로 유지할 수 없다.&lt;/p&gt;
&lt;p&gt;아래와 같이 &lt;a href=&quot;http://sample-culsterip:8080&quot;&gt;http://sample-culsterip:8080&lt;/a&gt; 으로 요청했을 때 cluster-ip의 이름이 해석되고 10.96.214.33(엔드포인트)로 요청이 발송되도록 되어 있다. 실제로 등록된 정식 FQDN은 &apos;서비스명.네임스페이스명.svc.cluster.local&apos;로 되어 있다. 이 FQDN에는 서비스가 충돌하지 않도록 네임스페이스 등이 포함되어 있는데, 컨테이너 내부의 /etc/resolve.conf에 다음과 같은 내용 (search로 시작하는 행)이 있기 때문에 &lt;code class=&quot;language-text&quot;&gt;sample-clusterip.default&lt;/code&gt;나 sample-clusterip 만으로 이름을 해석할 수 있다. 이 설정은 기본 네임스페이스라면 &lt;code class=&quot;language-text&quot;&gt;default.svc.cluster.local&lt;/code&gt;이 들어가 있듯이 네임스페이스별로 다르다. 동일한 네임스페이스라면 sample-clusterip로 해석이 가능하지만 다른 네임스페이스라면 sample-clusterip.default와 같이 네임스페이스명을 붙여 이름을 해석해야 한다.&lt;/p&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;sh&quot;&gt;&lt;pre class=&quot;language-sh&quot;&gt;&lt;code class=&quot;language-sh&quot;&gt;$ kubectl &lt;span class=&quot;token builtin class-name&quot;&gt;exec&lt;/span&gt; &lt;span class=&quot;token parameter variable&quot;&gt;-it&lt;/span&gt; sample-pod -- &lt;span class=&quot;token function&quot;&gt;curl&lt;/span&gt; &lt;span class=&quot;token parameter variable&quot;&gt;-s&lt;/span&gt; http://sample-clusterip:8080
&lt;span class=&quot;token assign-left variable&quot;&gt;Host&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt;sample-clusterip  &lt;span class=&quot;token assign-left variable&quot;&gt;Path&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt;/  &lt;span class=&quot;token assign-left variable&quot;&gt;From&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt;sample-deployment-65b84c8657-v244g  &lt;span class=&quot;token assign-left variable&quot;&gt;ClientIP&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;token number&quot;&gt;10.244&lt;/span&gt;.1.9  &lt;span class=&quot;token assign-left variable&quot;&gt;XFF&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt;

$ kubectl &lt;span class=&quot;token builtin class-name&quot;&gt;exec&lt;/span&gt; &lt;span class=&quot;token parameter variable&quot;&gt;-it&lt;/span&gt; sample-pod -- &lt;span class=&quot;token function&quot;&gt;curl&lt;/span&gt; &lt;span class=&quot;token parameter variable&quot;&gt;-s&lt;/span&gt; http://sample-clusterip:8080
&lt;span class=&quot;token assign-left variable&quot;&gt;Host&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt;sample-clusterip  &lt;span class=&quot;token assign-left variable&quot;&gt;Path&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt;/  &lt;span class=&quot;token assign-left variable&quot;&gt;From&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt;sample-deployment-65b84c8657-b5795  &lt;span class=&quot;token assign-left variable&quot;&gt;ClientIP&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;token number&quot;&gt;10.244&lt;/span&gt;.1.9  &lt;span class=&quot;token assign-left variable&quot;&gt;XFF&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt;
&lt;span class=&quot;token punctuation&quot;&gt;..&lt;/span&gt;.

&lt;span class=&quot;token comment&quot;&gt;# sample-clusterip.default.svc.cluster.local의 이름 해석 확인&lt;/span&gt;
$ kubectl &lt;span class=&quot;token builtin class-name&quot;&gt;exec&lt;/span&gt; &lt;span class=&quot;token parameter variable&quot;&gt;-it&lt;/span&gt; sample-pod -- &lt;span class=&quot;token function&quot;&gt;dig&lt;/span&gt; sample-clusterip.default.svc.cluster.local
&lt;span class=&quot;token punctuation&quot;&gt;..&lt;/span&gt;.
&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt; QUESTION SECTION:
&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;sample-clusterip.default.svc.cluster.local. IN A

&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt; ANSWER SECTION:
sample-clusterip.default.svc.cluster.local. &lt;span class=&quot;token number&quot;&gt;30&lt;/span&gt; IN A &lt;span class=&quot;token number&quot;&gt;10.96&lt;/span&gt;.214.33

$ kubectl &lt;span class=&quot;token builtin class-name&quot;&gt;exec&lt;/span&gt; &lt;span class=&quot;token parameter variable&quot;&gt;-it&lt;/span&gt; sample-pod -- &lt;span class=&quot;token function&quot;&gt;dig&lt;/span&gt; sample-clusterip.default.svc.cluster.local
&lt;span class=&quot;token punctuation&quot;&gt;..&lt;/span&gt;.
&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt; QUESTION SECTION:
&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;sample-clusterip.default.svc.cluster.local. IN A

&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt; ANSWER SECTION:
sample-clusterip.default.svc.cluster.local. &lt;span class=&quot;token number&quot;&gt;30&lt;/span&gt; IN A &lt;span class=&quot;token number&quot;&gt;10.96&lt;/span&gt;.214.33

&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt; Query time: &lt;span class=&quot;token number&quot;&gt;1&lt;/span&gt; msec
&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt; SERVER: &lt;span class=&quot;token number&quot;&gt;10.96&lt;/span&gt;.0.10&lt;span class=&quot;token comment&quot;&gt;#53(10.96.0.10)&lt;/span&gt;
&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt; WHEN: Fri Sep 09 06:47:11 UTC &lt;span class=&quot;token number&quot;&gt;2022&lt;/span&gt;
&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt; MSG SIZE  rcvd: &lt;span class=&quot;token number&quot;&gt;141&lt;/span&gt;

&lt;span class=&quot;token comment&quot;&gt;# /etc/resolv.conf 확인&lt;/span&gt;
$ kubectl &lt;span class=&quot;token builtin class-name&quot;&gt;exec&lt;/span&gt; &lt;span class=&quot;token parameter variable&quot;&gt;-it&lt;/span&gt; sample-pod -- &lt;span class=&quot;token function&quot;&gt;cat&lt;/span&gt; /etc/resolv.conf
search default.svc.cluster.local svc.cluster.local cluster.local
nameserver &lt;span class=&quot;token number&quot;&gt;10.96&lt;/span&gt;.0.10
options ndots:5

&lt;span class=&quot;token comment&quot;&gt;# 역질의&lt;/span&gt;
$ kubectl &lt;span class=&quot;token builtin class-name&quot;&gt;exec&lt;/span&gt; &lt;span class=&quot;token parameter variable&quot;&gt;-it&lt;/span&gt; sample-pod -- &lt;span class=&quot;token function&quot;&gt;dig&lt;/span&gt; &lt;span class=&quot;token parameter variable&quot;&gt;-x&lt;/span&gt; &lt;span class=&quot;token number&quot;&gt;10.96&lt;/span&gt;.214.33
&lt;span class=&quot;token punctuation&quot;&gt;..&lt;/span&gt;.
&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt; QUESTION SECTION:
&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;&lt;span class=&quot;token number&quot;&gt;33.214&lt;/span&gt;.96.10.in-addr.arpa.	IN	PTR

&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt; ANSWER SECTION:
&lt;span class=&quot;token number&quot;&gt;33.214&lt;/span&gt;.96.10.in-addr.arpa. &lt;span class=&quot;token number&quot;&gt;30&lt;/span&gt;	IN	PTR	sample-clusterip.default.svc.cluster.local.

&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt; Query time: &lt;span class=&quot;token number&quot;&gt;2&lt;/span&gt; msec
&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt; SERVER: &lt;span class=&quot;token number&quot;&gt;10.96&lt;/span&gt;.0.10&lt;span class=&quot;token comment&quot;&gt;#53(10.96.0.10)&lt;/span&gt;
&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt; WHEN: Fri Sep 09 06:55:09 UTC &lt;span class=&quot;token number&quot;&gt;2022&lt;/span&gt;
&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt; MSG SIZE  rcvd: &lt;span class=&quot;token number&quot;&gt;147&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;h3&gt;DNS SRV 레코드를 사용한 서비스 디스커버리&lt;/h3&gt;
&lt;p&gt;정방향과 역방향으로 DNS 레코드가 질의되는 것을 확인하였는데, SRV 레코드를 사용해서 서비스 엔드포인트를 확인할 수도 있다. SRV 레코드는 포트명과 프로토콜을 사용하여 서비스를 제공하는 포트 번호를 포함한 엔드포인트를 DNS로 해석하는 구조다. 레코드 형식은 다음과 같다. 서비스의 포트명과 프로토콜에는 접두사 _가 포함되므로 주의하자.&lt;/p&gt;
&lt;p&gt;&lt;code class=&quot;language-text&quot;&gt;_서비스포트명_프로토콜.서비스명.네임스페이스명.svc.cluster.local&lt;/code&gt;&lt;/p&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;yaml&quot;&gt;&lt;pre class=&quot;language-yaml&quot;&gt;&lt;code class=&quot;language-yaml&quot;&gt;&lt;span class=&quot;token key atrule&quot;&gt;apiVersion&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt; v1
&lt;span class=&quot;token key atrule&quot;&gt;kind&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt; Service
&lt;span class=&quot;token key atrule&quot;&gt;metadata&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt;
  &lt;span class=&quot;token key atrule&quot;&gt;name&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt; sample&lt;span class=&quot;token punctuation&quot;&gt;-&lt;/span&gt;clusterip
&lt;span class=&quot;token key atrule&quot;&gt;spec&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt;
  &lt;span class=&quot;token key atrule&quot;&gt;type&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt; ClusterIP
  &lt;span class=&quot;token key atrule&quot;&gt;ports&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt;
    &lt;span class=&quot;token punctuation&quot;&gt;-&lt;/span&gt; &lt;span class=&quot;token key atrule&quot;&gt;name&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;token string&quot;&gt;&quot;http-port&quot;&lt;/span&gt;
      &lt;span class=&quot;token key atrule&quot;&gt;protocol&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;token string&quot;&gt;&quot;TCP&quot;&lt;/span&gt;
      &lt;span class=&quot;token key atrule&quot;&gt;port&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;token number&quot;&gt;8080&lt;/span&gt;
      &lt;span class=&quot;token key atrule&quot;&gt;targetPort&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;token number&quot;&gt;80&lt;/span&gt;
  &lt;span class=&quot;token key atrule&quot;&gt;selector&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt;
    &lt;span class=&quot;token key atrule&quot;&gt;app&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt; sample&lt;span class=&quot;token punctuation&quot;&gt;-&lt;/span&gt;app&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;실제로 SVR을 확인해보면, 다음과 같이 목적지 호스트명 sample-clusterip.default.svc.cluster.local과 포트 번호 8080을 해석할 수 있다. SRV 레코드를 해석할 수 있는 소프트웨어의 경우 이와 같은 서비스를 제공하는 포트 번호를 포함한 엔드포인트까지 DNS로 해석할 수 있다.&lt;/p&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;sh&quot;&gt;&lt;pre class=&quot;language-sh&quot;&gt;&lt;code class=&quot;language-sh&quot;&gt;&lt;span class=&quot;token comment&quot;&gt;# SRV 레코드가 다른 파드에서 해석이 가능한지 확인&lt;/span&gt;
$ kubectl &lt;span class=&quot;token builtin class-name&quot;&gt;exec&lt;/span&gt; &lt;span class=&quot;token parameter variable&quot;&gt;-it&lt;/span&gt; sample-pod -- &lt;span class=&quot;token function&quot;&gt;dig&lt;/span&gt; _http-port._tcp.sample-clusterip.default.svc.cluster.local SRV
&lt;span class=&quot;token punctuation&quot;&gt;..&lt;/span&gt;.

&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt; OPT PSEUDOSECTION:
&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt; EDNS: version: &lt;span class=&quot;token number&quot;&gt;0&lt;/span&gt;, flags:&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt; udp: &lt;span class=&quot;token number&quot;&gt;4096&lt;/span&gt;
&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt; COOKIE: 1df44dd154a59433 &lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;echoed&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;
&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt; QUESTION SECTION:
&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;_http-port._tcp.sample-clusterip.default.svc.cluster.local. IN SRV

&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt; ANSWER SECTION:
_http-port._tcp.sample-clusterip.default.svc.cluster.local. &lt;span class=&quot;token number&quot;&gt;30&lt;/span&gt; IN SRV &lt;span class=&quot;token number&quot;&gt;0&lt;/span&gt; &lt;span class=&quot;token number&quot;&gt;100&lt;/span&gt; &lt;span class=&quot;token number&quot;&gt;8080&lt;/span&gt; sample-clusterip.default.svc.cluster.local.&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;h1&gt;6.3 ClusterIP 서비스&lt;/h1&gt;
&lt;p&gt;ClusterIP 서비스는 쿠버네티스의 가장 기본이 되는 &lt;code class=&quot;language-text&quot;&gt;type: ClusterIP&lt;/code&gt; 서비스다. 이 서비스를 생성하면 클러스터 내부에서만 통신 가능한 Internal Network에 생성되는 가상 IP가 할당된다. 따라서 ClusterIP라고 불린다. ClusterIP는 각 노드상에서 실행 중인 시스템 구성 요소 kube-proxy가 파드로 전송을 실시한다. ClusterIP는 쿠버네티스 클러스터 외부에서 트래픽을 수신할 필요가 없는 환경에서 클러스터 내부 로드 밸런서로 사용된다. 기본적으로는 쿠버네티스 API에 접속하기 위한 Kubernetes 서비스가 생성되어 있고, ClusterIP가 발급되어 있다.&lt;/p&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;sh&quot;&gt;&lt;pre class=&quot;language-sh&quot;&gt;&lt;code class=&quot;language-sh&quot;&gt;&lt;span class=&quot;token comment&quot;&gt;# 쿠버네티스 API에 접속할 수 있도록 쿠버네티스 서비스가 생성됨&lt;/span&gt;
$ kubectl get services
NAME               TYPE        CLUSTER-IP     EXTERNAL-IP   PORT&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;S&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;    AGE
kubernetes         ClusterIP   &lt;span class=&quot;token number&quot;&gt;10.96&lt;/span&gt;.0.1      &lt;span class=&quot;token operator&quot;&gt;&amp;lt;&lt;/span&gt;none&lt;span class=&quot;token operator&quot;&gt;&gt;&lt;/span&gt;        &lt;span class=&quot;token number&quot;&gt;443&lt;/span&gt;/TCP    41d
sample-clusterip   ClusterIP   &lt;span class=&quot;token number&quot;&gt;10.96&lt;/span&gt;.214.33   &lt;span class=&quot;token operator&quot;&gt;&amp;lt;&lt;/span&gt;none&lt;span class=&quot;token operator&quot;&gt;&gt;&lt;/span&gt;        &lt;span class=&quot;token number&quot;&gt;8080&lt;/span&gt;/TCP   80m&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;div align=&quot;center&quot;&gt;
  &lt;span class=&quot;gatsby-resp-image-wrapper&quot; style=&quot;position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 449px; &quot;&gt;
      &lt;a class=&quot;gatsby-resp-image-link&quot; href=&quot;/static/e5fcc776e9153cd5e5d6bd5d7896ca54/053a9/clusterip.png&quot; style=&quot;display: block&quot; target=&quot;_blank&quot; rel=&quot;noopener&quot;&gt;
    &lt;span class=&quot;gatsby-resp-image-background-image&quot; style=&quot;padding-bottom: 72.78481012658227%; position: relative; bottom: 0; left: 0; background-image: url(&apos;data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAPCAYAAADkmO9VAAAACXBIWXMAAAsTAAALEwEAmpwYAAAC+UlEQVR42nWTaU8bVxSG/ftbVcq3SG3TigZXoQ1SDDRKkYVxwYAzthnv4wXvC15nsWexDXl67oRWaUs/vDpXZ3nPeiPJwoRUacrlv5Aqz0jqI2LnJX67MIidFYhnuqKfP+M75Tw/YTBZEUnXTDINi0z9n8g2bK7E+eDkmjdHlxwcp0je9sndOWJ/inlCVqB4xguPSOBvUNgG/8Vus+Vh98BG3o+Pn9htd8/6BX4QYhNsFWGA7wXYjvcsLHvNfGFjOa5gLTr3CWJfeTgrP0y43QS4a6mQT4+YToDRNWkMTOp9k1pvSX1gkav2+ZDQOD5NcfGxTHNoi30Z+lS7ixDl1ozR1CYIdniuEJbrfYpGl6wxong3p9Keh44qsNqeiW6KZgzJ1sfoYtNbc5nhlGarz202R0bL0ukOpHpp2/WJdAZTWr0x+cY9emMqciZyRrrQp/b7H2TLHUqNcVhJWSXrLEJZMHoUKk1KRpt2b8LScgk8/3PLjhtQk4qa0nKxM0cbWujLLZpeJfbD91ycvKcwtinIFrWeavVzJ4pYJVqY63BhYctqk2rgqs2GkGbE6XQUcN5csX+W58XPH3h5mOQo0yHZ9YkPHCqSVM2xLrNW83bWAY9yDZ5ayoMw244fEjbFKSMZ9/QxL09KvPglzVf7cb6OJvgmmuS7eJ3D6gyjpxa3CGFI3N+E7heEyqCyGR0TXYZeak3JGDW06p0cryyl0UerdGSmdYzWGKNtSYxAVbj6X0JTHDr0F23yiVPie69o5W9ojnvUBm2GsxbXsQMS+z/SbZeo3/dklrOwwofd7suWPdnePKyuPPiIMbnl6OwdPx2+Jt/NUp1co/cSVO513p6+JRqLUhrmMKY3FJsjIZSftPtrKULorP1ww+2RjdbQib7P8+2bFPtHOfaOilyW09zUbnh9XODVr1fsvdOInpS5qqYlbsbK3YQVumuXiGL15CDdEB4r+U6WKV/NsjGXIk0Lx3ZZqW8o79Am0lyKXq5DxXhyf75Acf0JhlVAEu4GITAAAAAASUVORK5CYII=&apos;); background-size: cover; display: block;&quot;&gt;&lt;/span&gt;
  &lt;img class=&quot;gatsby-resp-image-image&quot; alt=&quot;clusterip&quot; title=&quot;&quot; src=&quot;/static/e5fcc776e9153cd5e5d6bd5d7896ca54/053a9/clusterip.png&quot; srcset=&quot;/static/e5fcc776e9153cd5e5d6bd5d7896ca54/c26ae/clusterip.png 158w,
/static/e5fcc776e9153cd5e5d6bd5d7896ca54/6bdcf/clusterip.png 315w,
/static/e5fcc776e9153cd5e5d6bd5d7896ca54/053a9/clusterip.png 449w&quot; sizes=&quot;(max-width: 449px) 100vw, 449px&quot; style=&quot;width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;&quot; loading=&quot;lazy&quot; decoding=&quot;async&quot;&gt;
  &lt;/a&gt;
    &lt;/span&gt;
&lt;/div&gt;
&lt;h2&gt;6.3.1 ClusterIP 생성&lt;/h2&gt;
&lt;p&gt;매니페스트는 기존 사용했던 sample-clusterip 매니페스트를 사용한다. &lt;code class=&quot;language-text&quot;&gt;type: ClusterIP&lt;/code&gt;를 지정하면 ClusterIP 서비스를 생성할 수 있다. &lt;code class=&quot;language-text&quot;&gt;spec.ports[].port&lt;/code&gt;에는 ClusterIP에서 수신할 포트 번호를 지정하고, &lt;code class=&quot;language-text&quot;&gt;spec.ports[].targetPort&lt;/code&gt;는 목적지 컨테이너 포트 번호를 지정한다.&lt;/p&gt;
&lt;h2&gt;6.3.2 ClusterIP 가상 IP 정적 지정&lt;/h2&gt;
&lt;p&gt;애플리케이션에서 데이터베이스 서버를 지정하는 경우 기본적으로 쿠버네티스 서비스에 등록된 클러스터 내부 DNS 레코드를 사용하여 호스트를 지정하는 것이 바람직하다. 그러나, IP주소로 지정해야 하는 경우 ClusterIP를 정적으로 지정할 수도 있다.&lt;/p&gt;
&lt;p&gt;ClusterIP를 자동 할당이 아닌 수동으로 설정할 경우 &lt;code class=&quot;language-text&quot;&gt;spec.clusterIP&lt;/code&gt;를 지정한다.&lt;/p&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;yaml&quot;&gt;&lt;pre class=&quot;language-yaml&quot;&gt;&lt;code class=&quot;language-yaml&quot;&gt;&lt;span class=&quot;token key atrule&quot;&gt;apiVersion&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt; v1
&lt;span class=&quot;token key atrule&quot;&gt;kind&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt; Service
&lt;span class=&quot;token key atrule&quot;&gt;metadata&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt;
  &lt;span class=&quot;token key atrule&quot;&gt;name&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt; sample&lt;span class=&quot;token punctuation&quot;&gt;-&lt;/span&gt;clusterip&lt;span class=&quot;token punctuation&quot;&gt;-&lt;/span&gt;vip
&lt;span class=&quot;token key atrule&quot;&gt;spec&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt;
  &lt;span class=&quot;token key atrule&quot;&gt;type&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt; ClusterIP
  &lt;span class=&quot;token key atrule&quot;&gt;clusterIP&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt; 10.51.246.81
  &lt;span class=&quot;token key atrule&quot;&gt;ports&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt;
    &lt;span class=&quot;token punctuation&quot;&gt;-&lt;/span&gt; &lt;span class=&quot;token key atrule&quot;&gt;name&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;token string&quot;&gt;&quot;http-port&quot;&lt;/span&gt;
      &lt;span class=&quot;token key atrule&quot;&gt;protocol&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;token string&quot;&gt;&quot;TCP&quot;&lt;/span&gt;
      &lt;span class=&quot;token key atrule&quot;&gt;port&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;token number&quot;&gt;8080&lt;/span&gt;
      &lt;span class=&quot;token key atrule&quot;&gt;targetPort&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;token number&quot;&gt;80&lt;/span&gt;
  &lt;span class=&quot;token key atrule&quot;&gt;selector&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt;
    &lt;span class=&quot;token key atrule&quot;&gt;app&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt; sample&lt;span class=&quot;token punctuation&quot;&gt;-&lt;/span&gt;app&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;서비스가 이미 생성된 후에는 ClusterIP를 변경할 수 없다. 쿠버네티스에서는 &lt;code class=&quot;language-text&quot;&gt;kubectl apply&lt;/code&gt;를 사용하여 설정값을 변경할 수 있다고 설명하지만, 쿠버네티스 특성상 ClusterIP 값 등과 같은 일부 필드는 변경할 수 없게 설정되어 있다.&lt;/p&gt;
&lt;h1&gt;6.4 ExternalIP 서비스&lt;/h1&gt;
&lt;p&gt;ExternalIP는 특정 쿠버네티스 노드 IP주소:포트에서 수신한 트래픽을 컨테이너로 전송하는 형태로 외부와 통신할 수 있도록 하는 서비스다. 그리고 특별한 이유가 없는 경우에는 ExternalIP 서비스 대신 나중에 설명할 NodePort 서비스를 사용하는 것이 더 좋다.&lt;/p&gt;
&lt;h2&gt;6.4.1 ExternalIP 서비스 생성&lt;/h2&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;yaml&quot;&gt;&lt;pre class=&quot;language-yaml&quot;&gt;&lt;code class=&quot;language-yaml&quot;&gt;&lt;span class=&quot;token key atrule&quot;&gt;apiVersion&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt; v1
&lt;span class=&quot;token key atrule&quot;&gt;kind&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt; Service
&lt;span class=&quot;token key atrule&quot;&gt;metadata&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt;
  &lt;span class=&quot;token key atrule&quot;&gt;name&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt; sample&lt;span class=&quot;token punctuation&quot;&gt;-&lt;/span&gt;externalip
&lt;span class=&quot;token key atrule&quot;&gt;spec&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt;
  &lt;span class=&quot;token key atrule&quot;&gt;type&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt; ClusterIP
  &lt;span class=&quot;token key atrule&quot;&gt;externalIPs&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt;
    &lt;span class=&quot;token punctuation&quot;&gt;-&lt;/span&gt; 172.18.0.2
    &lt;span class=&quot;token punctuation&quot;&gt;-&lt;/span&gt; 172.18.0.3
  &lt;span class=&quot;token key atrule&quot;&gt;ports&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt;
    &lt;span class=&quot;token punctuation&quot;&gt;-&lt;/span&gt; &lt;span class=&quot;token key atrule&quot;&gt;name&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;token string&quot;&gt;&quot;http-port&quot;&lt;/span&gt;
      &lt;span class=&quot;token key atrule&quot;&gt;protocol&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;token string&quot;&gt;&quot;TCP&quot;&lt;/span&gt;
      &lt;span class=&quot;token key atrule&quot;&gt;port&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;token number&quot;&gt;8080&lt;/span&gt;
      &lt;span class=&quot;token key atrule&quot;&gt;targetPort&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;token number&quot;&gt;80&lt;/span&gt;
  &lt;span class=&quot;token key atrule&quot;&gt;selector&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt;
    &lt;span class=&quot;token key atrule&quot;&gt;app&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt; sample&lt;span class=&quot;token punctuation&quot;&gt;-&lt;/span&gt;app&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;ExternalIP는 ClusterIP의 한 종류이기 때문에 type은 역시 ClusterIP로 지정한다. &lt;code class=&quot;language-text&quot;&gt;spec.externalIPs&lt;/code&gt;에는 쿠버네티스 노드 IP(10.178.0.61 등)를, &lt;code class=&quot;language-text&quot;&gt;spec.ports[].port&lt;/code&gt;에는 쿠버네티스 노드의 IP와 ClusterIP에서 수신할 포트 번호를, &lt;code class=&quot;language-text&quot;&gt;spec.ports[].targetPorts&lt;/code&gt;에는 목적지 컨테이너 포트를 지정한다. 또한, ExternalIP에서 사용하는 IP는 모든 쿠버네티스 노드의 IP를 넣을 필요가 없다.&lt;/br&gt;&lt;/p&gt;
&lt;p&gt;ExternalIP에 사용 가능한 IP주소는 노드 정보에서 확인할 수 있다. 생성한 ExternalIP 서비스를 확인해보면, 컨테이너 내부에서의 통신은 ClusterIP를 사용하기 위해 ClusterIP도 자동으로 확보된다.&lt;/p&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;sh&quot;&gt;&lt;pre class=&quot;language-sh&quot;&gt;&lt;code class=&quot;language-sh&quot;&gt;&lt;span class=&quot;token comment&quot;&gt;# 쿠버네티스 노드 목록과 주소 출력&lt;/span&gt;
$ kubectl get nodes &lt;span class=&quot;token parameter variable&quot;&gt;-o&lt;/span&gt; custom-columns&lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;token string&quot;&gt;&quot;NAME:{metadata.name},IP:{status.addresses[].address}&quot;&lt;/span&gt;
NAME                         IP
kind-cluster-control-plane   &lt;span class=&quot;token number&quot;&gt;172.18&lt;/span&gt;.0.5
kind-cluster-worker          &lt;span class=&quot;token number&quot;&gt;172.18&lt;/span&gt;.0.4
kind-cluster-worker2         &lt;span class=&quot;token number&quot;&gt;172.18&lt;/span&gt;.0.3
kind-cluster-worker3         &lt;span class=&quot;token number&quot;&gt;172.18&lt;/span&gt;.0.2

&lt;span class=&quot;token comment&quot;&gt;# ExternalIP 서비스 확인&lt;/span&gt;
$ kubectl get services
NAME                TYPE        CLUSTER-IP     EXTERNAL-IP             PORT&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;S&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;    AGE
kubernetes          ClusterIP   &lt;span class=&quot;token number&quot;&gt;10.96&lt;/span&gt;.0.1      &lt;span class=&quot;token operator&quot;&gt;&amp;lt;&lt;/span&gt;none&lt;span class=&quot;token operator&quot;&gt;&gt;&lt;/span&gt;                  &lt;span class=&quot;token number&quot;&gt;443&lt;/span&gt;/TCP    41d
sample-clusterip    ClusterIP   &lt;span class=&quot;token number&quot;&gt;10.96&lt;/span&gt;.214.33   &lt;span class=&quot;token operator&quot;&gt;&amp;lt;&lt;/span&gt;none&lt;span class=&quot;token operator&quot;&gt;&gt;&lt;/span&gt;                  &lt;span class=&quot;token number&quot;&gt;8080&lt;/span&gt;/TCP   96m
sample-externalip   ClusterIP   &lt;span class=&quot;token number&quot;&gt;10.96&lt;/span&gt;.170.55   &lt;span class=&quot;token number&quot;&gt;172.18&lt;/span&gt;.0.2,172.18.0.3   &lt;span class=&quot;token number&quot;&gt;8080&lt;/span&gt;/TCP   21s

&lt;span class=&quot;token comment&quot;&gt;# 외부에서 ExternalIP로 통신&lt;/span&gt;
$ &lt;span class=&quot;token function&quot;&gt;curl&lt;/span&gt; &lt;span class=&quot;token parameter variable&quot;&gt;-s&lt;/span&gt; http://172.18.0.2:8080&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;h2&gt;출처&lt;/h2&gt;
&lt;p&gt;&lt;a href=&quot;https://dev-youngjun.tistory.com/20&quot;&gt;https://dev-youngjun.tistory.com/20&lt;/a&gt;&lt;/p&gt;</content:encoded></item><item><title><![CDATA[[Server] 로드밸런서의 개념과 종류]]></title><description><![CDATA[…]]></description><link>https://github.com/SiverPineValley/SiverPineValley.github.io/server/loadbalancer/</link><guid isPermaLink="false">https://github.com/SiverPineValley/SiverPineValley.github.io/server/loadbalancer/</guid><pubDate>Fri, 09 Sep 2022 15:00:00 GMT</pubDate><content:encoded>&lt;h1&gt;1. 부하 분산 방법&lt;/h1&gt;
&lt;p&gt;대부분의 인터넷을 기반으로 오픈되어 있는 서비스들의 실운영 서버는 클라우드 환경이던 컨테이너 환경이던 트래픽을 견디게 하기 위해 여러 가지 방법들을 사용한다. 서비스의 부하를 견디게 하기 위한 방법에는 크게 두 가지가 있다.&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;
&lt;p&gt;&lt;code class=&quot;language-text&quot;&gt;Scale Up&lt;/code&gt;: Server 하드웨어의 스펙을 높이는 방법.&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;&lt;code class=&quot;language-text&quot;&gt;Scale Out&lt;/code&gt;: Server를 병렬적으로 여러 대로 늘려서 부하를 분산시키는 방법.&lt;/p&gt;
&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;두 가지 방법 모두 그럴듯한데, 경우에 따라 다르긴 하지만 &lt;code class=&quot;language-text&quot;&gt;Scale Up&lt;/code&gt; 보다는 &lt;code class=&quot;language-text&quot;&gt;Scale Out&lt;/code&gt;의 장점 때문에 이를 선택하는 경우가 많다. 첫 번째로 하드웨어 스펙을 높이는 것 보단, 비슷한 스펙으로 서버를 하나 더 구축하는 것이 비용면에서 더 효율적이다. 두 번째로 서버 하나에서 장애가 발생하더라도 나머지 서버가 살아 있다면 무중단 서비스를 보장할 수 있다. &lt;code class=&quot;language-text&quot;&gt;로드밸런싱&lt;/code&gt; 이라는 개념은 바로 이 부분에서 나오는데, 트래픽을 여러 서버로 분산시키는 기술을 로드밸런싱이라고 한다.&lt;/p&gt;
&lt;h1&gt;2. 로드밸런싱&lt;/h1&gt;
&lt;h2&gt;2.1 로드밸런싱이란?&lt;/h2&gt;
&lt;p&gt;앞서 설명한 바와 같이, 로드밸런싱이란 하나의 인터넷 서비스가 발생하는 트래픽이 많을 때 여러 대의 서버가 분산처리하여 서버의 로드율 증가, 부하량, 속도 저하를 고려하여 적절히 분산처리하여 해결해주는 서비스를 의미한다. 주요 기능으로는 아래와 같다고 볼 수 있다.&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;
&lt;p&gt;&lt;code class=&quot;language-text&quot;&gt;NAT(Network Address Translation)&lt;/code&gt;: 사설 IP 주소를 공인 IP 주소로 바꾸는 데 사용하는 통신망의 주소변환기&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;&lt;code class=&quot;language-text&quot;&gt;Tunneling&lt;/code&gt;: 인터넷 상에서 보이지 않는 통로를 생성. 데이터를 캡슐화해서 연결된 상호 간에만 캡슐화된 패킷을 구별해 해제 가능.&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;&lt;code class=&quot;language-text&quot;&gt;DSR(Dynamic Source Routing Protocol)&lt;/code&gt;: 로드 밸런서 사용 시 서버에서 클라이언트로 되돌아가는 경우 목적지 주소를 스위치의 IP 주소가 아닌 클라이언트의 IP 주소로 전달해서 네트워크 스위치를 거치지 않고 바로 클라이언트를 찾아가는 개념이다.&lt;/p&gt;
&lt;/li&gt;
&lt;/ul&gt;
&lt;div align=&quot;center&quot;&gt;
  &lt;img src=&quot;./images/dsr.png&quot; width=&quot;600px&quot; /&gt;
&lt;/div&gt;
&lt;h2&gt;2.2 로드밸런서의 종류&lt;/h2&gt;
&lt;p&gt;로드 밸런서는 OSI Layer의 어떤 단계의 프로토콜을 기준으로 분산처리를 하느냐에 따라 종류가 여러 가지로 나뉜다. 주로 L4와 L7 로드밸런서가 많이 사용되는데, L4부터 IP와 Port 정보를 바탕으로 로드밸런싱이 가능하기 때문이다.&lt;/p&gt;
&lt;h3&gt;L2&lt;/h3&gt;
&lt;ul&gt;
&lt;li&gt;Mac 주소를 바탕으로 로드밸런싱한다.&lt;/li&gt;
&lt;/ul&gt;
&lt;h3&gt;L3&lt;/h3&gt;
&lt;ul&gt;
&lt;li&gt;IP 주소를 바탕으로 로드밸런싱한다.&lt;/li&gt;
&lt;/ul&gt;
&lt;h3&gt;L4&lt;/h3&gt;
&lt;ul&gt;
&lt;li&gt;Network Layer(IP, IPX)나 Transport Layer(TCP, UDP)를 바탕으로 로드밸런싱한다.&lt;/li&gt;
&lt;li&gt;IP 주소와 Port, MAC주소, 전송 프로토콜에 따라 트래픽을 나누는 것이 가능하다.&lt;/li&gt;
&lt;li&gt;TCP, UDP&lt;/li&gt;
&lt;/ul&gt;
&lt;div align=&quot;center&quot;&gt;
  &lt;img src=&quot;./images/l4.png&quot; width=&quot;600px&quot; /&gt;
&lt;/div&gt;
&lt;h3&gt;L7&lt;/h3&gt;
&lt;ul&gt;
&lt;li&gt;Application Layer(사용자의 Request) Level에서 로드밸런싱한다.&lt;/li&gt;
&lt;li&gt;HTTP 헤더, 쿠키 등과 같은 사용자의 요청을 기준으로 특정 서버에 트래픽을 분산할 수 있다.&lt;/li&gt;
&lt;li&gt;HTTP, HTTPS, FTP&lt;/li&gt;
&lt;/ul&gt;
&lt;div align=&quot;center&quot;&gt;
  &lt;img src=&quot;./images/l7.png&quot; width=&quot;600px&quot; /&gt;
&lt;/div&gt;
&lt;ul&gt;
&lt;li&gt;&lt;code class=&quot;language-text&quot;&gt;X-Forwarded-For&lt;/code&gt;: HTTP 또는 HTTPS 로드 밸런서를 사용할 때 클라이언트의 IP 주소를 식별하는 데 도움을 줍니다.&lt;/li&gt;
&lt;li&gt;&lt;code class=&quot;language-text&quot;&gt;X-Forwarded-Proto&lt;/code&gt;: 클라이언트가 로드 밸런서 연결에 사용한 프로토콜(HTTP 또는 HTTPS)을 식별하는 데 도움을 줍니다.&lt;/li&gt;
&lt;li&gt;&lt;code class=&quot;language-text&quot;&gt;X-Forwarded-Port&lt;/code&gt;: 클라이언트가 로드 밸런서 연결에 사용한 포트를 식별하는 데 도움을 줍니다.&lt;/li&gt;
&lt;/ul&gt;
&lt;h2&gt;2.3 로드밸런서의 알고리즘&lt;/h2&gt;
&lt;p&gt;각 서버별로 적절한 부하 분산을 위해 로드밸런서는 여러 가지 알고리즘들을 사용한다. 알고리즘의 목표는 가장 균형적으로 모든 서버들에게 트래픽을 분산하는 것 이다.&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;&lt;code class=&quot;language-text&quot;&gt;라운드로빈 방식(Round Robin)&lt;/code&gt;: 서버에 들어온 요청을 순서대로 돌아가며 배정하는 방식. 클라이언트의 요청을 순서대로 분배하기 때문에 여러 대의 서버가 동일한 스펙을 갖고 있고, 서버와의 연결이 오래 지속되지 않는 경우 활용하기 적합.&lt;/li&gt;
&lt;li&gt;&lt;code class=&quot;language-text&quot;&gt;가중 라운드로빈 방식(Weighted Round Robin&lt;/code&gt;: 각각의 서버마다 가중치를 매기고 가중치가 높은 서버에 클라이언트 요청을 우선적으로 배분한다. 주로 서버의 트래픽 처리 능력이 상이한 경우 사용되는 부하 분산 방식이다.&lt;/li&gt;
&lt;li&gt;&lt;code class=&quot;language-text&quot;&gt;최소 연결 방식(Least Connections)&lt;/code&gt;: 요청이 들어온 시점에 가장 적은 연결상태를 보이는 서버에 우선적으로 트패릭 분배. 트래픽으로 인해 세션이 길어지는 경우 선호된다.&lt;/li&gt;
&lt;li&gt;&lt;code class=&quot;language-text&quot;&gt;IP 해시 방식(IP Hash Method)&lt;/code&gt;: 사용자의 IP를 Hashing하여 분배하는 방식. 사용자는 항상 같은 서버로 연결되는 것이 보장된다.&lt;/li&gt;
&lt;li&gt;&lt;code class=&quot;language-text&quot;&gt;최소 리스폰스 타임(Least Response Time)&lt;/code&gt;: 서버의 연결 상태와 응답시간을 모두 고려하여 트래픽을 분배. 가장 적은 연결 상태와 가장 짧은 응답시간을 보이는 서버에 우선적으로 로드를 배분한다.&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;짧은 응답시간을 보이는 서버에 우선적으로 로드를 배분하는 방식입니다.&lt;/p&gt;
&lt;h2&gt;2.4 로드밸런서의 장애 대응&lt;/h2&gt;
&lt;p&gt;서비스와 마찬가지로, 로드 밸런서 역시 장애가 발생하면 서비스 전체에 지장을 주게 될 수 있다. 이를 방지하기 위해 로드밸런서에도 이중화 처리가 가능하다. 다만, 서비스와 같이 모든 서버가 Active인 것이 아니라, Active-Stanby 구조로 서로 Health-Check를 하다가 Active 서버가 죽으면 Stanby가 Active가 되는 방식이다.&lt;/p&gt;
&lt;div align=&quot;center&quot;&gt;
  &lt;span class=&quot;gatsby-resp-image-wrapper&quot; style=&quot;position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 630px; &quot;&gt;
      &lt;a class=&quot;gatsby-resp-image-link&quot; href=&quot;/static/5960b112b49ecf5e4b13c7f6939e099e/c1b63/active-stanby.png&quot; style=&quot;display: block&quot; target=&quot;_blank&quot; rel=&quot;noopener&quot;&gt;
    &lt;span class=&quot;gatsby-resp-image-background-image&quot; style=&quot;padding-bottom: 48.10126582278481%; position: relative; bottom: 0; left: 0; background-image: url(&apos;data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAKCAYAAAC0VX7mAAAACXBIWXMAAAPoAAAD6AG1e1JrAAABSklEQVR42nVS2W7DMAzL//9hnzZgB7Z2KZrEt2RxkpIU69oaIHyKoigPuBsCdL6B8J+9dAe3pqjo1LY7UnQMcsenJ0rQde764DhlHD4vvhYlypUQcwUTgRRsySxG7414+KfNg+yisiA1xrgUvI0BmVSVMN7PAa+nBaRERlhr9VlkrWwY5whWdlNUNSiqAlNhax9UgDSBuqBxczFyLUZcoanvvFozHD5GzKlhzoQlN/yoonOsSsgbYQVa0iBGaYRnwyxwQlMmu3Wbb5atcfeSLcHLcVaFTcE4h4LTlPydqSNtjq2xl4xHTbHObp5eUsT3NKot7CdHTfB1yU5maNbta2OUMFR2v4pj9cO6vENUmdaCMC/ocQZKhJRgNd688719m3EKCKUiFVKPtIwuj02y7qPvf+Gpl0OKETkn5LQiJdtn/w430NLuzh7gF5XtE3BPRKhwAAAAAElFTkSuQmCC&apos;); background-size: cover; display: block;&quot;&gt;&lt;/span&gt;
  &lt;img class=&quot;gatsby-resp-image-image&quot; alt=&quot;active stanby&quot; title=&quot;&quot; src=&quot;/static/5960b112b49ecf5e4b13c7f6939e099e/f058b/active-stanby.png&quot; srcset=&quot;/static/5960b112b49ecf5e4b13c7f6939e099e/c26ae/active-stanby.png 158w,
/static/5960b112b49ecf5e4b13c7f6939e099e/6bdcf/active-stanby.png 315w,
/static/5960b112b49ecf5e4b13c7f6939e099e/f058b/active-stanby.png 630w,
/static/5960b112b49ecf5e4b13c7f6939e099e/40601/active-stanby.png 945w,
/static/5960b112b49ecf5e4b13c7f6939e099e/c1b63/active-stanby.png 1200w&quot; sizes=&quot;(max-width: 630px) 100vw, 630px&quot; style=&quot;width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;&quot; loading=&quot;lazy&quot; decoding=&quot;async&quot;&gt;
  &lt;/a&gt;
    &lt;/span&gt;
&lt;/div&gt;
&lt;h1&gt;출처&lt;/h1&gt;
&lt;p&gt;&lt;a href=&quot;https://nesoy.github.io/articles/2018-06/Load-Balancer&quot;&gt;https://nesoy.github.io/articles/2018-06/Load-Balancer&lt;/a&gt; [Nesoy Blog]&lt;/br&gt;
&lt;a href=&quot;https://m.post.naver.com/viewer/postView.naver?volumeNo=27046347&amp;#x26;memberNo=2521903&quot;&gt;https://m.post.naver.com/viewer/postView.naver?volumeNo=27046347&amp;#x26;memberNo=2521903&lt;/a&gt; [네이버 포스트 IT용어사전]&lt;/p&gt;</content:encoded></item><item><title><![CDATA[[쿠버네티스 완벽 가이드] 11. 워크로드 API 카테고리 (5) - 잡, 크론잡]]></title><description><![CDATA[5.7 잡 잡(Job)은 컨테이너를 사용하여 한 번만 실행되는 리소스다. 더 정확히는, N…]]></description><link>https://github.com/SiverPineValley/SiverPineValley.github.io/kubernetes/kubernetes_5_5/</link><guid isPermaLink="false">https://github.com/SiverPineValley/SiverPineValley.github.io/kubernetes/kubernetes_5_5/</guid><pubDate>Sun, 04 Sep 2022 12:00:00 GMT</pubDate><content:encoded>&lt;h1&gt;5.7 잡&lt;/h1&gt;
&lt;p&gt;잡(Job)은 컨테이너를 사용하여 한 번만 실행되는 리소스다. 더 정확히는, N개의 병렬로 실행하면서 지정한 횟수의 컨테이너 실행(정상 종료)을 보장하는 리소스이다. 잡과 레플리카셋의 차이점은 &apos;기동 중인 파드가 정지되는 것을 전제로 만들어졌는지&apos;에 있다. 기본적으로 레플리카셋 등에서 파드의 정지는 예상치 못한 에러다. 반면 잡의 경우는 파드의 정지가 정상 종료되는 작업에 적합하다. 예를 들어 &apos;특정 서버와의 rsync&apos;나 &apos;S3 등의 오브젝트 스토리지에 파일 업로드&apos; 등을 들 수 있다. 레플리카셋 등에서는 정상 종료 횟수 등을 셀 수 없기 때문에 배치 처리인 경우에는 잡을 적극적으로 이용하자.&lt;/p&gt;
&lt;h2&gt;5.7.1 잡 생성&lt;/h2&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;yaml&quot;&gt;&lt;pre class=&quot;language-yaml&quot;&gt;&lt;code class=&quot;language-yaml&quot;&gt;&lt;span class=&quot;token key atrule&quot;&gt;apiVersion&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt; batch/v1
&lt;span class=&quot;token key atrule&quot;&gt;kind&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt; Job
&lt;span class=&quot;token key atrule&quot;&gt;metadata&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt;
  &lt;span class=&quot;token key atrule&quot;&gt;name&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt; sample&lt;span class=&quot;token punctuation&quot;&gt;-&lt;/span&gt;job
&lt;span class=&quot;token key atrule&quot;&gt;spec&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt;
  &lt;span class=&quot;token key atrule&quot;&gt;completions&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;token number&quot;&gt;1&lt;/span&gt;
  &lt;span class=&quot;token key atrule&quot;&gt;parallelism&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;token number&quot;&gt;1&lt;/span&gt;
  &lt;span class=&quot;token key atrule&quot;&gt;backoffLimit&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;token number&quot;&gt;10&lt;/span&gt;
  &lt;span class=&quot;token key atrule&quot;&gt;template&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt;
    &lt;span class=&quot;token key atrule&quot;&gt;spec&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt;
      &lt;span class=&quot;token key atrule&quot;&gt;containers&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt;
      &lt;span class=&quot;token punctuation&quot;&gt;-&lt;/span&gt; &lt;span class=&quot;token key atrule&quot;&gt;name&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt; sleep&lt;span class=&quot;token punctuation&quot;&gt;-&lt;/span&gt;container
        &lt;span class=&quot;token key atrule&quot;&gt;image&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt; amsy810/tools&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt;v2.0
        &lt;span class=&quot;token key atrule&quot;&gt;command&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;[&lt;/span&gt;&lt;span class=&quot;token string&quot;&gt;&quot;sleep&quot;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;]&lt;/span&gt;
        &lt;span class=&quot;token key atrule&quot;&gt;args&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;[&lt;/span&gt;&lt;span class=&quot;token string&quot;&gt;&quot;60&quot;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;]&lt;/span&gt;
      &lt;span class=&quot;token key atrule&quot;&gt;restartPolicy&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt; Never&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;sh&quot;&gt;&lt;pre class=&quot;language-sh&quot;&gt;&lt;code class=&quot;language-sh&quot;&gt;&lt;span class=&quot;token comment&quot;&gt;# 잡 생성&lt;/span&gt;
$ kubectl apply &lt;span class=&quot;token parameter variable&quot;&gt;-f&lt;/span&gt; sample-job.yaml
job.batch/sample-job created

&lt;span class=&quot;token comment&quot;&gt;# 잡 목록 표시 (잡 생성 직후)&lt;/span&gt;
$ kubectl get &lt;span class=&quot;token function&quot;&gt;jobs&lt;/span&gt;
NAME         COMPLETIONS   DURATION   AGE
sample-job   &lt;span class=&quot;token number&quot;&gt;0&lt;/span&gt;/1           35s        35s

&lt;span class=&quot;token comment&quot;&gt;# 잡이 생성한 파드 확인&lt;/span&gt;
$ kubectl get pods &lt;span class=&quot;token parameter variable&quot;&gt;--watch&lt;/span&gt;
NAME                                 READY   STATUS      RESTARTS      AGE
sample-job-plrnz                     &lt;span class=&quot;token number&quot;&gt;0&lt;/span&gt;/1     Completed   &lt;span class=&quot;token number&quot;&gt;0&lt;/span&gt;             116s&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;h2&gt;5.7.2 restartPolicy에 따른 동작 차이&lt;/h2&gt;
&lt;p&gt;잡의 매니페스트에는 &lt;code class=&quot;language-text&quot;&gt;spec.template.spec.restartPolicy&lt;/code&gt;에 &lt;code class=&quot;language-text&quot;&gt;OnFailure&lt;/code&gt; 또는 &lt;code class=&quot;language-text&quot;&gt;Never&lt;/code&gt; 중에 하나를 지정해야 한다.&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;&lt;code class=&quot;language-text&quot;&gt;Never&lt;/code&gt;: 장애가 발생하면 신규 파드가 생성된다.&lt;/li&gt;
&lt;li&gt;&lt;code class=&quot;language-text&quot;&gt;OnFailure&lt;/code&gt;: 다시 동일한 파드를 사용하여 잡을 다시 시작한다.&lt;/li&gt;
&lt;/ul&gt;
&lt;h3&gt;restartPolicy: Never&lt;/h3&gt;
&lt;p&gt;Docker에서는 &lt;code class=&quot;language-text&quot;&gt;spec.containers[].command&lt;/code&gt;에서 지정한 프로그램은 프로세스 ID=1로 실행된다. 프로세스 ID=1에서 &lt;code class=&quot;language-text&quot;&gt;sleep&lt;/code&gt;명령어를 실행하면 &lt;strong&gt;SIGKILL&lt;/strong&gt; 신호를 보내도 프로세스를 정지할 수 없기 때문에 별도 프로세스를 시작하는 형태로 기동해야 한다. 아래 매니페스트로 컨테이너를 생성하고 실제로 컨테이너상의 sleep 프로세스를 정지시켜 보면 신규 파드를 생성하여 잡을 계속 실행하려고 한다.&lt;/p&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;yaml&quot;&gt;&lt;pre class=&quot;language-yaml&quot;&gt;&lt;code class=&quot;language-yaml&quot;&gt;&lt;span class=&quot;token key atrule&quot;&gt;apiVersion&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt; batch/v1
&lt;span class=&quot;token key atrule&quot;&gt;kind&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt; Job
&lt;span class=&quot;token key atrule&quot;&gt;metadata&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt;
  &lt;span class=&quot;token key atrule&quot;&gt;name&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt; sample&lt;span class=&quot;token punctuation&quot;&gt;-&lt;/span&gt;job&lt;span class=&quot;token punctuation&quot;&gt;-&lt;/span&gt;never&lt;span class=&quot;token punctuation&quot;&gt;-&lt;/span&gt;restart
&lt;span class=&quot;token key atrule&quot;&gt;spec&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt;
  &lt;span class=&quot;token key atrule&quot;&gt;completions&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;token number&quot;&gt;1&lt;/span&gt;
  &lt;span class=&quot;token key atrule&quot;&gt;parallelism&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;token number&quot;&gt;1&lt;/span&gt;
  &lt;span class=&quot;token key atrule&quot;&gt;backoffLimit&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;token number&quot;&gt;10&lt;/span&gt;
  &lt;span class=&quot;token key atrule&quot;&gt;template&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt;
    &lt;span class=&quot;token key atrule&quot;&gt;spec&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt;
      &lt;span class=&quot;token key atrule&quot;&gt;containers&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt;
      &lt;span class=&quot;token punctuation&quot;&gt;-&lt;/span&gt; &lt;span class=&quot;token key atrule&quot;&gt;name&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt; sleep&lt;span class=&quot;token punctuation&quot;&gt;-&lt;/span&gt;container
        &lt;span class=&quot;token key atrule&quot;&gt;image&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt; amsy810/tools&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt;v2.0
        &lt;span class=&quot;token key atrule&quot;&gt;command&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;[&lt;/span&gt;&lt;span class=&quot;token string&quot;&gt;&quot;sh&quot;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;token string&quot;&gt;&quot;-c&quot;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;]&lt;/span&gt;
        &lt;span class=&quot;token key atrule&quot;&gt;args&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;[&lt;/span&gt;&lt;span class=&quot;token string&quot;&gt;&quot;$(sleep 3600)&quot;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;]&lt;/span&gt;
      &lt;span class=&quot;token key atrule&quot;&gt;restartPolicy&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt; Never&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;sh&quot;&gt;&lt;pre class=&quot;language-sh&quot;&gt;&lt;code class=&quot;language-sh&quot;&gt;&lt;span class=&quot;token comment&quot;&gt;# 잡이 생성한 파드 확인&lt;/span&gt;
$ kubectl get pods
NAME                                 READY   STATUS    RESTARTS      AGE
sample-job-never-restart-xjkgb       &lt;span class=&quot;token number&quot;&gt;1&lt;/span&gt;/1     Running   &lt;span class=&quot;token number&quot;&gt;0&lt;/span&gt;             27s

&lt;span class=&quot;token comment&quot;&gt;# 컨테이너상의 sleep 프로세스 정지&lt;/span&gt;
$ kubectl &lt;span class=&quot;token builtin class-name&quot;&gt;exec&lt;/span&gt; &lt;span class=&quot;token parameter variable&quot;&gt;-it&lt;/span&gt; sample-job-never-restart-xjkgb -- &lt;span class=&quot;token function&quot;&gt;sh&lt;/span&gt; &lt;span class=&quot;token parameter variable&quot;&gt;-c&lt;/span&gt; &lt;span class=&quot;token string&quot;&gt;&apos;kill -9 `pgrep sleep`&apos;&lt;/span&gt;

&lt;span class=&quot;token comment&quot;&gt;# 생성된 파드가 기동됨&lt;/span&gt;
$ kubectl get pods
NAME                                 READY   STATUS    RESTARTS      AGE
sample-job-never-restart-f6gh9       &lt;span class=&quot;token number&quot;&gt;1&lt;/span&gt;/1     Running   &lt;span class=&quot;token number&quot;&gt;0&lt;/span&gt;             31s
sample-job-never-restart-xjkgb       &lt;span class=&quot;token number&quot;&gt;0&lt;/span&gt;/1     Error     &lt;span class=&quot;token number&quot;&gt;0&lt;/span&gt;             107s&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;h3&gt;restartPolicy: OnFailure&lt;/h3&gt;
&lt;p&gt;&lt;code class=&quot;language-text&quot;&gt;OnFailure&lt;/code&gt;은 &lt;code class=&quot;language-text&quot;&gt;Never&lt;/code&gt;와 달리 내부 프로세스가 정지되면 RESTARTS 카운터가 증가하고, 사용했던 파드를 다시 사용하여 잡을 실행하려고 한다. 파드가 기동하는 노드나 파드 IP 주소는 변경되지 않지만, 영구 볼륨이나 쿠버네티스 노드의 영역(hostPath)을 마운트하지 않은 경우라면 데이터 자체가 유실된다.&lt;/p&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;yaml&quot;&gt;&lt;pre class=&quot;language-yaml&quot;&gt;&lt;code class=&quot;language-yaml&quot;&gt;&lt;span class=&quot;token key atrule&quot;&gt;apiVersion&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt; batch/v1
&lt;span class=&quot;token key atrule&quot;&gt;kind&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt; Job
&lt;span class=&quot;token key atrule&quot;&gt;metadata&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt;
  &lt;span class=&quot;token key atrule&quot;&gt;name&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt; sample&lt;span class=&quot;token punctuation&quot;&gt;-&lt;/span&gt;job&lt;span class=&quot;token punctuation&quot;&gt;-&lt;/span&gt;onfailure&lt;span class=&quot;token punctuation&quot;&gt;-&lt;/span&gt;restart
&lt;span class=&quot;token key atrule&quot;&gt;spec&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt;
  &lt;span class=&quot;token key atrule&quot;&gt;completions&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;token number&quot;&gt;1&lt;/span&gt;
  &lt;span class=&quot;token key atrule&quot;&gt;parallelism&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;token number&quot;&gt;1&lt;/span&gt;
  &lt;span class=&quot;token key atrule&quot;&gt;backoffLimit&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;token number&quot;&gt;10&lt;/span&gt;
  &lt;span class=&quot;token key atrule&quot;&gt;template&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt;
    &lt;span class=&quot;token key atrule&quot;&gt;spec&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt;
      &lt;span class=&quot;token key atrule&quot;&gt;containers&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt;
      &lt;span class=&quot;token punctuation&quot;&gt;-&lt;/span&gt; &lt;span class=&quot;token key atrule&quot;&gt;name&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt; tools&lt;span class=&quot;token punctuation&quot;&gt;-&lt;/span&gt;container
        &lt;span class=&quot;token key atrule&quot;&gt;image&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt; amsy810/tools&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt;v2.0
        &lt;span class=&quot;token key atrule&quot;&gt;command&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;[&lt;/span&gt;&lt;span class=&quot;token string&quot;&gt;&quot;sh&quot;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;token string&quot;&gt;&quot;-c&quot;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;]&lt;/span&gt;
        &lt;span class=&quot;token key atrule&quot;&gt;args&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;[&lt;/span&gt;&lt;span class=&quot;token string&quot;&gt;&quot;$(sleep 3600)&quot;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;]&lt;/span&gt;
      &lt;span class=&quot;token key atrule&quot;&gt;restartPolicy&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt; OnFailure&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;sh&quot;&gt;&lt;pre class=&quot;language-sh&quot;&gt;&lt;code class=&quot;language-sh&quot;&gt;&lt;span class=&quot;token comment&quot;&gt;# 잡이 생성한 파드 확인&lt;/span&gt;
$ kubectl get pods
NAME                                 READY   STATUS    RESTARTS      AGE
sample-job-onfailure-restart-rfpxs   &lt;span class=&quot;token number&quot;&gt;1&lt;/span&gt;/1     Running   &lt;span class=&quot;token number&quot;&gt;0&lt;/span&gt;             25s

&lt;span class=&quot;token comment&quot;&gt;# 파드상의 sleep 프로세스 정지&lt;/span&gt;
$ kubectl &lt;span class=&quot;token builtin class-name&quot;&gt;exec&lt;/span&gt; &lt;span class=&quot;token parameter variable&quot;&gt;-it&lt;/span&gt; sample-job-onfailure-restart-rfpxs -- &lt;span class=&quot;token function&quot;&gt;sh&lt;/span&gt; &lt;span class=&quot;token parameter variable&quot;&gt;-c&lt;/span&gt; &lt;span class=&quot;token string&quot;&gt;&apos;kill -0 `pgrep sleep`&apos;&lt;/span&gt;

&lt;span class=&quot;token comment&quot;&gt;# 같은 파드 재시작&lt;/span&gt;
$ kubectl get pods
NAME                                 READY   STATUS    RESTARTS      AGE
sample-job-onfailure-restart-rfpxs   &lt;span class=&quot;token number&quot;&gt;1&lt;/span&gt;/1     Running   &lt;span class=&quot;token number&quot;&gt;0&lt;/span&gt;             85s&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;h2&gt;5.7.3 태스크와 작업 큐 병렬 실행&lt;/h2&gt;
&lt;p&gt;아래 매니페스트에서는 &lt;code class=&quot;language-text&quot;&gt;spec&lt;/code&gt;아래 &lt;code class=&quot;language-text&quot;&gt;completions&lt;/code&gt;, &lt;code class=&quot;language-text&quot;&gt;parallelism&lt;/code&gt;, &lt;code class=&quot;language-text&quot;&gt;backoffLimit&lt;/code&gt;을 설정한다.&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;&lt;code class=&quot;language-text&quot;&gt;completions&lt;/code&gt;: 성공 횟수 지정&lt;/li&gt;
&lt;li&gt;&lt;code class=&quot;language-text&quot;&gt;parallelism&lt;/code&gt;: 병렬성 지정&lt;/li&gt;
&lt;li&gt;&lt;code class=&quot;language-text&quot;&gt;backoffLimit&lt;/code&gt;: 실패 허용 횟수&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;이 설정들은 아주 중요한 파라미터들이며, 잡의 워크로드에 따라 적절히 설정하여 사용하여야 한다. 이 파라미터들 중 &lt;code class=&quot;language-text&quot;&gt;completions&lt;/code&gt;는 나중에 변경할 수 없으나, &lt;code class=&quot;language-text&quot;&gt;parallelism&lt;/code&gt;이나 &lt;code class=&quot;language-text&quot;&gt;backoffLimit&lt;/code&gt;은 도중에 변경할 수 있다. 변경하려면 매니페스트를 수정하고 &lt;code class=&quot;language-text&quot;&gt;kubectl apply&lt;/code&gt; 명령어를 실행한다.&lt;/p&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;yaml&quot;&gt;&lt;pre class=&quot;language-yaml&quot;&gt;&lt;code class=&quot;language-yaml&quot;&gt;&lt;span class=&quot;token key atrule&quot;&gt;apiVersion&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt; batch/v1
&lt;span class=&quot;token key atrule&quot;&gt;kind&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt; Job
&lt;span class=&quot;token key atrule&quot;&gt;metadata&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt;
  &lt;span class=&quot;token key atrule&quot;&gt;name&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt; sample&lt;span class=&quot;token punctuation&quot;&gt;-&lt;/span&gt;paralleljob
&lt;span class=&quot;token key atrule&quot;&gt;spec&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt;
  &lt;span class=&quot;token key atrule&quot;&gt;completions&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;token number&quot;&gt;10&lt;/span&gt;
  &lt;span class=&quot;token key atrule&quot;&gt;parallelism&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;token number&quot;&gt;2&lt;/span&gt;
  &lt;span class=&quot;token key atrule&quot;&gt;backoffLimit&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;token number&quot;&gt;10&lt;/span&gt;
  &lt;span class=&quot;token key atrule&quot;&gt;template&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt;
    &lt;span class=&quot;token key atrule&quot;&gt;metadata&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt;
      &lt;span class=&quot;token key atrule&quot;&gt;name&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt; sleep&lt;span class=&quot;token punctuation&quot;&gt;-&lt;/span&gt;job
    &lt;span class=&quot;token key atrule&quot;&gt;spec&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt;
      &lt;span class=&quot;token key atrule&quot;&gt;containers&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt;
      &lt;span class=&quot;token punctuation&quot;&gt;-&lt;/span&gt; &lt;span class=&quot;token key atrule&quot;&gt;name&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt; sleep&lt;span class=&quot;token punctuation&quot;&gt;-&lt;/span&gt;container
        &lt;span class=&quot;token key atrule&quot;&gt;image&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt; amsy810/tools&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt;v2.0
        &lt;span class=&quot;token key atrule&quot;&gt;command&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;[&lt;/span&gt;&lt;span class=&quot;token string&quot;&gt;&quot;sleep&quot;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;]&lt;/span&gt;
        &lt;span class=&quot;token key atrule&quot;&gt;args&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;[&lt;/span&gt;&lt;span class=&quot;token string&quot;&gt;&quot;30&quot;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;]&lt;/span&gt;
      &lt;span class=&quot;token key atrule&quot;&gt;restartPolicy&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt; Never&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;h3&gt;One Shot Task: 1회만 실행하는 태스크&lt;/h3&gt;
&lt;p&gt;1회만 실행하려면 &lt;code class=&quot;language-text&quot;&gt;completions&lt;/code&gt;=1 / &lt;code class=&quot;language-text&quot;&gt;parallelism&lt;/code&gt;=1 / &lt;code class=&quot;language-text&quot;&gt;backoffLimit&lt;/code&gt;=0 으로 지정한다. 이 경우 실행/성공 횟수가 1이 되면 종료 / 한 개 병렬로 실행 / 실패 횟수가 0이 되면 종료 조건 때문에 성공하던 실패하던 한 번만 실행된다.&lt;/p&gt;
&lt;h3&gt;Multi Task: N개 병렬로 실행하는 태스크&lt;/h3&gt;
&lt;p&gt;&lt;code class=&quot;language-text&quot;&gt;completions&lt;/code&gt;와 &lt;code class=&quot;language-text&quot;&gt;parallelism&lt;/code&gt;을 변경하여 병렬 태스크를 생성할 수 있다. &lt;code class=&quot;language-text&quot;&gt;completions&lt;/code&gt;=5, &lt;code class=&quot;language-text&quot;&gt;parallelism&lt;/code&gt;=3인 경우 먼저 3개가 병렬 실행되어 성공하고나면, 남은 2개의 &lt;code class=&quot;language-text&quot;&gt;completions&lt;/code&gt; 수가 2개라 2개의 병렬만 실행된다.&lt;/p&gt;
&lt;h3&gt;Multi WorkQueue: N개 병렬로 실행하는 작업 큐&lt;/h3&gt;
&lt;p&gt;지금까지의 태스크 잡처럼 개별 파드의 정상 종료가 성공 횟수에 도달할 때까지 실행하는 것이 아니라, 큰 처리 전체가 정상 종료할 때까지 몇 개의 병렬 수로 계속 실행하고 싶은 경우가 있다. 그런 경우 작업 큐의 잡을 사용한다. 작업 큐의 잡은 성공 횟수(&lt;code class=&quot;language-text&quot;&gt;completions&lt;/code&gt;)를 지정하지않고, 병렬 수(&lt;code class=&quot;language-text&quot;&gt;parallelism&lt;/code&gt;)만 지정한다. 이 경우 &lt;code class=&quot;language-text&quot;&gt;parallelism&lt;/code&gt;으로 지정한 병렬 수로 파드를 실행하고, 그 중 하나라도 정상 종료하면 그 이후는 파드를 생성하지 않는다. 또 그때 이미 실행중인 나머지 파드는 강제적으로 정지하지 않고 개별 처리가 종료할 때까지 계속 동작한다.&lt;/p&gt;
&lt;p&gt;작업 큐의 잡을 사용하려면 처리 전체의 진행을 관리하기 위한 메시지 큐를 사용해야 한다. 그리고 파드 내의 애플리케이션에는 그 메시지로부터 반복하여 데이터를 계속 가져오는 처리를 구현해 둔다. 또한, 메시지 큐가 빈 것을 확인하면 그 파드를 정상 종료하도록 구현해 둠으로써 작업 큐의 잡에서 전체 처리를 정지할 수 있다.&lt;/p&gt;
&lt;p&gt;태스크와 작업 큐는 잡을 표시할 때 &lt;strong&gt;COMPLETIONS&lt;/strong&gt;의 출력 형식이 다르다. 앞서 설명한 Multi WorkQueue 예에서는 세 개 중에 하나만 정상 종료되면 되기 때문에 하나도 정상 종료하지 않는 시점에서 0/1 of 3으로 출력된다. 이는 세 개 병렬로 실행 중 하나가 정상 종료하면 되지만 하직 하나도 정상 종료하지 않는 것을 나타낸다.&lt;/p&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;yaml&quot;&gt;&lt;pre class=&quot;language-yaml&quot;&gt;&lt;code class=&quot;language-yaml&quot;&gt;&lt;span class=&quot;token key atrule&quot;&gt;apiVersion&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt; batch/v1
&lt;span class=&quot;token key atrule&quot;&gt;kind&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt; Job
&lt;span class=&quot;token key atrule&quot;&gt;metadata&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt;
  &lt;span class=&quot;token key atrule&quot;&gt;name&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt; sample&lt;span class=&quot;token punctuation&quot;&gt;-&lt;/span&gt;multi&lt;span class=&quot;token punctuation&quot;&gt;-&lt;/span&gt;workqueue&lt;span class=&quot;token punctuation&quot;&gt;-&lt;/span&gt;job
&lt;span class=&quot;token key atrule&quot;&gt;spec&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt;
  &lt;span class=&quot;token comment&quot;&gt;# 지정하지 않음&lt;/span&gt;
  &lt;span class=&quot;token comment&quot;&gt;# completions: 1&lt;/span&gt;
  &lt;span class=&quot;token key atrule&quot;&gt;parallelism&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;token number&quot;&gt;3&lt;/span&gt;
  &lt;span class=&quot;token key atrule&quot;&gt;backoffLimit&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;token number&quot;&gt;1&lt;/span&gt;
  &lt;span class=&quot;token key atrule&quot;&gt;template&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt;
    &lt;span class=&quot;token key atrule&quot;&gt;metadata&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt;
      &lt;span class=&quot;token key atrule&quot;&gt;name&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt; sleep&lt;span class=&quot;token punctuation&quot;&gt;-&lt;/span&gt;job
    &lt;span class=&quot;token key atrule&quot;&gt;spec&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt;
      &lt;span class=&quot;token key atrule&quot;&gt;containers&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt;
      &lt;span class=&quot;token punctuation&quot;&gt;-&lt;/span&gt; &lt;span class=&quot;token key atrule&quot;&gt;name&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt; sleep&lt;span class=&quot;token punctuation&quot;&gt;-&lt;/span&gt;container
        &lt;span class=&quot;token key atrule&quot;&gt;image&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt; amsy810/tools&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt;v2.0
        &lt;span class=&quot;token key atrule&quot;&gt;command&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;[&lt;/span&gt;&lt;span class=&quot;token string&quot;&gt;&quot;sleep&quot;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;]&lt;/span&gt;
        &lt;span class=&quot;token key atrule&quot;&gt;args&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;[&lt;/span&gt;&lt;span class=&quot;token string&quot;&gt;&quot;30&quot;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;]&lt;/span&gt;
      &lt;span class=&quot;token key atrule&quot;&gt;restartPolicy&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt; Never&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;sh&quot;&gt;&lt;pre class=&quot;language-sh&quot;&gt;&lt;code class=&quot;language-sh&quot;&gt;&lt;span class=&quot;token comment&quot;&gt;# &apos;Multi Task&apos; 실행 중의 잡 표시&lt;/span&gt;
$ kubectl apply &lt;span class=&quot;token parameter variable&quot;&gt;-f&lt;/span&gt; sample-multi-workqueue-job.yaml
job.batch/sample-multi-workqueue-job created

&lt;span class=&quot;token comment&quot;&gt;# &apos;Multi WorkQueue&apos; 실행 중의 잡 표시&lt;/span&gt;
$ kubectl get job sample-multi-workqueue-job
NAME                         COMPLETIONS   DURATION   AGE
sample-multi-workqueue-job   &lt;span class=&quot;token number&quot;&gt;0&lt;/span&gt;/1 of &lt;span class=&quot;token number&quot;&gt;3&lt;/span&gt;      9s         9s

&lt;span class=&quot;token comment&quot;&gt;# &apos;Multi WorkQueue&apos; 실행 중의 파드 표시&lt;/span&gt;
$ kubectl get pods
NAME                                 READY   STATUS      RESTARTS      AGE
sample-multi-workqueue-job-8vcl9     &lt;span class=&quot;token number&quot;&gt;0&lt;/span&gt;/1     Completed   &lt;span class=&quot;token number&quot;&gt;0&lt;/span&gt;             83s
sample-multi-workqueue-job-dz5kt     &lt;span class=&quot;token number&quot;&gt;0&lt;/span&gt;/1     Completed   &lt;span class=&quot;token number&quot;&gt;0&lt;/span&gt;             83s
sample-multi-workqueue-job-v2srb     &lt;span class=&quot;token number&quot;&gt;0&lt;/span&gt;/1     Completed   &lt;span class=&quot;token number&quot;&gt;0&lt;/span&gt;             83s&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;h3&gt;Single WorkQueue: 한 개씩 실행하는 작업 큐&lt;/h3&gt;
&lt;p&gt;Multi WorkQueue의 응용으로 &lt;code class=&quot;language-text&quot;&gt;completions&lt;/code&gt;를 지정하지 않고 &lt;code class=&quot;language-text&quot;&gt;parallelism&lt;/code&gt;에 1을 지정한 경우 한 번 정상 종료할 때까지 한 개씩 실행하는 작업 큐가 된다.&lt;/p&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;yaml&quot;&gt;&lt;pre class=&quot;language-yaml&quot;&gt;&lt;code class=&quot;language-yaml&quot;&gt;&lt;span class=&quot;token key atrule&quot;&gt;apiVersion&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt; batch/v1
&lt;span class=&quot;token key atrule&quot;&gt;kind&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt; Job
&lt;span class=&quot;token key atrule&quot;&gt;metadata&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt;
  &lt;span class=&quot;token key atrule&quot;&gt;name&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt; sample&lt;span class=&quot;token punctuation&quot;&gt;-&lt;/span&gt;single&lt;span class=&quot;token punctuation&quot;&gt;-&lt;/span&gt;workqueue&lt;span class=&quot;token punctuation&quot;&gt;-&lt;/span&gt;job
&lt;span class=&quot;token key atrule&quot;&gt;spec&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt;
  &lt;span class=&quot;token comment&quot;&gt;# 지정하지 않음&lt;/span&gt;
  &lt;span class=&quot;token comment&quot;&gt;# completions: 1&lt;/span&gt;
  &lt;span class=&quot;token key atrule&quot;&gt;parallelism&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;token number&quot;&gt;1&lt;/span&gt;
  &lt;span class=&quot;token key atrule&quot;&gt;backoffLimit&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;token number&quot;&gt;1&lt;/span&gt;
  &lt;span class=&quot;token key atrule&quot;&gt;template&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt;
    &lt;span class=&quot;token key atrule&quot;&gt;metadata&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt;
      &lt;span class=&quot;token key atrule&quot;&gt;name&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt; sleep&lt;span class=&quot;token punctuation&quot;&gt;-&lt;/span&gt;job
    &lt;span class=&quot;token key atrule&quot;&gt;spec&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt;
      &lt;span class=&quot;token key atrule&quot;&gt;containers&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt;
      &lt;span class=&quot;token punctuation&quot;&gt;-&lt;/span&gt; &lt;span class=&quot;token key atrule&quot;&gt;name&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt; sleep&lt;span class=&quot;token punctuation&quot;&gt;-&lt;/span&gt;container
        &lt;span class=&quot;token key atrule&quot;&gt;image&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt; amsy810/tools&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt;v2.0
        &lt;span class=&quot;token key atrule&quot;&gt;command&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;[&lt;/span&gt;&lt;span class=&quot;token string&quot;&gt;&quot;sleep&quot;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;]&lt;/span&gt;
        &lt;span class=&quot;token key atrule&quot;&gt;args&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;[&lt;/span&gt;&lt;span class=&quot;token string&quot;&gt;&quot;30&quot;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;]&lt;/span&gt;
      &lt;span class=&quot;token key atrule&quot;&gt;restartPolicy&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt; Never&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;h2&gt;5.7.4 일정 기간 후 잡 삭제&lt;/h2&gt;
&lt;p&gt;잡 리소스는 한 번만 실행하는 태스크로 생성하는 경우가 있는데, 잡은 종료 후에 삭제되지 않고 계속 남는다. &lt;code class=&quot;language-text&quot;&gt;spec.ttlSecondsAfterFinished&lt;/code&gt;를 설정하여 잡이 종료한 후 일정 시간 경과 후 삭제하도록 설정할 수 있다.&lt;/p&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;yaml&quot;&gt;&lt;pre class=&quot;language-yaml&quot;&gt;&lt;code class=&quot;language-yaml&quot;&gt;&lt;span class=&quot;token key atrule&quot;&gt;apiVersion&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt; batch/v1
&lt;span class=&quot;token key atrule&quot;&gt;kind&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt; Job
&lt;span class=&quot;token key atrule&quot;&gt;metadata&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt;
  &lt;span class=&quot;token key atrule&quot;&gt;name&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt; sample&lt;span class=&quot;token punctuation&quot;&gt;-&lt;/span&gt;job&lt;span class=&quot;token punctuation&quot;&gt;-&lt;/span&gt;ttl
&lt;span class=&quot;token key atrule&quot;&gt;spec&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt;
  &lt;span class=&quot;token comment&quot;&gt;# 잡 종료 30초 후 파드 파기&lt;/span&gt;
  &lt;span class=&quot;token key atrule&quot;&gt;ttlSecondsAfterFinished&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;token number&quot;&gt;30&lt;/span&gt;
  &lt;span class=&quot;token key atrule&quot;&gt;completions&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;token number&quot;&gt;1&lt;/span&gt;
  &lt;span class=&quot;token key atrule&quot;&gt;parallelism&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;token number&quot;&gt;1&lt;/span&gt;
  &lt;span class=&quot;token key atrule&quot;&gt;backoffLimit&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;token number&quot;&gt;10&lt;/span&gt;
  &lt;span class=&quot;token key atrule&quot;&gt;template&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt;
    &lt;span class=&quot;token key atrule&quot;&gt;spec&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt;
      &lt;span class=&quot;token key atrule&quot;&gt;containers&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt;
      &lt;span class=&quot;token punctuation&quot;&gt;-&lt;/span&gt; &lt;span class=&quot;token key atrule&quot;&gt;name&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt; tools&lt;span class=&quot;token punctuation&quot;&gt;-&lt;/span&gt;container
        &lt;span class=&quot;token key atrule&quot;&gt;image&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt; amsy810/tools&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt;v2.0
        &lt;span class=&quot;token key atrule&quot;&gt;command&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;[&lt;/span&gt;&lt;span class=&quot;token string&quot;&gt;&quot;sleep&quot;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;]&lt;/span&gt;
        &lt;span class=&quot;token key atrule&quot;&gt;args&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;[&lt;/span&gt;&lt;span class=&quot;token string&quot;&gt;&quot;60&quot;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;]&lt;/span&gt;
      &lt;span class=&quot;token key atrule&quot;&gt;restartPolicy&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt; Never&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;sh&quot;&gt;&lt;pre class=&quot;language-sh&quot;&gt;&lt;code class=&quot;language-sh&quot;&gt;&lt;span class=&quot;token comment&quot;&gt;# Job 상태 모니터링&lt;/span&gt;
$ kubectl apply &lt;span class=&quot;token parameter variable&quot;&gt;-f&lt;/span&gt; sample-job-ttl.yaml
job.batch/sample-job-ttl created

$ kubectl get job sample-job-ttl &lt;span class=&quot;token parameter variable&quot;&gt;--watch&lt;/span&gt; --output-watch-events
EVENT      NAME             COMPLETIONS   DURATION   AGE
ADDED      sample-job-ttl   &lt;span class=&quot;token number&quot;&gt;0&lt;/span&gt;/1           17s        17s        &lt;span class=&quot;token comment&quot;&gt;# 잡 기동&lt;/span&gt;
MODIFIED   sample-job-ttl   &lt;span class=&quot;token number&quot;&gt;0&lt;/span&gt;/1           62s        62s
MODIFIED   sample-job-ttl   &lt;span class=&quot;token number&quot;&gt;1&lt;/span&gt;/1           64s        64s        &lt;span class=&quot;token comment&quot;&gt;# 잡 완료 (+60초 후)&lt;/span&gt;
DELETED    sample-job-ttl   &lt;span class=&quot;token number&quot;&gt;1&lt;/span&gt;/1           64s        94s        &lt;span class=&quot;token comment&quot;&gt;# 잡 자동 삭제 (+30초 후)&lt;/span&gt;

&lt;span class=&quot;token comment&quot;&gt;# 삭제되고 나면 job 모니터링 불가&lt;/span&gt;
$ kubectl get job sample-job-ttl
Error from server &lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;NotFound&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;: jobs.batch &lt;span class=&quot;token string&quot;&gt;&quot;sample-job-ttl&quot;&lt;/span&gt; not found&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;h2&gt;5.7.5 매니페스트 사용하지 않고 잡 생성&lt;/h2&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;sh&quot;&gt;&lt;pre class=&quot;language-sh&quot;&gt;&lt;code class=&quot;language-sh&quot;&gt;&lt;span class=&quot;token comment&quot;&gt;# 매니페스트 사용 없이 명령어로 잡 생성&lt;/span&gt;
$ kubectl create job sample-job-by-cli &lt;span class=&quot;token punctuation&quot;&gt;\&lt;/span&gt;
&lt;span class=&quot;token parameter variable&quot;&gt;--image&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt;amsy810/tools:v2.0 &lt;span class=&quot;token punctuation&quot;&gt;\&lt;/span&gt;
-- &lt;span class=&quot;token function&quot;&gt;sleep&lt;/span&gt; &lt;span class=&quot;token number&quot;&gt;30&lt;/span&gt;
job.batch/sample-job-by-cli created&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;h1&gt;5.8 크론잡&lt;/h1&gt;
&lt;p&gt;크론잡은 크론과 같이 스케줄링된 시간에 잡을 생성한다. 크론잡은 잡의 변형된 형태로 보이지만, 크란잡과 잡의 관계는 디플로이먼트와 레플리카셋의 관계이다. 즉, 크론잡이 잡을 관리하고 잡이 파드를 관리하는 3계층 구조라고 할 수 있다.&lt;/p&gt;
&lt;h2&gt;5.8.1 크론잡 생성&lt;/h2&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;yaml&quot;&gt;&lt;pre class=&quot;language-yaml&quot;&gt;&lt;code class=&quot;language-yaml&quot;&gt;&lt;span class=&quot;token key atrule&quot;&gt;apiVersion&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt; batch/v1beta1
&lt;span class=&quot;token key atrule&quot;&gt;kind&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt; CronJob
&lt;span class=&quot;token key atrule&quot;&gt;metadata&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt;
  &lt;span class=&quot;token key atrule&quot;&gt;name&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt; sample&lt;span class=&quot;token punctuation&quot;&gt;-&lt;/span&gt;cronjob
&lt;span class=&quot;token key atrule&quot;&gt;spec&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt;
  &lt;span class=&quot;token key atrule&quot;&gt;schedule&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;token string&quot;&gt;&quot;*/1 * * * *&quot;&lt;/span&gt;
  &lt;span class=&quot;token key atrule&quot;&gt;concurrencyPolicy&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt; Allow
  &lt;span class=&quot;token key atrule&quot;&gt;startingDeadlineSeconds&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;token number&quot;&gt;30&lt;/span&gt;
  &lt;span class=&quot;token key atrule&quot;&gt;successfulJobsHistoryLimit&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;token number&quot;&gt;5&lt;/span&gt;
  &lt;span class=&quot;token key atrule&quot;&gt;failedJobsHistoryLimit&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;token number&quot;&gt;3&lt;/span&gt;
  &lt;span class=&quot;token key atrule&quot;&gt;suspend&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;token boolean important&quot;&gt;false&lt;/span&gt;
  &lt;span class=&quot;token key atrule&quot;&gt;jobTemplate&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt;
    &lt;span class=&quot;token key atrule&quot;&gt;spec&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt;
      &lt;span class=&quot;token key atrule&quot;&gt;completions&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;token number&quot;&gt;1&lt;/span&gt;
      &lt;span class=&quot;token key atrule&quot;&gt;parallelism&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;token number&quot;&gt;1&lt;/span&gt;
      &lt;span class=&quot;token key atrule&quot;&gt;backoffLimit&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;token number&quot;&gt;0&lt;/span&gt;
      &lt;span class=&quot;token key atrule&quot;&gt;template&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt;
        &lt;span class=&quot;token key atrule&quot;&gt;spec&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt;
          &lt;span class=&quot;token key atrule&quot;&gt;containers&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt;
          &lt;span class=&quot;token punctuation&quot;&gt;-&lt;/span&gt; &lt;span class=&quot;token key atrule&quot;&gt;name&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt; tools&lt;span class=&quot;token punctuation&quot;&gt;-&lt;/span&gt;container
            &lt;span class=&quot;token key atrule&quot;&gt;image&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt; amsy810/tools&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt;v2.0
          &lt;span class=&quot;token key atrule&quot;&gt;restartPolicy&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt; Never&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;sh&quot;&gt;&lt;pre class=&quot;language-sh&quot;&gt;&lt;code class=&quot;language-sh&quot;&gt;&lt;span class=&quot;token comment&quot;&gt;# 크론잡 생성&lt;/span&gt;
$ kubectl apply &lt;span class=&quot;token parameter variable&quot;&gt;-f&lt;/span&gt; sample-cronjob.yaml
Warning: batch/v1beta1 CronJob is deprecated &lt;span class=&quot;token keyword&quot;&gt;in&lt;/span&gt; v1.21+, unavailable &lt;span class=&quot;token keyword&quot;&gt;in&lt;/span&gt; v1.25+&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt; use batch/v1 CronJob
cronjob.batch/sample-cronjob created

&lt;span class=&quot;token comment&quot;&gt;# 스케줄 되지 않은 경우 잡이 존재하지 않음&lt;/span&gt;
kubectl get cronjobs
NAME             SCHEDULE      SUSPEND   ACTIVE   LAST SCHEDULE   AGE
sample-cronjob   */1 * * * *   False     &lt;span class=&quot;token number&quot;&gt;0&lt;/span&gt;        &lt;span class=&quot;token operator&quot;&gt;&amp;lt;&lt;/span&gt;none&lt;span class=&quot;token operator&quot;&gt;&gt;&lt;/span&gt;          17s

$ kubectl get &lt;span class=&quot;token function&quot;&gt;jobs&lt;/span&gt;
No resources found &lt;span class=&quot;token keyword&quot;&gt;in&lt;/span&gt; default namespace.

&lt;span class=&quot;token comment&quot;&gt;# LAST SCHEDULE이 업데이트됨&lt;/span&gt;
$ kubectl get cronjobs
NAME             SCHEDULE      SUSPEND   ACTIVE   LAST SCHEDULE   AGE
sample-cronjob   */1 * * * *   False     &lt;span class=&quot;token number&quot;&gt;1&lt;/span&gt;        46s             104s

$ kubectl get &lt;span class=&quot;token function&quot;&gt;jobs&lt;/span&gt;
NAME                      COMPLETIONS   DURATION   AGE
sample-cronjob-27704532   &lt;span class=&quot;token number&quot;&gt;0&lt;/span&gt;/1           2m29s      2m29s
sample-cronjob-27704533   &lt;span class=&quot;token number&quot;&gt;0&lt;/span&gt;/1           89s        89s
sample-cronjob-27704534   &lt;span class=&quot;token number&quot;&gt;0&lt;/span&gt;/1           29s        29s&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;h2&gt;5.8.2 크론잡 일시 정지&lt;/h2&gt;
&lt;p&gt;크론잡은 지정한 시간에 잡을 계속 생성한다. 점검이나 어떤 이유로 잡 생성을 원치 않을 경우에는 일시정지할 수 있다. 크론잡에서는 &lt;code class=&quot;language-text&quot;&gt;spec.suspend&lt;/code&gt;가 ture로 설정되어 있으면 스케줄 대상에서 제외된다.&lt;/p&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;sh&quot;&gt;&lt;pre class=&quot;language-sh&quot;&gt;&lt;code class=&quot;language-sh&quot;&gt;&lt;span class=&quot;token comment&quot;&gt;# 클라이언트에서 크론잡 일시 정지 진행&lt;/span&gt;
$ kubectl patch cronjob sample-cronjob &lt;span class=&quot;token parameter variable&quot;&gt;-p&lt;/span&gt; &lt;span class=&quot;token string&quot;&gt;&apos;{&quot;spec&quot;: {&quot;suspend&quot;: true}}&apos;&lt;/span&gt;
cronjob.batch/sample-cronjob patched

&lt;span class=&quot;token comment&quot;&gt;# 크론잡이 일시 정지한 상태&lt;/span&gt;
$ kubectl get cronjobs
NAME             SCHEDULE      SUSPEND   ACTIVE   LAST SCHEDULE   AGE
sample-cronjob   */1 * * * *   True      &lt;span class=&quot;token number&quot;&gt;6&lt;/span&gt;        41s             6m39s&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;h2&gt;5.8.3 임의 시점에 크론잡 실행&lt;/h2&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;sh&quot;&gt;&lt;pre class=&quot;language-sh&quot;&gt;&lt;code class=&quot;language-sh&quot;&gt;$ kubectl create job sample-job-from-cronjob &lt;span class=&quot;token parameter variable&quot;&gt;--from&lt;/span&gt; cronjob/sample-cronjob
job.batch/sample-job-from-cronjob created&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;h2&gt;5.8.4 동시 실행 제어&lt;/h2&gt;
&lt;p&gt;크론잡에서는 잡을 생성하는 특성상 동시 실행에 대한 정책을 설정할 수 있다. 잡 실행이 의도한 시간 간격 안에서 정상 종료할 때는 명시적으로 지정하지 않아도 동시 실행되지 않고 새로운 잡을 실행한다. 한편 기존 잡이 아직 실행되고 있을 때는 정책으로 새로운 잡을 실행할지 말지 제어하고 싶은 경우가 있다. 동시 실행에 대한 정책은 &lt;code class=&quot;language-text&quot;&gt;spec.concurrencyPolicy&lt;/code&gt;에서 설정한다.&lt;/p&gt;
&lt;table&gt;
&lt;thead&gt;
&lt;tr&gt;
&lt;th&gt;정책&lt;/th&gt;
&lt;th&gt;개요&lt;/th&gt;
&lt;/tr&gt;
&lt;/thead&gt;
&lt;tbody&gt;
&lt;tr&gt;
&lt;td&gt;Allow(기본값)&lt;/td&gt;
&lt;td&gt;동시 실행에 대한 제한을 하지 않음&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;Forbid&lt;/td&gt;
&lt;td&gt;이전 잡이 종료되지 않았을 때는 다음 잡을 실행하지 않음&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;Replace&lt;/td&gt;
&lt;td&gt;이전 잡을 취소하고 잡을 시작&lt;/td&gt;
&lt;/tr&gt;
&lt;/tbody&gt;
&lt;/table&gt;
&lt;h2&gt;5.8.5 실행 시작 기한 제어&lt;/h2&gt;
&lt;p&gt;크론잡은 지정한 시간이 되면 쿠버네티스 마스터가 잡을 생성한다. 따라서 쿠버네티스 마스터가 일시적으로 정지되는 경우 등과 같이 시작 시간이 지연되면, 그 지연 시간을 허용하는 시간(초, &lt;code class=&quot;language-text&quot;&gt;spec.startingDeadlineSeconds&lt;/code&gt;)을 지정할 수 있다. 기본값에서는 시작 시간이 아무리 늦어져도 잡을 생성하게 되어 있다.&lt;/p&gt;
&lt;h2&gt;5.8.6 크론잡 이력&lt;/h2&gt;
&lt;p&gt;크론잡 설정 항목에는 이외에도 저장할 잡 개수를 지정하는 &lt;code class=&quot;language-text&quot;&gt;spec.successfulJobsHistoryLimit&lt;/code&gt;와 &lt;code class=&quot;language-text&quot;&gt;spec.failedJobsHistoryLimit&lt;/code&gt;가 있다.&lt;/p&gt;
&lt;table&gt;
&lt;thead&gt;
&lt;tr&gt;
&lt;th&gt;설정 항목&lt;/th&gt;
&lt;th&gt;개요&lt;/th&gt;
&lt;/tr&gt;
&lt;/thead&gt;
&lt;tbody&gt;
&lt;tr&gt;
&lt;td&gt;spec.successfulJobsHistoryLimit&lt;/td&gt;
&lt;td&gt;성공한 잡을 저장하는 개수&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;spec.failedJobsHistoryLimit&lt;/td&gt;
&lt;td&gt;실패한 잡을 저장하는 개수&lt;/td&gt;
&lt;/tr&gt;
&lt;/tbody&gt;
&lt;/table&gt;
&lt;p&gt;이 설정값은 크론잡이 생성할 잡을 몇 개 유지할지를 지정한다. 잡이 남아 있다는 것은 잡에 연결되어 있는 파드도 &apos;Completed(정상 종료)&apos;, &apos;Error(이상 종료)&apos; 의 상태로 남아 있고 &lt;code class=&quot;language-text&quot;&gt;kubectl log&lt;/code&gt; 명령어로 로그를 확인할 수 있다는 의미이다. 만약 두 값이 모두 0이면, 잡은 종료 즉시 삭제된다. 또 기본 설정값은 두 파라미터 모두 3이다. 그러나 실제 운영 환경에서는 컨테이너 로그를 외부 로그 시스템을 통해 운영하는 것을 추천한다. 로그를 별도 시스템으로 수집하면 &lt;code class=&quot;language-text&quot;&gt;kubectl&lt;/code&gt; 명령어로 로그를 확인할 필요도 없고 가용성이 높은 환경에 로그를 저장할 수 있다.&lt;/p&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;sh&quot;&gt;&lt;pre class=&quot;language-sh&quot;&gt;&lt;code class=&quot;language-sh&quot;&gt;&lt;span class=&quot;token comment&quot;&gt;# 크론잡이 생성한 잡 확인&lt;/span&gt;
$ kubectl get &lt;span class=&quot;token function&quot;&gt;jobs&lt;/span&gt;
NAME                      COMPLETIONS   DURATION   AGE
sample-cronjob-27704553   &lt;span class=&quot;token number&quot;&gt;0&lt;/span&gt;/1           52s        52s

&lt;span class=&quot;token comment&quot;&gt;# 잡이 생성한 파드 확인&lt;/span&gt;
$ kubectl get pods
NAME                                 READY   STATUS    RESTARTS        AGE
sample-cronjob-27704553-mjsdz        &lt;span class=&quot;token number&quot;&gt;1&lt;/span&gt;/1     Running   &lt;span class=&quot;token number&quot;&gt;0&lt;/span&gt;               77s

&lt;span class=&quot;token comment&quot;&gt;# 로그 확인&lt;/span&gt;
$ kubectl logs sample-cronjob-27704553-mjsdz
Succeeded&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;h2&gt;5.8.7 매니페스트를 사용하지 않고 크론잡 생성&lt;/h2&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;sh&quot;&gt;&lt;pre class=&quot;language-sh&quot;&gt;&lt;code class=&quot;language-sh&quot;&gt;&lt;span class=&quot;token comment&quot;&gt;# 매니페스트를 사용하지 않고 명령어로 크론잡 생성&lt;/span&gt;
$ kubectl create cronjob sample-cronjob-by-cli &lt;span class=&quot;token punctuation&quot;&gt;\&lt;/span&gt;
&lt;span class=&quot;token parameter variable&quot;&gt;--image&lt;/span&gt; amsy810/random-exit:v2.0 &lt;span class=&quot;token punctuation&quot;&gt;\&lt;/span&gt;
&lt;span class=&quot;token parameter variable&quot;&gt;--schedule&lt;/span&gt; &lt;span class=&quot;token string&quot;&gt;&quot;*/1 * * * * &quot;&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;\&lt;/span&gt;
&lt;span class=&quot;token parameter variable&quot;&gt;--restart&lt;/span&gt; Never&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;</content:encoded></item><item><title><![CDATA[[쿠버네티스 완벽 가이드] 10. 워크로드 API 카테고리 (4) - 데몬셋, 스테이트풀셋]]></title><description><![CDATA[5.5 데몬셋 데몬셋(DaemonSet)은 레플리카셋의 특수한 형태라고 할 수 있는 리소스이다. 레플리카셋은 각 쿠버네티스 노드에 총 N…]]></description><link>https://github.com/SiverPineValley/SiverPineValley.github.io/kubernetes/kubernetes_5_4/</link><guid isPermaLink="false">https://github.com/SiverPineValley/SiverPineValley.github.io/kubernetes/kubernetes_5_4/</guid><pubDate>Sun, 28 Aug 2022 16:10:00 GMT</pubDate><content:encoded>&lt;h1&gt;5.5 데몬셋&lt;/h1&gt;
&lt;p&gt;데몬셋(DaemonSet)은 레플리카셋의 특수한 형태라고 할 수 있는 리소스이다. 레플리카셋은 각 쿠버네티스 노드에 총 N개의 파드를 노드의 리소스 상황에 맞게 배치한다. 그래서 각 노드의 파드 수가 동일하다고 할 수 없으며, 모든 노드에 반드시 배치된다고도 할 수 없다. 그러나 대몬셋은 각 노드에 파드를 하나씩 배치하는 리소스이다. 따라서 데몬셋은 레플리카 수를 지정할 수 없고 하나의 노드에 두 개의 파드를 배치할 수도 없다. 쿠버네티스 노드를 늘렸을 때에도 데몬셋의 파드는 자동으로 늘어난 노드에서 기동한다. 따라서 데몬셋은 각 파드가 출력하는 로그를 호스트 단위로 수집하는 플루언트디(Fluentd)나, 각 파드 리소스 사용 현황 및 노드 상태를 모니터링하는 데이터독(Datadog)등 모든 노드에서 반드시 동작해야 하는 프로세스를 위해 사용하는 것이 유용하다.&lt;/p&gt;
&lt;h2&gt;5.5.1 데몬셋 생성&lt;/h2&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;yaml&quot;&gt;&lt;pre class=&quot;language-yaml&quot;&gt;&lt;code class=&quot;language-yaml&quot;&gt;&lt;span class=&quot;token key atrule&quot;&gt;apiVersion&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt; apps/v1
&lt;span class=&quot;token key atrule&quot;&gt;kind&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt; DaemonSet
&lt;span class=&quot;token key atrule&quot;&gt;metadata&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt;
  &lt;span class=&quot;token key atrule&quot;&gt;name&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt; sample&lt;span class=&quot;token punctuation&quot;&gt;-&lt;/span&gt;ds
&lt;span class=&quot;token key atrule&quot;&gt;spec&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt;
  &lt;span class=&quot;token key atrule&quot;&gt;selector&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt;
    &lt;span class=&quot;token key atrule&quot;&gt;matchLabels&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt;
      &lt;span class=&quot;token key atrule&quot;&gt;app&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt; sample&lt;span class=&quot;token punctuation&quot;&gt;-&lt;/span&gt;app
  &lt;span class=&quot;token key atrule&quot;&gt;template&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt;
    &lt;span class=&quot;token key atrule&quot;&gt;metadata&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt;
      &lt;span class=&quot;token key atrule&quot;&gt;labels&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt;
        &lt;span class=&quot;token key atrule&quot;&gt;app&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt; sample&lt;span class=&quot;token punctuation&quot;&gt;-&lt;/span&gt;app
    &lt;span class=&quot;token key atrule&quot;&gt;spec&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt;
      &lt;span class=&quot;token key atrule&quot;&gt;containers&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt;
        &lt;span class=&quot;token punctuation&quot;&gt;-&lt;/span&gt; &lt;span class=&quot;token key atrule&quot;&gt;name&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt; nginx&lt;span class=&quot;token punctuation&quot;&gt;-&lt;/span&gt;container
          &lt;span class=&quot;token key atrule&quot;&gt;image&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt; nginx&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt;&lt;span class=&quot;token number&quot;&gt;1.16&lt;/span&gt;
          &lt;span class=&quot;token key atrule&quot;&gt;ports&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt;
            &lt;span class=&quot;token punctuation&quot;&gt;-&lt;/span&gt; &lt;span class=&quot;token key atrule&quot;&gt;containerPort&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;token number&quot;&gt;80&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;sh&quot;&gt;&lt;pre class=&quot;language-sh&quot;&gt;&lt;code class=&quot;language-sh&quot;&gt;&lt;span class=&quot;token comment&quot;&gt;# 데몬셋 생성&lt;/span&gt;
$ kubectl apply &lt;span class=&quot;token parameter variable&quot;&gt;-f&lt;/span&gt; sample-ds.yaml
daemonset.apps/sample-ds created

$ kubectl get pods &lt;span class=&quot;token parameter variable&quot;&gt;-o&lt;/span&gt; wide
NAME                                 READY   STATUS    RESTARTS       AGE   IP            NODE                   NOMINATED NODE   READINESS GATES
sample-ds-bfjcl                      &lt;span class=&quot;token number&quot;&gt;1&lt;/span&gt;/1     Running   &lt;span class=&quot;token number&quot;&gt;0&lt;/span&gt;              18s   &lt;span class=&quot;token number&quot;&gt;10.244&lt;/span&gt;.1.12   kind-cluster-worker2   &lt;span class=&quot;token operator&quot;&gt;&amp;lt;&lt;/span&gt;none&lt;span class=&quot;token operator&quot;&gt;&gt;&lt;/span&gt;           &lt;span class=&quot;token operator&quot;&gt;&amp;lt;&lt;/span&gt;none&lt;span class=&quot;token operator&quot;&gt;&gt;&lt;/span&gt;
sample-ds-hfxsm                      &lt;span class=&quot;token number&quot;&gt;1&lt;/span&gt;/1     Running   &lt;span class=&quot;token number&quot;&gt;0&lt;/span&gt;              18s   &lt;span class=&quot;token number&quot;&gt;10.244&lt;/span&gt;.3.13   kind-cluster-worker    &lt;span class=&quot;token operator&quot;&gt;&amp;lt;&lt;/span&gt;none&lt;span class=&quot;token operator&quot;&gt;&gt;&lt;/span&gt;           &lt;span class=&quot;token operator&quot;&gt;&amp;lt;&lt;/span&gt;none&lt;span class=&quot;token operator&quot;&gt;&gt;&lt;/span&gt;
sample-ds-v57kf                      &lt;span class=&quot;token number&quot;&gt;1&lt;/span&gt;/1     Running   &lt;span class=&quot;token number&quot;&gt;0&lt;/span&gt;              18s   &lt;span class=&quot;token number&quot;&gt;10.244&lt;/span&gt;.2.13   kind-cluster-worker3   &lt;span class=&quot;token operator&quot;&gt;&amp;lt;&lt;/span&gt;none&lt;span class=&quot;token operator&quot;&gt;&gt;&lt;/span&gt;           &lt;span class=&quot;token operator&quot;&gt;&amp;lt;&lt;/span&gt;none&lt;span class=&quot;token operator&quot;&gt;&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;h2&gt;5.5.2  데몬셋 업데이트 전략&lt;/h2&gt;
&lt;p&gt;디플로이먼트와 마찬가지로, 데몬셋 업데이트에서도 두 가지 업데이트 전략 중 하나를 선택할 수 있다.&lt;/p&gt;
&lt;table&gt;
&lt;thead&gt;
&lt;tr&gt;
&lt;th&gt;업데이트 전략&lt;/th&gt;
&lt;th&gt;내용&lt;/th&gt;
&lt;/tr&gt;
&lt;/thead&gt;
&lt;tbody&gt;
&lt;tr&gt;
&lt;td&gt;&lt;code class=&quot;language-text&quot;&gt;OnDelete&lt;/code&gt;&lt;/td&gt;
&lt;td&gt;데몬셋 매니페스트가 변경되었을 때 파드를 업데이트하지 않고 다른 이유로 파드가 다시 생성될 때 새로운 정의로 파드를 생성한다.&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;&lt;code class=&quot;language-text&quot;&gt;RollingUpdate&lt;/code&gt;&lt;/td&gt;
&lt;td&gt;디플로이먼트와 마찬가지로 파드를 업데이트&lt;/td&gt;
&lt;/tr&gt;
&lt;/tbody&gt;
&lt;/table&gt;
&lt;h3&gt;OnDelete&lt;/h3&gt;
&lt;p&gt;&lt;code class=&quot;language-text&quot;&gt;OnDelete&lt;/code&gt;에서는 데몬셋 매니페스트를 수정하여 이미지 등을 변경하였더라도 기존 파드는 업데이트 되지 않는다. 디플로이먼트와 달리 데몬셋은 모니터링이나 로그 전송과 같은 용도로 많이 사용되기 때문에, 업데이트는 다음 번에 다시 생성할 때나 수동으로 임의의 시점에 하게 되어 있다. 또한, &lt;code class=&quot;language-text&quot;&gt;type&lt;/code&gt; 외에 지정할 수 있는 항목은 없다.&lt;/p&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;yaml&quot;&gt;&lt;pre class=&quot;language-yaml&quot;&gt;&lt;code class=&quot;language-yaml&quot;&gt;&lt;span class=&quot;token key atrule&quot;&gt;apiVersion&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt; apps/v1
&lt;span class=&quot;token key atrule&quot;&gt;kind&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt; DaemonSet
&lt;span class=&quot;token key atrule&quot;&gt;metadata&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt;
  &lt;span class=&quot;token key atrule&quot;&gt;name&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt; sample&lt;span class=&quot;token punctuation&quot;&gt;-&lt;/span&gt;ds&lt;span class=&quot;token punctuation&quot;&gt;-&lt;/span&gt;ondelete
&lt;span class=&quot;token key atrule&quot;&gt;spec&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt;
  &lt;span class=&quot;token key atrule&quot;&gt;updateStrategy&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt;
    &lt;span class=&quot;token key atrule&quot;&gt;type&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt; OnDelete
  &lt;span class=&quot;token key atrule&quot;&gt;selector&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt;
    &lt;span class=&quot;token key atrule&quot;&gt;matchLabels&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt;
      &lt;span class=&quot;token key atrule&quot;&gt;app&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt; sample&lt;span class=&quot;token punctuation&quot;&gt;-&lt;/span&gt;app
  &lt;span class=&quot;token key atrule&quot;&gt;template&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt;
    &lt;span class=&quot;token key atrule&quot;&gt;metadata&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt;
      &lt;span class=&quot;token key atrule&quot;&gt;labels&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt;
        &lt;span class=&quot;token key atrule&quot;&gt;app&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt; sample&lt;span class=&quot;token punctuation&quot;&gt;-&lt;/span&gt;app
    &lt;span class=&quot;token key atrule&quot;&gt;spec&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt;
      &lt;span class=&quot;token key atrule&quot;&gt;containers&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt;
        &lt;span class=&quot;token punctuation&quot;&gt;-&lt;/span&gt; &lt;span class=&quot;token key atrule&quot;&gt;name&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt; nginx&lt;span class=&quot;token punctuation&quot;&gt;-&lt;/span&gt;container
          &lt;span class=&quot;token key atrule&quot;&gt;image&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt; nginx&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt;&lt;span class=&quot;token number&quot;&gt;1.16&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;sh&quot;&gt;&lt;pre class=&quot;language-sh&quot;&gt;&lt;code class=&quot;language-sh&quot;&gt;&lt;span class=&quot;token comment&quot;&gt;# 데몬셋 생성&lt;/span&gt;
$ kubectl apply &lt;span class=&quot;token parameter variable&quot;&gt;-f&lt;/span&gt; sample-ds-ondelete.yaml
daemonset.apps/sample-ds-ondelete created

$ kubectl get pods &lt;span class=&quot;token parameter variable&quot;&gt;-o&lt;/span&gt; wide
NAME                                 READY   STATUS    RESTARTS       AGE   IP            NODE                   NOMINATED NODE   READINESS GATES
sample-ds-ondelete-2hnvb             &lt;span class=&quot;token number&quot;&gt;1&lt;/span&gt;/1     Running   &lt;span class=&quot;token number&quot;&gt;0&lt;/span&gt;              12s     &lt;span class=&quot;token number&quot;&gt;10.244&lt;/span&gt;.1.13   kind-cluster-worker2   &lt;span class=&quot;token operator&quot;&gt;&amp;lt;&lt;/span&gt;none&lt;span class=&quot;token operator&quot;&gt;&gt;&lt;/span&gt;           &lt;span class=&quot;token operator&quot;&gt;&amp;lt;&lt;/span&gt;none&lt;span class=&quot;token operator&quot;&gt;&gt;&lt;/span&gt;
sample-ds-ondelete-65jvc             &lt;span class=&quot;token number&quot;&gt;1&lt;/span&gt;/1     Running   &lt;span class=&quot;token number&quot;&gt;0&lt;/span&gt;              12s     &lt;span class=&quot;token number&quot;&gt;10.244&lt;/span&gt;.3.14   kind-cluster-worker    &lt;span class=&quot;token operator&quot;&gt;&amp;lt;&lt;/span&gt;none&lt;span class=&quot;token operator&quot;&gt;&gt;&lt;/span&gt;           &lt;span class=&quot;token operator&quot;&gt;&amp;lt;&lt;/span&gt;none&lt;span class=&quot;token operator&quot;&gt;&gt;&lt;/span&gt;
sample-ds-ondelete-8zf5s             &lt;span class=&quot;token number&quot;&gt;1&lt;/span&gt;/1     Running   &lt;span class=&quot;token number&quot;&gt;0&lt;/span&gt;              12s     &lt;span class=&quot;token number&quot;&gt;10.244&lt;/span&gt;.2.14   kind-cluster-worker3   &lt;span class=&quot;token operator&quot;&gt;&amp;lt;&lt;/span&gt;none&lt;span class=&quot;token operator&quot;&gt;&gt;&lt;/span&gt;           &lt;span class=&quot;token operator&quot;&gt;&amp;lt;&lt;/span&gt;none&lt;span class=&quot;token operator&quot;&gt;&gt;&lt;/span&gt;

&lt;span class=&quot;token comment&quot;&gt;# 하나의 파드만 삭제하여 다시 생성&lt;/span&gt;
$ kubectl delete pod sample-ds-ondelete-2hnvb
pod &lt;span class=&quot;token string&quot;&gt;&quot;sample-ds-ondelete-2hnvb&quot;&lt;/span&gt; deleted

$ kubectl get pods &lt;span class=&quot;token parameter variable&quot;&gt;-o&lt;/span&gt; wide
NAME                                 READY   STATUS    RESTARTS       AGE    IP            NODE                   NOMINATED NODE   READINESS GATES
sample-ds-ondelete-65jvc             &lt;span class=&quot;token number&quot;&gt;1&lt;/span&gt;/1     Running   &lt;span class=&quot;token number&quot;&gt;0&lt;/span&gt;              79s    &lt;span class=&quot;token number&quot;&gt;10.244&lt;/span&gt;.3.14   kind-cluster-worker    &lt;span class=&quot;token operator&quot;&gt;&amp;lt;&lt;/span&gt;none&lt;span class=&quot;token operator&quot;&gt;&gt;&lt;/span&gt;           &lt;span class=&quot;token operator&quot;&gt;&amp;lt;&lt;/span&gt;none&lt;span class=&quot;token operator&quot;&gt;&gt;&lt;/span&gt;
sample-ds-ondelete-84d27             &lt;span class=&quot;token number&quot;&gt;1&lt;/span&gt;/1     Running   &lt;span class=&quot;token number&quot;&gt;0&lt;/span&gt;              2s     &lt;span class=&quot;token number&quot;&gt;10.244&lt;/span&gt;.1.14   kind-cluster-worker2   &lt;span class=&quot;token operator&quot;&gt;&amp;lt;&lt;/span&gt;none&lt;span class=&quot;token operator&quot;&gt;&gt;&lt;/span&gt;           &lt;span class=&quot;token operator&quot;&gt;&amp;lt;&lt;/span&gt;none&lt;span class=&quot;token operator&quot;&gt;&gt;&lt;/span&gt;
sample-ds-ondelete-8zf5s             &lt;span class=&quot;token number&quot;&gt;1&lt;/span&gt;/1     Running   &lt;span class=&quot;token number&quot;&gt;0&lt;/span&gt;              79s    &lt;span class=&quot;token number&quot;&gt;10.244&lt;/span&gt;.2.14   kind-cluster-worker3   &lt;span class=&quot;token operator&quot;&gt;&amp;lt;&lt;/span&gt;none&lt;span class=&quot;token operator&quot;&gt;&gt;&lt;/span&gt;           &lt;span class=&quot;token operator&quot;&gt;&amp;lt;&lt;/span&gt;none&lt;span class=&quot;token operator&quot;&gt;&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;h3&gt;RollingUpdate&lt;/h3&gt;
&lt;p&gt;데몬셋도 디플로이먼트와 마찬가지로 &lt;code class=&quot;language-text&quot;&gt;RollingUpdate&lt;/code&gt;를 사용한 업데이트가 가능하다. 그러나 데몬셋에서는 하나의 노드에 하나의 파드만 가지므로, 디플로이먼트와 달리 동시에 생성할 수 있는 최대 파드 수(&lt;code class=&quot;language-text&quot;&gt;maxSurge&lt;/code&gt;)를 설정할 수 없다. 동시에 정지 가능한 최대 파드 수(&lt;code class=&quot;language-text&quot;&gt;maxUnavailable&lt;/code&gt;)만 지정할 수 있다. 이 기본값은 1이며 0으로 지정할 수 없다.&lt;/p&gt;
&lt;h1&gt;5.6 스테이트풀셋&lt;/h1&gt;
&lt;p&gt;스테이트풀셋(statefulSet)도 데몬셋과 마찬가지로 레플리카셋의 특수한 형태라고 할 수 있다. 이름 그대로 데이터베이스 등과 같은 스테이풀한 워크로드에 사용하기 위한 리소스이다. 레플리카셋과 주요 차이점으 다음과 같다.&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;생성되는 파드명의 접미사는 숫자 인덱스가 부여된 것이다. (sample-statefulset-0, sample-statefulset-1, ...)&lt;/li&gt;
&lt;li&gt;파드명이 바뀌자 않는다.&lt;/li&gt;
&lt;li&gt;데이터를 영구적으로 저장하기 위한 구조로 되어 있다.&lt;/li&gt;
&lt;li&gt;이후 설명할 영구 볼륨(PersistentVolume)을 사용하는 경우에는 파드를 재기동할 때 같은 디스크를 사용하여 다시 생성한다.&lt;/li&gt;
&lt;/ul&gt;
&lt;h2&gt;5.6.1 스테이트풀셋 생성&lt;/h2&gt;
&lt;p&gt;아래 예제 매니페스트는 스테이트풀셋을 생성하는 예제이다. 스테이트풀셋에서는 &lt;code class=&quot;language-text&quot;&gt;spec.volumeClaimTemplates&lt;/code&gt;를 지정하여 스테이트풀셋으로 생성되는 각 파드에 영구 볼륨 클레임을 설정할 수 있다. 영구 볼륨 클레임을 사용하면 클러스터 외부의 네트워크를 통해 제공되는 영구 볼륨을 파드에 연갈할 수 있으므로, 파드를 재기동할 때나 다른 노드로 이동할 때 같은 데이터를 보유한 상태로 컨테이너가 다시 생성된다. 영구 볼륨은 하나의 파드가 소유할 수도 있고, 영구 볼륨 종류에 따라 여러 파드에서 공유할 수도 있다.&lt;/p&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;yaml&quot;&gt;&lt;pre class=&quot;language-yaml&quot;&gt;&lt;code class=&quot;language-yaml&quot;&gt;&lt;span class=&quot;token key atrule&quot;&gt;apiVersion&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt; apps/v1
&lt;span class=&quot;token key atrule&quot;&gt;kind&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt; StatefulSet
&lt;span class=&quot;token key atrule&quot;&gt;metadata&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt;
  &lt;span class=&quot;token key atrule&quot;&gt;name&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt; sample&lt;span class=&quot;token punctuation&quot;&gt;-&lt;/span&gt;statefulset
&lt;span class=&quot;token key atrule&quot;&gt;spec&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt;
  &lt;span class=&quot;token key atrule&quot;&gt;serviceName&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt; sample&lt;span class=&quot;token punctuation&quot;&gt;-&lt;/span&gt;statefulset
  &lt;span class=&quot;token key atrule&quot;&gt;replicas&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;token number&quot;&gt;3&lt;/span&gt;
  &lt;span class=&quot;token key atrule&quot;&gt;selector&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt;
    &lt;span class=&quot;token key atrule&quot;&gt;matchLabels&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt;
      &lt;span class=&quot;token key atrule&quot;&gt;app&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt; sample&lt;span class=&quot;token punctuation&quot;&gt;-&lt;/span&gt;app
  &lt;span class=&quot;token key atrule&quot;&gt;template&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt;
    &lt;span class=&quot;token key atrule&quot;&gt;metadata&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt;
      &lt;span class=&quot;token key atrule&quot;&gt;labels&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt;
        &lt;span class=&quot;token key atrule&quot;&gt;app&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt; sample&lt;span class=&quot;token punctuation&quot;&gt;-&lt;/span&gt;app
    &lt;span class=&quot;token key atrule&quot;&gt;spec&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt;
      &lt;span class=&quot;token key atrule&quot;&gt;containers&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt;
        &lt;span class=&quot;token punctuation&quot;&gt;-&lt;/span&gt; &lt;span class=&quot;token key atrule&quot;&gt;name&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt; nginx&lt;span class=&quot;token punctuation&quot;&gt;-&lt;/span&gt;container
          &lt;span class=&quot;token key atrule&quot;&gt;image&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt; nginx&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt;&lt;span class=&quot;token number&quot;&gt;1.16&lt;/span&gt;
          &lt;span class=&quot;token key atrule&quot;&gt;ports&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt;
            &lt;span class=&quot;token punctuation&quot;&gt;-&lt;/span&gt; &lt;span class=&quot;token key atrule&quot;&gt;containerPort&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;token number&quot;&gt;80&lt;/span&gt;
          &lt;span class=&quot;token key atrule&quot;&gt;volumeMounts&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt;
          &lt;span class=&quot;token punctuation&quot;&gt;-&lt;/span&gt; &lt;span class=&quot;token key atrule&quot;&gt;name&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt; www
            &lt;span class=&quot;token key atrule&quot;&gt;mountPath&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt; /usr/share/nginx/html
  &lt;span class=&quot;token key atrule&quot;&gt;volumeClaimTemplates&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt;
  &lt;span class=&quot;token punctuation&quot;&gt;-&lt;/span&gt; &lt;span class=&quot;token key atrule&quot;&gt;metadata&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt;
      &lt;span class=&quot;token key atrule&quot;&gt;name&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt; www
    &lt;span class=&quot;token key atrule&quot;&gt;spec&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt;
      &lt;span class=&quot;token key atrule&quot;&gt;accessModes&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt;
      &lt;span class=&quot;token punctuation&quot;&gt;-&lt;/span&gt; ReadWriteOnce
      &lt;span class=&quot;token key atrule&quot;&gt;resources&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt;
        &lt;span class=&quot;token key atrule&quot;&gt;requests&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt;
          &lt;span class=&quot;token key atrule&quot;&gt;storage&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt; 1G&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;sh&quot;&gt;&lt;pre class=&quot;language-sh&quot;&gt;&lt;code class=&quot;language-sh&quot;&gt;&lt;span class=&quot;token comment&quot;&gt;# 스페이풀셋 생성&lt;/span&gt;
$ kubectl apply &lt;span class=&quot;token parameter variable&quot;&gt;-f&lt;/span&gt; sample-statefulset.yaml
statefulset.apps/sample-statefulset created

&lt;span class=&quot;token comment&quot;&gt;# 스페이풀셋  확인&lt;/span&gt;
$ kubectl get statefulsets
NAME                 READY   AGE
sample-statefulset   &lt;span class=&quot;token number&quot;&gt;3&lt;/span&gt;/3     19s

&lt;span class=&quot;token comment&quot;&gt;# 파드 목룍 표시&lt;/span&gt;
$ kubectl get pods &lt;span class=&quot;token parameter variable&quot;&gt;-o&lt;/span&gt; wide
NAME                                 READY   STATUS    RESTARTS        AGE    IP            NODE                   NOMINATED NODE   READINESS GATES
sample-statefulset-0                 &lt;span class=&quot;token number&quot;&gt;1&lt;/span&gt;/1     Running   &lt;span class=&quot;token number&quot;&gt;0&lt;/span&gt;               42s    &lt;span class=&quot;token number&quot;&gt;10.244&lt;/span&gt;.3.16   kind-cluster-worker    &lt;span class=&quot;token operator&quot;&gt;&amp;lt;&lt;/span&gt;none&lt;span class=&quot;token operator&quot;&gt;&gt;&lt;/span&gt;           &lt;span class=&quot;token operator&quot;&gt;&amp;lt;&lt;/span&gt;none&lt;span class=&quot;token operator&quot;&gt;&gt;&lt;/span&gt;
sample-statefulset-1                 &lt;span class=&quot;token number&quot;&gt;1&lt;/span&gt;/1     Running   &lt;span class=&quot;token number&quot;&gt;0&lt;/span&gt;               37s    &lt;span class=&quot;token number&quot;&gt;10.244&lt;/span&gt;.2.16   kind-cluster-worker3   &lt;span class=&quot;token operator&quot;&gt;&amp;lt;&lt;/span&gt;none&lt;span class=&quot;token operator&quot;&gt;&gt;&lt;/span&gt;           &lt;span class=&quot;token operator&quot;&gt;&amp;lt;&lt;/span&gt;none&lt;span class=&quot;token operator&quot;&gt;&gt;&lt;/span&gt;
sample-statefulset-2                 &lt;span class=&quot;token number&quot;&gt;1&lt;/span&gt;/1     Running   &lt;span class=&quot;token number&quot;&gt;0&lt;/span&gt;               32s    &lt;span class=&quot;token number&quot;&gt;10.244&lt;/span&gt;.1.16   kind-cluster-worker2   &lt;span class=&quot;token operator&quot;&gt;&amp;lt;&lt;/span&gt;none&lt;span class=&quot;token operator&quot;&gt;&gt;&lt;/span&gt;           &lt;span class=&quot;token operator&quot;&gt;&amp;lt;&lt;/span&gt;none&lt;span class=&quot;token operator&quot;&gt;&gt;&lt;/span&gt;

&lt;span class=&quot;token comment&quot;&gt;# 스테이트풀셋에서 사용되고 있는 영구 볼륨 클레임 확인&lt;/span&gt;
$ kubectl get persistentvolumeClaims
NAME                       STATUS   VOLUME                                     CAPACITY   ACCESS MODES   STORAGECLASS   AGE
www-sample-statefulset-0   Bound    pvc-50b61905-ce6a-4202-a7a1-cb8ac4c1be8b   1G         RWO            standard       104s
www-sample-statefulset-1   Bound    pvc-f4c76eb2-60eb-489f-8941-bada92a9cc19   1G         RWO            standard       99s
www-sample-statefulset-2   Bound    pvc-4672715a-7451-4338-ac29-6031609c6254   1G         RWO            standard       94s

&lt;span class=&quot;token comment&quot;&gt;# 스테이트풀셋에서 사용되고 있는 영구 볼륨 확인&lt;/span&gt;
$ kubectl get persistentvolume
NAME                                       CAPACITY   ACCESS MODES   RECLAIM POLICY   STATUS   CLAIM                              STORAGECLASS   REASON   AGE
pvc-4672715a-7451-4338-ac29-6031609c6254   1G         RWO            Delete           Bound    default/www-sample-statefulset-2   standard                2m3s
pvc-50b61905-ce6a-4202-a7a1-cb8ac4c1be8b   1G         RWO            Delete           Bound    default/www-sample-statefulset-0   standard                2m12s
pvc-f4c76eb2-60eb-489f-8941-bada92a9cc19   1G         RWO            Delete           Bound    default/www-sample-statefulset-1   standard                2m8s&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;h2&gt;5.6.2 스테이트풀셋 스케일링&lt;/h2&gt;
&lt;p&gt;스테이트풀셋도 레플리카셋, 디플로이먼트와 같은 방법인 &lt;code class=&quot;language-text&quot;&gt;kubectl apply -f&lt;/code&gt; 또는 &lt;code class=&quot;language-text&quot;&gt;kubectl scale&lt;/code&gt;을 사용하여 스케일링할 수 있다.&lt;/p&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;sh&quot;&gt;&lt;pre class=&quot;language-sh&quot;&gt;&lt;code class=&quot;language-sh&quot;&gt;&lt;span class=&quot;token comment&quot;&gt;# 레플리카 수를 3에서 4로 변경한 매니페스트를 apply&lt;/span&gt;
$ &lt;span class=&quot;token function&quot;&gt;sed&lt;/span&gt; &lt;span class=&quot;token parameter variable&quot;&gt;-i&lt;/span&gt; &lt;span class=&quot;token parameter variable&quot;&gt;-e&lt;/span&gt; &lt;span class=&quot;token string&quot;&gt;&apos;s|replicas: 3|replicas: 4|&apos;&lt;/span&gt; sample-statefulset.yaml

$ kubectl apply &lt;span class=&quot;token parameter variable&quot;&gt;-f&lt;/span&gt; sample-statefulset.yaml
statefulset.apps/sample-statefulset configured

$ kubectl get pods &lt;span class=&quot;token parameter variable&quot;&gt;-o&lt;/span&gt; wide
NAME                                 READY   STATUS    RESTARTS        AGE     IP            NODE                   NOMINATED NODE   READINESS GATES
sample-statefulset-0                 &lt;span class=&quot;token number&quot;&gt;1&lt;/span&gt;/1     Running   &lt;span class=&quot;token number&quot;&gt;0&lt;/span&gt;               4m48s   &lt;span class=&quot;token number&quot;&gt;10.244&lt;/span&gt;.3.16   kind-cluster-worker    &lt;span class=&quot;token operator&quot;&gt;&amp;lt;&lt;/span&gt;none&lt;span class=&quot;token operator&quot;&gt;&gt;&lt;/span&gt;           &lt;span class=&quot;token operator&quot;&gt;&amp;lt;&lt;/span&gt;none&lt;span class=&quot;token operator&quot;&gt;&gt;&lt;/span&gt;
sample-statefulset-1                 &lt;span class=&quot;token number&quot;&gt;1&lt;/span&gt;/1     Running   &lt;span class=&quot;token number&quot;&gt;0&lt;/span&gt;               4m43s   &lt;span class=&quot;token number&quot;&gt;10.244&lt;/span&gt;.2.16   kind-cluster-worker3   &lt;span class=&quot;token operator&quot;&gt;&amp;lt;&lt;/span&gt;none&lt;span class=&quot;token operator&quot;&gt;&gt;&lt;/span&gt;           &lt;span class=&quot;token operator&quot;&gt;&amp;lt;&lt;/span&gt;none&lt;span class=&quot;token operator&quot;&gt;&gt;&lt;/span&gt;
sample-statefulset-2                 &lt;span class=&quot;token number&quot;&gt;1&lt;/span&gt;/1     Running   &lt;span class=&quot;token number&quot;&gt;0&lt;/span&gt;               4m38s   &lt;span class=&quot;token number&quot;&gt;10.244&lt;/span&gt;.1.16   kind-cluster-worker2   &lt;span class=&quot;token operator&quot;&gt;&amp;lt;&lt;/span&gt;none&lt;span class=&quot;token operator&quot;&gt;&gt;&lt;/span&gt;           &lt;span class=&quot;token operator&quot;&gt;&amp;lt;&lt;/span&gt;none&lt;span class=&quot;token operator&quot;&gt;&gt;&lt;/span&gt;
sample-statefulset-3                 &lt;span class=&quot;token number&quot;&gt;1&lt;/span&gt;/1     Running   &lt;span class=&quot;token number&quot;&gt;0&lt;/span&gt;               18s     &lt;span class=&quot;token number&quot;&gt;10.244&lt;/span&gt;.3.18   kind-cluster-worker    &lt;span class=&quot;token operator&quot;&gt;&amp;lt;&lt;/span&gt;none&lt;span class=&quot;token operator&quot;&gt;&gt;&lt;/span&gt;           &lt;span class=&quot;token operator&quot;&gt;&amp;lt;&lt;/span&gt;none&lt;span class=&quot;token operator&quot;&gt;&gt;&lt;/span&gt;

$ kubectl scale statefulsets sample-statefulset &lt;span class=&quot;token parameter variable&quot;&gt;--replicas&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;token number&quot;&gt;5&lt;/span&gt;
statefulset.apps/sample-statefulset scaled

$ kubectl get pods &lt;span class=&quot;token parameter variable&quot;&gt;-o&lt;/span&gt; wide
NAME                                 READY   STATUS    RESTARTS        AGE     IP            NODE                   NOMINATED NODE   READINESS GATES
sample-statefulset-0                 &lt;span class=&quot;token number&quot;&gt;1&lt;/span&gt;/1     Running   &lt;span class=&quot;token number&quot;&gt;0&lt;/span&gt;               5m25s   &lt;span class=&quot;token number&quot;&gt;10.244&lt;/span&gt;.3.16   kind-cluster-worker    &lt;span class=&quot;token operator&quot;&gt;&amp;lt;&lt;/span&gt;none&lt;span class=&quot;token operator&quot;&gt;&gt;&lt;/span&gt;           &lt;span class=&quot;token operator&quot;&gt;&amp;lt;&lt;/span&gt;none&lt;span class=&quot;token operator&quot;&gt;&gt;&lt;/span&gt;
sample-statefulset-1                 &lt;span class=&quot;token number&quot;&gt;1&lt;/span&gt;/1     Running   &lt;span class=&quot;token number&quot;&gt;0&lt;/span&gt;               5m20s   &lt;span class=&quot;token number&quot;&gt;10.244&lt;/span&gt;.2.16   kind-cluster-worker3   &lt;span class=&quot;token operator&quot;&gt;&amp;lt;&lt;/span&gt;none&lt;span class=&quot;token operator&quot;&gt;&gt;&lt;/span&gt;           &lt;span class=&quot;token operator&quot;&gt;&amp;lt;&lt;/span&gt;none&lt;span class=&quot;token operator&quot;&gt;&gt;&lt;/span&gt;
sample-statefulset-2                 &lt;span class=&quot;token number&quot;&gt;1&lt;/span&gt;/1     Running   &lt;span class=&quot;token number&quot;&gt;0&lt;/span&gt;               5m15s   &lt;span class=&quot;token number&quot;&gt;10.244&lt;/span&gt;.1.16   kind-cluster-worker2   &lt;span class=&quot;token operator&quot;&gt;&amp;lt;&lt;/span&gt;none&lt;span class=&quot;token operator&quot;&gt;&gt;&lt;/span&gt;           &lt;span class=&quot;token operator&quot;&gt;&amp;lt;&lt;/span&gt;none&lt;span class=&quot;token operator&quot;&gt;&gt;&lt;/span&gt;
sample-statefulset-3                 &lt;span class=&quot;token number&quot;&gt;1&lt;/span&gt;/1     Running   &lt;span class=&quot;token number&quot;&gt;0&lt;/span&gt;               55s     &lt;span class=&quot;token number&quot;&gt;10.244&lt;/span&gt;.3.18   kind-cluster-worker    &lt;span class=&quot;token operator&quot;&gt;&amp;lt;&lt;/span&gt;none&lt;span class=&quot;token operator&quot;&gt;&gt;&lt;/span&gt;           &lt;span class=&quot;token operator&quot;&gt;&amp;lt;&lt;/span&gt;none&lt;span class=&quot;token operator&quot;&gt;&gt;&lt;/span&gt;
sample-statefulset-4                 &lt;span class=&quot;token number&quot;&gt;0&lt;/span&gt;/1     Pending   &lt;span class=&quot;token number&quot;&gt;0&lt;/span&gt;               1s      &lt;span class=&quot;token operator&quot;&gt;&amp;lt;&lt;/span&gt;none&lt;span class=&quot;token operator&quot;&gt;&gt;&lt;/span&gt;        &lt;span class=&quot;token operator&quot;&gt;&amp;lt;&lt;/span&gt;none&lt;span class=&quot;token operator&quot;&gt;&gt;&lt;/span&gt;                 &lt;span class=&quot;token operator&quot;&gt;&amp;lt;&lt;/span&gt;none&lt;span class=&quot;token operator&quot;&gt;&gt;&lt;/span&gt;           &lt;span class=&quot;token operator&quot;&gt;&amp;lt;&lt;/span&gt;none&lt;span class=&quot;token operator&quot;&gt;&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;스테이트풀셋에서 레플리카 수를 변경하여 파드를 생허아고 삭제하면 레플리카셋이나 데몬셋 등과 달리 기본적으로 파드를 동시에 하나씩만 생성하고 삭제하기 때문에 조금 시간이 더 걸린다. 스케일 아웃일 때는 인덱스가 가장 작은 것부터 파드를 하나씩 생성하고 이전에 생성된 파드가 Ready 상태가 되고 나서 다음 파드를 생성하기 시작한다. 반대로 스케일 인일 때는 인덱스가 가장 큰 파드부터 순서대로 삭제된다. 레플리카셋의 경우 파드가 무작위로 삭제되기 때문에 특정 파드가 마스터가 되는 애플리케이션에는 맞지 않는다. 그러나 스테이트풀셋은 0번째 파드가 항상 먼저 생성되고 가장 마지막에 삭제되므로, 0번째 파드를 마스터 노드로 사용하는 이중화 구조 애플리케이션에 적합하다.&lt;/p&gt;
&lt;h2&gt;5.6.4 스테이트풀셋 업데이트 전략&lt;/h2&gt;
&lt;p&gt;스테이트풀셋에서도 두 가지 업데이트 전략을 사용한다. &lt;code class=&quot;language-text&quot;&gt;OnDelete&lt;/code&gt;, &lt;code class=&quot;language-text&quot;&gt;RollingUpdate&lt;/code&gt;가 그러한데 &lt;code class=&quot;language-text&quot;&gt;RollingUpdate&lt;/code&gt;가 기본적으로 지정된다. &lt;code class=&quot;language-text&quot;&gt;OnDelete&lt;/code&gt;는 데몬셋과 거의 동일하여 &lt;code class=&quot;language-text&quot;&gt;RollingUpdate&lt;/code&gt;에 대해서만 살펴보겠다.&lt;/p&gt;
&lt;h3&gt;RollingUpdate&lt;/h3&gt;
&lt;p&gt;디플로이먼트의 &lt;code class=&quot;language-text&quot;&gt;RollingUpdate&lt;/code&gt;와 다르게, 스테이트풀셋에서는 추가 파드를 생성하여 업데이트할 수 없다. 또한, 동시에 정지 가능한 최대 파드 수(&lt;code class=&quot;language-text&quot;&gt;maxUnavailable&lt;/code&gt;)를 지정하여 롤링 업데이트를 할 수도 없으므로, 파드마다 Ready 상태인지를 확인하고 업데이트를 하게 된다. &lt;code class=&quot;language-text&quot;&gt;spec.podManagementPolicy&lt;/code&gt;가 &lt;code class=&quot;language-text&quot;&gt;Parallel&lt;/code&gt;로 설정되어 있는 경우에도 병렬로 동시에 처리되지 않고 파드가 하나씩 업데이트된다.&lt;/p&gt;
&lt;p&gt;스테이트풀셋의 &lt;code class=&quot;language-text&quot;&gt;RollingUpdate&lt;/code&gt;에서는 &lt;code class=&quot;language-text&quot;&gt;partition&lt;/code&gt;이라는 특정 값을 설정할 수 있다. &lt;code class=&quot;language-text&quot;&gt;partition&lt;/code&gt;을 설정하면 전체 파드 중 어떤 파드까지 업데이트할지를 지정할 수 있다. 이 설정을 사용하면 전체에 영향을 주지 않고 부분적으로 업데이트를 적용하고 확인할 수 있어 안전한 업데이트를 할 수 있다. 또한, &lt;code class=&quot;language-text&quot;&gt;Ondelete&lt;/code&gt;오ㅘ 달리 수동으로 재기동한 경우에도 &lt;code class=&quot;language-text&quot;&gt;partition&lt;/code&gt;보다 작은 인덱스를 가진 파드는 업데이트되지 않는다.&lt;/p&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;yaml&quot;&gt;&lt;pre class=&quot;language-yaml&quot;&gt;&lt;code class=&quot;language-yaml&quot;&gt;&lt;span class=&quot;token key atrule&quot;&gt;apiVersion&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt; apps/v1
&lt;span class=&quot;token key atrule&quot;&gt;kind&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt; StatefulSet
&lt;span class=&quot;token key atrule&quot;&gt;metadata&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt;
  &lt;span class=&quot;token key atrule&quot;&gt;name&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt; sample&lt;span class=&quot;token punctuation&quot;&gt;-&lt;/span&gt;statefulset&lt;span class=&quot;token punctuation&quot;&gt;-&lt;/span&gt;rollingupdate
&lt;span class=&quot;token key atrule&quot;&gt;spec&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt;
  &lt;span class=&quot;token key atrule&quot;&gt;updateStrategy&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt;
    &lt;span class=&quot;token key atrule&quot;&gt;type&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt; RollingUpdate
    &lt;span class=&quot;token key atrule&quot;&gt;rollingUpdate&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt;
      &lt;span class=&quot;token key atrule&quot;&gt;partition&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;token number&quot;&gt;3&lt;/span&gt;
  &lt;span class=&quot;token key atrule&quot;&gt;serviceName&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt; sample&lt;span class=&quot;token punctuation&quot;&gt;-&lt;/span&gt;statefulset&lt;span class=&quot;token punctuation&quot;&gt;-&lt;/span&gt;rollingupdate
  &lt;span class=&quot;token key atrule&quot;&gt;replicas&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;token number&quot;&gt;5&lt;/span&gt;
  &lt;span class=&quot;token key atrule&quot;&gt;selector&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt;
    &lt;span class=&quot;token key atrule&quot;&gt;matchLabels&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt;
      &lt;span class=&quot;token key atrule&quot;&gt;app&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt; sample&lt;span class=&quot;token punctuation&quot;&gt;-&lt;/span&gt;app
  &lt;span class=&quot;token key atrule&quot;&gt;template&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt;
    &lt;span class=&quot;token key atrule&quot;&gt;metadata&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt;
      &lt;span class=&quot;token key atrule&quot;&gt;labels&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt;
        &lt;span class=&quot;token key atrule&quot;&gt;app&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt; sample&lt;span class=&quot;token punctuation&quot;&gt;-&lt;/span&gt;app
    &lt;span class=&quot;token key atrule&quot;&gt;spec&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt;
      &lt;span class=&quot;token key atrule&quot;&gt;containers&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt;
        &lt;span class=&quot;token punctuation&quot;&gt;-&lt;/span&gt; &lt;span class=&quot;token key atrule&quot;&gt;name&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt; nginx&lt;span class=&quot;token punctuation&quot;&gt;-&lt;/span&gt;container
          &lt;span class=&quot;token key atrule&quot;&gt;image&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt; nginx&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt;&lt;span class=&quot;token number&quot;&gt;1.16&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;위의 스테이트풀셋을 기동하보면 0~4 인덱스를 가진 다섯 개의 파드가 생성된다. 이 상태에서 스테이트풀셋 이미지를 수정하면 &lt;code class=&quot;language-text&quot;&gt;partition=3&lt;/code&gt;(위에서부터 세 개의 파드는 업데이트 대상 외)이기 때문에 인덱스 4와 인덱스 3인 파드만 업데이트된다.&lt;/p&gt;
&lt;h2&gt;5.6.5 영구 볼륨 데이터 저장 확인&lt;/h2&gt;
&lt;p&gt;먼저 컨테이너 내부에 영구 볼륨이 마운트되어 있는지를 확인한다. 영구 볼륨을 사용하고 있을 경우 /dev/sdb 등의 별도 디스크(PV)가 마운트되어 있다.&lt;/p&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;sh&quot;&gt;&lt;pre class=&quot;language-sh&quot;&gt;&lt;code class=&quot;language-sh&quot;&gt;&lt;span class=&quot;token comment&quot;&gt;# 영구 볼륨 마운트 확인&lt;/span&gt;
$ kubectl &lt;span class=&quot;token builtin class-name&quot;&gt;exec&lt;/span&gt; &lt;span class=&quot;token parameter variable&quot;&gt;-it&lt;/span&gt; sample-statefulset-0 -- &lt;span class=&quot;token function&quot;&gt;df&lt;/span&gt; &lt;span class=&quot;token parameter variable&quot;&gt;-h&lt;/span&gt; &lt;span class=&quot;token operator&quot;&gt;|&lt;/span&gt; &lt;span class=&quot;token function&quot;&gt;grep&lt;/span&gt; /dev/sd
/dev/sda1       95G   &lt;span class=&quot;token number&quot;&gt;2&lt;/span&gt;.7G          &lt;span class=&quot;token number&quot;&gt;3&lt;/span&gt;%  /etc/hosts
/dev/sdb       976M   &lt;span class=&quot;token number&quot;&gt;2&lt;/span&gt;.6M          &lt;span class=&quot;token number&quot;&gt;1&lt;/span&gt;%  /usr/share/nginx/html

&lt;span class=&quot;token comment&quot;&gt;# 마운트된 영구 볼륨에 같은 이름의 파일이 없는지를 확인하고 샘플 파일 생성&lt;/span&gt;
$ kubectl &lt;span class=&quot;token builtin class-name&quot;&gt;exec&lt;/span&gt; &lt;span class=&quot;token parameter variable&quot;&gt;-it&lt;/span&gt; sample-statefulset-0 -- &lt;span class=&quot;token function&quot;&gt;ls&lt;/span&gt; /usr/share/nginx/html/sample.html
ls: cannot access &lt;span class=&quot;token string&quot;&gt;&apos;/usr/share/nginx/html/sample.html&apos;&lt;/span&gt;&lt;span class=&quot;token builtin class-name&quot;&gt;:&lt;/span&gt; No such &lt;span class=&quot;token function&quot;&gt;file&lt;/span&gt; or directory
&lt;span class=&quot;token builtin class-name&quot;&gt;command&lt;/span&gt; terminated with &lt;span class=&quot;token builtin class-name&quot;&gt;exit&lt;/span&gt; code &lt;span class=&quot;token number&quot;&gt;2&lt;/span&gt;

&lt;span class=&quot;token comment&quot;&gt;# 영구 볼륨에 sample.html 생성&lt;/span&gt;
$ kubectl &lt;span class=&quot;token builtin class-name&quot;&gt;exec&lt;/span&gt; &lt;span class=&quot;token parameter variable&quot;&gt;-it&lt;/span&gt; sample-statefulset-0 -- &lt;span class=&quot;token function&quot;&gt;touch&lt;/span&gt; /usr/share/nginx/html/sample.html

&lt;span class=&quot;token comment&quot;&gt;# 생성된 파일 확인&lt;/span&gt;
$ kubectl &lt;span class=&quot;token builtin class-name&quot;&gt;exec&lt;/span&gt; &lt;span class=&quot;token parameter variable&quot;&gt;-it&lt;/span&gt; sample-statefulset-0 -- &lt;span class=&quot;token function&quot;&gt;ls&lt;/span&gt; /usr/share/nginx/html/sample.html
/usr/share/nginx/html/sample.html

&lt;span class=&quot;token comment&quot;&gt;# 예상치 못한 파드 정지 1 (파드 삭제)&lt;/span&gt;
$ kubectl delete pod sample-statefulset-0
pod &lt;span class=&quot;token string&quot;&gt;&quot;sample-statefulset-0&quot;&lt;/span&gt; deleted

&lt;span class=&quot;token comment&quot;&gt;# 예상치 못한 파드 정지2 (nginx 프로세스 정지)&lt;/span&gt;
$ kubectl &lt;span class=&quot;token builtin class-name&quot;&gt;exec&lt;/span&gt; &lt;span class=&quot;token parameter variable&quot;&gt;-it&lt;/span&gt; sample-statefulset-0 -- /bin/bash &lt;span class=&quot;token parameter variable&quot;&gt;-c&lt;/span&gt; &lt;span class=&quot;token string&quot;&gt;&apos;kill 1&apos;&lt;/span&gt;

&lt;span class=&quot;token comment&quot;&gt;# 파드 정지, 복구 이후에도 파일 유실 없음&lt;/span&gt;
$ kubectl &lt;span class=&quot;token builtin class-name&quot;&gt;exec&lt;/span&gt; &lt;span class=&quot;token parameter variable&quot;&gt;-it&lt;/span&gt; sample-statefulset-0 -- &lt;span class=&quot;token function&quot;&gt;ls&lt;/span&gt; /usr/share/nginx/html/sample.html
/usr/share/nginx/html/sample.html&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;복구 후 스테이트풀셋 상태를 확인해보면 IP 주소는 변경되었지만, 파드명은 그대로인 것을 알 수 있다.&lt;/p&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;sh&quot;&gt;&lt;pre class=&quot;language-sh&quot;&gt;&lt;code class=&quot;language-sh&quot;&gt;&lt;span class=&quot;token comment&quot;&gt;# 파드 목록 표시&lt;/span&gt;
$ kubectl get pods &lt;span class=&quot;token parameter variable&quot;&gt;-o&lt;/span&gt; wide
NAME                                 READY   STATUS    RESTARTS       AGE    IP            NODE                   NOMINATED NODE   READINESS GATES
sample-statefulset-0                 &lt;span class=&quot;token number&quot;&gt;1&lt;/span&gt;/1     Running   &lt;span class=&quot;token number&quot;&gt;1&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;83s ago&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;    112s   &lt;span class=&quot;token number&quot;&gt;10.244&lt;/span&gt;.3.19   kind-cluster-worker    &lt;span class=&quot;token operator&quot;&gt;&amp;lt;&lt;/span&gt;none&lt;span class=&quot;token operator&quot;&gt;&gt;&lt;/span&gt;           &lt;span class=&quot;token operator&quot;&gt;&amp;lt;&lt;/span&gt;none&lt;span class=&quot;token operator&quot;&gt;&gt;&lt;/span&gt;
sample-statefulset-1                 &lt;span class=&quot;token number&quot;&gt;1&lt;/span&gt;/1     Running   &lt;span class=&quot;token number&quot;&gt;0&lt;/span&gt;              27m    &lt;span class=&quot;token number&quot;&gt;10.244&lt;/span&gt;.2.16   kind-cluster-worker3   &lt;span class=&quot;token operator&quot;&gt;&amp;lt;&lt;/span&gt;none&lt;span class=&quot;token operator&quot;&gt;&gt;&lt;/span&gt;           &lt;span class=&quot;token operator&quot;&gt;&amp;lt;&lt;/span&gt;none&lt;span class=&quot;token operator&quot;&gt;&gt;&lt;/span&gt;
sample-statefulset-2                 &lt;span class=&quot;token number&quot;&gt;1&lt;/span&gt;/1     Running   &lt;span class=&quot;token number&quot;&gt;0&lt;/span&gt;              27m    &lt;span class=&quot;token number&quot;&gt;10.244&lt;/span&gt;.1.16   kind-cluster-worker2   &lt;span class=&quot;token operator&quot;&gt;&amp;lt;&lt;/span&gt;none&lt;span class=&quot;token operator&quot;&gt;&gt;&lt;/span&gt;           &lt;span class=&quot;token operator&quot;&gt;&amp;lt;&lt;/span&gt;none&lt;span class=&quot;token operator&quot;&gt;&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;h2&gt;5.6.6 스테이트풀셋 삭제와 영구 볼륨 삭제&lt;/h2&gt;
&lt;p&gt;스테이트풀셋에서 지정한 영구 볼륨은 별도로 해제하기 전에는 스테이트풀셋이 삭제되어도 해제되지 않는다. 스테이트풀셋이 영구 볼륨을 해제하기 전에 볼륨에서 데이터를 백업할 수 있도록 시간을 주기 때문이다.&lt;/p&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;sh&quot;&gt;&lt;pre class=&quot;language-sh&quot;&gt;&lt;code class=&quot;language-sh&quot;&gt;&lt;span class=&quot;token comment&quot;&gt;# 스테이트풀셋 삭제&lt;/span&gt;
$ kubectl delete statefulset sample-statefulset
statefulset.apps &lt;span class=&quot;token string&quot;&gt;&quot;sample-statefulset&quot;&lt;/span&gt; deleted

&lt;span class=&quot;token comment&quot;&gt;# 스테이트풀셋과 연결되는 영구 볼륨 클레임 확인&lt;/span&gt;
$ kubectl get persistentvolumeclaims
NAME                       STATUS   VOLUME                                     CAPACITY   ACCESS MODES   STORAGECLASS   AGE
www-sample-statefulset-0   Bound    pvc-50b61905-ce6a-4202-a7a1-cb8ac4c1be8b   1G         RWO            standard       30m
www-sample-statefulset-1   Bound    pvc-f4c76eb2-60eb-489f-8941-bada92a9cc19   1G         RWO            standard       30m
www-sample-statefulset-2   Bound    pvc-4672715a-7451-4338-ac29-6031609c6254   1G         RWO            standard       30m
www-sample-statefulset-3   Bound    pvc-fc2f7918-bd66-4c39-baa3-8d2ccca53a6e   1G         RWO            standard       26m
www-sample-statefulset-4   Bound    pvc-7ee68d8a-c3c4-4053-9cd4-608021b9d5e7   1G         RWO            standard       25m

&lt;span class=&quot;token comment&quot;&gt;# 스테이트풀셋에 연결되는 영구 볼륨 확인&lt;/span&gt;
$ kubectl get persistentvolumes
NAME                                       CAPACITY   ACCESS MODES   RECLAIM POLICY   STATUS   CLAIM                              STORAGECLASS   REASON   AGE
pvc-4672715a-7451-4338-ac29-6031609c6254   1G         RWO            Delete           Bound    default/www-sample-statefulset-2   standard                31m
pvc-50b61905-ce6a-4202-a7a1-cb8ac4c1be8b   1G         RWO            Delete           Bound    default/www-sample-statefulset-0   standard                31m
pvc-7ee68d8a-c3c4-4053-9cd4-608021b9d5e7   1G         RWO            Delete           Bound    default/www-sample-statefulset-4   standard                25m
pvc-f4c76eb2-60eb-489f-8941-bada92a9cc19   1G         RWO            Delete           Bound    default/www-sample-statefulset-1   standard                31m
pvc-fc2f7918-bd66-4c39-baa3-8d2ccca53a6e   1G         RWO            Delete           Bound    default/www-sample-statefulset-3   standard                26m

&lt;span class=&quot;token comment&quot;&gt;# 다시 스테이트풀셋 생성&lt;/span&gt;
$ kubectl apply &lt;span class=&quot;token parameter variable&quot;&gt;-f&lt;/span&gt; sample-statefulset.yaml
statefulset.apps/sample-statefulset created

&lt;span class=&quot;token comment&quot;&gt;# 스테이트풀셋을 한 번 삭제한 후에도 영구 볼륨에 sample.html이 있는지 확인&lt;/span&gt;
kubectl &lt;span class=&quot;token builtin class-name&quot;&gt;exec&lt;/span&gt; &lt;span class=&quot;token parameter variable&quot;&gt;-it&lt;/span&gt; sample-statefulset-0 -- &lt;span class=&quot;token function&quot;&gt;ls&lt;/span&gt; /usr/share/nginx/html/sample.html
/usr/share/nginx/html/sample.html

&lt;span class=&quot;token comment&quot;&gt;# 영구 볼륨 삭제&lt;/span&gt;
$ kubectl delete persistentvolumeclaims www-sample-statefulset-&lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;&lt;span class=&quot;token number&quot;&gt;0&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;..&lt;/span&gt;&lt;span class=&quot;token number&quot;&gt;4&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;
persistentvolumeclaim &lt;span class=&quot;token string&quot;&gt;&quot;www-sample-statefulset-0&quot;&lt;/span&gt; deleted
persistentvolumeclaim &lt;span class=&quot;token string&quot;&gt;&quot;www-sample-statefulset-1&quot;&lt;/span&gt; deleted
persistentvolumeclaim &lt;span class=&quot;token string&quot;&gt;&quot;www-sample-statefulset-2&quot;&lt;/span&gt; deleted
persistentvolumeclaim &lt;span class=&quot;token string&quot;&gt;&quot;www-sample-statefulset-3&quot;&lt;/span&gt; deleted

&lt;span class=&quot;token comment&quot;&gt;# 영구 볼륨 클레임, 영구 볼륨 삭제 확인&lt;/span&gt;
$ kubectl get persistentvolumeclaims
No resources found &lt;span class=&quot;token keyword&quot;&gt;in&lt;/span&gt; default namespace.

$ kubectl get persistentvolume
No resources found&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;</content:encoded></item><item><title><![CDATA[[Linux] sed 명령어]]></title><description><![CDATA[리눅스 서버에서 작업하다보면 특정 문서를 수정할 일이 생기게 된다. 보통 문서 전체를 수정하기보다는 특정 설정 값을 하나씩 설정하게 되는데 파일이 하나라면 vi…]]></description><link>https://github.com/SiverPineValley/SiverPineValley.github.io/linux/sed/</link><guid isPermaLink="false">https://github.com/SiverPineValley/SiverPineValley.github.io/linux/sed/</guid><pubDate>Sun, 28 Aug 2022 14:00:00 GMT</pubDate><content:encoded>&lt;p&gt;리눅스 서버에서 작업하다보면 특정 문서를 수정할 일이 생기게 된다. 보통 문서 전체를 수정하기보다는 특정 설정 값을 하나씩 설정하게 되는데 파일이 하나라면 vi 편집기로 수정이 가능하나, 파일이 여러 개인 경우, 한 파일 내에서 공통적으로 수정할 부분이 여러 군데인 경우 vi 편집기를 통한 수정은 번거로울 수 있다. 이럴 때 sed 명령어를 사용하면 쉽게 편집이 가능하다. 사용 방법을 하나씩 파악해보자.&lt;/p&gt;
&lt;div align=&quot;left&quot;&gt;
&lt;img src=&quot;./images/sed.png&quot; width=&quot;500px&quot; /&gt;
&lt;/div&gt;
&lt;p&gt;sed 명령어에는 내부적으로 두 개의 워크 스페이스를 사용한다. 이 두 버퍼는 각각 패턴 스페이스(패턴 버퍼), 홀드 스페이스(홀드 버퍼)라고 한다. 패턴 스페이스는 라인 단위로 읽을 때 읽힌 라인이 임시로 저장되는 버퍼이다. sed 명령어로 출력할 때, 이 버퍼의 내용을 출력하게 되는데 실제로 sed 명령어로 뭔가 조작을 하더라도 원본이 바로 수정되는 것이 아니라, 이 버퍼의 내용이 수정된다. 홀드 스페이스는 좀 더 길게 가지고 있는 저장소로, 읽어 온 여러 행을 저장한다. 즉, 어떤 내용을 홀드 스페이스에 저장하면, sed가 다음 행을 읽더라도 나중에 내가 원할 때 불러와서 재사용할 수 있다.&lt;/p&gt;
&lt;p&gt;본격적으로 내용을 확인하기 전에, 예시 파일을 생성하였다. 파일 명은 &lt;code class=&quot;language-text&quot;&gt;example&lt;/code&gt;로 지정하였다.&lt;/p&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;sh&quot;&gt;&lt;pre class=&quot;language-sh&quot;&gt;&lt;code class=&quot;language-sh&quot;&gt;&lt;span class=&quot;token comment&quot;&gt;# 예시 파일 내용&lt;/span&gt;
one
two
three
four
five
six
seven
eight
nine
ten
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;h2&gt;1) 특정 범위 만큼 파일 내용 출력&lt;/h2&gt;
&lt;p&gt;&lt;code class=&quot;language-text&quot;&gt;-n&lt;/code&gt;: 작업한 부분만 출력하기 위한 옵션&lt;/br&gt;
&lt;code class=&quot;language-text&quot;&gt;-e&lt;/code&gt;: 여러 조건을 사용하여 출력&lt;/br&gt;
&lt;code class=&quot;language-text&quot;&gt;p&lt;/code&gt;: 패턴에 따라 찾은 라인을 출력하는 플래그&lt;/br&gt;
&lt;code class=&quot;language-text&quot;&gt;,&lt;/code&gt;: 범위를 지정하기 위한 플래그&lt;/br&gt;
&lt;code class=&quot;language-text&quot;&gt;^&lt;/code&gt;: 시작 플래그&lt;/br&gt;
&lt;code class=&quot;language-text&quot;&gt;$&lt;/code&gt;: 끝 플래그&lt;/br&gt;&lt;/p&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;sh&quot;&gt;&lt;pre class=&quot;language-sh&quot;&gt;&lt;code class=&quot;language-sh&quot;&gt;&lt;span class=&quot;token comment&quot;&gt;# 첫 번째 행만 출력&lt;/span&gt;
$ &lt;span class=&quot;token function&quot;&gt;sed&lt;/span&gt; &lt;span class=&quot;token parameter variable&quot;&gt;-n&lt;/span&gt; &lt;span class=&quot;token string&quot;&gt;&apos;1p&apos;&lt;/span&gt; example
one

&lt;span class=&quot;token comment&quot;&gt;# -n 옵션 없이 첫 번째 행 출력&lt;/span&gt;
$ &lt;span class=&quot;token function&quot;&gt;sed&lt;/span&gt; &lt;span class=&quot;token string&quot;&gt;&apos;1p&apos;&lt;/span&gt; example
one
one
two
three
four
five
six
seven
eight
nine
ten


&lt;span class=&quot;token comment&quot;&gt;# 네 번째 행부터 여섯 번째 행까지 출력&lt;/span&gt;
$ &lt;span class=&quot;token function&quot;&gt;sed&lt;/span&gt; &lt;span class=&quot;token parameter variable&quot;&gt;-n&lt;/span&gt; &lt;span class=&quot;token string&quot;&gt;&apos;4,6p&apos;&lt;/span&gt; example
four
five
six

&lt;span class=&quot;token comment&quot;&gt;# 일곱 번째 행부터 마지막까지 출력&lt;/span&gt;
$ &lt;span class=&quot;token function&quot;&gt;sed&lt;/span&gt; &lt;span class=&quot;token parameter variable&quot;&gt;-n&lt;/span&gt; &lt;span class=&quot;token string&quot;&gt;&apos;7,$p&apos;&lt;/span&gt; example
seven
eight
nine
ten


&lt;span class=&quot;token comment&quot;&gt;# -e 조건을 사용하여 여러 조건 출력&lt;/span&gt;
$ &lt;span class=&quot;token function&quot;&gt;sed&lt;/span&gt; &lt;span class=&quot;token parameter variable&quot;&gt;-n&lt;/span&gt; &lt;span class=&quot;token parameter variable&quot;&gt;-e&lt;/span&gt; &lt;span class=&quot;token string&quot;&gt;&apos;1p&apos;&lt;/span&gt; &lt;span class=&quot;token parameter variable&quot;&gt;-e&lt;/span&gt; &lt;span class=&quot;token string&quot;&gt;&apos;3,5p&apos;&lt;/span&gt; example
one
three
four
five&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;h2&gt;2) 특정 라인 제거&lt;/h2&gt;
&lt;p&gt;&lt;code class=&quot;language-text&quot;&gt;/&lt;/code&gt;: / 사이에 있는 글자&lt;/br&gt;
&lt;code class=&quot;language-text&quot;&gt;d&lt;/code&gt;: 삭제 플래그&lt;/br&gt;&lt;/p&gt;
&lt;p&gt;sed 명령어는 수정한 작업에 대해 원래을 파일을 건드리지 않는다. 이를 적용시키기 위해서는 stdout 버퍼로 별도 파일로 저장하거나 &lt;code class=&quot;language-text&quot;&gt;-i&lt;/code&gt; 옵션을 붙여줘야 한다. 이 때 BSD OS(Mac)의 경우 sed -i 옵션을 사용할 경우에는 제대로 적용되지 않는데, 리눅스에 보편적으로 설치되어 있는 GNU sed 와 다르기 때문이다. 이를 위해 &lt;code class=&quot;language-text&quot;&gt;brew install gnu-sed&lt;/code&gt;를 사용하여 &lt;code class=&quot;language-text&quot;&gt;gsed&lt;/code&gt; 명령어로 대체할 수 있다. sed 명령어에서도 &lt;code class=&quot;language-text&quot;&gt;-i -e&lt;/code&gt;로 적용 가능하긴 하다.&lt;/p&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;sh&quot;&gt;&lt;pre class=&quot;language-sh&quot;&gt;&lt;code class=&quot;language-sh&quot;&gt;&lt;span class=&quot;token comment&quot;&gt;# 빈 라인 모두 제거&lt;/span&gt;
$ &lt;span class=&quot;token function&quot;&gt;sed&lt;/span&gt; &lt;span class=&quot;token string&quot;&gt;&apos;/^$/d&apos;&lt;/span&gt; example
one
two
three
four
five
six
seven
eight
nine
ten

&lt;span class=&quot;token comment&quot;&gt;# 빈 라인 제거해서 새로울 파일에 저장&lt;/span&gt;
$ &lt;span class=&quot;token function&quot;&gt;sed&lt;/span&gt; &lt;span class=&quot;token string&quot;&gt;&apos;/^$/d&apos;&lt;/span&gt; example &lt;span class=&quot;token operator&quot;&gt;&gt;&lt;/span&gt; example_new
$ &lt;span class=&quot;token function&quot;&gt;cat&lt;/span&gt; example_new
one
two
three
four
five
six
seven
eight
nine
ten

&lt;span class=&quot;token comment&quot;&gt;# 빈 라인 제거해서 원본 파일에 적용&lt;/span&gt;
$ &lt;span class=&quot;token function&quot;&gt;sed&lt;/span&gt; &lt;span class=&quot;token parameter variable&quot;&gt;-i&lt;/span&gt; &lt;span class=&quot;token parameter variable&quot;&gt;-e&lt;/span&gt; &lt;span class=&quot;token string&quot;&gt;&apos;/^$/d&apos;&lt;/span&gt; example
$ &lt;span class=&quot;token function&quot;&gt;cat&lt;/span&gt; example
one
two
three
four
five
six
seven
eight
nine
ten&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;h2&gt;3) 치환&lt;/h2&gt;
&lt;p&gt;&lt;code class=&quot;language-text&quot;&gt;s&lt;/code&gt;: switch의 약자로, 치환할 때 사용하는 플래그&lt;/br&gt;
&lt;code class=&quot;language-text&quot;&gt;g&lt;/code&gt;: 치환할 부분을 문서 전체에서 찾을 때 사용하는 플래그&lt;/br&gt;
&lt;code class=&quot;language-text&quot;&gt;i&lt;/code&gt;: 변경 대상을 찾을 때 대소문자를 무시&lt;/br&gt;&lt;/p&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;sh&quot;&gt;&lt;pre class=&quot;language-sh&quot;&gt;&lt;code class=&quot;language-sh&quot;&gt;$ &lt;span class=&quot;token function&quot;&gt;sed&lt;/span&gt; &lt;span class=&quot;token parameter variable&quot;&gt;-i&lt;/span&gt; &lt;span class=&quot;token parameter variable&quot;&gt;-e&lt;/span&gt; &lt;span class=&quot;token string&quot;&gt;&apos;s/five/fives/g&apos;&lt;/span&gt; example
$ &lt;span class=&quot;token function&quot;&gt;cat&lt;/span&gt; example
one
two
three
four
fives
six
seven
eight
nine
ten

$ &lt;span class=&quot;token function&quot;&gt;sed&lt;/span&gt; &lt;span class=&quot;token parameter variable&quot;&gt;-i&lt;/span&gt; &lt;span class=&quot;token parameter variable&quot;&gt;-e&lt;/span&gt; &lt;span class=&quot;token string&quot;&gt;&apos;s/fives/FIVES/g&apos;&lt;/span&gt; example
$ &lt;span class=&quot;token function&quot;&gt;cat&lt;/span&gt; example
one
two
three
four
FIVES
six
seven
eight
nine
ten

$ &lt;span class=&quot;token function&quot;&gt;sed&lt;/span&gt; &lt;span class=&quot;token parameter variable&quot;&gt;-i&lt;/span&gt; &lt;span class=&quot;token parameter variable&quot;&gt;-e&lt;/span&gt; &lt;span class=&quot;token string&quot;&gt;&apos;s/fives/five/gi&apos;&lt;/span&gt; example
$ &lt;span class=&quot;token function&quot;&gt;cat&lt;/span&gt; example
one
two
three
four
five
six
seven
eight
nine
ten

&lt;span class=&quot;token comment&quot;&gt;# 특정 라인만 변경&lt;/span&gt;
$ &lt;span class=&quot;token function&quot;&gt;sed&lt;/span&gt; &lt;span class=&quot;token parameter variable&quot;&gt;-i&lt;/span&gt; &lt;span class=&quot;token parameter variable&quot;&gt;-e&lt;/span&gt; &lt;span class=&quot;token string&quot;&gt;&apos;3 s/three/throw/g&apos;&lt;/span&gt; example
$ &lt;span class=&quot;token function&quot;&gt;cat&lt;/span&gt; example
one
two
throw
four
fives
six
seven
eight
nine
ten&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;h2&gt;4) 그 외의 플래그&lt;/h2&gt;
&lt;table&gt;
&lt;thead&gt;
&lt;tr&gt;
&lt;th&gt;옵션&lt;/th&gt;
&lt;th&gt;의미&lt;/th&gt;
&lt;/tr&gt;
&lt;/thead&gt;
&lt;tbody&gt;
&lt;tr&gt;
&lt;td&gt;-n, --quiet&lt;/td&gt;
&lt;td&gt;패턴 스페이스에 있는 내용들을 자동으로 출력하지 않음&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;-e script, --expression script&lt;/td&gt;
&lt;td&gt;실행할 스크립트 지정&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;-f script-file, --file script-file&lt;/td&gt;
&lt;td&gt;실행할 스크립트 파일 지정&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;-i, --in-place&lt;/td&gt;
&lt;td&gt;변경된 내용 파일에 저장&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;-E, -r, --regex-extended&lt;/td&gt;
&lt;td&gt;확장 정규식 패턴 사용&lt;/td&gt;
&lt;/tr&gt;
&lt;/tbody&gt;
&lt;/table&gt;
&lt;h2&gt;출처&lt;/h2&gt;
&lt;p&gt;&lt;a href=&quot;https://jhnyang.tistory.com/287&quot;&gt;https://jhnyang.tistory.com/287&lt;/a&gt;&lt;/br&gt;
&lt;a href=&quot;https://etloveguitar.tistory.com/47&quot;&gt;https://etloveguitar.tistory.com/47&lt;/a&gt;&lt;/p&gt;</content:encoded></item><item><title><![CDATA[[쿠버네티스 완벽 가이드] 09. 워크로드 API 카테고리 (3) - 디플로이먼트]]></title><description><![CDATA[5.4 디플로이먼트 디플로이먼트(Deployment…]]></description><link>https://github.com/SiverPineValley/SiverPineValley.github.io/kubernetes/kubernetes_5_3/</link><guid isPermaLink="false">https://github.com/SiverPineValley/SiverPineValley.github.io/kubernetes/kubernetes_5_3/</guid><pubDate>Sun, 28 Aug 2022 13:30:00 GMT</pubDate><content:encoded>&lt;h1&gt;5.4 디플로이먼트&lt;/h1&gt;
&lt;p&gt;디플로이먼트(Deployment)는 여러 레플리카셋을 관리하여 롤링 업데이트나 롤백 등을 구현하는 리소스이다. 디플로이먼트가 레플리카셋을 관리하고 레플리카셋이 파드를 관리하는 관계이다. 다음과 같이 동작한다.&lt;/p&gt;
&lt;ol&gt;
&lt;li&gt;신규 레플리카셋을 생성&lt;/li&gt;
&lt;li&gt;신규 레플리카셋의 레플리카 수를 단계적으로 늘림&lt;/li&gt;
&lt;li&gt;신규 레플리카셋의 레플리카 수를 단계적으로 줄임&lt;/li&gt;
&lt;li&gt;(2,3)을 반복&lt;/li&gt;
&lt;li&gt;이전 레플리카셋은 레플리카 수를 0으로 유지&lt;/li&gt;
&lt;/ol&gt;
&lt;p&gt;디플로이먼트를 사용하면 신규 레플리카셋에 컨테이너가 기동되었는지와 헬스 체크는 통과했는지를 확인하면서 전환 작업이 진행되며, 레플리카셋의 이행 과정에서 파드 수에 대한 상세 지정도 가능하다. 이는 쿠버네티스에서 가장 권장하는 컨테이너 기동 방법으로 알려져 있다. 지금까지 파드나 레플리카셋의 사용 방법도 설명했는데, 가령 하나의 파드를 기동만 한다 하더라도 디플로이먼트 사용을 권장한다. 파드만으로 배포한 경우 파드에 장애가 생기면 파드가 다시 생성되지 않으며, 레플리카셋의 경우에도 롤링 업데이트 등의 기능을 사용할 수 없다.&lt;/p&gt;
&lt;h2&gt;5.4.1 디플로이먼트 생성&lt;/h2&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;yaml&quot;&gt;&lt;pre class=&quot;language-yaml&quot;&gt;&lt;code class=&quot;language-yaml&quot;&gt;&lt;span class=&quot;token key atrule&quot;&gt;apiVersion&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt; apps/v1
&lt;span class=&quot;token key atrule&quot;&gt;kind&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt; Deployment
&lt;span class=&quot;token key atrule&quot;&gt;metadata&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt;
  &lt;span class=&quot;token key atrule&quot;&gt;name&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt; sample&lt;span class=&quot;token punctuation&quot;&gt;-&lt;/span&gt;deployment
&lt;span class=&quot;token key atrule&quot;&gt;spec&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt;
  &lt;span class=&quot;token key atrule&quot;&gt;replicas&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;token number&quot;&gt;3&lt;/span&gt;
  &lt;span class=&quot;token key atrule&quot;&gt;selector&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt;
    &lt;span class=&quot;token key atrule&quot;&gt;matchLabels&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt;
      &lt;span class=&quot;token key atrule&quot;&gt;app&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt; sample&lt;span class=&quot;token punctuation&quot;&gt;-&lt;/span&gt;app
  &lt;span class=&quot;token key atrule&quot;&gt;template&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt;
    &lt;span class=&quot;token key atrule&quot;&gt;metadata&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt;
      &lt;span class=&quot;token key atrule&quot;&gt;labels&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt;
        &lt;span class=&quot;token key atrule&quot;&gt;app&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt; sample&lt;span class=&quot;token punctuation&quot;&gt;-&lt;/span&gt;app
    &lt;span class=&quot;token key atrule&quot;&gt;spec&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt;
      &lt;span class=&quot;token key atrule&quot;&gt;containers&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt;
        &lt;span class=&quot;token punctuation&quot;&gt;-&lt;/span&gt; &lt;span class=&quot;token key atrule&quot;&gt;name&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt; nginx&lt;span class=&quot;token punctuation&quot;&gt;-&lt;/span&gt;container
          &lt;span class=&quot;token key atrule&quot;&gt;image&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt; nginx&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt;&lt;span class=&quot;token number&quot;&gt;1.12&lt;/span&gt;
          &lt;span class=&quot;token key atrule&quot;&gt;ports&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt;
            &lt;span class=&quot;token punctuation&quot;&gt;-&lt;/span&gt; &lt;span class=&quot;token key atrule&quot;&gt;containerPort&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;token number&quot;&gt;80&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;매니페스트로 디플로이먼트를 생성한다. 이번에는 &lt;code class=&quot;language-text&quot;&gt;--record&lt;/code&gt; 옵션을 사용하여 어떤 명령어를 실행하고 업데이트했는지 이력을 지정해 둔다. 이력을 작성해 놓으면, 나중에 설명하는 &lt;code class=&quot;language-text&quot;&gt;kubectl rollout&lt;/code&gt;에서 롤백 등을 실시할 때 참고 정보로 사용할 수 있다. 실제 서비스 환경에서 rollout 기능을 사용할 일은 많지 않아 &lt;code class=&quot;language-text&quot;&gt;--record&lt;/code&gt; 역시 많이 사용되진 않는다. 아래 소스에서 nginx 이미지 버전을 1.12 -&gt; 1.17로 업데이트 하였는데, 덥데이트 후 레플리카셋이 새로 생성되고 거기에 연결되는 형태로 파드도 다시 생성된다. 이때 내부적으로 롤링 업데이트가 되어 실제 서비스에는 영향이 없다.&lt;/p&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;sh&quot;&gt;&lt;pre class=&quot;language-sh&quot;&gt;&lt;code class=&quot;language-sh&quot;&gt;&lt;span class=&quot;token comment&quot;&gt;# 업데이트 이력을 저장하는 옵션을 사용하여 디플로이먼트 기동&lt;/span&gt;
$ kubectl apply &lt;span class=&quot;token parameter variable&quot;&gt;-f&lt;/span&gt; sample-deployment.yaml &lt;span class=&quot;token parameter variable&quot;&gt;--record&lt;/span&gt;
Flag &lt;span class=&quot;token parameter variable&quot;&gt;--record&lt;/span&gt; has been deprecated, &lt;span class=&quot;token parameter variable&quot;&gt;--record&lt;/span&gt; will be removed &lt;span class=&quot;token keyword&quot;&gt;in&lt;/span&gt; the future
deployment.apps/sample-deployment created

$ kubectl get deployments
NAME                READY   UP-TO-DATE   AVAILABLE   AGE
sample-deployment   &lt;span class=&quot;token number&quot;&gt;3&lt;/span&gt;/3     &lt;span class=&quot;token number&quot;&gt;3&lt;/span&gt;            &lt;span class=&quot;token number&quot;&gt;3&lt;/span&gt;           75s

$ kubectl get replicasets &lt;span class=&quot;token parameter variable&quot;&gt;-o&lt;/span&gt; yaml &lt;span class=&quot;token operator&quot;&gt;|&lt;/span&gt; &lt;span class=&quot;token function&quot;&gt;head&lt;/span&gt;
apiVersion: v1
items:
- apiVersion: apps/v1
  kind: ReplicaSet
  metadata:
    annotations:
      deployment.kubernetes.io/desired-replicas: &lt;span class=&quot;token string&quot;&gt;&quot;3&quot;&lt;/span&gt;
      deployment.kubernetes.io/max-replicas: &lt;span class=&quot;token string&quot;&gt;&quot;4&quot;&lt;/span&gt;
      deployment.kubernetes.io/revision: &lt;span class=&quot;token string&quot;&gt;&quot;1&quot;&lt;/span&gt;
      kubernetes.io/change-cause: kubectl apply &lt;span class=&quot;token parameter variable&quot;&gt;--filename&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt;sample-deployment.yaml

&lt;span class=&quot;token comment&quot;&gt;# 컨테이너 이미지 업데이트&lt;/span&gt;
$ kubectl &lt;span class=&quot;token builtin class-name&quot;&gt;set&lt;/span&gt; image deployment sample-deployment nginx-container&lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt;nginx:1.17 &lt;span class=&quot;token parameter variable&quot;&gt;--record&lt;/span&gt;

&lt;span class=&quot;token comment&quot;&gt;# 디플로이먼트 업데이트 상태 확인&lt;/span&gt;
$ kubectl rollout status deployment sample-deployment
deployment &lt;span class=&quot;token string&quot;&gt;&quot;sample-deployment&quot;&lt;/span&gt; successfully rolled out&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;h2&gt;5.4.2 디플로이먼트 업데이트 조건&lt;/h2&gt;
&lt;p&gt;디플로이먼트에는 변경이 발생되면 위의 예제와 같이 레플리카셋이 다시 생성된다. 이 &apos;변경&apos;에는 레플리카 수의 변경 등은 포함되어 있지 않으며, &apos;생성된 파드 내용의 변경&apos;이 필요하다. 매니페스트를 쿠버네티스에 등록하게 되면, &lt;code class=&quot;language-text&quot;&gt;spec.template&lt;/code&gt; 아래의 해시값(파드 템플릿 해시)를 계신하고 이 값을 사용한 레이블로 관리한다. 다시 수작업으로 이미지 등을 이전 버전으로 재변경하여 해시값이 동일해진 경우에는 레플리카셋을 신규로 생성하지 않고 기존 레플리카셋을 사용한다.&lt;/p&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;sh&quot;&gt;&lt;pre class=&quot;language-sh&quot;&gt;&lt;code class=&quot;language-sh&quot;&gt;$ kubectl get replicasets
NAME                           DESIRED   CURRENT   READY   AGE
sample-deployment-567547fc8    &lt;span class=&quot;token number&quot;&gt;3&lt;/span&gt;         &lt;span class=&quot;token number&quot;&gt;3&lt;/span&gt;         &lt;span class=&quot;token number&quot;&gt;3&lt;/span&gt;       31m &lt;span class=&quot;token comment&quot;&gt;# 1.17 버전의 레플리카셋&lt;/span&gt;
sample-deployment-847b7dfb49   &lt;span class=&quot;token number&quot;&gt;0&lt;/span&gt;         &lt;span class=&quot;token number&quot;&gt;0&lt;/span&gt;         &lt;span class=&quot;token number&quot;&gt;0&lt;/span&gt;       6d19h &lt;span class=&quot;token comment&quot;&gt;# 1.12 버전의 레플리카셋&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;h2&gt;5.4.3 변경 롤백&lt;/h2&gt;
&lt;p&gt;디플로이먼트에는 롤백 기능이 있다. 롤백 기능의 실체는 현재 사용 중인 레플리카셋의 전환과 같은 것이다. 디플로이먼트가 기존에 생성한 레플리카셋은 레플리카 수가 0인 상태로 남아 있기 때문에 레플리카 수를 변경시켜 다시 사용할 수 있는 상태가 된다.&lt;/p&gt;
&lt;p&gt;변경 이력을 확인할 때는 &lt;code class=&quot;language-text&quot;&gt;kubectl rollout history&lt;/code&gt; 명령어를 사용한다. &lt;code class=&quot;language-text&quot;&gt;CHANGE-CAUSE&lt;/code&gt; 부분에 이력이 기록되는데, 처음 디플로이먼트를 생성할 때 &lt;code class=&quot;language-text&quot;&gt;--record&lt;/code&gt; 옵션을 사용하여 이력 내용이 있을 때만 이력이 남는다. 해당 버전의 수정 상세 정보를 가져오려면 &lt;code class=&quot;language-text&quot;&gt;--revision&lt;/code&gt; 옵션을 사용한다.&lt;/p&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;sh&quot;&gt;&lt;pre class=&quot;language-sh&quot;&gt;&lt;code class=&quot;language-sh&quot;&gt;$ kubectl rollout &lt;span class=&quot;token function&quot;&gt;history&lt;/span&gt; deployment sample-deployment &lt;span class=&quot;token parameter variable&quot;&gt;--revision&lt;/span&gt; &lt;span class=&quot;token number&quot;&gt;1&lt;/span&gt;
deployment.apps/sample-deployment with revision &lt;span class=&quot;token comment&quot;&gt;#1&lt;/span&gt;
Pod Template:
  Labels:	&lt;span class=&quot;token assign-left variable&quot;&gt;app&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt;sample-app
	pod-template-hash&lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt;847b7dfb49
  Annotations:	kubernetes.io/change-cause: kubectl apply &lt;span class=&quot;token parameter variable&quot;&gt;--filename&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt;sample-deployment.yaml &lt;span class=&quot;token parameter variable&quot;&gt;--record&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt;true
  Containers:
   nginx-container:
    Image:	nginx:1.12
    Port:	&lt;span class=&quot;token number&quot;&gt;80&lt;/span&gt;/TCP
    Host Port:	&lt;span class=&quot;token number&quot;&gt;0&lt;/span&gt;/TCP
    Environment:	&lt;span class=&quot;token operator&quot;&gt;&amp;lt;&lt;/span&gt;none&lt;span class=&quot;token operator&quot;&gt;&gt;&lt;/span&gt;
    Mounts:	&lt;span class=&quot;token operator&quot;&gt;&amp;lt;&lt;/span&gt;none&lt;span class=&quot;token operator&quot;&gt;&gt;&lt;/span&gt;
  Volumes:	&lt;span class=&quot;token operator&quot;&gt;&amp;lt;&lt;/span&gt;none&lt;span class=&quot;token operator&quot;&gt;&gt;&lt;/span&gt;

$ kubectl rollout &lt;span class=&quot;token function&quot;&gt;history&lt;/span&gt; deployment sample-deployent &lt;span class=&quot;token parameter variable&quot;&gt;--revision&lt;/span&gt; &lt;span class=&quot;token number&quot;&gt;2&lt;/span&gt;
deployment.apps/sample-deployment with revision &lt;span class=&quot;token comment&quot;&gt;#2&lt;/span&gt;
Pod Template:
  Labels:	&lt;span class=&quot;token assign-left variable&quot;&gt;app&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt;sample-app
	pod-template-hash&lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt;567547fc8
  Annotations:	kubernetes.io/change-cause: kubectl &lt;span class=&quot;token builtin class-name&quot;&gt;set&lt;/span&gt; image deployment sample-deployment nginx-container&lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt;nginx:1.17 &lt;span class=&quot;token parameter variable&quot;&gt;--record&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt;true
  Containers:
   nginx-container:
    Image:	nginx:1.17
    Port:	&lt;span class=&quot;token number&quot;&gt;80&lt;/span&gt;/TCP
    Host Port:	&lt;span class=&quot;token number&quot;&gt;0&lt;/span&gt;/TCP
    Environment:	&lt;span class=&quot;token operator&quot;&gt;&amp;lt;&lt;/span&gt;none&lt;span class=&quot;token operator&quot;&gt;&gt;&lt;/span&gt;
    Mounts:	&lt;span class=&quot;token operator&quot;&gt;&amp;lt;&lt;/span&gt;none&lt;span class=&quot;token operator&quot;&gt;&gt;&lt;/span&gt;
  Volumes:	&lt;span class=&quot;token operator&quot;&gt;&amp;lt;&lt;/span&gt;none&lt;span class=&quot;token operator&quot;&gt;&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;롤백하려면 &lt;code class=&quot;language-text&quot;&gt;kubectl rollout undo&lt;/code&gt; 명령어를 사용한다.&lt;/p&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;sh&quot;&gt;&lt;pre class=&quot;language-sh&quot;&gt;&lt;code class=&quot;language-sh&quot;&gt;&lt;span class=&quot;token comment&quot;&gt;# 버전 번호를 지정하여 롤백&lt;/span&gt;
$ kubectl rollout undo deployment sample-deployment --to-revision &lt;span class=&quot;token number&quot;&gt;1&lt;/span&gt;

&lt;span class=&quot;token comment&quot;&gt;# 바로 이전 버전으로 롤백 (--to-revision이 0으로 지정됨)&lt;/span&gt;
$ kubectl rollout undo deployment sample-deployment

&lt;span class=&quot;token comment&quot;&gt;# 롤백한 이후 이전 레플리카셋이 다시 기동됨&lt;/span&gt;
$ kubectl get replicasets
NAME                           DESIRED   CURRENT   READY   AGE
sample-deployment-567547fc8    &lt;span class=&quot;token number&quot;&gt;0&lt;/span&gt;         &lt;span class=&quot;token number&quot;&gt;0&lt;/span&gt;         &lt;span class=&quot;token number&quot;&gt;0&lt;/span&gt;       42m
sample-deployment-847b7dfb49   &lt;span class=&quot;token number&quot;&gt;3&lt;/span&gt;         &lt;span class=&quot;token number&quot;&gt;3&lt;/span&gt;         &lt;span class=&quot;token number&quot;&gt;3&lt;/span&gt;       6d20h&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;h2&gt;5.4.4 디플로이먼트 변경 일시 중지&lt;/h2&gt;
&lt;p&gt;일반적으로는 디플로이먼트 변경을 하면 바로 적용되나, 안전을 위해 업데이트를 잠시 멈추도록 할 수 있다.&lt;/p&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;sh&quot;&gt;&lt;pre class=&quot;language-sh&quot;&gt;&lt;code class=&quot;language-sh&quot;&gt;&lt;span class=&quot;token comment&quot;&gt;# 업데이트 일시 중지&lt;/span&gt;
$ kubectl rollout pause deployment sample-deployment
deployment.apps/sample-deployment paused

&lt;span class=&quot;token comment&quot;&gt;# pause 상태에서 컨테이너 이미지 업데이트&lt;/span&gt;
$ kubectl &lt;span class=&quot;token builtin class-name&quot;&gt;set&lt;/span&gt; image deployment sample-deployment nginx-container&lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt;nginx:1.17
deployment.apps/sample-deployment image updated

&lt;span class=&quot;token comment&quot;&gt;# 업데이트는 대기 상태&lt;/span&gt;
$ kubectl rollout status deployment sample-deployment
Waiting &lt;span class=&quot;token keyword&quot;&gt;for&lt;/span&gt; deployment &lt;span class=&quot;token string&quot;&gt;&quot;sample-deployment&quot;&lt;/span&gt; rollout to finish: &lt;span class=&quot;token number&quot;&gt;0&lt;/span&gt; out of &lt;span class=&quot;token number&quot;&gt;3&lt;/span&gt; new replicas have been updated&lt;span class=&quot;token punctuation&quot;&gt;..&lt;/span&gt;.

&lt;span class=&quot;token comment&quot;&gt;# 업데이트 재개&lt;/span&gt;
$ kubectl rollout resume deployment sample-deployment
deployment.apps/sample-deployment resumed

&lt;span class=&quot;token comment&quot;&gt;# 업데이트 상태 확인&lt;/span&gt;
$ kubectl rollout status deployment sample-deployment
deployment &lt;span class=&quot;token string&quot;&gt;&quot;sample-deployment&quot;&lt;/span&gt; successfully rolled out&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;h2&gt;5.4.5 디플로이먼트 업데이트 전략&lt;/h2&gt;
&lt;p&gt;위 예제에서는 디플로이먼트를 업데이트하면 &lt;code class=&quot;language-text&quot;&gt;RollingUpdate&lt;/code&gt; 가 진행되었다. 이 외에도 &lt;code class=&quot;language-text&quot;&gt;Recreate&lt;/code&gt; 전략도 있다.&lt;/p&gt;
&lt;h3&gt;Recreate&lt;/h3&gt;
&lt;p&gt;&lt;code class=&quot;language-text&quot;&gt;Recreate&lt;/code&gt;는 모든 파드를 한 번 삭제하고 다시 파드를 생성하기 때문에 다운타임이 발생하지만, 추가 리소스를 사용하지 않고 전환이 빠른 것이 장점이다. 기존 레플리카셋의 레플리카 수를 0으로 하고 리소스를 반환한다. 이후 신규 레플리카셋을 생성하고 레플리카 수를 늘린다. 그래서 클러스터 전체에 현재 동작하고 있는 레플리카 수만큼만 리소스가 있다 하더라도 업데이트할 수 있다.&lt;/p&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;yaml&quot;&gt;&lt;pre class=&quot;language-yaml&quot;&gt;&lt;code class=&quot;language-yaml&quot;&gt;&lt;span class=&quot;token key atrule&quot;&gt;apiVersion&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt; apps/v1
&lt;span class=&quot;token key atrule&quot;&gt;kind&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt; Deployment
&lt;span class=&quot;token key atrule&quot;&gt;metadata&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt;
  &lt;span class=&quot;token key atrule&quot;&gt;name&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt; sample&lt;span class=&quot;token punctuation&quot;&gt;-&lt;/span&gt;deployment&lt;span class=&quot;token punctuation&quot;&gt;-&lt;/span&gt;recreate
&lt;span class=&quot;token key atrule&quot;&gt;spec&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt;
  &lt;span class=&quot;token key atrule&quot;&gt;strategy&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt;
    &lt;span class=&quot;token key atrule&quot;&gt;type&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt; Recreate
  &lt;span class=&quot;token key atrule&quot;&gt;replicas&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;token number&quot;&gt;3&lt;/span&gt;
  &lt;span class=&quot;token key atrule&quot;&gt;selector&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt;
    &lt;span class=&quot;token key atrule&quot;&gt;matchLabels&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt;
      &lt;span class=&quot;token key atrule&quot;&gt;app&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt; sample&lt;span class=&quot;token punctuation&quot;&gt;-&lt;/span&gt;app
  &lt;span class=&quot;token key atrule&quot;&gt;template&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt;
    &lt;span class=&quot;token key atrule&quot;&gt;metadata&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt;
      &lt;span class=&quot;token key atrule&quot;&gt;labels&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt;
        &lt;span class=&quot;token key atrule&quot;&gt;app&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt; sample&lt;span class=&quot;token punctuation&quot;&gt;-&lt;/span&gt;app
    &lt;span class=&quot;token key atrule&quot;&gt;spec&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt;
      &lt;span class=&quot;token key atrule&quot;&gt;containers&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt;
        &lt;span class=&quot;token punctuation&quot;&gt;-&lt;/span&gt; &lt;span class=&quot;token key atrule&quot;&gt;name&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt; nginx&lt;span class=&quot;token punctuation&quot;&gt;-&lt;/span&gt;container
          &lt;span class=&quot;token key atrule&quot;&gt;image&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt; nginx&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt;&lt;span class=&quot;token number&quot;&gt;1.16&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;sh&quot;&gt;&lt;pre class=&quot;language-sh&quot;&gt;&lt;code class=&quot;language-sh&quot;&gt;&lt;span class=&quot;token comment&quot;&gt;# 컨테이너 이미지 업데이트&lt;/span&gt;
$ kubectl &lt;span class=&quot;token builtin class-name&quot;&gt;set&lt;/span&gt; image deployment sample-deployment-recreate nginx-container&lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt;nginx:1.17
deployment.apps/sample-deployment-recreate image updated

&lt;span class=&quot;token comment&quot;&gt;# 레플리카셋 목록 표시 (리소스 상태 변화가 있으면 계속 출력)&lt;/span&gt;
$ kubectl get replicasets &lt;span class=&quot;token parameter variable&quot;&gt;--watch&lt;/span&gt;
NAME                                    DESIRED   CURRENT   READY   AGE
sample-deployment-567547fc8             &lt;span class=&quot;token number&quot;&gt;3&lt;/span&gt;         &lt;span class=&quot;token number&quot;&gt;3&lt;/span&gt;         &lt;span class=&quot;token number&quot;&gt;3&lt;/span&gt;       51m
sample-deployment-847b7dfb49            &lt;span class=&quot;token number&quot;&gt;0&lt;/span&gt;         &lt;span class=&quot;token number&quot;&gt;0&lt;/span&gt;         &lt;span class=&quot;token number&quot;&gt;0&lt;/span&gt;       6d20h
sample-deployment-recreate-5f85cc775b   &lt;span class=&quot;token number&quot;&gt;0&lt;/span&gt;         &lt;span class=&quot;token number&quot;&gt;0&lt;/span&gt;         &lt;span class=&quot;token number&quot;&gt;0&lt;/span&gt;       20s
sample-deployment-recreate-7b8dbc9899   &lt;span class=&quot;token number&quot;&gt;3&lt;/span&gt;         &lt;span class=&quot;token number&quot;&gt;3&lt;/span&gt;         &lt;span class=&quot;token number&quot;&gt;0&lt;/span&gt;       0s
sample-deployment-recreate-7b8dbc9899   &lt;span class=&quot;token number&quot;&gt;3&lt;/span&gt;         &lt;span class=&quot;token number&quot;&gt;3&lt;/span&gt;         &lt;span class=&quot;token number&quot;&gt;1&lt;/span&gt;       0s
sample-deployment-recreate-7b8dbc9899   &lt;span class=&quot;token number&quot;&gt;3&lt;/span&gt;         &lt;span class=&quot;token number&quot;&gt;3&lt;/span&gt;         &lt;span class=&quot;token number&quot;&gt;3&lt;/span&gt;       0s&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;h3&gt;RollingUpdate&lt;/h3&gt;
&lt;p&gt;&lt;code class=&quot;language-text&quot;&gt;Recrate&lt;/code&gt;는 위에서 설명한대로 기존 자원을 반환하기 때문에, 추가 리소스를 사용하지 않고 빠른 업데이트가 가능하다. &lt;code class=&quot;language-text&quot;&gt;RollingUpdate&lt;/code&gt;는 업데이트 중에 동시에 정지 가능한 최대 파드 수(&lt;code class=&quot;language-text&quot;&gt;maxUnavailable&lt;/code&gt;)와 업데이트 중에 동시에 생성할 수 있는 최대 파드 수(&lt;code class=&quot;language-text&quot;&gt;maxSurge&lt;/code&gt;)를 설정할 수 있다. 이 설정을 사용하면 추가 리소스를 사용하지 않도록 하거나 많은 리소스를 소비하지 않고 빠르게 전환하는 등 업데이트를 하면서 동작을 제어할 수 있다. 두 값 모두 0으로 설정할 수는 없다. 아래 매피페스트와 같이 &lt;code class=&quot;language-text&quot;&gt;maxUnavailable=0&lt;/code&gt;, &lt;code class=&quot;language-text&quot;&gt;maxSurge=1&lt;/code&gt; 설정으로 하면 &lt;code class=&quot;language-text&quot;&gt;maxSurge&lt;/code&gt; 수만틈 추가 레플리카 수를 늘려 파드를 이동시킨다. &lt;code class=&quot;language-text&quot;&gt;maxUnavailable&lt;/code&gt;과 &lt;code class=&quot;language-text&quot;&gt;maxSurge&lt;/code&gt;는 백분율로도 지정할 수 있다. 지정하지 않을 경우 기본 값은 모두 25%이다.&lt;/p&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;yaml&quot;&gt;&lt;pre class=&quot;language-yaml&quot;&gt;&lt;code class=&quot;language-yaml&quot;&gt;&lt;span class=&quot;token key atrule&quot;&gt;apiVersion&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt; apps/v1
&lt;span class=&quot;token key atrule&quot;&gt;kind&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt; Deployment
&lt;span class=&quot;token key atrule&quot;&gt;metadata&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt;
  &lt;span class=&quot;token key atrule&quot;&gt;name&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt; sample&lt;span class=&quot;token punctuation&quot;&gt;-&lt;/span&gt;deployment&lt;span class=&quot;token punctuation&quot;&gt;-&lt;/span&gt;rollingupdate
&lt;span class=&quot;token key atrule&quot;&gt;spec&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt;
  &lt;span class=&quot;token key atrule&quot;&gt;strategy&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt;
    &lt;span class=&quot;token key atrule&quot;&gt;type&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt; RollingUpdate
    &lt;span class=&quot;token key atrule&quot;&gt;rollingUpdate&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt;
      &lt;span class=&quot;token key atrule&quot;&gt;maxUnavailable&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;token number&quot;&gt;0&lt;/span&gt;
      &lt;span class=&quot;token key atrule&quot;&gt;maxSurge&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;token number&quot;&gt;1&lt;/span&gt;
  &lt;span class=&quot;token key atrule&quot;&gt;replicas&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;token number&quot;&gt;3&lt;/span&gt;
  &lt;span class=&quot;token key atrule&quot;&gt;selector&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt;
    &lt;span class=&quot;token key atrule&quot;&gt;matchLabels&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt;
      &lt;span class=&quot;token key atrule&quot;&gt;app&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt; sample&lt;span class=&quot;token punctuation&quot;&gt;-&lt;/span&gt;app
  &lt;span class=&quot;token key atrule&quot;&gt;template&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt;
    &lt;span class=&quot;token key atrule&quot;&gt;metadata&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt;
      &lt;span class=&quot;token key atrule&quot;&gt;labels&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt;
        &lt;span class=&quot;token key atrule&quot;&gt;app&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt; sample&lt;span class=&quot;token punctuation&quot;&gt;-&lt;/span&gt;app
    &lt;span class=&quot;token key atrule&quot;&gt;spec&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt;
      &lt;span class=&quot;token key atrule&quot;&gt;containers&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt;
        &lt;span class=&quot;token punctuation&quot;&gt;-&lt;/span&gt; &lt;span class=&quot;token key atrule&quot;&gt;name&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt; nginx&lt;span class=&quot;token punctuation&quot;&gt;-&lt;/span&gt;container
          &lt;span class=&quot;token key atrule&quot;&gt;image&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt; nginx&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt;&lt;span class=&quot;token number&quot;&gt;1.16&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;sh&quot;&gt;&lt;pre class=&quot;language-sh&quot;&gt;&lt;code class=&quot;language-sh&quot;&gt;&lt;span class=&quot;token comment&quot;&gt;# 컨테이너 이미지 업데이트&lt;/span&gt;
$ kubectl &lt;span class=&quot;token builtin class-name&quot;&gt;set&lt;/span&gt; image deployment sample-deployment-rollingupdate nginx-container&lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt;nginx:1.17
deployment.apps/sample-deployment-rollingupdate image updated

&lt;span class=&quot;token comment&quot;&gt;# 레플리카셋 목록 표시(리소스 상태 변화가 있으면 계속 출력)&lt;/span&gt;
$ kubectl get replicasets &lt;span class=&quot;token parameter variable&quot;&gt;--watch&lt;/span&gt;
NAME                                         DESIRED   CURRENT   READY   AGE
sample-deployment-567547fc8                  &lt;span class=&quot;token number&quot;&gt;3&lt;/span&gt;         &lt;span class=&quot;token number&quot;&gt;3&lt;/span&gt;         &lt;span class=&quot;token number&quot;&gt;3&lt;/span&gt;       57m
sample-deployment-847b7dfb49                 &lt;span class=&quot;token number&quot;&gt;0&lt;/span&gt;         &lt;span class=&quot;token number&quot;&gt;0&lt;/span&gt;         &lt;span class=&quot;token number&quot;&gt;0&lt;/span&gt;       6d20h
sample-deployment-rollingupdate-5f85cc775b   &lt;span class=&quot;token number&quot;&gt;3&lt;/span&gt;         &lt;span class=&quot;token number&quot;&gt;3&lt;/span&gt;         &lt;span class=&quot;token number&quot;&gt;3&lt;/span&gt;       66s
sample-deployment-rollingupdate-7b8dbc9899   &lt;span class=&quot;token number&quot;&gt;1&lt;/span&gt;         &lt;span class=&quot;token number&quot;&gt;1&lt;/span&gt;         &lt;span class=&quot;token number&quot;&gt;0&lt;/span&gt;       1s
sample-deployment-rollingupdate-7b8dbc9899   &lt;span class=&quot;token number&quot;&gt;1&lt;/span&gt;         &lt;span class=&quot;token number&quot;&gt;1&lt;/span&gt;         &lt;span class=&quot;token number&quot;&gt;1&lt;/span&gt;       1s
sample-deployment-rollingupdate-5f85cc775b   &lt;span class=&quot;token number&quot;&gt;2&lt;/span&gt;         &lt;span class=&quot;token number&quot;&gt;3&lt;/span&gt;         &lt;span class=&quot;token number&quot;&gt;3&lt;/span&gt;       66s
sample-deployment-rollingupdate-5f85cc775b   &lt;span class=&quot;token number&quot;&gt;2&lt;/span&gt;         &lt;span class=&quot;token number&quot;&gt;3&lt;/span&gt;         &lt;span class=&quot;token number&quot;&gt;3&lt;/span&gt;       66s
sample-deployment-rollingupdate-7b8dbc9899   &lt;span class=&quot;token number&quot;&gt;2&lt;/span&gt;         &lt;span class=&quot;token number&quot;&gt;1&lt;/span&gt;         &lt;span class=&quot;token number&quot;&gt;1&lt;/span&gt;       1s
sample-deployment-rollingupdate-5f85cc775b   &lt;span class=&quot;token number&quot;&gt;2&lt;/span&gt;         &lt;span class=&quot;token number&quot;&gt;2&lt;/span&gt;         &lt;span class=&quot;token number&quot;&gt;2&lt;/span&gt;       66s
sample-deployment-rollingupdate-7b8dbc9899   &lt;span class=&quot;token number&quot;&gt;2&lt;/span&gt;         &lt;span class=&quot;token number&quot;&gt;1&lt;/span&gt;         &lt;span class=&quot;token number&quot;&gt;1&lt;/span&gt;       1s
sample-deployment-rollingupdate-7b8dbc9899   &lt;span class=&quot;token number&quot;&gt;2&lt;/span&gt;         &lt;span class=&quot;token number&quot;&gt;2&lt;/span&gt;         &lt;span class=&quot;token number&quot;&gt;1&lt;/span&gt;       1s
sample-deployment-rollingupdate-7b8dbc9899   &lt;span class=&quot;token number&quot;&gt;2&lt;/span&gt;         &lt;span class=&quot;token number&quot;&gt;2&lt;/span&gt;         &lt;span class=&quot;token number&quot;&gt;2&lt;/span&gt;       2s
sample-deployment-rollingupdate-5f85cc775b   &lt;span class=&quot;token number&quot;&gt;1&lt;/span&gt;         &lt;span class=&quot;token number&quot;&gt;2&lt;/span&gt;         &lt;span class=&quot;token number&quot;&gt;2&lt;/span&gt;       67s
sample-deployment-rollingupdate-5f85cc775b   &lt;span class=&quot;token number&quot;&gt;1&lt;/span&gt;         &lt;span class=&quot;token number&quot;&gt;2&lt;/span&gt;         &lt;span class=&quot;token number&quot;&gt;2&lt;/span&gt;       67s
sample-deployment-rollingupdate-7b8dbc9899   &lt;span class=&quot;token number&quot;&gt;3&lt;/span&gt;         &lt;span class=&quot;token number&quot;&gt;2&lt;/span&gt;         &lt;span class=&quot;token number&quot;&gt;2&lt;/span&gt;       2s
sample-deployment-rollingupdate-5f85cc775b   &lt;span class=&quot;token number&quot;&gt;1&lt;/span&gt;         &lt;span class=&quot;token number&quot;&gt;1&lt;/span&gt;         &lt;span class=&quot;token number&quot;&gt;1&lt;/span&gt;       67s
sample-deployment-rollingupdate-7b8dbc9899   &lt;span class=&quot;token number&quot;&gt;3&lt;/span&gt;         &lt;span class=&quot;token number&quot;&gt;2&lt;/span&gt;         &lt;span class=&quot;token number&quot;&gt;2&lt;/span&gt;       2s
sample-deployment-rollingupdate-7b8dbc9899   &lt;span class=&quot;token number&quot;&gt;3&lt;/span&gt;         &lt;span class=&quot;token number&quot;&gt;3&lt;/span&gt;         &lt;span class=&quot;token number&quot;&gt;2&lt;/span&gt;       2s
sample-deployment-rollingupdate-7b8dbc9899   &lt;span class=&quot;token number&quot;&gt;3&lt;/span&gt;         &lt;span class=&quot;token number&quot;&gt;3&lt;/span&gt;         &lt;span class=&quot;token number&quot;&gt;3&lt;/span&gt;       3s
sample-deployment-rollingupdate-5f85cc775b   &lt;span class=&quot;token number&quot;&gt;0&lt;/span&gt;         &lt;span class=&quot;token number&quot;&gt;1&lt;/span&gt;         &lt;span class=&quot;token number&quot;&gt;1&lt;/span&gt;       68s
sample-deployment-rollingupdate-5f85cc775b   &lt;span class=&quot;token number&quot;&gt;0&lt;/span&gt;         &lt;span class=&quot;token number&quot;&gt;1&lt;/span&gt;         &lt;span class=&quot;token number&quot;&gt;1&lt;/span&gt;       68s
sample-deployment-rollingupdate-5f85cc775b   &lt;span class=&quot;token number&quot;&gt;0&lt;/span&gt;         &lt;span class=&quot;token number&quot;&gt;0&lt;/span&gt;         &lt;span class=&quot;token number&quot;&gt;0&lt;/span&gt;       68s&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;h2&gt;5.4.6 상세 업데이트 파라미터&lt;/h2&gt;
&lt;p&gt;&lt;code class=&quot;language-text&quot;&gt;Recreate&lt;/code&gt;나 &lt;code class=&quot;language-text&quot;&gt;RollingUpdate&lt;/code&gt;를 사용할 때는 다른 파라미터를 사용하여 설정할 수도 있다.&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;minReadySeconds(최소 대기 시간(초)): 파드가 Ready 상태가 된 다음부터 디플로이먼트 리소스에서 파드 기동이 완료되었다고 판단(다음 파드의 교체가 가능하다고 판단)하기까지의 최소 시간(초)&lt;/li&gt;
&lt;li&gt;revisionHistoryLimit(수정 버전 기록 제한): 디플로이먼트가 유지할 레플리카셋 수, 롤백이 가능한 이력 수&lt;/li&gt;
&lt;li&gt;progressDeadlineSeconds(진행 기한 시간(초)): &lt;code class=&quot;language-text&quot;&gt;Recreate&lt;/code&gt;/&lt;code class=&quot;language-text&quot;&gt;RollingUpdate&lt;/code&gt; 처리 타임아웃 시간, 타임아웃 시간이 경과하면 자동으로 롤백&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;위의 내용은 모두 디플로이먼트의 &lt;code class=&quot;language-text&quot;&gt;spec&lt;/code&gt; 아래에 설정할 수 있다.&lt;/p&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;yaml&quot;&gt;&lt;pre class=&quot;language-yaml&quot;&gt;&lt;code class=&quot;language-yaml&quot;&gt;&lt;span class=&quot;token key atrule&quot;&gt;apiVersion&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt; apps/v1
&lt;span class=&quot;token key atrule&quot;&gt;kind&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt; Deployment
&lt;span class=&quot;token key atrule&quot;&gt;metadata&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt;
  &lt;span class=&quot;token key atrule&quot;&gt;name&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt; sample&lt;span class=&quot;token punctuation&quot;&gt;-&lt;/span&gt;deployment&lt;span class=&quot;token punctuation&quot;&gt;-&lt;/span&gt;params
&lt;span class=&quot;token key atrule&quot;&gt;spec&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt;
  &lt;span class=&quot;token key atrule&quot;&gt;minReadySeconds&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;token number&quot;&gt;0&lt;/span&gt;
  &lt;span class=&quot;token key atrule&quot;&gt;revisionHistoryLimit&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;token number&quot;&gt;2&lt;/span&gt;
  &lt;span class=&quot;token key atrule&quot;&gt;progressDeadlineSeconds&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;token number&quot;&gt;3600&lt;/span&gt;
  &lt;span class=&quot;token key atrule&quot;&gt;replicas&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;token number&quot;&gt;3&lt;/span&gt;
  &lt;span class=&quot;token key atrule&quot;&gt;selector&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt;
    &lt;span class=&quot;token key atrule&quot;&gt;matchLabels&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt;
      &lt;span class=&quot;token key atrule&quot;&gt;app&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt; sample&lt;span class=&quot;token punctuation&quot;&gt;-&lt;/span&gt;app
  &lt;span class=&quot;token key atrule&quot;&gt;template&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt;
    &lt;span class=&quot;token key atrule&quot;&gt;metadata&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt;
      &lt;span class=&quot;token key atrule&quot;&gt;labels&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt;
        &lt;span class=&quot;token key atrule&quot;&gt;app&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt; sample&lt;span class=&quot;token punctuation&quot;&gt;-&lt;/span&gt;app
    &lt;span class=&quot;token key atrule&quot;&gt;spec&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt;
      &lt;span class=&quot;token key atrule&quot;&gt;containers&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt;
        &lt;span class=&quot;token punctuation&quot;&gt;-&lt;/span&gt; &lt;span class=&quot;token key atrule&quot;&gt;name&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt; nginx&lt;span class=&quot;token punctuation&quot;&gt;-&lt;/span&gt;container
          &lt;span class=&quot;token key atrule&quot;&gt;image&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt; nginx&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt;&lt;span class=&quot;token number&quot;&gt;1.16&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;h2&gt;5.4.7 디플로이먼트 스케일링&lt;/h2&gt;
&lt;p&gt;디플로이먼트가 관리하면 레플리카셋의 레플리카 수는 레플리카셋과 같은 방법으로 &lt;code class=&quot;language-text&quot;&gt;kubectl apply -f&lt;/code&gt; 또는 &lt;code class=&quot;language-text&quot;&gt;kubectl scale&lt;/code&gt;을 사용하여 스케일 할 수 있다.&lt;/p&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;sh&quot;&gt;&lt;pre class=&quot;language-sh&quot;&gt;&lt;code class=&quot;language-sh&quot;&gt;&lt;span class=&quot;token comment&quot;&gt;# 레플리카 수를 3에서 4로 변경한 매니페스트를 apply&lt;/span&gt;
$ &lt;span class=&quot;token function&quot;&gt;sed&lt;/span&gt; &lt;span class=&quot;token parameter variable&quot;&gt;-i&lt;/span&gt; &lt;span class=&quot;token parameter variable&quot;&gt;-e&lt;/span&gt; &lt;span class=&quot;token string&quot;&gt;&apos;s|replicas: 3|replicas: 4|&apos;&lt;/span&gt; sample-deployment.yaml
$ kubectl apply &lt;span class=&quot;token parameter variable&quot;&gt;-f&lt;/span&gt; sample-deployment.yaml
deployment.apps/sample-deployment configured

&lt;span class=&quot;token comment&quot;&gt;# kubectl scale 명령어를 사용한 스케일링&lt;/span&gt;
$ kubectl scale deployment sample-deployment &lt;span class=&quot;token parameter variable&quot;&gt;--replicas&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;token number&quot;&gt;5&lt;/span&gt;
deployment.apps/sample-deployment scaled

$ kubectl get pods &lt;span class=&quot;token parameter variable&quot;&gt;-L&lt;/span&gt; app
NAME                                 READY   STATUS    RESTARTS      AGE   APP
sample-deployment-5988795749-5bw7c   &lt;span class=&quot;token number&quot;&gt;1&lt;/span&gt;/1     Running   &lt;span class=&quot;token number&quot;&gt;0&lt;/span&gt;             56s   sample-app
sample-deployment-5988795749-5rvp4   &lt;span class=&quot;token number&quot;&gt;1&lt;/span&gt;/1     Running   &lt;span class=&quot;token number&quot;&gt;0&lt;/span&gt;             56s   sample-app
sample-deployment-5988795749-kktn8   &lt;span class=&quot;token number&quot;&gt;1&lt;/span&gt;/1     Running   &lt;span class=&quot;token number&quot;&gt;0&lt;/span&gt;             57s   sample-app
sample-deployment-5988795749-pc2tr   &lt;span class=&quot;token number&quot;&gt;1&lt;/span&gt;/1     Running   &lt;span class=&quot;token number&quot;&gt;0&lt;/span&gt;             36s   sample-app
sample-deployment-5988795749-xsj5h   &lt;span class=&quot;token number&quot;&gt;1&lt;/span&gt;/1     Running   &lt;span class=&quot;token number&quot;&gt;0&lt;/span&gt;             57s   sample-app&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;</content:encoded></item><item><title><![CDATA[[쿠버네티스 완벽 가이드] 08. 워크로드 API 카테고리 (2) - 레플리카셋/레플리케이션 컨트롤러]]></title><description><![CDATA[5.3 레플리카셋/레플리케이션 컨트롤러 레플리카셋(ReplicaSet) / 레플리케이션 컨트롤러(Replication Controller…]]></description><link>https://github.com/SiverPineValley/SiverPineValley.github.io/kubernetes/kubernetes_5_2/</link><guid isPermaLink="false">https://github.com/SiverPineValley/SiverPineValley.github.io/kubernetes/kubernetes_5_2/</guid><pubDate>Sun, 21 Aug 2022 16:30:00 GMT</pubDate><content:encoded>&lt;h1&gt;5.3 레플리카셋/레플리케이션 컨트롤러&lt;/h1&gt;
&lt;p&gt;레플리카셋(ReplicaSet) / 레플리케이션 컨트롤러(Replication Controller)는 파드의 레플리카를 생성하고 지정한 파드 수를 유지하는 리소스이다. 원래 파드의 레플리카를 생성하는 리소스의 이름은 레플리케이션 컨트롤러였는데, 시간이 지나 레플리카셋으로 이름이 변경되면서 일부 기능이 추가되었다.&lt;/p&gt;
&lt;h2&gt;5.3.1 레플리카셋 생성&lt;/h2&gt;
&lt;p&gt;레플리카셋은 아래와 같은 매니페스트를 사용한다. &lt;code class=&quot;language-text&quot;&gt;spec.template&lt;/code&gt; 부분에는 복제할 파드 정의(Pod Template)를 기술한다.&lt;/p&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;yaml&quot;&gt;&lt;pre class=&quot;language-yaml&quot;&gt;&lt;code class=&quot;language-yaml&quot;&gt;&lt;span class=&quot;token key atrule&quot;&gt;apiVersion&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt; apps/v1
&lt;span class=&quot;token key atrule&quot;&gt;kind&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt; ReplicaSet
&lt;span class=&quot;token key atrule&quot;&gt;metadata&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt;
  &lt;span class=&quot;token key atrule&quot;&gt;name&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt; sample&lt;span class=&quot;token punctuation&quot;&gt;-&lt;/span&gt;rs
&lt;span class=&quot;token key atrule&quot;&gt;spec&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt;
  &lt;span class=&quot;token key atrule&quot;&gt;replicas&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;token number&quot;&gt;3&lt;/span&gt;
  &lt;span class=&quot;token key atrule&quot;&gt;selector&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt;
    &lt;span class=&quot;token key atrule&quot;&gt;matchLabels&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt;
      &lt;span class=&quot;token key atrule&quot;&gt;app&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt; sample&lt;span class=&quot;token punctuation&quot;&gt;-&lt;/span&gt;app
  &lt;span class=&quot;token key atrule&quot;&gt;template&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt;
    &lt;span class=&quot;token key atrule&quot;&gt;metadata&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt;
      &lt;span class=&quot;token key atrule&quot;&gt;labels&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt;
        &lt;span class=&quot;token key atrule&quot;&gt;app&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt; sample&lt;span class=&quot;token punctuation&quot;&gt;-&lt;/span&gt;app
    &lt;span class=&quot;token key atrule&quot;&gt;spec&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt;
      &lt;span class=&quot;token key atrule&quot;&gt;containers&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt;
        &lt;span class=&quot;token punctuation&quot;&gt;-&lt;/span&gt; &lt;span class=&quot;token key atrule&quot;&gt;name&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt; nginx&lt;span class=&quot;token punctuation&quot;&gt;-&lt;/span&gt;container
          &lt;span class=&quot;token key atrule&quot;&gt;image&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt; nginx&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt;&lt;span class=&quot;token number&quot;&gt;1.16&lt;/span&gt;
          &lt;span class=&quot;token key atrule&quot;&gt;ports&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt;
            &lt;span class=&quot;token punctuation&quot;&gt;-&lt;/span&gt; &lt;span class=&quot;token key atrule&quot;&gt;containerPort&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;token number&quot;&gt;80&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;sh&quot;&gt;&lt;pre class=&quot;language-sh&quot;&gt;&lt;code class=&quot;language-sh&quot;&gt;$ kubectl apply &lt;span class=&quot;token parameter variable&quot;&gt;-f&lt;/span&gt; sample-rs.yaml
replicaset.apps/sample-rs created

&lt;span class=&quot;token comment&quot;&gt;# 레플리카셋 조회&lt;/span&gt;
$ kubectl get replicasets &lt;span class=&quot;token parameter variable&quot;&gt;-o&lt;/span&gt; wide
NAME        DESIRED   CURRENT   READY   AGE   CONTAINERS        IMAGES       SELECTOR
sample-rs   &lt;span class=&quot;token number&quot;&gt;3&lt;/span&gt;         &lt;span class=&quot;token number&quot;&gt;3&lt;/span&gt;         &lt;span class=&quot;token number&quot;&gt;3&lt;/span&gt;       39s   nginx-container   nginx:1.16   &lt;span class=&quot;token assign-left variable&quot;&gt;app&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt;sample-app

&lt;span class=&quot;token comment&quot;&gt;# 지정한 레이블로 파드를 조회&lt;/span&gt;
$ kubectl get pods &lt;span class=&quot;token parameter variable&quot;&gt;-l&lt;/span&gt; &lt;span class=&quot;token assign-left variable&quot;&gt;app&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt;sample-app &lt;span class=&quot;token parameter variable&quot;&gt;-o&lt;/span&gt; wide
NAME              READY   STATUS    RESTARTS   AGE   IP           NODE                   NOMINATED NODE   READINESS GATES
sample-rs-h2nwl   &lt;span class=&quot;token number&quot;&gt;1&lt;/span&gt;/1     Running   &lt;span class=&quot;token number&quot;&gt;0&lt;/span&gt;          77s   &lt;span class=&quot;token number&quot;&gt;10.244&lt;/span&gt;.2.5   kind-cluster-worker3   &lt;span class=&quot;token operator&quot;&gt;&amp;lt;&lt;/span&gt;none&lt;span class=&quot;token operator&quot;&gt;&gt;&lt;/span&gt;           &lt;span class=&quot;token operator&quot;&gt;&amp;lt;&lt;/span&gt;none&lt;span class=&quot;token operator&quot;&gt;&gt;&lt;/span&gt;
sample-rs-stvwv   &lt;span class=&quot;token number&quot;&gt;1&lt;/span&gt;/1     Running   &lt;span class=&quot;token number&quot;&gt;0&lt;/span&gt;          77s   &lt;span class=&quot;token number&quot;&gt;10.244&lt;/span&gt;.1.4   kind-cluster-worker2   &lt;span class=&quot;token operator&quot;&gt;&amp;lt;&lt;/span&gt;none&lt;span class=&quot;token operator&quot;&gt;&gt;&lt;/span&gt;           &lt;span class=&quot;token operator&quot;&gt;&amp;lt;&lt;/span&gt;none&lt;span class=&quot;token operator&quot;&gt;&gt;&lt;/span&gt;
sample-rs-zmdss   &lt;span class=&quot;token number&quot;&gt;1&lt;/span&gt;/1     Running   &lt;span class=&quot;token number&quot;&gt;0&lt;/span&gt;          77s   &lt;span class=&quot;token number&quot;&gt;10.244&lt;/span&gt;.3.6   kind-cluster-worker    &lt;span class=&quot;token operator&quot;&gt;&amp;lt;&lt;/span&gt;none&lt;span class=&quot;token operator&quot;&gt;&gt;&lt;/span&gt;           &lt;span class=&quot;token operator&quot;&gt;&amp;lt;&lt;/span&gt;none&lt;span class=&quot;token operator&quot;&gt;&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;h2&gt;5.3.2 파드 정지와 자동화된 복구&lt;/h2&gt;
&lt;p&gt;레플리카셋에서는 노드나 파드에 장애가 발생했을 때 지정한 파드 수를 유지하기 위해 다른 노드에서 파드를 기동시켜 주기 때문에 장애 시 많은 영향을 받지 않는다.&lt;/p&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;sh&quot;&gt;&lt;pre class=&quot;language-sh&quot;&gt;&lt;code class=&quot;language-sh&quot;&gt;&lt;span class=&quot;token comment&quot;&gt;# 파드 정지 (삭제)&lt;/span&gt;
&lt;span class=&quot;token comment&quot;&gt;# 실제 기동 중인 파드명을 지정&lt;/span&gt;
$ kubectl delete pod sample-rs-zmdss
pod &lt;span class=&quot;token string&quot;&gt;&quot;sample-rs-zmdss&quot;&lt;/span&gt; deleted

&lt;span class=&quot;token comment&quot;&gt;# 레플리카셋 목록 표시&lt;/span&gt;
$ kubectl get pods
NAME                READY   STATUS    RESTARTS        AGE
sample-rs-29nlp     &lt;span class=&quot;token number&quot;&gt;1&lt;/span&gt;/1     Running   &lt;span class=&quot;token number&quot;&gt;0&lt;/span&gt;               29s
sample-rs-h2nwl     &lt;span class=&quot;token number&quot;&gt;1&lt;/span&gt;/1     Running   &lt;span class=&quot;token number&quot;&gt;1&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;2m43s ago&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;   7d22h
sample-rs-stvwv     &lt;span class=&quot;token number&quot;&gt;1&lt;/span&gt;/1     Running   &lt;span class=&quot;token number&quot;&gt;1&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;2m43s ago&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;   7d22h

&lt;span class=&quot;token comment&quot;&gt;# 레플리카셋 상세 정보 표시&lt;/span&gt;
$ kubectl describe replicaset sample-rs
&lt;span class=&quot;token punctuation&quot;&gt;..&lt;/span&gt;.
Events:
  Type    Reason            Age    From                   Message
  ----    ------            ----   ----                   -------
  Normal  SuccessfulCreate  7d22h  replicaset-controller  Created pod: sample-rs-zmdss
  Normal  SuccessfulCreate  7d22h  replicaset-controller  Created pod: sample-rs-stvwv
  Normal  SuccessfulCreate  7d22h  replicaset-controller  Created pod: sample-rs-h2nwl
  Normal  SuccessfulCreate  2m33s  replicaset-controller  Created pod: sample-rs-29nlp&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;h2&gt;5.3.3 레플리카 셋과 레이블&lt;/h2&gt;
&lt;p&gt;레플리카셋은 쿠버네티스가 파드를 모니터링하여 파드 수를 조정한다. 모니터링은 특정 레이블을 가진 파드 수를 계산하는 형태로 이루어진다. 레플리카 수가 부족한 경우 매니페스트에 기술된 &lt;code class=&quot;language-text&quot;&gt;spec.template&lt;/code&gt;로 파드를 생성하고 레플리카 수가 많을 경우 레이블이 일치하는 파드 중 하나를 삭제한다. 어떤 레이블을 가진 파드를 계산할지는 다음과 같이 &lt;code class=&quot;language-text&quot;&gt;spec.selector&lt;/code&gt; 부분에 저장한다. &lt;code class=&quot;language-text&quot;&gt;spec.selector&lt;/code&gt;와 &lt;code class=&quot;language-text&quot;&gt;spec.template.metadata.labels&lt;/code&gt;의 레이블이 일치해야 정상적으로 레플리카 셋이 생성된다.&lt;/p&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;yaml&quot;&gt;&lt;pre class=&quot;language-yaml&quot;&gt;&lt;code class=&quot;language-yaml&quot;&gt;&lt;span class=&quot;token key atrule&quot;&gt;selector&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt;
  &lt;span class=&quot;token key atrule&quot;&gt;matchLabel&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt;
    &lt;span class=&quot;token key atrule&quot;&gt;app&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt; sample&lt;span class=&quot;token punctuation&quot;&gt;-&lt;/span&gt;app&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;sh&quot;&gt;&lt;pre class=&quot;language-sh&quot;&gt;&lt;code class=&quot;language-sh&quot;&gt;&lt;span class=&quot;token comment&quot;&gt;# 레이블 sample-app의 레플리카 수가 3인 레플리카 셋을 생성&lt;/span&gt;
$ kubectl apply &lt;span class=&quot;token parameter variable&quot;&gt;-f&lt;/span&gt; sample-rs.yaml

&lt;span class=&quot;token comment&quot;&gt;# 레이블 sample-app을 가진 파드 생성&lt;/span&gt;
$ kubectl apply &lt;span class=&quot;token parameter variable&quot;&gt;-f&lt;/span&gt; sample-rs-pod.yaml

&lt;span class=&quot;token comment&quot;&gt;# 상태 확인&lt;/span&gt;
$ kubectl get pods &lt;span class=&quot;token parameter variable&quot;&gt;-L&lt;/span&gt; app
NAME              READY   STATUS        RESTARTS      AGE
sample-pod        &lt;span class=&quot;token number&quot;&gt;1&lt;/span&gt;/1     Running       &lt;span class=&quot;token number&quot;&gt;7&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;35m ago&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;   21d
sample-rs-29nlp   &lt;span class=&quot;token number&quot;&gt;1&lt;/span&gt;/1     Running       &lt;span class=&quot;token number&quot;&gt;0&lt;/span&gt;             33m
sample-rs-h2nwl   &lt;span class=&quot;token number&quot;&gt;1&lt;/span&gt;/1     Running       &lt;span class=&quot;token number&quot;&gt;1&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;35m ago&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;   7d22h
sample-rs-pod     &lt;span class=&quot;token number&quot;&gt;0&lt;/span&gt;/1     Terminating   &lt;span class=&quot;token number&quot;&gt;0&lt;/span&gt;             3s
sample-rs-stvwv   &lt;span class=&quot;token number&quot;&gt;1&lt;/span&gt;/1     Running       &lt;span class=&quot;token number&quot;&gt;1&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;35m ago&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;   7d22h&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;h2&gt;5.3.4 레플리카셋과 스케일링&lt;/h2&gt;
&lt;p&gt;레플리카 셋 설정을 변경하여 파드 수를 변경할 수 있다.&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;매니페스트를 수정하여 &lt;code class=&quot;language-text&quot;&gt;kubectl apply -f&lt;/code&gt; 명령어 사용&lt;/li&gt;
&lt;li&gt;&lt;code class=&quot;language-text&quot;&gt;kubectl scale&lt;/code&gt; 명령어 사용&lt;/li&gt;
&lt;/ul&gt;
&lt;h3&gt;수정한 매니페스트로 kubectl apply 명령어를 실행하는 경우&lt;/h3&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;sh&quot;&gt;&lt;pre class=&quot;language-sh&quot;&gt;&lt;code class=&quot;language-sh&quot;&gt;&lt;span class=&quot;token comment&quot;&gt;# 레플리카 수를 3에서 4로 변경한 매니페스트를 apply&lt;/span&gt;
$ &lt;span class=&quot;token function&quot;&gt;sed&lt;/span&gt; &lt;span class=&quot;token parameter variable&quot;&gt;-i&lt;/span&gt; &lt;span class=&quot;token parameter variable&quot;&gt;-e&lt;/span&gt; &lt;span class=&quot;token string&quot;&gt;&apos;s|replicas: 3|replicas: 4|&apos;&lt;/span&gt; sample-rs.yaml
$ kubectl apply &lt;span class=&quot;token parameter variable&quot;&gt;-f&lt;/span&gt; sample-rs.yaml
replicaset.apps/sample-rs configured

$ kubectl get pods
NAME              READY   STATUS    RESTARTS      AGE
sample-pod        &lt;span class=&quot;token number&quot;&gt;1&lt;/span&gt;/1     Running   &lt;span class=&quot;token number&quot;&gt;7&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;42m ago&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;   21d
sample-rs-29nlp   &lt;span class=&quot;token number&quot;&gt;1&lt;/span&gt;/1     Running   &lt;span class=&quot;token number&quot;&gt;0&lt;/span&gt;             40m
sample-rs-h2nwl   &lt;span class=&quot;token number&quot;&gt;1&lt;/span&gt;/1     Running   &lt;span class=&quot;token number&quot;&gt;1&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;42m ago&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;   7d22h
sample-rs-pc5xx   &lt;span class=&quot;token number&quot;&gt;1&lt;/span&gt;/1     Running   &lt;span class=&quot;token number&quot;&gt;0&lt;/span&gt;             52s
sample-rs-stvwv   &lt;span class=&quot;token number&quot;&gt;1&lt;/span&gt;/1     Running   &lt;span class=&quot;token number&quot;&gt;1&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;42m ago&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;   7d22h&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;h3&gt;kubectl scale 명령어를 사용하는 경우&lt;/h3&gt;
&lt;p&gt;두 번재 방법은 &lt;code class=&quot;language-text&quot;&gt;kubectl scale&lt;/code&gt; 명령어를 사용하여 스케일링 하는 방법이다. &lt;code class=&quot;language-text&quot;&gt;scale&lt;/code&gt; 명령어를 사용한 스케일 처리는 레플리카셋 이외에도 레플리케이션 컨트롤러/디플로이먼트/스테이트풀셋/잡/크론잡에서 사용할 수 있다.&lt;/p&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;sh&quot;&gt;&lt;pre class=&quot;language-sh&quot;&gt;&lt;code class=&quot;language-sh&quot;&gt;&lt;span class=&quot;token comment&quot;&gt;# 레플리카 수를 5로 변경&lt;/span&gt;
$ kubectl scale replicaset sample-rs &lt;span class=&quot;token parameter variable&quot;&gt;--replicas&lt;/span&gt; &lt;span class=&quot;token number&quot;&gt;5&lt;/span&gt;
replicaset.apps/sample-rs scaled

$ get pods &lt;span class=&quot;token parameter variable&quot;&gt;-l&lt;/span&gt; app
NAME              READY   STATUS    RESTARTS      AGE
sample-rs-29nlp   &lt;span class=&quot;token number&quot;&gt;1&lt;/span&gt;/1     Running   &lt;span class=&quot;token number&quot;&gt;0&lt;/span&gt;             46m
sample-rs-h2nwl   &lt;span class=&quot;token number&quot;&gt;1&lt;/span&gt;/1     Running   &lt;span class=&quot;token number&quot;&gt;1&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;48m ago&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;   7d23h
sample-rs-pc5xx   &lt;span class=&quot;token number&quot;&gt;1&lt;/span&gt;/1     Running   &lt;span class=&quot;token number&quot;&gt;0&lt;/span&gt;             7m9s
sample-rs-rld68   &lt;span class=&quot;token number&quot;&gt;1&lt;/span&gt;/1     Running   &lt;span class=&quot;token number&quot;&gt;0&lt;/span&gt;             22s
sample-rs-stvwv   &lt;span class=&quot;token number&quot;&gt;1&lt;/span&gt;/1     Running   &lt;span class=&quot;token number&quot;&gt;1&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;48m ago&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;   7d23h&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;h2&gt;5.3.5 일치성 기준 조건과 집합성 기준 조건&lt;/h2&gt;
&lt;p&gt;서비스 중단 예정인 레플리케이션 컨트롤러의 셀렉터는 일치성 기준 셀렉터였지만, 레플리카셋에서는 집합성 기준 셀렉터를 사용하여 더 유연하게 제어가 가능하다.&lt;/p&gt;
&lt;table&gt;
&lt;thead&gt;
&lt;tr&gt;
&lt;th&gt;조건&lt;/th&gt;
&lt;th&gt;개요&lt;/th&gt;
&lt;/tr&gt;
&lt;/thead&gt;
&lt;tbody&gt;
&lt;tr&gt;
&lt;td&gt;일치성 기준&lt;/td&gt;
&lt;td&gt;조건부에 일치 불일치(=, !=) 조건 지정&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;집합성 기준&lt;/td&gt;
&lt;td&gt;조건부에 일치 불일치(=, !=) 조건 지정과 집합(in, notin, exists) 조건 지정 가능&lt;/td&gt;
&lt;/tr&gt;
&lt;/tbody&gt;
&lt;/table&gt;
&lt;p&gt;일치성 기준 조건에서는 앞서 사용한 label 예시처럼, &lt;code class=&quot;language-text&quot;&gt;app=sample-app&lt;/code&gt;과 같이 지정한다. 집합성 기준 조건에서는 일치성 기준 조건과 함께 집합 조건을 지정할 수 있다. &lt;code class=&quot;language-text&quot;&gt;env In [deployment,staging]&lt;/code&gt;과 같이 지정할 수 있다.&lt;/p&gt;</content:encoded></item><item><title><![CDATA[[쿠버네티스 완벽 가이드] 07. 워크로드 API 카테고리 (1) - 파드(Pod)]]></title><description><![CDATA[5.1 워크로드 API 카테고리란? 다음으로는 쿠버네티스 리소스 중 한 가지인 워크로드 API 카테고리의 리소스들에 대해 살펴보겠다. 워크로드 API…]]></description><link>https://github.com/SiverPineValley/SiverPineValley.github.io/kubernetes/kubernetes_5_1/</link><guid isPermaLink="false">https://github.com/SiverPineValley/SiverPineValley.github.io/kubernetes/kubernetes_5_1/</guid><pubDate>Sat, 13 Aug 2022 18:00:00 GMT</pubDate><content:encoded>&lt;h1&gt;5.1 워크로드 API 카테고리란?&lt;/h1&gt;
&lt;p&gt;다음으로는 쿠버네티스 리소스 중 한 가지인 워크로드 API 카테고리의 리소스들에 대해 살펴보겠다. 워크로드 API 카테고리로 분류된 리소스는 클러스터에 컨테이너를 기동시키기 위해 사용되는 리소스이다. 내부에서 사용되는 리소스를 제외하고, 사용자가 직접 사용하는 리소스는 총 여덟가지 이다. 각 리소스는 파드를 최소 단위로 하여 그것을 관리하는 상위 리소스가 있는 부모 자식 관계로 되어 있다.&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;파드&lt;/li&gt;
&lt;li&gt;레플리케이션 컨트롤러&lt;/li&gt;
&lt;li&gt;레플리카 셋&lt;/li&gt;
&lt;li&gt;디플로이먼트&lt;/li&gt;
&lt;li&gt;데몬 셋&lt;/li&gt;
&lt;li&gt;스테이트풀 셋&lt;/li&gt;
&lt;li&gt;잡&lt;/li&gt;
&lt;li&gt;크론 잡&lt;/li&gt;
&lt;/ul&gt;
&lt;h1&gt;5.2 파드(Pod)&lt;/h1&gt;
&lt;p&gt;워크로드 리소스의 최소 단위는 &apos;파드&apos;라고 불리는 리소스이다. 파드는 한 개 이상의 컨테이너로 구성되어 있으며, 같은 파드에 포함된 컨테이너들은 네트워크적으로 격리되어 있지 않고 IP주소를 공유한다. 따라서, 파드 내부의 컨테이너들은 서로 localhost로 통신할 수 있다. 대부분의 경우 하나의 파드에 하나의 컨테이너를 가지지만, 메인 컨테이너와 서브 컨테이너 등 여러 컨테이너를 가질 수 있다. 서브 컨테이너에는 프록시 역할을 하는 컨테이너, 설정값을 동적으로 변화시키는 컨테이너, 로컬 캐시용 컨테이너, SSL용 컨테이너 등을 예로 들 수 있다.&lt;/p&gt;
&lt;h2&gt;5.2.1 파드 디자인 패턴&lt;/h2&gt;
&lt;p&gt;파드 디자인 패턴에는 크게 세 종류가 있다.&lt;/p&gt;
&lt;table&gt;
&lt;thead&gt;
&lt;tr&gt;
&lt;th&gt;종류&lt;/th&gt;
&lt;th&gt;내용&lt;/th&gt;
&lt;/tr&gt;
&lt;/thead&gt;
&lt;tbody&gt;
&lt;tr&gt;
&lt;td&gt;사이드카 패턴(sidecar pattern)&lt;/td&gt;
&lt;td&gt;메인 컨테이너에 기능을 추가한다.&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;앰배서더 패턴(ambassador pattern)&lt;/td&gt;
&lt;td&gt;외부 시스템과의 통신을 중계한다.&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;어댑터 패턴(adapter pattern)&lt;/td&gt;
&lt;td&gt;외부 접속을 위한 인터페이스를 제공한다.&lt;/td&gt;
&lt;/tr&gt;
&lt;/tbody&gt;
&lt;/table&gt;
&lt;h3&gt;사이드카 패턴&lt;/h3&gt;
&lt;p&gt;사이드카 패턴은 메인 컨테이너 외에 보조적인 기능을 추가하는 서브 컨테이너를 포함하는 패턴이다. &lt;code class=&quot;language-text&quot;&gt;특정 변경 사항을 감지하여 동적으로 설정을 변경하는 컨테이너&lt;/code&gt;, &lt;code class=&quot;language-text&quot;&gt;깃 저장소와 로컬 스토리지를 동기화하는 컨테이너&lt;/code&gt;, &lt;code class=&quot;language-text&quot;&gt;애플리케이션의 로그 파일을 오브젝트 스토리지로 전송하는 컨테이너&lt;/code&gt; 라는 구성이 자주 사용된다. 파드는 데이터 영역을 공유하고 가지고 있을 수 있기 때문에 데이터와 설정에 관련된 패턴이라고 볼 수 있다.&lt;/p&gt;
&lt;h3&gt;앰배서더 패턴&lt;/h3&gt;
&lt;p&gt;앰배서더 패턴은 메인 컨테이너가 외부 시스템과 접속할 때 중계하는 역할을 하는 서브 컨테이너이다. 파드에 두 개의 컨테이너가 있어 메인 컨테이너에서 목적지에 localhost를 지정하여 앰버서더 컨테이너로 접속할 수 있다. 앰배서더 컨테이너를 사용하여 외부 시스템과 통신하면 단일 데이터베이스를 사용하거나 샤딩된 분산 데이터베이스를 사용하는 환경 모두에서 특별한 변경 사항 없이 애플리케이션을 느슨한 결합을 유지하며 사용할 수 있다.&lt;/p&gt;
&lt;h3&gt;어댑터 패턴&lt;/h3&gt;
&lt;p&gt;어댑터 패턴은 서로 다른 데이터 형식을 변환해주는 컨테이너 패턴이다. 예를 들어, 프로메테우스 등의 모니터링 소프트웨어에서는 정의된 형식으로 메트릭을 수집해야 한다. 그러나 대부분의 미들웨어가 제공하는 메트릭 출력 형식은 프로메테우스 메트릭 형식을 지원하지 않는다. 따라서 이러한 경우 어댑터 컨테이너를 사용하면 외부 요청에 맞게 데이터 형식으로 변환하고 데이터를 반환해준다.&lt;/p&gt;
&lt;h2&gt;5.2.2 파드 생성&lt;/h2&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;sh&quot;&gt;&lt;pre class=&quot;language-sh&quot;&gt;&lt;code class=&quot;language-sh&quot;&gt;&lt;span class=&quot;token comment&quot;&gt;# 파드 생성&lt;/span&gt;
$ kubectl apply &lt;span class=&quot;token parameter variable&quot;&gt;-f&lt;/span&gt; sample-pod.yaml
pod/sample-pod created

&lt;span class=&quot;token comment&quot;&gt;# 파드 조회&lt;/span&gt;
$ kubectl get pods
NAME         READY   STATUS    RESTARTS      AGE
sample-pod   &lt;span class=&quot;token number&quot;&gt;1&lt;/span&gt;/1     Running   &lt;span class=&quot;token number&quot;&gt;6&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;20m ago&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;   12d&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;h2&gt;5.2.3 두 개의 컨테이너를 포함한 파드 새엇ㅇ&lt;/h2&gt;
&lt;p&gt;아래의 매니페스트는 nginx와 redis라는 두 개의 컨테이너를 가진 예제이다. redis는 6379/TCP 포트를 바인드한다.&lt;/p&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;yaml&quot;&gt;&lt;pre class=&quot;language-yaml&quot;&gt;&lt;code class=&quot;language-yaml&quot;&gt;&lt;span class=&quot;token key atrule&quot;&gt;apiVersion&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt; v1
&lt;span class=&quot;token key atrule&quot;&gt;kind&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt; Pod
&lt;span class=&quot;token key atrule&quot;&gt;metadata&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt;
  &lt;span class=&quot;token key atrule&quot;&gt;name&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt; sample&lt;span class=&quot;token punctuation&quot;&gt;-&lt;/span&gt;2pod
&lt;span class=&quot;token key atrule&quot;&gt;spec&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt;
  &lt;span class=&quot;token key atrule&quot;&gt;containers&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt;
    &lt;span class=&quot;token punctuation&quot;&gt;-&lt;/span&gt; &lt;span class=&quot;token key atrule&quot;&gt;name&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt; nginx&lt;span class=&quot;token punctuation&quot;&gt;-&lt;/span&gt;container
      &lt;span class=&quot;token key atrule&quot;&gt;image&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt; nginx&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt;&lt;span class=&quot;token number&quot;&gt;1.12&lt;/span&gt;
    &lt;span class=&quot;token punctuation&quot;&gt;-&lt;/span&gt; &lt;span class=&quot;token key atrule&quot;&gt;name&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt; redis&lt;span class=&quot;token punctuation&quot;&gt;-&lt;/span&gt;container
      &lt;span class=&quot;token key atrule&quot;&gt;image&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt; redis&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt;&lt;span class=&quot;token number&quot;&gt;3.2&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;sh&quot;&gt;&lt;pre class=&quot;language-sh&quot;&gt;&lt;code class=&quot;language-sh&quot;&gt;&lt;span class=&quot;token comment&quot;&gt;# 파드 생성&lt;/span&gt;
$ kubectl apply &lt;span class=&quot;token parameter variable&quot;&gt;-f&lt;/span&gt; sample-2pod.yaml
pod/sample-2pod created

&lt;span class=&quot;token comment&quot;&gt;# 두 개의 컨테이너를 포함한 파드 확인&lt;/span&gt;
$ kubetl get pod &lt;span class=&quot;token parameter variable&quot;&gt;-o&lt;/span&gt; wide
NAME          READY   STATUS    RESTARTS      AGE   IP           NODE                   NOMINATED NODE   READINESS GATES
sample-2pod   &lt;span class=&quot;token number&quot;&gt;2&lt;/span&gt;/2     Running   &lt;span class=&quot;token number&quot;&gt;0&lt;/span&gt;             65s   &lt;span class=&quot;token number&quot;&gt;10.244&lt;/span&gt;.3.2   kind-cluster-worker    &lt;span class=&quot;token operator&quot;&gt;&amp;lt;&lt;/span&gt;none&lt;span class=&quot;token operator&quot;&gt;&gt;&lt;/span&gt;           &lt;span class=&quot;token operator&quot;&gt;&amp;lt;&lt;/span&gt;none&lt;span class=&quot;token operator&quot;&gt;&gt;&lt;/span&gt;
sample-pod    &lt;span class=&quot;token number&quot;&gt;1&lt;/span&gt;/1     Running   &lt;span class=&quot;token number&quot;&gt;6&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;21m ago&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;   12d   &lt;span class=&quot;token number&quot;&gt;10.244&lt;/span&gt;.1.2   kind-cluster-worker2   &lt;span class=&quot;token operator&quot;&gt;&amp;lt;&lt;/span&gt;none&lt;span class=&quot;token operator&quot;&gt;&gt;&lt;/span&gt;           &lt;span class=&quot;token operator&quot;&gt;&amp;lt;&lt;/span&gt;none&lt;span class=&quot;token operator&quot;&gt;&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;파드는 네트워크 네임스페이스를 공유하고 있으므로 (같은 IP 내에서 동작하므로), 같은 포트를 여러 개를 동시에 사용할 수 없다. 파드 내에서는 &lt;code class=&quot;language-text&quot;&gt;containerPort&lt;/code&gt;가 충돌하지 않도록 주의해야 한다.&lt;/p&gt;
&lt;h2&gt;5.2.4 컨테이너 로그인과 명령어 실행&lt;/h2&gt;
&lt;p&gt;컨테이너 로그인이란 가상 터미널을 생성(-t)하고, 표준 입력을 패스 스루(-i)하면서 /bin/sh를 실행하면 마치 컨테이너에 SSH로 로그인한 상태가 된다. 실제로 컨테이너에 로그인하여 확인하려면 &lt;code class=&quot;language-text&quot;&gt;kubectl exec -it (pod명) -c (컨테이너명) -- /bin/bash&lt;/code&gt;를 실행해야 한다.&lt;/p&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;sh&quot;&gt;&lt;pre class=&quot;language-sh&quot;&gt;&lt;code class=&quot;language-sh&quot;&gt;&lt;span class=&quot;token comment&quot;&gt;# 컨테이너에 로그인하여 /bin/bash 실행&lt;/span&gt;
$ kubectl &lt;span class=&quot;token builtin class-name&quot;&gt;exec&lt;/span&gt; &lt;span class=&quot;token parameter variable&quot;&gt;-it&lt;/span&gt; sample-pod &lt;span class=&quot;token parameter variable&quot;&gt;-c&lt;/span&gt; nginx-continer -- /bin/bash

&lt;span class=&quot;token comment&quot;&gt;# 확인 작업에 필요한 패키지 설치&lt;/span&gt;
root@sample-pod:/&lt;span class=&quot;token comment&quot;&gt;# (이후부터는 컨테이너 내부에서 명령어 실행 가능)&lt;/span&gt;
$ &lt;span class=&quot;token function&quot;&gt;apt&lt;/span&gt; update &lt;span class=&quot;token operator&quot;&gt;&amp;amp;&amp;amp;&lt;/span&gt; &lt;span class=&quot;token function&quot;&gt;apt&lt;/span&gt; &lt;span class=&quot;token parameter variable&quot;&gt;-y&lt;/span&gt; &lt;span class=&quot;token function&quot;&gt;install&lt;/span&gt; iproute2 procps

&lt;span class=&quot;token comment&quot;&gt;# 컨테이너 내부에서 IP 주소 확인&lt;/span&gt;
$ &lt;span class=&quot;token function&quot;&gt;ip&lt;/span&gt; a &lt;span class=&quot;token operator&quot;&gt;|&lt;/span&gt; &lt;span class=&quot;token function&quot;&gt;grep&lt;/span&gt; &lt;span class=&quot;token string&quot;&gt;&quot;inet &quot;&lt;/span&gt;

&lt;span class=&quot;token comment&quot;&gt;# 컨테이너 내부에 LISTEM 포트 확인&lt;/span&gt;
ss &lt;span class=&quot;token parameter variable&quot;&gt;-napt&lt;/span&gt; &lt;span class=&quot;token operator&quot;&gt;|&lt;/span&gt; &lt;span class=&quot;token function&quot;&gt;grep&lt;/span&gt; LISTEN

&lt;span class=&quot;token comment&quot;&gt;# 컨테이너 내부 프로세스 확인&lt;/span&gt;
$ &lt;span class=&quot;token function&quot;&gt;ps&lt;/span&gt; aux&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;h2&gt;5.2.5 ENTRYPOINT 명령/CMD 명령과 command/args&lt;/h2&gt;
&lt;p&gt;도커 파일로 이미지를 생성할 때는 ENTRYPOINT 명령과 CMD 명령을 사용하여 컨테이너 실행 시 명령어를 정의했다. 쿠버네티스에서는 도커용 용어와 다르게 ENTRYPOINT를 command, CMD를 agrs로 보른다. 컨테이너 실행 시 도커 이미지의 ENTRYPOINT와 CMD를 덮어 쓰기하려면 파드 내용 중 &lt;code class=&quot;language-text&quot;&gt;spec.containers[].command&lt;/code&gt;와 &lt;code class=&quot;language-text&quot;&gt;spec.containers[].args&lt;/code&gt;를 지정한다.&lt;/p&gt;
&lt;p&gt;아래 이미지를 생성해보면, 컨테이너 내부에서 &lt;code class=&quot;language-text&quot;&gt;/bin/sleep 3600&lt;/code&gt;이 실행 중인지 확인해볼 수 있다.&lt;/p&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;yaml&quot;&gt;&lt;pre class=&quot;language-yaml&quot;&gt;&lt;code class=&quot;language-yaml&quot;&gt;&lt;span class=&quot;token key atrule&quot;&gt;apiVersion&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt; v1
&lt;span class=&quot;token key atrule&quot;&gt;kind&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt; Pod
&lt;span class=&quot;token key atrule&quot;&gt;metadata&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt;
  &lt;span class=&quot;token key atrule&quot;&gt;name&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt; sample&lt;span class=&quot;token punctuation&quot;&gt;-&lt;/span&gt;entrypoint
&lt;span class=&quot;token key atrule&quot;&gt;spec&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt;
  &lt;span class=&quot;token key atrule&quot;&gt;containers&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt;
    &lt;span class=&quot;token punctuation&quot;&gt;-&lt;/span&gt; &lt;span class=&quot;token key atrule&quot;&gt;name&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt; nginx&lt;span class=&quot;token punctuation&quot;&gt;-&lt;/span&gt;container&lt;span class=&quot;token punctuation&quot;&gt;-&lt;/span&gt;&lt;span class=&quot;token number&quot;&gt;112&lt;/span&gt;
      &lt;span class=&quot;token key atrule&quot;&gt;image&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt; nginx&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt;&lt;span class=&quot;token number&quot;&gt;1.16&lt;/span&gt;
      &lt;span class=&quot;token key atrule&quot;&gt;command&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;[&lt;/span&gt;&lt;span class=&quot;token string&quot;&gt;&quot;/bin/sleep&quot;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;]&lt;/span&gt; &lt;span class=&quot;token comment&quot;&gt;# ENTRYPOINT를 대체&lt;/span&gt;
      &lt;span class=&quot;token key atrule&quot;&gt;args&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;[&lt;/span&gt;&lt;span class=&quot;token string&quot;&gt;&quot;3600&quot;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;]&lt;/span&gt; &lt;span class=&quot;token comment&quot;&gt;# CMD를 대체&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;sh&quot;&gt;&lt;pre class=&quot;language-sh&quot;&gt;&lt;code class=&quot;language-sh&quot;&gt;&lt;span class=&quot;token comment&quot;&gt;# 파드 생성&lt;/span&gt;
$ kubectl apply &lt;span class=&quot;token parameter variable&quot;&gt;-f&lt;/span&gt; sample-entrypoint.yaml
pod/sample-entrypoint created

&lt;span class=&quot;token comment&quot;&gt;# bash 실행&lt;/span&gt;
$ kubectl &lt;span class=&quot;token builtin class-name&quot;&gt;exec&lt;/span&gt; &lt;span class=&quot;token parameter variable&quot;&gt;-it&lt;/span&gt; sample-entrypoint -- /bin/bash

&lt;span class=&quot;token comment&quot;&gt;# procps 설치&lt;/span&gt;
root@sample-entrypoint:/&lt;span class=&quot;token comment&quot;&gt;# apt update &amp;amp;&amp;amp; apt -y install procps&lt;/span&gt;

&lt;span class=&quot;token comment&quot;&gt;# 실행중인 프로세스 확인&lt;/span&gt;
root@sample-entrypoint:/&lt;span class=&quot;token comment&quot;&gt;# ps -ef&lt;/span&gt;
&lt;span class=&quot;token environment constant&quot;&gt;UID&lt;/span&gt;          PID    &lt;span class=&quot;token environment constant&quot;&gt;PPID&lt;/span&gt;  C STIME TTY          TIME CMD
root           &lt;span class=&quot;token number&quot;&gt;1&lt;/span&gt;       &lt;span class=&quot;token number&quot;&gt;0&lt;/span&gt;  &lt;span class=&quot;token number&quot;&gt;0&lt;/span&gt; 07:15 ?        00:00:00 /bin/sleep &lt;span class=&quot;token number&quot;&gt;3600&lt;/span&gt;
root          &lt;span class=&quot;token number&quot;&gt;10&lt;/span&gt;       &lt;span class=&quot;token number&quot;&gt;0&lt;/span&gt;  &lt;span class=&quot;token number&quot;&gt;0&lt;/span&gt; 07:15 pts/0    00:00:00 /bin/bash
root         &lt;span class=&quot;token number&quot;&gt;338&lt;/span&gt;      &lt;span class=&quot;token number&quot;&gt;10&lt;/span&gt;  &lt;span class=&quot;token number&quot;&gt;0&lt;/span&gt; 07:16 pts/0    00:00:00 &lt;span class=&quot;token function&quot;&gt;ps&lt;/span&gt; &lt;span class=&quot;token parameter variable&quot;&gt;-ef&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;h2&gt;5.2.6 파드명 제한&lt;/h2&gt;
&lt;p&gt;파드명에는 RFC1123의 호스트명 규약을 따른 명명 규칙이 있다.&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;이용 가능한 문자는 영문 소문자와 숫자&lt;/li&gt;
&lt;li&gt;이용 가능한 기호는 &apos;-&apos; 또는 &apos;.&apos;&lt;/li&gt;
&lt;li&gt;시작과 끝은 영문 소문자&lt;/li&gt;
&lt;/ul&gt;
&lt;h2&gt;5.2.7 호스트의 네트워크 구성을 사용한 파드 기동&lt;/h2&gt;
&lt;p&gt;쿠버네티스에서 기동한 파드에 할당된 IP 주소는 쿠버네티스 노드의 호스트 IP 주소와 범위가 달라 외부에서 볼 수 없는 IP 주소가 할당된다. 호스트의 네트워크를 사용하는 설정(&lt;code class=&quot;language-text&quot;&gt;spec.hostNetwork&lt;/code&gt;)을 활성화하면 호스트상에서 프로세스를 기동하는 것과 같은 네트워크 구성 (IP 주소, DNS 설정, host 설정 등)으로 파드를 기동시킬 수 있다. &lt;code class=&quot;language-text&quot;&gt;hostNetwork&lt;/code&gt;를 사용한 파드는 쿠버네티스 노드의 IP주소를 사용하는 관계로 포트 번호 충돌을 방지하기 위해 기본적으로 사용하지 않고, 차후 설명할 NodePort 서비스 등으로 해결할 수 있다. 사용할 때는 엣지 환경에서의 사용이나 호스트 측의 네트워크를 감시 또는 제어와 같은 특수 애플리케이션 환경 등에서만 사용하는게 바람직하다.&lt;/p&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;yaml&quot;&gt;&lt;pre class=&quot;language-yaml&quot;&gt;&lt;code class=&quot;language-yaml&quot;&gt;&lt;span class=&quot;token key atrule&quot;&gt;apiVersion&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt; v1
&lt;span class=&quot;token key atrule&quot;&gt;kind&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt; Pod
&lt;span class=&quot;token key atrule&quot;&gt;metadata&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt;
  &lt;span class=&quot;token key atrule&quot;&gt;name&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt; sample&lt;span class=&quot;token punctuation&quot;&gt;-&lt;/span&gt;hostnetwork
&lt;span class=&quot;token key atrule&quot;&gt;spec&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt;
  &lt;span class=&quot;token key atrule&quot;&gt;hostNetwork&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;token boolean important&quot;&gt;true&lt;/span&gt;
  &lt;span class=&quot;token key atrule&quot;&gt;containers&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt;
  &lt;span class=&quot;token punctuation&quot;&gt;-&lt;/span&gt; &lt;span class=&quot;token key atrule&quot;&gt;name&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt; nginx&lt;span class=&quot;token punctuation&quot;&gt;-&lt;/span&gt;container
    &lt;span class=&quot;token key atrule&quot;&gt;image&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt; nginx&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt;&lt;span class=&quot;token number&quot;&gt;1.16&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;sh&quot;&gt;&lt;pre class=&quot;language-sh&quot;&gt;&lt;code class=&quot;language-sh&quot;&gt;&lt;span class=&quot;token comment&quot;&gt;# 파드의 IP 주소 확인&lt;/span&gt;
$ kubectl get pod sample-hostnetwork &lt;span class=&quot;token parameter variable&quot;&gt;-o&lt;/span&gt; wide
NAME                 READY   STATUS    RESTARTS   AGE   IP           NODE                  NOMINATED NODE   READINESS GATES
sample-hostnetwork   &lt;span class=&quot;token number&quot;&gt;1&lt;/span&gt;/1     Running   &lt;span class=&quot;token number&quot;&gt;0&lt;/span&gt;          50s   &lt;span class=&quot;token number&quot;&gt;172.18&lt;/span&gt;.0.5   kind-cluster-worker   &lt;span class=&quot;token operator&quot;&gt;&amp;lt;&lt;/span&gt;none&lt;span class=&quot;token operator&quot;&gt;&gt;&lt;/span&gt;           &lt;span class=&quot;token operator&quot;&gt;&amp;lt;&lt;/span&gt;none&lt;span class=&quot;token operator&quot;&gt;&gt;&lt;/span&gt;

&lt;span class=&quot;token comment&quot;&gt;# 파드가 기동 중인 노드의 IP 주소 확인&lt;/span&gt;
$ kubectl get &lt;span class=&quot;token function&quot;&gt;node&lt;/span&gt; kind-cluster-worker &lt;span class=&quot;token parameter variable&quot;&gt;-o&lt;/span&gt; wide
NAME                  STATUS   ROLES    AGE   VERSION   INTERNAL-IP   EXTERNAL-IP   OS-IMAGE       KERNEL-VERSION     CONTAINER-RUNTIME
kind-cluster-worker   Ready    &lt;span class=&quot;token operator&quot;&gt;&amp;lt;&lt;/span&gt;none&lt;span class=&quot;token operator&quot;&gt;&gt;&lt;/span&gt;   14d   v1.24.0   &lt;span class=&quot;token number&quot;&gt;172.18&lt;/span&gt;.0.5    &lt;span class=&quot;token operator&quot;&gt;&amp;lt;&lt;/span&gt;none&lt;span class=&quot;token operator&quot;&gt;&gt;&lt;/span&gt;        Ubuntu &lt;span class=&quot;token number&quot;&gt;21.10&lt;/span&gt;   &lt;span class=&quot;token number&quot;&gt;5.10&lt;/span&gt;.76-linuxkit   containerd://1.6.4

&lt;span class=&quot;token comment&quot;&gt;# 파드의 DNS 설정 확인&lt;/span&gt;
$ kubectl &lt;span class=&quot;token builtin class-name&quot;&gt;exec&lt;/span&gt; &lt;span class=&quot;token parameter variable&quot;&gt;-it&lt;/span&gt; sample-hostnetwork -- &lt;span class=&quot;token function&quot;&gt;cat&lt;/span&gt; /etc/resolv.conf
nameserver &lt;span class=&quot;token number&quot;&gt;192.168&lt;/span&gt;.65.2
options ndots:0&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;h2&gt;5.2.8 파드 DNS 설정과 서비스 디스커버리&lt;/h2&gt;
&lt;p&gt;DNS 서버에 관한 설정(&lt;code class=&quot;language-text&quot;&gt;dnsPolicy&lt;/code&gt;)은 파드 정의 &lt;code class=&quot;language-text&quot;&gt;spec.dnsPolicy&lt;/code&gt;에 설정한다. 설정할 수 있는 값은 아래 네 가지이다.&lt;/p&gt;
&lt;table&gt;
&lt;thead&gt;
&lt;tr&gt;
&lt;th&gt;설정값&lt;/th&gt;
&lt;th&gt;개요&lt;/th&gt;
&lt;/tr&gt;
&lt;/thead&gt;
&lt;tbody&gt;
&lt;tr&gt;
&lt;td&gt;ClusterFirst(기본값)&lt;/td&gt;
&lt;td&gt;클러스터 내부 DNS에 질의하여 해석되지 않으면 업스트림(upstream)에 질의한다.&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;None&lt;/td&gt;
&lt;td&gt;파드 정의 내에서 정적으로 설정한다.&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;Default&lt;/td&gt;
&lt;td&gt;파드가 구동하는 쿠버네티스 노드의 /etc/resolv.conf를 상속받는다.&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;ClusterFirstWithHostNet&lt;/td&gt;
&lt;td&gt;ClusterFirst의 동작과 같다(hostNetwork 사용 시 설정)&lt;/td&gt;
&lt;/tr&gt;
&lt;/tbody&gt;
&lt;/table&gt;
&lt;h3&gt;ClusterFirst(기본값)&lt;/h3&gt;
&lt;p&gt;일반적으로 파드는 클러스터 내부 DNS를 사용하여 이름을 해석한다. 이는 서비스 디스커버리나 클러스터 내부 로드밸런싱을 위함이다. &lt;code class=&quot;language-text&quot;&gt;dnsPolicy&lt;/code&gt;가 &lt;code class=&quot;language-text&quot;&gt;ClusterFirst&lt;/code&gt;인 경우 클러스터 내부의 DNS 서비스에 질의하고, 클러스터 내부 DNS에서 해석이 안 되는 도메인에 대해서는 업스트림 DNS 서버에 질의한다.&lt;/p&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;yaml&quot;&gt;&lt;pre class=&quot;language-yaml&quot;&gt;&lt;code class=&quot;language-yaml&quot;&gt;&lt;span class=&quot;token key atrule&quot;&gt;apiVersion&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt; v1
&lt;span class=&quot;token key atrule&quot;&gt;kind&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt; Pod
&lt;span class=&quot;token key atrule&quot;&gt;metadata&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt;
  &lt;span class=&quot;token key atrule&quot;&gt;name&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt; sample&lt;span class=&quot;token punctuation&quot;&gt;-&lt;/span&gt;dnspolicy&lt;span class=&quot;token punctuation&quot;&gt;-&lt;/span&gt;clusterfirst
&lt;span class=&quot;token key atrule&quot;&gt;spec&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt;
  &lt;span class=&quot;token key atrule&quot;&gt;dnsPolicy&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt; ClusterFirst
  &lt;span class=&quot;token key atrule&quot;&gt;containers&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt;
  &lt;span class=&quot;token punctuation&quot;&gt;-&lt;/span&gt; &lt;span class=&quot;token key atrule&quot;&gt;name&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt; nginx&lt;span class=&quot;token punctuation&quot;&gt;-&lt;/span&gt;container
    &lt;span class=&quot;token key atrule&quot;&gt;image&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt; nginx&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt;&lt;span class=&quot;token number&quot;&gt;1.16&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;sh&quot;&gt;&lt;pre class=&quot;language-sh&quot;&gt;&lt;code class=&quot;language-sh&quot;&gt;$ kubectl apply &lt;span class=&quot;token parameter variable&quot;&gt;-f&lt;/span&gt; sample-dnspolicy-clusterfirst.yaml
pod/sample-dnspolicy-clusterfirst created

$ kubectl &lt;span class=&quot;token builtin class-name&quot;&gt;exec&lt;/span&gt; &lt;span class=&quot;token parameter variable&quot;&gt;-it&lt;/span&gt; sample-dnspolicy-clusterfirst -- &lt;span class=&quot;token function&quot;&gt;cat&lt;/span&gt; /etc/resolv.conf
search default.svc.cluster.local svc.cluster.local cluster.local
nameserver &lt;span class=&quot;token number&quot;&gt;10.96&lt;/span&gt;.0.10
options ndots:5&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;h3&gt;None&lt;/h3&gt;
&lt;p&gt;DNS 서버를 수동으로 설정하려면 &lt;code class=&quot;language-text&quot;&gt;spec.dnsPolicy: None&lt;/code&gt;이라고 설정한 후 &lt;code class=&quot;language-text&quot;&gt;dnsConfig&lt;/code&gt;에 설정하고 싶은 값을 작성하면 된다. 정적으로 외부 DNS 서버만 설정하면 클러스터 내부 DNS를 사용한 서비스 디스커버리는 사용할 수 없게 된다.&lt;/p&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;yaml&quot;&gt;&lt;pre class=&quot;language-yaml&quot;&gt;&lt;code class=&quot;language-yaml&quot;&gt;&lt;span class=&quot;token key atrule&quot;&gt;apiVersion&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt; v1
&lt;span class=&quot;token key atrule&quot;&gt;kind&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt; Pod
&lt;span class=&quot;token key atrule&quot;&gt;metadata&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt;
  &lt;span class=&quot;token key atrule&quot;&gt;name&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt; sample&lt;span class=&quot;token punctuation&quot;&gt;-&lt;/span&gt;dnspolicy&lt;span class=&quot;token punctuation&quot;&gt;-&lt;/span&gt;none
&lt;span class=&quot;token key atrule&quot;&gt;spec&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt;
  &lt;span class=&quot;token key atrule&quot;&gt;dnsPolicy&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt; None
  &lt;span class=&quot;token key atrule&quot;&gt;dnsConfig&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt;
    &lt;span class=&quot;token key atrule&quot;&gt;nameservers&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt;
    &lt;span class=&quot;token punctuation&quot;&gt;-&lt;/span&gt; 8.8.8.8
    &lt;span class=&quot;token punctuation&quot;&gt;-&lt;/span&gt; 8.8.4.4
    &lt;span class=&quot;token key atrule&quot;&gt;searches&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt;
    &lt;span class=&quot;token punctuation&quot;&gt;-&lt;/span&gt; example.com
    &lt;span class=&quot;token key atrule&quot;&gt;options&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt;
    &lt;span class=&quot;token punctuation&quot;&gt;-&lt;/span&gt; &lt;span class=&quot;token key atrule&quot;&gt;name&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt; ndots
      &lt;span class=&quot;token key atrule&quot;&gt;value&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;token string&quot;&gt;&quot;5&quot;&lt;/span&gt;
  &lt;span class=&quot;token key atrule&quot;&gt;containers&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt;
  &lt;span class=&quot;token punctuation&quot;&gt;-&lt;/span&gt; &lt;span class=&quot;token key atrule&quot;&gt;name&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt; nginx&lt;span class=&quot;token punctuation&quot;&gt;-&lt;/span&gt;container
    &lt;span class=&quot;token key atrule&quot;&gt;image&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt; nginx&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt;&lt;span class=&quot;token number&quot;&gt;1.16&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;sh&quot;&gt;&lt;pre class=&quot;language-sh&quot;&gt;&lt;code class=&quot;language-sh&quot;&gt;$ kubectl &lt;span class=&quot;token builtin class-name&quot;&gt;exec&lt;/span&gt; &lt;span class=&quot;token parameter variable&quot;&gt;-it&lt;/span&gt; sample-dnspolicy-none -- &lt;span class=&quot;token function&quot;&gt;cat&lt;/span&gt; /etc/resolv
search example.com
nameserver &lt;span class=&quot;token number&quot;&gt;8.8&lt;/span&gt;.8.8
nameserver &lt;span class=&quot;token number&quot;&gt;8.8&lt;/span&gt;.4.4
options ndots:5&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;h2&gt;Default&lt;/h2&gt;
&lt;p&gt;쿠버네티스 노드의 DNS 설정을 그대로 상속받는 경우 &lt;code class=&quot;language-text&quot;&gt;spec.dnsPolicy: Default&lt;/code&gt;로 설정한다. dnsPolicy의 기본값은 Default가 아니므로 주의하자.&lt;/p&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;yaml&quot;&gt;&lt;pre class=&quot;language-yaml&quot;&gt;&lt;code class=&quot;language-yaml&quot;&gt;&lt;span class=&quot;token key atrule&quot;&gt;apiVersion&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt; v1
&lt;span class=&quot;token key atrule&quot;&gt;kind&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt; Pod
&lt;span class=&quot;token key atrule&quot;&gt;metadata&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt;
  &lt;span class=&quot;token key atrule&quot;&gt;name&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt; sample&lt;span class=&quot;token punctuation&quot;&gt;-&lt;/span&gt;dnspolicy&lt;span class=&quot;token punctuation&quot;&gt;-&lt;/span&gt;default
&lt;span class=&quot;token key atrule&quot;&gt;spec&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt;
  &lt;span class=&quot;token key atrule&quot;&gt;dnsPolicy&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt; Default
  &lt;span class=&quot;token key atrule&quot;&gt;containers&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt;
  &lt;span class=&quot;token punctuation&quot;&gt;-&lt;/span&gt; &lt;span class=&quot;token key atrule&quot;&gt;name&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt; nginx&lt;span class=&quot;token punctuation&quot;&gt;-&lt;/span&gt;container
    &lt;span class=&quot;token key atrule&quot;&gt;image&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt; nginx&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt;&lt;span class=&quot;token number&quot;&gt;1.16&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;sh&quot;&gt;&lt;pre class=&quot;language-sh&quot;&gt;&lt;code class=&quot;language-sh&quot;&gt;$ kubectl &lt;span class=&quot;token builtin class-name&quot;&gt;exec&lt;/span&gt; &lt;span class=&quot;token parameter variable&quot;&gt;-it&lt;/span&gt; sample-dnspolicy-none -- &lt;span class=&quot;token function&quot;&gt;cat&lt;/span&gt; /etc/resolv
nameserver &lt;span class=&quot;token number&quot;&gt;192.168&lt;/span&gt;.65.2
options ndots:0&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;h3&gt;ClusterFirstWithHostNet&lt;/h3&gt;
&lt;p&gt;&lt;code class=&quot;language-text&quot;&gt;hostNetwork&lt;/code&gt;를 사용한 파드에 클러스터 내부의 DNS를 참조하고 싶은 경우에는 &lt;code class=&quot;language-text&quot;&gt;spec.dnsPolicy: ClusterNetworkWithHostNet&lt;/code&gt;을 설정한다. &lt;code class=&quot;language-text&quot;&gt;hostNetwork&lt;/code&gt;를 사용하는 경우 기본값 ClusterFirst의 설정값은 무시되고 쿠버네티스 노드의 네트워크 설정(DNS 설정 포함)이 사용되기 때문에 명시적으로 &lt;code class=&quot;language-text&quot;&gt;ClusterFirstWithHostNet&lt;/code&gt;을 지정하도록 하자.&lt;/p&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;yaml&quot;&gt;&lt;pre class=&quot;language-yaml&quot;&gt;&lt;code class=&quot;language-yaml&quot;&gt;&lt;span class=&quot;token key atrule&quot;&gt;apiVersion&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt; v1
&lt;span class=&quot;token key atrule&quot;&gt;kind&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt; Pod
&lt;span class=&quot;token key atrule&quot;&gt;metadata&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt;
  &lt;span class=&quot;token key atrule&quot;&gt;name&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt; sample&lt;span class=&quot;token punctuation&quot;&gt;-&lt;/span&gt;dnspolicy&lt;span class=&quot;token punctuation&quot;&gt;-&lt;/span&gt;clusterfirstwithhostnet
&lt;span class=&quot;token key atrule&quot;&gt;spec&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt;
  &lt;span class=&quot;token key atrule&quot;&gt;dnsPolicy&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt; ClusterFirstWithHostNet
  &lt;span class=&quot;token key atrule&quot;&gt;hostNetwork&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;token boolean important&quot;&gt;true&lt;/span&gt;
  &lt;span class=&quot;token key atrule&quot;&gt;containers&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt;
  &lt;span class=&quot;token punctuation&quot;&gt;-&lt;/span&gt; &lt;span class=&quot;token key atrule&quot;&gt;name&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt; nginx&lt;span class=&quot;token punctuation&quot;&gt;-&lt;/span&gt;container
    &lt;span class=&quot;token key atrule&quot;&gt;image&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt; nginx&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt;&lt;span class=&quot;token number&quot;&gt;1.16&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;sh&quot;&gt;&lt;pre class=&quot;language-sh&quot;&gt;&lt;code class=&quot;language-sh&quot;&gt;&lt;span class=&quot;token comment&quot;&gt;# 경합하는 파드 삭제&lt;/span&gt;
$ kubectl delete pod sample-hostnetwork

&lt;span class=&quot;token comment&quot;&gt;# 컨테이너 내부의 DNS 설정 파일 &lt;/span&gt;
$ kubectl &lt;span class=&quot;token builtin class-name&quot;&gt;exec&lt;/span&gt; &lt;span class=&quot;token parameter variable&quot;&gt;-it&lt;/span&gt; sample-dnspolicy-clusterfirstwithhostnet -- &lt;span class=&quot;token function&quot;&gt;cat&lt;/span&gt; /etc/resolv.conf
search default.svc.cluster.local svc.cluster.local cluster.local
nameserver &lt;span class=&quot;token number&quot;&gt;10.96&lt;/span&gt;.0.10
options ndots:5&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;h2&gt;5.2.9 정적 호스트명 해석 설정: /etc/hosts&lt;/h2&gt;
&lt;p&gt;리눅스 운영체제에서는 DNS로 호스트명을 해석하기 전에 /etc/hosts 파일로 정적 호스트명을 해석한다. 쿠버네티스에서는 파드 내부 모든 컨테이너에 /etc/hosts를 변경하는 기능이 준비되어 있으며 &lt;code class=&quot;language-text&quot;&gt;spec.Aliases&lt;/code&gt;로 지정하여 사용할 수 있다.&lt;/p&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;yaml&quot;&gt;&lt;pre class=&quot;language-yaml&quot;&gt;&lt;code class=&quot;language-yaml&quot;&gt;&lt;span class=&quot;token key atrule&quot;&gt;apiVersion&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt; v1
&lt;span class=&quot;token key atrule&quot;&gt;kind&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt; Pod
&lt;span class=&quot;token key atrule&quot;&gt;metadata&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt;
  &lt;span class=&quot;token key atrule&quot;&gt;name&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt; sample&lt;span class=&quot;token punctuation&quot;&gt;-&lt;/span&gt;hostaliases
&lt;span class=&quot;token key atrule&quot;&gt;spec&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt;
  &lt;span class=&quot;token key atrule&quot;&gt;containers&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt;
    &lt;span class=&quot;token punctuation&quot;&gt;-&lt;/span&gt; &lt;span class=&quot;token key atrule&quot;&gt;name&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt; nginx&lt;span class=&quot;token punctuation&quot;&gt;-&lt;/span&gt;container
      &lt;span class=&quot;token key atrule&quot;&gt;image&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt; nginx&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt;&lt;span class=&quot;token number&quot;&gt;1.12&lt;/span&gt;
  &lt;span class=&quot;token key atrule&quot;&gt;hostAliases&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt;
  &lt;span class=&quot;token punctuation&quot;&gt;-&lt;/span&gt; &lt;span class=&quot;token key atrule&quot;&gt;ip&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt; 8.8.8.8
    &lt;span class=&quot;token key atrule&quot;&gt;hostnames&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt;
    &lt;span class=&quot;token punctuation&quot;&gt;-&lt;/span&gt; google&lt;span class=&quot;token punctuation&quot;&gt;-&lt;/span&gt;dns
    &lt;span class=&quot;token punctuation&quot;&gt;-&lt;/span&gt; google&lt;span class=&quot;token punctuation&quot;&gt;-&lt;/span&gt;public&lt;span class=&quot;token punctuation&quot;&gt;-&lt;/span&gt;dns&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;sh&quot;&gt;&lt;pre class=&quot;language-sh&quot;&gt;&lt;code class=&quot;language-sh&quot;&gt;$ kubectl &lt;span class=&quot;token builtin class-name&quot;&gt;exec&lt;/span&gt; &lt;span class=&quot;token parameter variable&quot;&gt;-it&lt;/span&gt; sample-hostaliases -- &lt;span class=&quot;token function&quot;&gt;cat&lt;/span&gt; /etc/hosts
&lt;span class=&quot;token comment&quot;&gt;# Kubernetes-managed hosts file.&lt;/span&gt;
&lt;span class=&quot;token number&quot;&gt;127.0&lt;/span&gt;.0.1	localhost
::1	localhost ip6-localhost ip6-loopback
fe00::0	ip6-localnet
fe00::0	ip6-mcastprefix
fe00::1	ip6-allnodes
fe00::2	ip6-allrouters
&lt;span class=&quot;token number&quot;&gt;10.244&lt;/span&gt;.3.5	sample-hostaliases

&lt;span class=&quot;token comment&quot;&gt;# Entries added by HostAliases.&lt;/span&gt;
&lt;span class=&quot;token number&quot;&gt;8.8&lt;/span&gt;.8.8	google-dns	google-public-dns&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;h2&gt;5.2.10 작업 디렉터리 설정&lt;/h2&gt;
&lt;p&gt;컨테이너에서 동작하는 애플리케이션의 작업 디렉터리(Working Directory)는 도커 파일의 WORKDIR 명령 설정을 따르지만, &lt;code class=&quot;language-text&quot;&gt;spec.containers[].workingDir&lt;/code&gt;로 덮어 쓸 수도 있다.&lt;/p&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;yaml&quot;&gt;&lt;pre class=&quot;language-yaml&quot;&gt;&lt;code class=&quot;language-yaml&quot;&gt;&lt;span class=&quot;token key atrule&quot;&gt;apiVersion&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt; v1
&lt;span class=&quot;token key atrule&quot;&gt;kind&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt; Pod
&lt;span class=&quot;token key atrule&quot;&gt;metadata&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt;
  &lt;span class=&quot;token key atrule&quot;&gt;name&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt; sample&lt;span class=&quot;token punctuation&quot;&gt;-&lt;/span&gt;workingdir
&lt;span class=&quot;token key atrule&quot;&gt;spec&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt;
  &lt;span class=&quot;token key atrule&quot;&gt;containers&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt;
  &lt;span class=&quot;token punctuation&quot;&gt;-&lt;/span&gt; &lt;span class=&quot;token key atrule&quot;&gt;name&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt; nginx&lt;span class=&quot;token punctuation&quot;&gt;-&lt;/span&gt;container
    &lt;span class=&quot;token key atrule&quot;&gt;image&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt; nginx&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt;&lt;span class=&quot;token number&quot;&gt;1.16&lt;/span&gt;
    &lt;span class=&quot;token key atrule&quot;&gt;workingDir&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt; /tmp&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;실제로 workingDir를 설정한 경우 프로세스가 실행되는 디렉터리가 변경된 것을 확인할 수 있다.&lt;/p&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;sh&quot;&gt;&lt;pre class=&quot;language-sh&quot;&gt;&lt;code class=&quot;language-sh&quot;&gt;&lt;span class=&quot;token comment&quot;&gt;# workingDir: 미지정&lt;/span&gt;
$ kubectl &lt;span class=&quot;token builtin class-name&quot;&gt;exec&lt;/span&gt; it sample-pod -- &lt;span class=&quot;token builtin class-name&quot;&gt;pwd&lt;/span&gt;
/

&lt;span class=&quot;token comment&quot;&gt;# workingDir: /tmp로 설정&lt;/span&gt;
$ kubectl &lt;span class=&quot;token builtin class-name&quot;&gt;exec&lt;/span&gt; &lt;span class=&quot;token parameter variable&quot;&gt;-it&lt;/span&gt; sample-workingdir -- &lt;span class=&quot;token builtin class-name&quot;&gt;pwd&lt;/span&gt;
/tmp&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;</content:encoded></item><item><title><![CDATA[[Linux] OS 확인 하는 법]]></title><description><![CDATA[리눅스는 오픈소스 답게 엄청나게 많은 대분류와 종류들이 있다. 서버 작업할 때 리눅스의 정확한 버전을 알기 어려울 때가 있는데, 아래의 방법들 중 하나를 사용하면 된다.
예시는 kubernetes nginx1.16 Offical…]]></description><link>https://github.com/SiverPineValley/SiverPineValley.github.io/linux/os/</link><guid isPermaLink="false">https://github.com/SiverPineValley/SiverPineValley.github.io/linux/os/</guid><pubDate>Sat, 13 Aug 2022 16:00:00 GMT</pubDate><content:encoded>&lt;p&gt;리눅스는 오픈소스 답게 엄청나게 많은 대분류와 종류들이 있다. 서버 작업할 때 리눅스의 정확한 버전을 알기 어려울 때가 있는데, 아래의 방법들 중 하나를 사용하면 된다.
예시는 kubernetes nginx1.16 Offical 컨테이너 이미지에서 사용하였다.&lt;/p&gt;
&lt;h2&gt;1. OS 커널 정보&lt;/h2&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;sh&quot;&gt;&lt;pre class=&quot;language-sh&quot;&gt;&lt;code class=&quot;language-sh&quot;&gt;$ &lt;span class=&quot;token function&quot;&gt;uname&lt;/span&gt; &lt;span class=&quot;token parameter variable&quot;&gt;-a&lt;/span&gt;
Linux sample-pod &lt;span class=&quot;token number&quot;&gt;5.10&lt;/span&gt;.76-linuxkit &lt;span class=&quot;token comment&quot;&gt;#1 SMP PREEMPT Mon Nov 8 11:22:26 UTC 2021 aarch64 GNU/Linux&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;h2&gt;2. 리눅스 버전 확인&lt;/h2&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;sh&quot;&gt;&lt;pre class=&quot;language-sh&quot;&gt;&lt;code class=&quot;language-sh&quot;&gt;&lt;span class=&quot;token comment&quot;&gt;# /etc/redhat-release&lt;/span&gt;
$ &lt;span class=&quot;token function&quot;&gt;cat&lt;/span&gt; /etc/redhat-release

&lt;span class=&quot;token comment&quot;&gt;# /etc/issue&lt;/span&gt;
$ &lt;span class=&quot;token function&quot;&gt;cat&lt;/span&gt; /etc/*issue*
Debian GNU/Linux &lt;span class=&quot;token number&quot;&gt;10&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;\&lt;/span&gt;n &lt;span class=&quot;token punctuation&quot;&gt;\&lt;/span&gt;l

Debian GNU/Linux &lt;span class=&quot;token number&quot;&gt;10&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;h2&gt;3. OS 비트 확인&lt;/h2&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;sh&quot;&gt;&lt;pre class=&quot;language-sh&quot;&gt;&lt;code class=&quot;language-sh&quot;&gt;$ getconf LONG_BIT
&lt;span class=&quot;token number&quot;&gt;64&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;</content:encoded></item><item><title><![CDATA[[쿠버네티스 완벽 가이드] 06. API 리소스와 kubectl (3)]]></title><description><![CDATA[4.5.6 매니페스트 파일 설계 지금까지는 kubectl…]]></description><link>https://github.com/SiverPineValley/SiverPineValley.github.io/kubernetes/kubernetes_4_3/</link><guid isPermaLink="false">https://github.com/SiverPineValley/SiverPineValley.github.io/kubernetes/kubernetes_4_3/</guid><pubDate>Sat, 06 Aug 2022 18:00:00 GMT</pubDate><content:encoded>&lt;h2&gt;4.5.6 매니페스트 파일 설계&lt;/h2&gt;
&lt;p&gt;지금까지는 kubectl로 &apos;한개 리소스가 정의된 한 개의 매니페스트 파일&apos;을 적용하는 예들이었다면 실제로는 한 개의 매니페스트 파일에 여러 개의 리소스를 정의하거나 여러 매니페스트 파일을 동시에 적용할 수도 있다.&lt;/p&gt;
&lt;h3&gt;하나의 매니페스트 파일에 여러 리소스 정의&lt;/h3&gt;
&lt;p&gt;매니페스트 파일에는 여러 리소스를 한 개의 매니페스트 파일에 정의할 수 있다. 따라서 어떤 서비스에서 사용할 여러 종류의 리소스를 한 개의 매니페스트 파일로 통합할 수 있다. 일반적인 사용 사례로는 &apos;파드를 기동하는 워크로드 API 카테고리의 리소스&apos;와 &apos;외부에 공개하는 서비스 API 카테고리의 리소스&apos;를 매니페스트에 통합하여 작성하는 방법을 생각해볼 수 있다. 이 경우 한 개의 매니페스트 파일로 서비스를 외부에 공개할 수 있게 된다. 실행 순서를 정확하게 지켜야 하거나 리소스 간 결합도를 높이고 싶다면 하나의 매니페스트로 관리하는 것이 좋을 수 있다.&lt;/p&gt;
&lt;p&gt;아래 매니페스트를 적용하면 위에서부터 리소스 순서대로 적용된다. 위에서 부터 차례대로 적용되지만, 중간에 에러가 발생하면 이후 정의된 리소스는 적용되지 않게 된다.&lt;/p&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;yaml&quot;&gt;&lt;pre class=&quot;language-yaml&quot;&gt;&lt;code class=&quot;language-yaml&quot;&gt;&lt;span class=&quot;token punctuation&quot;&gt;---&lt;/span&gt;
&lt;span class=&quot;token key atrule&quot;&gt;apiVersion&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt; apps/v1
&lt;span class=&quot;token key atrule&quot;&gt;kind&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt; Deployment
&lt;span class=&quot;token key atrule&quot;&gt;metadata&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt;
  &lt;span class=&quot;token key atrule&quot;&gt;name&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt; order1&lt;span class=&quot;token punctuation&quot;&gt;-&lt;/span&gt;deployment
&lt;span class=&quot;token key atrule&quot;&gt;spec&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt;
  &lt;span class=&quot;token key atrule&quot;&gt;replicas&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;token number&quot;&gt;3&lt;/span&gt;
  &lt;span class=&quot;token key atrule&quot;&gt;selector&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt;
    &lt;span class=&quot;token key atrule&quot;&gt;matchLabels&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt;
      &lt;span class=&quot;token key atrule&quot;&gt;app&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt; sample&lt;span class=&quot;token punctuation&quot;&gt;-&lt;/span&gt;app
  &lt;span class=&quot;token key atrule&quot;&gt;template&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt;
    &lt;span class=&quot;token key atrule&quot;&gt;metadata&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt;
      &lt;span class=&quot;token key atrule&quot;&gt;labels&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt;
        &lt;span class=&quot;token key atrule&quot;&gt;app&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt; sample&lt;span class=&quot;token punctuation&quot;&gt;-&lt;/span&gt;app
    &lt;span class=&quot;token key atrule&quot;&gt;spec&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt;
      &lt;span class=&quot;token key atrule&quot;&gt;containers&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt;
        &lt;span class=&quot;token punctuation&quot;&gt;-&lt;/span&gt; &lt;span class=&quot;token key atrule&quot;&gt;name&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt; nginx&lt;span class=&quot;token punctuation&quot;&gt;-&lt;/span&gt;container
          &lt;span class=&quot;token key atrule&quot;&gt;image&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt; nginx&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt;&lt;span class=&quot;token number&quot;&gt;1.12&lt;/span&gt;
          &lt;span class=&quot;token key atrule&quot;&gt;ports&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt;
            &lt;span class=&quot;token punctuation&quot;&gt;-&lt;/span&gt; &lt;span class=&quot;token key atrule&quot;&gt;containerPort&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;token number&quot;&gt;80&lt;/span&gt;
&lt;span class=&quot;token punctuation&quot;&gt;---&lt;/span&gt;
&lt;span class=&quot;token key atrule&quot;&gt;apiVersion&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt; v1
&lt;span class=&quot;token key atrule&quot;&gt;kind&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt; Service
&lt;span class=&quot;token key atrule&quot;&gt;metadata&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt;
  &lt;span class=&quot;token key atrule&quot;&gt;name&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt; order2&lt;span class=&quot;token punctuation&quot;&gt;-&lt;/span&gt;service
&lt;span class=&quot;token key atrule&quot;&gt;spec&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt;
  &lt;span class=&quot;token key atrule&quot;&gt;type&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt; LoadBalancer
  &lt;span class=&quot;token key atrule&quot;&gt;ports&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt;
    &lt;span class=&quot;token punctuation&quot;&gt;-&lt;/span&gt; &lt;span class=&quot;token key atrule&quot;&gt;name&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;token string&quot;&gt;&quot;http-port&quot;&lt;/span&gt;
      &lt;span class=&quot;token key atrule&quot;&gt;protocol&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;token string&quot;&gt;&quot;TCP&quot;&lt;/span&gt;
      &lt;span class=&quot;token key atrule&quot;&gt;port&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;token number&quot;&gt;8080&lt;/span&gt;
      &lt;span class=&quot;token key atrule&quot;&gt;targetPort&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;token number&quot;&gt;80&lt;/span&gt;
  &lt;span class=&quot;token key atrule&quot;&gt;selector&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt;
    &lt;span class=&quot;token key atrule&quot;&gt;app&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt; sample&lt;span class=&quot;token punctuation&quot;&gt;-&lt;/span&gt;app&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;h3&gt;여러 매니페스트 파일을 동시에 적용&lt;/h3&gt;
&lt;p&gt;여러 매니페스트 파일을 동시에 적용하려면 디렉터리 안에 적용하고 싶은 여러 매니페스트 파일을 배치해 두고 &lt;code class=&quot;language-text&quot;&gt;kubectl apply&lt;/code&gt; 명령어를 실행할 때 해당 디렉터리를 지정하면 된다. 파일명 순으로 매니페스트 파일이 순차적으로 적용되기 때문에 순서를 제어하고 싶을 때는 파일명 앞에 연번의 인덱스 번호 등을 지정하여 사용하면 된다. &lt;code class=&quot;language-text&quot;&gt;kubectl apply -f ./ -R&lt;/code&gt; 과 같이 &lt;code class=&quot;language-text&quot;&gt;-R&lt;/code&gt; 옵션을 사용하면 재귀적으로 디렉터리 안에 존재하는 매니페스트 파일들을 적용할 수도 있다.&lt;/p&gt;
&lt;h2&gt;4.5.7 어노테이션과 레이블&lt;/h2&gt;
&lt;p&gt;쿠버네티스에서는 각 리소스에 대해 어노테이션과 레이블이라는 메타데이터를 부여할 수 있다. 둘다 쿠버네티스가 리소스를 관리할 때 사용한다는 점에서 비슷하지만 용도가 조금 다르다. 어노테이션과 레이블은 &apos;[접두사]/키:값&apos; 으로 구성된다. 접두사 부분은 옵션으로, 지정하는 경우 DNS 서브 도메인 형식이어야 한다.&lt;/p&gt;
&lt;table&gt;
&lt;thead&gt;
&lt;tr&gt;
&lt;th&gt;명칭&lt;/th&gt;
&lt;th&gt;개요&lt;/th&gt;
&lt;/tr&gt;
&lt;/thead&gt;
&lt;tbody&gt;
&lt;tr&gt;
&lt;td&gt;어노테이션&lt;/td&gt;
&lt;td&gt;시스템 구성 요소가 사용하는 메타데이터&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;레이블&lt;/td&gt;
&lt;td&gt;리소스 관리에 사용되는 메타데이터&lt;/td&gt;
&lt;/tr&gt;
&lt;/tbody&gt;
&lt;/table&gt;
&lt;h3&gt;어노테이션&lt;/h3&gt;
&lt;p&gt;어노테이션(annotation)은 아래와 같이 &lt;code class=&quot;language-text&quot;&gt;metadate.annotations&lt;/code&gt;로 설정할 수 있는 메타데이터로, 리소스에 대한 메모라고 생각하면 된다. 어노테이션 자체는 단순히 key-value 값이므로, 어노테이션 값으로 어떤 처리를 하는 시스템 구성 요소가 없으면 아무 일도 일어나지 않는다. 리소스에 의미를 가지지 않는 메모를 하고 싶을 때도 사용할 수 있고, 값에 수치를 사용하는 경우에는 큰따옴표(&quot;&quot;)로 묶어야 한다.&lt;/p&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;yaml&quot;&gt;&lt;pre class=&quot;language-yaml&quot;&gt;&lt;code class=&quot;language-yaml&quot;&gt;&lt;span class=&quot;token key atrule&quot;&gt;apiVersion&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt; v1
&lt;span class=&quot;token key atrule&quot;&gt;kind&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt; Pod
&lt;span class=&quot;token key atrule&quot;&gt;metadata&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt;
  &lt;span class=&quot;token key atrule&quot;&gt;name&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt; sample&lt;span class=&quot;token punctuation&quot;&gt;-&lt;/span&gt;annotation
  &lt;span class=&quot;token key atrule&quot;&gt;annotations&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt;
    &lt;span class=&quot;token key atrule&quot;&gt;annotation1&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt; val1
    &lt;span class=&quot;token key atrule&quot;&gt;annotation2&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt; val2
&lt;span class=&quot;token key atrule&quot;&gt;spec&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt;
  &lt;span class=&quot;token key atrule&quot;&gt;containers&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt;
    &lt;span class=&quot;token punctuation&quot;&gt;-&lt;/span&gt; &lt;span class=&quot;token key atrule&quot;&gt;name&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt; nginx&lt;span class=&quot;token punctuation&quot;&gt;-&lt;/span&gt;container
      &lt;span class=&quot;token key atrule&quot;&gt;image&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt; nginx&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt;&lt;span class=&quot;token number&quot;&gt;1.12&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;kubectl을 통해서도 부여 가능하다.&lt;/p&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;sh&quot;&gt;&lt;pre class=&quot;language-sh&quot;&gt;&lt;code class=&quot;language-sh&quot;&gt;$ kubectl apply &lt;span class=&quot;token parameter variable&quot;&gt;-f&lt;/span&gt; sample-annotations.yaml

&lt;span class=&quot;token comment&quot;&gt;# 어노테이션 부여&lt;/span&gt;
$ kubectl annotate pods sample-annotation &lt;span class=&quot;token assign-left variable&quot;&gt;annotation3&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt;val3

&lt;span class=&quot;token comment&quot;&gt;# 어노테이션 부여 (덮어 쓰기)&lt;/span&gt;
$ kubectl annotate pods sample-annotation &lt;span class=&quot;token assign-left variable&quot;&gt;annotation3&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt;val-new &lt;span class=&quot;token parameter variable&quot;&gt;--overwrite&lt;/span&gt;

&lt;span class=&quot;token comment&quot;&gt;# 어노테이션 확인&lt;/span&gt;
$ kubectl get pods sample-annotation &lt;span class=&quot;token parameter variable&quot;&gt;-o&lt;/span&gt; json &lt;span class=&quot;token operator&quot;&gt;|&lt;/span&gt; jp .metadata.annotations

&lt;span class=&quot;token comment&quot;&gt;# 어노테이션 삭제&lt;/span&gt;
$ kubectl annotate pods sample-annotations annotations3-&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;어노테이션은 크게 다음과 같이 사용된다.&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;시스템 구성 요소를 위한 데이터 저장&lt;/li&gt;
&lt;li&gt;모든 환경에서 사용할 수 없는 설정&lt;/li&gt;
&lt;li&gt;정식으로 통합되기 전의 기능을 설정&lt;/li&gt;
&lt;/ul&gt;
&lt;h4&gt;시스템 구성 요소를 위한 데이터 저장&lt;/h4&gt;
&lt;p&gt;이전에 &lt;code class=&quot;language-text&quot;&gt;kubectl create&lt;/code&gt;을 쓰지 말고 &lt;code class=&quot;language-text&quot;&gt;kubectl apply&lt;/code&gt;를 사용해야 하는 이유를 설명했을 때 등장한 &lt;code class=&quot;language-text&quot;&gt;kubectl.kubernetes.io/last-applied-configuration&lt;/code&gt;도 어노테이션 중 하나이다. 이 어노테이션은 &apos;이전에 적용한 매니페스트&apos; 내용이 저장되어 있다. 이 어노테이션은 사용자가 따로 저장하는 것이 아니라 시스템 자체적으로 저장한 데이터이다.&lt;/p&gt;
&lt;h4&gt;모든 환경에서 사용할 수 없는 설정&lt;/h4&gt;
&lt;p&gt;쿠버네티스 클러스터의 파드에 대해 클러스터 외부에서 접속할 수 있도록 외부 로드 밸런서 등과 연계하는 서비스 리소스 등에서 사용된다. 서비스 리소스를 생성하면 GKE 에서는 Google Cloud Load Balancing(GCLB), EKS에서는 AWS Classic Load Balancer(CLB) 또는 Network Load Balancer(NLB)와 연계한다. 대부분의 경우 로드 밸런서와 연계하는 서비스 리소스는 외부에서 접속할 수 있도록 글로벌 IP 주소가 부여된 글로벌 엔드포인트가 생성된다. 그러나 GKE와 EKS는 어노테이션을 부여하면 로컬 IP 주소가 부여된 인터널 엔드포인트 생성도 가능하다.&lt;/p&gt;
&lt;h4&gt;정식으로 통합되기 전의 기능을 설정&lt;/h4&gt;
&lt;p&gt;최근에는 쿠버네티스 생태계가 많이 성숙한 덕분에 거의 보이지 않지만, 쿠버네티스에 공식적으로 통합되기 전의 실험적인 기능과 평가 중인 새로운 기능 설정을 어노테이션으로 사용하는 경우도 있다. 스토리지클래스(StorageClass)나 초기화 컨테이너(Init Container)등이 있다.&lt;/p&gt;
&lt;h3&gt;레이블&lt;/h3&gt;
&lt;p&gt;레이블은 &lt;code class=&quot;language-text&quot;&gt;metadata.labels&lt;/code&gt;에 설정할 수 있는 메타데이터다. 레이블은 리소스를 구분하기 위한 정보이다. 컨테이너는 하나의 프로세스와 같은 아주 작은 리소스이다. 파드도 여러 컨테이너로 이루어진 작은 리소스이다. 쿠버네티스는 파드와 같은 리소스를 대량으로 처리할 뿐만 아니라, 서비스, 인그레스, 컨피그맵, 시크릿 등등과 같은 리소스들도 처리한다. 레이블은 이러한 수 많은 리소스에 대해 동일한 레이블로 그룹핑하여 처리하거나 어떤 처리 조건으로 사용되기 때문에 리소스를 효율적으로 관리할 수 있는 구조를 가진다.&lt;/p&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;yaml&quot;&gt;&lt;pre class=&quot;language-yaml&quot;&gt;&lt;code class=&quot;language-yaml&quot;&gt;&lt;span class=&quot;token key atrule&quot;&gt;apiVersion&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt; v1
&lt;span class=&quot;token key atrule&quot;&gt;kind&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt; Pod
&lt;span class=&quot;token key atrule&quot;&gt;metadata&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt;
  &lt;span class=&quot;token key atrule&quot;&gt;name&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt; sample&lt;span class=&quot;token punctuation&quot;&gt;-&lt;/span&gt;label
  &lt;span class=&quot;token key atrule&quot;&gt;labels&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt;
    &lt;span class=&quot;token key atrule&quot;&gt;label1&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt; val1
    &lt;span class=&quot;token key atrule&quot;&gt;label2&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt; val2
&lt;span class=&quot;token key atrule&quot;&gt;spec&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt;
  &lt;span class=&quot;token key atrule&quot;&gt;containers&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt;
    &lt;span class=&quot;token punctuation&quot;&gt;-&lt;/span&gt; &lt;span class=&quot;token key atrule&quot;&gt;name&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt; nginx&lt;span class=&quot;token punctuation&quot;&gt;-&lt;/span&gt;container
      &lt;span class=&quot;token key atrule&quot;&gt;image&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt; nginx&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt;&lt;span class=&quot;token number&quot;&gt;1.12&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;매니페스트에 작성할 수도 있지만, kubectl에서 직접 부여할 수도 있다.&lt;/p&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;sh&quot;&gt;&lt;pre class=&quot;language-sh&quot;&gt;&lt;code class=&quot;language-sh&quot;&gt;&lt;span class=&quot;token comment&quot;&gt;# 레이블 부여&lt;/span&gt;
$ kubectl label pods sample-label &lt;span class=&quot;token assign-left variable&quot;&gt;label3&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt;val3

&lt;span class=&quot;token comment&quot;&gt;# 레이블 부여 (덮어 쓰기)&lt;/span&gt;
$ kubectl label pods sample-label &lt;span class=&quot;token assign-left variable&quot;&gt;label3&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt;val3-new &lt;span class=&quot;token parameter variable&quot;&gt;--overwrite&lt;/span&gt;

&lt;span class=&quot;token comment&quot;&gt;# 레이블 확인&lt;/span&gt;
$ kubectl get pods sample-label &lt;span class=&quot;token parameter variable&quot;&gt;-o&lt;/span&gt; json &lt;span class=&quot;token operator&quot;&gt;|&lt;/span&gt; jq .metadata.labels

&lt;span class=&quot;token comment&quot;&gt;# 레이블 삭제&lt;/span&gt;
$ kubectl label pods sample-label label3-&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;h4&gt;개발자가 사용하는 레이블&lt;/h4&gt;
&lt;p&gt;개발자가 많은 리소스를 효율적으로 관리하는 데 레이블은 정말 유용하게 사용된다. &lt;code class=&quot;language-text&quot;&gt;kubectl get -l&lt;/code&gt;과 같이 &lt;code class=&quot;language-text&quot;&gt;-l&lt;/code&gt; 옵션을 사용해서 특정 label이 있는 pod 들을 필터링하여 표시할 수 있다. &lt;code class=&quot;language-text&quot;&gt;-L&lt;/code&gt; 옵션은 해당 파드의 뒤에 입력된 label 값을 같이 표시해준다. &lt;code class=&quot;language-text&quot;&gt;--show-label&lt;/code&gt;은 모든 레이블을 표시할 때 사용된다.&lt;/p&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;sh&quot;&gt;&lt;pre class=&quot;language-sh&quot;&gt;&lt;code class=&quot;language-sh&quot;&gt;&lt;span class=&quot;token comment&quot;&gt;# label1=val1, label2 레이블을 가진 파드 표시&lt;/span&gt;
$ kubectl get pods &lt;span class=&quot;token parameter variable&quot;&gt;-l&lt;/span&gt; &lt;span class=&quot;token assign-left variable&quot;&gt;label1&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt;val1,label2

&lt;span class=&quot;token comment&quot;&gt;# 파드와 label1 레이블 표시&lt;/span&gt;
$ kubectl get pods &lt;span class=&quot;token parameter variable&quot;&gt;-L&lt;/span&gt; label1

&lt;span class=&quot;token comment&quot;&gt;# 모든 레이블 표시&lt;/span&gt;
$ kubectl get pods --show-labels&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;h4&gt;시스템이 사용하는 레이블&lt;/h4&gt;
&lt;p&gt;파드 수를 유지하는 리소스(ReplicaSet) 에서는 레이블에 부여된 파드 수를 계산하여 레플리카 수를 관리한다. 대상 파드 수가 레플리카 수의 설정보다 많으면 기존 파드 중 하나를 삭제하고, 부족하면 하나를 생성한다. 따라서 조건에 일치하는 파드를 별도로 생성하게 되면 기존 파드가 정지하는 경우가 발생할 수 있다. 마찬가지로, 외부 요청을 로드 밸런서로 받은 후에 파드로 전송하는 서비스 리소스(LoadBalancer)에서는 이 레이블을 기준으로 목적지 파드를 설정한다. 이 경우 실수로 레이블을 지정하게 되면 다른 파드에 트래픽이 전송되어 문제가 발생한다.&lt;/p&gt;
&lt;p&gt;레이블 키 이름에는 다음과 같이 권장되고 있다.&lt;/p&gt;
&lt;table&gt;
&lt;thead&gt;
&lt;tr&gt;
&lt;th&gt;레이블 키 이름&lt;/th&gt;
&lt;th&gt;개요&lt;/th&gt;
&lt;/tr&gt;
&lt;/thead&gt;
&lt;tbody&gt;
&lt;tr&gt;
&lt;td&gt;app.kubernetes.io/name&lt;/td&gt;
&lt;td&gt;애플리케이션 이름&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;app.kubernetes.io/version&lt;/td&gt;
&lt;td&gt;애플리케이션 버전&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;app.kubernetes.io/component&lt;/td&gt;
&lt;td&gt;애플리케이션 내 구성 요소&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;app.kubernetes.io/part-of&lt;/td&gt;
&lt;td&gt;애플리케이션이 전체적으로 구성하는 시스템 이름&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;app.kubernetes.io/instance&lt;/td&gt;
&lt;td&gt;애플리케이션이나 시스템을 식별하는 인스턴스명&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;app.kubernetes.io/managed-by&lt;/td&gt;
&lt;td&gt;이 애플리케이션을 관리하는 데 사용되는 도구&lt;/td&gt;
&lt;/tr&gt;
&lt;/tbody&gt;
&lt;/table&gt;
&lt;h2&gt;4.5.8 Prune을 사용한 리소스 삭제: -prune 옵션&lt;/h2&gt;
&lt;p&gt;쿠버네티스를 실제 운용할 때 수동으로 kubectl 명령어를 사용하는 일은 거의 없다. 수동으로 운영하는 것은 휴먼 에러가 발생하기 쉽고, 사람이 파악하고 관리할 수 있는 리소스 수에 한계가 있기 때문에 권장되지 않는다. Git 저장소에서 매니페스를 관리하고 변경이 있을 때만 &lt;code class=&quot;language-text&quot;&gt;kubectl apply&lt;/code&gt; 명령어를 사용하여 자동으로 매니페스트를 적용시키는 방법이 있다. 하지만 매니페스트에서 삭제된 리소스를 삭제하는 데 필요한 kubectl delete 명령어를 자동으로 실행하려면 매니페스트에서 삭제된 리소스를 감지할 수 있는 구조를 만들어야 한다.&lt;/p&gt;
&lt;p&gt;여기서 필요한 것이 &lt;code class=&quot;language-text&quot;&gt;kubectl apply&lt;/code&gt; 명령어에서 사용 가능한 &lt;code class=&quot;language-text&quot;&gt;--prune&lt;/code&gt; 옵션이다. 이 옵션은 &lt;code class=&quot;language-text&quot;&gt;kubectl apply&lt;/code&gt; 명령어어를 실행할 때 매니페스트에서 삭제된 리소스를 감지하여 자동으로 삭제하는 기능을 구현할 수 있다. 그래서 CI/CD 파이프라인에서는 업데이트된 매니페스트에 대해 kubectl apply --prune 명령어를 계속 실행하는 것만으로 매니페스트에서 삭제된 리소스도 자동으로 삭제할 수 있다.&lt;/p&gt;
&lt;p&gt;Prune은 레이블과 일치하는 전체 리소스의 목록에서 읽어들인 매니페스트 안에 &apos;포함되지 않는 리소스&apos;를 모두 삭제하는 구조로 동작한다.&lt;/p&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;sh&quot;&gt;&lt;pre class=&quot;language-sh&quot;&gt;&lt;code class=&quot;language-sh&quot;&gt;&lt;span class=&quot;token comment&quot;&gt;# 초기 생성&lt;/span&gt;
$ kubectl apply &lt;span class=&quot;token parameter variable&quot;&gt;-f&lt;/span&gt; ./prune-sample &lt;span class=&quot;token parameter variable&quot;&gt;--prune&lt;/span&gt; &lt;span class=&quot;token parameter variable&quot;&gt;-l&lt;/span&gt; &lt;span class=&quot;token assign-left variable&quot;&gt;system&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt;a

&lt;span class=&quot;token comment&quot;&gt;# 파일 삭제&lt;/span&gt;
$ &lt;span class=&quot;token function&quot;&gt;rm&lt;/span&gt; prune-sample/sample-pod1.yaml

&lt;span class=&quot;token comment&quot;&gt;# 삭제 후 다시 업데이트&lt;/span&gt;
$ kubectl apply &lt;span class=&quot;token parameter variable&quot;&gt;-f&lt;/span&gt; ./prune-sample &lt;span class=&quot;token parameter variable&quot;&gt;--prune&lt;/span&gt; &lt;span class=&quot;token parameter variable&quot;&gt;-l&lt;/span&gt; &lt;span class=&quot;token assign-left variable&quot;&gt;system&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt;a&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;h2&gt;4.5.9 편집기로 편집: edit&lt;/h2&gt;
&lt;p&gt;&lt;code class=&quot;language-text&quot;&gt;kubectl edit&lt;/code&gt; 명령어는 편집기 상에서 해당 리소스를 편집할 수 있다. 편집에 사용되는 편집기는 환경 변수 EDITOR이나 KUBE_EDITOR로 지정할 수 있다.&lt;/p&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;sh&quot;&gt;&lt;pre class=&quot;language-sh&quot;&gt;&lt;code class=&quot;language-sh&quot;&gt;&lt;span class=&quot;token comment&quot;&gt;# 환경 변수 EDITOR에 vim을 일시적으로 정의(~/.bashrc 등에 추가하면 영구적으로 사용 가능)&lt;/span&gt;
$ &lt;span class=&quot;token builtin class-name&quot;&gt;export&lt;/span&gt; &lt;span class=&quot;token assign-left variable&quot;&gt;EDITOR&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt;vim

&lt;span class=&quot;token comment&quot;&gt;# 파드 정의 편집(환경 변수 EDITOR에 정의된 편집기 실행)&lt;/span&gt;
$ kubectl edit pod sample-pod&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;h2&gt;4.5.10 리소스 일부 정보 업데이트: set&lt;/h2&gt;
&lt;p&gt;매니페스트 파일을 업데이트하지 않고 일부 설정값(또는 이 설정값을 가진 특정 리소스)만 &lt;code class=&quot;language-text&quot;&gt;kubectl set&lt;/code&gt; 명령어를 사용하여 간단히 동작 상태를 변경할 수 있다. 변경 가능한 설정값은 다음과 같다.&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;env&lt;/li&gt;
&lt;li&gt;image&lt;/li&gt;
&lt;li&gt;resources&lt;/li&gt;
&lt;li&gt;selector&lt;/li&gt;
&lt;li&gt;serviceaccount&lt;/li&gt;
&lt;li&gt;subject&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;예를 들어, 컨테이너 이미지만 업데이트 하는 경우, 다음과 같이 하면 된다. 다만, &lt;code class=&quot;language-text&quot;&gt;kubectl set&lt;/code&gt;은 매니페스트 파일만 업데이트 되는 것이라, 실제 서버상의 리소스에 적용되는 것이 아니다.&lt;/p&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;sh&quot;&gt;&lt;pre class=&quot;language-sh&quot;&gt;&lt;code class=&quot;language-sh&quot;&gt;&lt;span class=&quot;token comment&quot;&gt;# sample-pod 내 nginx-container 컨테이너의 컨테이너 이미지 확인&lt;/span&gt;
$ kubectl describe pod sample-pod

&lt;span class=&quot;token comment&quot;&gt;# 컨테이너 이미지를 nginx:1.17에서 nginx:1.16으로 변경&lt;/span&gt;
&lt;span class=&quot;token comment&quot;&gt;# 서식: kubectl set image 리소스 종류 리소스명 컨테이너명=컨테이너 이미지 지정&lt;/span&gt;
$ kubectl &lt;span class=&quot;token builtin class-name&quot;&gt;set&lt;/span&gt; image pod sample-pod nginx-container&lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt;nginx:1.16

&lt;span class=&quot;token comment&quot;&gt;# sample-pod 내 nginx-container 컨테이너의 컨테이너 이미지 확인&lt;/span&gt;
$ kubectl describe pod sample-pod&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;h2&gt;4.5.11 로컬 매니페스트와 쿠버네티스 등록 정보 비교 출력: diff&lt;/h2&gt;
&lt;p&gt;쿠버네티스에서는 매니페스트를 적용할 때 &apos;실제로 쿠버네티스 클러스터에 등록된 정보&apos;와 &apos;로컬에 있는 매니페스트&apos; 내용의 차이가 있는지 알 수 없다면 매니페스트를 적용하기 힘들 수 있다. 이에 &lt;code class=&quot;language-text&quot;&gt;kubectl diff&lt;/code&gt;명령어를 사용하여 둘의 차이를 확인할 수 있다.&lt;/p&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;sh&quot;&gt;&lt;pre class=&quot;language-sh&quot;&gt;&lt;code class=&quot;language-sh&quot;&gt;&lt;span class=&quot;token comment&quot;&gt;# 컨테이너 이미지를 nginx:1.15로 변경&lt;/span&gt;
$ kubectl &lt;span class=&quot;token builtin class-name&quot;&gt;set&lt;/span&gt; image pod sample-pod nginx-container&lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt;nginx:1.15

&lt;span class=&quot;token comment&quot;&gt;# 클러스터 등록 정보와 매니페스트의 차이점 확인&lt;/span&gt;
$ kubectl &lt;span class=&quot;token function&quot;&gt;diff&lt;/span&gt; &lt;span class=&quot;token parameter variable&quot;&gt;-f&lt;/span&gt; sample-pod.yaml

&lt;span class=&quot;token comment&quot;&gt;# 상태 코드 확인&lt;/span&gt;
$ &lt;span class=&quot;token builtin class-name&quot;&gt;echo&lt;/span&gt; &lt;span class=&quot;token variable&quot;&gt;$?&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;h2&gt;4.5.12 사용 가능한 리소스 종류의 목록 가져오기: api-resources&lt;/h2&gt;
&lt;p&gt;&lt;code class=&quot;language-text&quot;&gt;kubectl api-resources&lt;/code&gt; 명령어는 사용 가능한 리소스 목록을 가져올 수 있다.&lt;/p&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;sh&quot;&gt;&lt;pre class=&quot;language-sh&quot;&gt;&lt;code class=&quot;language-sh&quot;&gt;&lt;span class=&quot;token comment&quot;&gt;# 모든 리소스 종류 표시(일부 발췌)&lt;/span&gt;
$ kubectl api-resources

&lt;span class=&quot;token comment&quot;&gt;# 네임 스페이스에 속하는 리소스&lt;/span&gt;
$ kubectl api-resources &lt;span class=&quot;token parameter variable&quot;&gt;--namespaced&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt;true&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;h2&gt;4.5.13 리소스 정보 가져오기: get&lt;/h2&gt;
&lt;p&gt;&lt;code class=&quot;language-text&quot;&gt;kubectl get&lt;/code&gt; 명령어는 리소스 목록을 가져올 수 있다.&lt;/p&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;sh&quot;&gt;&lt;pre class=&quot;language-sh&quot;&gt;&lt;code class=&quot;language-sh&quot;&gt;&lt;span class=&quot;token comment&quot;&gt;# 파드 목록 표시&lt;/span&gt;
$ kubectl get pods sample-pod

&lt;span class=&quot;token comment&quot;&gt;# label1=val1과 label2 레이블을 가진 파드를 표시&lt;/span&gt;
$ kubectl get pods &lt;span class=&quot;token parameter variable&quot;&gt;-l&lt;/span&gt; &lt;span class=&quot;token assign-left variable&quot;&gt;label&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt;val1,label2 --show-labels

&lt;span class=&quot;token comment&quot;&gt;# 파드 목록 표시(더 상세히 표시)&lt;/span&gt;
$ kubectl get pods &lt;span class=&quot;token parameter variable&quot;&gt;-o&lt;/span&gt; wide

&lt;span class=&quot;token comment&quot;&gt;# YAML 형식으로 파드의 상세 목록 출력&lt;/span&gt;
$ kubectl get pods &lt;span class=&quot;token parameter variable&quot;&gt;-o&lt;/span&gt; yaml

&lt;span class=&quot;token comment&quot;&gt;# Custom Columns (모든 파드의 파드명과 기동 중인 호스트 IP주소를 표시)&lt;/span&gt;
$ kubectl get pods &lt;span class=&quot;token parameter variable&quot;&gt;-o&lt;/span&gt; custom-columns&lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;token string&quot;&gt;&quot;NAME:{.metadata.name},NodeIP:{.status.hostIP}&quot;&lt;/span&gt;

&lt;span class=&quot;token comment&quot;&gt;# JSON Path(sample-pod의 파드명 표시)&lt;/span&gt;
$ kubectl get pods sample-pod &lt;span class=&quot;token parameter variable&quot;&gt;-o&lt;/span&gt; &lt;span class=&quot;token assign-left variable&quot;&gt;jsonpath&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;token string&quot;&gt;&quot;{.metadata.name}&quot;&lt;/span&gt;

&lt;span class=&quot;token comment&quot;&gt;# .spec.containers[].name이 nginx-container에 일치하는 요소의 .spec.containers[].image를 출력&lt;/span&gt;
$ kubectl get pods sample-pod &lt;span class=&quot;token parameter variable&quot;&gt;-o&lt;/span&gt; &lt;span class=&quot;token assign-left variable&quot;&gt;jsonpath&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;token string&quot;&gt;&quot;{.spec.containers[?(@.name == &apos;nginx-container&apos;)].image}&quot;&lt;/span&gt;

&lt;span class=&quot;token comment&quot;&gt;# Go Template(가장 유연한 출력 방식. 여기서는 모든 파드의 이름과 파드 안에서 기동 중인 각 컨테이너 이미지를 표시)&lt;/span&gt;
$ kubectl get pods &lt;span class=&quot;token parameter variable&quot;&gt;-o&lt;/span&gt; go-template&lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;token string&quot;&gt;&quot;{{range .items}}{{.metadata.name}}:{{range .spec.containers}}{{.image}}{{end}} {{end}}&quot;&lt;/span&gt;

&lt;span class=&quot;token comment&quot;&gt;# 노드 목록 표시&lt;/span&gt;
$ kubectl get nodes

&lt;span class=&quot;token comment&quot;&gt;# 생성된 모든 종료의 리소스를 표시 (시크릿/컨피그맵/인그레스는 제외)&lt;/span&gt;
$ kubectl get all

&lt;span class=&quot;token comment&quot;&gt;# --watch 옵션을 사용하여 리소스 상태의 변화가 있을 때 결과를 계속 출력&lt;/span&gt;
$ kubectl get pods &lt;span class=&quot;token parameter variable&quot;&gt;--watch&lt;/span&gt;

&lt;span class=&quot;token comment&quot;&gt;# --output-watch-events 옵션을 사용하면 해당 리소스가 API처럼 어떤 처리가 되었는지 이벤트 정보도 함께 표시할 수 있다.&lt;/span&gt;
$ kubectl get pods &lt;span class=&quot;token parameter variable&quot;&gt;--watch&lt;/span&gt; --output-watch-events&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;h2&gt;4.5.14 리소스 상세 정보 가져오기: describe&lt;/h2&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;sh&quot;&gt;&lt;pre class=&quot;language-sh&quot;&gt;&lt;code class=&quot;language-sh&quot;&gt;&lt;span class=&quot;token comment&quot;&gt;# 파드 상세 정보 표시&lt;/span&gt;
$ kubectl describe pod sample-pod

&lt;span class=&quot;token comment&quot;&gt;# 노드 상세 정보 표시&lt;/span&gt;
$ kubectl describe &lt;span class=&quot;token function&quot;&gt;node&lt;/span&gt; &lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;h2&gt;4.5.15  실제 리소스 사용량 확인: top&lt;/h2&gt;
&lt;p&gt;&lt;code class=&quot;language-text&quot;&gt;kubectl describe&lt;/code&gt; 명령어에서 확인할 수 있는 리소스 사용량은 쿠버네티스가 파드에 확보한 값을 타나낸다. 실제 파드 내부의 컨테이너가 사용하고 있는 리소스 사용량은 &lt;code class=&quot;language-text&quot;&gt;kubectl top&lt;/code&gt;명령어를 사용하여 확인할 수 있다. 리소스 사용량은 노드와 파드 단위로 확인한다. 또, &lt;code class=&quot;language-text&quot;&gt;kubectl top&lt;/code&gt;명령어는 &lt;code class=&quot;language-text&quot;&gt;metric-server&lt;/code&gt;라는 추가 구성 요소를 사용한다. 일반적인 쿠버네티스 환경이라면 배포되겠지만, 배포되지 않을 경우에는 수동으로 배포해야 한다.&lt;/p&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;sh&quot;&gt;&lt;pre class=&quot;language-sh&quot;&gt;&lt;code class=&quot;language-sh&quot;&gt;&lt;span class=&quot;token comment&quot;&gt;# 노드 리소스 사용량 확인&lt;/span&gt;
$ kubectl &lt;span class=&quot;token function&quot;&gt;top&lt;/span&gt; &lt;span class=&quot;token function&quot;&gt;node&lt;/span&gt;
error: Metrics API not available&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;그런데 위 명령어 사용 시 위와 같이 에러가 발생하였다. 확인해보니 쿠버네티스를 설치했다고 메트릭스 서버까지 같이 설치되지는 않는 모양이다. 그래서 별도로 설치를 진행하였다.&lt;/p&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;sh&quot;&gt;&lt;pre class=&quot;language-sh&quot;&gt;&lt;code class=&quot;language-sh&quot;&gt;&lt;span class=&quot;token comment&quot;&gt;# metric 서버 실행&lt;/span&gt;
$ kubectl apply &lt;span class=&quot;token parameter variable&quot;&gt;-f&lt;/span&gt; https://github.com/kubernetes-sigs/metrics-server/releases/latest/download/components.yaml

&lt;span class=&quot;token comment&quot;&gt;# kubectl에 접근하여 파드와 노드의 정보를 얻어올 수 있도록 설정 (tls 통신이 가능하도록 수정)&lt;/span&gt;
$ kubectl edit deployments.apps &lt;span class=&quot;token parameter variable&quot;&gt;-n&lt;/span&gt; kube-system metrics-server&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;yaml 파일 내부에서 args 찾아가서 아래 두 설정을 추가한다.&lt;/p&gt;
&lt;table&gt;
&lt;thead&gt;
&lt;tr&gt;
&lt;th&gt;Arguments&lt;/th&gt;
&lt;th&gt;Detail&lt;/th&gt;
&lt;/tr&gt;
&lt;/thead&gt;
&lt;tbody&gt;
&lt;tr&gt;
&lt;td&gt;--kubelet-insecure-tls&lt;/td&gt;
&lt;td&gt;인증서가 공인 기관에 승인 받지 않아 안전하지 않기 때문에 보안적으로 취약하지만, 무시하겠다는 의미&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;--kubelet-preferred-address-types=InternalIP&lt;/td&gt;
&lt;td&gt;kubelet 연결에 사용할 때 사용하는 주소 타입을 지정&lt;/td&gt;
&lt;/tr&gt;
&lt;/tbody&gt;
&lt;/table&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;sh&quot;&gt;&lt;pre class=&quot;language-sh&quot;&gt;&lt;code class=&quot;language-sh&quot;&gt;&lt;span class=&quot;token comment&quot;&gt;# 파드별 리소스 사용량 확인&lt;/span&gt;
$ kubectl &lt;span class=&quot;token parameter variable&quot;&gt;-n&lt;/span&gt; kube-system &lt;span class=&quot;token function&quot;&gt;top&lt;/span&gt; pod

&lt;span class=&quot;token comment&quot;&gt;# 파드 리스트 표시 및 컨테이너별 리소스 사용량 확인&lt;/span&gt;
$ kubectl &lt;span class=&quot;token parameter variable&quot;&gt;-n&lt;/span&gt; kube-system get pods
$ kubectl &lt;span class=&quot;token parameter variable&quot;&gt;-n&lt;/span&gt; kube-system &lt;span class=&quot;token function&quot;&gt;top&lt;/span&gt; pod &lt;span class=&quot;token parameter variable&quot;&gt;--containers&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;h2&gt;4.5.16 컨테이너에서 명령어 실행: exec&lt;/h2&gt;
&lt;p&gt;파드 내부의 컨테이너에서 특정 명령어를 실행시키려면 &lt;code class=&quot;language-text&quot;&gt;kubectl exec&lt;/code&gt; 명령어를 사용한다. 이 명령어를 사용하여 /bin/bash 등의 셸을 실행하여 마치 컨테이너에 로그인한 것과 같은 상태를 만들 수 있다. 명령어를 사용하기 전 &lt;code class=&quot;language-text&quot;&gt;--&lt;/code&gt;는 필수로 붙여서 사용해야 한다.&lt;/p&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;sh&quot;&gt;&lt;pre class=&quot;language-sh&quot;&gt;&lt;code class=&quot;language-sh&quot;&gt;&lt;span class=&quot;token comment&quot;&gt;# 파드 내부의 컨테이너에서 /bin/ls 실행&lt;/span&gt;
$ kubectl &lt;span class=&quot;token builtin class-name&quot;&gt;exec&lt;/span&gt; &lt;span class=&quot;token parameter variable&quot;&gt;-it&lt;/span&gt; sample-pod -- /bin/ls


&lt;span class=&quot;token comment&quot;&gt;# 여러 컨테이너에 존재하는 파드의 특정 컨테이너에서 /bin/ls 실행&lt;/span&gt;
$ kubectl &lt;span class=&quot;token builtin class-name&quot;&gt;exec&lt;/span&gt; &lt;span class=&quot;token parameter variable&quot;&gt;-it&lt;/span&gt; sample-pod &lt;span class=&quot;token parameter variable&quot;&gt;-c&lt;/span&gt; nginx-container -- /bin/ls

&lt;span class=&quot;token comment&quot;&gt;# 파드 내부의 컨테이너에서 /bin/bash 실행(종료하려면 exit 실행)&lt;/span&gt;
$ kubectl &lt;span class=&quot;token builtin class-name&quot;&gt;exec&lt;/span&gt; &lt;span class=&quot;token parameter variable&quot;&gt;-it&lt;/span&gt; sample-pod -- /bin/bash

&lt;span class=&quot;token comment&quot;&gt;# 파이프 등 특정 문자가 포함된 경우 /bin/bash에 인수를 전달하는 형태로 실행&lt;/span&gt;
$ kubectl &lt;span class=&quot;token builtin class-name&quot;&gt;exec&lt;/span&gt; &lt;span class=&quot;token parameter variable&quot;&gt;-it&lt;/span&gt; sample-pod -- /bin/bash &lt;span class=&quot;token parameter variable&quot;&gt;-c&lt;/span&gt; &lt;span class=&quot;token string&quot;&gt;&quot;ls -all --classify | grep lib&quot;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;h2&gt;4.5.17 파드에 디버깅용 임시 컨테이너 추가: debug&lt;/h2&gt;
&lt;p&gt;컨테이너 이미지로 경량의 Distroless나 Scratch 이미지 등을 사용하는 경우 디버깅용 도구 등이 전혀 들어 있지 않기 때문에, 문제가 발생했을 때 &lt;code class=&quot;language-text&quot;&gt;kubectl exec&lt;/code&gt; 명령어를 사용하여 컨테이너 안으로 들어가도 디버깅을 수행하기 어렵다. 이 문제를 해결하기 위해 사용 가능한 것이 &lt;code class=&quot;language-text&quot;&gt;kubectl debug&lt;/code&gt; 명령어이다. 이 명령어는 파드에 추가 임시 컨테이너를 기동하고 그 컨테이너를 사용하여 디버깅이나 트러블슈팅을 수행한다.&lt;/p&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;sh&quot;&gt;&lt;pre class=&quot;language-sh&quot;&gt;&lt;code class=&quot;language-sh&quot;&gt;&lt;span class=&quot;token comment&quot;&gt;# sample-pod에 임의의 명령어로 디버깅용 컨테이너를 기동하여 접속 (4장에서 생성한 k8s-alpha에서 실행)&lt;/span&gt;
$ kubectl debug sample-pod &lt;span class=&quot;token parameter variable&quot;&gt;--image&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt;amsy810/tools:v2.0 &lt;span class=&quot;token parameter variable&quot;&gt;-it&lt;/span&gt; -- &lt;span class=&quot;token function&quot;&gt;bash&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;h2&gt;4.5.18 로컬 머신에서 파드로 포트 포워딩: port-forwarding&lt;/h2&gt;
&lt;p&gt;디버깅 용도 등으로 JMX 클라이언트에서 컨테이너에서 실행 중인 자바 애플리케이션 서버에 접속하거나, 데이터베이스 클라이언트에서 컨테이너에서 기동 중인 MySQL 서버에 접속해야 하는 경우가 있다. 그런 경우 kubectl을 실행하는 로컬 머신에서 특정 파드로 트래픽을 전송하는 &lt;code class=&quot;language-text&quot;&gt;kubectl port-forwarding&lt;/code&gt; 명령어를 사용할 수 있다.&lt;/p&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;sh&quot;&gt;&lt;pre class=&quot;language-sh&quot;&gt;&lt;code class=&quot;language-sh&quot;&gt;&lt;span class=&quot;token comment&quot;&gt;# localhost:8888에서 파드의 80/TCP 포트로 전송 (종료하려면 Ctrl + C 입력)&lt;/span&gt;
$ kubectl port-forward sample-pod &lt;span class=&quot;token number&quot;&gt;8888&lt;/span&gt;:80

&lt;span class=&quot;token comment&quot;&gt;# 다른 터미널에서 접속 확인&lt;/span&gt;
$ &lt;span class=&quot;token function&quot;&gt;curl&lt;/span&gt; &lt;span class=&quot;token parameter variable&quot;&gt;-I&lt;/span&gt; localhost:8888&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;h2&gt;4.5.19 컨테이너 로그 확인: logs&lt;/h2&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;sh&quot;&gt;&lt;pre class=&quot;language-sh&quot;&gt;&lt;code class=&quot;language-sh&quot;&gt;&lt;span class=&quot;token comment&quot;&gt;# 파드 내의 컨테이너 로그 출력&lt;/span&gt;
$ kubectl logs sample-pod

&lt;span class=&quot;token comment&quot;&gt;# 특정 파드 내의 특정 컨테이너 로그 출력&lt;/span&gt;
$ kubectl logs sample-pod &lt;span class=&quot;token parameter variable&quot;&gt;-c&lt;/span&gt; nginx-container

&lt;span class=&quot;token comment&quot;&gt;# 실시간 로그 출력&lt;/span&gt;
$ kubectl logs &lt;span class=&quot;token parameter variable&quot;&gt;-f&lt;/span&gt; sample-pod

&lt;span class=&quot;token comment&quot;&gt;# 최근 1시간 이내, 10건의 로그를 타임스탬프와 함께 출력&lt;/span&gt;
$ kubectl logs &lt;span class=&quot;token parameter variable&quot;&gt;--since&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt;1h &lt;span class=&quot;token parameter variable&quot;&gt;--tail&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;token number&quot;&gt;10&lt;/span&gt; &lt;span class=&quot;token parameter variable&quot;&gt;--timestamp&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt;true sample-pod

&lt;span class=&quot;token comment&quot;&gt;# app=sample-app 레이블을 가진 모든 파드의 로그 출력&lt;/span&gt;
$ kubectl logs &lt;span class=&quot;token parameter variable&quot;&gt;--selector&lt;/span&gt; &lt;span class=&quot;token assign-left variable&quot;&gt;app&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt;sample-app&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;h2&gt;4.5.20 컨테이너와 로컬 머신 간의 파일 복사: cp&lt;/h2&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;sh&quot;&gt;&lt;pre class=&quot;language-sh&quot;&gt;&lt;code class=&quot;language-sh&quot;&gt;&lt;span class=&quot;token comment&quot;&gt;# sample-pod의 /etc/hostname 파일을 로컬 머신에 복사&lt;/span&gt;
$ kubectl &lt;span class=&quot;token function&quot;&gt;cp&lt;/span&gt; sample-pod:/etc/hostname ./hostname

&lt;span class=&quot;token comment&quot;&gt;# hostname 파일 확인&lt;/span&gt;
$ &lt;span class=&quot;token function&quot;&gt;cat&lt;/span&gt; &lt;span class=&quot;token function&quot;&gt;hostname&lt;/span&gt;

&lt;span class=&quot;token comment&quot;&gt;# 가져온 로컬 파일을 컨테이너로 복사&lt;/span&gt;
$ kubectl &lt;span class=&quot;token function&quot;&gt;cp&lt;/span&gt; &lt;span class=&quot;token function&quot;&gt;hostname&lt;/span&gt; sample-pod:/tmp/newfile

&lt;span class=&quot;token comment&quot;&gt;# 컨테이너의 /tmp를 확인&lt;/span&gt;
$ kubectl &lt;span class=&quot;token builtin class-name&quot;&gt;exec&lt;/span&gt; &lt;span class=&quot;token parameter variable&quot;&gt;-it&lt;/span&gt; sample-pod -- &lt;span class=&quot;token function&quot;&gt;ls&lt;/span&gt; /tmp&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;h2&gt;4.5.21 kubectl 플러그인과 패키지 관리자: plugin/krew&lt;/h2&gt;
&lt;p&gt;kubectl에는 하위 명령어가 확장할 수 있도록 플러그인이 준비되어 있다. kubectl 플러그인 관리는 수동으로 할 수 있지만, krew 라는 플러그인 관리자를 통해 관리할 것을 추천한다.&lt;/p&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;sh&quot;&gt;&lt;pre class=&quot;language-sh&quot;&gt;&lt;code class=&quot;language-sh&quot;&gt;&lt;span class=&quot;token comment&quot;&gt;# krew 설치&lt;/span&gt;
&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;
  &lt;span class=&quot;token builtin class-name&quot;&gt;set&lt;/span&gt; -x&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt; &lt;span class=&quot;token builtin class-name&quot;&gt;cd&lt;/span&gt; &lt;span class=&quot;token string&quot;&gt;&quot;&lt;span class=&quot;token variable&quot;&gt;&lt;span class=&quot;token variable&quot;&gt;$(&lt;/span&gt;mktemp &lt;span class=&quot;token parameter variable&quot;&gt;-d&lt;/span&gt;&lt;span class=&quot;token variable&quot;&gt;)&lt;/span&gt;&lt;/span&gt;&quot;&lt;/span&gt; &lt;span class=&quot;token operator&quot;&gt;&amp;amp;&amp;amp;&lt;/span&gt;
  &lt;span class=&quot;token assign-left variable&quot;&gt;OS&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;token string&quot;&gt;&quot;&lt;span class=&quot;token variable&quot;&gt;&lt;span class=&quot;token variable&quot;&gt;$(&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;uname&lt;/span&gt; &lt;span class=&quot;token operator&quot;&gt;|&lt;/span&gt; &lt;span class=&quot;token function&quot;&gt;tr&lt;/span&gt; &lt;span class=&quot;token string&quot;&gt;&apos;[:upper:]&apos;&lt;/span&gt; &lt;span class=&quot;token string&quot;&gt;&apos;[:lower:]&apos;&lt;/span&gt;&lt;span class=&quot;token variable&quot;&gt;)&lt;/span&gt;&lt;/span&gt;&quot;&lt;/span&gt; &lt;span class=&quot;token operator&quot;&gt;&amp;amp;&amp;amp;&lt;/span&gt;
  &lt;span class=&quot;token assign-left variable&quot;&gt;ARCH&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;token string&quot;&gt;&quot;&lt;span class=&quot;token variable&quot;&gt;&lt;span class=&quot;token variable&quot;&gt;$(&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;uname&lt;/span&gt; &lt;span class=&quot;token parameter variable&quot;&gt;-m&lt;/span&gt; &lt;span class=&quot;token operator&quot;&gt;|&lt;/span&gt; &lt;span class=&quot;token function&quot;&gt;sed&lt;/span&gt; &lt;span class=&quot;token parameter variable&quot;&gt;-e&lt;/span&gt; &lt;span class=&quot;token string&quot;&gt;&apos;s/x86_64/amd64/&apos;&lt;/span&gt; &lt;span class=&quot;token parameter variable&quot;&gt;-e&lt;/span&gt; &lt;span class=&quot;token string&quot;&gt;&apos;s/\(arm\)\(64\)\?.*/\1\2/&apos;&lt;/span&gt; &lt;span class=&quot;token parameter variable&quot;&gt;-e&lt;/span&gt; &lt;span class=&quot;token string&quot;&gt;&apos;s/aarch64$/arm64/&apos;&lt;/span&gt;&lt;span class=&quot;token variable&quot;&gt;)&lt;/span&gt;&lt;/span&gt;&quot;&lt;/span&gt; &lt;span class=&quot;token operator&quot;&gt;&amp;amp;&amp;amp;&lt;/span&gt;
  &lt;span class=&quot;token assign-left variable&quot;&gt;KREW&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;token string&quot;&gt;&quot;krew-&lt;span class=&quot;token variable&quot;&gt;${OS}&lt;/span&gt;_&lt;span class=&quot;token variable&quot;&gt;${ARCH}&lt;/span&gt;&quot;&lt;/span&gt; &lt;span class=&quot;token operator&quot;&gt;&amp;amp;&amp;amp;&lt;/span&gt;
  &lt;span class=&quot;token function&quot;&gt;curl&lt;/span&gt; &lt;span class=&quot;token parameter variable&quot;&gt;-fsSLO&lt;/span&gt; &lt;span class=&quot;token string&quot;&gt;&quot;https://github.com/kubernetes-sigs/krew/releases/latest/download/&lt;span class=&quot;token variable&quot;&gt;${KREW}&lt;/span&gt;.tar.gz&quot;&lt;/span&gt; &lt;span class=&quot;token operator&quot;&gt;&amp;amp;&amp;amp;&lt;/span&gt;
  &lt;span class=&quot;token function&quot;&gt;tar&lt;/span&gt; zxvf &lt;span class=&quot;token string&quot;&gt;&quot;&lt;span class=&quot;token variable&quot;&gt;${KREW}&lt;/span&gt;.tar.gz&quot;&lt;/span&gt; &lt;span class=&quot;token operator&quot;&gt;&amp;amp;&amp;amp;&lt;/span&gt;
  ./&lt;span class=&quot;token string&quot;&gt;&quot;&lt;span class=&quot;token variable&quot;&gt;${KREW}&lt;/span&gt;&quot;&lt;/span&gt; &lt;span class=&quot;token function&quot;&gt;install&lt;/span&gt; krew
&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;
&lt;span class=&quot;token builtin class-name&quot;&gt;export&lt;/span&gt; &lt;span class=&quot;token assign-left variable&quot;&gt;&lt;span class=&quot;token environment constant&quot;&gt;PATH&lt;/span&gt;&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;token string&quot;&gt;&quot;&lt;span class=&quot;token variable&quot;&gt;${KREW_ROOT&lt;span class=&quot;token operator&quot;&gt;:-&lt;/span&gt;$HOME&lt;span class=&quot;token operator&quot;&gt;/&lt;/span&gt;.krew}&lt;/span&gt;/bin:&lt;span class=&quot;token environment constant&quot;&gt;$PATH&lt;/span&gt;&quot;&lt;/span&gt;

&lt;span class=&quot;token comment&quot;&gt;# 플러그인 목록 표시&lt;/span&gt;
$ kubectl plugin list

&lt;span class=&quot;token comment&quot;&gt;# 플러그인 설치&lt;/span&gt;
$ kubectl krew &lt;span class=&quot;token function&quot;&gt;install&lt;/span&gt; tree rolesum sort-manifests open-svc view-serviceaccount-kubeconfig&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;h2&gt;4.5.22 kubectl에서 디버깅&lt;/h2&gt;
&lt;p&gt;kubectl은 쿠버네티스 마스터의 API와 통신하여 클러스터를 관리한다. 따라서 어떤 에러가 발생했을 때는 API통신이나 kubectl 설정에 문제가 있는 경우가 대부분이다. kubectl 명령어를 실행할 때 -v 옵션으로 로그 레벨을 지정하면 면령어 실행 내용을 좀 더 상세히 볼 수 있다. 리소스 등을 생성했을 때 HTTP Request/Response 내용을 표시하는 경우 -v=6 이상의 로그 레벨로 출력하면 된다.&lt;/p&gt;
&lt;p&gt;Request Body/Resposne Body 까지 확인하려면 -v=8 이상의 레벨로 출력한다.&lt;/p&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;sh&quot;&gt;&lt;pre class=&quot;language-sh&quot;&gt;&lt;code class=&quot;language-sh&quot;&gt;$ kubectl &lt;span class=&quot;token parameter variable&quot;&gt;-v&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;token number&quot;&gt;6&lt;/span&gt; get pod

$ kubectl &lt;span class=&quot;token parameter variable&quot;&gt;-v&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;token number&quot;&gt;8&lt;/span&gt; apply &lt;span class=&quot;token parameter variable&quot;&gt;-f&lt;/span&gt; sample-pod.yaml&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;h2&gt;kubectl의 기타 팁&lt;/h2&gt;
&lt;h3&gt;alias 생성&lt;/h3&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;sh&quot;&gt;&lt;pre class=&quot;language-sh&quot;&gt;&lt;code class=&quot;language-sh&quot;&gt;&lt;span class=&quot;token comment&quot;&gt;# kubectl 명령어를 k로 사용할 수 있도록 alias 설정&lt;/span&gt;
$ &lt;span class=&quot;token builtin class-name&quot;&gt;alias&lt;/span&gt; &lt;span class=&quot;token assign-left variable&quot;&gt;k&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;token string&quot;&gt;&apos;kubectl&apos;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;h3&gt;kube-ps1&lt;/h3&gt;
&lt;p&gt;kube-ps1은 bash나 zsh의 프롬프트에 현재 작업 중인 쿠버네티스 클러스터와 네임스페이스를 표시한다. 맥 운영체제에서는 brew로 설치할 수 있다. 설치 후에는 다음 표시된 순서로 bashrc나 zshrc에 내용을 추가한다.&lt;/p&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;sh&quot;&gt;&lt;pre class=&quot;language-sh&quot;&gt;&lt;code class=&quot;language-sh&quot;&gt;$ brew update
$ brew &lt;span class=&quot;token function&quot;&gt;install&lt;/span&gt; kube-ps1
$ &lt;span class=&quot;token builtin class-name&quot;&gt;source&lt;/span&gt; &lt;span class=&quot;token string&quot;&gt;&quot;/opt/homebrew/Cellar/kube-ps1/0.7.0/share/kube-ps1.sh&quot;&lt;/span&gt;
$ &lt;span class=&quot;token assign-left variable&quot;&gt;&lt;span class=&quot;token environment constant&quot;&gt;PS1&lt;/span&gt;&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;token string&quot;&gt;&apos;$(kube_ps1)&apos;&lt;/span&gt;&lt;span class=&quot;token environment constant&quot;&gt;$PS1&lt;/span&gt;
$ kubeon

&lt;span class=&quot;token comment&quot;&gt;# 프롬프트에 현재 작업 중인 클러스터와 네임스페이스 표시&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;h3&gt;파드가 기동하지 않는 경우의 디버깅&lt;/h3&gt;
&lt;p&gt;쿠버네티스 환경에서 파드가 기동되지 않는 경우에는 디버깅할 때 주로 다음 세 가지 방법이 사용된다.&lt;/p&gt;
&lt;ol&gt;
&lt;li&gt;&lt;code class=&quot;language-text&quot;&gt;kubectl logs&lt;/code&gt; 명령어를 사용하여 컨테이너가 출력하는 로그를 확인하는 방법이다. 이 방법은 주로 애플리케이션에 문제가 있을 때 유용하다.&lt;/li&gt;
&lt;li&gt;&lt;code class=&quot;language-text&quot;&gt;kubectl describe&lt;/code&gt; 명령어로 표시되는 Events 항목을 확인하는 방법이다. 이 방법은 주로 쿠버네티스 설정이나 리소스 설정에 문제가 있을 때 유용하다. 명령어를 실행하면 에러 메시지를 확인할 수 있어 리소스 부족으로 스케줄리 불가능/스케줄링 정책에 해당하는 노드가 없음/볼륨 마운트 실패 등의 원인을 파악 가능하다.&lt;/li&gt;
&lt;li&gt;마지막으로 &lt;code class=&quot;language-text&quot;&gt;kubectl run&lt;/code&gt; 명령어를 사용하여 실제 컨테이너 셸로 확인하는 방법이다. 이는 주로 컨테이너 환경이나 애플리케이션에 문제가 있을 때 유용하다. 기동한 애플리케이션이 정지되면 파드도 정지되어 &lt;code class=&quot;language-text&quot;&gt;kubectl exec&lt;/code&gt; 명령어로 셸을 실행할 수 없다. 그런 경우에는 애플리케이션의 &lt;code class=&quot;language-text&quot;&gt;ENTRYPOINT&lt;/code&gt;를 덮어 씌워 일시적으로 컨테이너를 기동시켜 확인할 수 있다.&lt;/li&gt;
&lt;/ol&gt;
&lt;h1&gt;출처&lt;/h1&gt;
&lt;p&gt;&lt;a href=&quot;https://m.blog.naver.com/isc0304/221860790762&quot;&gt;https://m.blog.naver.com/isc0304/221860790762&lt;/a&gt;&lt;/p&gt;</content:encoded></item><item><title><![CDATA[쿠버네티스 용어 정리]]></title><description><![CDATA[…]]></description><link>https://github.com/SiverPineValley/SiverPineValley.github.io/kubernetes/kubernetes_terms/</link><guid isPermaLink="false">https://github.com/SiverPineValley/SiverPineValley.github.io/kubernetes/kubernetes_terms/</guid><pubDate>Sun, 31 Jul 2022 13:20:22 GMT</pubDate><content:encoded>&lt;h1&gt;리소스의 종류 및 용도&lt;/h1&gt;
&lt;ul&gt;
&lt;li&gt;&lt;strong&gt;노드&lt;/strong&gt; : 컨테이너가 배치되는 서버&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;네임스페이스&lt;/strong&gt; : 쿠버네티스 클러스터 안의 가상 클러스터.&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;파드&lt;/strong&gt; : 컨테이너의 집합 중 가장 작은 단위로 컨테이너 실행 방법을 정의한다.&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;레플리카 세트&lt;/strong&gt;: 같은 스펙을 갖는 파드를 여러개 생성하고 관리하는 역할을 한다.&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;디플로이먼트&lt;/strong&gt; : 레플리카 세트의 리비전을 관리한다.&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;서비스&lt;/strong&gt; : 파드의 집합에 접근하기 위한 경로를 정의한다.&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;인그레스&lt;/strong&gt; : 서비스를 쿠버네티스 클러스터 외부로 노출시킨다.&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;컨피그맵&lt;/strong&gt; : 설정 정보를 정의하고 파드에 전달한다.&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;퍼시스턴트 볼륨&lt;/strong&gt; : 파드가 사용할 스토리지의 크기 및 종류를 정의.&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;퍼시스턴스 볼륨 클레임&lt;/strong&gt; : 퍼시스턴트 볼륨을 동적으로 확보.&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;스토리지 클래스&lt;/strong&gt; : 퍼시스턴트 볼륨이 확보하는 스토리지의 종류를 정의&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;스테이트풀 세트&lt;/strong&gt; : 같은 스펙으로 모두 동일한 파드를 여러개 생성하고 관리한다.&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;잡&lt;/strong&gt;: 상주 실행을 목적으로 하지 않는 파드를 여러개 생성하고 정상적인 종료를 보장한다.&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;크론잡&lt;/strong&gt; : 크론 문법으로 스케줄링되는 잡.&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;시크릿&lt;/strong&gt; : 인증 정보같은 기밀 데이터를 정의한다.&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;롤&lt;/strong&gt; : 네임스페이스 안에서 조작 가능한 쿠버네티스 리소스의 규칙을 정의한다.&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;롤 바인딩&lt;/strong&gt; : 쿠버네티스 리소스 사용자와 롤을 연결 짓는다.&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;클러스터 룰&lt;/strong&gt; : 클러스터 전체적으로 조작 가능한 쿠버네티스 리소스의 규칙을 정의한다.&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;클러스터 롤 바인딩&lt;/strong&gt; :쿠버네티스 리소스 사용자와 클러스터 롤을 연결 짓는다.&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;서비스 계정&lt;/strong&gt; : 파드가 쿠버네티스 리소스를 조작할 때 사용하는 계정&lt;/li&gt;
&lt;/ul&gt;
&lt;h1&gt;출처&lt;/h1&gt;
&lt;p&gt;&lt;a href=&quot;https://kkimsangheon.github.io/2019/05/27/kube6/&quot;&gt;https://kkimsangheon.github.io/2019/05/27/kube6/&lt;/a&gt;&lt;/p&gt;</content:encoded></item><item><title><![CDATA[쿠버네티스의 매니페스트 파일]]></title><description><![CDATA[매니페스트? 쿠버네티스에서는 클러스터 안에서 움직이는 컨테이너 애플리케이션이나 네트워크 설정, 배치 실행을 하는 잡 등과 같은 리소스를 작성한다. 이와 같은 구체적인 설정 정보를 파일로 관리하는데, 이것이 매니페스트 파일(manifest file…]]></description><link>https://github.com/SiverPineValley/SiverPineValley.github.io/kubernetes/kubernetes_manifest/</link><guid isPermaLink="false">https://github.com/SiverPineValley/SiverPineValley.github.io/kubernetes/kubernetes_manifest/</guid><pubDate>Sun, 31 Jul 2022 13:13:34 GMT</pubDate><content:encoded>&lt;h1&gt;매니페스트?&lt;/h1&gt;
&lt;p&gt;쿠버네티스에서는 클러스터 안에서 움직이는 컨테이너 애플리케이션이나 네트워크 설정, 배치 실행을 하는 잡 등과 같은 리소스를 작성한다. 이와 같은 구체적인 설정 정보를 파일로 관리하는데, 이것이 매니페스트 파일(manifest file)이다.&lt;/p&gt;
&lt;h1&gt;매니페스트 파일의 구조&lt;/h1&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;yaml&quot;&gt;&lt;pre class=&quot;language-yaml&quot;&gt;&lt;code class=&quot;language-yaml&quot;&gt;&lt;span class=&quot;token key atrule&quot;&gt;apiVersion&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;[&lt;/span&gt;1. API의 버전 정보&lt;span class=&quot;token punctuation&quot;&gt;]&lt;/span&gt;
&lt;span class=&quot;token key atrule&quot;&gt;kind&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;[&lt;/span&gt;2. 리소스의 종류&lt;span class=&quot;token punctuation&quot;&gt;]&lt;/span&gt;
&lt;span class=&quot;token key atrule&quot;&gt;metadata&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt;
  &lt;span class=&quot;token key atrule&quot;&gt;name&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;[&lt;/span&gt;3. 리소스의 이름&lt;span class=&quot;token punctuation&quot;&gt;]&lt;/span&gt;
&lt;span class=&quot;token key atrule&quot;&gt;spec&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt;
  &lt;span class=&quot;token punctuation&quot;&gt;[&lt;/span&gt;4. 리소스의 상세 정보&lt;span class=&quot;token punctuation&quot;&gt;]&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;매니페스트 파일은 쿠버네티스 리소스에 따라 작성 방법에 차이가 있을 순 있지만, 기본적으로 위와 같은 구조를 가진다. 각 요소를 자세하게 살펴보면 아래와 같다.&lt;/p&gt;
&lt;h2&gt;1. API의 버전 정보&lt;/h2&gt;
&lt;p&gt;호출할 API의 버전을 지정한다. 버전에 따라 다음과 같이 안정성과 지원 레벨이 다르다.&lt;/p&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;text&quot;&gt;&lt;pre class=&quot;language-text&quot;&gt;&lt;code class=&quot;language-text&quot;&gt;- alpha(알파)
앞으로의 소프트웨어 릴리스에서 예고 없이 호환성이 없는 방법으로 변경될 가능성이 있는 버전. 검증 환경에서만 사용할 것을 권장합니다. 또 기능 지원은 통지 없이 중지되는 경우도 있습니다. &apos;v1alpha1&apos; 등으로 설정합니다.

- beta(베타)
충분히 테스트를 거친 버전입니다. 단, 기능은 삭제되지 않지만 상세 내용이 변경되는 경우가 있습니다. 때문에 실제 환경 이외에서 사용할 것을 권장합니다. 구체적으로는 &apos;v2beta3&apos; 등으로 설정합니다.

- 안정판
안정판 버전에는 &apos;v1&apos;과 같은 버전 번호가 붙습니다. 실제 환경에서 이용합니다. 이 외에도 KubernetesAPI 확장을 위한 API 그룹 등을 설정할 수 있습니다.&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;table&gt;
&lt;thead&gt;
&lt;tr&gt;
&lt;th&gt;버전 종류&lt;/th&gt;
&lt;th&gt;설명&lt;/th&gt;
&lt;/tr&gt;
&lt;/thead&gt;
&lt;tbody&gt;
&lt;tr&gt;
&lt;td&gt;v1&lt;/td&gt;
&lt;td&gt;쿠버네티스에서 발행한 첫 stable release API (대부분의 api가 포함되어 있음)&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;apps/v1&lt;/td&gt;
&lt;td&gt;쿠버네티스의 common API 모음, Deployment, RollingUpdate, ReplicaSet을 포함&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;autoscaling/v1&lt;/td&gt;
&lt;td&gt;pod의 autoscale 기능을 포함하는 API, 현재는 CPU metric을 사용한 scaling만 가능 (추후에 alpha, beta version에서 memory, custom metric으로 scaling 기능 추가예정)&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;batch/v1&lt;/td&gt;
&lt;td&gt;배치 프로세스, job-like task를 위한 배포 api&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;batch/v1beta1&lt;/td&gt;
&lt;td&gt;batch/v1에서 cronJob으로 job을 돌리는 api가 추가&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;ertivicates.k8s.io/v1 beta&lt;/td&gt;
&lt;td&gt;클러스터의 secure network function들이 추가된 API (TLS 등의 기능 추가)&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;extensions/v1beta&lt;/td&gt;
&lt;td&gt;eployments, DaemonSets, ReplicatSets, Ingress 등 상당수 feature들이 새롭게 정의된 API. 그러나 상당수의 api들이 apps/v1과 같은 그룹으로 이동되어서, 쿠버네티스 1.6버젼 이후부터는 deprecated 됨&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;policy/v1beta1&lt;/td&gt;
&lt;td&gt;pod에 대한 security rule이 정의된 API&lt;/td&gt;
&lt;/tr&gt;
&lt;/tbody&gt;
&lt;/table&gt;
&lt;h2&gt;2. 리소스의 종류&lt;/h2&gt;
&lt;p&gt;쿠버네티스의 리소스 종류를 지정한다. 리소스는 다음과 같은 것들이 있습니다.&lt;/p&gt;
&lt;table&gt;
&lt;thead&gt;
&lt;tr&gt;
&lt;th&gt;구분&lt;/th&gt;
&lt;th&gt;리소스&lt;/th&gt;
&lt;/tr&gt;
&lt;/thead&gt;
&lt;tbody&gt;
&lt;tr&gt;
&lt;td&gt;애플리케이션의 실행&lt;/td&gt;
&lt;td&gt;Pod/ReplicaSet/Deployment&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;네트워크의 관리&lt;/td&gt;
&lt;td&gt;Service/Ingress&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;애플리케이션 설정 정보의 관리&lt;/td&gt;
&lt;td&gt;ConfigMap/Secrets&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;배치 잡의 관리&lt;/td&gt;
&lt;td&gt;Job/CronJob&lt;/td&gt;
&lt;/tr&gt;
&lt;/tbody&gt;
&lt;/table&gt;
&lt;h3&gt;파드(Pod)&lt;/h3&gt;
&lt;p&gt;파드는 컨테이너가 모인 집합체의 단위로 적어도 하나 이상의 컨테이너로 이루어진다. 쿠버네티스에서는 결합이 강한 컨테이너를 파드로 묶어 일괄 배포한다.
파드 하나는 여러 노드에 걸쳐 배치될 수 없다. 함께 배포해야 정합성을 유지할 수 있는 컨테이너 등에도 해당 컨테이너를 같은 파드로 묶어두는 전략이 유용하다.
쿠버네티스에서는 관리용 서버인 마스터가 클러스터 전체를 제어하며 마스터 노드는 관리용 컴포넌트가 담긴 파드만 배포된 노드이다. 어플리케이션에 사용되는 파드는 배포할 수 없다.&lt;/p&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;yaml&quot;&gt;&lt;pre class=&quot;language-yaml&quot;&gt;&lt;code class=&quot;language-yaml&quot;&gt;&lt;span class=&quot;token key atrule&quot;&gt;apiVersion&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt; v1  &lt;span class=&quot;token comment&quot;&gt;# 리소스의 유형을 지정하는 속성&lt;/span&gt;
&lt;span class=&quot;token key atrule&quot;&gt;kind&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt; Pod
&lt;span class=&quot;token key atrule&quot;&gt;metadata&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt;       &lt;span class=&quot;token comment&quot;&gt;# 리소스에 부여되는 메타데이터. metadata.name 속성의 값이 리소스의 이름이 된다.&lt;/span&gt;
  &lt;span class=&quot;token key atrule&quot;&gt;name&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt; simple&lt;span class=&quot;token punctuation&quot;&gt;-&lt;/span&gt;echo
&lt;span class=&quot;token key atrule&quot;&gt;spec&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt;           &lt;span class=&quot;token comment&quot;&gt;# 리소스를 정의하기 위한 속성.&lt;/span&gt;
  &lt;span class=&quot;token key atrule&quot;&gt;containers&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt;
  &lt;span class=&quot;token punctuation&quot;&gt;-&lt;/span&gt; &lt;span class=&quot;token key atrule&quot;&gt;name&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt; nginx &lt;span class=&quot;token comment&quot;&gt;# 컨테이너 이름&lt;/span&gt;
    &lt;span class=&quot;token key atrule&quot;&gt;image&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt; gihyodocker/nginx&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt;latest &lt;span class=&quot;token comment&quot;&gt;# 도커 허브에 저장된 이미지 태그값&lt;/span&gt;
    &lt;span class=&quot;token key atrule&quot;&gt;env&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt;        &lt;span class=&quot;token comment&quot;&gt;# 환경변수&lt;/span&gt;
    &lt;span class=&quot;token punctuation&quot;&gt;-&lt;/span&gt; &lt;span class=&quot;token key atrule&quot;&gt;name&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt; BACKEND_HOST
      &lt;span class=&quot;token key atrule&quot;&gt;value&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt; localhost&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt;&lt;span class=&quot;token number&quot;&gt;8080&lt;/span&gt;
    &lt;span class=&quot;token key atrule&quot;&gt;ports&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt;      &lt;span class=&quot;token comment&quot;&gt;# 컨테이너가 노출시킬 포트를 지정 (도커파일에서 지정한 경우 따로 지정할필요 x)&lt;/span&gt;
    &lt;span class=&quot;token punctuation&quot;&gt;-&lt;/span&gt; &lt;span class=&quot;token key atrule&quot;&gt;containerPort&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;token number&quot;&gt;80&lt;/span&gt;
  &lt;span class=&quot;token punctuation&quot;&gt;-&lt;/span&gt; &lt;span class=&quot;token key atrule&quot;&gt;name&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt; echo
    &lt;span class=&quot;token key atrule&quot;&gt;image&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt; gihyodocker/echo&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt;latest
    &lt;span class=&quot;token key atrule&quot;&gt;ports&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt;
    &lt;span class=&quot;token punctuation&quot;&gt;-&lt;/span&gt; &lt;span class=&quot;token key atrule&quot;&gt;containerPort&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;token number&quot;&gt;8080&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;h3&gt;ReplicaSet&lt;/h3&gt;
&lt;p&gt;ReplicaSet는 똑같은 정의를 갖는 파드를 여러개 생성하고 관리하기 위한 리소스다.&lt;/p&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;yaml&quot;&gt;&lt;pre class=&quot;language-yaml&quot;&gt;&lt;code class=&quot;language-yaml&quot;&gt;&lt;span class=&quot;token key atrule&quot;&gt;piVersion&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt; apps/v1
&lt;span class=&quot;token key atrule&quot;&gt;kind&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt; ReplicaSet
&lt;span class=&quot;token key atrule&quot;&gt;metadata&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt;
  &lt;span class=&quot;token key atrule&quot;&gt;name&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt; echo
  &lt;span class=&quot;token key atrule&quot;&gt;labels&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt;
    &lt;span class=&quot;token key atrule&quot;&gt;app&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt; echo
&lt;span class=&quot;token key atrule&quot;&gt;spec&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt;
  &lt;span class=&quot;token key atrule&quot;&gt;replicas&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;token number&quot;&gt;3&lt;/span&gt;
  &lt;span class=&quot;token key atrule&quot;&gt;selector&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt;
    &lt;span class=&quot;token key atrule&quot;&gt;matchLabels&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt;
      &lt;span class=&quot;token key atrule&quot;&gt;app&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt; echo
  &lt;span class=&quot;token key atrule&quot;&gt;template&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;token comment&quot;&gt;# template 아래는 파드 리소스 정의와 같음&lt;/span&gt;
    &lt;span class=&quot;token key atrule&quot;&gt;metadata&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt;
      &lt;span class=&quot;token key atrule&quot;&gt;labels&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt;
        &lt;span class=&quot;token key atrule&quot;&gt;app&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt; echo
    &lt;span class=&quot;token key atrule&quot;&gt;spec&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt;
      &lt;span class=&quot;token key atrule&quot;&gt;containers&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt;
      &lt;span class=&quot;token punctuation&quot;&gt;-&lt;/span&gt; &lt;span class=&quot;token key atrule&quot;&gt;name&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt; nginx
        &lt;span class=&quot;token key atrule&quot;&gt;image&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt; gihyodocker/nginx&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt;latest
        &lt;span class=&quot;token key atrule&quot;&gt;env&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt;
        &lt;span class=&quot;token punctuation&quot;&gt;-&lt;/span&gt; &lt;span class=&quot;token key atrule&quot;&gt;name&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt; BACKEND_HOST
          &lt;span class=&quot;token key atrule&quot;&gt;value&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt; localhost&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt;&lt;span class=&quot;token number&quot;&gt;8080&lt;/span&gt;
        &lt;span class=&quot;token key atrule&quot;&gt;ports&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt;
        &lt;span class=&quot;token punctuation&quot;&gt;-&lt;/span&gt; &lt;span class=&quot;token key atrule&quot;&gt;containerPort&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;token number&quot;&gt;80&lt;/span&gt;
      &lt;span class=&quot;token punctuation&quot;&gt;-&lt;/span&gt; &lt;span class=&quot;token key atrule&quot;&gt;name&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt; echo
        &lt;span class=&quot;token key atrule&quot;&gt;image&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt; gihyodocker/echo&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt;latest
        &lt;span class=&quot;token key atrule&quot;&gt;ports&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt;
        &lt;span class=&quot;token punctuation&quot;&gt;-&lt;/span&gt; &lt;span class=&quot;token key atrule&quot;&gt;containerPort&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;token number&quot;&gt;8080&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;h3&gt;Deployment&lt;/h3&gt;
&lt;p&gt;ReplicaSet보다 상위에 해당하는 리소스로 Deployment가 있다. Deployment는 어플리케이션 배포의 기본단위가 되는 리소스이다.
Deployment의 정의는 ReplicaSet의 정의와 크게 다르지 않다. 차이가 있다면 Deployment가 ReplicaSet의 리비전 관리를 할 수 있다는 점 정도다.&lt;/p&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;yaml&quot;&gt;&lt;pre class=&quot;language-yaml&quot;&gt;&lt;code class=&quot;language-yaml&quot;&gt;&lt;span class=&quot;token key atrule&quot;&gt;apiVersion&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt; apps/v1
&lt;span class=&quot;token key atrule&quot;&gt;kind&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt; Deployment
&lt;span class=&quot;token key atrule&quot;&gt;metadata&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt;
  &lt;span class=&quot;token key atrule&quot;&gt;name&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt; echo
  &lt;span class=&quot;token key atrule&quot;&gt;labels&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt;
    &lt;span class=&quot;token key atrule&quot;&gt;app&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt; echo
&lt;span class=&quot;token key atrule&quot;&gt;spec&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt;
  &lt;span class=&quot;token key atrule&quot;&gt;replicas&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;token number&quot;&gt;3&lt;/span&gt;
  &lt;span class=&quot;token key atrule&quot;&gt;selector&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt;
    &lt;span class=&quot;token key atrule&quot;&gt;matchLabels&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt;
      &lt;span class=&quot;token key atrule&quot;&gt;app&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt; echo
  &lt;span class=&quot;token key atrule&quot;&gt;template&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;token comment&quot;&gt;# template 아래는 파드 리소스 정의와 같음&lt;/span&gt;
    &lt;span class=&quot;token key atrule&quot;&gt;metadata&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt;
      &lt;span class=&quot;token key atrule&quot;&gt;labels&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt;
        &lt;span class=&quot;token key atrule&quot;&gt;app&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt; echo
    &lt;span class=&quot;token key atrule&quot;&gt;spec&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt;
      &lt;span class=&quot;token key atrule&quot;&gt;containers&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt;
      &lt;span class=&quot;token punctuation&quot;&gt;-&lt;/span&gt; &lt;span class=&quot;token key atrule&quot;&gt;name&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt; nginx
        &lt;span class=&quot;token key atrule&quot;&gt;image&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt; gihyodocker/nginx&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt;latest
        &lt;span class=&quot;token key atrule&quot;&gt;env&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt;
        &lt;span class=&quot;token punctuation&quot;&gt;-&lt;/span&gt; &lt;span class=&quot;token key atrule&quot;&gt;name&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt; BACKEND_HOST
          &lt;span class=&quot;token key atrule&quot;&gt;value&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt; localhost&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt;&lt;span class=&quot;token number&quot;&gt;8080&lt;/span&gt;
        &lt;span class=&quot;token key atrule&quot;&gt;ports&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt;
        &lt;span class=&quot;token punctuation&quot;&gt;-&lt;/span&gt; &lt;span class=&quot;token key atrule&quot;&gt;containerPort&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;token number&quot;&gt;80&lt;/span&gt;
      &lt;span class=&quot;token punctuation&quot;&gt;-&lt;/span&gt; &lt;span class=&quot;token key atrule&quot;&gt;name&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt; echo
        &lt;span class=&quot;token key atrule&quot;&gt;image&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt; gihyodocker/echo&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt;patched
        &lt;span class=&quot;token key atrule&quot;&gt;env&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt;
        &lt;span class=&quot;token punctuation&quot;&gt;-&lt;/span&gt; &lt;span class=&quot;token key atrule&quot;&gt;name&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt; HOGE
          &lt;span class=&quot;token key atrule&quot;&gt;value&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt; fuga
        &lt;span class=&quot;token key atrule&quot;&gt;ports&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt;
        &lt;span class=&quot;token punctuation&quot;&gt;-&lt;/span&gt; &lt;span class=&quot;token key atrule&quot;&gt;containerPort&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;token number&quot;&gt;8080&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;h2&gt;3. 리소스의 이름&lt;/h2&gt;
&lt;p&gt;리소스의 이름을 설정한다. kubectl 명령 등으로 조작을 할 때 식별에 사용하므로 짧고 알기 쉬운 이름이 선호된다.&lt;/p&gt;
&lt;h2&gt;4. 리소스의 상세 정보&lt;/h2&gt;
&lt;p&gt;리소스의 상세 정보를 설정한다. 리소스의 종류에 따라 설정할 수 있는 값이 달라진다.&lt;/p&gt;
&lt;p&gt;예를 들어 Pod의 경우 다음과 같은 값을 설정한다.&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;컨테이너의 이름&lt;/li&gt;
&lt;li&gt;컨테이너 이미지의 저장 위치&lt;/li&gt;
&lt;li&gt;컨테이너가 전송할 포트 번호&lt;/li&gt;
&lt;li&gt;컨테이너가 내부에서 사용하는 환경 변수에 대한 참조&lt;/li&gt;
&lt;/ul&gt;
&lt;h1&gt;출처&lt;/h1&gt;
&lt;p&gt;&lt;a href=&quot;https://kimjingo.tistory.com/126&quot;&gt;https://kimjingo.tistory.com/126&lt;/a&gt;&lt;/br&gt;
&lt;a href=&quot;https://honggg0801.tistory.com/45&quot;&gt;https://honggg0801.tistory.com/45&lt;/a&gt;&lt;/br&gt;
&lt;a href=&quot;https://kkimsangheon.github.io/2019/05/27/kube6/&quot;&gt;https://kkimsangheon.github.io/2019/05/27/kube6/&lt;/a&gt;&lt;/p&gt;</content:encoded></item><item><title><![CDATA[[쿠버네티스 완벽 가이드] 05. API 리소스와 kubectl (2)]]></title><description><![CDATA[4.5 커맨드 라인 인터페이스(CLI) 도구 kubectl 쿠버네티스에서 클러스터 조작은 모두 쿠버네티스 마스터의 API를 통해 이루어진다. 직접 API를 호출해도 되지만, 커맨드 라인 인터페이스 도구 kubectl을 사용하여서도 조작이 가능하다.…]]></description><link>https://github.com/SiverPineValley/SiverPineValley.github.io/kubernetes/kubernetes_4_2/</link><guid isPermaLink="false">https://github.com/SiverPineValley/SiverPineValley.github.io/kubernetes/kubernetes_4_2/</guid><pubDate>Sat, 30 Jul 2022 18:00:00 GMT</pubDate><content:encoded>&lt;h2&gt;4.5 커맨드 라인 인터페이스(CLI) 도구 kubectl&lt;/h2&gt;
&lt;p&gt;쿠버네티스에서 클러스터 조작은 모두 쿠버네티스 마스터의 API를 통해 이루어진다. 직접 API를 호출해도 되지만, 커맨드 라인 인터페이스 도구 kubectl을 사용하여서도 조작이 가능하다.&lt;/p&gt;
&lt;h3&gt;4.5.1 인증 정보와 컨텍스트 (config)&lt;/h3&gt;
&lt;p&gt;kubectl이 쿠버네티스 마스터와 통신할 때는 접속 대상의 서버 정보, 인증 정보 등이 필요하다. kubectl은 kubeconfig에 쓰여 있는 정보를 사용하여 접속한다. kubeconfig도 매니페스트와 동일한 형식으로 작성된다.&lt;/p&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;text&quot;&gt;&lt;pre class=&quot;language-text&quot;&gt;&lt;code class=&quot;language-text&quot;&gt;apiVersion: v1
kind: Config
preferences: {}
clusters: # 접속할 클러스터
  - name: sample-cluster
    cluster:
      server: https://localhost:6443
users: # 인증 정보
  - name: sample-user
    user:
      client-certificate-data: LS0tLS1CRUdJTi...
      client-key-data: LS0tLS1CRUdJTi...
contexts: # 접속 정보와 인증 정보 조합
  - name: sample-context
    context:
      cluster: sample-cluster
      namespace: default
      user: sample-user
current-context: sample-context&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;위 파일에서 구체적으로 설정이 되어 있는 부분은 clusters, users, contexts 세 가지로, 각각 배열로 되어 있어 여러 항목을 등록할 수 있다. clusters에서는 접속 대상 클러스터 정보, users에서는 인증 정보를 각각 정의한다. 사용자 인증에는 X.509 클라이언트 인증서/토큰/패스워드/웹훅(Webhook) 등 다양한 방식을 사용할 수 있다. contexts에서는 cluster와 user, 네임스페이스를 지정한 것을 정의한다.&lt;/p&gt;
&lt;p&gt;kubectl을 사용하면 위처럼 설정을 직접수정하지 않고도 설정을 수정할 수 있다.&lt;/p&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;sh&quot;&gt;&lt;pre class=&quot;language-sh&quot;&gt;&lt;code class=&quot;language-sh&quot;&gt;&lt;span class=&quot;token comment&quot;&gt;# 클러스터 (prd-cluster) 정의를 추가, 변경&lt;/span&gt;
$ kubectl config set-cluster prd-cluster &lt;span class=&quot;token punctuation&quot;&gt;\&lt;/span&gt;
&lt;span class=&quot;token parameter variable&quot;&gt;--server&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt;https://localhost:6443

&lt;span class=&quot;token comment&quot;&gt;# 인증 정보 정의를 추가, 변경&lt;/span&gt;
$ kubectl config set-credentials admin-user &lt;span class=&quot;token punctuation&quot;&gt;\&lt;/span&gt;
--client-certificate&lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt;./sample.crt &lt;span class=&quot;token punctuation&quot;&gt;\&lt;/span&gt;
--client-key-./sample.key &lt;span class=&quot;token punctuation&quot;&gt;\&lt;/span&gt;
--embed-certs&lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt;true

&lt;span class=&quot;token comment&quot;&gt;# 컨텍스트 정의(클러스터/인증 정보/네임스페이스 정의)를 추가, 변경&lt;/span&gt;
$ kubectl config set-context prd-admin &lt;span class=&quot;token punctuation&quot;&gt;\&lt;/span&gt;
&lt;span class=&quot;token parameter variable&quot;&gt;--cluster&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt;prd-cluster &lt;span class=&quot;token punctuation&quot;&gt;\&lt;/span&gt;
&lt;span class=&quot;token parameter variable&quot;&gt;--user&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt;admin-user &lt;span class=&quot;token punctuation&quot;&gt;\&lt;/span&gt;
&lt;span class=&quot;token parameter variable&quot;&gt;--namespace&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt;default&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;kubectl은 컨텍스트(current-context)를 전환하여 여러 환경을 여러 권한으로 조작할 수 있도록 설계되어 있다. 여기서 user 설정을 추가할 때의 인증서 파일은 &lt;a href=&quot;https://main--devlog-siverpinevalley.netlify.app/cert/openssl/&quot;&gt;openssl을 사용한 인증서 파일 생성&lt;/a&gt; 문서를 참고하면 생성할 수 있다.&lt;/p&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;sh&quot;&gt;&lt;pre class=&quot;language-sh&quot;&gt;&lt;code class=&quot;language-sh&quot;&gt;&lt;span class=&quot;token comment&quot;&gt;# 컨텍스트 목록 표시&lt;/span&gt;
$ kubectl config get-contexts

&lt;span class=&quot;token comment&quot;&gt;# 컨텍스트 전환&lt;/span&gt;
$ kubectl config use-context prd-admin

&lt;span class=&quot;token comment&quot;&gt;# 현재 컨텍스트 표시&lt;/span&gt;
$ kubectl config current-context

&lt;span class=&quot;token comment&quot;&gt;# 명령어 실행마다 컨텍스트 지정 가능&lt;/span&gt;
$ kindctl &lt;span class=&quot;token parameter variable&quot;&gt;--context&lt;/span&gt; prd-admin get pod&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;h3&gt;4.5.2 kubectx/kubens를 사용한 전환&lt;/h3&gt;
&lt;p&gt;컨텍스트나 네임스페이스를 전환할 때 kubectl 사용하는 것이 불편하다면, kubectx, kubems를 사용하면 좀 더 쉽게 전환이 가능하다.&lt;/p&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;sh&quot;&gt;&lt;pre class=&quot;language-sh&quot;&gt;&lt;code class=&quot;language-sh&quot;&gt;&lt;span class=&quot;token comment&quot;&gt;# 컨텍스트 전환&lt;/span&gt;
&lt;span class=&quot;token comment&quot;&gt;# kubectl config use-context prd-admin&lt;/span&gt;
$ kubectx prd-admin

&lt;span class=&quot;token comment&quot;&gt;# 바로 전 컨텍스트로 전환&lt;/span&gt;
$ kubectx -

&lt;span class=&quot;token comment&quot;&gt;# 네임스페이스 전환&lt;/span&gt;
&lt;span class=&quot;token comment&quot;&gt;# kubectl config set-context prd-admin --namespace=default&lt;/span&gt;
$ kubens default

&lt;span class=&quot;token comment&quot;&gt;# 컨텍스트 삭제&lt;/span&gt;
$ kubecctx &lt;span class=&quot;token parameter variable&quot;&gt;-d&lt;/span&gt; prd-admin&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;h3&gt;4.5.3 매니페스트와 리소스 생성/삭제 갱신&lt;/h3&gt;
&lt;p&gt;kubectl을 사용하여 실제 매니페스트를 기반으로 컨테이너를 기동해보겠다. 여기서는 하나의 컨테이너를 가진 파드를 sample-pod라는 이름으로 생성해보겠다. 여기서 pod란?&lt;/p&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;text&quot;&gt;&lt;pre class=&quot;language-text&quot;&gt;&lt;code class=&quot;language-text&quot;&gt;파드(Pod) 는 쿠버네티스에서 생성하고 관리할 수 있는 배포 가능한 가장 작은 컴퓨팅 단위이다.

파드 (고래 떼(pod of whales)나 콩꼬투리(pea pod)와 마찬가지로)는 하나 이상의 컨테이너의 그룹이다. 이 그룹은 스토리지 및 네트워크를 공유하고, 해당 컨테이너를 구동하는 방식에 대한 명세를 갖는다. 파드의 콘텐츠는 항상 함께 배치되고, 함께 스케줄되며, 공유 콘텍스트에서 실행된다. 파드는 애플리케이션 별 &quot;논리 호스트&quot;를 모델링한다. 여기에는 상대적으로 밀접하게 결합된 하나 이상의 애플리케이션 컨테이너가 포함된다. 클라우드가 아닌 콘텍스트에서, 동일한 물리 또는 가상 머신에서 실행되는 애플리케이션은 동일한 논리 호스트에서 실행되는 클라우드 애플리케이션과 비슷하다.

애플리케이션 컨테이너와 마찬가지로, 파드에는 파드 시작 중에 실행되는 초기화 컨테이너가 포함될 수 있다. 클러스터가 제공하는 경우, 디버깅을 위해 임시 컨테이너를 삽입할 수도 있다.

도커 개념 측면에서, 파드는 공유 네임스페이스와 공유 파일시스템 볼륨이 있는 도커 컨테이너 그룹과 비슷하다.
출처: https://kubernetes.io/ko/docs/concepts/workloads/pods/&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;yaml&quot;&gt;&lt;pre class=&quot;language-yaml&quot;&gt;&lt;code class=&quot;language-yaml&quot;&gt;&lt;span class=&quot;token key atrule&quot;&gt;apiVersion&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt; v1
&lt;span class=&quot;token key atrule&quot;&gt;kind&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt; Pod
&lt;span class=&quot;token key atrule&quot;&gt;metadata&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt;
    &lt;span class=&quot;token key atrule&quot;&gt;name&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt; sample&lt;span class=&quot;token punctuation&quot;&gt;-&lt;/span&gt;pod
&lt;span class=&quot;token key atrule&quot;&gt;spec&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt;
    &lt;span class=&quot;token key atrule&quot;&gt;containers&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt;
    &lt;span class=&quot;token punctuation&quot;&gt;-&lt;/span&gt; &lt;span class=&quot;token key atrule&quot;&gt;name&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt; nginx&lt;span class=&quot;token punctuation&quot;&gt;-&lt;/span&gt;container
    &lt;span class=&quot;token key atrule&quot;&gt;image&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt; nginx&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt;&lt;span class=&quot;token number&quot;&gt;1.16&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;여기서 리소스를 생성할 때는 kubectl create 명령어를 사용한다.&lt;/p&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;sh&quot;&gt;&lt;pre class=&quot;language-sh&quot;&gt;&lt;code class=&quot;language-sh&quot;&gt;&lt;span class=&quot;token comment&quot;&gt;# pod 생성&lt;/span&gt;
$ kubectl create &lt;span class=&quot;token parameter variable&quot;&gt;-f&lt;/span&gt; sample-pod.yaml

&lt;span class=&quot;token comment&quot;&gt;# pod 목록 표시&lt;/span&gt;
$ kubectl get pods

&lt;span class=&quot;token comment&quot;&gt;# pod 삭제 (해당 매니페스트 해당하는 pod 모두 삭제)&lt;/span&gt;
$ kubectl delete &lt;span class=&quot;token parameter variable&quot;&gt;-f&lt;/span&gt; sample-pod.yaml

&lt;span class=&quot;token comment&quot;&gt;# 특정 리소스만 삭제&lt;/span&gt;
$ kubectl delete pod sample-pod

&lt;span class=&quot;token comment&quot;&gt;# 특정 리소스 모두 삭제&lt;/span&gt;
$ kubectl delete pod &lt;span class=&quot;token parameter variable&quot;&gt;-all&lt;/span&gt;

&lt;span class=&quot;token comment&quot;&gt;# 리소스 삭제 (삭제 완료 대기)&lt;/span&gt;
$ kubectl delete &lt;span class=&quot;token parameter variable&quot;&gt;-f&lt;/span&gt; sample-pod.yaml &lt;span class=&quot;token parameter variable&quot;&gt;--wait&lt;/span&gt;

&lt;span class=&quot;token comment&quot;&gt;# 리소스 즉시 강제 삭제&lt;/span&gt;
$ kubectl delete &lt;span class=&quot;token parameter variable&quot;&gt;-f&lt;/span&gt; sample-pod.yaml --grace-period &lt;span class=&quot;token number&quot;&gt;0&lt;/span&gt; &lt;span class=&quot;token parameter variable&quot;&gt;--force&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;kubectl 명령어 실행은 바로 완료되지만, 실제 쿠버네티스에 의한 리소스 처리는 비동기로 진행되어 바로 완료되지 않는다. --wait 옵션을 사용하면 삭제 완료를 기다렸다가 명령어 실행을 종료할 수 있다.&lt;/p&gt;
&lt;p&gt;리소스 업데이트는 다음과 같이 진행할 수 있다. 명령어는  &lt;code class=&quot;language-text&quot;&gt;kubectl apply -f &quot;매니페스트 파일명&quot;&lt;/code&gt; 으로 실행할 수 있고, 같은 이름으로 실행 중인 pod을 교체하거나 생성되지 않은 pod일 경우에는 새롭게 pod을 실행한다.&lt;/p&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;sh&quot;&gt;&lt;pre class=&quot;language-sh&quot;&gt;&lt;code class=&quot;language-sh&quot;&gt;&lt;span class=&quot;token comment&quot;&gt;# sample-pod.yaml 파일을 sample-pod-old.yaml로 변경&lt;/span&gt;
$ &lt;span class=&quot;token function&quot;&gt;cp&lt;/span&gt; sample-pod.yaml sample-pod-old.yaml

&lt;span class=&quot;token comment&quot;&gt;#  일부 수정한 sample-pod.yaml 변경 사항&lt;/span&gt;
$ &lt;span class=&quot;token function&quot;&gt;diff&lt;/span&gt; sample-pod.yaml.old sample-pod.yaml

&lt;span class=&quot;token comment&quot;&gt;# 변경 사항이 있을 경우&lt;/span&gt;
$ kubectl apply &lt;span class=&quot;token parameter variable&quot;&gt;-f&lt;/span&gt; sample-pod.yaml
pod/sample-pod configured

&lt;span class=&quot;token comment&quot;&gt;# 변경 사항이 없을 경우&lt;/span&gt;
$ kubectl apply &lt;span class=&quot;token parameter variable&quot;&gt;-f&lt;/span&gt; sample-pod.yaml
pod/sample-pod unchanged

&lt;span class=&quot;token comment&quot;&gt;# 리소스가 존재하지 않을 경우&lt;/span&gt;
$ kubectl apply &lt;span class=&quot;token parameter variable&quot;&gt;-f&lt;/span&gt; sample-pod.yaml
pod/sample-pod created

&lt;span class=&quot;token comment&quot;&gt;# sample-pod에서 사용 중인 이미지 확인&lt;/span&gt;
$ kubectl get pod sample-pod &lt;span class=&quot;token parameter variable&quot;&gt;-o&lt;/span&gt; &lt;span class=&quot;token assign-left variable&quot;&gt;jsonpath&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;token string&quot;&gt;&quot;{.spec.containers[?(@.name == &apos;nginx-container&apos;)].image}&quot;&lt;/span&gt;
nginx1.17&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;쿠버네티스는 생성한 리소스 상태를 내부에 기록한다. &lt;code class=&quot;language-text&quot;&gt;kubectl apply&lt;/code&gt; 명령어를 통해 대부분 내부 설정을 변경 가능하지만, 일부 변경 불가능한 항목들도 있다. &lt;code class=&quot;language-text&quot;&gt;kubectl apply&lt;/code&gt;는 앞서 설명한 대로 리소스의 생성/변경이 모두 가능하다는 점에서 &lt;code class=&quot;language-text&quot;&gt;kubectl create&lt;/code&gt; 명령어를 대체할 수 있다. &lt;code class=&quot;language-text&quot;&gt;kubectl apply&lt;/code&gt;는 이전에 적용한 매니페스트, 현재 클러스터에 등록된 리소스 상태, 이번에 적용할 매니페스트에서 산출되는데, &lt;code class=&quot;language-text&quot;&gt;kubectl create --save-config&lt;/code&gt;이나 &lt;code class=&quot;language-text&quot;&gt;kubectl apply&lt;/code&gt;를 실행하여 리소스를 생성한 경우에만 리소스의 &lt;code class=&quot;language-text&quot;&gt;metadata.annotations.kubectl.kubernetes.io/last-applied-configuration&lt;/code&gt;에 원라이너의 JSON형식으로 저장된다. 그 이외의 방법으로는 저장되지 않는다. 그 때문에 &apos;이번에 적용할 매니페스트&apos;에서 특정 필드를 삭제할 경우에는 변경 사항을 산출하지 못하고 의도한 대로 반영되지 않는 필드가 발생하게 된다. 이에 생성 시에도 &lt;code class=&quot;language-text&quot;&gt;kubectl apply&lt;/code&gt;를 사용하는 것이 바람직하다.&lt;/p&gt;
&lt;h2&gt;4.5.4 Server-side apply&lt;/h2&gt;
&lt;p&gt;앞서 배운 &lt;code class=&quot;language-text&quot;&gt;kubectl apply&lt;/code&gt; 명령어는 client-side의 매니페스트를 참고로 적용하는 명령어로, 명령어가 실행되면 server-side의 매니페스트에도 자동적으로 적용된다. 그런데 server-side 매니페스트를 조절하는 명령어에는 &lt;code class=&quot;language-text&quot;&gt;kubectl set image&lt;/code&gt;라는 명령어도 있다. 이 명령어는 server-side의 매니페스트에만 적용되므로, client-side의 명령어와의 형상이 틀어지게 된다. 이때 다시 client-side의 매니페스트를 수정한뒤 &lt;code class=&quot;language-text&quot;&gt;kubectl apply&lt;/code&gt;를 실행하면, &lt;code class=&quot;language-text&quot;&gt;kubectl set image&lt;/code&gt;로 적용했던 부분은 초기화되버린다.&lt;/p&gt;
&lt;p&gt;이를 방지하기 위해 &lt;code class=&quot;language-text&quot;&gt;kubectl apply&lt;/code&gt; 명령어에서는 &lt;code class=&quot;language-text&quot;&gt;--server-side&lt;/code&gt; 옵션을 제공한다. server-side apply는 서버측에서 충돌을 감지하여 사용자에게 알려준다. server-side apply 구조는 충돌 감지와 변경 사항 감지를 위한 필드를 관리하는 것으로 구현된다. 필드를 관리하는 요소를 &lt;code class=&quot;language-text&quot;&gt;manager&lt;/code&gt;라고 부르며, &lt;code class=&quot;language-text&quot;&gt;metadata.managedFields&lt;/code&gt;에 manager와 manager가 관리하는 필드가 저장된다.&lt;/p&gt;
&lt;p&gt;kubectl 명령에어서 조작한 필드에 대한 manager의 이름은 기본적으로 kubectl로 되어 있다. CI/CD 등에서 사용되는 kubectl과 관리자/운영자가 콘솔에서 사용하는 kubectl이 구분되지 않으면 양쪽 명령어 실행으로 예기치 않은 충돌이 발생하게 된다. 따라서 server-side apply를 활성화한 후 kubectl apply 명령어를 실행할 때 &lt;code class=&quot;language-text&quot;&gt;--field-manager&lt;/code&gt; 옵션을 사용하여 manager 이름을 자유롭게 변경할 수 있다. 이를 사용하면 같은 kubectl에서 조작하는 경우에도 충돌을 감지할 수 있다.&lt;/p&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;sh&quot;&gt;&lt;pre class=&quot;language-sh&quot;&gt;&lt;code class=&quot;language-sh&quot;&gt;&lt;span class=&quot;token comment&quot;&gt;# server-side apply를 활성화하여 이전 매니펫트 생성&lt;/span&gt;
$ kubectl apply &lt;span class=&quot;token parameter variable&quot;&gt;-f&lt;/span&gt; sample-pod-old.yaml --server-side

&lt;span class=&quot;token comment&quot;&gt;# 이미지 변경&lt;/span&gt;
$ kubectl &lt;span class=&quot;token builtin class-name&quot;&gt;set&lt;/span&gt; image pod sample-pod nginx-container&lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt;nginx:1.17

&lt;span class=&quot;token comment&quot;&gt;# server-side apply를 통해 매니페스트 적용&lt;/span&gt;
$ kubectl apply &lt;span class=&quot;token parameter variable&quot;&gt;-f&lt;/span&gt; sample-pod.yaml --server-side

&lt;span class=&quot;token comment&quot;&gt;# 충돌(conflict)를 무시하고 매니페스트 적용&lt;/span&gt;
$ kubectl apply &lt;span class=&quot;token parameter variable&quot;&gt;-f&lt;/span&gt; sample-pod.yaml --server-side --force-conflicts

&lt;span class=&quot;token comment&quot;&gt;# Manager 이름을 변경하고 변경 내용을 적용 (CI 도구에서 실행한다고 가정)&lt;/span&gt;
$ kubectl apply &lt;span class=&quot;token parameter variable&quot;&gt;-f&lt;/span&gt; sample-pod.yaml --server-side --field-mansger ci-tool

&lt;span class=&quot;token comment&quot;&gt;# spec.containers[].image를 nginx:1.16에서 nginx:1.17로 변경&lt;/span&gt;
&lt;span class=&quot;token comment&quot;&gt;# Image 변경 적용(개발자/운영자) 콘솔에서 실행한다고 가정&lt;/span&gt;
$ kubectl apply &lt;span class=&quot;token parameter variable&quot;&gt;-f&lt;/span&gt; sample-pod.yaml --server-side&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;h2&gt;4.5.5 파드 재기동, 롤백&lt;/h2&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;sh&quot;&gt;&lt;pre class=&quot;language-sh&quot;&gt;&lt;code class=&quot;language-sh&quot;&gt;&lt;span class=&quot;token comment&quot;&gt;# 리소스 생성&lt;/span&gt;
$ kubectl apply &lt;span class=&quot;token parameter variable&quot;&gt;-f&lt;/span&gt; sample-deployment.yaml
$ kubectl apply &lt;span class=&quot;token parameter variable&quot;&gt;-f&lt;/span&gt; sample-pod.yaml

&lt;span class=&quot;token comment&quot;&gt;# Deployment 리소스의 모든 파드 재기동&lt;/span&gt;
$ kubectl rollout restart deployment sample-deployment

&lt;span class=&quot;token comment&quot;&gt;# 리소스와 연결되어 있지 않은 파드는 재기동 안 됨&lt;/span&gt;
$ kubectl rollout restart pod sample-pod

&lt;span class=&quot;token comment&quot;&gt;# Deployment 직전 리비전으로 롤백&lt;/span&gt;
$ kubectl rollout undo deployment &lt;span class=&quot;token builtin class-name&quot;&gt;echo&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;</content:encoded></item><item><title><![CDATA[[Cert] openssl을 사용한 인증서 파일 생성]]></title><description><![CDATA[1 비밀키(Private key), 공개키(Public Key) 생성 외부 인증기관에서 인증서를 전달받지 않고, 내부적으로 사용할 RSA 키 페어가 필요하다면 아래 설명된 절차를 통해서 간단하게 키 페어를 만들어 낼 수 있다. 1.1 RSA key…]]></description><link>https://github.com/SiverPineValley/SiverPineValley.github.io/cert/openssl/</link><guid isPermaLink="false">https://github.com/SiverPineValley/SiverPineValley.github.io/cert/openssl/</guid><pubDate>Sat, 30 Jul 2022 15:00:00 GMT</pubDate><content:encoded>&lt;h1&gt;1 비밀키(Private key), 공개키(Public Key) 생성&lt;/h1&gt;
&lt;p&gt;외부 인증기관에서 인증서를 전달받지 않고, 내부적으로 사용할 RSA 키 페어가 필요하다면 아래 설명된 절차를 통해서 간단하게 키 페어를 만들어 낼 수 있다.&lt;/p&gt;
&lt;h2&gt;1.1 RSA key pair 생성&lt;/h2&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;sh&quot;&gt;&lt;pre class=&quot;language-sh&quot;&gt;&lt;code class=&quot;language-sh&quot;&gt;openssl genrsa &lt;span class=&quot;token parameter variable&quot;&gt;-des3&lt;/span&gt; &lt;span class=&quot;token parameter variable&quot;&gt;-out&lt;/span&gt; private.pem &lt;span class=&quot;token number&quot;&gt;2048&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;private.pem파일을 열어보면 -----BEGIN RSA PRIVATE KEY----- 로 표시되는 것을 확인 할 수 있다.&lt;/p&gt;
&lt;h2&gt;1.2 Private key에 포함된 정보 확인&lt;/h2&gt;
&lt;p&gt;RSA private key로부터 public key를 만들어 낼 수 있다. 어떻게 그게 가능한지 보기 위해서 아래 명령어를 사용해보자.&lt;/p&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;sh&quot;&gt;&lt;pre class=&quot;language-sh&quot;&gt;&lt;code class=&quot;language-sh&quot;&gt;openssl rsa &lt;span class=&quot;token parameter variable&quot;&gt;-text&lt;/span&gt; &lt;span class=&quot;token parameter variable&quot;&gt;-in&lt;/span&gt; private.pem&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;위 명령어로 출력된 결과에 public key를 정의하는데 필요한 modulus와 publicExponent정보가 포함되어있는것을 알 수있다. 실제로 private key로부터 public key를 추출하기 위해서 다음 단계를 살펴보자.&lt;/p&gt;
&lt;h2&gt;1.3 Private key에서 Public key추출하기&lt;/h2&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;sh&quot;&gt;&lt;pre class=&quot;language-sh&quot;&gt;&lt;code class=&quot;language-sh&quot;&gt;openssl rsa &lt;span class=&quot;token parameter variable&quot;&gt;-in&lt;/span&gt; private.pem &lt;span class=&quot;token parameter variable&quot;&gt;-outform&lt;/span&gt; PEM &lt;span class=&quot;token parameter variable&quot;&gt;-pubout&lt;/span&gt; &lt;span class=&quot;token parameter variable&quot;&gt;-out&lt;/span&gt; public.pem&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;public.pem 파일을 열어서 -----BEGIN PUBLIC KEY----- 로 표시되는것을 확인 하면 된다.&lt;/p&gt;
&lt;h1&gt;2 비밀키를 사용한 인증서 파일 생성&lt;/h1&gt;
&lt;p&gt;다음으로는, 인증서(crt) 파일을 생성해보겠다.&lt;/p&gt;
&lt;h2&gt;2.1 비밀 키 생성&lt;/h2&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;sh&quot;&gt;&lt;pre class=&quot;language-sh&quot;&gt;&lt;code class=&quot;language-sh&quot;&gt;openssl genrsa &lt;span class=&quot;token parameter variable&quot;&gt;-out&lt;/span&gt; private.key &lt;span class=&quot;token number&quot;&gt;2048&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;h2&gt;2.2 CRT 파일을 만들기 위해 필요한 정보를 암호화한 인증서 생성 요청 파일 생성&lt;/h2&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;sh&quot;&gt;&lt;pre class=&quot;language-sh&quot;&gt;&lt;code class=&quot;language-sh&quot;&gt;openssl req &lt;span class=&quot;token parameter variable&quot;&gt;-new&lt;/span&gt; &lt;span class=&quot;token parameter variable&quot;&gt;-key&lt;/span&gt; &lt;span class=&quot;token string&quot;&gt;&quot;KEY 경로&quot;&lt;/span&gt; &lt;span class=&quot;token parameter variable&quot;&gt;-out&lt;/span&gt; &lt;span class=&quot;token string&quot;&gt;&quot;CSR 저장 경로&quot;&lt;/span&gt; &lt;span class=&quot;token parameter variable&quot;&gt;-config&lt;/span&gt; &lt;span class=&quot;token string&quot;&gt;&quot;REQ_INFO 경로&quot;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;ul&gt;
&lt;li&gt;Key 경로: Private Key가 저장된 경로&lt;/li&gt;
&lt;li&gt;CSR 저장 경로: CSR 파일이 저장될 경로&lt;/li&gt;
&lt;li&gt;REQ_INFO 경로: 인증서 생성 요청 파일 경로&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;위 명령어를 실행하기 전에 REQ_INFO 파일을 만든다.&lt;/p&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;text&quot;&gt;&lt;pre class=&quot;language-text&quot;&gt;&lt;code class=&quot;language-text&quot;&gt;[req] 
default_bit = 2048 
prompt = no 
distinguished_name = dn 

[dn] 
C=KR 
L=Seoul 
O=COMPANY 
OU=DEV 
emailAddress=EMailAddress ex)test@test.com
CN=IP 또는 Domain&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;h2&gt;2.3 인증서 파일(crt) 생성&lt;/h2&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;sh&quot;&gt;&lt;pre class=&quot;language-sh&quot;&gt;&lt;code class=&quot;language-sh&quot;&gt;openssl req &lt;span class=&quot;token parameter variable&quot;&gt;-x509&lt;/span&gt; &lt;span class=&quot;token parameter variable&quot;&gt;-days&lt;/span&gt; &lt;span class=&quot;token string&quot;&gt;&quot;인증서유효기간(일)&quot;&lt;/span&gt; &lt;span class=&quot;token parameter variable&quot;&gt;-key&lt;/span&gt; &lt;span class=&quot;token string&quot;&gt;&quot;KEY 경로&quot;&lt;/span&gt; &lt;span class=&quot;token parameter variable&quot;&gt;-in&lt;/span&gt; &lt;span class=&quot;token string&quot;&gt;&quot;CSR 경로&quot;&lt;/span&gt; &lt;span class=&quot;token parameter variable&quot;&gt;-out&lt;/span&gt; &lt;span class=&quot;token string&quot;&gt;&quot;CRT 저장 경로&quot;&lt;/span&gt; &lt;span class=&quot;token parameter variable&quot;&gt;-days&lt;/span&gt; &lt;span class=&quot;token string&quot;&gt;&quot;인증서유효기간(일)&quot;&lt;/span&gt; &lt;span class=&quot;token parameter variable&quot;&gt;-config&lt;/span&gt; &lt;span class=&quot;token string&quot;&gt;&quot;REQ_INFO 경로&quot;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;ul&gt;
&lt;li&gt;인증서 유효기간 : 일단위로 입력&lt;/li&gt;
&lt;li&gt;KEY 경로 : PrivateKey가 저장된 경로&lt;/li&gt;
&lt;li&gt;CSR 경로 : CSR 파일이 저장된 경로&lt;/li&gt;
&lt;li&gt;CRT 저장 경로 : CRT 파일을 저장 할 경로&lt;/li&gt;
&lt;li&gt;REQ_INFO 경로 : 인증서 생성 요청 정보 파일 경로&lt;/li&gt;
&lt;/ul&gt;
&lt;h1&gt;출처&lt;/h1&gt;
&lt;p&gt;&lt;a href=&quot;https://jjig810906.tistory.com/78&quot;&gt;https://jjig810906.tistory.com/78&lt;/a&gt; [프로그램마귀:티스토리]&lt;/br&gt;
&lt;a href=&quot;https://www.letmecompile.com/certificate-file-format-extensions-comparison/&quot;&gt;https://www.letmecompile.com/certificate-file-format-extensions-comparison/&lt;/a&gt;&lt;/p&gt;</content:encoded></item><item><title><![CDATA[[Cert] 인증서 파일 확장자 설명]]></title><description><![CDATA[openssl을 사용하여 인증서 파일을 생성하기 전에 각 파일 확장자 명이 궁금하여 찾아보다가 잘 정리된 자료가 있어 정리하였다. https…]]></description><link>https://github.com/SiverPineValley/SiverPineValley.github.io/cert/certificate_file/</link><guid isPermaLink="false">https://github.com/SiverPineValley/SiverPineValley.github.io/cert/certificate_file/</guid><pubDate>Sat, 30 Jul 2022 14:30:00 GMT</pubDate><content:encoded>&lt;p&gt;openssl을 사용하여 인증서 파일을 생성하기 전에 각 파일 확장자 명이 궁금하여 찾아보다가 잘 정리된 자료가 있어 정리하였다.&lt;/p&gt;
&lt;p&gt;https를 지원하는 웹서버를 설정하거나 서명이나 암호화 관련된 개발을 하게되면 한번씩 인증서 관련된 파일을 다룰 일이 생기게 된다. 이때 항상 프로그램이나 라이브러리들이 지원하는 형식이 달라서 인증서 형식을 변환해아 하는데 현재 갖고있는 파일의 형식이 무엇인지를 알아야 제대로 활용이 가능하다. 인증서 파일의 경우 인코딩 방식과 확장자가 일치하는 경우도 있고, 그렇지 않은 경우도 있기 때문에 아래와 같이 비교해서 정리해 보았다.&lt;/p&gt;
&lt;h1&gt;인코딩 (확장자로 쓰이기도 한다.)&lt;/h1&gt;
&lt;ul&gt;
&lt;li&gt;
&lt;p&gt;&lt;code class=&quot;language-text&quot;&gt;der&lt;/code&gt;:&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;Distinguished Encoding Representation (DER)&lt;/li&gt;
&lt;li&gt;바이너리 DER 형식으로 인코딩된 인증서. 텍스트 편집기에서 열었는데 읽어들일 수 없다면 이 인코딩일 확률이 높다.&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;&lt;code class=&quot;language-text&quot;&gt;pem&lt;/code&gt;:&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;PEM (Privacy Enhanced Mail)은 Base64인코딩된 ASCII text file이다.&lt;/li&gt;
&lt;li&gt;원래는 secure email에 사용되는 인코딩 포멧이었는데 더이상 email쪽에서는 잘 쓰이지 않고 인증서 또는 키값을 저장하는데 많이 사용된다.&lt;/li&gt;
&lt;li&gt;&lt;code class=&quot;language-text&quot;&gt;-----BEGIN XXX-----&lt;/code&gt;, &lt;code class=&quot;language-text&quot;&gt;-----END XXX-----&lt;/code&gt; 로 묶여있는 text file을 보면 이 형식으로 인코딩 되어있다고 생각하면 된다. (담고있는 내용이 무엇인지에 따라 XXX 위치에 CERTIFICATE, RSA PRIVATE KEY 등의 키워드가 들어있다)&lt;/li&gt;
&lt;li&gt;인증서(Certificate = public key), 비밀키(private key), 인증서 발급 요청을 위해 생성하는 CSR(Certificate Signing Request) 등을 저장하는데 사용된다.&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;/ul&gt;
&lt;h1&gt;확장자&lt;/h1&gt;
&lt;ul&gt;
&lt;li&gt;
&lt;p&gt;&lt;code class=&quot;language-text&quot;&gt;cer&lt;/code&gt;, &lt;code class=&quot;language-text&quot;&gt;crt&lt;/code&gt;:&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;.crt, .cer 인증서를 나타내는 확장자인 cer과 crt는 거의 동일하다고 생각하면 된다. (cer은 Microsoft 제품군에서 많이 사용되고, crt는 unix, linux 계열에서 많이 사용된다.)&lt;/li&gt;
&lt;li&gt;확장자인 cer이나 crt만 가지고는 파일을 열어보기 전에 인코딩이 어떻게되어있는지 판단하긴 힘들다.&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;&lt;code class=&quot;language-text&quot;&gt;key&lt;/code&gt;:&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;개인 또는 공개 PKCS#8 키를 의미&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;&lt;code class=&quot;language-text&quot;&gt;p12&lt;/code&gt;:&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;PKCS#12 형식으로 하나 또는 그이상의 certificate(public)과 그에 대응하는 private key를 포함하고 있는 key store 파일이며 패스워드로 암호화 되어있다. 열어서 내용을 확인하려면 패스워드가 필요하다.&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;&lt;code class=&quot;language-text&quot;&gt;pfx&lt;/code&gt;:&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;PKCS#12는 Microsoft의 PFX파일을 계승하여 만들어진 포멧이라 pfx와 p12를 구분없이 동일하게 사용하기도 한다.&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;/ul&gt;
&lt;h1&gt;표준 비교&lt;/h1&gt;
&lt;ul&gt;
&lt;li&gt;PKCS #8은 Public-Key Cryptography Standards (PKCS) 표준 중의 일부로 private key를 저장하는 문법에 관한 표준이다. PKCS #8 private keys 는 일반적으로 PEM 형식으로 인코딩된다.&lt;/li&gt;
&lt;li&gt;PKCS #12는 하나의 파일에 여러 암호화 관련 엔티티 들을 합쳐서 보관하는 방식에 관한 표준이다.&lt;/li&gt;
&lt;li&gt;X.509는 public key infrastructure (PKI)에 대한 ITU-T의 표준 (RFC 5280) 으로 공개키(public key) 인증서의 format, revocation list(더이상 유효하지 않은 인증서들에 대한 정보 배포), certification path(chain) validation 알고리즘 등을 정의한다. 보통 X.509 인증서라 하면 RFC 5280에 따라서 인코딩되거나 서명된 디지털 문서를 말한다.&lt;/li&gt;
&lt;/ul&gt;
&lt;h1&gt;출처&lt;/h1&gt;
&lt;p&gt;&lt;a href=&quot;https://www.letmecompile.com/certificate-file-format-extensions-comparison/&quot;&gt;https://www.letmecompile.com/certificate-file-format-extensions-comparison/&lt;/a&gt;&lt;/p&gt;</content:encoded></item><item><title><![CDATA[[Cert] 개인키, 공개키 키 종류 비교]]></title><description><![CDATA[…]]></description><link>https://github.com/SiverPineValley/SiverPineValley.github.io/cert/key/</link><guid isPermaLink="false">https://github.com/SiverPineValley/SiverPineValley.github.io/cert/key/</guid><pubDate>Sat, 30 Jul 2022 14:00:00 GMT</pubDate><content:encoded>&lt;p&gt;대학 때 컴퓨터 공학 과목을 들으며 한번 쯤은 외웠던 개념인데 몇 년이 지나다 보니 계속 까먹은 상태로 있어서... 한 번 정리해보자는 김에 작성하게 되었다. 보통 암호화, 복호화 시 사용하는 키가 같은지 다른지에 따라 개인키, 대칭키로 나뉜다. 용어가 여러 가지로 불리는데, 정리해보자면,&lt;/p&gt;
&lt;p&gt;개인키 = 비밀키 = 대칭키 = 비공개키
공개키 = 비대칭키&lt;/p&gt;
&lt;h1&gt;1. 개인키 (대칭키)&lt;/h1&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;text&quot;&gt;&lt;pre class=&quot;language-text&quot;&gt;&lt;code class=&quot;language-text&quot;&gt;- 개인키 (대칭키) 기법은 하나의 비밀키를 client, server가 모두 같이 사용하는 기법이다.
- 암호화, 복호화 시 사용하는 알고리즘이 동일하고 공개 키에 비해 계산 속도가 빠르다.
- 다만, 해커에 의해 비밀키가 탈취되면 데이터를 안전하게 보관할 수 없다.
- 대칭키는 암호화하는 단위에 따라 스트림암호화 블록암호로 나뉠 수 있다.
    - 스트림 암호화: 연속적인 비트/바이트를 계속하여 입력받아, 그에 대응하는 암호화 비트/바이트를 생성
    - 블록 암호화: 정해진 한 블록(단위)를 입력받아 그에 대응하는 암호화 블록을 생성. 블록암호의 경우 적절한 운용모드를 조합하면 블록 단위보다 큰 입력을 처리할  수 있음. 또한 스트림암호와 유사하게 지속적인 입력에 대해 동작할 수 있음. (대신 입출력 단위는 스트림암호보다 큰 블록 단위가 됨)
- 개인키 기법 알고리즘: DES, 3-DES, AES, SEED, ARIA, MASK&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;h1&gt;2. 공개키 (비대칭키)&lt;/h1&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;text&quot;&gt;&lt;pre class=&quot;language-text&quot;&gt;&lt;code class=&quot;language-text&quot;&gt;- 공개키 (비대칭키) 기법은 공개키, 비밀키 두 개의 키가 존재한다.
- 즉, 암호화와 복호화 시의 키가 다르다. 이에 비대칭 암호화 알고리즘을 사용한다.
- 암호화할 때는 공개키(public key), 복호화할 때는 비밀키(private key)가 사용된다.
- 공개키는 누구나 가지고 있지만, 비밀키는 소유자만 가지고 있어 특정 비밀키를 가지는 사용자만 내용을 볼 수 있다.
- 송신자는 수신자에게 공개키를 받아 내용을 암호화하여 전달하고, 수신자는 비밀키를 사용하여 암호화된 내용을 평문으로 복호화한다.
- 속도가 느리기 때문에 보통 긴 문서를 암호화하기 보다는, 대칭키를 암호화하는데 사용됨.
- 공개키 기법 알고리즘: RSA, Elgamal&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;div align=&quot;left&quot;&gt;
  &lt;span class=&quot;gatsby-resp-image-wrapper&quot; style=&quot;position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 400px; &quot;&gt;
      &lt;a class=&quot;gatsby-resp-image-link&quot; href=&quot;/static/104635a77b2c429f54e2b31e05cc8699/e17e5/private_key.png&quot; style=&quot;display: block&quot; target=&quot;_blank&quot; rel=&quot;noopener&quot;&gt;
    &lt;span class=&quot;gatsby-resp-image-background-image&quot; style=&quot;padding-bottom: 75.31645569620254%; position: relative; bottom: 0; left: 0; background-image: url(&apos;data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAPCAIAAABr+ngCAAAACXBIWXMAABJ0AAASdAHeZh94AAACIElEQVR42oVTSW/TQBTOL+BGrwj+B38IOBahCgmVRQIhVb3AhRunUkVKG5UiqqJEpalwC1nsxG2cxZN4SdzUSezxNmPHCc/NSirg01iaefO9+d7m2GiK4QLgaGJcqVbrCPX6xoQAlNFwtIDY6AbGzj6lRlf3XSfw/ZlxCRPnMAzbmlaro0ZTCSittLSPmV/xM26bKcCmrLSiWEhfMkXHt8iA/OEcBAFbKu9+PvjOZK/U1sbO11urGyuPnq88XIfN28T+iAxOGunXP54kK1tCtzTOIjYLVVZUEYRlxXWcitpOZEtxJh8/YxM5XpBV4MiaxHAngiCA0kSZUirLsmEYi8n4hHoYy6IIyzUNn0Rxuo7HczyQZ/nHPM9DCGGMx/phGF20tE46c7p/kErCl2HgGNVl2oh5wWbtGUwB1o6us0U+z5V+ZvPF83LnSgcjXIULAJcoZ0IIBA+ZgAkYsPd9CnZs9C0T0hlC2yJOEEQXNCIDgDkvWLfbVVS1rV1CYw3bLiDpmOVh5epSS+9FHOIOrx9d7jPIlqviYeo4x12ozeanI+bO+oe7a5v3Vt/cfvr+RfwLvNh+9/jywX28vRn2O2PB+ZA0JIW/ECp1ZGHMIelZMvVyL/1qL72WOPzGngPHKp3auSOv1xkGdHk8r2sQZX1zEsfntt5jCsWaKP5rtietDga27Rgm9shEx7HtBkK2Zf3f2XVdGKZarWaa5t9+jN/cGju5ADCa3wAAAABJRU5ErkJggg==&apos;); background-size: cover; display: block;&quot;&gt;&lt;/span&gt;
  &lt;img class=&quot;gatsby-resp-image-image&quot; alt=&quot;private key&quot; title=&quot;&quot; src=&quot;/static/104635a77b2c429f54e2b31e05cc8699/e17e5/private_key.png&quot; srcset=&quot;/static/104635a77b2c429f54e2b31e05cc8699/c26ae/private_key.png 158w,
/static/104635a77b2c429f54e2b31e05cc8699/6bdcf/private_key.png 315w,
/static/104635a77b2c429f54e2b31e05cc8699/e17e5/private_key.png 400w&quot; sizes=&quot;(max-width: 400px) 100vw, 400px&quot; style=&quot;width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;&quot; loading=&quot;lazy&quot; decoding=&quot;async&quot;&gt;
  &lt;/a&gt;
    &lt;/span&gt;
&lt;/div&gt;
&lt;br&gt;
&lt;div align=&quot;left&quot;&gt;
&lt;span class=&quot;gatsby-resp-image-wrapper&quot; style=&quot;position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 630px; &quot;&gt;
      &lt;a class=&quot;gatsby-resp-image-link&quot; href=&quot;/static/53c596c434261f0be9b3262d0fce53ae/8c557/compare.png&quot; style=&quot;display: block&quot; target=&quot;_blank&quot; rel=&quot;noopener&quot;&gt;
    &lt;span class=&quot;gatsby-resp-image-background-image&quot; style=&quot;padding-bottom: 68.35443037974683%; position: relative; bottom: 0; left: 0; background-image: url(&apos;data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAOCAIAAACgpqunAAAACXBIWXMAABJ0AAASdAHeZh94AAAB+UlEQVR42nVS25KaQBCd37TKrfiQLbMfYOmDVOn/xUtcYAggA4xcvADKHQyaI2RTWylzHqihp3vOOd1NxuPxfD5/e/vW6/VGo5EgCLPZbDgc9vv9r6+v06kgTIXJZPLy0v/yCYPBAF+iKAqV6X6/55yL7++bzWa1Wi2+L2zb3m63kij9WK+Xy4Ukyb7vu67reZ7bAgdyOBwYM1CZZfmOc8MwGGNpmt5ut/P5bJqm4+x0XUcQxXzHUYZ3+QM74jqOrmkpSotc0zRRFGVKLZPFSRqcTrJMVVWlVEE90n4qCuQkSZJlGQhIVVVlWd7u9+v1iidBBXJNVYuizPO8+ACy2kR8q6a5dXjIhov6+gsXqEQLjO2W2zZj5vF4tCzrcDi6rrNzHOhiJoNsBJFc1zWBgDi+lC3ADHFgRhC/kAdt3VVRPoQA5UNHeW1B8Ay67TgO8jRdR8+qump1VkEQgO1yuXTWPuGPF4KuybJs2Tam5Xq+wQzQ3VugjHPb97y/Jv8BwZxkWcIYIAmzgdT6AzjHcYx4/R8QCMbEmqZBEtzqqtp5g9QoDCEqOkfIK5+BoMOn0wmp8IxNwBgxZ7itqjoMA0ppGEW4LZ6BdBtzb+cMFd0vuo1ImiZYjbQ9P/cMqvV67e/3YMNio71RFIVBEIYhlm+5XOE59CJ8ht9iyund8zui2gAAAABJRU5ErkJggg==&apos;); background-size: cover; display: block;&quot;&gt;&lt;/span&gt;
  &lt;img class=&quot;gatsby-resp-image-image&quot; alt=&quot;compare&quot; title=&quot;&quot; src=&quot;/static/53c596c434261f0be9b3262d0fce53ae/f058b/compare.png&quot; srcset=&quot;/static/53c596c434261f0be9b3262d0fce53ae/c26ae/compare.png 158w,
/static/53c596c434261f0be9b3262d0fce53ae/6bdcf/compare.png 315w,
/static/53c596c434261f0be9b3262d0fce53ae/f058b/compare.png 630w,
/static/53c596c434261f0be9b3262d0fce53ae/8c557/compare.png 700w&quot; sizes=&quot;(max-width: 630px) 100vw, 630px&quot; style=&quot;width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;&quot; loading=&quot;lazy&quot; decoding=&quot;async&quot;&gt;
  &lt;/a&gt;
    &lt;/span&gt;
&lt;/div&gt;
&lt;h1&gt;출처&lt;/h1&gt;
&lt;p&gt;&lt;a href=&quot;https://gaeko-security-hack.tistory.com/123&quot;&gt;https://gaeko-security-hack.tistory.com/123&lt;/a&gt;&lt;/p&gt;</content:encoded></item><item><title><![CDATA[[쿠버네티스 완벽 가이드] 04. API 리소스와 kubectl (1)]]></title><description><![CDATA[본 장에서부터는 본격적으로 쿠버네티스 실습 내용을 기록하였다.
실습은 GKE(Google Kubernetes Engine)과 kind를 사용하였다. 4.1 실습 준비 본격적으로 컨테이너를 생성하기 전에 gcloud와 kind…]]></description><link>https://github.com/SiverPineValley/SiverPineValley.github.io/kubernetes/kubernetes_4_1/</link><guid isPermaLink="false">https://github.com/SiverPineValley/SiverPineValley.github.io/kubernetes/kubernetes_4_1/</guid><pubDate>Mon, 25 Jul 2022 23:00:00 GMT</pubDate><content:encoded>&lt;p&gt;본 장에서부터는 본격적으로 쿠버네티스 실습 내용을 기록하였다.
실습은 GKE(Google Kubernetes Engine)과 kind를 사용하였다.&lt;/p&gt;
&lt;h1&gt;4.1 실습 준비&lt;/h1&gt;
&lt;p&gt;본격적으로 컨테이너를 생성하기 전에 gcloud와 kind를 설치해두어야 한다.
kind는 &lt;a href=&quot;./kubernetes_3.md&quot;&gt;[쿠버네티스 완벽 가이드] 03. 쿠버네티스 환경&lt;/a&gt;에서 설치하는 방법을 안내하였다.
GKE는 아래와 같이 설치 가능하다.&lt;/p&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;sh&quot;&gt;&lt;pre class=&quot;language-sh&quot;&gt;&lt;code class=&quot;language-sh&quot;&gt;&lt;span class=&quot;token comment&quot;&gt;# Google Cloud SDK(gcloud 포함) 설치&lt;/span&gt;
$ &lt;span class=&quot;token function&quot;&gt;curl&lt;/span&gt; https://sdk.cloud.google.com &lt;span class=&quot;token operator&quot;&gt;|&lt;/span&gt; &lt;span class=&quot;token function&quot;&gt;bash&lt;/span&gt;

&lt;span class=&quot;token comment&quot;&gt;# 설치한 gcloud 명령어를 사용할 수 있도록 셀 재기동&lt;/span&gt;
$ &lt;span class=&quot;token builtin class-name&quot;&gt;exec&lt;/span&gt; &lt;span class=&quot;token parameter variable&quot;&gt;-l&lt;/span&gt; &lt;span class=&quot;token environment constant&quot;&gt;$SHELL&lt;/span&gt;

&lt;span class=&quot;token comment&quot;&gt;# gcloud init&lt;/span&gt;
$ gcloud init

&lt;span class=&quot;token comment&quot;&gt;# GKE에서 사용 가능한 쿠버네티스 버전 확인&lt;/span&gt;
$ gcloud container get-server-config &lt;span class=&quot;token parameter variable&quot;&gt;--zone&lt;/span&gt; asia-northeast3-a &lt;span class=&quot;token comment&quot;&gt;# asia-northeast3는 서울 리전&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;본격적으로 gcloud를 사용하기 전에 앞서 &lt;code class=&quot;language-text&quot;&gt;gcloud init&lt;/code&gt;에서 선택한 프로젝트에 결제 방법이 선택되어 있어야 하며, Google Cloud의 Kubernetes Engine API가 enable되어야 한다.
Kubernetes Engine API는 결제 방법이 선택되어 있어야 enable 가능하다.&lt;/p&gt;
&lt;div align=&quot;left&quot;&gt;
&lt;img src=&quot;./images/kubernetes_enable.png&quot; width=&quot;200px&quot; /&gt;
&lt;/div&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;sh&quot;&gt;&lt;pre class=&quot;language-sh&quot;&gt;&lt;code class=&quot;language-sh&quot;&gt;&lt;span class=&quot;token comment&quot;&gt;# GKE 클러스터 &apos;k8s&apos; 생성&lt;/span&gt;
$ gcloud container clusters create k8s &lt;span class=&quot;token punctuation&quot;&gt;\&lt;/span&gt;
--cluster-version &lt;span class=&quot;token number&quot;&gt;1.24&lt;/span&gt;.2-gke.300 &lt;span class=&quot;token punctuation&quot;&gt;\&lt;/span&gt; &lt;span class=&quot;token comment&quot;&gt;# validMasterVersion에 있는 쿠버네티스 버전 지정&lt;/span&gt;
&lt;span class=&quot;token parameter variable&quot;&gt;--zone&lt;/span&gt; asia-northeast3-a &lt;span class=&quot;token punctuation&quot;&gt;\&lt;/span&gt; &lt;span class=&quot;token comment&quot;&gt;# 존 설정&lt;/span&gt;
--num-nodes &lt;span class=&quot;token number&quot;&gt;3&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;\&lt;/span&gt; &lt;span class=&quot;token comment&quot;&gt;# 노드 수&lt;/span&gt;
--machine-type n1-standard-1 &lt;span class=&quot;token punctuation&quot;&gt;\&lt;/span&gt; &lt;span class=&quot;token comment&quot;&gt;# 인스턴스 유형 지정&lt;/span&gt;
--enable-network-policy &lt;span class=&quot;token punctuation&quot;&gt;\&lt;/span&gt; &lt;span class=&quot;token comment&quot;&gt;#네트워크 정책 기능 활성화&lt;/span&gt;
--enable-vertical-pod-autoscaling &lt;span class=&quot;token comment&quot;&gt;# VerticalPodAutoscaler 활성화&lt;/span&gt;

&lt;span class=&quot;token comment&quot;&gt;# GKE 클러스터에 대한 권한을 다시 가져오는 경우&lt;/span&gt;
$ gcloud container clusters get-credentials k8s &lt;span class=&quot;token parameter variable&quot;&gt;--zone&lt;/span&gt; asia-northeast3-a

&lt;span class=&quot;token comment&quot;&gt;# 알파 기능을 활성화한 클러스터 생성 시에는 아래와 같다.&lt;/span&gt;
&lt;span class=&quot;token comment&quot;&gt;# 알파 기능을 활성화한 클러스터는 30일 후에 삭제된다.&lt;/span&gt;
$ gcloud container clusters create k8s-alpha &lt;span class=&quot;token punctuation&quot;&gt;\&lt;/span&gt;
--cluster-version &lt;span class=&quot;token number&quot;&gt;1.24&lt;/span&gt;.2-gke.300 &lt;span class=&quot;token punctuation&quot;&gt;\&lt;/span&gt;
&lt;span class=&quot;token parameter variable&quot;&gt;--zone&lt;/span&gt; asia-northeast3-a &lt;span class=&quot;token punctuation&quot;&gt;\&lt;/span&gt;
--num-nodes &lt;span class=&quot;token number&quot;&gt;3&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;\&lt;/span&gt;
--machine-type n1-standard-1 &lt;span class=&quot;token punctuation&quot;&gt;\&lt;/span&gt;
--enable-network-policy &lt;span class=&quot;token punctuation&quot;&gt;\&lt;/span&gt;
--enable-vertical-pod-autoscaling &lt;span class=&quot;token punctuation&quot;&gt;\&lt;/span&gt;
--enable-kubernetes-alpha &lt;span class=&quot;token punctuation&quot;&gt;\&lt;/span&gt; &lt;span class=&quot;token comment&quot;&gt;# 쿠버네티스 알파 기능의 활성화&lt;/span&gt;
--no-enable-autorepair --no-enable-autoupgrade &lt;span class=&quot;token comment&quot;&gt;# 알파 기능을 활성화하기 때문에 일부 기능은 비활성화&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;다음으로는 구글 계정이 관리자 권한으로 쿠버네티스 클러스터를 관리할 수 있도록 다음 명령어를 실행해 두어야 한다. 구글 계정은 관리자 권한으로 관리하고 싶은 계정을 지정해야 한다.&lt;/p&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;sh&quot;&gt;&lt;pre class=&quot;language-sh&quot;&gt;&lt;code class=&quot;language-sh&quot;&gt;&lt;span class=&quot;token comment&quot;&gt;# 사용자에게 모든 리소스의 접속 권한 부여&lt;/span&gt;
$ kubectl create clusterrolebinding user-cluster-admin-binding &lt;span class=&quot;token punctuation&quot;&gt;\&lt;/span&gt;
&lt;span class=&quot;token parameter variable&quot;&gt;--clusterrole&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt;cluster-admin &lt;span class=&quot;token punctuation&quot;&gt;\&lt;/span&gt;
&lt;span class=&quot;token parameter variable&quot;&gt;--user&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt;SOMEONE@google.co.kr&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;GCE는 비교적 종량에 대한 과금 단가가 비싸기 때문에 불필요한 클러스터는 삭제해 두는 것이 좋다.&lt;/p&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;sh&quot;&gt;&lt;pre class=&quot;language-sh&quot;&gt;&lt;code class=&quot;language-sh&quot;&gt;gcloud container clusters delete k8s &lt;span class=&quot;token parameter variable&quot;&gt;--zone&lt;/span&gt; asia-northeast3-a&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;최신 버전의 기능은 3장에서 소개한 kind(Kubernetes in Docker)에서 구축한 클러스터를 사용한다.&lt;/p&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;sh&quot;&gt;&lt;pre class=&quot;language-sh&quot;&gt;&lt;code class=&quot;language-sh&quot;&gt;$ kind create cluster &lt;span class=&quot;token parameter variable&quot;&gt;--name&lt;/span&gt; kind-alpha-cluster &lt;span class=&quot;token parameter variable&quot;&gt;--config&lt;/span&gt; kind-alpha.yaml&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;h1&gt;4.2 쿠버네티스 기초&lt;/h1&gt;
&lt;p&gt;쿠버네티스는 쿠버네티스 마스터와 쿠버네티스 노드로 구성되어 있다. 마스터는 API 엔드포인트 제공, 컨테이너 스케줄링, 컨테이너 스케일링 등을 담당하는 노드이다. 쿠버네티스 노드는 도커 호스트에 해당되며, 실제로 컨테이너를 기동시키는 노드이다. 쿠버네티스 클러스터를 관리하려면 CLI도구인 kubectl과 YAML형식이나 JSON형식으로 된 매니페스트 파일을 사용하여 쿠버네티스 마스터에 &apos;리소스&apos;를 등록해야 한다. 매니페스트 파일은 가독성을 고려하여 YAML 형식으로 작성하는 것이 일반적이다. kubectl은 매니페스트 파일 정보를 파탕으로 쿠버네티스 마스터가 가진 API에 요청을 보내 쿠버네티스를 관리한다. 쿠버네티스 API는 RESTful APi 라이브러니나 curl 명령어 도구를 사용하여 직접 API를 호출하여 쿠버네티스를 관리할 수도 있다.&lt;/p&gt;
&lt;h2&gt;4.3 쿠버네티스와 리소스&lt;/h2&gt;
&lt;p&gt;쿠버네티스를 관리하기 위해 등록하는 &apos;리소스&apos;는 컨테이너의 실행과 로드 밸런서 생성 등 많은 종류가 있다. 리소스는 크게 아래와 같이 다섯 가지 카테고리로 구분된다.&lt;/p&gt;
&lt;table&gt;
&lt;thead&gt;
&lt;tr&gt;
&lt;th&gt;종류&lt;/th&gt;
&lt;th&gt;개요&lt;/th&gt;
&lt;/tr&gt;
&lt;/thead&gt;
&lt;tbody&gt;
&lt;tr&gt;
&lt;td&gt;워크로드 API 카테고리&lt;/td&gt;
&lt;td&gt;컨테이너 실행에 관련된 리소스&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;서비스 API 카테고리&lt;/td&gt;
&lt;td&gt;컨테이너를 외부에 공개하는 엔드포인트를 제공하는 리소스&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;컨피그 &amp;#x26; 스토리지 API 카테고리&lt;/td&gt;
&lt;td&gt;설정/기밀 정보/영구 볼륨 등에 관련된 리소스&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;클러스터 API 카테고리&lt;/td&gt;
&lt;td&gt;보안이나 쿼터 등에 관련된 리소스&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;메타데이터 API 카테고리&lt;/td&gt;
&lt;td&gt;클러스터 내부의 다른 리소스를 관리하기 위한 리소스&lt;/td&gt;
&lt;/tr&gt;
&lt;/tbody&gt;
&lt;/table&gt;
&lt;h3&gt;4.3.1 워크로드 API 리소스&lt;/h3&gt;
&lt;p&gt;워크로드 API 카테고리는 클러스터 위에서 컨테이너를 기동하기 위해 사용되는 리소스이다.&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;파드(Pod)&lt;/li&gt;
&lt;li&gt;레플리케이션 컨트롤러(ReplicationController)&lt;/li&gt;
&lt;li&gt;레플리카셋(ReplicaSet)&lt;/li&gt;
&lt;li&gt;디플로이먼트(Deployment)&lt;/li&gt;
&lt;li&gt;데몬셋(DaemonSet)&lt;/li&gt;
&lt;li&gt;스테이트풀셋(StatefulSet)&lt;/li&gt;
&lt;li&gt;잡(Job)&lt;/li&gt;
&lt;li&gt;크론잡(CronJob)&lt;/li&gt;
&lt;/ul&gt;
&lt;h3&gt;4.3.2 서비스 API 카테고리&lt;/h3&gt;
&lt;p&gt;서비스 API 카테고리는 컨테이너 서비스 디스커버리와 클러스터 외부에서도 접속이 가능한 엔드포인트 등을 제공하는 리소스이다. 내부적으로 사용되는 것을 제외하고 사용자가 직접 관리할 수 있는 리소스로 서비스와 인그레스(Ingress)라는 두 종류의 API 카테고리가 있다.&lt;/p&gt;
&lt;h3&gt;4.3.3 컨피그 &amp;#x26; 스토리지 API 카테고리&lt;/h3&gt;
&lt;p&gt;컨피그 &amp;#x26; 스토리지 API 카테고리는 설정과 기밀 데이터를 컨테이너에 담거나 영구 볼륨을 제공하는 리소스이다. 시크릿과 컨피그맵은 모두 key-value 형태의 데이터 구조로 되어 있고, 저장할 데이터가 기밀 데이터인지 일반 설정 정보인지에 따라 구분된다.&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;시크릿&lt;/li&gt;
&lt;li&gt;컨피그맵&lt;/li&gt;
&lt;li&gt;영구 볼륨 클레임&lt;/li&gt;
&lt;/ul&gt;
&lt;h3&gt;4.3.4 클러스터 API 카테고리&lt;/h3&gt;
&lt;p&gt;클러스터 API 카테고리는 클러스터 자체 동작을 정의하는 리소스이다. 보안 관련 설정이나 정책, 클러스터 관리성을 향상시키는 기능을 위한 리소스를 제공한다.&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;노드&lt;/li&gt;
&lt;li&gt;네임스페이스&lt;/li&gt;
&lt;li&gt;영구 볼륨&lt;/li&gt;
&lt;li&gt;리소스 쿼터&lt;/li&gt;
&lt;li&gt;서비스 어카운트&lt;/li&gt;
&lt;li&gt;롤&lt;/li&gt;
&lt;li&gt;클러스터 롤&lt;/li&gt;
&lt;li&gt;롤바인딩&lt;/li&gt;
&lt;li&gt;클러스터 롤 바인딩&lt;/li&gt;
&lt;li&gt;네트워크 정책&lt;/li&gt;
&lt;/ul&gt;
&lt;h3&gt;4.3.5 메타데이터 API 카테고리&lt;/h3&gt;
&lt;p&gt;메타데이터 API 카테고리는 클러스터 내부의 다른 리소스 동작을 제어하기 위한 리소스이다.&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;LimitRange&lt;/li&gt;
&lt;li&gt;HorizontalPodAutoscaler(HPA)&lt;/li&gt;
&lt;li&gt;PodDisruptionBudget(PDB)&lt;/li&gt;
&lt;li&gt;커스텀 리소스 데피니션&lt;/li&gt;
&lt;/ul&gt;
&lt;h2&gt;4.4 네임스페이스로 가상적인 클러스터 분리&lt;/h2&gt;
&lt;p&gt;쿠버네티스에는 네임스페이스(NameSpace)라는 자체 클러스터 분리 기능이 있다. 하나의 쿠버네티스 클러스터를 여러 팀에서 사용하거나 경우 서비스 환경/스테이징 환경/개발 환경으로 구분하는 경우 사용할 수 있다. 기본 설정에서는 다음과 같은 네 가지 네임스페이스가 사용된다.&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;kube-system: 쿠버네티스 클러스터 구성 요소와 애드온이 배포될 네임스페이스&lt;/li&gt;
&lt;li&gt;kube-public: 모든 사용자가 사용할 수 있는 컨피그맵 등을 배치하는 네임스페이스&lt;/li&gt;
&lt;li&gt;kube-node-lease: 노드 하트비트 정보가 저장된 네임스페이스&lt;/li&gt;
&lt;li&gt;default: 기본 네임스페이스&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;관리형 서비스나 구축 도구로 구축된 경우 대부분의 쿠버네티스 클러스터는 RBAC(Role-Based Access Control)가 기본적으로 설정되어 있다. RBAC는 클러스터 조작에 대한 권한을 네임스페이스별로 구분할 수 있고, 네트워크 정책과 함께 사용하여 네임스페이스 간의 통신을 제어할 수 있는 구조이다.&lt;/p&gt;</content:encoded></item><item><title><![CDATA[[쿠버네티스 완벽 가이드] 03. 쿠버네티스 환경]]></title><description><![CDATA[…]]></description><link>https://github.com/SiverPineValley/SiverPineValley.github.io/kubernetes/kubernetes_3/</link><guid isPermaLink="false">https://github.com/SiverPineValley/SiverPineValley.github.io/kubernetes/kubernetes_3/</guid><pubDate>Sat, 23 Jul 2022 21:20:12 GMT</pubDate><content:encoded>&lt;h1&gt;3. 쿠버네티스 환경의 종류&lt;/h1&gt;
&lt;p&gt;쿠버네티스는 여러 플랫폼 환경에서 클러스터를 구성할 수 있다. 크게는 다음과 같은 세 가지 방법을 고려할 수 있다.&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;로컬 쿠버네티스: 물리 머신 한 대에 구축하여 사용&lt;/li&gt;
&lt;li&gt;쿠버네티스 구축 도구: 도구를 사용하여 온프레미스/클라우드에 클러스터를 구축하여 사용&lt;/li&gt;
&lt;li&gt;관리형 쿠버네티스 서비스: 퍼블릭 클라우드의 관리형 서비스로 제공하는 클러스터 사용&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;쿠버네티스가 제공하는 기능 중에는 쿠버네티스 환경에 따라 일부 사용할 수 없는 기능들도 존재하지만, 기본적으로는 어떤 쿠버네티스 환경에서도 동일하게 동작한다. 이것은 CNCF가 제공하는 인증 프로그램인 쿠버네티스 적합성 인증 프로그램을 준수하도록 각 프로그램이 만들어지기 때문이다.&lt;/p&gt;
&lt;h2&gt;3.1 로컬 쿠버네티스&lt;/h2&gt;
&lt;p&gt;로컬 쿠버네티스는 물리 머신에서 손쉽게 쿠버네티스를 테스트할 수 있는 방법이다. 한 대의 머신에 올인원으로 구성되어 이중화가 보장되지 않는다.&lt;/p&gt;
&lt;h3&gt;3.1.1 미니 큐브 (Minikube)&lt;/h3&gt;
&lt;p&gt;미니큐브(Minikube)는 물리 머신에 쿠버니티스를 쉽게 구축하고 실행할 수 있는 도구이다. 주요 특징으로는 단일 노드 구성이라 여러 대의 구성이 필요한 쿠버네티스 기능 등은 사용할 수 없다. 또한, 미니큐브는 로컬 가상 머신에 쿠버네티스를 설치하기 위해 하이퍼바이저가 필요하다.&lt;/p&gt;
&lt;p&gt;미니큐브는 하이퍼바이저를 맞는 드라이버를 통해 조작함으로써 자동으로 호스트가 되는 컨테이너나 가상 머신을 생성하고 그 환경에 쿠버네티스를 설치한다.&lt;/p&gt;
&lt;h3&gt;3.1.2 Docker Desktop for Mac/Windows&lt;/h3&gt;
&lt;p&gt;Docker Desktop for MAC/Windows는 18.06.0 CE부터 로컬 머신에서 쿠버네티스를 사용할 수 있게 되었다. 하지만, 현재는 쿠버네티스 버전을 지정할 수 없으므로 특정 버전을 사용하고 싶은 경우에는 주의해야 한다.&lt;/p&gt;
&lt;p&gt;Docker Desktop for MAC/Windows를 설치하고 쿠버네티스를 사용하려면, 기동 후에 Preference에서 쿠버네티스를 활성화해야 한다. 여러 쿠버네티스 클러스터를 사용하는 경우에는 kubectl의 컨텍스트를 전환하여 사용해야 한다.&lt;/p&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;shell&quot;&gt;&lt;pre class=&quot;language-shell&quot;&gt;&lt;code class=&quot;language-shell&quot;&gt;$ kubectl config use-context docker-desktop
Switched to context &lt;span class=&quot;token string&quot;&gt;&quot;docker-desktop&quot;&lt;/span&gt;&lt;span class=&quot;token builtin class-name&quot;&gt;.&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;kubectl에서는 로컬 머신에 기동 중인 도커 호스트를 쿠버네티스 노드로 인식한다. 또, 쿠버네티스 클러스터 기능을 담당하고 있는 구성 요소 그룹도 컨테이너로 기동된다. 쿠버네티스를 활성화할 때 &lt;code class=&quot;language-text&quot;&gt;Show system containers (advanced)&lt;/code&gt;도 활성화하면 docker container ls 명령어로 구성 요소를 확인할 수 있다.&lt;/p&gt;
&lt;h3&gt;3.1.3 kind&lt;/h3&gt;
&lt;p&gt;kind는 쿠버네티스 자체 개발을 위한 도구로, 쿠버네티스의 SIG-Testing이라는 분과회에서 만들어졌다. 이름처럼 도커 컨테이너를 여러 개 기동하고 그 컨테이너를 쿠버네티스 노드로 사용하는 것으로, 여러 대로 구성된 쿠버네티스 클러스터를 구축한다. 현재 로컬 환경에서 멀티 노드 클러스터를 구축하려면 kind를 사용하는 것이 가장 좋다.&lt;/p&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;shell&quot;&gt;&lt;pre class=&quot;language-shell&quot;&gt;&lt;code class=&quot;language-shell&quot;&gt;&lt;span class=&quot;token comment&quot;&gt;# kind 설치&lt;/span&gt;
$ brew &lt;span class=&quot;token function&quot;&gt;install&lt;/span&gt; kind

&lt;span class=&quot;token comment&quot;&gt;# kind 버전 확인&lt;/span&gt;
$ kind version
kind v0.10.0 go1.15.7 darwin/amd64&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;아래는 클러스터를 구축하고 구성 설정은 아래 YAML 파일로 관리할 수 있다. 마스터 노드 세 대와 워커 노드 세 대로 구성하였다. 실제로 클러스터를 구축하려면 위 구성 설정 파일을 지정하고, &lt;code class=&quot;language-text&quot;&gt;kind create cluster&lt;/code&gt; 명령어를 실행한다. 클러스터를 구축할 때는 Docker Desktop for Mac/Windows의 도커 환경이 기동되고 있어야 한다.&lt;/p&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;yaml&quot;&gt;&lt;pre class=&quot;language-yaml&quot;&gt;&lt;code class=&quot;language-yaml&quot;&gt;&lt;span class=&quot;token key atrule&quot;&gt;apiVersion&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt; kind.x&lt;span class=&quot;token punctuation&quot;&gt;-&lt;/span&gt;k8s.io/v1alpha4
&lt;span class=&quot;token key atrule&quot;&gt;kind&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt; Cluster
&lt;span class=&quot;token key atrule&quot;&gt;nodes&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt;
&lt;span class=&quot;token punctuation&quot;&gt;-&lt;/span&gt; &lt;span class=&quot;token key atrule&quot;&gt;role&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt; control&lt;span class=&quot;token punctuation&quot;&gt;-&lt;/span&gt;plane
  &lt;span class=&quot;token key atrule&quot;&gt;image&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt; kindest/node&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt;v1.18.2
&lt;span class=&quot;token punctuation&quot;&gt;-&lt;/span&gt; &lt;span class=&quot;token key atrule&quot;&gt;role&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt; control&lt;span class=&quot;token punctuation&quot;&gt;-&lt;/span&gt;plane
  &lt;span class=&quot;token key atrule&quot;&gt;image&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt; kindest/node&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt;v1.18.2
&lt;span class=&quot;token punctuation&quot;&gt;-&lt;/span&gt; &lt;span class=&quot;token key atrule&quot;&gt;role&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt; control&lt;span class=&quot;token punctuation&quot;&gt;-&lt;/span&gt;plane
  &lt;span class=&quot;token key atrule&quot;&gt;image&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt; kindest/node&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt;v1.18.2
&lt;span class=&quot;token punctuation&quot;&gt;-&lt;/span&gt; &lt;span class=&quot;token key atrule&quot;&gt;role&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt; worker
  &lt;span class=&quot;token key atrule&quot;&gt;image&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt; kindest/node&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt;v1.18.2
&lt;span class=&quot;token punctuation&quot;&gt;-&lt;/span&gt; &lt;span class=&quot;token key atrule&quot;&gt;role&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt; worker
  &lt;span class=&quot;token key atrule&quot;&gt;image&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt; kindest/node&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt;v1.18.2
&lt;span class=&quot;token punctuation&quot;&gt;-&lt;/span&gt; &lt;span class=&quot;token key atrule&quot;&gt;role&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt; worker
  &lt;span class=&quot;token key atrule&quot;&gt;image&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt; kindest/node&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt;v1.18.2&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;여러 쿠버네티스 클러스터를 사용하는 경우에는 kubectl의 컨텍스트를 전환하여 사용해야 한다.&lt;/p&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;shell&quot;&gt;&lt;pre class=&quot;language-shell&quot;&gt;&lt;code class=&quot;language-shell&quot;&gt;$ kuberctl config use-context kind-kindcluster
Switched to context &lt;span class=&quot;token string&quot;&gt;&quot;kind-kindcluster&quot;&lt;/span&gt;&lt;span class=&quot;token builtin class-name&quot;&gt;.&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;사용하지 않는 kind 클러스터는 다음과 같이 간단히 삭제할 수 있다.&lt;/p&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;shell&quot;&gt;&lt;pre class=&quot;language-shell&quot;&gt;&lt;code class=&quot;language-shell&quot;&gt;$ kind delete cluster &lt;span class=&quot;token parameter variable&quot;&gt;--name&lt;/span&gt; kindcluster
Deleting cluster &lt;span class=&quot;token string&quot;&gt;&quot;kindcluster&quot;&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;..&lt;/span&gt;.&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;kind는 내부에서 kubeadm이라는 구축 도구를 사용하며, 구축 시 설정 파일에 대해 패치를 적용하는 kubeadmConfigPatches와 kubeadmConfigPatchesJson6902 등을 사용하여 다양한 클러스터를 구축할 수 있다. 앞라 클러스터를 사용할 때도 이 설정을 사용하여 FeatureGate를 활성화한다.&lt;/p&gt;
&lt;h2&gt;3.2 쿠버네티스 구축 도구&lt;/h2&gt;
&lt;p&gt;다음으로는 쿠버네티스 구축 도구를 사용하여 환경을 구성하는 방법이다. 로컬 환경과는 다르게, 모두 여러 노드의 쿠버네티스 클러스터를 구축할 수 있다.&lt;/p&gt;
&lt;h3&gt;3.2.1 쿠버니티스 서비스 수준 목표 (SLO)&lt;/h3&gt;
&lt;p&gt;SIG-Scalability 분과회는 쿠버네티스의 확장성을 논의한다. SIG-Scalability 다음과 같은 서비스 수준 지표(Service Level Indicator, SLI)와 서비스 수준 목표(Service Level Objective, SLO)를 정의하고 있다.&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;API 응답 시간
&lt;ul&gt;
&lt;li&gt;단일 객체의 변경 API 요청에 대해 지난 5분 동안 99%가 1초 내에 돌아올 것(일부 제외)&lt;/li&gt;
&lt;li&gt;비스트리밍(non-streaming)의 API 요청에 대해 지난 5분 동안 99%가 아래 초 아내로 돌아올 것(일부 제외)
&lt;ul&gt;
&lt;li&gt;특정 리소스: 1초&lt;/li&gt;
&lt;li&gt;네임스페이스 전체: 5초&lt;/li&gt;
&lt;li&gt;클러스터 전체: 30초&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;li&gt;파드 기동 시간
&lt;ul&gt;
&lt;li&gt;지난 5분 동안 99%가 5초 이내에 기동할 것 (이미지 다운로드 시간이나 초기화 컨테이너(Init Container) 처리 시간은 포함되지 않음)&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;이 서비스 수준 목표를 달성할 수 있는 클러스터 최대 구성 범위는 다음과 같다.&lt;/p&gt;
&lt;table&gt;
&lt;thead&gt;
&lt;tr&gt;
&lt;th&gt;항목&lt;/th&gt;
&lt;th&gt;네임스페이스 단위의 상한&lt;/th&gt;
&lt;th&gt;클러스터 전체의 상한&lt;/th&gt;
&lt;/tr&gt;
&lt;/thead&gt;
&lt;tbody&gt;
&lt;tr&gt;
&lt;td&gt;노드 수&lt;/td&gt;
&lt;td&gt;-&lt;/td&gt;
&lt;td&gt;5000 노드 이하&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;클러스터 내 총 파드 수&lt;/td&gt;
&lt;td&gt;-&lt;/td&gt;
&lt;td&gt;150000 파드 이하&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;1 노드당 파드 수&lt;/td&gt;
&lt;td&gt;-&lt;/td&gt;
&lt;td&gt;110 파드 또는 (코어 수 * 10) 중 낮은 쪽&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;서비스 수&lt;/td&gt;
&lt;td&gt;5000 이하&lt;/td&gt;
&lt;td&gt;10000 이하&lt;/td&gt;
&lt;/tr&gt;
&lt;/tbody&gt;
&lt;/table&gt;
&lt;h3&gt;3.2.2 큐브어드민&lt;/h3&gt;
&lt;p&gt;큐브어드민(kubeadmin)은 쿠버네티스에서 제공하는 공식 구축 도구이다.
설치 및 초기 세팅은 아래와 같다. Ubuntu 환경에서 동작하는 명령어 기준으로 작성되었다.&lt;/p&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;sh&quot;&gt;&lt;pre class=&quot;language-sh&quot;&gt;&lt;code class=&quot;language-sh&quot;&gt;&lt;span class=&quot;token comment&quot;&gt;# 필요한 의존 패키지 설치&lt;/span&gt;
$ &lt;span class=&quot;token function&quot;&gt;sudo&lt;/span&gt; &lt;span class=&quot;token function&quot;&gt;apt&lt;/span&gt; update &lt;span class=&quot;token operator&quot;&gt;&amp;amp;&amp;amp;&lt;/span&gt; &lt;span class=&quot;token function&quot;&gt;sudo&lt;/span&gt; &lt;span class=&quot;token function&quot;&gt;apt&lt;/span&gt; &lt;span class=&quot;token function&quot;&gt;install&lt;/span&gt; &lt;span class=&quot;token parameter variable&quot;&gt;-y&lt;/span&gt; apt-transport-https &lt;span class=&quot;token function&quot;&gt;curl&lt;/span&gt;

&lt;span class=&quot;token comment&quot;&gt;# 저장소 등록 및 업데이트&lt;/span&gt;
$ &lt;span class=&quot;token function&quot;&gt;curl&lt;/span&gt; &lt;span class=&quot;token parameter variable&quot;&gt;-s&lt;/span&gt; https://packages.cloud.google.com/apt/doc/apt&lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt;key.gpg &lt;span class=&quot;token operator&quot;&gt;|&lt;/span&gt; &lt;span class=&quot;token function&quot;&gt;sudo&lt;/span&gt; apt-key &lt;span class=&quot;token function&quot;&gt;add&lt;/span&gt; -
$ &lt;span class=&quot;token function&quot;&gt;cat&lt;/span&gt; &lt;span class=&quot;token operator&quot;&gt;&amp;lt;&amp;lt;&lt;/span&gt; EOF &lt;span class=&quot;token operator&quot;&gt;|&lt;/span&gt; &lt;span class=&quot;token function&quot;&gt;sudo&lt;/span&gt; &lt;span class=&quot;token function&quot;&gt;tee&lt;/span&gt; /etc/apt/sources.list.d/kubernetes.list
$ &lt;span class=&quot;token function&quot;&gt;sudo&lt;/span&gt; &lt;span class=&quot;token function&quot;&gt;apt&lt;/span&gt; update

&lt;span class=&quot;token comment&quot;&gt;# 쿠버네티스 관련 패키지 설치&lt;/span&gt;
$ &lt;span class=&quot;token function&quot;&gt;sudo&lt;/span&gt; &lt;span class=&quot;token function&quot;&gt;apt&lt;/span&gt; &lt;span class=&quot;token function&quot;&gt;install&lt;/span&gt; &lt;span class=&quot;token parameter variable&quot;&gt;-y&lt;/span&gt; &lt;span class=&quot;token assign-left variable&quot;&gt;kubelet&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;token number&quot;&gt;1.18&lt;/span&gt;.15-00 &lt;span class=&quot;token assign-left variable&quot;&gt;kubeadm&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;token number&quot;&gt;1.18&lt;/span&gt;.15-00 &lt;span class=&quot;token assign-left variable&quot;&gt;kubectl&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;token number&quot;&gt;1.18&lt;/span&gt;.15-00 docker.io

&lt;span class=&quot;token comment&quot;&gt;# 버전 고정&lt;/span&gt;
$ &lt;span class=&quot;token function&quot;&gt;sudo&lt;/span&gt; apt-mark hold kubelet kubeadm kubectl docker.io

&lt;span class=&quot;token comment&quot;&gt;# 오버레이 네트워크용 커널 파라미터 변경&lt;/span&gt;
$ &lt;span class=&quot;token function&quot;&gt;cat&lt;/span&gt; &lt;span class=&quot;token operator&quot;&gt;&amp;lt;&amp;lt;&lt;/span&gt; EOF &lt;span class=&quot;token operator&quot;&gt;|&lt;/span&gt; &lt;span class=&quot;token function&quot;&gt;sudo&lt;/span&gt; &lt;span class=&quot;token function&quot;&gt;tee&lt;/span&gt; /etc/sysctl.d/k8s.conf

$ &lt;span class=&quot;token function&quot;&gt;sudo&lt;/span&gt; &lt;span class=&quot;token function&quot;&gt;sysctl&lt;/span&gt; &lt;span class=&quot;token parameter variable&quot;&gt;--system&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;다음은 쿠버네티스 마스터로 설정할 노드에 아래 내용을 실행한다. --pod-network-cidr 옵션은 클러스터 내부 네트워크용으로 플라넬을 사용하기 위한 설정이다. 이를 위해 사전에 swap이 비활성화되어 있어야 한다. 일시적으로 비활성화하는 경우에는 &lt;code class=&quot;language-text&quot;&gt;sudo swapoff -a&lt;/code&gt; 명령어를 사용한다. 호스트 OS 재기동 후에도 영구적으로 비활성화하려면 /etc/fstab 파일 내 swap 설정 행의 맨 앞에 #을 추가해야 한다.&lt;/p&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;sh&quot;&gt;&lt;pre class=&quot;language-sh&quot;&gt;&lt;code class=&quot;language-sh&quot;&gt;&lt;span class=&quot;token comment&quot;&gt;# kubeadm 초기화(쿠버네티스 마스터 구축)&lt;/span&gt;
$ &lt;span class=&quot;token function&quot;&gt;sudo&lt;/span&gt; kubeadmin init &lt;span class=&quot;token punctuation&quot;&gt;\&lt;/span&gt;
--kubernetes-version&lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;token number&quot;&gt;1.18&lt;/span&gt;.15 &lt;span class=&quot;token punctuation&quot;&gt;\&lt;/span&gt;
--pod-network-cidr&lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;token number&quot;&gt;172.31&lt;/span&gt;.0.0/16&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;쿠버네티스 마스터 설정이 성공하면, 쿠버네티스 노드가 될 노드에서 실행해야할 명령어가 출력되고, 그 명령어를 노드가 될 머신에서 실행한다. 쿠버네티스 노드를 여러 대 추가할 경우 각 노드에 아래 명령어를 실행한다.&lt;/p&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;sh&quot;&gt;&lt;pre class=&quot;language-sh&quot;&gt;&lt;code class=&quot;language-sh&quot;&gt;$ &lt;span class=&quot;token function&quot;&gt;sudo&lt;/span&gt; kubeadmi &lt;span class=&quot;token function&quot;&gt;join&lt;/span&gt; &lt;span class=&quot;token number&quot;&gt;172.31&lt;/span&gt;.2.189:6443 &lt;span class=&quot;token parameter variable&quot;&gt;--token&lt;/span&gt; zpn5s6.jcx9h6k3a78znd3p&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;kubectl에서 사용할 인증용 파일은 /etc/kubernetes/admin.conf에 있으며, 다음과 같이 kubeinit을 실행한 후 표시되는 명령어만 입력하면 준비가 끝난다.&lt;/p&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;sh&quot;&gt;&lt;pre class=&quot;language-sh&quot;&gt;&lt;code class=&quot;language-sh&quot;&gt;$ &lt;span class=&quot;token function&quot;&gt;mkdir&lt;/span&gt; &lt;span class=&quot;token parameter variable&quot;&gt;-p&lt;/span&gt; &lt;span class=&quot;token environment constant&quot;&gt;$HOME&lt;/span&gt;/.kube
$ &lt;span class=&quot;token function&quot;&gt;sudo&lt;/span&gt; &lt;span class=&quot;token function&quot;&gt;cp&lt;/span&gt; &lt;span class=&quot;token parameter variable&quot;&gt;-i&lt;/span&gt; /etc/kubernetes/admin.conf &lt;span class=&quot;token environment constant&quot;&gt;$HOME&lt;/span&gt;/.kube/config
$ &lt;span class=&quot;token function&quot;&gt;sudo&lt;/span&gt; &lt;span class=&quot;token function&quot;&gt;chown&lt;/span&gt; &lt;span class=&quot;token variable&quot;&gt;&lt;span class=&quot;token variable&quot;&gt;$(&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;id&lt;/span&gt; &lt;span class=&quot;token parameter variable&quot;&gt;-u&lt;/span&gt;&lt;span class=&quot;token variable&quot;&gt;)&lt;/span&gt;&lt;/span&gt;&lt;span class=&quot;token builtin class-name&quot;&gt;:&lt;/span&gt;&lt;span class=&quot;token variable&quot;&gt;&lt;span class=&quot;token variable&quot;&gt;$(&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;id&lt;/span&gt; &lt;span class=&quot;token parameter variable&quot;&gt;-g&lt;/span&gt;&lt;span class=&quot;token variable&quot;&gt;)&lt;/span&gt;&lt;/span&gt; &lt;span class=&quot;token environment constant&quot;&gt;$HOME&lt;/span&gt;/.kube/config&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;여기까지 진행되었다면 각 노드에 마스터/워커 노드로 필요한 쿠버네티스 프로세스가 모두 기동 중인 상태이다. 그러나 이것 만으로는 멀티 노드 쿠버네티스 클러스터라고 말하기에 조금 부족하다. 서로 다른 노드에 배포된 바드 간 통신이 되지 않기 때문이다.&lt;/p&gt;
&lt;h3&gt;3.2.3 플라넬&lt;/h3&gt;
&lt;p&gt;기본적으로 도커에서 기동한 컨테이너에 할당된 IP는 호스트 외부에서 접근할 수 없다. 이 문제를 해결하고 멀티 쿠버네티스 클러스터가 되기 위해서는 각 호스트의 내부 네트워크 접속성을 확보해야 한다. 이런 네트워크 구성 방법에 플라넬(Flannel)이 있다. 플라넬은 노드 사이를 연결하는 네트워크 가상 터널(오버레이 네트워크)를 구성하여 클러스터 내부 파드 간 통신을 구현한다.&lt;/p&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;sh&quot;&gt;&lt;pre class=&quot;language-sh&quot;&gt;&lt;code class=&quot;language-sh&quot;&gt;&lt;span class=&quot;token comment&quot;&gt;# 플라넬 배포&lt;/span&gt;
kubectl apply &lt;span class=&quot;token parameter variable&quot;&gt;-f&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;\&lt;/span&gt;
https://raw.githubusercontent.com/coreos/flannel/master/Documentation/kube-flannel.yml&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;h3&gt;3.2.4 랜처&lt;/h3&gt;
&lt;p&gt;랜처(Rancher)는 랜처 랩(Rancher Lab)에서 개발 중인 오픈소스 컨테이너 플랫폼이다. 랜처는 중앙에서 랜처 서버를 기동시키고 관리자는 랜처 서버를 통해 쿠버네티스 클러스터를 구축하고 관리하는 구조이다. 클라우드 프로바이더 환경에 쿠버네티스 클러스터를 구축하는 경우에도 랜처 서버가 클라우드 프로바이더 API를 사용하여 구축 및 관리를 쉽게할 수 있게 해준다.&lt;/p&gt;
&lt;h2&gt;3.3 퍼블릭 클라우드 관리형 쿠버네티스 서비스&lt;/h2&gt;
&lt;p&gt;퍼블릭 클라우드 관리형 쿠버네티스 서비스는 영구 볼륨이나 로드 밸런서와의 연계 등을 쉽게 사용할 수 있도록 기능을 제공한다.&lt;/p&gt;
&lt;h3&gt;3.3.1 GKE(Google Kubernetes Engine)&lt;/h3&gt;
&lt;p&gt;GKE는 가장 먼저 출시된 관리형 쿠버네티스 서비스로, 오랜 기간 운영되어 수많은 편리 기능을 제공한다. 릴리스 채널, 노드 자동 업데이트, 노드 자동 복구, 노드 인스턴스 유형을 자동으로 결정하는 노드 자동 프로비저닝 기능 등이 있다. GKE에서는 쿠버네티스 노드로 GCE(Google Computer Engine)을 사용한다. 또한 GCP(Google Cloud Platform)의 여러 기능과 통합되어 있다. 예를 들어 클라우드 로깅과는 기본으로 연계되어 있어 컨테이너의 로그를 수집하게 되어 있다. 이외에도 고가용성을 가진 HTTP 로드 밸런서나 GPU를 사용할 수 있는 것도 장점이다.&lt;/p&gt;
&lt;p&gt;또한, GKE는 노드 풀(NodePool) 기능을 제공한다. 이 기능은 쿠버네티스 클러스터 내부 노드에 레이블을 부여하여 그룹핑하는 기능이다. 노드를 그룹핑하여 머신 성능이 다른 노드를 클러스터에 배치하고 레이블을 부여하면 컨테이너 스케줄링 시 배포 제약 조건으로 사용 가능하다. 이외에 노드를 그룹핑하여 워크로드를 분리하거나 어떤 종류의 노드를 어느 정도의 규모로 클러스터를 구성할 것인지에 대해서도 제어가 가능하다.&lt;/p&gt;
&lt;h3&gt;3.3.2 AKS(Azure Kubernetes Service)&lt;/h3&gt;
&lt;p&gt;AKS는 마이크로소프트 Azure에서 동작하는 관리형 쿠버네티스 서비스이다. 애저 액티브 디렉터리를 쿠버네티스 역할 기반 액세스 제어(RBAC)와 연계하는 기능, AKS 클러스터의 리소스가 부족할 때 버추얼 쿠버렛(Virtual Kubelet)을 사용하여 Azure Container Instances(ACL)에 버스팅(bursting)하는 기능을 제공하고 있으며, AKS 클러스터를 스케일 아웃하는 것이 아니라 ACI에 버스팅하기 때문에 몇 초 안에 기동할 수 있다.&lt;/p&gt;
&lt;h3&gt;3.3.3 EKS(Elastic Kubernetes Service)&lt;/h3&gt;
&lt;p&gt;EKS는 AWS re:invent 2017에서 발표한 AWS의 관리하여 쿠버네티스 서비스이다.&lt;/p&gt;
&lt;p&gt;이렇게 쿠버네티스 환경은 크게 세 가지 방법으로 구분된다.&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;로컬 쿠버네티스: 물리 머신 한 대에 구축하여 사용&lt;/li&gt;
&lt;li&gt;쿠버니티스 구축 도구: 도구를 사용하여 온프레미스/클라우드에 클러스터를 구축하여 사용&lt;/li&gt;
&lt;li&gt;관리형 쿠버네티스 서비스: 퍼블릭 클라우드의 관리형 서비스로 제공하는 클러스터 사용&lt;/li&gt;
&lt;/ul&gt;</content:encoded></item><item><title><![CDATA[[쿠버네티스 완벽 가이드] 02. 쿠버네티스 소개]]></title><description><![CDATA[…]]></description><link>https://github.com/SiverPineValley/SiverPineValley.github.io/kubernetes/kubernetes_2/</link><guid isPermaLink="false">https://github.com/SiverPineValley/SiverPineValley.github.io/kubernetes/kubernetes_2/</guid><pubDate>Tue, 19 Jul 2022 17:00:00 GMT</pubDate><content:encoded>&lt;h1&gt;2. 쿠버네티스 소개&lt;/h1&gt;
&lt;p&gt;쿠버네티스란 컨테이너화된 애플리케이션의 배포, 확장 등을 관리하는 것을 자동화하기 위한 플랫폼(컨테이너 오케스트레이션 엔진)이다. 도커 자체만으로는 여러 호스트로 구성하거나 규모가 큰 서비스 환경에서 시스템을 구축하기 어려우므로, 이러한 오케스트레이션 플랫폼을 이용하는 것이 요즘의 추세이다.&lt;/p&gt;
&lt;p&gt;컨테이너 오케스트레이션 엔진에는 도커 외에도, 도커 스웜, 아파치 메소스(Apache mesos) 등이 있지만, 쿠버네티스가 가장 많이 활용된다. 쿠버네티스에서 사용 가능한 런타임도 도커 외에도 다양한 런타임이 사용 가능하다.&lt;/p&gt;
&lt;h2&gt;2.1 쿠버네티스의 활용&lt;/h2&gt;
&lt;p&gt;컨테이너란 &apos;어떤 애플리케이션을 실행하도록 빌드된 컨테이너 이미지를 기반으로 기동된 워크로드&apos;를 의미한다. 쿠버네티스는 이러한 컨테이너화된 애플리케이션을 쉽게 배포할 수 있는 기능을 지원한다. 하지만, 컨테이너 환경에서도 다음과 같은 과제들이 있다.
쿠버네티스를 활용하면 자동화할 수 있거나 간단한 오퍼레이션으로 해결 가능하다.&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;여러 쿠버네티스 노드 관리&lt;/li&gt;
&lt;li&gt;컨테이너 스케줄링&lt;/li&gt;
&lt;li&gt;롤링 업데이트&lt;/li&gt;
&lt;li&gt;스케일링/오토 스케일링&lt;/li&gt;
&lt;li&gt;컨테이너 모니터링&lt;/li&gt;
&lt;li&gt;자동화된 복구&lt;/li&gt;
&lt;li&gt;서비스 디스커버리&lt;/li&gt;
&lt;li&gt;로드 밸런싱&lt;/li&gt;
&lt;li&gt;데이터 관리&lt;/li&gt;
&lt;li&gt;워크로드 관리&lt;/li&gt;
&lt;li&gt;로그 관리&lt;/li&gt;
&lt;li&gt;선언적 코드를 사용한 관리&lt;/li&gt;
&lt;li&gt;그 외 에코시스템과의 연계 및 확장&lt;/li&gt;
&lt;/ul&gt;
&lt;h3&gt;2.1.1 선언적 코드를 사용한 관리(IaC)&lt;/h3&gt;
&lt;p&gt;쿠버네티스는 YAML형식이나 JSON 형식으로 작성한 선언적 코드(매니페스트)를 통해 배포하는 컨테이너로 주변 리소스를 관리할 수 있어 IaC(Infrastructure as Code)를 구현할 수 있다. 간단히 말해, YAML이나 JSON과 같은 선언적 코드를 직성하여 시스템 구축이나 관리를 자동화하고 오케스트레이션하는 방법을 지원한다.&lt;/p&gt;
&lt;h3&gt;2.1.2  스케일링/오토 스케일링&lt;/h3&gt;
&lt;p&gt;쿠버네티스는 컨테이너 클러스터(쿠버네티스 클러스터)를 구성해서 여러 쿠버네티스 노드를 관리한다. 컨테이너 이미지를 기반으로 쿠버네티스 위에 컨테이너를 배포할 때 같은 컨테이너 이미지를 기반으로 한 여러 컨테이너(레플리카)를 배포하면 부하 분산 및 다중화 구조를 만들 수 있다. 부하에 따라서 컨테이너 레플리카 수를 자동으로 늘리거나 줄일(오토 스케일링) 수도 있다.&lt;/p&gt;
&lt;h3&gt;2.1.3 스케줄링&lt;/h3&gt;
&lt;p&gt;컨테이너를 쿠버네티스 노드에 배포할 때 어떤 쿠버네티스 노드에 배포할 것인지를 결정하는 &apos;스케줄링&apos; 단계가 있다. 어피니티(Affinity)와 안티 어피니티(Anti-Affinity) 기능을 사용하여 컨테이너화된 애플리케이션 워크로드의 특징이나 쿠버네티스 노드의 성능을 기준으로 스케일링할 수 있다.&lt;/p&gt;
&lt;h3&gt;2.1.4 리소스 관리&lt;/h3&gt;
&lt;p&gt;컨테이너 배치를 위해 지정이 특별히 없을 경우 쿠버네티스 노드의 CPU나 메모리의 여유 리소스 상태에 따라 스케줄링되기 때문에 사용자는 어떤 쿠버네티스 노드에 컨테이너를 배치할지 관리할 필요가 없다. 또한, 리소스 사용 상태에 따라 클러스터 오토 스케일링 기능으로 쿠버네티스 클러스터의 쿠버네티스 노드도 자동으로 추가하거나 삭제할 수 있다.&lt;/p&gt;
&lt;h3&gt;2.1.5 자동화된 복구&lt;/h3&gt;
&lt;p&gt;다중화(fault tolerant) 관점에서는 쿠버네티스의 중요한 콘셉 중 하나인 자동화된 복구 기능 (self-healing)이 있다. 쿠버네티스는 표준으로 컨테이너 프로세스를 모니터링하고 프로세스의 정지를 감지하면, 다시 컨테이너 스케줄링을 실행하여 자동으로 컨테이너를 재배포한다. 클러스터 노드에 장애가 발생하거나 노드를 축출했을 경우에도 서비스 영향 없이 애플리케이션을 자동으로 북구할 수 있다. 프로세스의 health check는 HTTP/TCP나 쉘 스크립트로 헬스 체크의 성공 여부를 설정할 수도 있다.&lt;/p&gt;
&lt;h3&gt;2.1.6 로드 밸런싱과 디스커버리&lt;/h3&gt;
&lt;p&gt;여러 대로 구성된 애플리케이션을 하나의 애플리케이션으로 사용자에게 보여주고 접속시키려면 사용자에게 목적지가 되는 여러 대로 구성된 엔드포인트를 준비해야 한다. 쿠버네티스는 로드밸런서 기능을 제공하고 있으며 사전에 정의한 조건과 일치하는 컨테이너 그룹에 라우팅하는 엔드포인트를 할당할 수 있다.&lt;/p&gt;
&lt;p&gt;또한, 쿠버네티스는 서비스 디스커버리도 가능하다. 컨테이너를 사용하여 시스템을 구축하는 경우에는 기능별로 독립된 작은 규모의 애플리케이션을 연계하여 시스템을 구현하는 &apos;마이크로서비스 아키텍쳐&apos;를 선택하는 것이 일반적이다. 이런 환경에서 각각의 마이크로서비스가 서로의 마이크로서비스를 참조할 때 서비스 디스커버리 기능은 매우 유용하다. 서비스 디스커버리 기능을 통해 각각의 마이크로서비스가 정의된 복수의 매니페스트를 이용하여 시스템 전체를 쉽게 연계할 수 있다.&lt;/p&gt;
&lt;h3&gt;2.1.7 데이터 관리&lt;/h3&gt;
&lt;p&gt;쿠버네티스는 백엔드 데이터 스토어로 etcd를 채용하고 있다. etcd는 클러스터를 구성하여 이중화가 가능하고 컨테이너나 서비스의 매니페스트 파일도 이중화 구조로 저장한다. 또, 쿠버네티스는 컨테이너가 사용하는 설정 파일이나 인증 정보 등의 데이터를 저장하는 구조도 가지고 있어 컨테이너 공통 설정이나 애플리케이션에서 사용되는 데이터베이스 인증 정보 등을 안전하고 이중화된 상태로 쿠버네티스에서 집중적으로 관리할 수 있다.&lt;/p&gt;
&lt;p&gt;쿠버네티스는 독립적으로 하나의 플랫폼으로 사용할 수 있지만 외부 에코시스템과의 연계도 활발히 이루어지고 있다. 많은 미들웨어들이 쿠버네티스를 지원하며, 이러한 경향은 앞으로도 가속화될 것이다. 아래는 미들웨어들에 대한 소개이다.&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;Ansible: 쿠버네티스에 컨테이너 배포&lt;/li&gt;
&lt;li&gt;Apache Ignite: 쿠버네티스 서비스 디스커버리를 사용한 클러스터 생성과 스케일링&lt;/li&gt;
&lt;li&gt;Fluentd: 쿠버네티스에 컨테이너 로그 전송&lt;/li&gt;
&lt;li&gt;GitLab: CI/CD를 구현하기 위한 일련의 다양한 도구와 쿠버네티스의 통합&lt;/li&gt;
&lt;li&gt;Jenkins: 잡 실행 시 잡 실행자용 컨테이너를 쿠버네티스에 배포&lt;/li&gt;
&lt;li&gt;OpenStack: 클라우드 사업자와 연계한 쿠버네티스 구축&lt;/li&gt;
&lt;li&gt;Prometheus: 쿠버네티스 모니터링&lt;/li&gt;
&lt;li&gt;Spark: 잡을 쿠버네티스에서 네이티브로 실행(YARN 대체)&lt;/li&gt;
&lt;li&gt;Spinnaker: 쿠버네티스에 컨테이버 배포&lt;/li&gt;
&lt;li&gt;Kubeflow: 쿠버네티스에 ML 플랫폼 배포&lt;/li&gt;
&lt;li&gt;Rook: 쿠버네티스에 분산 파일 시스템 배포&lt;/li&gt;
&lt;li&gt;Vitess: 쿠버네티스에 MySQL 클러스터 배포&lt;/li&gt;
&lt;/ul&gt;</content:encoded></item><item><title><![CDATA[[쿠버네티스 완벽 가이드] 01. 도커]]></title><description><![CDATA[쿠버네티스 관련 자격증인 CKA/CKAD에 대해 찾아보다가 이 책이 초보자부터 보기 좋다는 이야기를 들어서 구입하여 보게 되었다. 본 페이지에서는 이 책을 읽으며 새로 알게된 내용들을 정리하고자 작성하게 되었다. 1. 도커(Docker…]]></description><link>https://github.com/SiverPineValley/SiverPineValley.github.io/kubernetes/kubernetes_1/</link><guid isPermaLink="false">https://github.com/SiverPineValley/SiverPineValley.github.io/kubernetes/kubernetes_1/</guid><pubDate>Mon, 18 Jul 2022 17:00:00 GMT</pubDate><content:encoded>&lt;div align=&quot;left&quot;&gt;
  &lt;span class=&quot;gatsby-resp-image-wrapper&quot; style=&quot;position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 630px; &quot;&gt;
      &lt;a class=&quot;gatsby-resp-image-link&quot; href=&quot;/static/cbb68b688a3015201524874f41ea954d/15ec7/kubernetes_perfect_guide.jpg&quot; style=&quot;display: block&quot; target=&quot;_blank&quot; rel=&quot;noopener&quot;&gt;
    &lt;span class=&quot;gatsby-resp-image-background-image&quot; style=&quot;padding-bottom: 128.48101265822785%; position: relative; bottom: 0; left: 0; background-image: url(&apos;data:image/jpeg;base64,/9j/2wBDABALDA4MChAODQ4SERATGCgaGBYWGDEjJR0oOjM9PDkzODdASFxOQERXRTc4UG1RV19iZ2hnPk1xeXBkeFxlZ2P/2wBDARESEhgVGC8aGi9jQjhCY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2P/wgARCAAaABQDASIAAhEBAxEB/8QAGAAAAwEBAAAAAAAAAAAAAAAAAAQFAwH/xAAXAQEBAQEAAAAAAAAAAAAAAAACAQAD/9oADAMBAAIQAxAAAAFtrWM+dwUC+5USmYUzT//EAB0QAAIBBAMAAAAAAAAAAAAAAAECAAMEEhMRIDP/2gAIAQEAAQUCLHflhFPIlwTstPFkZ5UtgYoel0//xAAaEQACAgMAAAAAAAAAAAAAAAAAAQISETFh/9oACAEDAQE/AZywLRVMp0//xAAYEQEAAwEAAAAAAAAAAAAAAAAAAQISEf/aAAgBAgEBPwGtepalp//EACAQAAMAAQIHAAAAAAAAAAAAAAABAhESIRMgIjEyQYH/2gAIAQEABj8Cc8RyjDp0zKOxfo+nnpWdzpY5mNuT/8QAHRABAAMBAAIDAAAAAAAAAAAAAQARITFBUYGhsf/aAAgBAQABPyF6rKuj9QvfyKEaWSy3vandfB7PXWrDxGENLHWBmPBvZqFa82USpQcn/9oADAMBAAIAAwAAABAACXP/xAAXEQEBAQEAAAAAAAAAAAAAAAABABEx/9oACAEDAQE/EFJk9DPZaOK//8QAGREBAQEAAwAAAAAAAAAAAAAAAQARITFB/9oACAECAQE/ENnMMUgOrPoX/8QAIRABAAIBAwQDAAAAAAAAAAAAAQARITFBYVFxkcGBsdH/2gAIAQEAAT8QeGGKqNFVT3ALxV2AwvBN3X5iyXY04xzmBpKwbw9YgAKYg7LDz+x02iHgdu8EqeBrBi71ha9kLp942xOA8SnQhYoFttGrP//Z&apos;); background-size: cover; display: block;&quot;&gt;&lt;/span&gt;
  &lt;img class=&quot;gatsby-resp-image-image&quot; alt=&quot;kubernetes perfect guide&quot; title=&quot;&quot; src=&quot;/static/cbb68b688a3015201524874f41ea954d/828fb/kubernetes_perfect_guide.jpg&quot; srcset=&quot;/static/cbb68b688a3015201524874f41ea954d/ff44c/kubernetes_perfect_guide.jpg 158w,
/static/cbb68b688a3015201524874f41ea954d/a6688/kubernetes_perfect_guide.jpg 315w,
/static/cbb68b688a3015201524874f41ea954d/828fb/kubernetes_perfect_guide.jpg 630w,
/static/cbb68b688a3015201524874f41ea954d/15ec7/kubernetes_perfect_guide.jpg 690w&quot; sizes=&quot;(max-width: 630px) 100vw, 630px&quot; style=&quot;width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;&quot; loading=&quot;lazy&quot; decoding=&quot;async&quot;&gt;
  &lt;/a&gt;
    &lt;/span&gt;
&lt;/div&gt;
&lt;p&gt;쿠버네티스 관련 자격증인 CKA/CKAD에 대해 찾아보다가 이 책이 초보자부터 보기 좋다는 이야기를 들어서 구입하여 보게 되었다.&lt;/p&gt;
&lt;p&gt;본 페이지에서는 이 책을 읽으며 새로 알게된 내용들을 정리하고자 작성하게 되었다.&lt;/p&gt;
&lt;h1&gt;1. 도커(Docker)&lt;/h1&gt;
&lt;p&gt;도커(Docker)는 컨테이너를 실행하기 위한 실행 환경(컨테이너 런타임) 및 툴킷을 의미한다. 쿠버네티스는 도커 외에도 다른 컨테이너 런터임도 지원한다.&lt;/p&gt;
&lt;h2&gt;1.1 도커 컨테이너&lt;/h2&gt;
&lt;p&gt;도커 컨테이너는 도커 이미지를 기반으로 실행하는 프로세스이다. 도커 이미지만 있다면 환경의 영향을 받지 않고 다양한 환경에서 컨테이너 기동이 가능하여 이식성이 높다. 도커 컨테이너는 가상 머신에 비해 가볍고, 시작과 중지가 빠른 장점이 있다. 가상 머신은 하이퍼바이저를 이용하여 게스트 OS를 작동시키지만, 도커 컨테이너는 호스트 머신의 커널을 이용하면서 네임스페이스 분리와 cgroups를 이용한 제어를 통해 독립적인 OS와 같은 환경을 만들 수 있다. 따라서 게스트 OS 기동을 기다릴 필요 없이 프로세스를 빠르게 시작하고 중지할 수 있다.&lt;/p&gt;
&lt;h2&gt;1.2 도커 컨테이너 설계&lt;/h2&gt;
&lt;p&gt;도커 컨테이너 생성에는 다음과 같은 주의점이 있다.&lt;/p&gt;
&lt;table&gt;
&lt;thead&gt;
&lt;tr&gt;
&lt;th&gt;설명&lt;/th&gt;
&lt;th&gt;내용&lt;/th&gt;
&lt;/tr&gt;
&lt;/thead&gt;
&lt;tbody&gt;
&lt;tr&gt;
&lt;td&gt;1컨테이너당 1프로세스&lt;/td&gt;
&lt;td&gt;기존 가상 머신처럼 하나의 이미지 안에 여러 프로세스를 올리면 주변 에코 시스템과 맞지 않거나 관리가 힘들어진다.&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;변경 불가능한 인프라(Immutable Infrastructure) 이미지로 생성&lt;/td&gt;
&lt;td&gt;컨테이너 기동 후에 외부에서 실행 바이너리를 가져오거나 패키지를 설치하면 외부 영향에 따라 이미지 실행 결과가 달라지므로, 이미지 안에 애플리케이션 실행 바이너리나 관련 리소스를 포함시켜 변경 불가능하게 만들어야 한다.&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;경량의 도커 이미지 생성&lt;/td&gt;
&lt;td&gt;컨테이너를 실행할 때 노드상에서 사용할 도커 이미지가 없다면 외부에서 이미지를 풀하여 가져와야 하므로, 이미지는 가급적 경량인 상태로 만들어야 한다.&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;실행 계정은 root이외의 사용자로 한다.&lt;/td&gt;
&lt;td&gt;내부 프로세스 실행 계정 권한은 최소화해야 한다.&lt;/td&gt;
&lt;/tr&gt;
&lt;/tbody&gt;
&lt;/table&gt;
&lt;h2&gt;1.3 도커 파일 작성법&lt;/h2&gt;
&lt;p&gt;도커 이미지는 도커 파일을 기반으로 이미지가 빌드된다. 도커 파일은 컨테이너 이미지 작성 메뉴얼이다.&lt;/p&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;text&quot;&gt;&lt;pre class=&quot;language-text&quot;&gt;&lt;code class=&quot;language-text&quot;&gt;# Alpine 3.11 버전 golang 1.14.1 이미지를 사용
FROM golang:1.14.1-alpine3.11

# 빌드할 머신에 있는 main.go 파일을 컨테이너에 복사
COPY ./main.go ./

# 컨테이너 내부에서 명령어 실행
RUN go build -o ./go-app ./main.go

# 실행 계정을 nobody로 변경
USER nobody

# 컨테이너가 기동할 때 실행할 명령어 정의
ENTRYPOINT [&quot;./go-app&quot;]&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;각 예약어를 간단하게 설명하면 다음과 같다.&lt;/p&gt;
&lt;table&gt;
&lt;thead&gt;
&lt;tr&gt;
&lt;th&gt;예약어&lt;/th&gt;
&lt;th&gt;설명&lt;/th&gt;
&lt;/tr&gt;
&lt;/thead&gt;
&lt;tbody&gt;
&lt;tr&gt;
&lt;td&gt;FROM&lt;/td&gt;
&lt;td&gt;기반이 되는 도커 이미지 지정&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;MAINTAINER&lt;/td&gt;
&lt;td&gt;컨테이너 이미지 관리자 정보를 기입 (현재는 비추천. 아래 LABEL 명령을 사용함)&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;LABEL&lt;/td&gt;
&lt;td&gt;컨테이너 이미지의 메타데이터를 키:밸류 형식으로 지정(예: LABEL maintainer=&quot;...&quot;&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;WORKDIR&lt;/td&gt;
&lt;td&gt;명령어를 실행할 작업 디렉터리를 지정 (디렉터리가 없을 경우 생성)&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;EXPOSE&lt;/td&gt;
&lt;td&gt;컨테이너 실행 시 Listen할 포트 지정&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;ADD&lt;/td&gt;
&lt;td&gt;로컬에 있는 tar.gz 압축을 풀고 파일을 컨테이너로 복사&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;COPY&lt;/td&gt;
&lt;td&gt;로컬에 있는 파일을 컨테이너로 복사할 때 지정&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;RUN&lt;/td&gt;
&lt;td&gt;빌드 명령어 지정&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;USER&lt;/td&gt;
&lt;td&gt;실행 계정 지정&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;ENTRYPOINT&lt;/td&gt;
&lt;td&gt;컨테이너 기동 시 실행할 명령어&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;CMD&lt;/td&gt;
&lt;td&gt;컨테이너 기동 시 실행할 명령어에 입력되는 파라미터&lt;/td&gt;
&lt;/tr&gt;
&lt;/tbody&gt;
&lt;/table&gt;
&lt;h2&gt;1.4 도커 파일 빌드&lt;/h2&gt;
&lt;p&gt;위의 도커 파일을 실행하면 기반 이미지로 golang:1.14.1-alpine3.11을 사용했다. golang:1.14.1-alpine3.11은 alpine 이미지(5.6MB)를 기반으로 만들어진 아주 작은 이미지다. 그러나, golang의 도커 이미지에는 Go 컴파일 도구가 포함되어 생성된 sample-image 이미지에도 해당 컴파일 도구가 포함되어 이미지 사이즈가 매우 커지게 된다.&lt;/p&gt;
&lt;p&gt;이러한 문제는 도커의 멀티 스테이지 빌드를 사용하여 해결 가능하다. 도커 멀티 스테이지 빌드는 여러 컨테이너 이미지를 사용하여 처리하고 결과물만 실행용 컨테이너 이미지에 복사하는 구조이다.&lt;/p&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;text&quot;&gt;&lt;pre class=&quot;language-text&quot;&gt;&lt;code class=&quot;language-text&quot;&gt;# Stage 1 컨테이너(애플리케이션 빌드)
FROM golang:1.14.1-alpine3.11 as builder
COPY ./main.go ./
RUN go build -o /go-app ./main.go

# Stage 2 컨테이너(빌드된 바이너리를 포함한 실행용 컨테이너 생성)
FROM alpine:3.7
EXPOSE 8080
# Stage 1에서 빌드된 결과물을 복사
COPY --from=builder /go-app .
USER nobody
ENTRYPOINT [&quot;./go-app&quot;]&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;위 도커 파일에서는 1단계에서 마찬가지로 빌드를 수행한다.
2단계에서는 1단계에서 빌드된 파일만 가지고 golang이 설치되지 않는 alpine 환경에서 바이너리 파일을 실행시킨다.&lt;/p&gt;
&lt;p&gt;&lt;code class=&quot;language-text&quot;&gt;docker image build -t sample-image:0.1 -f Dockerfile-MultiStage&lt;/code&gt;&lt;/p&gt;
&lt;h2&gt;1.4 컨테이너 기동&lt;/h2&gt;
&lt;p&gt;도커 컨테이너 기동 시에는 다음과 같은 명령어를 사용한다. 쿠버네티스를 사용할 경우에는 쿠버네티스가 컨테이너를 기동하기 때문에 직접 사용하지는 않는다.&lt;/p&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;text&quot;&gt;&lt;pre class=&quot;language-text&quot;&gt;&lt;code class=&quot;language-text&quot;&gt;$ docker contianer run -d -p 12345:8080 sample-image:0.1

$ curl http://localhost:12345
Hello, Kubernetes&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;</content:encoded></item><item><title><![CDATA[[Go 동시성 프로그래밍] 01. 동시성 소개, 코드 모델링: 순차적인 프로세스 간의 통신]]></title><description><![CDATA[앞서 Go 기본 문법책을 살펴보면서 공부했던 동시성 개발에 대해 더 자세히 알고 싶어 동시성에 대해서만 다루고 있는 책을 살펴보았다.
이라는 책인데, 동시성 개발의 역사부터 시작해서 Go…]]></description><link>https://github.com/SiverPineValley/SiverPineValley.github.io/golang/concurrency_in_go_1/</link><guid isPermaLink="false">https://github.com/SiverPineValley/SiverPineValley.github.io/golang/concurrency_in_go_1/</guid><pubDate>Sat, 02 Jul 2022 16:10:23 GMT</pubDate><content:encoded>&lt;div align=&quot;left&quot;&gt;
  &lt;span class=&quot;gatsby-resp-image-wrapper&quot; style=&quot;position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 630px; &quot;&gt;
      &lt;a class=&quot;gatsby-resp-image-link&quot; href=&quot;/static/8783b8d893ea817712dbc35771dec414/6a068/golang_concurrency.jpg&quot; style=&quot;display: block&quot; target=&quot;_blank&quot; rel=&quot;noopener&quot;&gt;
    &lt;span class=&quot;gatsby-resp-image-background-image&quot; style=&quot;padding-bottom: 125.31645569620254%; position: relative; bottom: 0; left: 0; background-image: url(&apos;data:image/jpeg;base64,/9j/2wBDABALDA4MChAODQ4SERATGCgaGBYWGDEjJR0oOjM9PDkzODdASFxOQERXRTc4UG1RV19iZ2hnPk1xeXBkeFxlZ2P/2wBDARESEhgVGC8aGi9jQjhCY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2P/wgARCAAZABQDASIAAhEBAxEB/8QAGAAAAwEBAAAAAAAAAAAAAAAAAAEDBAX/xAAWAQEBAQAAAAAAAAAAAAAAAAAAAgP/2gAMAwEAAhADEAAAAd8b8mte+InJT2MQw//EABwQAAICAgMAAAAAAAAAAAAAAAIDARIAERMgIf/aAAgBAQABBQJhhfkXipiVtVnu0DIqqRCKqF0//8QAGBEAAgMAAAAAAAAAAAAAAAAAABEBAhD/2gAIAQMBAT8BdUTv/8QAFREBAQAAAAAAAAAAAAAAAAAAICH/2gAIAQIBAT8Bg//EAB8QAAEEAAcAAAAAAAAAAAAAAAEAAhExAxASICEzkf/aAAgBAQAGPwIg4YK6h6uBCc/VkAbUONqb2//EABsQAQEAAgMBAAAAAAAAAAAAAAERACEQMUFR/9oACAEBAAE/ITIE9XgxJn+ZvWA3JkURXwkzoTXKpJo4grQ6uDcOuf/aAAwDAQACAAMAAAAQ+zAw/8QAFxEBAAMAAAAAAAAAAAAAAAAAAQAQ8f/aAAgBAwEBPxALUQql/wD/xAAYEQACAwAAAAAAAAAAAAAAAAAAARARMf/aAAgBAgEBPxC0Q9n/xAAiEAEAAgEDAwUAAAAAAAAAAAABABEhMUFRYXGhEIGxwdH/2gAIAQEAAT8QR8BYC8HSYfpfkGYq0WwzLqQHtTv0mLJU2rLvfBD2pQnuzHeNEWt6SvJHFLonzqgGGsZ8QBZpPm9f/9k=&apos;); background-size: cover; display: block;&quot;&gt;&lt;/span&gt;
  &lt;img class=&quot;gatsby-resp-image-image&quot; alt=&quot;golang concurrency&quot; title=&quot;&quot; src=&quot;/static/8783b8d893ea817712dbc35771dec414/828fb/golang_concurrency.jpg&quot; srcset=&quot;/static/8783b8d893ea817712dbc35771dec414/ff44c/golang_concurrency.jpg 158w,
/static/8783b8d893ea817712dbc35771dec414/a6688/golang_concurrency.jpg 315w,
/static/8783b8d893ea817712dbc35771dec414/828fb/golang_concurrency.jpg 630w,
/static/8783b8d893ea817712dbc35771dec414/0ede0/golang_concurrency.jpg 945w,
/static/8783b8d893ea817712dbc35771dec414/6a068/golang_concurrency.jpg 960w&quot; sizes=&quot;(max-width: 630px) 100vw, 630px&quot; style=&quot;width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;&quot; loading=&quot;lazy&quot; decoding=&quot;async&quot;&gt;
  &lt;/a&gt;
    &lt;/span&gt;
&lt;/div&gt;
&lt;p&gt;앞서 Go 기본 문법책을 살펴보면서 공부했던 동시성 개발에 대해 더 자세히 알고 싶어 동시성에 대해서만 다루고 있는 책을 살펴보았다.
&lt;code class=&quot;language-text&quot;&gt;Go 동시성 프로그래밍&lt;/code&gt;이라는 책인데, 동시성 개발의 역사부터 시작해서 Go언어에서 어떤 동시성 패턴을 제공하는지, 어떻게 더 편리하게 동시성을 관리할 수 있는지 패턴등을 알려주고 있다.&lt;/p&gt;
&lt;p&gt;본 마크다운 문서에서는 책을 읽으면서 배운 용어들에 대해 정리하기 위해 작성을 시작하게 되었다.&lt;/p&gt;
&lt;h1&gt;1. 동시성 소개&lt;/h1&gt;
&lt;h2&gt;1. 프로비저닝 (Provisioning)&lt;/h2&gt;
&lt;p&gt;프로비저닝이란 서버나 사용자등의 액세스를 설정하는 행위를 말한다. 클라우드 컴퓨팅이 대세가 된 2000년대 초부터 대부분의 IT 업체들은 자원을 프로비저닝하고, 장비 인스턴스 간에 통신하고, 결과를 집계하고 저장하는 문제를 겪어왔다. 무엇보다도 코드를 동시적으로 모델링하는 방법을 이해하는 것이 가장 어려웠는데, 이러한 모델링 시의 몇 가지 사안을 해결하면서 웹 스케일(Web Sacle)이라는 새로운 유명 소프트웨어 브랜드로 이어지게 되었다.&lt;/p&gt;
&lt;h2&gt;2. 웹 스케일 (Web Scale)&lt;/h2&gt;
&lt;p&gt;글로벌 수준 대규모의 환경에서도 높은 품질의 서비스를 영속적으로 제공하며, 비즈니스의 요구사항에 맞춰 신속하고 안정적으로 IT 자원을 설계, 구축, 관리하는 패턴이다. 주로 아마존, 구글, 페이스북 등 대형 클라우드 서비스 제공업체들의 클라우드 운영 방식을 말한다. 이들은 자신들의 인터넷 서비스를 더 빠르고 신속하게 전달하기 위해 데이터 센터를 짓고 클라우드를 운영한다. 이들의 만드는 웹 지향 아키텍쳐를 개발자가 장애를 더 빠르게 복구하며, 더 유연하고 탄력적인 시스템을 구축할 수 있도록 돕는다. 이들 회사들이 서버, 스토리지, 네트워크 등을 최적화하여 운영하게 된다.&lt;/p&gt;
&lt;h2&gt;3. 레이스 컨디션 (Race Condition)&lt;/h2&gt;
&lt;p&gt;둘 이상의 작업이 올바른 순서로 실행되어야 하지만, 프로그램이 그렇게 작성되지 않아서 순서가 유지되는 것이 보장되지 않을 때 발생. 두 프로세스가 서로 자원을 차지하기 위해 경쟁하는 상태를 의미.&lt;/p&gt;
&lt;h2&gt;4. 원자성&lt;/h2&gt;
&lt;p&gt;동작하는 Context 내에서 나누어지거나 중단되지 않는 것을 의미. 특정 연산에 대해 원자성이랑 더 이상 쪼개지지 않는 단위를 의미한다. Context에 따라서 원자성의 단위는 달라질 수 있다.&lt;/p&gt;
&lt;h2&gt;5. 컨텍스트(Context)&lt;/h2&gt;
&lt;p&gt;어떤 연산을 원자적이라고 판단할 수 있는 범위.&lt;/p&gt;
&lt;h2&gt;6. 임계 영역 (Critical Section)&lt;/h2&gt;
&lt;p&gt;프로그램에서 공유 리소스에 독점적으로 접근해야 하는 영역.&lt;/p&gt;
&lt;h2&gt;7. 데드락 (Dead Lock)&lt;/h2&gt;
&lt;p&gt;프로그램이 데드락 상태에 빠지면, 해당 프로그램에서 동시에 실행 중인 모든 프로세스는 자신이 아닌 다른 프로세스가 끝나길 기다린다. 데드락 상태는 외부 개입 없이는 결코 프로그램을 복구시킬 수 없다.&lt;/p&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;text&quot;&gt;&lt;pre class=&quot;language-text&quot;&gt;&lt;code class=&quot;language-text&quot;&gt;- 코프먼 조건: 데드락의 발생 조건
1. 상호 배제(Mutual Exclusion): 동시에 실행되는 프로세스가 어떤 임의의 시점에 하나의 리소스에 대한 배타적 권리를 보유한다.
2. 대기 조건(Wait For Condition): 동시에 실행되는 프로세스는 하나의 리소스를 보유하고 있는 동시에 또 다른 리소스를 기다리고 있다.
3. 비선점(Non Preemption): 동시에 실행되는 프로세스 중 하나를 보유하고 있는 리소스는 해당 프로세스에 의해서만 사용 해제될 수 있다. (외부에 의해 사용 해제될 수 없다.)
4. 순환 대기(Circual Wait): 동시에 실행되는 프로세스들은 순환적으로 다음 프로세스가 요구하는 리소스를 가지고 있다.&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;h2&gt;8. 라이브락 (Live Lock)&lt;/h2&gt;
&lt;p&gt;프로그램들이 활동적으로 동시에 연산을 수행하고는 있지만, 이 연산들의 실제로 프로그램의 상태를 진행시키는 데 아무런 영향을 주지 못하는 의미 없는 연산 상태를 의미한다.&lt;/p&gt;
&lt;h2&gt;9. 기아 상태 (Starvation)&lt;/h2&gt;
&lt;p&gt;어떤 동시 프로세스가 작업을 수행하는 데 필요한 모든 리소스를 얻을 수 없는 상황.&lt;/p&gt;
&lt;h2&gt;10. 쓰레드 풀 (Thread Pool)&lt;/h2&gt;
&lt;p&gt;실행 중인 어플리케이션에서 사용자로부터 들어온 요청을 작업큐에 넣고, 쓰레드 풀은 이러한 작업큐에 들어온 작업들을 미리 생성해놓은 쓰레드에게 할당한다. 일을 다 처리한 쓰레드들은 다시 어플리케이션에 결과값을 리턴한다.&lt;/p&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;text&quot;&gt;&lt;pre class=&quot;language-text&quot;&gt;&lt;code class=&quot;language-text&quot;&gt;- 쓰레드 풀의 장점
1. 프로그램 성능저하를 방지
매번 발생되는 작업을 병렬처리하기 위해 스레드를 생성/수거하는데 따른 부담은 프로그램 전체적인 퍼포먼스 저하시킨다. 따라서 쓰레드풀을 만들어 놓는다.

2. 다수의 사용자 요청을 처리하기 위해
서비스적인 측면으로 바라볼 때 특히 대규모 프로젝트에서 중요하다. 다수의 사용자의 요청을 수용하고, 빠르게 처리하고 대응하기 위해 스레드풀을 사용한다.


- 쓰레드 풀의 단점
1. 과생성된 쓰레드 풀은 메모리를 낭비한다.

2. 제대로 설정하지 않으면 노는 쓰레드가 발생한다.&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;h2&gt;11. CSP (Communicationg Sequential Processes)&lt;/h2&gt;
&lt;p&gt;동시성을 다루는 고전적이지 않은 모델. 기존과 같이 공유 메모리에 대한 임계 지역을 설정하고 Mutex를 사용하여 프로세스간의 통신을 하는 방식이 아니라, 고루틴과 채널을 사용하여 프로세서간의 통신을 통해 메모리를 공유하는 방식이다. 1978년 찰스 안토니 리차드 호어의 미국 계산기 학회(ACM)에서 발표한 &lt;a href=&quot;http://bit.ly/HoareCSP&quot;&gt;논문&lt;/a&gt;의 내용을 기초로 한다.&lt;/p&gt;</content:encoded></item><item><title><![CDATA[[프로그래머스 연습문제] 스택, 큐]]></title><description><![CDATA[[Level 2] 기능 개발 기능 개발은 순차적으로 배포 가능한 기능들의 완료 시점을 계산하여 특정 일에 몇 개의 기능을 배포할 수 있는지 계산하는 문제였다. 문제 자체는 매우 쉬우나, 테스트 케이스 1…]]></description><link>https://github.com/SiverPineValley/SiverPineValley.github.io/algorithm/programmers_stack,queue/</link><guid isPermaLink="false">https://github.com/SiverPineValley/SiverPineValley.github.io/algorithm/programmers_stack,queue/</guid><pubDate>Sat, 02 Jul 2022 14:22:22 GMT</pubDate><content:encoded>&lt;h2&gt;[Level 2] 기능 개발&lt;/h2&gt;
&lt;p&gt;기능 개발은 순차적으로 배포 가능한 기능들의 완료 시점을 계산하여 특정 일에 몇 개의 기능을 배포할 수 있는지 계산하는 문제였다. 문제 자체는 매우 쉬우나, 테스트 케이스 11번에서 함정이 있다. 배포 가능 기간을 계산하는 공식 중 &lt;code class=&quot;language-text&quot;&gt;(100 - 30) / 30&lt;/code&gt;과 같이 특정 케이스에서 결과가 2.XXXXX와 같은 값으로 나오는 경우가 있다. 이런 경우를 방지하기 위해 나머지가 생기는 경우에는 +1을 해주도록 하였다.&lt;/p&gt;
&lt;/br&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;c++&quot;&gt;&lt;pre class=&quot;language-c++&quot;&gt;&lt;code class=&quot;language-c++&quot;&gt;#include &amp;lt;string&amp;gt;
#include &amp;lt;queue&amp;gt;
#include &amp;lt;vector&amp;gt;

using namespace std;

vector&amp;lt;int&amp;gt; solution(vector&amp;lt;int&amp;gt; progresses, vector&amp;lt;int&amp;gt; speeds) {
    vector&amp;lt;int&amp;gt; answer;
    queue&amp;lt;int&amp;gt; q;
    int size = progresses.size();
    
    // 큐에 담기
    for (int i = 0; i &amp;lt; size; i++) {
        if ((100-progresses[i]) % speeds[i] != 0) {
            q.push(((100 - progresses[i]) / speeds[i]) + 1);
            continue;
        }
        q.push((100 - progresses[i]) / speeds[i]);
    }
    
    // 하나씩 뽑기
    int now = 0;
    int job = 0;
    while(!q.empty()) {
        int f = q.front();
        q.pop();
        
        if (now == 0) {
            now = f;
            job++;
        } else if (now &amp;lt; f) {
            answer.push_back(job);
            job = 1;
            now = f;
        } else {
            job++;
        }
    }
    
    if (job != 0) {
        answer.push_back(job);        
    }

    return answer;
}&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;h2&gt;[LEVEL 2] 프린터&lt;/h2&gt;
&lt;p&gt;프린터는 출력 우선순위에 따라 출력하는 순서를 정해 초기에 특정 location에 있던 출력물이 언제 출력되는지를 결과로 리턴하는 문제이다. 데이터 수가 많지 않아 그냥 O(n^2)으로 코드를 짰다. 주요 고려해야할 사항으로는 location의 변화를 기록해야 하고, max의 변화를 수시로 체크해야 하는 정도였다.&lt;/p&gt;
&lt;br&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;c++&quot;&gt;&lt;pre class=&quot;language-c++&quot;&gt;&lt;code class=&quot;language-c++&quot;&gt;#include &amp;lt;string&amp;gt;
#include &amp;lt;vector&amp;gt;

using namespace std;

struct Wait {
    int priority;
    bool loc;
};

int solution(vector&amp;lt;int&amp;gt; priorities, int location) {
    int answer = 0;
    int size = priorities.size();
    int max = -1;
    vector&amp;lt;Wait&amp;gt; v;
    
    for(int i = 0; i &amp;lt; size; i++) {
        v.push_back(Wait{priorities[i], i == location});
        if (max &amp;lt; priorities[i]) {
            max = priorities[i];
        }
    }
    
    while(!v.empty()) {
        Wait f = v.front();
        v.erase(v.begin());
        if (f.priority &amp;lt; max) {
            v.push_back(Wait{f.priority, f.loc});
        } else {
            answer++;
            if (f.loc) {
                break;
            }
            
            max = -1;
            for(auto iter = v.begin(); iter != v.end(); iter++) {
                if (iter-&amp;gt;priority &amp;gt; max) {
                    max = iter-&amp;gt;priority;
                }
            }
        }
    }
    
    return answer;
}&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;h2&gt;[LEVEL 2] 다리를 지나는 트럭&lt;/h2&gt;
&lt;p&gt;다리를 지나는 트럭 문제는 여러 댓수의 트럭이 다리를 지날 때 다리의 길이와 최대 적재 중량을 고려하여 언제 모든 트럭이 다리를 지날 수 있을지 구하는 문제이다. 알고리즘 유형은 시뮬레이션에 가깝다. 그러다보니 구현하기가 좀 어려운 편이였다. 테스트 케이스 중에 4,5,6,9번만 계속 실패했었는데, 나와 비슷하게 실패한 분들의 도움으로 원인을 알 수 있었다. &lt;code class=&quot;language-text&quot;&gt;5, 5, [2,2,2,2,1,1,1,1,1], 19&lt;/code&gt; 로 테스트 케이스를 돌려보면 11 -&gt; 12초로 갈 때 지나가던 무게 2 차량이 빠지고 1차량이 하나 추가되는데, 진입하는 차량을 먼저 넣고 &lt;code class=&quot;language-text&quot;&gt;continue&lt;/code&gt; 되다보니, 빠져나가는 차량이 고려되지 않아 한번 빠져나가고 12초에 한번 더 진입하면서 문제가 발생하였다. 즉, 직전에 한 번 빠져나가고, 두번이 연속으로 들어올 때 고려하지 못한 케이스가 있던 것 이었다.&lt;/p&gt;
&lt;p&gt;기존 코드가 맘에 들진 않지만 다 뒤집어 엎고 다시 짜기에는 너무 오래걸릴 것 같아서... 그냥 기존 코드에 내용을 추가하여 해결할 수 있었다. 위와 같은 함정 때문인지 체감 난이도는 LEVEL 3였다고 생각한다.&lt;/p&gt;
&lt;br&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;c++&quot;&gt;&lt;pre class=&quot;language-c++&quot;&gt;&lt;code class=&quot;language-c++&quot;&gt;#include &amp;lt;string&amp;gt;
#include &amp;lt;vector&amp;gt;
#include &amp;lt;queue&amp;gt;

using namespace std;

struct Prog {
    int weight;
    int time;
};

int solution(int bridge_length, int weight, vector&amp;lt;int&amp;gt; truck_weights) {
    int time = 0;
    int size = truck_weights.size();
    int on_bridge = 0;
    queue&amp;lt;Prog&amp;gt; q;
    bool prev_out = false;

    while(!truck_weights.empty() || !q.empty()) {
        if (!truck_weights.empty()) {
            int f = truck_weights.front();
            // 다리에 더 들어갈 수 있을 때
            if (on_bridge + f &amp;lt;= weight) {
                if (!prev_out) {
                    time++;
                }
                q.push(Prog{f, time});
                truck_weights.erase(truck_weights.begin());
                on_bridge += f;
                prev_out = false;
                
                if (!q.empty()) {
                    Prog o = q.front();
                    if (bridge_length - (time - o.time) != 1) {
                        continue;
                    }
                }
                else continue;
            }
        }
        Prog o = q.front();
        time += bridge_length - (time - o.time);
        on_bridge -= o.weight;
        q.pop();
        prev_out = true;
    }
    
    return time;
}&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;h2&gt;[LEVEL 2] 주식 가격&lt;/h2&gt;
&lt;p&gt;이전의 다리를 지나는 트럭 문제가 엄청 고생시킨 문제였다면, 이 문제는 엄청 간단했다. 각 주식 시간대별 가격이 얼마나 떨어지지 않느냐를 구하는 문제였다. 왜 스택/큐 문제인지는 모르겠으나, O(n^2)으로 해도 시간 안에 해결 가능한 문제라 그냥 간단하게 구현했다.&lt;/p&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;c++&quot;&gt;&lt;pre class=&quot;language-c++&quot;&gt;&lt;code class=&quot;language-c++&quot;&gt;#include &amp;lt;string&amp;gt;
#include &amp;lt;vector&amp;gt;

using namespace std;

vector&amp;lt;int&amp;gt; solution(vector&amp;lt;int&amp;gt; prices) {
    vector&amp;lt;int&amp;gt; answer;
    int size = prices.size();
    
    for(int i = 0; i &amp;lt; size; i++) {
        int time = 0;
        for(int j = i + 1; j &amp;lt; size; j++) {
            if (prices[i] &amp;lt;= prices[j]) {
                time++;
                continue;
            }
            time++;
            break;
        }
        answer.push_back(time);
    }
    
    return answer;
}&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;</content:encoded></item><item><title><![CDATA[[프로그래머스 연습문제] Dynamic Programming]]></title><description><![CDATA[이번에는 다이나믹 프로그래밍 문제들을 풀어보았다.
DP 알고리즘은 개념 자체가 생소하고 문제에 적용하기 어려워 그런지 LV3 이상 문제부터 있었다. [Level 3] N으로 표현 레벨 3인데 난이도가 생각보다 어려웠다... DP…]]></description><link>https://github.com/SiverPineValley/SiverPineValley.github.io/algorithm/programmers_dynamic/</link><guid isPermaLink="false">https://github.com/SiverPineValley/SiverPineValley.github.io/algorithm/programmers_dynamic/</guid><pubDate>Sat, 11 Jun 2022 16:00:22 GMT</pubDate><content:encoded>&lt;p&gt;이번에는 다이나믹 프로그래밍 문제들을 풀어보았다.
DP 알고리즘은 개념 자체가 생소하고 문제에 적용하기 어려워 그런지 LV3 이상 문제부터 있었다.&lt;/p&gt;
&lt;h2&gt;[Level 3] N으로 표현&lt;/h2&gt;
&lt;p&gt;레벨 3인데 난이도가 생각보다 어려웠다... DP를 어떻게 적용할 수 있을까를 엄청 고민했다가 처음에 크게 실수 했다.
처음 생각한 방안은 각 메모리에 메모리 인덱스를 만들 수 있는 가장 최소가 되는 개수를 넣는 방법이었다.
하지만 이렇게 구현하려면, 메모리를 몇개 까지 제한을 둬야 하는지, 0은 어떻게 처리할지 등 고민할게 너무 많아서 다른 방법을 찾아보다
각 인덱스를 횟수로 두고, 각 횟수에서 가능한 숫자가 몇인지를 기록하는 방법이었다.
즉, 반대로 저장하는 것이 정답이었다.&lt;/p&gt;
&lt;p&gt;기록은 unordered_set을 사용했는데, set 자료구조 자체가 중복되는 값을 저장하지 않고,
unorderd_set은 순서도 고려하지 않아 일반 set보다 더 효율적이라 사용하였다.&lt;/p&gt;
&lt;p&gt;코드의 전체적인 구조는 아래와 같다.
각 단계에서 가능한 연산은 +, -, *, /, NN이었는데, 각 단계별로 연산한 값을 저장하고
마지막에 number가 저장되었는지 확인해서 리턴해주면 되는 식으로 구현하였다.&lt;/p&gt;
&lt;/br&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;c++&quot;&gt;&lt;pre class=&quot;language-c++&quot;&gt;&lt;code class=&quot;language-c++&quot;&gt;#include &amp;lt;vector&amp;gt;
#include &amp;lt;unordered_set&amp;gt;

using namespace std;

int getN(int N, int idx) {
    int accum = N;
    
    for (int i = 0; i &amp;lt; idx; i++) {
        accum = accum * 10 + N;
    }
    
    return accum;
}

int solution(int N, int number) {
    if (N == number) return 1;
    vector&amp;lt;unordered_set&amp;lt;int&amp;gt;&amp;gt; arr(8);
    arr[0].insert(N);
    
    for (int i = 0; i &amp;lt; 8; i++) {
        // N 연속 붙이는 부분 넣기
        arr[i].insert(getN(N, i));
        
        // 나머지 사칙연산 넣기
        for (int j = 0; j &amp;lt; i; j++) {
            for (int k = 0; k &amp;lt; i; k++) {
                if (j + k + 1 != i) continue;
                    for (int a : arr[j]) {
                        for (int b : arr[k]) {
                            arr[i].insert(a + b);

                            if (a - b &amp;gt; 0) {
                                arr[i].insert(a - b);
                            }

                            arr[i].insert(a * b);

                            if (a / b &amp;gt; 0) arr[i].insert(a / b);
                    }
                }
            }
        }
        if (arr[i].find(number) != arr[i].end())
            return i + 1; 
    }
    
    return -1;
}&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;/br&gt;
&lt;h2&gt;[Level 3] 정수 삼각형&lt;/h2&gt;
&lt;p&gt;정석적인 다이나믹프로그래밍 문제였다.
이번에는 top-down이 아닌, bottom-up 반복문으로 풀이해보았다.&lt;/p&gt;
&lt;p&gt;풀이 방법은 각 삼각형 노드 방문 시 끝부분일 경우에는 여러 노드를 방문하지 않도록 예외 케이스를 주었다는 점이다.
또 신기한 것이 기존처럼 매크로 3항 연산 함수를 사용하는 것보다 아래와 같이 그냥 함수를 사용하는 것이 더 효율성이 좋다는 점 이었다.&lt;/p&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;c++&quot;&gt;&lt;pre class=&quot;language-c++&quot;&gt;&lt;code class=&quot;language-c++&quot;&gt;#include &amp;lt;string&amp;gt;
#include &amp;lt;vector&amp;gt;

using namespace std;
int answer, height, d[501][501];
int max(int a, int b){
    return a &amp;gt; b ? a : b;
}

int solution(vector&amp;lt;vector&amp;lt;int&amp;gt;&amp;gt; triangle) {
    answer = d[0][0] = triangle[0][0];
    height = triangle.size();
    
    for(int i=1; i&amp;lt;height; i++){
        for(int j=0; j&amp;lt;=i; j++){
            if(j == 0){
                d[i][j] = d[i-1][j] + triangle[i][j];
            }else if(j == i){
                d[i][j] = d[i-1][j-1] + triangle[i][j];
            }
            else{
                d[i][j] = max(d[i-1][j-1], d[i-1][j]) + triangle[i][j];
            }
            
            answer = max(answer, d[i][j]);
        }
    }
    return answer;
}&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;h2&gt;[Level 4] 도둑질&lt;/h2&gt;
&lt;p&gt;고득점 Kit 다이나믹 프로그래밍 문제 중 가장 난이도가 높은 문제이다.
문제 자체는 이해하기 쉬운 편이다. 집이 순환형으로 배치되어 있을 때 연속되는 집을 방문하지 않고 방문해서 가장 큰 수익을 얻을 수 있는 방법을 찾는 문제였다.
다만, 문제가 간단하고 제한사항이 많지 않았지만 순환형으로 집이 배치되어 있다는 점 때문에 난이도가 급 상승하게 된다.&lt;/p&gt;
&lt;p&gt;처음 점화식 세울 때도 고민을 했는데, 찾아낸 방법은 처음부터 집의 가치를 누적해간다고 했을 때 &lt;code class=&quot;language-text&quot;&gt;현재 단계 누적 가치 = max(이전 단계 누적 가치, 전전 단계 누적 가치 + 현재 집 가치)&lt;/code&gt; 이다. 집이 일자로 배치되어 있고, 지금 문제처럼 이어지 있지 않을 때는 이 방법으로 바로 계산이 가능하나, 순환형 배치라 여기서 더 고민이 추가되어야 한다.&lt;/p&gt;
&lt;p&gt;첫 번째 집을 고르면 마지막 집을 고르지 말아야 하고, 마지막 집을 고르면 첫 번째 집을 고르지 말아야 한다. 이 부분을 어떻게 구현해야 할지 엄청나게 고민했지만 혼자서는 결론을 내지 못하고 있다가 &lt;a href=&quot;https://programmers.co.kr/questions/31576&quot;&gt;누군가의 해설&lt;/a&gt; 덕분에 방법을 찾아낼 수 있었다. 이 분도 나랑 같은 고민을 꽤나 현명하게 해결하셨는데, 그냥 마지막 집이 빠진 배열, 첫 번째 집이 빠진 배열 두개로 나눠 동시에 구하면 된다는 것 이었다. 또한, 각 배열 앞에 0을 추가하여 첫 번째 점화식 적용 지점에서 첫 번째, 두 번째 집을 비교할 수 있도록 하면 굉장히 쉽게 해결이 가능하다.&lt;/p&gt;
&lt;p&gt;역시 정답 또한 간단했다.&lt;/p&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;c++&quot;&gt;&lt;pre class=&quot;language-c++&quot;&gt;&lt;code class=&quot;language-c++&quot;&gt; #include &amp;lt;string&amp;gt;
#include &amp;lt;vector&amp;gt;

using namespace std;

int max(int a, int b) {
    if (a &amp;gt; b) return a;
    return b;
}

int solution(vector&amp;lt;int&amp;gt; money) {
    int num = money.size();
    vector&amp;lt;int&amp;gt; first(num, 0);
    vector&amp;lt;int&amp;gt; second(num, 0);
    
    for(int i = 1; i &amp;lt; num; i++) {
        first[i] = money[i-1];
        second[i] = money[i];
    }
    
    for(int i = 2; i &amp;lt; num; i++) {
        first[i] = max(first[i - 1], first[i - 2] + first[i]);
        second[i] = max(second[i - 1], second[i - 2] + second[i]);
    }
    
    return max(first[num - 1], second[num - 1]);
}&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;</content:encoded></item><item><title><![CDATA[[Go 언어 문법 정리] 06. 패키지]]></title><description><![CDATA[1. 운영체제에 종족적인 코드 처리 운영체제에 따라 코드가 다를 경우 다음과 같은 방식으로 처리할 수 있다. ₩runtime.GOOS`로 운영체제를 확인한 후 분기 처리. 해당 상수는 runtime…]]></description><link>https://github.com/SiverPineValley/SiverPineValley.github.io/golang/package/</link><guid isPermaLink="false">https://github.com/SiverPineValley/SiverPineValley.github.io/golang/package/</guid><pubDate>Sat, 11 Jun 2022 14:18:32 GMT</pubDate><content:encoded>&lt;h2&gt;1. 운영체제에 종족적인 코드 처리&lt;/h2&gt;
&lt;p&gt;운영체제에 따라 코드가 다를 경우 다음과 같은 방식으로 처리할 수 있다.&lt;/p&gt;
&lt;ol&gt;
&lt;li&gt;
&lt;p&gt;₩runtime.GOOS`로 운영체제를 확인한 후 분기 처리. 해당 상수는 runtime 패키지에 정의되어 있는 상수이고, 운영체제를 확인할 때 사용한다. 운영체제에 따라 darwin, freebsd, linux, windows를 반환하며 이 값으로 분기 처리를 한다.&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;운영체제별로 .go 파일을 분리&lt;/p&gt;
&lt;/li&gt;
&lt;/ol&gt;
&lt;p&gt;패키지 안에 main.go, util_linux.go, util_windows.go 파일이 있을 때 리눅스로 빌드하면 util_windows.go 파일은 무시된다. 반대의 케이스도 마찬가지로 적용된다.&lt;/p&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;go&quot;&gt;&lt;pre class=&quot;language-go&quot;&gt;&lt;code class=&quot;language-go&quot;&gt;&lt;span class=&quot;token keyword&quot;&gt;package&lt;/span&gt; main

&lt;span class=&quot;token keyword&quot;&gt;func&lt;/span&gt; &lt;span class=&quot;token function&quot;&gt;main&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;
    &lt;span class=&quot;token function&quot;&gt;showOS&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;
&lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;go&quot;&gt;&lt;pre class=&quot;language-go&quot;&gt;&lt;code class=&quot;language-go&quot;&gt;&lt;span class=&quot;token keyword&quot;&gt;package&lt;/span&gt; main

&lt;span class=&quot;token keyword&quot;&gt;import&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;
    &lt;span class=&quot;token string&quot;&gt;&quot;fmt&quot;&lt;/span&gt;
    &lt;span class=&quot;token string&quot;&gt;&quot;runtime&quot;&lt;/span&gt;
&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;

&lt;span class=&quot;token keyword&quot;&gt;func&lt;/span&gt; &lt;span class=&quot;token function&quot;&gt;showOS&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;
    fmt&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;Println&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token string&quot;&gt;&quot;현재 파일: util_darwin.go&quot;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;
    fmt&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;Println&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;runtime&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;GOOS&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;
&lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;go&quot;&gt;&lt;pre class=&quot;language-go&quot;&gt;&lt;code class=&quot;language-go&quot;&gt;&lt;span class=&quot;token keyword&quot;&gt;package&lt;/span&gt; main

&lt;span class=&quot;token keyword&quot;&gt;import&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;
    &lt;span class=&quot;token string&quot;&gt;&quot;fmt&quot;&lt;/span&gt;
    &lt;span class=&quot;token string&quot;&gt;&quot;runtime&quot;&lt;/span&gt;
&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;

&lt;span class=&quot;token keyword&quot;&gt;func&lt;/span&gt; &lt;span class=&quot;token function&quot;&gt;showOS&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;
    fmt&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;Println&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token string&quot;&gt;&quot;현재 파일: util_linux.go&quot;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;
    fmt&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;Println&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;runtime&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;GOOS&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;
&lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;h2&gt;2. Refelction&lt;/h2&gt;
&lt;p&gt;reflect 패키지를 사용하면 프로그램의 메타 데이터를 활용하여 객체를 동적으로 제어할 수 있다. 즉, 런타임 시 타입이 정해지지 않은 값의 실제 타입을 확인하여 그 값의 메서드를 호출하거나 내부 필드에 접근할 수 있다.&lt;/p&gt;
&lt;h3&gt;2.1 타입/값 정보 확인&lt;/h3&gt;
&lt;p&gt;reflect 패키지를 이용해서 값의 타입과 실제 값을 확인할 수 있다. reflect.TypeOf(), reflect.ValueOf()가 그것이다. ValueOf() 함수에는 Bool(), Complex(), String(), Int() 와 같이 실제 값을 확인하는 메서드가 있다.&lt;/p&gt;
&lt;p&gt;슬라이스와 맵 같은 컬렉션 타입이나 구조체도 리플렉션으로 메타 정보를 확인할 수 있다. 구조체의 태그 정보에 접근할 때도 리플렉션을 사용한다.&lt;/p&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;go&quot;&gt;&lt;pre class=&quot;language-go&quot;&gt;&lt;code class=&quot;language-go&quot;&gt;&lt;span class=&quot;token keyword&quot;&gt;type&lt;/span&gt; User &lt;span class=&quot;token keyword&quot;&gt;struct&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;
    Name &lt;span class=&quot;token builtin&quot;&gt;string&lt;/span&gt; &lt;span class=&quot;token string&quot;&gt;&quot;check:len(3,40)&quot;&lt;/span&gt;
    Id &lt;span class=&quot;token builtin&quot;&gt;int&lt;/span&gt; &lt;span class=&quot;token string&quot;&gt;&quot;check:range(1,999999)&quot;&lt;/span&gt;
&lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;

u &lt;span class=&quot;token operator&quot;&gt;:=&lt;/span&gt; User&lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;&lt;span class=&quot;token string&quot;&gt;&quot;Jang&quot;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;token number&quot;&gt;1&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;
uType &lt;span class=&quot;token operator&quot;&gt;:=&lt;/span&gt; reflect&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;TypeOf&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;u&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;

&lt;span class=&quot;token keyword&quot;&gt;if&lt;/span&gt; fName&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; ok &lt;span class=&quot;token operator&quot;&gt;:=&lt;/span&gt; uType&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;FieldByName&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token string&quot;&gt;&quot;Name&quot;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt; ok &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;
    fmt&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;Println&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;fName&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;Type&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; fName&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;Name&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; fName&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;Tag&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;
&lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;

&lt;span class=&quot;token keyword&quot;&gt;if&lt;/span&gt; fId&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; ok &lt;span class=&quot;token operator&quot;&gt;:=&lt;/span&gt; uType&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;FieldByName&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token string&quot;&gt;&quot;Id&quot;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt; ok &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;
    fmt&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;Println&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;fId&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;Type&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; fId&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;Name&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; fId&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;Tag&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;
&lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;h3&gt;2.2 값 변경&lt;/h3&gt;
&lt;p&gt;reflect.Value 내부의 실제 값이 변경할 수 있는 값이라면 그 값을 동적으로 변경할 수 있다. 변경 가능한 값인지는 reflect.Value.CanSet() 메서드로 확인한다. int, float64, string처럼 변경할 수 없는 값은 그 값을 SetXXX 메서드로 변경할 수 없다. 하지만 Elem() 메서드를 사용하여 주소에 접근하는 방법을 통해 다른 값으로 교체할 수 있다.&lt;/p&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;go&quot;&gt;&lt;pre class=&quot;language-go&quot;&gt;&lt;code class=&quot;language-go&quot;&gt;x &lt;span class=&quot;token operator&quot;&gt;:=&lt;/span&gt; &lt;span class=&quot;token number&quot;&gt;1&lt;/span&gt;
&lt;span class=&quot;token keyword&quot;&gt;if&lt;/span&gt; v &lt;span class=&quot;token operator&quot;&gt;:=&lt;/span&gt; refelct&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;ValueOf&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;x&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt; v&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;CanSet&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;
    v&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;SetInt&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token number&quot;&gt;2&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;token comment&quot;&gt;// 호출되지 않음&lt;/span&gt;
&lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;

fmt&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;Println&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;x&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;token comment&quot;&gt;// 1&lt;/span&gt;

v &lt;span class=&quot;token operator&quot;&gt;:=&lt;/span&gt; reflect&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;ValueOf&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;&amp;amp;&lt;/span&gt;x&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;
p &lt;span class=&quot;token operator&quot;&gt;:=&lt;/span&gt; v&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;Elem&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;
p&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;SetInt&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token number&quot;&gt;3&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;
fmt&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;Println&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;x&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;token comment&quot;&gt;// 3&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;h3&gt;2.3 함수/메서드 동적 호출&lt;/h3&gt;
&lt;p&gt;리플렉션을 사용하면 동적으로 함수나 메서드를 호출할 수 있다. 다음 예제는 TitleCase() 함수를 두 번 호출하여 결과값을 출력하는데, 첫 번째 함수를 바로 호출하고 두 번째는 리플렉션을 사용한다.&lt;/p&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;go&quot;&gt;&lt;pre class=&quot;language-go&quot;&gt;&lt;code class=&quot;language-go&quot;&gt;&lt;span class=&quot;token keyword&quot;&gt;func&lt;/span&gt; &lt;span class=&quot;token function&quot;&gt;TitleCase&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;s &lt;span class=&quot;token builtin&quot;&gt;string&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;token builtin&quot;&gt;string&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;
    &lt;span class=&quot;token keyword&quot;&gt;return&lt;/span&gt; strings&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;Title&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;s&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;
&lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;

&lt;span class=&quot;token keyword&quot;&gt;func&lt;/span&gt; &lt;span class=&quot;token function&quot;&gt;main&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;
    caption &lt;span class=&quot;token operator&quot;&gt;:=&lt;/span&gt; &lt;span class=&quot;token string&quot;&gt;&quot;go is an open source programming language&quot;&lt;/span&gt;

    &lt;span class=&quot;token comment&quot;&gt;// TitleCase를 바로 호출&lt;/span&gt;
    title &lt;span class=&quot;token operator&quot;&gt;:=&lt;/span&gt; &lt;span class=&quot;token function&quot;&gt;TitleCase&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;caption&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;
    fmt&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;Println&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;title&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;

    &lt;span class=&quot;token comment&quot;&gt;// TitleCase를 동적으로 호출&lt;/span&gt;
    titleFuncValue &lt;span class=&quot;token operator&quot;&gt;:=&lt;/span&gt; reflect&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;ValueOf&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;TitleCase&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;
    values &lt;span class=&quot;token operator&quot;&gt;:=&lt;/span&gt; titleFuncValue&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;Call&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;[&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;]&lt;/span&gt;reflect&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;Value&lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;reflect&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;ValueOf&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;caption&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;
    title &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; values&lt;span class=&quot;token punctuation&quot;&gt;[&lt;/span&gt;&lt;span class=&quot;token number&quot;&gt;0&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;]&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;String&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;
    fmt&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;Println&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;title&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;
&lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;go&quot;&gt;&lt;pre class=&quot;language-go&quot;&gt;&lt;code class=&quot;language-go&quot;&gt;&lt;span class=&quot;token keyword&quot;&gt;func&lt;/span&gt; &lt;span class=&quot;token function&quot;&gt;Len&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;x &lt;span class=&quot;token keyword&quot;&gt;interface&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;token builtin&quot;&gt;int&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;
    value &lt;span class=&quot;token operator&quot;&gt;:=&lt;/span&gt; reflect&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;ValueOf&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;x&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;
    &lt;span class=&quot;token keyword&quot;&gt;switch&lt;/span&gt; refelct&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;TypeOf&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;x&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;Kind&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;
        &lt;span class=&quot;token keyword&quot;&gt;case&lt;/span&gt; reflect&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;Array&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; reflect&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;Chan&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; reflect&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;Map&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; reflect&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;Slice&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; reflect&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;String&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt;
            &lt;span class=&quot;token keyword&quot;&gt;return&lt;/span&gt; Value&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;Len&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;
        &lt;span class=&quot;token keyword&quot;&gt;default&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt;
            &lt;span class=&quot;token keyword&quot;&gt;if&lt;/span&gt; method &lt;span class=&quot;token operator&quot;&gt;:=&lt;/span&gt; value&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;MethodByName&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token string&quot;&gt;&quot;Len&quot;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt; method&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;IsValid&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;
                values &lt;span class=&quot;token operator&quot;&gt;:=&lt;/span&gt; method&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;Call&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token boolean&quot;&gt;nil&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;
                &lt;span class=&quot;token keyword&quot;&gt;return&lt;/span&gt; &lt;span class=&quot;token function&quot;&gt;int&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;Values&lt;span class=&quot;token punctuation&quot;&gt;[&lt;/span&gt;&lt;span class=&quot;token number&quot;&gt;0&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;]&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;Int&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;
            &lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;
    &lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;

    &lt;span class=&quot;token function&quot;&gt;panic&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;fmt&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;Sprintf&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token string&quot;&gt;&quot;&apos;%v&apos; does not hiave a length&quot;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; x&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;
&lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;

&lt;span class=&quot;token keyword&quot;&gt;func&lt;/span&gt; &lt;span class=&quot;token function&quot;&gt;main&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;
    a &lt;span class=&quot;token operator&quot;&gt;:=&lt;/span&gt; list&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;New&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;
    b &lt;span class=&quot;token operator&quot;&gt;:=&lt;/span&gt; list&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;New&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;
    b&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;PushFront&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token number&quot;&gt;0.5&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;
    c &lt;span class=&quot;token operator&quot;&gt;:=&lt;/span&gt; &lt;span class=&quot;token keyword&quot;&gt;map&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;[&lt;/span&gt;&lt;span class=&quot;token builtin&quot;&gt;string&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;]&lt;/span&gt;&lt;span class=&quot;token builtin&quot;&gt;int&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;&lt;span class=&quot;token string&quot;&gt;&quot;A&quot;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;token number&quot;&gt;1&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;token string&quot;&gt;&quot;B&quot;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;token number&quot;&gt;2&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;
    d &lt;span class=&quot;token operator&quot;&gt;:=&lt;/span&gt; &lt;span class=&quot;token string&quot;&gt;&quot;one&quot;&lt;/span&gt;
    e &lt;span class=&quot;token operator&quot;&gt;:=&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;[&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;]&lt;/span&gt;&lt;span class=&quot;token builtin&quot;&gt;int&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;&lt;span class=&quot;token number&quot;&gt;5&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;token number&quot;&gt;0&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;token number&quot;&gt;4&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;token number&quot;&gt;1&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;

    fmt&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;Println&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;Len&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;a&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;token function&quot;&gt;Len&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;b&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;token function&quot;&gt;Len&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;c&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;token function&quot;&gt;Len&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;d&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;token function&quot;&gt;Len&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;e&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;
&lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;h2&gt;3. Test&lt;/h2&gt;
&lt;p&gt;Go는 기본 라이브러리로 제공되는 testing 패키지로 유닛 테스트를 할 수 있다.
&lt;code class=&quot;language-text&quot;&gt;go test&lt;/code&gt; 명령어를 실행하면 패키지 디렉터리에 있는 테스트 파일에서 테스트 함수를 찾아 테스트를 수행한다.&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;테스트 파일: 파일 이름이 _test.go로 끝나는 파일&lt;/li&gt;
&lt;li&gt;테스트 함수: 함수 이름이 Test로 시작하고 *testing.T를 매개변수로 받는 함수&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;테스트 함수의 성공/실패는 testing.T.Errorf()와 같은 테스트 실패 메서드를 호출하는 것으로 결정된다. 테스트 함수 내에서 testing.T.Errorf()와 같은 테스트 실패 메서드를 호출하면 해당 함수는 FAIL로 처리되고, 테스트 실패 메서드를 호출하지 않으면 SUCCESS로 처리된다. Errorf() 메서드 외에도 testing.T.Fail(), testing.T.Fatal()과 같은 메서드도 있다. 이러한 메서드를 통해 FAIL의 레벨을 제어할 수 있다.&lt;/p&gt;
&lt;p&gt;다음은 앞서 작성한 Len() 함수의 유닛 테스트 파일이다.&lt;/p&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;go&quot;&gt;&lt;pre class=&quot;language-go&quot;&gt;&lt;code class=&quot;language-go&quot;&gt;&lt;span class=&quot;token keyword&quot;&gt;package&lt;/span&gt; main

&lt;span class=&quot;token keyword&quot;&gt;import&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;
    &lt;span class=&quot;token string&quot;&gt;&quot;testing&quot;&lt;/span&gt;
&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;

&lt;span class=&quot;token keyword&quot;&gt;func&lt;/span&gt; &lt;span class=&quot;token function&quot;&gt;TestLenForMap&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;t &lt;span class=&quot;token operator&quot;&gt;*&lt;/span&gt;testing&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;T&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;
    v &lt;span class=&quot;token operator&quot;&gt;:=&lt;/span&gt; &lt;span class=&quot;token keyword&quot;&gt;map&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;[&lt;/span&gt;&lt;span class=&quot;token builtin&quot;&gt;string&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;]&lt;/span&gt;&lt;span class=&quot;token builtin&quot;&gt;int&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;&lt;span class=&quot;token string&quot;&gt;&quot;A&quot;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;token number&quot;&gt;1&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;token string&quot;&gt;&quot;B&quot;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;token number&quot;&gt;2&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;
    actual&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; expected &lt;span class=&quot;token operator&quot;&gt;:=&lt;/span&gt; &lt;span class=&quot;token function&quot;&gt;Len&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;v&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;token number&quot;&gt;2&lt;/span&gt;
    &lt;span class=&quot;token keyword&quot;&gt;if&lt;/span&gt; actual &lt;span class=&quot;token operator&quot;&gt;!=&lt;/span&gt; expected &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;
        t&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;Errorf&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token string&quot;&gt;&quot;%d != %d&quot;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; actual&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; expected&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;
    &lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;
&lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;

&lt;span class=&quot;token keyword&quot;&gt;func&lt;/span&gt; &lt;span class=&quot;token function&quot;&gt;TestLenForString&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;t &lt;span class=&quot;token operator&quot;&gt;*&lt;/span&gt;testing&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;T&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;
    v &lt;span class=&quot;token operator&quot;&gt;:=&lt;/span&gt; &lt;span class=&quot;token string&quot;&gt;&quot;one&quot;&lt;/span&gt;
    actual&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; expected &lt;span class=&quot;token operator&quot;&gt;:=&lt;/span&gt; &lt;span class=&quot;token function&quot;&gt;Len&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;v&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;token number&quot;&gt;3&lt;/span&gt;
    &lt;span class=&quot;token keyword&quot;&gt;if&lt;/span&gt; actual &lt;span class=&quot;token operator&quot;&gt;!=&lt;/span&gt; expected &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;
        t&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;Errorf&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token string&quot;&gt;&quot;%d != %d&quot;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; actual&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; expected&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;
    &lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;
&lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;

&lt;span class=&quot;token keyword&quot;&gt;func&lt;/span&gt; &lt;span class=&quot;token function&quot;&gt;TestLenForSlice&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;t &lt;span class=&quot;token operator&quot;&gt;*&lt;/span&gt;testing&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;T&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;
    v &lt;span class=&quot;token operator&quot;&gt;:=&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;[&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;]&lt;/span&gt;&lt;span class=&quot;token builtin&quot;&gt;int&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;&lt;span class=&quot;token number&quot;&gt;5&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;token number&quot;&gt;0&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;token number&quot;&gt;4&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;token number&quot;&gt;1&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;
    actual&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; expected &lt;span class=&quot;token operator&quot;&gt;:=&lt;/span&gt; &lt;span class=&quot;token function&quot;&gt;Len&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;v&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;token number&quot;&gt;4&lt;/span&gt;
    &lt;span class=&quot;token keyword&quot;&gt;if&lt;/span&gt; actual &lt;span class=&quot;token operator&quot;&gt;!=&lt;/span&gt; expected &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;
        t&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;Errorf&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token string&quot;&gt;&quot;%d != %d&quot;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; actual&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; expected&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;
    &lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;
&lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;

&lt;span class=&quot;token keyword&quot;&gt;func&lt;/span&gt; &lt;span class=&quot;token function&quot;&gt;TestLenForChan&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;t &lt;span class=&quot;token operator&quot;&gt;*&lt;/span&gt;testing&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;T&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;
    v &lt;span class=&quot;token operator&quot;&gt;:=&lt;/span&gt; &lt;span class=&quot;token function&quot;&gt;make&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token keyword&quot;&gt;chan&lt;/span&gt; &lt;span class=&quot;token builtin&quot;&gt;int&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;
    actual&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; expected &lt;span class=&quot;token operator&quot;&gt;:=&lt;/span&gt; &lt;span class=&quot;token function&quot;&gt;Len&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;v&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;token number&quot;&gt;1&lt;/span&gt;
    &lt;span class=&quot;token keyword&quot;&gt;if&lt;/span&gt; actual &lt;span class=&quot;token operator&quot;&gt;!=&lt;/span&gt; expected &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;
        t&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;Errorf&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token string&quot;&gt;&quot;%d != %d&quot;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; actual&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; expected&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;
    &lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;
&lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;go test로 돌려보면 위 세개는 PASS, 마지막 하나가 FAIL하여 전체 테스트 결과가 FAIL로 발생하는 것을 확인할 수 있다.&lt;/p&gt;
&lt;p&gt;testing 패키지는 벤치마크 테스트 기능도 제공한다. _test.go 파일에 이름은 Benchmark로 시작하고 *testing.B를 매개변수로 받는 함수가 있으면 Go는 이 함수를 벤치마크 함수로 인식한다.&lt;/p&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;go&quot;&gt;&lt;pre class=&quot;language-go&quot;&gt;&lt;code class=&quot;language-go&quot;&gt;&lt;span class=&quot;token keyword&quot;&gt;func&lt;/span&gt; &lt;span class=&quot;token function&quot;&gt;BenchmarkLenForString&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;b &lt;span class=&quot;token operator&quot;&gt;*&lt;/span&gt;testing&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;B&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;
    b&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;StopTimer&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;
    v &lt;span class=&quot;token operator&quot;&gt;:=&lt;/span&gt; &lt;span class=&quot;token function&quot;&gt;make&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;[&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;]&lt;/span&gt;&lt;span class=&quot;token builtin&quot;&gt;string&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;token number&quot;&gt;1000000&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;
    &lt;span class=&quot;token keyword&quot;&gt;for&lt;/span&gt; i &lt;span class=&quot;token operator&quot;&gt;:=&lt;/span&gt; &lt;span class=&quot;token number&quot;&gt;0&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt; i &lt;span class=&quot;token operator&quot;&gt;&amp;lt;&lt;/span&gt; &lt;span class=&quot;token number&quot;&gt;1000000&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt; i&lt;span class=&quot;token operator&quot;&gt;++&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;
        v&lt;span class=&quot;token punctuation&quot;&gt;[&lt;/span&gt;i&lt;span class=&quot;token punctuation&quot;&gt;]&lt;/span&gt; &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; strconv&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;Itoa&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;i&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;
    &lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;
    b&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;StartTimer&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;
    &lt;span class=&quot;token keyword&quot;&gt;for&lt;/span&gt; i &lt;span class=&quot;token operator&quot;&gt;:=&lt;/span&gt; &lt;span class=&quot;token number&quot;&gt;0&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt; i &lt;span class=&quot;token operator&quot;&gt;&amp;lt;&lt;/span&gt; b&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;N&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt; i&lt;span class=&quot;token operator&quot;&gt;++&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;
        &lt;span class=&quot;token function&quot;&gt;Len&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;v&lt;span class=&quot;token punctuation&quot;&gt;[&lt;/span&gt;i&lt;span class=&quot;token operator&quot;&gt;%&lt;/span&gt;&lt;span class=&quot;token number&quot;&gt;1000000&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;]&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;
    &lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;
&lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;이 함수는 시작 부분에서 타이머를 멈추게 했다(b.StopTimer()). 벤치마크 테스트를 위한 테스트 데이터를 생성하는 시간은 측정되지 않게 하기 위해서다. 테스트 데이터 생성이 끝난 후에는 다시 타이머를 시작하게 했다(b.StartTimer()).&lt;/p&gt;
&lt;p&gt;벤치마크 테스트를 수행하려면 go test 명령어를 수행할 때 -bench 옵션과 벤치마크를 수행하려는 함수 이름에 대한 정규표현식을 함께 전달해야 한다.&lt;/p&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;shell&quot;&gt;&lt;pre class=&quot;language-shell&quot;&gt;&lt;code class=&quot;language-shell&quot;&gt;go &lt;span class=&quot;token builtin class-name&quot;&gt;test&lt;/span&gt; &lt;span class=&quot;token parameter variable&quot;&gt;-test.bench&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt;.&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;</content:encoded></item><item><title><![CDATA[[Go 언어 문법 정리] 05. 에러 처리]]></title><description><![CDATA[1. 런타임 에러와 패닉 실행 중에 에러가 발생하면 Go 런타임은 패닉을 발생시킨다. 패닉이 발생하면 패닉 에러 메시지가 출력되고 프로그램이 종료된다.
에러 상황이 심각해서 프로그램을 더 이상 실행할 수 없을 때는 panic…]]></description><link>https://github.com/SiverPineValley/SiverPineValley.github.io/golang/error/</link><guid isPermaLink="false">https://github.com/SiverPineValley/SiverPineValley.github.io/golang/error/</guid><pubDate>Sun, 29 May 2022 17:03:25 GMT</pubDate><content:encoded>&lt;h2&gt;1. 런타임 에러와 패닉&lt;/h2&gt;
&lt;p&gt;실행 중에 에러가 발생하면 Go 런타임은 패닉을 발생시킨다. 패닉이 발생하면 패닉 에러 메시지가 출력되고 프로그램이 종료된다.
에러 상황이 심각해서 프로그램을 더 이상 실행할 수 없을 때는 panic() 함수를 사용해 강제로 패닉을 발생시키고 프로그램을 종료할 수 있다.&lt;/p&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;go&quot;&gt;&lt;pre class=&quot;language-go&quot;&gt;&lt;code class=&quot;language-go&quot;&gt;&lt;span class=&quot;token keyword&quot;&gt;package&lt;/span&gt; main

&lt;span class=&quot;token keyword&quot;&gt;import&lt;/span&gt; &lt;span class=&quot;token string&quot;&gt;&quot;fmt&quot;&lt;/span&gt;

&lt;span class=&quot;token keyword&quot;&gt;func&lt;/span&gt; &lt;span class=&quot;token function&quot;&gt;main&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;
    fmt&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;Println&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;devide&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token number&quot;&gt;1&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt;&lt;span class=&quot;token number&quot;&gt;0&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;
&lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;

&lt;span class=&quot;token keyword&quot;&gt;func&lt;/span&gt; &lt;span class=&quot;token function&quot;&gt;divide&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;a&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; b &lt;span class=&quot;token builtin&quot;&gt;int&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;token builtin&quot;&gt;int&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;
    &lt;span class=&quot;token keyword&quot;&gt;return&lt;/span&gt; a &lt;span class=&quot;token operator&quot;&gt;/&lt;/span&gt; b
&lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;함수 안에서 panic()이 호출되면 현재 함수의 실행을 즉시 종료하고 모든 defer 구문을 실행한 후 자신을 호출한 함수로 패닉에 대한 제어권을 넘긴다. 이러한 작업은 함수 호출 스택의 상위 레벨로 올라가며 계속 이어지고, 프로그램 스택의 최상단(main 함수)에서 프로그램을 종료하고 에러 상황을 출력한다. 이러한 작업을 &lt;code class=&quot;language-text&quot;&gt;패니킹(panicking)&lt;/code&gt; 이라 한다.&lt;/p&gt;
&lt;h2&gt;2. recover&lt;/h2&gt;
&lt;p&gt;recover() 함수는 패니킹 작업으로부터 프로그램의 제어권을 다시 얻어 종료 절차를 중지시키고 프로그램을 계속 이어갈 수 있게 한다.&lt;/p&gt;
&lt;p&gt;recover()는 반드시 defer 안에서 사용해야 한다. recover()를 호출하면 패닉 내부의 상황을 error 값으로 복원할 수 있다. recover()로 패닉을 복원한 후에는 패니킹 상황이 종료되고 함수 반환 타입의 제로 값이 반환된다. 이는 자바나 .Net의 try-catch 블록과 유사하다.&lt;/p&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;go&quot;&gt;&lt;pre class=&quot;language-go&quot;&gt;&lt;code class=&quot;language-go&quot;&gt;&lt;span class=&quot;token keyword&quot;&gt;func&lt;/span&gt; &lt;span class=&quot;token function&quot;&gt;main&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;
    fmt&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;Println&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token string&quot;&gt;&quot;result: &quot;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;token function&quot;&gt;divide&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token number&quot;&gt;1&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt;&lt;span class=&quot;token number&quot;&gt;0&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;
&lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;

&lt;span class=&quot;token keyword&quot;&gt;func&lt;/span&gt; &lt;span class=&quot;token function&quot;&gt;divide&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;a&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; b &lt;span class=&quot;token builtin&quot;&gt;int&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;
    &lt;span class=&quot;token keyword&quot;&gt;defer&lt;/span&gt; &lt;span class=&quot;token keyword&quot;&gt;func&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;
        &lt;span class=&quot;token keyword&quot;&gt;if&lt;/span&gt; err &lt;span class=&quot;token operator&quot;&gt;:=&lt;/span&gt; &lt;span class=&quot;token function&quot;&gt;recover&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt; err &lt;span class=&quot;token operator&quot;&gt;!=&lt;/span&gt; &lt;span class=&quot;token boolean&quot;&gt;nil&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;
            fmt&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;Println&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;err&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;
        &lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;
    &lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;
    &lt;span class=&quot;token keyword&quot;&gt;return&lt;/span&gt; a &lt;span class=&quot;token operator&quot;&gt;/&lt;/span&gt; b
&lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;다음 protect() 함수는 코드 블록을 클로저로 만들어 넘기면 예상치 못한 패닉에 의해 프로그램이 비정상적으로 종료되는 것을 막을 수 있다.&lt;/p&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;go&quot;&gt;&lt;pre class=&quot;language-go&quot;&gt;&lt;code class=&quot;language-go&quot;&gt;&lt;span class=&quot;token keyword&quot;&gt;package&lt;/span&gt; main

&lt;span class=&quot;token keyword&quot;&gt;import&lt;/span&gt; &lt;span class=&quot;token string&quot;&gt;&quot;fmt&quot;&lt;/span&gt;

&lt;span class=&quot;token keyword&quot;&gt;func&lt;/span&gt; &lt;span class=&quot;token function&quot;&gt;protect&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;g &lt;span class=&quot;token keyword&quot;&gt;func&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;
    &lt;span class=&quot;token keyword&quot;&gt;defer&lt;/span&gt; &lt;span class=&quot;token keyword&quot;&gt;func&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;
        log&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;Println&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token string&quot;&gt;&quot;done&quot;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;

        &lt;span class=&quot;token keyword&quot;&gt;if&lt;/span&gt; err &lt;span class=&quot;token operator&quot;&gt;:=&lt;/span&gt; &lt;span class=&quot;token builtin&quot;&gt;recover&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt; err &lt;span class=&quot;token operator&quot;&gt;!=&lt;/span&gt; &lt;span class=&quot;token boolean&quot;&gt;nil&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;
            log&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;Printf&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token string&quot;&gt;&quot;run time panic: %v&quot;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; err&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;
        &lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;
    &lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;

    log&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;Println&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token string&quot;&gt;&quot;start&quot;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;
    &lt;span class=&quot;token function&quot;&gt;g&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;
&lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;

&lt;span class=&quot;token keyword&quot;&gt;func&lt;/span&gt; &lt;span class=&quot;token function&quot;&gt;main&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;
    &lt;span class=&quot;token function&quot;&gt;protect&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token keyword&quot;&gt;func&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;
        fmt&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;Println&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;divide&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token number&quot;&gt;4&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt;&lt;span class=&quot;token number&quot;&gt;0&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;
    &lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;
&lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;

&lt;span class=&quot;token keyword&quot;&gt;func&lt;/span&gt; &lt;span class=&quot;token function&quot;&gt;divide&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;a&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; b &lt;span class=&quot;token builtin&quot;&gt;int&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;token builtin&quot;&gt;int&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;
    &lt;span class=&quot;token keyword&quot;&gt;return&lt;/span&gt; a &lt;span class=&quot;token operator&quot;&gt;/&lt;/span&gt; b
&lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;h2&gt;3. 클로저로 에러 처리&lt;/h2&gt;
&lt;p&gt;함수가 항상 defer-panic-recover 블록 안에서 실행되도록 클로저를 만들어 반환하는 에러 핸들러 함수를 만들어 보자.&lt;/p&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;go&quot;&gt;&lt;pre class=&quot;language-go&quot;&gt;&lt;code class=&quot;language-go&quot;&gt;&lt;span class=&quot;token keyword&quot;&gt;type&lt;/span&gt; fType &lt;span class=&quot;token keyword&quot;&gt;func&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token builtin&quot;&gt;int&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;token builtin&quot;&gt;int&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;token builtin&quot;&gt;int&lt;/span&gt;

&lt;span class=&quot;token keyword&quot;&gt;func&lt;/span&gt; &lt;span class=&quot;token function&quot;&gt;errorHandler&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;fn fType&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt; fType &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;
    &lt;span class=&quot;token keyword&quot;&gt;return&lt;/span&gt; &lt;span class=&quot;token keyword&quot;&gt;func&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;a &lt;span class=&quot;token builtin&quot;&gt;int&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; b &lt;span class=&quot;token builtin&quot;&gt;int&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;token builtin&quot;&gt;int&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;
        &lt;span class=&quot;token keyword&quot;&gt;defer&lt;/span&gt; &lt;span class=&quot;token keyword&quot;&gt;func&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;
            &lt;span class=&quot;token keyword&quot;&gt;if&lt;/span&gt; err&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; ok &lt;span class=&quot;token operator&quot;&gt;:=&lt;/span&gt; &lt;span class=&quot;token function&quot;&gt;recover&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token builtin&quot;&gt;error&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt; ok &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;
                log&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;Printf&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token string&quot;&gt;&quot;run time panic: %v&quot;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; err&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;
            &lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;
        &lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;
        &lt;span class=&quot;token keyword&quot;&gt;return&lt;/span&gt; &lt;span class=&quot;token function&quot;&gt;fn&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;a&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; b&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;
    &lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;
&lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;

&lt;span class=&quot;token keyword&quot;&gt;func&lt;/span&gt; &lt;span class=&quot;token function&quot;&gt;main&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;
    fmt&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;Println&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;errorHandler&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;divide&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token number&quot;&gt;4&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt;&lt;span class=&quot;token number&quot;&gt;2&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;
    fmt&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;Println&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;errorHandler&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;divide&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token number&quot;&gt;3&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt;&lt;span class=&quot;token number&quot;&gt;0&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;
&lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;

&lt;span class=&quot;token keyword&quot;&gt;func&lt;/span&gt; &lt;span class=&quot;token function&quot;&gt;divide&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;a &lt;span class=&quot;token builtin&quot;&gt;int&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; b &lt;span class=&quot;token builtin&quot;&gt;int&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;token builtin&quot;&gt;int&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;
    &lt;span class=&quot;token keyword&quot;&gt;return&lt;/span&gt; a &lt;span class=&quot;token operator&quot;&gt;/&lt;/span&gt; b
&lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;이 처럼 특정 함수 서명에 에러 핸들러 함수를 만들어 놓으면, 서명이 같은 함수는 모두 defer-panic-recover 블록 안에서 실행시킬 수 있다.
에러 핸들러 방식의 단점은 같은 함수 서명에서만 에러 핸들러를 적용할 수 있다는 점이다. 하지만 에러 핸들러에서 처리하는 함수의 매개변수와 반환 타입을 빈 인터페이스 슬라이스(...interface{})로 정의하면 모든 형태의 함수를 처리할 수 있다.&lt;/p&gt;</content:encoded></item><item><title><![CDATA[[Go 언어 문법 정리] 04. 병행 처리 (3) 병행 처리 활용]]></title><description><![CDATA[…]]></description><link>https://github.com/SiverPineValley/SiverPineValley.github.io/golang/concurrency_3/</link><guid isPermaLink="false">https://github.com/SiverPineValley/SiverPineValley.github.io/golang/concurrency_3/</guid><pubDate>Sat, 16 Apr 2022 21:55:23 GMT</pubDate><content:encoded>&lt;p&gt;앞서 배운 병행 처리 코드를 다양하게 활용하여 네 가지 패턴을 만들어보았다.&lt;/p&gt;
&lt;table&gt;
&lt;thead&gt;
&lt;tr&gt;
&lt;th&gt;활용&lt;/th&gt;
&lt;th&gt;내용&lt;/th&gt;
&lt;/tr&gt;
&lt;/thead&gt;
&lt;tbody&gt;
&lt;tr&gt;
&lt;td&gt;타임아웃&lt;/td&gt;
&lt;td&gt;시간이 오래 걸리는 작업에 타임아웃 처리하기&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;공유 메모리&lt;/td&gt;
&lt;td&gt;채널을 사용하여 여러 고루틴의 공유 메모리 접근 제어하기&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;파이프라인&lt;/td&gt;
&lt;td&gt;여러 고루틴을 파이프라인 형태로 연결하기&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;맵 리듀스&lt;/td&gt;
&lt;td&gt;고루틴을 사용하여 맵리듀스 패턴 구현하기&lt;/td&gt;
&lt;/tr&gt;
&lt;/tbody&gt;
&lt;/table&gt;
&lt;h1&gt;1. 타임아웃&lt;/h1&gt;
&lt;p&gt;시간이 오래 걸리는 작업에 select문을 사용하면 타임아웃 기능을 쉽게 구현할 수 있다.
아래 소스 코드는 채널을 사용하여 타임아웃 패턴을 구현하였다.
process 함수 내에서 타임아웃이 되기 전에 작업이 끝나면 done 채널에 메시지가 먼저 전달되어 select 문에서 done 케이스가 먼저 실행된다.
반대로, 타임아웃이 되면 process 함수 내로 quit 채널에 값이 전달되어 함수가 그대로 종료된다.&lt;/p&gt;
&lt;p&gt;이렇게 구현된 이유는 먼저, process 내에서 quit 채널에 대한 처리를 하지 않는다면 타임아웃되더라도 done 채널은 그대로 동작한다.
물론, 엄마 함수가 메모리에서 제거되었기 때문에 done 채널에 값은 전달되어도 그냥 무시된다.&lt;/p&gt;
&lt;p&gt;만약, 타임아웃 되었을 때 done 채널을 닫으면(close) done 채널이 전달될 때 런타임 에러(panic: send on closed channel)이 발생한다.
타임아웃으로 done 채널을 닫을 때는 process() 함수에서 done 채널은 외부에서 닫힐 수 있다는 것을 고려해야 한다.&lt;/p&gt;
&lt;p&gt;예제처럼 process()함수에 quit 채널을 전달해주면, 에러 처리를 별도로 하지 않더라도 정상 동작이 가능하다.&lt;/p&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;go&quot;&gt;&lt;pre class=&quot;language-go&quot;&gt;&lt;code class=&quot;language-go&quot;&gt;&lt;span class=&quot;token keyword&quot;&gt;import&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;
    &lt;span class=&quot;token string&quot;&gt;&quot;fmt&quot;&lt;/span&gt;
    &lt;span class=&quot;token string&quot;&gt;&quot;time&quot;&lt;/span&gt;
&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;

&lt;span class=&quot;token keyword&quot;&gt;func&lt;/span&gt; &lt;span class=&quot;token function&quot;&gt;main&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;
    quit &lt;span class=&quot;token operator&quot;&gt;:=&lt;/span&gt; &lt;span class=&quot;token function&quot;&gt;make&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token keyword&quot;&gt;chan&lt;/span&gt; &lt;span class=&quot;token keyword&quot;&gt;struct&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;
    done &lt;span class=&quot;token operator&quot;&gt;:=&lt;/span&gt; &lt;span class=&quot;token function&quot;&gt;process&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;quit&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;
    timeout &lt;span class=&quot;token operator&quot;&gt;:=&lt;/span&gt; time&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;After&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token number&quot;&gt;1&lt;/span&gt; &lt;span class=&quot;token operator&quot;&gt;*&lt;/span&gt; time&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;Second&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;

    &lt;span class=&quot;token keyword&quot;&gt;select&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;
        &lt;span class=&quot;token keyword&quot;&gt;case&lt;/span&gt; d &lt;span class=&quot;token operator&quot;&gt;:=&lt;/span&gt; &lt;span class=&quot;token operator&quot;&gt;&amp;lt;-&lt;/span&gt;done&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt;
        fmt&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;Println&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;d&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;
        &lt;span class=&quot;token keyword&quot;&gt;case&lt;/span&gt; &lt;span class=&quot;token operator&quot;&gt;&amp;lt;-&lt;/span&gt;timeout&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt;
        quit &lt;span class=&quot;token operator&quot;&gt;&amp;lt;-&lt;/span&gt; &lt;span class=&quot;token keyword&quot;&gt;struct&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;
        fmt&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;Println&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token string&quot;&gt;&quot;Time out!!&quot;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;
    &lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;
&lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;

&lt;span class=&quot;token keyword&quot;&gt;func&lt;/span&gt; &lt;span class=&quot;token function&quot;&gt;process&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;quit &lt;span class=&quot;token operator&quot;&gt;&amp;lt;-&lt;/span&gt; &lt;span class=&quot;token keyword&quot;&gt;chan&lt;/span&gt; &lt;span class=&quot;token keyword&quot;&gt;struct&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;token keyword&quot;&gt;chan&lt;/span&gt; &lt;span class=&quot;token builtin&quot;&gt;string&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;
    done &lt;span class=&quot;token operator&quot;&gt;:=&lt;/span&gt; &lt;span class=&quot;token function&quot;&gt;make&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token keyword&quot;&gt;chan&lt;/span&gt; &lt;span class=&quot;token builtin&quot;&gt;string&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;
    &lt;span class=&quot;token keyword&quot;&gt;go&lt;/span&gt; &lt;span class=&quot;token keyword&quot;&gt;func&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;
        &lt;span class=&quot;token keyword&quot;&gt;go&lt;/span&gt; &lt;span class=&quot;token keyword&quot;&gt;func&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;
            time&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;Sleep&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token number&quot;&gt;10&lt;/span&gt; &lt;span class=&quot;token operator&quot;&gt;*&lt;/span&gt; time&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;Second&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;token comment&quot;&gt;// heavy job&lt;/span&gt;

            done &lt;span class=&quot;token operator&quot;&gt;&amp;lt;-&lt;/span&gt; &lt;span class=&quot;token string&quot;&gt;&quot;Complete !!&quot;&lt;/span&gt;
        &lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;
        &lt;span class=&quot;token operator&quot;&gt;&amp;lt;-&lt;/span&gt; quit
        &lt;span class=&quot;token keyword&quot;&gt;return&lt;/span&gt;
    &lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;

    &lt;span class=&quot;token keyword&quot;&gt;return&lt;/span&gt; done
&lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;h1&gt;2. 공유 메모리&lt;/h1&gt;
&lt;p&gt;여러 스레드에서 공유 메모리를 사용할 때는 보통 스레드 하나에서 공유 메모리에 접근하는 것을 보장하기 위해 Critical Section의 코드를 실행 하기 전에 Mutex를 잠그고, 처리를 완료한 후에 해제한다. 이전에 배운바와 같이 Go에서도 sync 패키지를 사용하여 Mutex를 사용할 수 있다.&lt;/p&gt;
&lt;p&gt;하지만, Go는 메모리를 공유하는 방식이 아니라 채널을 통해 메시지를 전달하는 방식으로 여러 고루틴간의 동기화를 권장한다.
본 장에서는 공유 메모리를 구현하기 위해 아래와 같은 구조체를 정의하였다.&lt;/p&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;go&quot;&gt;&lt;pre class=&quot;language-go&quot;&gt;&lt;code class=&quot;language-go&quot;&gt;&lt;span class=&quot;token keyword&quot;&gt;const&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;
    set &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;token boolean&quot;&gt;iota&lt;/span&gt;
    get
    remove
    count
&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;

&lt;span class=&quot;token keyword&quot;&gt;type&lt;/span&gt; SharedMap &lt;span class=&quot;token keyword&quot;&gt;struct&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;
    m &lt;span class=&quot;token keyword&quot;&gt;map&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;[&lt;/span&gt;&lt;span class=&quot;token builtin&quot;&gt;string&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;]&lt;/span&gt;&lt;span class=&quot;token keyword&quot;&gt;interface&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;
    c &lt;span class=&quot;token keyword&quot;&gt;chan&lt;/span&gt; commond
&lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;

&lt;span class=&quot;token keyword&quot;&gt;type&lt;/span&gt; command &lt;span class=&quot;token keyword&quot;&gt;struct&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;
    key &lt;span class=&quot;token builtin&quot;&gt;string&lt;/span&gt;
    value &lt;span class=&quot;token keyword&quot;&gt;interface&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;
    action &lt;span class=&quot;token builtin&quot;&gt;int&lt;/span&gt;
    result &lt;span class=&quot;token keyword&quot;&gt;chan&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;&amp;lt;-&lt;/span&gt; &lt;span class=&quot;token keyword&quot;&gt;interface&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;
&lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;SharedMap 내부에서는 실제 맵 정보를 가리키는 &lt;code class=&quot;language-text&quot;&gt;m m[string]interface{}{}&lt;/code&gt; 필드와 채널을 통해 SharedMap에 명령을 전달할 &lt;code class=&quot;language-text&quot;&gt;c chan command&lt;/code&gt; 필드가 있다.
key와 value, 수행할 액션을 나타내는 action을 command 구조체에 담아 채널로 전달하고, 처리 결과는 command 구조체의 result 채널로 확인한다.
result는 결과를 전송달하기 위한 용도로만 사용되므로, 송신 전용 채널 (chan&amp;#x3C;-)으로 정의했다.&lt;/p&gt;
&lt;p&gt;command의 action으로 사용할 값은 코드 상부의 상수로 정의한다.
위 사전 정의된 내용을 사용하여 아래와 같이 공유 메모리 예제를 구현할 수 있다.&lt;/p&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;go&quot;&gt;&lt;pre class=&quot;language-go&quot;&gt;&lt;code class=&quot;language-go&quot;&gt;&lt;span class=&quot;token keyword&quot;&gt;import&lt;/span&gt; &lt;span class=&quot;token string&quot;&gt;&quot;fmt&quot;&lt;/span&gt;

&lt;span class=&quot;token keyword&quot;&gt;func&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;sm SharedMap&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;token function&quot;&gt;Set&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;k &lt;span class=&quot;token builtin&quot;&gt;string&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; v &lt;span class=&quot;token keyword&quot;&gt;interface&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;r &lt;span class=&quot;token builtin&quot;&gt;bool&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;
    callback &lt;span class=&quot;token operator&quot;&gt;:=&lt;/span&gt; &lt;span class=&quot;token function&quot;&gt;make&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token keyword&quot;&gt;chan&lt;/span&gt; &lt;span class=&quot;token keyword&quot;&gt;interface&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;
    sm&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;c &lt;span class=&quot;token operator&quot;&gt;&amp;lt;-&lt;/span&gt; command&lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;action&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt; set&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; key&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt; k&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; value&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt; v&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; result&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt; callback&lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;
    r &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;&amp;lt;-&lt;/span&gt;callback&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token builtin&quot;&gt;bool&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;
    &lt;span class=&quot;token keyword&quot;&gt;return&lt;/span&gt;
&lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;

&lt;span class=&quot;token keyword&quot;&gt;func&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;sm SharedMap&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;token function&quot;&gt;Get&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;k &lt;span class=&quot;token builtin&quot;&gt;string&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;v &lt;span class=&quot;token keyword&quot;&gt;interface&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; r &lt;span class=&quot;token builtin&quot;&gt;bool&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;
    callback &lt;span class=&quot;token operator&quot;&gt;:=&lt;/span&gt; &lt;span class=&quot;token function&quot;&gt;make&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token keyword&quot;&gt;chan&lt;/span&gt; &lt;span class=&quot;token keyword&quot;&gt;interface&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;
    sm&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;c &lt;span class=&quot;token operator&quot;&gt;&amp;lt;-&lt;/span&gt; command&lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;action&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt; get&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; key&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt; k&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; result&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt; callback&lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;
    result &lt;span class=&quot;token operator&quot;&gt;:=&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;&amp;lt;-&lt;/span&gt;callback&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;[&lt;/span&gt;&lt;span class=&quot;token number&quot;&gt;2&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;]&lt;/span&gt;&lt;span class=&quot;token keyword&quot;&gt;interface&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;
    v &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; result&lt;span class=&quot;token punctuation&quot;&gt;[&lt;/span&gt;&lt;span class=&quot;token number&quot;&gt;0&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;]&lt;/span&gt;
    r &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; result&lt;span class=&quot;token punctuation&quot;&gt;[&lt;/span&gt;&lt;span class=&quot;token number&quot;&gt;1&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;]&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token builtin&quot;&gt;bool&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;
    &lt;span class=&quot;token keyword&quot;&gt;return&lt;/span&gt;
&lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;

&lt;span class=&quot;token keyword&quot;&gt;func&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;sm SharedMap&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;token function&quot;&gt;Remove&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;k &lt;span class=&quot;token builtin&quot;&gt;string&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;r &lt;span class=&quot;token builtin&quot;&gt;bool&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;
    callback &lt;span class=&quot;token operator&quot;&gt;:=&lt;/span&gt; &lt;span class=&quot;token function&quot;&gt;make&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token keyword&quot;&gt;chan&lt;/span&gt; &lt;span class=&quot;token keyword&quot;&gt;interface&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;
    sm&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;c &lt;span class=&quot;token operator&quot;&gt;&amp;lt;-&lt;/span&gt; command&lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;action&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt; remove&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; key&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt; k&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; result&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt; callback&lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;
    r &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;&amp;lt;-&lt;/span&gt;callback&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token builtin&quot;&gt;bool&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;
    &lt;span class=&quot;token keyword&quot;&gt;return&lt;/span&gt;
&lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;

&lt;span class=&quot;token keyword&quot;&gt;func&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;sm SharedMap&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;token function&quot;&gt;Count&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;r &lt;span class=&quot;token builtin&quot;&gt;int&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;
    callback &lt;span class=&quot;token operator&quot;&gt;:=&lt;/span&gt; &lt;span class=&quot;token function&quot;&gt;make&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token keyword&quot;&gt;chan&lt;/span&gt; &lt;span class=&quot;token keyword&quot;&gt;interface&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;
    sm&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;c &lt;span class=&quot;token operator&quot;&gt;&amp;lt;-&lt;/span&gt; command&lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;action&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt; count&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; result&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt; callback&lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;
    r &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;&amp;lt;-&lt;/span&gt;callback&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token builtin&quot;&gt;int&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;
    &lt;span class=&quot;token keyword&quot;&gt;return&lt;/span&gt;
&lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;

&lt;span class=&quot;token keyword&quot;&gt;func&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;sm SharedMap&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;token function&quot;&gt;run&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;
    &lt;span class=&quot;token keyword&quot;&gt;for&lt;/span&gt; cmd &lt;span class=&quot;token operator&quot;&gt;:=&lt;/span&gt; &lt;span class=&quot;token keyword&quot;&gt;range&lt;/span&gt; sm&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;c &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;
  &lt;span class=&quot;token keyword&quot;&gt;switch&lt;/span&gt; cmd&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;action &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;
            &lt;span class=&quot;token keyword&quot;&gt;case&lt;/span&gt; set&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt;
                sm&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;m&lt;span class=&quot;token punctuation&quot;&gt;[&lt;/span&gt;cmd&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;key&lt;span class=&quot;token punctuation&quot;&gt;]&lt;/span&gt; &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; cmd&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;value
                &lt;span class=&quot;token boolean&quot;&gt;_&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; ok &lt;span class=&quot;token operator&quot;&gt;:=&lt;/span&gt; sm&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;m&lt;span class=&quot;token punctuation&quot;&gt;[&lt;/span&gt;cmd&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;key&lt;span class=&quot;token punctuation&quot;&gt;]&lt;/span&gt;
                cmd&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;result &lt;span class=&quot;token operator&quot;&gt;&amp;lt;-&lt;/span&gt; ok
            &lt;span class=&quot;token keyword&quot;&gt;case&lt;/span&gt; get&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt;
                v&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; ok &lt;span class=&quot;token operator&quot;&gt;:=&lt;/span&gt; sm&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;m&lt;span class=&quot;token punctuation&quot;&gt;[&lt;/span&gt;cmd&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;key&lt;span class=&quot;token punctuation&quot;&gt;]&lt;/span&gt;
                cmd&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;result &lt;span class=&quot;token operator&quot;&gt;&amp;lt;-&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;[&lt;/span&gt;&lt;span class=&quot;token number&quot;&gt;2&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;]&lt;/span&gt;&lt;span class=&quot;token keyword&quot;&gt;interface&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;v&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; ok&lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;
            &lt;span class=&quot;token keyword&quot;&gt;case&lt;/span&gt; remove&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt;
                &lt;span class=&quot;token boolean&quot;&gt;_&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; ok &lt;span class=&quot;token operator&quot;&gt;:=&lt;/span&gt; sm&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;m&lt;span class=&quot;token punctuation&quot;&gt;[&lt;/span&gt;cmd&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;key&lt;span class=&quot;token punctuation&quot;&gt;]&lt;/span&gt;
                &lt;span class=&quot;token keyword&quot;&gt;if&lt;/span&gt; &lt;span class=&quot;token operator&quot;&gt;!&lt;/span&gt;ok &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;
                    cmd&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;result &lt;span class=&quot;token operator&quot;&gt;&amp;lt;-&lt;/span&gt; &lt;span class=&quot;token boolean&quot;&gt;false&lt;/span&gt;
                &lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt; &lt;span class=&quot;token keyword&quot;&gt;else&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;
                    &lt;span class=&quot;token function&quot;&gt;delete&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;sm&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;m&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; cmd&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;key&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;
                    &lt;span class=&quot;token boolean&quot;&gt;_&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; ok &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; sm&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;m&lt;span class=&quot;token punctuation&quot;&gt;[&lt;/span&gt;cmd&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;key&lt;span class=&quot;token punctuation&quot;&gt;]&lt;/span&gt;
                    cmd&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;result &lt;span class=&quot;token operator&quot;&gt;&amp;lt;-&lt;/span&gt; &lt;span class=&quot;token operator&quot;&gt;!&lt;/span&gt;ok
                &lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;
            &lt;span class=&quot;token keyword&quot;&gt;case&lt;/span&gt; count&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt;
                cmd&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;result &lt;span class=&quot;token operator&quot;&gt;&amp;lt;-&lt;/span&gt; &lt;span class=&quot;token function&quot;&gt;len&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;sm&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;m&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;
  &lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;
    &lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;
&lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;

&lt;span class=&quot;token keyword&quot;&gt;func&lt;/span&gt; &lt;span class=&quot;token function&quot;&gt;NewMap&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt; SharedMap &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;
    sm &lt;span class=&quot;token operator&quot;&gt;:=&lt;/span&gt; SharedMap&lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;
        m&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;token function&quot;&gt;make&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token keyword&quot;&gt;map&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;[&lt;/span&gt;&lt;span class=&quot;token builtin&quot;&gt;string&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;]&lt;/span&gt;&lt;span class=&quot;token keyword&quot;&gt;interface&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt;
        c&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;token function&quot;&gt;make&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token keyword&quot;&gt;chan&lt;/span&gt; command&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt;
    &lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;
    &lt;span class=&quot;token keyword&quot;&gt;go&lt;/span&gt; sm&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;run&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;
    &lt;span class=&quot;token keyword&quot;&gt;return&lt;/span&gt; sm
&lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;

&lt;span class=&quot;token keyword&quot;&gt;func&lt;/span&gt; &lt;span class=&quot;token function&quot;&gt;main&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;
    m &lt;span class=&quot;token operator&quot;&gt;:=&lt;/span&gt; &lt;span class=&quot;token function&quot;&gt;NewMap&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;

    &lt;span class=&quot;token comment&quot;&gt;// Set item&lt;/span&gt;
    ok &lt;span class=&quot;token operator&quot;&gt;:=&lt;/span&gt; m&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;Set&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token string&quot;&gt;&quot;foo&quot;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;token string&quot;&gt;&quot;bar&quot;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;
    fmt&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;Println&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;ok&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;

    &lt;span class=&quot;token comment&quot;&gt;// Get item&lt;/span&gt;
    t&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; ok &lt;span class=&quot;token operator&quot;&gt;:=&lt;/span&gt; m&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;Get&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token string&quot;&gt;&quot;foo&quot;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;

    &lt;span class=&quot;token comment&quot;&gt;// Check if item exists&lt;/span&gt;
    &lt;span class=&quot;token keyword&quot;&gt;if&lt;/span&gt; ok &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;
        bar &lt;span class=&quot;token operator&quot;&gt;:=&lt;/span&gt; t&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token builtin&quot;&gt;string&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;
        fmt&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;Println&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token string&quot;&gt;&quot;bar: &quot;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; bar&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;
    &lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;

    &lt;span class=&quot;token comment&quot;&gt;// Remove item&lt;/span&gt;
    ok &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; m&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;Remove&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token string&quot;&gt;&quot;foo&quot;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;
    fmt&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;Println&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;ok&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;

    &lt;span class=&quot;token comment&quot;&gt;// Count item&lt;/span&gt;
    fmt&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;Println&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token string&quot;&gt;&quot;Count: &quot;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; m&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;Count&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;

    &lt;span class=&quot;token keyword&quot;&gt;return&lt;/span&gt;
&lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;h1&gt;3. 파이프라인&lt;/h1&gt;
&lt;p&gt;유닉스에서는 셸 명령어를 파이프라인(|)으로 연결할 수 있다. 파이프를 통해 셸 명령어를 실행하면 파이프 이전 명령어의 output이 파이프 이후 명령어의 input으로 입력된다.&lt;/p&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;shell&quot;&gt;&lt;pre class=&quot;language-shell&quot;&gt;&lt;code class=&quot;language-shell&quot;&gt;&lt;span class=&quot;token function&quot;&gt;find&lt;/span&gt; src &lt;span class=&quot;token operator&quot;&gt;|&lt;/span&gt; &lt;span class=&quot;token function&quot;&gt;grep&lt;/span&gt; .go$ &lt;span class=&quot;token operator&quot;&gt;|&lt;/span&gt; &lt;span class=&quot;token function&quot;&gt;xargs&lt;/span&gt; &lt;span class=&quot;token function&quot;&gt;wc&lt;/span&gt; &lt;span class=&quot;token parameter variable&quot;&gt;-l&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;위 명령은 src 디렉터리의 파일 중 (find src), 파일 이름이 .go로 끝나는 파일을 필터링해서(grep .go$), 파일의 정보를 라인 수와 함께 출력한다. (xargs wc -l)
Go에서는 기본 라이브러리인 ip.Pipe()를 사용하면 유닉스 스타일로 파이프라인을 생성할 수 있다.
&lt;code class=&quot;language-text&quot;&gt;io.Pipe()&lt;/code&gt;를 호출하면 &lt;em&gt;PipeReader와&lt;/em&gt;PipeWriter가 반환되는데, 두 함수는 내부적으로 연결되어 있어서, &lt;em&gt;PipeReader의 결과가&lt;/em&gt;PipeWriter의 입력으로 바로 전달된다. 하지만 &lt;code class=&quot;language-text&quot;&gt;io.Pipe()&lt;/code&gt;는 두 함수간 연결으로만 동작하므로, 다양하게 활용하기에는 제약이 있다.&lt;/p&gt;
&lt;p&gt;위의 스크립트를 고루틴으로 구현하기 위해서는 세 가지 함수 구현이 필요하다.&lt;/p&gt;
&lt;ol&gt;
&lt;li&gt;find(path string) &amp;#x3C;- chan string&lt;/li&gt;
&lt;li&gt;grep(pattern string, in &amp;#x3C;-chan string) &amp;#x3C;-chan string&lt;/li&gt;
&lt;li&gt;display(in &amp;#x3C;- chan result)&lt;/li&gt;
&lt;/ol&gt;
&lt;p&gt;함수 세 개를 다음과 같이 채널로 연결할 수 있다.&lt;/p&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;go&quot;&gt;&lt;pre class=&quot;language-go&quot;&gt;&lt;code class=&quot;language-go&quot;&gt;path&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; pattern &lt;span class=&quot;token operator&quot;&gt;:=&lt;/span&gt; &lt;span class=&quot;token function&quot;&gt;pargeAgrs&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;
ch1 &lt;span class=&quot;token operator&quot;&gt;:=&lt;/span&gt; &lt;span class=&quot;token function&quot;&gt;find&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;path&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;
ch2 &lt;span class=&quot;token operator&quot;&gt;:=&lt;/span&gt; &lt;span class=&quot;token function&quot;&gt;grep&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;pattern&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; ch1&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;
&lt;span class=&quot;token function&quot;&gt;display&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;ch2&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;find()함수의 결과는 grep() 함수의 매개변수로 전달되고, grep()의 결과는 display()의 매개변수로 전달된다.
이를 main()에서 아래와 같이 구현이 가능하다. 이를 통해 display()에서 반환한 채널을 대기시켜 전체 작업이 완료될 때 까지 프로그램을 종료시키지 않고 대기시킬 수 있다.&lt;/p&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;go&quot;&gt;&lt;pre class=&quot;language-go&quot;&gt;&lt;code class=&quot;language-go&quot;&gt;&lt;span class=&quot;token keyword&quot;&gt;type&lt;/span&gt; Job &lt;span class=&quot;token keyword&quot;&gt;struct&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt; name&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; log &lt;span class=&quot;token builtin&quot;&gt;string&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;
&lt;span class=&quot;token keyword&quot;&gt;type&lt;/span&gt; jobHandler &lt;span class=&quot;token keyword&quot;&gt;func&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;Job&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt; Job

&lt;span class=&quot;token keyword&quot;&gt;func&lt;/span&gt; &lt;span class=&quot;token function&quot;&gt;pipe&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;handler jobHandler&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; in &lt;span class=&quot;token operator&quot;&gt;&amp;lt;-&lt;/span&gt; &lt;span class=&quot;token keyword&quot;&gt;chan&lt;/span&gt; Job&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;token operator&quot;&gt;&amp;lt;-&lt;/span&gt;&lt;span class=&quot;token keyword&quot;&gt;chan&lt;/span&gt; Job&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;이를 모두 이용하면 다음과 같이 구현 가능하다.&lt;/p&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;go&quot;&gt;&lt;pre class=&quot;language-go&quot;&gt;&lt;code class=&quot;language-go&quot;&gt;&lt;span class=&quot;token keyword&quot;&gt;const&lt;/span&gt; BUF_SIZE &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;token number&quot;&gt;1000&lt;/span&gt;

&lt;span class=&quot;token keyword&quot;&gt;var&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;
 workers &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; runtime&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;NumCPU&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;
&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;

&lt;span class=&quot;token keyword&quot;&gt;func&lt;/span&gt; &lt;span class=&quot;token function&quot;&gt;Find&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;path &lt;span class=&quot;token builtin&quot;&gt;string&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;token operator&quot;&gt;&amp;lt;-&lt;/span&gt;&lt;span class=&quot;token keyword&quot;&gt;chan&lt;/span&gt; &lt;span class=&quot;token builtin&quot;&gt;string&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;
 out &lt;span class=&quot;token operator&quot;&gt;:=&lt;/span&gt; &lt;span class=&quot;token function&quot;&gt;make&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token keyword&quot;&gt;chan&lt;/span&gt; &lt;span class=&quot;token builtin&quot;&gt;string&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; BUF_SIZE&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;
 done &lt;span class=&quot;token operator&quot;&gt;:=&lt;/span&gt; &lt;span class=&quot;token function&quot;&gt;make&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token keyword&quot;&gt;chan&lt;/span&gt; &lt;span class=&quot;token keyword&quot;&gt;struct&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; workers&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;
 &lt;span class=&quot;token keyword&quot;&gt;for&lt;/span&gt; i &lt;span class=&quot;token operator&quot;&gt;:=&lt;/span&gt; &lt;span class=&quot;token number&quot;&gt;0&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt; i &lt;span class=&quot;token operator&quot;&gt;&amp;lt;&lt;/span&gt; workers&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt; i&lt;span class=&quot;token operator&quot;&gt;++&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;
  &lt;span class=&quot;token keyword&quot;&gt;go&lt;/span&gt; &lt;span class=&quot;token keyword&quot;&gt;func&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;
   filepath&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;Walk&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;path&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;token keyword&quot;&gt;func&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;file &lt;span class=&quot;token builtin&quot;&gt;string&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; info os&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;FileInfo&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; err &lt;span class=&quot;token builtin&quot;&gt;error&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;token builtin&quot;&gt;error&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;
    out &lt;span class=&quot;token operator&quot;&gt;&amp;lt;-&lt;/span&gt; file
    &lt;span class=&quot;token keyword&quot;&gt;return&lt;/span&gt; &lt;span class=&quot;token boolean&quot;&gt;nil&lt;/span&gt;
   &lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;
   done &lt;span class=&quot;token operator&quot;&gt;&amp;lt;-&lt;/span&gt; &lt;span class=&quot;token keyword&quot;&gt;struct&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;
  &lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;
 &lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;
 &lt;span class=&quot;token keyword&quot;&gt;go&lt;/span&gt; &lt;span class=&quot;token keyword&quot;&gt;func&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;
  &lt;span class=&quot;token keyword&quot;&gt;for&lt;/span&gt; i &lt;span class=&quot;token operator&quot;&gt;:=&lt;/span&gt; &lt;span class=&quot;token number&quot;&gt;0&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt; i &lt;span class=&quot;token operator&quot;&gt;&amp;lt;&lt;/span&gt; &lt;span class=&quot;token function&quot;&gt;cap&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;done&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt; i&lt;span class=&quot;token operator&quot;&gt;++&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;
   &lt;span class=&quot;token operator&quot;&gt;&amp;lt;-&lt;/span&gt;done
  &lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;
  &lt;span class=&quot;token function&quot;&gt;close&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;out&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;
 &lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;

 &lt;span class=&quot;token keyword&quot;&gt;return&lt;/span&gt; out
&lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;

&lt;span class=&quot;token keyword&quot;&gt;func&lt;/span&gt; &lt;span class=&quot;token function&quot;&gt;Grep&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;pattern &lt;span class=&quot;token builtin&quot;&gt;string&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; in &lt;span class=&quot;token operator&quot;&gt;&amp;lt;-&lt;/span&gt;&lt;span class=&quot;token keyword&quot;&gt;chan&lt;/span&gt; &lt;span class=&quot;token builtin&quot;&gt;string&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;token operator&quot;&gt;&amp;lt;-&lt;/span&gt;&lt;span class=&quot;token keyword&quot;&gt;chan&lt;/span&gt; &lt;span class=&quot;token builtin&quot;&gt;string&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;
 out &lt;span class=&quot;token operator&quot;&gt;:=&lt;/span&gt; &lt;span class=&quot;token function&quot;&gt;make&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token keyword&quot;&gt;chan&lt;/span&gt; &lt;span class=&quot;token builtin&quot;&gt;string&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;token function&quot;&gt;cap&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;in&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;
 &lt;span class=&quot;token keyword&quot;&gt;go&lt;/span&gt; &lt;span class=&quot;token keyword&quot;&gt;func&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;
  regex&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; err &lt;span class=&quot;token operator&quot;&gt;:=&lt;/span&gt; regexp&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;Compile&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;pattern&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;
  &lt;span class=&quot;token keyword&quot;&gt;if&lt;/span&gt; err &lt;span class=&quot;token operator&quot;&gt;!=&lt;/span&gt; &lt;span class=&quot;token boolean&quot;&gt;nil&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;
   fmt&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;Println&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;err&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;
   &lt;span class=&quot;token keyword&quot;&gt;return&lt;/span&gt;
  &lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;

  &lt;span class=&quot;token keyword&quot;&gt;for&lt;/span&gt; file &lt;span class=&quot;token operator&quot;&gt;:=&lt;/span&gt; &lt;span class=&quot;token keyword&quot;&gt;range&lt;/span&gt; in &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;
   &lt;span class=&quot;token keyword&quot;&gt;if&lt;/span&gt; regex&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;MatchString&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;file&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;
    out &lt;span class=&quot;token operator&quot;&gt;&amp;lt;-&lt;/span&gt; file
   &lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;
  &lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;
  &lt;span class=&quot;token function&quot;&gt;close&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;out&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;
 &lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;
 &lt;span class=&quot;token keyword&quot;&gt;return&lt;/span&gt; out
&lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;

&lt;span class=&quot;token keyword&quot;&gt;func&lt;/span&gt; &lt;span class=&quot;token function&quot;&gt;Show&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;in &lt;span class=&quot;token operator&quot;&gt;&amp;lt;-&lt;/span&gt;&lt;span class=&quot;token keyword&quot;&gt;chan&lt;/span&gt; &lt;span class=&quot;token builtin&quot;&gt;string&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;token operator&quot;&gt;&amp;lt;-&lt;/span&gt;&lt;span class=&quot;token keyword&quot;&gt;chan&lt;/span&gt; &lt;span class=&quot;token keyword&quot;&gt;struct&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;
 quit &lt;span class=&quot;token operator&quot;&gt;:=&lt;/span&gt; &lt;span class=&quot;token function&quot;&gt;make&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token keyword&quot;&gt;chan&lt;/span&gt; &lt;span class=&quot;token keyword&quot;&gt;struct&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;
 &lt;span class=&quot;token keyword&quot;&gt;go&lt;/span&gt; &lt;span class=&quot;token keyword&quot;&gt;func&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;
  &lt;span class=&quot;token keyword&quot;&gt;for&lt;/span&gt; file &lt;span class=&quot;token operator&quot;&gt;:=&lt;/span&gt; &lt;span class=&quot;token keyword&quot;&gt;range&lt;/span&gt; in &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;
   c&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; err &lt;span class=&quot;token operator&quot;&gt;:=&lt;/span&gt; &lt;span class=&quot;token function&quot;&gt;lineCount&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;file&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;
   &lt;span class=&quot;token keyword&quot;&gt;if&lt;/span&gt; err &lt;span class=&quot;token operator&quot;&gt;!=&lt;/span&gt; &lt;span class=&quot;token boolean&quot;&gt;nil&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;
    fmt&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;Println&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;err&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;
    &lt;span class=&quot;token keyword&quot;&gt;continue&lt;/span&gt;
   &lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;
   fmt&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;Println&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token string&quot;&gt;&quot;8d %s\n&quot;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; c&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; file&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;
  &lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;
  quit &lt;span class=&quot;token operator&quot;&gt;&amp;lt;-&lt;/span&gt; &lt;span class=&quot;token keyword&quot;&gt;struct&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;
 &lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;
 &lt;span class=&quot;token keyword&quot;&gt;return&lt;/span&gt; quit
&lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;

&lt;span class=&quot;token keyword&quot;&gt;func&lt;/span&gt; &lt;span class=&quot;token function&quot;&gt;lineCount&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;file &lt;span class=&quot;token builtin&quot;&gt;string&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token builtin&quot;&gt;int&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;token builtin&quot;&gt;error&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;
 f&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; err &lt;span class=&quot;token operator&quot;&gt;:=&lt;/span&gt; os&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;Open&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;file&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;
 &lt;span class=&quot;token keyword&quot;&gt;if&lt;/span&gt; err &lt;span class=&quot;token operator&quot;&gt;!=&lt;/span&gt; &lt;span class=&quot;token boolean&quot;&gt;nil&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;
  &lt;span class=&quot;token keyword&quot;&gt;return&lt;/span&gt; &lt;span class=&quot;token number&quot;&gt;0&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; err
 &lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;
 &lt;span class=&quot;token keyword&quot;&gt;defer&lt;/span&gt; f&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;Close&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;

 info&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; err &lt;span class=&quot;token operator&quot;&gt;:=&lt;/span&gt; f&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;Stat&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;
 &lt;span class=&quot;token keyword&quot;&gt;if&lt;/span&gt; err &lt;span class=&quot;token operator&quot;&gt;!=&lt;/span&gt; &lt;span class=&quot;token boolean&quot;&gt;nil&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;
  &lt;span class=&quot;token keyword&quot;&gt;return&lt;/span&gt; &lt;span class=&quot;token number&quot;&gt;0&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; err
 &lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;

 &lt;span class=&quot;token keyword&quot;&gt;if&lt;/span&gt; info&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;Mode&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;IsDir&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;
  &lt;span class=&quot;token keyword&quot;&gt;return&lt;/span&gt; &lt;span class=&quot;token number&quot;&gt;0&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; fmt&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;Errorf&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token string&quot;&gt;&quot;%s is a directory&quot;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; file&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;
 &lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;

 count &lt;span class=&quot;token operator&quot;&gt;:=&lt;/span&gt; &lt;span class=&quot;token number&quot;&gt;0&lt;/span&gt;
 buf &lt;span class=&quot;token operator&quot;&gt;:=&lt;/span&gt; &lt;span class=&quot;token function&quot;&gt;make&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;[&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;]&lt;/span&gt;&lt;span class=&quot;token builtin&quot;&gt;byte&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;token number&quot;&gt;1024&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;*&lt;/span&gt;&lt;span class=&quot;token number&quot;&gt;8&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;
 newLine &lt;span class=&quot;token operator&quot;&gt;:=&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;[&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;]&lt;/span&gt;&lt;span class=&quot;token builtin&quot;&gt;byte&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;&lt;span class=&quot;token char&quot;&gt;&apos;\n&apos;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;

 &lt;span class=&quot;token keyword&quot;&gt;for&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;
  c&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; err &lt;span class=&quot;token operator&quot;&gt;:=&lt;/span&gt; f&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;Read&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;buf&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;
  &lt;span class=&quot;token keyword&quot;&gt;if&lt;/span&gt; err &lt;span class=&quot;token operator&quot;&gt;!=&lt;/span&gt; &lt;span class=&quot;token boolean&quot;&gt;nil&lt;/span&gt; &lt;span class=&quot;token operator&quot;&gt;&amp;amp;&amp;amp;&lt;/span&gt; err &lt;span class=&quot;token operator&quot;&gt;!=&lt;/span&gt; io&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;EOF &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;
   fmt&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;Println&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;err&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;
   &lt;span class=&quot;token keyword&quot;&gt;return&lt;/span&gt; &lt;span class=&quot;token number&quot;&gt;0&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; err
  &lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;

  count &lt;span class=&quot;token operator&quot;&gt;+=&lt;/span&gt; bytes&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;Count&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;buf&lt;span class=&quot;token punctuation&quot;&gt;[&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt;c&lt;span class=&quot;token punctuation&quot;&gt;]&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; newLine&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;

  &lt;span class=&quot;token keyword&quot;&gt;if&lt;/span&gt; err &lt;span class=&quot;token operator&quot;&gt;==&lt;/span&gt; io&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;EOF &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;
   &lt;span class=&quot;token keyword&quot;&gt;break&lt;/span&gt;
  &lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;
 &lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;
 &lt;span class=&quot;token keyword&quot;&gt;return&lt;/span&gt; count&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;token boolean&quot;&gt;nil&lt;/span&gt;
&lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;

&lt;span class=&quot;token keyword&quot;&gt;func&lt;/span&gt; &lt;span class=&quot;token function&quot;&gt;main&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;    
 runtime&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;GOMAXPROCS&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;runtime&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;NumCPU&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;
 path &lt;span class=&quot;token operator&quot;&gt;:=&lt;/span&gt; &lt;span class=&quot;token string&quot;&gt;&quot;/Users/parkjongin/workspace/go/src/golang-practice&quot;&lt;/span&gt;
 pattern &lt;span class=&quot;token operator&quot;&gt;:=&lt;/span&gt; &lt;span class=&quot;token string&quot;&gt;&quot;.go$&quot;&lt;/span&gt;
 &lt;span class=&quot;token operator&quot;&gt;&amp;lt;-&lt;/span&gt;common&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;Show&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;common&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;Grep&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;pattern&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; common&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;Find&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;path&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;
 &lt;span class=&quot;token keyword&quot;&gt;return&lt;/span&gt;
&lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;</content:encoded></item><item><title><![CDATA[[Go 언어 문법 정리] 04. 병행 처리 (2) 저수준 제어]]></title><description><![CDATA[1. 저수준 제어 Go에는 고루틴과 채널 외에도 병행 프로그래밍을 위한 저수준 제어 기능이 있다. 패키지 내용 sync mutex로 공유 메모리 제어 sync/atomic 원자성을 보장 (add, compare, swap) 1.1 sync.Mutex…]]></description><link>https://github.com/SiverPineValley/SiverPineValley.github.io/golang/concurrency_2/</link><guid isPermaLink="false">https://github.com/SiverPineValley/SiverPineValley.github.io/golang/concurrency_2/</guid><pubDate>Sat, 16 Apr 2022 19:16:22 GMT</pubDate><content:encoded>&lt;h2&gt;1. 저수준 제어&lt;/h2&gt;
&lt;p&gt;Go에는 고루틴과 채널 외에도 병행 프로그래밍을 위한 저수준 제어 기능이 있다.&lt;/p&gt;
&lt;table&gt;
&lt;thead&gt;
&lt;tr&gt;
&lt;th&gt;패키지&lt;/th&gt;
&lt;th&gt;내용&lt;/th&gt;
&lt;/tr&gt;
&lt;/thead&gt;
&lt;tbody&gt;
&lt;tr&gt;
&lt;td&gt;sync&lt;/td&gt;
&lt;td&gt;mutex로 공유 메모리 제어&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;sync/atomic&lt;/td&gt;
&lt;td&gt;원자성을 보장 (add, compare, swap)&lt;/td&gt;
&lt;/tr&gt;
&lt;/tbody&gt;
&lt;/table&gt;
&lt;h3&gt;1.1 sync.Mutex&lt;/h3&gt;
&lt;p&gt;뮤텍스(Mutex)는 여러 고루틴에서 공유하는 데이터를 보호해야 할 때 사용한다.&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;func (m *Mutex) Lock(): 뮤텍스 잠금&lt;/li&gt;
&lt;li&gt;func (* Mutex) Unlock(): 뮤텍스 잠금 해제&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;임계 영역(critical section)의 코드를 실행하기 전에는 뮤텍스의 Lock()메서드로 잠금을 하고, 처리 완료 후에 Unlock() 메서드로 잠금을 해제한다.&lt;/p&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;go&quot;&gt;&lt;pre class=&quot;language-go&quot;&gt;&lt;code class=&quot;language-go&quot;&gt;&lt;span class=&quot;token keyword&quot;&gt;package&lt;/span&gt; main

&lt;span class=&quot;token keyword&quot;&gt;import&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;
 &lt;span class=&quot;token string&quot;&gt;&quot;fmt&quot;&lt;/span&gt;
 &lt;span class=&quot;token string&quot;&gt;&quot;runtime&quot;&lt;/span&gt;
&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;

&lt;span class=&quot;token keyword&quot;&gt;type&lt;/span&gt; counter &lt;span class=&quot;token keyword&quot;&gt;struct&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;
 i &lt;span class=&quot;token builtin&quot;&gt;int64&lt;/span&gt;
&lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;

&lt;span class=&quot;token comment&quot;&gt;// counter 값을 1씩 증가시킴&lt;/span&gt;
&lt;span class=&quot;token keyword&quot;&gt;func&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;c &lt;span class=&quot;token operator&quot;&gt;*&lt;/span&gt;counter&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;token function&quot;&gt;increment&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;
 c&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;i &lt;span class=&quot;token operator&quot;&gt;+=&lt;/span&gt; &lt;span class=&quot;token number&quot;&gt;1&lt;/span&gt;
&lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;

&lt;span class=&quot;token keyword&quot;&gt;func&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;c &lt;span class=&quot;token operator&quot;&gt;*&lt;/span&gt;counter&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;token function&quot;&gt;display&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;
 fmt&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;Println&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;c&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;i&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;
&lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;

&lt;span class=&quot;token keyword&quot;&gt;func&lt;/span&gt; &lt;span class=&quot;token function&quot;&gt;main&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;
 &lt;span class=&quot;token comment&quot;&gt;// 모든 CPU 를 사용하게 함&lt;/span&gt;
 runtime&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;GOMAXPROCS&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;runtime&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;NumCPU&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;

 c &lt;span class=&quot;token operator&quot;&gt;:=&lt;/span&gt; counter&lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;i&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;token number&quot;&gt;0&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;   &lt;span class=&quot;token comment&quot;&gt;// 카운터 생성&lt;/span&gt;
 done &lt;span class=&quot;token operator&quot;&gt;:=&lt;/span&gt; &lt;span class=&quot;token function&quot;&gt;make&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token keyword&quot;&gt;chan&lt;/span&gt; &lt;span class=&quot;token keyword&quot;&gt;struct&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;token comment&quot;&gt;// 완료 신호 수신용 채널&lt;/span&gt;

 &lt;span class=&quot;token keyword&quot;&gt;for&lt;/span&gt; i &lt;span class=&quot;token operator&quot;&gt;:=&lt;/span&gt; &lt;span class=&quot;token number&quot;&gt;0&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt; i &lt;span class=&quot;token operator&quot;&gt;&amp;lt;&lt;/span&gt; &lt;span class=&quot;token number&quot;&gt;1000&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt; i&lt;span class=&quot;token operator&quot;&gt;++&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;
  &lt;span class=&quot;token keyword&quot;&gt;go&lt;/span&gt; &lt;span class=&quot;token keyword&quot;&gt;func&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;
   c&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;increment&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;
   done &lt;span class=&quot;token operator&quot;&gt;&amp;lt;-&lt;/span&gt; &lt;span class=&quot;token keyword&quot;&gt;struct&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;
  &lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;
 &lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;

 &lt;span class=&quot;token keyword&quot;&gt;for&lt;/span&gt; i &lt;span class=&quot;token operator&quot;&gt;:=&lt;/span&gt; &lt;span class=&quot;token number&quot;&gt;0&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt; i &lt;span class=&quot;token operator&quot;&gt;&amp;lt;&lt;/span&gt; &lt;span class=&quot;token number&quot;&gt;1000&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt; i&lt;span class=&quot;token operator&quot;&gt;++&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;
  &lt;span class=&quot;token operator&quot;&gt;&amp;lt;-&lt;/span&gt;done
 &lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;

 c&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;display&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;
&lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;이 프로그램은 루프를 1000번 돌며 고루틴을 1000개 수행한다. 각 고루틴에서는 counter 타입 변수 c의 값을 increment() 메서드로 1씩 증가시킨다.
increment 메서드는 총 1000번 수행되므로 프로그램 실행 결과로 1000이 출력되어야 한다. 하지만 실제 결과는 1000보다 작은 값이 출력된다. 이는 여러 고루틴이 카운터 c의 내부 필드 i의 값을 동시에 수정하려고 해서
경쟁상태가 만들어졌기 때문이다. 아래와 같이 수정하면 원하는 동작이 수행된다.&lt;/p&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;go&quot;&gt;&lt;pre class=&quot;language-go&quot;&gt;&lt;code class=&quot;language-go&quot;&gt;&lt;span class=&quot;token keyword&quot;&gt;package&lt;/span&gt; main

&lt;span class=&quot;token keyword&quot;&gt;import&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;
 &lt;span class=&quot;token string&quot;&gt;&quot;fmt&quot;&lt;/span&gt;
 &lt;span class=&quot;token string&quot;&gt;&quot;runtime&quot;&lt;/span&gt;
 &lt;span class=&quot;token string&quot;&gt;&quot;sync&quot;&lt;/span&gt;
&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;

&lt;span class=&quot;token keyword&quot;&gt;type&lt;/span&gt; counter &lt;span class=&quot;token keyword&quot;&gt;struct&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;
 i &lt;span class=&quot;token builtin&quot;&gt;int64&lt;/span&gt;
 mu sync&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;Mutex
&lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;

&lt;span class=&quot;token comment&quot;&gt;// counter 값을 1씩 증가시킴&lt;/span&gt;
&lt;span class=&quot;token keyword&quot;&gt;func&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;c &lt;span class=&quot;token operator&quot;&gt;*&lt;/span&gt;counter&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;token function&quot;&gt;increment&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;
 c&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;mu&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;Lock&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;
 c&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;i &lt;span class=&quot;token operator&quot;&gt;+=&lt;/span&gt; &lt;span class=&quot;token number&quot;&gt;1&lt;/span&gt;
 c&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;mu&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;Unlock&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;
&lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;

&lt;span class=&quot;token keyword&quot;&gt;func&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;c &lt;span class=&quot;token operator&quot;&gt;*&lt;/span&gt;counter&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;token function&quot;&gt;display&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;
 fmt&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;Println&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;c&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;i&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;
&lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;

&lt;span class=&quot;token keyword&quot;&gt;func&lt;/span&gt; &lt;span class=&quot;token function&quot;&gt;main&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;
 &lt;span class=&quot;token comment&quot;&gt;// 모든 CPU 를 사용하게 함&lt;/span&gt;
 runtime&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;GOMAXPROCS&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;runtime&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;NumCPU&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;

 c &lt;span class=&quot;token operator&quot;&gt;:=&lt;/span&gt; counter&lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;i&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;token number&quot;&gt;0&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;   &lt;span class=&quot;token comment&quot;&gt;// 카운터 생성&lt;/span&gt;
 done &lt;span class=&quot;token operator&quot;&gt;:=&lt;/span&gt; &lt;span class=&quot;token function&quot;&gt;make&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token keyword&quot;&gt;chan&lt;/span&gt; &lt;span class=&quot;token keyword&quot;&gt;struct&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;token comment&quot;&gt;// 완료 신호 수신용 채널&lt;/span&gt;

 &lt;span class=&quot;token keyword&quot;&gt;for&lt;/span&gt; i &lt;span class=&quot;token operator&quot;&gt;:=&lt;/span&gt; &lt;span class=&quot;token number&quot;&gt;0&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt; i &lt;span class=&quot;token operator&quot;&gt;&amp;lt;&lt;/span&gt; &lt;span class=&quot;token number&quot;&gt;1000&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt; i&lt;span class=&quot;token operator&quot;&gt;++&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;
  &lt;span class=&quot;token keyword&quot;&gt;go&lt;/span&gt; &lt;span class=&quot;token keyword&quot;&gt;func&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;
   c&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;increment&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;
   done &lt;span class=&quot;token operator&quot;&gt;&amp;lt;-&lt;/span&gt; &lt;span class=&quot;token keyword&quot;&gt;struct&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;
  &lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;
 &lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;

 &lt;span class=&quot;token keyword&quot;&gt;for&lt;/span&gt; i &lt;span class=&quot;token operator&quot;&gt;:=&lt;/span&gt; &lt;span class=&quot;token number&quot;&gt;0&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt; i &lt;span class=&quot;token operator&quot;&gt;&amp;lt;&lt;/span&gt; &lt;span class=&quot;token number&quot;&gt;1000&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt; i&lt;span class=&quot;token operator&quot;&gt;++&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;
  &lt;span class=&quot;token operator&quot;&gt;&amp;lt;-&lt;/span&gt;done
 &lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;

 c&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;display&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;
&lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;h3&gt;1.2 sync.RWMutex&lt;/h3&gt;
&lt;p&gt;sync.RWMutex는 sync.Mutex와 동작 방식이 유사하다. 하지만 sync.RWMutex는 읽기 동작과 쓰기 동작을 나누어 잠금 처리할 수 있다.&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;
&lt;p&gt;읽기 잠금: 읽기 잠금은 읽기 작업에 한해 공유 데이터가 변하지 않음을 보장한다. 읽기 잠금일 경우 다른 고루틴에서도 읽기는 가능하나, 쓰기는 불가능하다.&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;쓰기 잠금: 쓰기 잠금은 공유 데이터에 쓰기 작업을 보장하는 것으로, 쓰기 잠금일 경우, 다른 고루틴에서 읽기와 쓰기 모두 불가능하다.&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;func (m *Mutex) Lock(): 쓰기 뮤텍스 잠금&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;func (*Mutex) Unlock(): 쓰기 뮤텍스 잠금 해제&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;func (m *Mutex) RLock(): 읽기 뮤텍스 잠금&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;func (*Mutex) RUnlock(): 읽기 뮤텍스 잠금 해제&lt;/p&gt;
&lt;/li&gt;
&lt;/ul&gt;
&lt;h3&gt;1.3 sync.Once&lt;/h3&gt;
&lt;p&gt;특정 함수를 한 번만 수행해야 할 때 sync.Once를 사용한다.
sync.Once 구조체는 다음 메서드를 제공한다.&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;func (o *Once) Do(f func())&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;한 번만 수행해야 하는 함수를 Do() 메서드의 매개변수로 전달하면, 여러 고루틴에서 실행한다 해도 해당 함수는 한 번만 실행된다.
아래 코드 수행결과를 보면 &lt;code class=&quot;language-text&quot;&gt;c.increment()&lt;/code&gt;는 1000번 수행되었지만, 카운터 내부 필드 값 i의 초기화 작업은 단 한번만 수행되었다.&lt;/p&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;go&quot;&gt;&lt;pre class=&quot;language-go&quot;&gt;&lt;code class=&quot;language-go&quot;&gt;&lt;span class=&quot;token keyword&quot;&gt;package&lt;/span&gt; main

&lt;span class=&quot;token keyword&quot;&gt;import&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;
 &lt;span class=&quot;token string&quot;&gt;&quot;fmt&quot;&lt;/span&gt;
 &lt;span class=&quot;token string&quot;&gt;&quot;runtime&quot;&lt;/span&gt;
 &lt;span class=&quot;token string&quot;&gt;&quot;sync&quot;&lt;/span&gt;
&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;

&lt;span class=&quot;token keyword&quot;&gt;const&lt;/span&gt; intialValue &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;token operator&quot;&gt;-&lt;/span&gt;&lt;span class=&quot;token number&quot;&gt;500&lt;/span&gt;

&lt;span class=&quot;token keyword&quot;&gt;type&lt;/span&gt; counter &lt;span class=&quot;token keyword&quot;&gt;struct&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;
 i &lt;span class=&quot;token builtin&quot;&gt;int64&lt;/span&gt;
 mu sync&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;Mutex
 once sync&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;Once
&lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;

&lt;span class=&quot;token comment&quot;&gt;// counter 값을 1씩 증가시킴&lt;/span&gt;
&lt;span class=&quot;token keyword&quot;&gt;func&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;c &lt;span class=&quot;token operator&quot;&gt;*&lt;/span&gt;counter&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;token function&quot;&gt;increment&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;
 c&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;once&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;Do&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token keyword&quot;&gt;func&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;
  c&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;i &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; intialValue
 &lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;
 c&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;mu&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;Lock&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;
 c&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;i &lt;span class=&quot;token operator&quot;&gt;+=&lt;/span&gt; &lt;span class=&quot;token number&quot;&gt;1&lt;/span&gt;
 c&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;mu&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;Unlock&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;
&lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;

&lt;span class=&quot;token keyword&quot;&gt;func&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;c &lt;span class=&quot;token operator&quot;&gt;*&lt;/span&gt;counter&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;token function&quot;&gt;display&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;
 fmt&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;Println&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;c&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;i&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;
&lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;

&lt;span class=&quot;token keyword&quot;&gt;func&lt;/span&gt; &lt;span class=&quot;token function&quot;&gt;main&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;
 &lt;span class=&quot;token comment&quot;&gt;// 모든 CPU 를 사용하게 함&lt;/span&gt;
 runtime&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;GOMAXPROCS&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;runtime&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;NumCPU&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;

 c &lt;span class=&quot;token operator&quot;&gt;:=&lt;/span&gt; counter&lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;i&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;token number&quot;&gt;0&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;   &lt;span class=&quot;token comment&quot;&gt;// 카운터 생성&lt;/span&gt;
 done &lt;span class=&quot;token operator&quot;&gt;:=&lt;/span&gt; &lt;span class=&quot;token function&quot;&gt;make&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token keyword&quot;&gt;chan&lt;/span&gt; &lt;span class=&quot;token keyword&quot;&gt;struct&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;token comment&quot;&gt;// 완료 신호 수신용 채널&lt;/span&gt;

 &lt;span class=&quot;token keyword&quot;&gt;for&lt;/span&gt; i &lt;span class=&quot;token operator&quot;&gt;:=&lt;/span&gt; &lt;span class=&quot;token number&quot;&gt;0&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt; i &lt;span class=&quot;token operator&quot;&gt;&amp;lt;&lt;/span&gt; &lt;span class=&quot;token number&quot;&gt;1000&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt; i&lt;span class=&quot;token operator&quot;&gt;++&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;
  &lt;span class=&quot;token keyword&quot;&gt;go&lt;/span&gt; &lt;span class=&quot;token keyword&quot;&gt;func&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;
   c&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;increment&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;
   done &lt;span class=&quot;token operator&quot;&gt;&amp;lt;-&lt;/span&gt; &lt;span class=&quot;token keyword&quot;&gt;struct&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;
  &lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;
 &lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;

 &lt;span class=&quot;token keyword&quot;&gt;for&lt;/span&gt; i &lt;span class=&quot;token operator&quot;&gt;:=&lt;/span&gt; &lt;span class=&quot;token number&quot;&gt;0&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt; i &lt;span class=&quot;token operator&quot;&gt;&amp;lt;&lt;/span&gt; &lt;span class=&quot;token number&quot;&gt;1000&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt; i&lt;span class=&quot;token operator&quot;&gt;++&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;
  &lt;span class=&quot;token operator&quot;&gt;&amp;lt;-&lt;/span&gt;done
 &lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;

 c&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;display&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;
&lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;text&quot;&gt;&lt;pre class=&quot;language-text&quot;&gt;&lt;code class=&quot;language-text&quot;&gt;500&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;h3&gt;1.4 sync.WaitGroup&lt;/h3&gt;
&lt;p&gt;sync.WaitGroup은 모든 고루틴이 종료될 때까지 대기해야 할 때 사용된다.&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;func (wg *WaitGroup) Add(delta int): WaitGroup에 대기 중인 고루틴 개수 추가&lt;/li&gt;
&lt;li&gt;func (wg *WaitGroup) Done(): 대기 중인 고루틴의 수행이 종료되는 것을 알려줌&lt;/li&gt;
&lt;li&gt;func (wg *WaitGroup) Wait(): 모든 고루틴이 종료될 때까지 대기&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;done 채널을 사용하여 고루틴이 종료될 때까지 대기했던 코드를 WaitGroup을 사용하는 코드로 수정하면 아래와 같다.&lt;/p&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;go&quot;&gt;&lt;pre class=&quot;language-go&quot;&gt;&lt;code class=&quot;language-go&quot;&gt;&lt;span class=&quot;token keyword&quot;&gt;package&lt;/span&gt; main

&lt;span class=&quot;token keyword&quot;&gt;import&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;
 &lt;span class=&quot;token string&quot;&gt;&quot;fmt&quot;&lt;/span&gt;
 &lt;span class=&quot;token string&quot;&gt;&quot;runtime&quot;&lt;/span&gt;
 &lt;span class=&quot;token string&quot;&gt;&quot;sync&quot;&lt;/span&gt;
&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;

&lt;span class=&quot;token keyword&quot;&gt;type&lt;/span&gt; counter &lt;span class=&quot;token keyword&quot;&gt;struct&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;
 i &lt;span class=&quot;token builtin&quot;&gt;int64&lt;/span&gt;
 mu sync&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;Mutex
&lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;

&lt;span class=&quot;token comment&quot;&gt;// counter 값을 1씩 증가시킴&lt;/span&gt;
&lt;span class=&quot;token keyword&quot;&gt;func&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;c &lt;span class=&quot;token operator&quot;&gt;*&lt;/span&gt;counter&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;token function&quot;&gt;increment&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;
 c&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;mu&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;Lock&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;
 c&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;i &lt;span class=&quot;token operator&quot;&gt;+=&lt;/span&gt; &lt;span class=&quot;token number&quot;&gt;1&lt;/span&gt;
 c&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;mu&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;Unlock&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;
&lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;

&lt;span class=&quot;token keyword&quot;&gt;func&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;c &lt;span class=&quot;token operator&quot;&gt;*&lt;/span&gt;counter&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;token function&quot;&gt;display&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;
 fmt&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;Println&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;c&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;i&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;
&lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;

&lt;span class=&quot;token keyword&quot;&gt;func&lt;/span&gt; &lt;span class=&quot;token function&quot;&gt;main&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;
 &lt;span class=&quot;token comment&quot;&gt;// 모든 CPU 를 사용하게 함&lt;/span&gt;
 runtime&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;GOMAXPROCS&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;runtime&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;NumCPU&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;

 c &lt;span class=&quot;token operator&quot;&gt;:=&lt;/span&gt; counter&lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;i&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;token number&quot;&gt;0&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;   &lt;span class=&quot;token comment&quot;&gt;// 카운터 생성&lt;/span&gt;
 wg &lt;span class=&quot;token operator&quot;&gt;:=&lt;/span&gt; sync&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;WaitGroup&lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;      &lt;span class=&quot;token comment&quot;&gt;// WaitGroup 생성&lt;/span&gt;

 &lt;span class=&quot;token keyword&quot;&gt;for&lt;/span&gt; i &lt;span class=&quot;token operator&quot;&gt;:=&lt;/span&gt; &lt;span class=&quot;token number&quot;&gt;0&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt; i &lt;span class=&quot;token operator&quot;&gt;&amp;lt;&lt;/span&gt; &lt;span class=&quot;token number&quot;&gt;1000&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt; i&lt;span class=&quot;token operator&quot;&gt;++&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;
  wg&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;Add&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token number&quot;&gt;1&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;token comment&quot;&gt;// WaitGroup의 고루틴 개수 1 증가&lt;/span&gt;
  &lt;span class=&quot;token keyword&quot;&gt;go&lt;/span&gt; &lt;span class=&quot;token keyword&quot;&gt;func&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;
   &lt;span class=&quot;token keyword&quot;&gt;defer&lt;/span&gt; wg&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;Done&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;
   c&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;increment&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;
  &lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;
 &lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;

 wg&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;Wait&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;

 c&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;display&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;
&lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;h3&gt;1.5 원자성을 보장하는 연산&lt;/h3&gt;
&lt;p&gt;원자성을 보장하는 연산(atomic Operation)이란 쪼갤 수 없는 연산을 말한다.&lt;/p&gt;
&lt;p&gt;i += 1 같은 단순 연산이라도 최소 세 단계를 거친다.&lt;/p&gt;
&lt;ol&gt;
&lt;li&gt;메모리에서 값을 읽는다.&lt;/li&gt;
&lt;li&gt;값을 1 증가시킨다.&lt;/li&gt;
&lt;li&gt;새로운 값을 메모리에 다시 쓴다.&lt;/li&gt;
&lt;/ol&gt;
&lt;p&gt;고루틴을 여러 개 동시에 실행하면 CPU는 각 고루틴을 시분할하여 번갈아 실행하는 방식으로 병행처리한다.
즉, i += 1 같은 단순 연산을 처리하는 도중에도 CPU는 해당 연산을 잠시 중단하고 다른 고루틴을 수행하다 동기화 문제가 발생할 수 있다.&lt;/p&gt;
&lt;p&gt;sync/atomic 패키지가 제공하는 함수를 사용하면 CPU에서 시분할을 하지 않고 한 번만 처리하도록 제어할 수 있다.&lt;/p&gt;
&lt;table&gt;
&lt;thead&gt;
&lt;tr&gt;
&lt;th&gt;함수&lt;/th&gt;
&lt;th&gt;설명&lt;/th&gt;
&lt;/tr&gt;
&lt;/thead&gt;
&lt;tbody&gt;
&lt;tr&gt;
&lt;td&gt;AddT&lt;/td&gt;
&lt;td&gt;특정 포인터 변수에 값을 더함&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;CompareAndSwapT&lt;/td&gt;
&lt;td&gt;특정 포인터 변수의 값을 주어진 값과 비교하여 같으면 새로운 값으로 대체&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;LoadT&lt;/td&gt;
&lt;td&gt;특정 포인터 변수의 값을 가져옴&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;StoreT&lt;/td&gt;
&lt;td&gt;특정 포인터 변수에 값을 저장함&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;SwapT&lt;/td&gt;
&lt;td&gt;특정 포인터 변수에 새로운 값을 저장하고 이전 값을 가져옴&lt;/td&gt;
&lt;/tr&gt;
&lt;/tbody&gt;
&lt;/table&gt;
&lt;p&gt;다음은 뮤텍스를 사용하지 않고 sync/atomic 패키지의 AddInt64 함수를 사용한 코드이다.&lt;/p&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;go&quot;&gt;&lt;pre class=&quot;language-go&quot;&gt;&lt;code class=&quot;language-go&quot;&gt;&lt;span class=&quot;token keyword&quot;&gt;package&lt;/span&gt; main

&lt;span class=&quot;token keyword&quot;&gt;import&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;
 &lt;span class=&quot;token string&quot;&gt;&quot;fmt&quot;&lt;/span&gt;
 &lt;span class=&quot;token string&quot;&gt;&quot;runtime&quot;&lt;/span&gt;
 &lt;span class=&quot;token string&quot;&gt;&quot;sync&quot;&lt;/span&gt;
 &lt;span class=&quot;token string&quot;&gt;&quot;sync/atomic&quot;&lt;/span&gt;
&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;

&lt;span class=&quot;token keyword&quot;&gt;type&lt;/span&gt; counter &lt;span class=&quot;token keyword&quot;&gt;struct&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;
 i &lt;span class=&quot;token builtin&quot;&gt;int64&lt;/span&gt;
&lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;

&lt;span class=&quot;token comment&quot;&gt;// counter 값을 1씩 증가시킴&lt;/span&gt;
&lt;span class=&quot;token keyword&quot;&gt;func&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;c &lt;span class=&quot;token operator&quot;&gt;*&lt;/span&gt;counter&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;token function&quot;&gt;increment&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;
 atomic&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;AddInt64&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;&amp;amp;&lt;/span&gt;c&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;i&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;token number&quot;&gt;1&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;
&lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;

&lt;span class=&quot;token keyword&quot;&gt;func&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;c &lt;span class=&quot;token operator&quot;&gt;*&lt;/span&gt;counter&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;token function&quot;&gt;display&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;
 fmt&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;Println&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;c&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;i&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;
&lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;

&lt;span class=&quot;token keyword&quot;&gt;func&lt;/span&gt; &lt;span class=&quot;token function&quot;&gt;main&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;
 &lt;span class=&quot;token comment&quot;&gt;// 모든 CPU 를 사용하게 함&lt;/span&gt;
 runtime&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;GOMAXPROCS&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;runtime&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;NumCPU&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;

 c &lt;span class=&quot;token operator&quot;&gt;:=&lt;/span&gt; counter&lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;i&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;token number&quot;&gt;0&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;   &lt;span class=&quot;token comment&quot;&gt;// 카운터 생성&lt;/span&gt;
 wg &lt;span class=&quot;token operator&quot;&gt;:=&lt;/span&gt; sync&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;WaitGroup&lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;      &lt;span class=&quot;token comment&quot;&gt;// WaitGroup 생성&lt;/span&gt;

 &lt;span class=&quot;token keyword&quot;&gt;for&lt;/span&gt; i &lt;span class=&quot;token operator&quot;&gt;:=&lt;/span&gt; &lt;span class=&quot;token number&quot;&gt;0&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt; i &lt;span class=&quot;token operator&quot;&gt;&amp;lt;&lt;/span&gt; &lt;span class=&quot;token number&quot;&gt;1000&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt; i&lt;span class=&quot;token operator&quot;&gt;++&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;
  wg&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;Add&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token number&quot;&gt;1&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;token comment&quot;&gt;// WaitGroup의 고루틴 개수 1 증가&lt;/span&gt;
  &lt;span class=&quot;token keyword&quot;&gt;go&lt;/span&gt; &lt;span class=&quot;token keyword&quot;&gt;func&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;
   &lt;span class=&quot;token keyword&quot;&gt;defer&lt;/span&gt; wg&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;Done&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;
   c&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;increment&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;
  &lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;
 &lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;

 wg&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;Wait&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;

 c&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;display&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;
&lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;저수준 제어에서는 앞서 go루틴과 채널로는 해결할 수 없는, 공유 메모리를 사용하는 경우 교착 상태를 제어할 때 필수적으로 사용된다.&lt;/p&gt;
&lt;p&gt;흔히 운영체제 수업 때 교착 상태 제어를 위해 사용하는 Mutex를 사용하여 Critical Section에서의 교착 상태를 방지하는 로직 처리를 할 수 있다.&lt;/p&gt;
&lt;p&gt;원자성을 보장하는 연산(atomic operation)이란 이러한 상호 배제를 보장하는 연산을 의미한다.&lt;/p&gt;
&lt;p&gt;만약 변수의 값 하나를 증가시킨다던가 매우 작은 연산을 위해 Mutex를 사용하면, 배보다 배꼽이 더 큰 상황이 발생한다.&lt;/p&gt;
&lt;p&gt;atomic 패키지에서 제공하는 연산들은 CPU단위에서 Mutex를 사용한 것 처럼 원자성이 보장되는 단순 계산 함수를 제공한다.&lt;/p&gt;
&lt;p&gt;이러한 연산은 문맥 교환 (Context Change)를 발생시키지 않기 때문에 속도가 보장된다.&lt;/p&gt;
&lt;p&gt;이를 통해 Mutex를 사용하지 않더라도 교착 상태를 방지하는 로직의 구현이 가능해진다.&lt;/p&gt;</content:encoded></item><item><title><![CDATA[[Go 언어 문법 정리] 04. 병행 처리 (1) 고루틴과 채널]]></title><description><![CDATA[1. 고루틴(goroutine) 이번에는 Go언어에서 지원하는 몇 가지 병행 처리 기법에 대해서 볼 예정이다.
Go언어의 가장 큰 특징 중 하나인 goroutine이 바로 그러한 기능인데,
은 Go…]]></description><link>https://github.com/SiverPineValley/SiverPineValley.github.io/golang/concurrency_1/</link><guid isPermaLink="false">https://github.com/SiverPineValley/SiverPineValley.github.io/golang/concurrency_1/</guid><pubDate>Sat, 02 Apr 2022 15:50:20 GMT</pubDate><content:encoded>&lt;h2&gt;1. 고루틴(goroutine)&lt;/h2&gt;
&lt;p&gt;이번에는 Go언어에서 지원하는 몇 가지 병행 처리 기법에 대해서 볼 예정이다.
Go언어의 가장 큰 특징 중 하나인 goroutine이 바로 그러한 기능인데,
&lt;code class=&quot;language-text&quot;&gt;고루틴(goroutine)&lt;/code&gt;은 Go 프로그램 안에서 동시에 독립적으로 실행되는 흐름의 단위로, 스레드와 비슷한 개념이다.
하지만, 스레드와 달리 고루틴은 수 킬로바이트 정도의 아주 작은 리소스에서 동작하므로 한 프로세스에 수천, 수만 개의 고루틴을 동작시킬 수 있다.
고루틴은 정보를 공유하는 방식이 아니라 메시지를 서로 주고받는 방식으로 동작한다.
그래서 Lock으로 공유 메모리를 관리할 필요가 없고 구현도 어렵지 않다.
아래와 같이 go 키워드로 함수를 실행하면 새 고루틴이 만들어진다.&lt;/p&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;go&quot;&gt;&lt;pre class=&quot;language-go&quot;&gt;&lt;code class=&quot;language-go&quot;&gt;&lt;span class=&quot;token keyword&quot;&gt;func&lt;/span&gt; &lt;span class=&quot;token function&quot;&gt;long&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;
	fmt&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;Println&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token string&quot;&gt;&quot;long 함수 시작&quot;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; time&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;Now&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;
	time&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;Sleep&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token number&quot;&gt;3&lt;/span&gt; &lt;span class=&quot;token operator&quot;&gt;*&lt;/span&gt; time&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;Second&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;
	fmt&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;Println&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token string&quot;&gt;&quot;long 함수 종료&quot;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; time&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;Now&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;
&lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;

&lt;span class=&quot;token keyword&quot;&gt;func&lt;/span&gt; &lt;span class=&quot;token function&quot;&gt;short&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;
	fmt&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;Println&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token string&quot;&gt;&quot;short 함수 시작&quot;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; time&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;Now&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;
	time&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;Sleep&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token number&quot;&gt;1&lt;/span&gt; &lt;span class=&quot;token operator&quot;&gt;*&lt;/span&gt; time&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;Second&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;
	fmt&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;Println&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token string&quot;&gt;&quot;short 함수 종료&quot;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; time&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;Now&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;
&lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;

&lt;span class=&quot;token keyword&quot;&gt;func&lt;/span&gt; &lt;span class=&quot;token function&quot;&gt;main&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;
	fmt&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;Println&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token string&quot;&gt;&quot;main 함수 시작: &quot;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; time&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;Now&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;

	&lt;span class=&quot;token keyword&quot;&gt;go&lt;/span&gt; &lt;span class=&quot;token function&quot;&gt;long&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;
	&lt;span class=&quot;token keyword&quot;&gt;go&lt;/span&gt; &lt;span class=&quot;token function&quot;&gt;short&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;

	time&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;Sleep&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token number&quot;&gt;5&lt;/span&gt; &lt;span class=&quot;token operator&quot;&gt;*&lt;/span&gt; time&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;Second&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;
	fmt&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;Println&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token string&quot;&gt;&quot;main 함수 종료: &quot;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; time&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;Now&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;
&lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;결과&lt;/p&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;text&quot;&gt;&lt;pre class=&quot;language-text&quot;&gt;&lt;code class=&quot;language-text&quot;&gt;main 함수 시작:  2022-03-01 21:12:30.7620499 +0900 KST m=+1.809606901
short 함수 시작 2022-03-01 21:12:30.847062 +0900 KST m=+1.894619001
long 함수 시작 2022-03-01 21:12:30.847062 +0900 KST m=+1.894619001
short 함수 종료 2022-03-01 21:12:31.8491954 +0900 KST m=+2.896752401
long 함수 종료 2022-03-01 21:12:33.8548548 +0900 KST m=+4.902411801
main 함수 종료:  2022-03-01 21:12:35.847659 +0900 KST m=+6.895216001&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;메인 함수 안에서 long과 short 함수는 go 키워드로 호출되고, 두 함수는 각각 새 고루틴을 생성하며 동시에 시작한다.
각 함수에서는 시작과 종료 시 메시지를 출력하게 하여 실행 시점과 종료 시점을 알 수 있게 했다.&lt;/p&gt;
&lt;p&gt;고루틴을 사용할 때 주의할 점이 있다. 실행 중인 고루틴이 있어도 메인 함수가 종료되면 프로그램이 종료된다.
그래서 아직 실행 중인 고루틴이 있다면 메인 함수가 종료되지 않게 해야 한다. 따라서 예시의 main 함수에서는 대기 시간을 잡아 놨다.
이와 같이 비정상적으로 종료되는 것을 막기 위해 메인 함수에서 충분히 긴 시간을 대기하는 것은 효율적이지 않다.
Go에서 제안하는 방법은 메인 함수에서 고루틴의 종료 시점을 확인할 수 있는 채널을 만들고, 만든 채널을 통해 종료 메시지를 대기시키는 것이다.&lt;/p&gt;
&lt;h2&gt;2. 채널(Channel)&lt;/h2&gt;
&lt;p&gt;&lt;code class=&quot;language-text&quot;&gt;채널(channel)&lt;/code&gt;은 고루틴끼리의 정보를 교환하고 실행의 흐름을 동기화하기 위해 사용된다.
채널은 일반 변수를 선언하는 것과 똑같이 선언하고, &lt;code class=&quot;language-text&quot;&gt;make()&lt;/code&gt; 함수로 생성한다.
채널을 정의할 때는 &lt;code class=&quot;language-text&quot;&gt;chan&lt;/code&gt; 키워드로 채널을 통해 주고받을 데이터의 타입을 지정해주어야 한다.&lt;/p&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;go&quot;&gt;&lt;pre class=&quot;language-go&quot;&gt;&lt;code class=&quot;language-go&quot;&gt;&lt;span class=&quot;token comment&quot;&gt;// 채널 변수 선언 후 make() 함수로 채널 생성&lt;/span&gt;
&lt;span class=&quot;token keyword&quot;&gt;var&lt;/span&gt; ch &lt;span class=&quot;token keyword&quot;&gt;chan&lt;/span&gt; &lt;span class=&quot;token builtin&quot;&gt;string&lt;/span&gt;
ch &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;token function&quot;&gt;make&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token keyword&quot;&gt;chan&lt;/span&gt; &lt;span class=&quot;token builtin&quot;&gt;string&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;

&lt;span class=&quot;token comment&quot;&gt;// make() 함수로 채널 생성 후 바로 변수에 할당&lt;/span&gt;
done &lt;span class=&quot;token operator&quot;&gt;:=&lt;/span&gt; &lt;span class=&quot;token function&quot;&gt;make&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token keyword&quot;&gt;chan&lt;/span&gt; &lt;span class=&quot;token builtin&quot;&gt;bool&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;채널을 정의할 때 지정한 데이터 타입만 채널을 통해 주고받을 수 있다. 타입에 상관없이 받으려면 &lt;code class=&quot;language-text&quot;&gt;chan interface{}&lt;/code&gt; 처럼 타입을 지정하면 된다.
채널로 값을 주고받을 때는 &lt;code class=&quot;language-text&quot;&gt;&amp;lt;-&lt;/code&gt; 연산자를 사용한다.
&lt;code class=&quot;language-text&quot;&gt;&amp;lt;-&lt;/code&gt; 를 채널 변수 오른쪽에 작성하면 채널에 값을 전송하고, &lt;code class=&quot;language-text&quot;&gt;&amp;lt;-&lt;/code&gt;를 채널 변수 왼쪽에 작성하면 채널로부터 값을 수신한다.
채널에 값을 전송하거나 수신할 때 채널이 준비되어 있지 않으면 준비될때 까지 대기한다.&lt;/p&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;go&quot;&gt;&lt;pre class=&quot;language-go&quot;&gt;&lt;code class=&quot;language-go&quot;&gt;ch &lt;span class=&quot;token operator&quot;&gt;&amp;lt;-&lt;/span&gt; &lt;span class=&quot;token string&quot;&gt;&quot;msg&quot;&lt;/span&gt; &lt;span class=&quot;token comment&quot;&gt;// ch 채널에 &quot;msg&quot; 전송&lt;/span&gt;
m &lt;span class=&quot;token operator&quot;&gt;:=&lt;/span&gt; &lt;span class=&quot;token operator&quot;&gt;&amp;lt;-&lt;/span&gt; ch  &lt;span class=&quot;token comment&quot;&gt;// ch 채널로부터 메시지 수신&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;고루틴 예시를 채널을 통해 아래와 같이 구현 가능하다.&lt;/p&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;go&quot;&gt;&lt;pre class=&quot;language-go&quot;&gt;&lt;code class=&quot;language-go&quot;&gt;&lt;span class=&quot;token keyword&quot;&gt;func&lt;/span&gt; &lt;span class=&quot;token function&quot;&gt;long&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;done &lt;span class=&quot;token keyword&quot;&gt;chan&lt;/span&gt; &lt;span class=&quot;token builtin&quot;&gt;bool&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;
	fmt&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;Println&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token string&quot;&gt;&quot;long 함수 시작&quot;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; time&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;Now&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;
	time&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;Sleep&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token number&quot;&gt;3&lt;/span&gt; &lt;span class=&quot;token operator&quot;&gt;*&lt;/span&gt; time&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;Second&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;
	fmt&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;Println&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token string&quot;&gt;&quot;long 함수 종료&quot;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; time&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;Now&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;
	done &lt;span class=&quot;token operator&quot;&gt;&amp;lt;-&lt;/span&gt; &lt;span class=&quot;token boolean&quot;&gt;true&lt;/span&gt;
&lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;

&lt;span class=&quot;token keyword&quot;&gt;func&lt;/span&gt; &lt;span class=&quot;token function&quot;&gt;short&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;done &lt;span class=&quot;token keyword&quot;&gt;chan&lt;/span&gt; &lt;span class=&quot;token builtin&quot;&gt;bool&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;
	fmt&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;Println&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token string&quot;&gt;&quot;short 함수 시작&quot;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; time&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;Now&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;
	time&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;Sleep&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token number&quot;&gt;1&lt;/span&gt; &lt;span class=&quot;token operator&quot;&gt;*&lt;/span&gt; time&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;Second&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;
	fmt&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;Println&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token string&quot;&gt;&quot;short 함수 종료&quot;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; time&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;Now&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;
	done &lt;span class=&quot;token operator&quot;&gt;&amp;lt;-&lt;/span&gt; &lt;span class=&quot;token boolean&quot;&gt;true&lt;/span&gt;
&lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;

&lt;span class=&quot;token keyword&quot;&gt;func&lt;/span&gt; &lt;span class=&quot;token function&quot;&gt;main&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;
	fmt&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;Println&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token string&quot;&gt;&quot;main 함수 시작: &quot;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; time&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;Now&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;

	done &lt;span class=&quot;token operator&quot;&gt;:=&lt;/span&gt; &lt;span class=&quot;token function&quot;&gt;make&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token keyword&quot;&gt;chan&lt;/span&gt; &lt;span class=&quot;token builtin&quot;&gt;bool&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;
	&lt;span class=&quot;token keyword&quot;&gt;go&lt;/span&gt; &lt;span class=&quot;token function&quot;&gt;long&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;done&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;
	&lt;span class=&quot;token keyword&quot;&gt;go&lt;/span&gt; &lt;span class=&quot;token function&quot;&gt;short&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;done&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;

	&lt;span class=&quot;token operator&quot;&gt;&amp;lt;-&lt;/span&gt;done
	&lt;span class=&quot;token operator&quot;&gt;&amp;lt;-&lt;/span&gt;done
	fmt&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;Println&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token string&quot;&gt;&quot;main 함수 종료: &quot;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; time&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;Now&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;
&lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;결과&lt;/p&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;text&quot;&gt;&lt;pre class=&quot;language-text&quot;&gt;&lt;code class=&quot;language-text&quot;&gt;main 함수 시작:  2022-03-01 21:12:30.7620499 +0900 KST m=+1.809606901
short 함수 시작 2022-03-01 21:12:30.847062 +0900 KST m=+1.894619001
long 함수 시작 2022-03-01 21:12:30.847062 +0900 KST m=+1.894619001
short 함수 종료 2022-03-01 21:12:31.8491954 +0900 KST m=+2.896752401
long 함수 종료 2022-03-01 21:12:33.8548548 +0900 KST m=+4.902411801
main 함수 종료:  2022-03-01 21:12:35.847659 +0900 KST m=+6.895216001&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;함수로 done 채널을 전달하고, 각 함수에서는 처리를 완료한 후 done 채널로 완료 메시지를 전달한다.
메인 함수에서는 done 채널로부터 메시지를 전달받고 프로그램을 종료한다.&lt;/p&gt;
&lt;h2&gt;3. 채널 방향&lt;/h2&gt;
&lt;p&gt;채널은 기본적으로 양방향 통신이 가능하다. 하나의 채널로 값을 송수신할 수 있지만, 실제로 채널을 구조체 필드로 사용하거나 함수의 매개변수로 전달하는 것이 일반적이다.
이때는 채널이 대부분 단방향으로만 사용된다. 채널을 단방향으로만 사용할때는 아래와 같이 방향을 지정해 사용할 수 있다.&lt;/p&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;go&quot;&gt;&lt;pre class=&quot;language-go&quot;&gt;&lt;code class=&quot;language-go&quot;&gt;&lt;span class=&quot;token keyword&quot;&gt;chan&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;&amp;lt;-&lt;/span&gt; &lt;span class=&quot;token builtin&quot;&gt;string&lt;/span&gt; &lt;span class=&quot;token comment&quot;&gt;// 송신 전용 채널&lt;/span&gt;
&lt;span class=&quot;token operator&quot;&gt;&amp;lt;-&lt;/span&gt;&lt;span class=&quot;token keyword&quot;&gt;chan&lt;/span&gt; &lt;span class=&quot;token builtin&quot;&gt;string&lt;/span&gt; &lt;span class=&quot;token comment&quot;&gt;// 수신 전용 채널&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;수신 전용 채널에 값을 전달하려고 하거나 송신 채널로부터 값을 수신하려고 하면 컴파일 오류가 발생한다.&lt;/p&gt;
&lt;h2&gt;4. 버퍼드 채널&lt;/h2&gt;
&lt;p&gt;채널은 지정한 크기의 버퍼를 가질 수 있다. 채널을 생성할 때 버퍼의 크기를 make의 두 번째 매개변수로 전달하면 버퍼드 채널(buffered channel)을 만들 수 있다.
버퍼드 채널은 비동기 방식으로 동작한다. 채널이 꽉 찰 때까지 채널로 메시지를 계속 전송할 수 있고, 채널이 빌 때까지 채널로부터 메시지를 계속 수신할 수 있다.&lt;/p&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;go&quot;&gt;&lt;pre class=&quot;language-go&quot;&gt;&lt;code class=&quot;language-go&quot;&gt;ch &lt;span class=&quot;token operator&quot;&gt;:=&lt;/span&gt; &lt;span class=&quot;token function&quot;&gt;make&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token keyword&quot;&gt;chan&lt;/span&gt; &lt;span class=&quot;token builtin&quot;&gt;int&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;token number&quot;&gt;100&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;아래 코드는 버퍼가 꽉 찼는데도 메시지를 계속 전송해서 다음과 같은 에러가 발생한다.&lt;/p&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;go&quot;&gt;&lt;pre class=&quot;language-go&quot;&gt;&lt;code class=&quot;language-go&quot;&gt;&lt;span class=&quot;token keyword&quot;&gt;package&lt;/span&gt; main

&lt;span class=&quot;token keyword&quot;&gt;import&lt;/span&gt; &lt;span class=&quot;token string&quot;&gt;&quot;fmt&quot;&lt;/span&gt;

&lt;span class=&quot;token keyword&quot;&gt;func&lt;/span&gt; &lt;span class=&quot;token function&quot;&gt;main&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;
	c &lt;span class=&quot;token operator&quot;&gt;:=&lt;/span&gt; &lt;span class=&quot;token function&quot;&gt;make&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token keyword&quot;&gt;chan&lt;/span&gt; &lt;span class=&quot;token builtin&quot;&gt;int&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;token number&quot;&gt;2&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;
	c &lt;span class=&quot;token operator&quot;&gt;&amp;lt;-&lt;/span&gt; &lt;span class=&quot;token number&quot;&gt;1&lt;/span&gt;
	c &lt;span class=&quot;token operator&quot;&gt;&amp;lt;-&lt;/span&gt; &lt;span class=&quot;token number&quot;&gt;2&lt;/span&gt;
	c &lt;span class=&quot;token operator&quot;&gt;&amp;lt;-&lt;/span&gt; &lt;span class=&quot;token number&quot;&gt;3&lt;/span&gt;
	fmt&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;Println&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;&amp;lt;-&lt;/span&gt;c&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;
	fmt&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;Println&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;&amp;lt;-&lt;/span&gt;c&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;
	fmt&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;Println&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;&amp;lt;-&lt;/span&gt;c&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;
&lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;text&quot;&gt;&lt;pre class=&quot;language-text&quot;&gt;&lt;code class=&quot;language-text&quot;&gt;fatal error: all goroutines are asleep - deadlock!&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;코드를 다음과 같이 수정하면 고루틴에서 채널 c에 전송할 수 있을 때까지 대기하다가, 첫 번째 값을 수신해가는 즉시 바로 채널에 값을 전송한다.&lt;/p&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;go&quot;&gt;&lt;pre class=&quot;language-go&quot;&gt;&lt;code class=&quot;language-go&quot;&gt;&lt;span class=&quot;token keyword&quot;&gt;package&lt;/span&gt; main

&lt;span class=&quot;token keyword&quot;&gt;import&lt;/span&gt; &lt;span class=&quot;token string&quot;&gt;&quot;fmt&quot;&lt;/span&gt;

&lt;span class=&quot;token keyword&quot;&gt;func&lt;/span&gt; &lt;span class=&quot;token function&quot;&gt;main&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;
	c &lt;span class=&quot;token operator&quot;&gt;:=&lt;/span&gt; &lt;span class=&quot;token function&quot;&gt;make&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token keyword&quot;&gt;chan&lt;/span&gt; &lt;span class=&quot;token builtin&quot;&gt;int&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;token number&quot;&gt;2&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;
	c &lt;span class=&quot;token operator&quot;&gt;&amp;lt;-&lt;/span&gt; &lt;span class=&quot;token number&quot;&gt;1&lt;/span&gt;
	c &lt;span class=&quot;token operator&quot;&gt;&amp;lt;-&lt;/span&gt; &lt;span class=&quot;token number&quot;&gt;2&lt;/span&gt;
	&lt;span class=&quot;token keyword&quot;&gt;go&lt;/span&gt; &lt;span class=&quot;token keyword&quot;&gt;func&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt; c &lt;span class=&quot;token operator&quot;&gt;&amp;lt;-&lt;/span&gt; &lt;span class=&quot;token number&quot;&gt;3&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;
	fmt&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;Println&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;&amp;lt;-&lt;/span&gt;c&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;
	fmt&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;Println&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;&amp;lt;-&lt;/span&gt;c&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;
	fmt&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;Println&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;&amp;lt;-&lt;/span&gt;c&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;
&lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;h2&gt;5. close &amp;#x26; range&lt;/h2&gt;
&lt;p&gt;채널에 더 이상 전송할 값이 없으면 &lt;code class=&quot;language-text&quot;&gt;close(ch)&lt;/code&gt;를 사용해서 채널을 닫을 수 있다. 채널을 닫은 후 메시지를 전송하면 에러가 발생한다.
채널의 수신자는 채널에서 값을 읽을 때 채널이 닫힌 상태인지 아닌지는 두 번째 매개변수로 확인 가능하다.&lt;/p&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;go&quot;&gt;&lt;pre class=&quot;language-go&quot;&gt;&lt;code class=&quot;language-go&quot;&gt;v&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; ok &lt;span class=&quot;token operator&quot;&gt;:=&lt;/span&gt; &lt;span class=&quot;token operator&quot;&gt;&amp;lt;-&lt;/span&gt;ch&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;ok의 값이 false라면 채널에 더 수신할 값이 없고 채널이 닫힌 상태이다.
&lt;code class=&quot;language-text&quot;&gt;for i := range c&lt;/code&gt; 는 채널 c가 닫힐 때까지 반복하여 채널로부터 수신을 시도한다.
채널을 꼭 닫을 필요는 없지만, range 루프를 돌며 채널에 수신할 값이 없는 것을 알아야 할 때는 채널을 닫아주면 된다.&lt;/p&gt;
&lt;h2&gt;6. select&lt;/h2&gt;
&lt;p&gt;select는 하나의 고루틴이 여러 채널과 통신할 때 사용한다. case로 여러 채널을 대기시키고 있다가 실행 가능한 상태가 되면 해당 케이스를 수행한다.
select 문에서 default 케이스는 case에 지정된 모든 채널이 사용 가능 상태가 아닐 때 수행한다.
default 케이스는 select 문에서 case의 채널들이 사용 가능 상태가 아닐 때 대기하지 않고 바로 무언가를 처리할 때 사용한다.&lt;/p&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;go&quot;&gt;&lt;pre class=&quot;language-go&quot;&gt;&lt;code class=&quot;language-go&quot;&gt;&lt;span class=&quot;token keyword&quot;&gt;func&lt;/span&gt; &lt;span class=&quot;token function&quot;&gt;fibonacci&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;c&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; quit &lt;span class=&quot;token keyword&quot;&gt;chan&lt;/span&gt; &lt;span class=&quot;token builtin&quot;&gt;int&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;
	x&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; y &lt;span class=&quot;token operator&quot;&gt;:=&lt;/span&gt; &lt;span class=&quot;token number&quot;&gt;0&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;token number&quot;&gt;1&lt;/span&gt;
	&lt;span class=&quot;token keyword&quot;&gt;for&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;
		&lt;span class=&quot;token keyword&quot;&gt;select&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;
		&lt;span class=&quot;token keyword&quot;&gt;case&lt;/span&gt; c &lt;span class=&quot;token operator&quot;&gt;&amp;lt;-&lt;/span&gt; x&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt;
			x&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; y &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; y&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; x&lt;span class=&quot;token operator&quot;&gt;+&lt;/span&gt;y
		&lt;span class=&quot;token keyword&quot;&gt;case&lt;/span&gt; &lt;span class=&quot;token operator&quot;&gt;&amp;lt;-&lt;/span&gt;quit&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt;
			fmt&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;Println&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token string&quot;&gt;&quot;quit&quot;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;
			&lt;span class=&quot;token keyword&quot;&gt;return&lt;/span&gt;
		&lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;
	&lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;

&lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;

&lt;span class=&quot;token keyword&quot;&gt;func&lt;/span&gt; &lt;span class=&quot;token function&quot;&gt;main&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;
	c &lt;span class=&quot;token operator&quot;&gt;:=&lt;/span&gt; &lt;span class=&quot;token function&quot;&gt;make&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token keyword&quot;&gt;chan&lt;/span&gt; &lt;span class=&quot;token builtin&quot;&gt;int&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;
	quit &lt;span class=&quot;token operator&quot;&gt;:=&lt;/span&gt; &lt;span class=&quot;token function&quot;&gt;make&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token keyword&quot;&gt;chan&lt;/span&gt; &lt;span class=&quot;token builtin&quot;&gt;int&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;
	&lt;span class=&quot;token keyword&quot;&gt;go&lt;/span&gt; &lt;span class=&quot;token keyword&quot;&gt;func&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;
		&lt;span class=&quot;token keyword&quot;&gt;for&lt;/span&gt; i &lt;span class=&quot;token operator&quot;&gt;:=&lt;/span&gt; &lt;span class=&quot;token number&quot;&gt;0&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt; i &lt;span class=&quot;token operator&quot;&gt;&amp;lt;&lt;/span&gt; &lt;span class=&quot;token number&quot;&gt;10&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt; i&lt;span class=&quot;token operator&quot;&gt;++&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;
			fmt&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;Println&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;&amp;lt;-&lt;/span&gt;c&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;
		&lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;
		quit &lt;span class=&quot;token operator&quot;&gt;&amp;lt;-&lt;/span&gt; &lt;span class=&quot;token number&quot;&gt;0&lt;/span&gt;
	&lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;
	&lt;span class=&quot;token function&quot;&gt;fibonacci&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;c&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; quit&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;
&lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;고루틴과 채널은 기본적으로 동기식으로 동작하는 go언어에서 비동기 동작을 지원하는 아주 좋은 도구이다.
사용법도 간편하고 다른 저수준 제어에 비해 제어도 쉽다.&lt;/p&gt;</content:encoded></item><item><title><![CDATA[[Go 언어 문법 정리] 01. 기초 문법]]></title><description><![CDATA[Go 언어 웹 프로그래밍 철저 입문 책으로 공부하면서 개인적으로 알아두면 좋은 문법 몇 가지를 정리해보려 한다.
매우 기초적인 문법까지는 너무 양이 많을 것 같아 제외하였고, 내 기준 신기한 문법만 정리해보았다. 1. 레이블 레이블이란 c…]]></description><link>https://github.com/SiverPineValley/SiverPineValley.github.io/golang/basic_grammer/</link><guid isPermaLink="false">https://github.com/SiverPineValley/SiverPineValley.github.io/golang/basic_grammer/</guid><pubDate>Tue, 01 Mar 2022 21:02:17 GMT</pubDate><content:encoded>&lt;div align=&quot;left&quot;&gt;
  &lt;span class=&quot;gatsby-resp-image-wrapper&quot; style=&quot;position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 270px; &quot;&gt;
      &lt;a class=&quot;gatsby-resp-image-link&quot; href=&quot;/static/af10eacea0e905574b1544533737f61a/6f81f/golang_book.jpg&quot; style=&quot;display: block&quot; target=&quot;_blank&quot; rel=&quot;noopener&quot;&gt;
    &lt;span class=&quot;gatsby-resp-image-background-image&quot; style=&quot;padding-bottom: 148.1012658227848%; position: relative; bottom: 0; left: 0; background-image: url(&apos;data:image/jpeg;base64,/9j/2wBDABALDA4MChAODQ4SERATGCgaGBYWGDEjJR0oOjM9PDkzODdASFxOQERXRTc4UG1RV19iZ2hnPk1xeXBkeFxlZ2P/2wBDARESEhgVGC8aGi9jQjhCY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2P/wgARCAAeABQDASIAAhEBAxEB/8QAGQAAAgMBAAAAAAAAAAAAAAAAAAUBAwQC/8QAFwEAAwEAAAAAAAAAAAAAAAAAAAEDAv/aAAwDAQACEAMQAAABdKdNqr2WhNewxbjcEDn/AP/EABsQAQACAwEBAAAAAAAAAAAAAAIBAwAREgQT/9oACAEBAAEFAp3ED0rVS7D9CKLq3GR87bKxAJyqoCzrOs//xAAbEQADAAIDAAAAAAAAAAAAAAAAAQIREiEiMf/aAAgBAwEBPwGLlLlFel656jP/xAAVEQEBAAAAAAAAAAAAAAAAAAAQAf/aAAgBAgEBPwEh/8QAHRAAAgMAAgMAAAAAAAAAAAAAAAECETEQcRIhIv/aAAgBAQAGPwJsed0WyS+fTPClb1UZhKpTsSQ+xyV8/wD/xAAfEAEBAQABAwUAAAAAAAAAAAABEQAhMVFhQXGBobH/2gAIAQEAAT8hlnMKGSCHn2t06eUoS4oei5HLqHjK6ZAAoBpyjz4+NQhnfrv0ZGePEdB30Fv1v//aAAwDAQACAAMAAAAQc/o9/8QAGREBAQADAQAAAAAAAAAAAAAAAQARITFR/9oACAEDAQE/EERm5IWmonxtnN//xAAZEQEAAgMAAAAAAAAAAAAAAAABADEQEUH/2gAIAQIBAT8QRahU27j/xAAfEAEBAAMAAgIDAAAAAAAAAAABEQAhMUFhEFFxgaH/2gAIAQEAAT8QQNCwHg5jFlD0E3u/Ot4I0AEoj0MBOEKnUHc/ODWVB9hdRwNMwRADJ/qiILl/jzixg1u/X38JQWMAQphMfszKIdaRNe99z//Z&apos;); background-size: cover; display: block;&quot;&gt;&lt;/span&gt;
  &lt;img class=&quot;gatsby-resp-image-image&quot; alt=&quot;golang book&quot; title=&quot;&quot; src=&quot;/static/af10eacea0e905574b1544533737f61a/6f81f/golang_book.jpg&quot; srcset=&quot;/static/af10eacea0e905574b1544533737f61a/ff44c/golang_book.jpg 158w,
/static/af10eacea0e905574b1544533737f61a/6f81f/golang_book.jpg 270w&quot; sizes=&quot;(max-width: 270px) 100vw, 270px&quot; style=&quot;width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;&quot; loading=&quot;lazy&quot; decoding=&quot;async&quot;&gt;
  &lt;/a&gt;
    &lt;/span&gt;
&lt;/div&gt;
&lt;p&gt;Go 언어 웹 프로그래밍 철저 입문 책으로 공부하면서 개인적으로 알아두면 좋은 문법 몇 가지를 정리해보려 한다.
매우 기초적인 문법까지는 너무 양이 많을 것 같아 제외하였고, 내 기준 신기한 문법만 정리해보았다.&lt;/p&gt;
&lt;/br&gt;
&lt;h2&gt;1. 레이블&lt;/h2&gt;
&lt;p&gt;레이블이란 c 언어의 레이블과 유사하면서도 조금 다르게도 사용 가능한 문법이다.
아래 두 예시와 같이 대문자 + 콜론(:)의 형태로 레이블을 명시할 수 있다.
레이블의 역할은 특정 소스 구역을 명시적으로 지칭할 수 있고,  &lt;code class=&quot;language-text&quot;&gt;goto&lt;/code&gt; 문을 사용하여 해당 레이블 구역이 즉시 실행 가능하다.
go 언어에서는 추가적으로 아래와 같이 사용이 가능한데, 특정 for문 앞에 레이블을 명시하면, 해당 for문에 대한 레이블로 인식한다.
아래와 같이 &lt;code class=&quot;language-text&quot;&gt;break&lt;/code&gt;, &lt;code class=&quot;language-text&quot;&gt;continue&lt;/code&gt;에 명시적으로 표시가 가능하다.&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;예시1&lt;/li&gt;
&lt;/ul&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;go&quot;&gt;&lt;pre class=&quot;language-go&quot;&gt;&lt;code class=&quot;language-go&quot;&gt;&lt;span class=&quot;token keyword&quot;&gt;func&lt;/span&gt; &lt;span class=&quot;token function&quot;&gt;useLable1&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;
	x &lt;span class=&quot;token operator&quot;&gt;:=&lt;/span&gt; &lt;span class=&quot;token number&quot;&gt;7&lt;/span&gt;
	table &lt;span class=&quot;token operator&quot;&gt;:=&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;[&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;]&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;[&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;]&lt;/span&gt;&lt;span class=&quot;token builtin&quot;&gt;int&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;&lt;span class=&quot;token number&quot;&gt;1&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;token number&quot;&gt;5&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;token number&quot;&gt;9&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;&lt;span class=&quot;token number&quot;&gt;2&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;token number&quot;&gt;6&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;token number&quot;&gt;5&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;token number&quot;&gt;13&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;&lt;span class=&quot;token number&quot;&gt;5&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;token number&quot;&gt;3&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;token number&quot;&gt;7&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;token number&quot;&gt;5&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;

LOOP&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt;
	&lt;span class=&quot;token keyword&quot;&gt;for&lt;/span&gt; row&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; rowValue &lt;span class=&quot;token operator&quot;&gt;:=&lt;/span&gt; &lt;span class=&quot;token keyword&quot;&gt;range&lt;/span&gt; table &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;
		&lt;span class=&quot;token keyword&quot;&gt;for&lt;/span&gt; col&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; colValue &lt;span class=&quot;token operator&quot;&gt;:=&lt;/span&gt; &lt;span class=&quot;token keyword&quot;&gt;range&lt;/span&gt; rowValue &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;
			&lt;span class=&quot;token keyword&quot;&gt;if&lt;/span&gt; colValue &lt;span class=&quot;token operator&quot;&gt;==&lt;/span&gt; x &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;
				fmt&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;Printf&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token string&quot;&gt;&quot;found %d(row:%d, col:%d)\n&quot;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; x&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; row&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; col&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;
				&lt;span class=&quot;token keyword&quot;&gt;break&lt;/span&gt; LOOP
			&lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;
		&lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;
	&lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;
&lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;결과&lt;/p&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;text&quot;&gt;&lt;pre class=&quot;language-text&quot;&gt;&lt;code class=&quot;language-text&quot;&gt;found 7(row:2, col:2)&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;/br&gt;
&lt;ul&gt;
&lt;li&gt;예시2&lt;/li&gt;
&lt;/ul&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;go&quot;&gt;&lt;pre class=&quot;language-go&quot;&gt;&lt;code class=&quot;language-go&quot;&gt;&lt;span class=&quot;token keyword&quot;&gt;func&lt;/span&gt; &lt;span class=&quot;token function&quot;&gt;useLable2&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;
	x &lt;span class=&quot;token operator&quot;&gt;:=&lt;/span&gt; &lt;span class=&quot;token number&quot;&gt;5&lt;/span&gt;
	table &lt;span class=&quot;token operator&quot;&gt;:=&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;[&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;]&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;[&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;]&lt;/span&gt;&lt;span class=&quot;token builtin&quot;&gt;int&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;&lt;span class=&quot;token number&quot;&gt;1&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;token number&quot;&gt;5&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;token number&quot;&gt;9&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;&lt;span class=&quot;token number&quot;&gt;2&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;token number&quot;&gt;6&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;token number&quot;&gt;5&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;token number&quot;&gt;13&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;&lt;span class=&quot;token number&quot;&gt;5&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;token number&quot;&gt;3&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;token number&quot;&gt;7&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;token number&quot;&gt;4&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;

LOOPCONTINUE&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt;
	&lt;span class=&quot;token keyword&quot;&gt;for&lt;/span&gt; row&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; rowValue &lt;span class=&quot;token operator&quot;&gt;:=&lt;/span&gt; &lt;span class=&quot;token keyword&quot;&gt;range&lt;/span&gt; table &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;
		&lt;span class=&quot;token keyword&quot;&gt;for&lt;/span&gt; col&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; colValue &lt;span class=&quot;token operator&quot;&gt;:=&lt;/span&gt; &lt;span class=&quot;token keyword&quot;&gt;range&lt;/span&gt; rowValue &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;
			&lt;span class=&quot;token keyword&quot;&gt;if&lt;/span&gt; colValue &lt;span class=&quot;token operator&quot;&gt;==&lt;/span&gt; x &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;
				fmt&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;Printf&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token string&quot;&gt;&quot;found %d(row:%d, col:%d)\n&quot;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; x&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; row&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; col&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;
				&lt;span class=&quot;token keyword&quot;&gt;continue&lt;/span&gt; LOOPCONTINUE
			&lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;
		&lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;
	&lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;
&lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;결과&lt;/p&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;text&quot;&gt;&lt;pre class=&quot;language-text&quot;&gt;&lt;code class=&quot;language-text&quot;&gt;found 5(row:0, col:1)
found 5(row:1, col:2)
found 5(row:2, col:0)&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;h2&gt;2. 가변 매개변수&lt;/h2&gt;
&lt;p&gt;가변 매개변수란 매개변수의 개수가 정해져 있지 않고 유동적으로 개수가 변할 때 사용 가능한 문법이다.
아래와 같이 매개변후 타입 앞에 생략 부호(...)를 붙여서 인식 가능하다.&lt;/p&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;go&quot;&gt;&lt;pre class=&quot;language-go&quot;&gt;&lt;code class=&quot;language-go&quot;&gt;&lt;span class=&quot;token keyword&quot;&gt;func&lt;/span&gt; &lt;span class=&quot;token function&quot;&gt;multiParams&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;strings &lt;span class=&quot;token operator&quot;&gt;...&lt;/span&gt;&lt;span class=&quot;token builtin&quot;&gt;string&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;
	&lt;span class=&quot;token keyword&quot;&gt;for&lt;/span&gt; i &lt;span class=&quot;token operator&quot;&gt;:=&lt;/span&gt; &lt;span class=&quot;token number&quot;&gt;0&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt; i &lt;span class=&quot;token operator&quot;&gt;&amp;lt;&lt;/span&gt; &lt;span class=&quot;token function&quot;&gt;len&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;strings&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt; i&lt;span class=&quot;token operator&quot;&gt;++&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;
		fmt&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;Printf&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;strings&lt;span class=&quot;token punctuation&quot;&gt;[&lt;/span&gt;i&lt;span class=&quot;token punctuation&quot;&gt;]&lt;/span&gt; &lt;span class=&quot;token operator&quot;&gt;+&lt;/span&gt; &lt;span class=&quot;token string&quot;&gt;&quot; &quot;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;
	&lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;
&lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;

&lt;span class=&quot;token keyword&quot;&gt;func&lt;/span&gt; &lt;span class=&quot;token function&quot;&gt;main&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;
    &lt;span class=&quot;token function&quot;&gt;multiParams&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token string&quot;&gt;&quot;Variable&quot;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;token string&quot;&gt;&quot;Params&quot;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;token string&quot;&gt;&quot;example&quot;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;
&lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;결과&lt;/p&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;text&quot;&gt;&lt;pre class=&quot;language-text&quot;&gt;&lt;code class=&quot;language-text&quot;&gt;Variable Params example&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;h2&gt;3. Call by Value, Call by Reference&lt;/h2&gt;
&lt;p&gt;매우 익숙한 용어들이다. Call by Value란 값에 의한 호출. 즉, 전달받은 인자를 복사하여 함수 내에서 사용하는 방식이다. 따라서 함수에 입력된 원본 변수에 영향이 가지 않는다.
Call by Reference란 참조에 의한 호출. 즉, 전달받은 인자의 주소 값을 직접 참조하여 직접 원본 값에 영향을 준다.
Golang은 기본적으로 Call by Value를 지원한다. C언어의 포인터를 지칭하는 *(아스테리크)를 사용하면 Call by Reference로도 사용 가능하다.&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;예시1&lt;/li&gt;
&lt;/ul&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;go&quot;&gt;&lt;pre class=&quot;language-go&quot;&gt;&lt;code class=&quot;language-go&quot;&gt;&lt;span class=&quot;token comment&quot;&gt;// Call by value&lt;/span&gt;
&lt;span class=&quot;token keyword&quot;&gt;func&lt;/span&gt; &lt;span class=&quot;token function&quot;&gt;callbyValue&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;i &lt;span class=&quot;token builtin&quot;&gt;int&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;
	i &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; i &lt;span class=&quot;token operator&quot;&gt;+&lt;/span&gt; &lt;span class=&quot;token number&quot;&gt;1&lt;/span&gt;
&lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;

&lt;span class=&quot;token keyword&quot;&gt;func&lt;/span&gt; &lt;span class=&quot;token function&quot;&gt;main&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;
    &lt;span class=&quot;token keyword&quot;&gt;var&lt;/span&gt; i &lt;span class=&quot;token builtin&quot;&gt;int&lt;/span&gt; &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;token number&quot;&gt;1&lt;/span&gt;
	&lt;span class=&quot;token function&quot;&gt;callbyValue&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;i&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;
	fmt&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;Println&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token string&quot;&gt;&quot;Call by Value: &quot;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; i&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;
&lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;결과&lt;/p&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;text&quot;&gt;&lt;pre class=&quot;language-text&quot;&gt;&lt;code class=&quot;language-text&quot;&gt;Call by Value: 1&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;/br&gt;
&lt;ul&gt;
&lt;li&gt;예시2&lt;/li&gt;
&lt;/ul&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;go&quot;&gt;&lt;pre class=&quot;language-go&quot;&gt;&lt;code class=&quot;language-go&quot;&gt;&lt;span class=&quot;token comment&quot;&gt;// Call by reference&lt;/span&gt;
&lt;span class=&quot;token keyword&quot;&gt;func&lt;/span&gt; &lt;span class=&quot;token function&quot;&gt;callbyReference&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;i &lt;span class=&quot;token operator&quot;&gt;*&lt;/span&gt;&lt;span class=&quot;token builtin&quot;&gt;int&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;
	&lt;span class=&quot;token operator&quot;&gt;*&lt;/span&gt;i &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;token operator&quot;&gt;*&lt;/span&gt;i &lt;span class=&quot;token operator&quot;&gt;+&lt;/span&gt; &lt;span class=&quot;token number&quot;&gt;1&lt;/span&gt;
&lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;

&lt;span class=&quot;token keyword&quot;&gt;func&lt;/span&gt; &lt;span class=&quot;token function&quot;&gt;main&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;
    &lt;span class=&quot;token keyword&quot;&gt;var&lt;/span&gt; i &lt;span class=&quot;token builtin&quot;&gt;int&lt;/span&gt; &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;token number&quot;&gt;1&lt;/span&gt;
    &lt;span class=&quot;token function&quot;&gt;callbyReference&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;&amp;amp;&lt;/span&gt;i&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;
    fmt&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;Println&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token string&quot;&gt;&quot;Call by Rererence: &quot;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; i&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;
&lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;결과&lt;/p&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;text&quot;&gt;&lt;pre class=&quot;language-text&quot;&gt;&lt;code class=&quot;language-text&quot;&gt;Call by Rererence: 2&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;h2&gt;4. defer&lt;/h2&gt;
&lt;p&gt;&lt;code class=&quot;language-text&quot;&gt;defer&lt;/code&gt; 키워드는 함수가 종료되기 전까지 특정 구문의 실행을 지연시켰다가, 함수가 종료되기 직전에 지연시켰던 구문을 수행한다. Java나 C#의 &lt;code class=&quot;language-text&quot;&gt;final&lt;/code&gt;같은 개념이다.
주로, 리소스를 해제시키거나 클렌징 작업이 필요할 때 사용한다.
아래 예시와 같이, &lt;code class=&quot;language-text&quot;&gt;b()&lt;/code&gt; 함수가 호출되었을 때, &lt;code class=&quot;language-text&quot;&gt;leave(enter(&quot;b&quot;))&lt;/code&gt;가 defer로 처리되고 &lt;code class=&quot;language-text&quot;&gt;a()&lt;/code&gt;를 호출하도록 되어 있다.
&lt;code class=&quot;language-text&quot;&gt;a()&lt;/code&gt; 내에서는 마찬가지로 &lt;code class=&quot;language-text&quot;&gt;leave(enter(&quot;a&quot;))&lt;/code&gt;가 defer로 처리된다.
&lt;code class=&quot;language-text&quot;&gt;defer&lt;/code&gt;로 처리되는 함수는 leave() 함수에 명시적으로 지정되어 있으므로, &lt;code class=&quot;language-text&quot;&gt;enter()&lt;/code&gt; 함수는 먼저 실행된다.
따라서 &lt;code class=&quot;language-text&quot;&gt;enter()&lt;/code&gt;에 대한 결과가 먼저 출력되며, 차례로 출력 함수, a함수가 호출되어 아래와 같은 결과가 출력되게 된다.&lt;/p&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;go&quot;&gt;&lt;pre class=&quot;language-go&quot;&gt;&lt;code class=&quot;language-go&quot;&gt;&lt;span class=&quot;token keyword&quot;&gt;func&lt;/span&gt; &lt;span class=&quot;token function&quot;&gt;enter&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;s &lt;span class=&quot;token builtin&quot;&gt;string&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;token builtin&quot;&gt;string&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;
	fmt&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;Println&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token string&quot;&gt;&quot;entering: &quot;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; s&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;
	&lt;span class=&quot;token keyword&quot;&gt;return&lt;/span&gt; s
&lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;

&lt;span class=&quot;token keyword&quot;&gt;func&lt;/span&gt; &lt;span class=&quot;token function&quot;&gt;leave&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;s &lt;span class=&quot;token builtin&quot;&gt;string&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;
	fmt&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;Println&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token string&quot;&gt;&quot;leaving: &quot;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; s&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;
&lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;

&lt;span class=&quot;token keyword&quot;&gt;func&lt;/span&gt; &lt;span class=&quot;token function&quot;&gt;a&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;
	&lt;span class=&quot;token keyword&quot;&gt;defer&lt;/span&gt; &lt;span class=&quot;token function&quot;&gt;leave&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;enter&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token string&quot;&gt;&quot;a&quot;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;
	fmt&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;Println&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token string&quot;&gt;&quot;in a&quot;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;
&lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;

&lt;span class=&quot;token keyword&quot;&gt;func&lt;/span&gt; &lt;span class=&quot;token function&quot;&gt;b&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;
	&lt;span class=&quot;token keyword&quot;&gt;defer&lt;/span&gt; &lt;span class=&quot;token function&quot;&gt;leave&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;enter&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token string&quot;&gt;&quot;b&quot;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;
	fmt&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;Println&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token string&quot;&gt;&quot;in b&quot;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;
	&lt;span class=&quot;token function&quot;&gt;a&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;
&lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;

&lt;span class=&quot;token keyword&quot;&gt;func&lt;/span&gt; &lt;span class=&quot;token function&quot;&gt;main&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;
    &lt;span class=&quot;token function&quot;&gt;b&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;
&lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;결과&lt;/p&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;text&quot;&gt;&lt;pre class=&quot;language-text&quot;&gt;&lt;code class=&quot;language-text&quot;&gt;entering:  b
in b
entering:  a
in a
leaving:  a
leaving:  b&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;h2&gt;5. Closure&lt;/h2&gt;
&lt;p&gt;클로저란 익명 함수로서 변수의 지정되어 일급 객체로 사용되는 경우의 익명 함수를 의미한다.
특정 변수에 선언될 수도 있으며, 특정 함수의 리턴되는 값 자체가 이러한 클로저일 수도 있다.
클로저는 선언될 때 현재 범위에 있는 변수의 값을 캡처하고, 호출될 때 캡쳐한 값을 사용한다.
클로저가 호출될 때 내부에서 사용하는 변수에 접근할 수 없더라도 선언 시점을 기준으로 해당 변수를 사용한다.&lt;/p&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;go&quot;&gt;&lt;pre class=&quot;language-go&quot;&gt;&lt;code class=&quot;language-go&quot;&gt;&lt;span class=&quot;token comment&quot;&gt;// Closure Example&lt;/span&gt;
&lt;span class=&quot;token keyword&quot;&gt;func&lt;/span&gt; &lt;span class=&quot;token function&quot;&gt;makeSuffix&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;suffix &lt;span class=&quot;token builtin&quot;&gt;string&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;token keyword&quot;&gt;func&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token builtin&quot;&gt;string&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;token builtin&quot;&gt;string&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;
	&lt;span class=&quot;token keyword&quot;&gt;return&lt;/span&gt; &lt;span class=&quot;token keyword&quot;&gt;func&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;name &lt;span class=&quot;token builtin&quot;&gt;string&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;token builtin&quot;&gt;string&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;
		&lt;span class=&quot;token keyword&quot;&gt;if&lt;/span&gt; &lt;span class=&quot;token operator&quot;&gt;!&lt;/span&gt;strings&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;HasSuffix&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;name&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; suffix&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;
			&lt;span class=&quot;token keyword&quot;&gt;return&lt;/span&gt; name &lt;span class=&quot;token operator&quot;&gt;+&lt;/span&gt; suffix
		&lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;
		&lt;span class=&quot;token keyword&quot;&gt;return&lt;/span&gt; name
	&lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;
&lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;

&lt;span class=&quot;token keyword&quot;&gt;func&lt;/span&gt; &lt;span class=&quot;token function&quot;&gt;closureConst&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;value &lt;span class=&quot;token builtin&quot;&gt;int&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;token builtin&quot;&gt;string&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;
	mappingTable &lt;span class=&quot;token operator&quot;&gt;:=&lt;/span&gt; &lt;span class=&quot;token keyword&quot;&gt;map&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;[&lt;/span&gt;&lt;span class=&quot;token builtin&quot;&gt;int&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;]&lt;/span&gt;&lt;span class=&quot;token builtin&quot;&gt;string&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;
		&lt;span class=&quot;token number&quot;&gt;0&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;token string&quot;&gt;&quot;SKT&quot;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt;
		&lt;span class=&quot;token number&quot;&gt;1&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;token string&quot;&gt;&quot;LG U+&quot;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt;
		&lt;span class=&quot;token number&quot;&gt;2&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;token string&quot;&gt;&quot;KT&quot;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt;
		&lt;span class=&quot;token number&quot;&gt;3&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;token string&quot;&gt;&quot;알뜰 SKT&quot;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt;
		&lt;span class=&quot;token number&quot;&gt;4&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;token string&quot;&gt;&quot;알뜰 LG U+&quot;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt;
		&lt;span class=&quot;token number&quot;&gt;5&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;token string&quot;&gt;&quot;알뜰 KT&quot;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt;
		&lt;span class=&quot;token number&quot;&gt;6&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;token string&quot;&gt;&quot;없음&quot;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt;
	&lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;

	&lt;span class=&quot;token keyword&quot;&gt;if&lt;/span&gt; value &lt;span class=&quot;token operator&quot;&gt;&gt;&lt;/span&gt; &lt;span class=&quot;token number&quot;&gt;6&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;
		value &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;token number&quot;&gt;6&lt;/span&gt;
	&lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;

	&lt;span class=&quot;token keyword&quot;&gt;return&lt;/span&gt; mappingTable&lt;span class=&quot;token punctuation&quot;&gt;[&lt;/span&gt;value&lt;span class=&quot;token punctuation&quot;&gt;]&lt;/span&gt;
&lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;

&lt;span class=&quot;token keyword&quot;&gt;func&lt;/span&gt; &lt;span class=&quot;token function&quot;&gt;main&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;
    addZip &lt;span class=&quot;token operator&quot;&gt;:=&lt;/span&gt; &lt;span class=&quot;token function&quot;&gt;makeSuffix&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token string&quot;&gt;&quot;.zip&quot;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;
	addTgz &lt;span class=&quot;token operator&quot;&gt;:=&lt;/span&gt; &lt;span class=&quot;token function&quot;&gt;makeSuffix&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token string&quot;&gt;&quot;.tar.gz&quot;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;
	fmt&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;Println&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;addTgz&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token string&quot;&gt;&quot;go1.5.1.src&quot;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;
	fmt&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;Println&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;addZip&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token string&quot;&gt;&quot;go1.5.1.windows-amd64&quot;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;
	fmt&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;Println&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;closureConst&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token number&quot;&gt;0&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;
	fmt&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;Println&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;closureConst&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token number&quot;&gt;4&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;
	fmt&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;Println&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;closureConst&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token number&quot;&gt;12&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;
&lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;결과&lt;/p&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;text&quot;&gt;&lt;pre class=&quot;language-text&quot;&gt;&lt;code class=&quot;language-text&quot;&gt;go1.5.1.src.tar.gz
go1.5.1.windows-amd64.zip
SKT
알뜰 LG U+
없음&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;</content:encoded></item><item><title><![CDATA[[프로그래머스 연습문제] BFS, DFS]]></title><description><![CDATA[오랜만에 DFS, BFS 문제들을 풀어보았다.
주로 DFS 기법을 자주 사용하여 풀었다. [Level 2] 타겟 넘버 DFS, BFS 문제 중 간단한 편에 속하는 문제이다. Queue를 사용하였고, 노드별 가지가…]]></description><link>https://github.com/SiverPineValley/SiverPineValley.github.io/algorithm/programmers_dfs,bfs/</link><guid isPermaLink="false">https://github.com/SiverPineValley/SiverPineValley.github.io/algorithm/programmers_dfs,bfs/</guid><pubDate>Tue, 01 Mar 2022 20:03:17 GMT</pubDate><content:encoded>&lt;p&gt;오랜만에 DFS, BFS 문제들을 풀어보았다.
주로 DFS 기법을 자주 사용하여 풀었다.&lt;/p&gt;
&lt;h2&gt;[Level 2] 타겟 넘버&lt;/h2&gt;
&lt;p&gt;DFS, BFS 문제 중 간단한 편에 속하는 문제이다. Queue를 사용하였고, 노드별 가지가 2개밖에 되지 않아 간단하게 구현 가능하다.
다만, 기존에 C++로 문제를 제출한 이력이 있어서 Go언어로 다시 풀어보았다. Go언어에는 Queue와 같은 자료구조 라이브러리가 부실해서 직접 Queue 자료구조를 구현하였다.
Queue 구현 시 &lt;code class=&quot;language-text&quot;&gt;https://yoongrammer.tistory.com/54&lt;/code&gt; 올려진 자료를 참고하였다.&lt;/p&gt;
&lt;/br&gt;
&lt;p&gt;먼저, Queue 자료구조를 구현한 부분은 아래와 같다.
Queue 타입을 선언하고 Queue 타입의 포인터 리터럴을 받는 함수 세개를 구현하였다.&lt;/p&gt;
&lt;/br&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;go&quot;&gt;&lt;pre class=&quot;language-go&quot;&gt;&lt;code class=&quot;language-go&quot;&gt;&lt;span class=&quot;token keyword&quot;&gt;type&lt;/span&gt; Queue &lt;span class=&quot;token punctuation&quot;&gt;[&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;]&lt;/span&gt;&lt;span class=&quot;token keyword&quot;&gt;interface&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;

&lt;span class=&quot;token keyword&quot;&gt;func&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;q &lt;span class=&quot;token operator&quot;&gt;*&lt;/span&gt;Queue&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;token function&quot;&gt;IsEmpty&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;token builtin&quot;&gt;bool&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;
    &lt;span class=&quot;token keyword&quot;&gt;return&lt;/span&gt; &lt;span class=&quot;token function&quot;&gt;len&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;*&lt;/span&gt;q&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;token operator&quot;&gt;==&lt;/span&gt; &lt;span class=&quot;token number&quot;&gt;0&lt;/span&gt;
&lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;

&lt;span class=&quot;token keyword&quot;&gt;func&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;q &lt;span class=&quot;token operator&quot;&gt;*&lt;/span&gt;Queue&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;token function&quot;&gt;Push&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;v &lt;span class=&quot;token keyword&quot;&gt;interface&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;
    &lt;span class=&quot;token operator&quot;&gt;*&lt;/span&gt;q &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;token function&quot;&gt;append&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;*&lt;/span&gt;q&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; v&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;
&lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;

&lt;span class=&quot;token keyword&quot;&gt;func&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;q &lt;span class=&quot;token operator&quot;&gt;*&lt;/span&gt;Queue&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;token function&quot;&gt;Pop&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;v &lt;span class=&quot;token keyword&quot;&gt;interface&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;
    &lt;span class=&quot;token keyword&quot;&gt;if&lt;/span&gt; q&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;IsEmpty&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;
        &lt;span class=&quot;token keyword&quot;&gt;return&lt;/span&gt; &lt;span class=&quot;token boolean&quot;&gt;nil&lt;/span&gt;
    &lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;
    
    v &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;*&lt;/span&gt;q&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;[&lt;/span&gt;&lt;span class=&quot;token number&quot;&gt;0&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;]&lt;/span&gt;
    &lt;span class=&quot;token operator&quot;&gt;*&lt;/span&gt;q &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;*&lt;/span&gt;q&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;[&lt;/span&gt;&lt;span class=&quot;token number&quot;&gt;1&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;]&lt;/span&gt;
    &lt;span class=&quot;token keyword&quot;&gt;return&lt;/span&gt;   
&lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;/br&gt;
&lt;p&gt;실제 코드는 아래와 같다.
위의 Queue 자료구조 사용 시 주의할 점은 Pop()에서 interface{}를 리턴하므로 Queue에 넣었던 타입으로 형변환해서 사용해야 한다는 점이다.&lt;/p&gt;
&lt;/br&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;go&quot;&gt;&lt;pre class=&quot;language-go&quot;&gt;&lt;code class=&quot;language-go&quot;&gt;&lt;span class=&quot;token keyword&quot;&gt;type&lt;/span&gt; Queue &lt;span class=&quot;token punctuation&quot;&gt;[&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;]&lt;/span&gt;&lt;span class=&quot;token keyword&quot;&gt;interface&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;

&lt;span class=&quot;token keyword&quot;&gt;func&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;q &lt;span class=&quot;token operator&quot;&gt;*&lt;/span&gt;Queue&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;token function&quot;&gt;IsEmpty&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;token builtin&quot;&gt;bool&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;
    &lt;span class=&quot;token keyword&quot;&gt;return&lt;/span&gt; &lt;span class=&quot;token function&quot;&gt;len&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;*&lt;/span&gt;q&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;token operator&quot;&gt;==&lt;/span&gt; &lt;span class=&quot;token number&quot;&gt;0&lt;/span&gt;
&lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;

&lt;span class=&quot;token keyword&quot;&gt;func&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;q &lt;span class=&quot;token operator&quot;&gt;*&lt;/span&gt;Queue&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;token function&quot;&gt;Push&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;v &lt;span class=&quot;token keyword&quot;&gt;interface&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;
    &lt;span class=&quot;token operator&quot;&gt;*&lt;/span&gt;q &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;token function&quot;&gt;append&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;*&lt;/span&gt;q&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; v&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;
&lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;

&lt;span class=&quot;token keyword&quot;&gt;func&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;q &lt;span class=&quot;token operator&quot;&gt;*&lt;/span&gt;Queue&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;token function&quot;&gt;Pop&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;v &lt;span class=&quot;token keyword&quot;&gt;interface&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;
    &lt;span class=&quot;token keyword&quot;&gt;if&lt;/span&gt; q&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;IsEmpty&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;
        &lt;span class=&quot;token keyword&quot;&gt;return&lt;/span&gt; &lt;span class=&quot;token boolean&quot;&gt;nil&lt;/span&gt;
    &lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;
    
    v &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;*&lt;/span&gt;q&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;[&lt;/span&gt;&lt;span class=&quot;token number&quot;&gt;0&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;]&lt;/span&gt;
    &lt;span class=&quot;token operator&quot;&gt;*&lt;/span&gt;q &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;*&lt;/span&gt;q&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;[&lt;/span&gt;&lt;span class=&quot;token number&quot;&gt;1&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;]&lt;/span&gt;
    &lt;span class=&quot;token keyword&quot;&gt;return&lt;/span&gt;   
&lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;

&lt;span class=&quot;token keyword&quot;&gt;type&lt;/span&gt; Node &lt;span class=&quot;token keyword&quot;&gt;struct&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;
    Now &lt;span class=&quot;token builtin&quot;&gt;int&lt;/span&gt;
    Value &lt;span class=&quot;token builtin&quot;&gt;int&lt;/span&gt;
&lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;

&lt;span class=&quot;token keyword&quot;&gt;func&lt;/span&gt; &lt;span class=&quot;token function&quot;&gt;solution&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;numbers &lt;span class=&quot;token punctuation&quot;&gt;[&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;]&lt;/span&gt;&lt;span class=&quot;token builtin&quot;&gt;int&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; target &lt;span class=&quot;token builtin&quot;&gt;int&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;result &lt;span class=&quot;token builtin&quot;&gt;int&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;
    op &lt;span class=&quot;token operator&quot;&gt;:=&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;[&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;]&lt;/span&gt;&lt;span class=&quot;token builtin&quot;&gt;int&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;-&lt;/span&gt;&lt;span class=&quot;token number&quot;&gt;1&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;token number&quot;&gt;1&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;
    length &lt;span class=&quot;token operator&quot;&gt;:=&lt;/span&gt; &lt;span class=&quot;token function&quot;&gt;len&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;numbers&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;token operator&quot;&gt;-&lt;/span&gt; &lt;span class=&quot;token number&quot;&gt;1&lt;/span&gt;
    q &lt;span class=&quot;token operator&quot;&gt;:=&lt;/span&gt; Queue&lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;
    
    q&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;Push&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;Node&lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;&lt;span class=&quot;token number&quot;&gt;0&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt;numbers&lt;span class=&quot;token punctuation&quot;&gt;[&lt;/span&gt;&lt;span class=&quot;token number&quot;&gt;0&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;]&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;
    q&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;Push&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;Node&lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;&lt;span class=&quot;token number&quot;&gt;0&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt;numbers&lt;span class=&quot;token punctuation&quot;&gt;[&lt;/span&gt;&lt;span class=&quot;token number&quot;&gt;0&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;]&lt;/span&gt; &lt;span class=&quot;token operator&quot;&gt;*&lt;/span&gt; &lt;span class=&quot;token operator&quot;&gt;-&lt;/span&gt;&lt;span class=&quot;token number&quot;&gt;1&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;
    
    &lt;span class=&quot;token keyword&quot;&gt;for&lt;/span&gt; &lt;span class=&quot;token operator&quot;&gt;!&lt;/span&gt;q&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;IsEmpty&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;
        v &lt;span class=&quot;token operator&quot;&gt;:=&lt;/span&gt; q&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;Pop&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;Node&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;
        
        &lt;span class=&quot;token keyword&quot;&gt;if&lt;/span&gt; v&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;Now &lt;span class=&quot;token operator&quot;&gt;==&lt;/span&gt; length &lt;span class=&quot;token operator&quot;&gt;-&lt;/span&gt; &lt;span class=&quot;token number&quot;&gt;1&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;
            r1 &lt;span class=&quot;token operator&quot;&gt;:=&lt;/span&gt; v&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;Value &lt;span class=&quot;token operator&quot;&gt;+&lt;/span&gt; op&lt;span class=&quot;token punctuation&quot;&gt;[&lt;/span&gt;&lt;span class=&quot;token number&quot;&gt;0&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;]&lt;/span&gt; &lt;span class=&quot;token operator&quot;&gt;*&lt;/span&gt; numbers&lt;span class=&quot;token punctuation&quot;&gt;[&lt;/span&gt;v&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;Now &lt;span class=&quot;token operator&quot;&gt;+&lt;/span&gt; &lt;span class=&quot;token number&quot;&gt;1&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;]&lt;/span&gt;
            r2 &lt;span class=&quot;token operator&quot;&gt;:=&lt;/span&gt; v&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;Value &lt;span class=&quot;token operator&quot;&gt;+&lt;/span&gt; op&lt;span class=&quot;token punctuation&quot;&gt;[&lt;/span&gt;&lt;span class=&quot;token number&quot;&gt;1&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;]&lt;/span&gt; &lt;span class=&quot;token operator&quot;&gt;*&lt;/span&gt; numbers&lt;span class=&quot;token punctuation&quot;&gt;[&lt;/span&gt;v&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;Now &lt;span class=&quot;token operator&quot;&gt;+&lt;/span&gt; &lt;span class=&quot;token number&quot;&gt;1&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;]&lt;/span&gt;
            
            &lt;span class=&quot;token keyword&quot;&gt;if&lt;/span&gt; r1 &lt;span class=&quot;token operator&quot;&gt;==&lt;/span&gt; target &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;
                result&lt;span class=&quot;token operator&quot;&gt;++&lt;/span&gt;
            &lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;
            &lt;span class=&quot;token keyword&quot;&gt;if&lt;/span&gt; r2 &lt;span class=&quot;token operator&quot;&gt;==&lt;/span&gt; target &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;
                result&lt;span class=&quot;token operator&quot;&gt;++&lt;/span&gt;
            &lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;
            &lt;span class=&quot;token keyword&quot;&gt;continue&lt;/span&gt;
        &lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;
        
        q&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;Push&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;Node&lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;v&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;Now &lt;span class=&quot;token operator&quot;&gt;+&lt;/span&gt; &lt;span class=&quot;token number&quot;&gt;1&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; v&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;Value &lt;span class=&quot;token operator&quot;&gt;+&lt;/span&gt; op&lt;span class=&quot;token punctuation&quot;&gt;[&lt;/span&gt;&lt;span class=&quot;token number&quot;&gt;0&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;]&lt;/span&gt; &lt;span class=&quot;token operator&quot;&gt;*&lt;/span&gt; numbers&lt;span class=&quot;token punctuation&quot;&gt;[&lt;/span&gt;v&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;Now &lt;span class=&quot;token operator&quot;&gt;+&lt;/span&gt; &lt;span class=&quot;token number&quot;&gt;1&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;]&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;
        q&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;Push&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;Node&lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;v&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;Now &lt;span class=&quot;token operator&quot;&gt;+&lt;/span&gt; &lt;span class=&quot;token number&quot;&gt;1&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; v&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;Value &lt;span class=&quot;token operator&quot;&gt;+&lt;/span&gt; op&lt;span class=&quot;token punctuation&quot;&gt;[&lt;/span&gt;&lt;span class=&quot;token number&quot;&gt;1&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;]&lt;/span&gt; &lt;span class=&quot;token operator&quot;&gt;*&lt;/span&gt; numbers&lt;span class=&quot;token punctuation&quot;&gt;[&lt;/span&gt;v&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;Now &lt;span class=&quot;token operator&quot;&gt;+&lt;/span&gt; &lt;span class=&quot;token number&quot;&gt;1&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;]&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;
    &lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;
    
    &lt;span class=&quot;token keyword&quot;&gt;return&lt;/span&gt;
&lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;h2&gt;[Level 3] 네트워크&lt;/h2&gt;
&lt;p&gt;네트워크는 노드별 연결되어 있는 개수를 찾는 문제이다.
BFS를 사용하였으며, 방문 가능한 모든 노드를 한번에 방문한다.
각 방문한 노드는 visit에 기록하여, 이미 방문한 노드는 다시 방문하지 않도록 한다.
하나의 네트워크를 찾았으면, 다음 방문하지 않은 노드부터 네트워크를 찾기 시작한다.&lt;/p&gt;
&lt;/br&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;c++&quot;&gt;&lt;pre class=&quot;language-c++&quot;&gt;&lt;code class=&quot;language-c++&quot;&gt;#include &amp;lt;string&amp;gt;
#include &amp;lt;vector&amp;gt;
#include &amp;lt;queue&amp;gt;

using namespace std;

int solution(int n, vector&amp;lt;vector&amp;lt;int&amp;gt;&amp;gt; computers) {
    int answer = 0;
    vector&amp;lt;bool&amp;gt; visit(n, false);
    queue&amp;lt;int&amp;gt; q;
    
    for(int i = 0; i &amp;lt; n; i++) {
        if (visit[i]) {
            continue;
        }
        
        q.push(i);
        while (!q.empty()) {
            int v = q.front();
            q.pop();
            if (visit[v]) continue;
            visit[v] = true;
            
            for(int j = 0; j &amp;lt; n; j++) {
                if(computers[v][j] &amp;amp;&amp;amp; !visit[j]) {
                    q.push(j);
                }
            }
        }
        answer++;
    }
    
    return answer;
}&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;h2&gt;[Level 3] 단어 변환&lt;/h2&gt;
&lt;p&gt;단어 변환은 begin 단어에서부터 words 내에 있는 단어 중 하나의 문자만 변경해서 target까지 최소 몇 번의 변환을 거쳐야 가능한지 구하는 문제이다.
역시 BFS 알고리즘을 사용하였으며, 각 노드에는 현재 단어와 방문한 단어를 기록해놓는다.
네트워크보다 복잡한 점은 이미 방문했던 노드를 한번씩만 기록하는게 아니라, 각 노드를 방문한 시점에 방문했던 노드가 각각 다르다는 것이다.
따라서 queue에 위와 같이 현재 단어와 방문했던 단어를 모두 기록했다.
네트워크보단 복잡하지만 엄청 어렵거나 하진 않았다.&lt;/p&gt;
&lt;/br&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;c++&quot;&gt;&lt;pre class=&quot;language-c++&quot;&gt;&lt;code class=&quot;language-c++&quot;&gt;#include &amp;lt;string&amp;gt;
#include &amp;lt;vector&amp;gt;
#include &amp;lt;queue&amp;gt;
#include &amp;lt;map&amp;gt;

using namespace std;

struct alpa {
    string now;
    map&amp;lt;string,bool&amp;gt; visit;
};

bool compare(string now, string target) {
    int length = now.size();
    int diff = 0;
    for(int i = 0; i &amp;lt; length; i++) {
        if (now[i] != target[i]) {
            if (diff) {
                return false;
            }
            diff++;
        }
    }
    
    return diff == 1;
}

int solution(string begin, string target, vector&amp;lt;string&amp;gt; words) {
    int answer = 51;
    int length = words.size();
    queue&amp;lt;alpa&amp;gt; q;    
    q.push({begin,map&amp;lt;string,bool&amp;gt;()});
    
    while(!q.empty()) {
        alpa f = q.front();
        q.pop();
        
        if (f.now == target) {
            int tempAnswer = f.visit.size();
            if (tempAnswer &amp;lt; answer &amp;amp;&amp;amp; tempAnswer != 0) {
                answer = tempAnswer;
            }
            continue;
        }
        
        f.visit[f.now] = true;
        for(int i = 0; i &amp;lt; length; i++) {
            if (f.now == words[i] || f.visit.count(words[i]) &amp;gt; 0) {
                continue;
            }
            
            if (compare(f.now, words[i])) {
                q.push({words[i], f.visit});
            }
        }
    }
    
    if (answer == 51) {
        answer = 0;
    }
    
    return answer;
}&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;h2&gt;[Level 3] 여행경로&lt;/h2&gt;
&lt;p&gt;여행경로는 모든 티켓을 사용해서 모든 노드를 방문할 수 있는 경우의 수 중에서 알파벳순으로 가장 앞에 오는 경로를 리턴하면 된다.
탐색은 동일하게 했고, 추가로 각 경로 탐색 시 시간을 줄이기 위해 map으로 경로를 찾을 수 있도록 하였다.
처음에는 좀 더 쉬운 방법으로 풀이해보려 했는데, 모든 케이스를 고려 안하면 정답이 안되서... 결국 완전탐색하게 하였다.&lt;/p&gt;
&lt;/br&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;c++&quot;&gt;&lt;pre class=&quot;language-c++&quot;&gt;&lt;code class=&quot;language-c++&quot;&gt;#include &amp;lt;string&amp;gt;
#include &amp;lt;vector&amp;gt;
#include &amp;lt;queue&amp;gt;
#include &amp;lt;map&amp;gt;

using namespace std;

struct Route {
    string target;
    int index;
};

struct Status {
    string now;
    int cnt;
    vector&amp;lt;bool&amp;gt; visited;
    vector&amp;lt;string&amp;gt; route;
};

vector&amp;lt;string&amp;gt; compare(vector&amp;lt;string&amp;gt; a, vector&amp;lt;string&amp;gt; b) {
    int size = a.size();
    if (size == 0) return b;
    
    for(int i = 0; i &amp;lt; size; i ++) {
        if (a[i] &amp;lt; b[i]) {
            return a;
        } else if (a[i] == b[i]) {
            continue;
        }
        return b;
    }
    
    return a;
}

vector&amp;lt;string&amp;gt; solution(vector&amp;lt;vector&amp;lt;string&amp;gt;&amp;gt; tickets) {
    vector&amp;lt;string&amp;gt; answer;
    int length = tickets.size();
    map&amp;lt;string,vector&amp;lt;Route&amp;gt;&amp;gt; route;
    
    // Route 생성
    for (int i = 0; i &amp;lt; length; i++) {
        vector&amp;lt;string&amp;gt; ticket = tickets[i];
        if (route.count(ticket[0]) == 0) {
            vector&amp;lt;Route&amp;gt; vc;
            vc.push_back({ticket[1], i});
            route.insert({ticket[0], vc});
        } else {
            route[ticket[0]].push_back({ticket[1], i});
        }
    }
    
    // 탐색
    queue&amp;lt;Status&amp;gt; q;
    q.push({&amp;quot;ICN&amp;quot;, 1, vector&amp;lt;bool&amp;gt;(length,false), vector&amp;lt;string&amp;gt;(1, &amp;quot;ICN&amp;quot;)});
    
    while (!q.empty()) {
        Status f = q.front();
        q.pop();
        
        if (f.cnt == length + 1) {
            answer = compare(answer, f.route);
            continue;
        }
        
        int targetSize = route[f.now].size();
        for (int i = 0; i &amp;lt; targetSize; i++) {
            Route tgt = route[f.now][i];
            Status temp = f;
            
            if (temp.visited[tgt.index]) {
                continue;
            }
            
            temp.visited[tgt.index] = true;
            temp.route.push_back(tgt.target);
            q.push({tgt.target, temp.cnt + 1, temp.visited, temp.route});
        }
    }
    
    return answer;
}&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;</content:encoded></item><item><title><![CDATA[[Web] JWT Token과 PASETO]]></title><description><![CDATA[JWT Token과 PASETO에 대한 비교 웹 개발 공부를 하던 중 JWT Token에 대응되는 PASETO 대해 알게 되어 관련 내용을 정리해보고자 한다. 1. JWT Token 이란? JWT Token…]]></description><link>https://github.com/SiverPineValley/SiverPineValley.github.io/web/jwt&amp;paesto/</link><guid isPermaLink="false">https://github.com/SiverPineValley/SiverPineValley.github.io/web/jwt&amp;paesto/</guid><pubDate>Mon, 25 Oct 2021 16:00:00 GMT</pubDate><content:encoded>&lt;h1&gt;JWT Token과 PASETO에 대한 비교&lt;/h1&gt;
&lt;p&gt;웹 개발 공부를 하던 중 JWT Token에 대응되는 PASETO 대해 알게 되어 관련 내용을 정리해보고자 한다.&lt;/p&gt;
&lt;h2&gt;1. JWT Token 이란?&lt;/h2&gt;
&lt;p&gt;JWT Token은 웹 개발자에게는 매우 익숙한 개념이다. 사용자의 로그인에 대한 인가를 위해 Access, Refresh 토큰 등을 발행하여 브라우저에서는 해당 정보를 가지고 서버에 호출하게끔 한다. 만료되지 않고 인가된 사용자는 토큰 인증을 통과하여 서버의 리소스를 받아가고, 토큰이 만료되었을 때는 Refresh 토큰을 사용하여 갱신하며 사용한다. 이러한 방식을 OAuth라고 하는데, 이 부분에 대해서는 따로 다룰 예정이다.&lt;/p&gt;
&lt;h2&gt;2. JWT Token의 구조&lt;/h2&gt;
&lt;div align=&quot;left&quot;&gt;
  &lt;span class=&quot;gatsby-resp-image-wrapper&quot; style=&quot;position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 630px; &quot;&gt;
      &lt;a class=&quot;gatsby-resp-image-link&quot; href=&quot;/static/45a6265a51550b518e5782c6e568896f/ecfa6/jwt.png&quot; style=&quot;display: block&quot; target=&quot;_blank&quot; rel=&quot;noopener&quot;&gt;
    &lt;span class=&quot;gatsby-resp-image-background-image&quot; style=&quot;padding-bottom: 73.41772151898735%; position: relative; bottom: 0; left: 0; background-image: url(&apos;data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAPCAYAAADkmO9VAAAACXBIWXMAABYlAAAWJQFJUiTwAAABnElEQVR42qWUi3LaUAxE/f9fmE7SJtDSYLeAfd/vzeqSNAw1aWeimR3ZgI9WujLDaZ4xThNCDCi1omE9lnnB/nkP7z1KKcg5r/5uyCEgnBSK8ajaozE3S8m1DailobUGay0WpVg4IlICrTRwraHqirJNSN8TwiYhbiMCFbeh32dzrtxKBXzsRaTAWsjnQ7QNagTCATiZhoNuOCqKoKPujB4lZRQ6R8i4FR2ocsWjLRhDxU/qV6x4Zt4zj5QuZzdBRsM5cwCrrf5pWeWGjRVoxQPb/yoyBQ+U5FMSYOuzLBbIC7P7wOGSCDIVTwRuXMUXXXDPeylyT/h8AawElgWo8UNg624EIPlOnZ2JZBQ6v7bsA4zRSCmxtdttD4lfStvyoMrv1+LM14s95IHsjgqLNlDGEm77Kl1KdnS4tQLXYenw2+wo33Xgvmqt14HnKf2ti+nA8ZQ3HMEP1zCFht++3Ab+O9g+gZNLBGXM3EUd0ueA4nDnCnYc7Ph5hzJDj8lGLHTX5cWh4eG8yzn3OsP/kPwheD7gCH6Tv5K8TS8m0pbnhJ0tSAAAAABJRU5ErkJggg==&apos;); background-size: cover; display: block;&quot;&gt;&lt;/span&gt;
  &lt;img class=&quot;gatsby-resp-image-image&quot; alt=&quot;jwt&quot; title=&quot;&quot; src=&quot;/static/45a6265a51550b518e5782c6e568896f/f058b/jwt.png&quot; srcset=&quot;/static/45a6265a51550b518e5782c6e568896f/c26ae/jwt.png 158w,
/static/45a6265a51550b518e5782c6e568896f/6bdcf/jwt.png 315w,
/static/45a6265a51550b518e5782c6e568896f/f058b/jwt.png 630w,
/static/45a6265a51550b518e5782c6e568896f/40601/jwt.png 945w,
/static/45a6265a51550b518e5782c6e568896f/78612/jwt.png 1260w,
/static/45a6265a51550b518e5782c6e568896f/ecfa6/jwt.png 1819w&quot; sizes=&quot;(max-width: 630px) 100vw, 630px&quot; style=&quot;width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;&quot; loading=&quot;lazy&quot; decoding=&quot;async&quot;&gt;
  &lt;/a&gt;
    &lt;/span&gt;
&lt;/div&gt;
&lt;p&gt;JWT 토큰은 위와 같이 세 부분으로 나뉜다. 각 부분은 .으로 구분되며, 각각 Base64로 인코딩되어 있으며 역할이 조금씩 다르다.&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;Header: 서명의 암호화에 사용된 알고리즘 정보&lt;/li&gt;
&lt;li&gt;Payload: 토큰에서 담고 싶은 정보 (보통 사용자 ID, 만료시간 등이 담김)&lt;/li&gt;
&lt;li&gt;Verify Signature: 서버에서만 비밀키로 복호화가 가능한 인증 서명. 서버에서는 헤더의 알고리즘 정보와 서명 정보를 바탕으로 복호화하여 인가 여부를 확인한다.&lt;/li&gt;
&lt;/ul&gt;
&lt;h2&gt;3. JWT Token의 알고리즘&lt;/h2&gt;
&lt;p&gt;JWT Token의 알고리즘으로는 여러 가지 종류가 있지만, 크게 대칭키/비대칭키로 나뉜다.&lt;/p&gt;
&lt;h3&gt;대칭키 알고리즘&lt;/h3&gt;
&lt;ul&gt;
&lt;li&gt;토큰의 암호화, 복호화에 같은 비밀키를 사용&lt;/li&gt;
&lt;li&gt;키가 안전하게 보관될 수 있는 내부망에서만 사용됨&lt;/li&gt;
&lt;li&gt;HS256, HS384, HS512
&lt;ul&gt;
&lt;li&gt;HS256 = HMAC(Hash-based Message Authentication Code) + SHA256(Secure Hash Algorithm)&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;/ul&gt;
&lt;h3&gt;비대칭키 알고리즘&lt;/h3&gt;
&lt;ul&gt;
&lt;li&gt;비밀키는 토큰의 암호화에 사용됨&lt;/li&gt;
&lt;li&gt;공개키는 토큰의 복호화(인가)에 사용됨&lt;/li&gt;
&lt;li&gt;공개된 사이트에서 사용 가능. 내부에서는 키를 암호화하고, 외부에서는 토큰을 검증받아 사용.&lt;/li&gt;
&lt;li&gt;RS256, RS384, RS512 || PS256, PS384, PS512 || ES256, ES384, ES512&lt;/li&gt;
&lt;/ul&gt;
&lt;h2&gt;4. JWT Token의 문제점?&lt;/h2&gt;
&lt;p&gt;JWT 토큰은 적당한 유연성과 체계를 갖춘 방법이라 아직도 수많은 사이트들에서 널리 쓰이고 있다. 하지만 안전해보이는 이 방식에도 몇 가지 문제점이 존재한다.&lt;/p&gt;
&lt;h3&gt;알고리즘의 취약성&lt;/h3&gt;
&lt;ul&gt;
&lt;li&gt;개발자들에게 많은 종류의 알고리즘을 제공하여 최적의 선택을 하기 어렵게 만든다.&lt;/li&gt;
&lt;li&gt;몇몇 알고리즘은 취약성을 가진다.
&lt;ul&gt;
&lt;li&gt;RSA PKCSv1.5: padding oracle attack&lt;/li&gt;
&lt;li&gt;ECDSA: invalid-curve attack&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;/ul&gt;
&lt;h3&gt;쉬운 토큰 위조&lt;/h3&gt;
&lt;ul&gt;
&lt;li&gt;어떤 토큰 라이브러리를 사용했냐에 따라 위조가 매우 쉬운 토큰을 양산할 수 있다.&lt;/li&gt;
&lt;li&gt;여러 공격 방식에 취약함.
&lt;ul&gt;
&lt;li&gt;헤더의 알고리즘(alg)를 None으로 둬서 통과하게 한다.&lt;/li&gt;
&lt;li&gt;헤더의 알고리즘(alg)를 HS256으로 둬서 RSA 공개키로 토큰을 검증하게 만들어버림.&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;li&gt;개발자는 인가 전 헤더의 알고리즘을 꼭 체크하도록 해야 한다.&lt;/li&gt;
&lt;/ul&gt;
&lt;h2&gt;5. PASETO(Platform-Agnostic SEcurity TOkens)&lt;/h2&gt;
&lt;h3&gt;강력한 알고리즘 사용&lt;/h3&gt;
&lt;ul&gt;
&lt;li&gt;개발자가 굳이 알고리즘을 선택하여 사용할 필요가 없다. PASETO의 버전만 선택하여 사용.&lt;/li&gt;
&lt;li&gt;각 버전은 단 하나의 암호화 스위트(Cipher Suite)를 사용.&lt;/li&gt;
&lt;li&gt;오직 가장 최근의 2개 PAESTO 버전만 허용됨. (현재는 v1, v2)&lt;/li&gt;
&lt;/ul&gt;
&lt;h4&gt;v1&lt;/h4&gt;
&lt;ul&gt;
&lt;li&gt;오래된 버전. Modern 암호화 기술을 사용할 수 없는 Legacy 호환용.&lt;/li&gt;
&lt;li&gt;대칭키: JWT 토큰처럼 Base64가 아니라, 토큰의 모든 데이터를 암호화.
&lt;ul&gt;
&lt;li&gt;내부망용&lt;/li&gt;
&lt;li&gt;AEAD(Authenticated Encryption with Associated Data) 알고리즘 사용.&lt;/li&gt;
&lt;li&gt;AES256 CTR + HMAC SHA384&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;li&gt;비대칭키: JWT와 동일하게 Base64 인코딩. 비밀키를 사용하여 디지털 서명 검증.
&lt;ul&gt;
&lt;li&gt;외부 공개용&lt;/li&gt;
&lt;li&gt;RSA PSS + SHA384&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;/ul&gt;
&lt;h4&gt;v2&lt;/h4&gt;
&lt;ul&gt;
&lt;li&gt;권장되는 버전.&lt;/li&gt;
&lt;li&gt;대칭키
&lt;ul&gt;
&lt;li&gt;내부망용&lt;/li&gt;
&lt;li&gt;XChaCha20-Poly1305 사용.&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;li&gt;비대칭키: JWT와 동일하게 Base64 인코딩. 비밀키를 사용하여 디지털 서명 검증.
&lt;ul&gt;
&lt;li&gt;외부 공개용&lt;/li&gt;
&lt;li&gt;ED25519 (EdDSA + Curve25519)&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;/ul&gt;
&lt;h3&gt;쉽지 않은 토큰 위조&lt;/h3&gt;
&lt;ul&gt;
&lt;li&gt;공격자가 헤더의 알고리즘을 변경할 수 없음.&lt;/li&gt;
&lt;li&gt;토큰의 모든 내용은 AEAD 알고리즘으로 인증됨.&lt;/li&gt;
&lt;li&gt;두 특성으로 위조 가능성을 매우 낮춤.&lt;/li&gt;
&lt;li&gt;내부망용 대칭키도 payload를 인코딩 하는 것이 아니라 암호화함.&lt;/li&gt;
&lt;/ul&gt;
&lt;h2&gt;6. PASETO의 구조&lt;/h2&gt;
&lt;div align=&quot;left&quot;&gt;
  &lt;span class=&quot;gatsby-resp-image-wrapper&quot; style=&quot;position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 630px; &quot;&gt;
      &lt;a class=&quot;gatsby-resp-image-link&quot; href=&quot;/static/dd4894de1af4a8bf1bd6c9d20014802a/9b379/paseto.png&quot; style=&quot;display: block&quot; target=&quot;_blank&quot; rel=&quot;noopener&quot;&gt;
    &lt;span class=&quot;gatsby-resp-image-background-image&quot; style=&quot;padding-bottom: 56.32911392405063%; position: relative; bottom: 0; left: 0; background-image: url(&apos;data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAALCAYAAAB/Ca1DAAAACXBIWXMAABYlAAAWJQFJUiTwAAACO0lEQVR42j2TTXacMBCEuV0ulhvkAjlCFskm6yTvOQs7E88w/4BACAmBBIhhxqtKaRx7UbRA/Uqfupsk//gB5tsnLNOEy+ARfI803+Dp+IRN9oxtscFm9QcPP39gt+b78188/n7AId3gGibmO1ynEbc54DIOSOSvr5CFQHAOCz/MTOjaBk1TQesKxki0tUQtCuiqhK1rNEKgY7zR6IUgqsiR7baY+g5J13mI7Ii2N5jCiGWeX3WZcV0urzEEvJBgCR5+dHBjD+tbNJ1G61qcxBnpnoauR+J9hxNp0irHgUR7UyIzCoXWyHWDc6Mwk8S5AfuywU5qPBc1tpWC6DoIa6G8Rx+uuBIkCX6ANT2c9ZiIP5DyEi64hRvJFpYhakTM8/1IDRj9dFcYA+YhYPKB7+NrDZ0hSby/rqFZm8GYe31aWd1rN3WW5hNrJyEOO9z6Ft408KTvSW+qCo7rK81iU5OFj0pkOJy2KGWOShUoa0ZZoKopxUOcxTIMKPIT9sw75fv7nuRejI1m41p1n5Dkyuto0q2OK45I+q6UWnNs1vkarjPs6ISWeYdsi6rhoSqHUBkU6z7TKJrFCUniqAxdC0kiazUsR0ZzVDrb4MbD3q4S5ayBUiVzSSZLmgoY5s9sytT/N4wPHTdlhrw64iQP2JXbeyxIEM3fDNNdgXWaY38QyPMatWxRlRolJZVjadiUwNk5synNuURftLDCwBYkFZTSGHv7bjhx+EeSxHWkin/JXfyut4/4/uUz/gGFdy9DDAOVnAAAAABJRU5ErkJggg==&apos;); background-size: cover; display: block;&quot;&gt;&lt;/span&gt;
  &lt;img class=&quot;gatsby-resp-image-image&quot; alt=&quot;paseto&quot; title=&quot;&quot; src=&quot;/static/dd4894de1af4a8bf1bd6c9d20014802a/f058b/paseto.png&quot; srcset=&quot;/static/dd4894de1af4a8bf1bd6c9d20014802a/c26ae/paseto.png 158w,
/static/dd4894de1af4a8bf1bd6c9d20014802a/6bdcf/paseto.png 315w,
/static/dd4894de1af4a8bf1bd6c9d20014802a/f058b/paseto.png 630w,
/static/dd4894de1af4a8bf1bd6c9d20014802a/40601/paseto.png 945w,
/static/dd4894de1af4a8bf1bd6c9d20014802a/9b379/paseto.png 951w&quot; sizes=&quot;(max-width: 630px) 100vw, 630px&quot; style=&quot;width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;&quot; loading=&quot;lazy&quot; decoding=&quot;async&quot;&gt;
  &lt;/a&gt;
    &lt;/span&gt;
&lt;/div&gt;
&lt;ul&gt;
&lt;li&gt;Version: PASETO의 버전 (v1, v2)&lt;/li&gt;
&lt;li&gt;Purpose: PASETO의 목적
&lt;ul&gt;
&lt;li&gt;local: (대칭키 암호화 방식)&lt;/li&gt;
&lt;li&gt;public: (비대칭키 암호화 방식)&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;li&gt;Payload:
&lt;ul&gt;
&lt;li&gt;Local:
&lt;ul&gt;
&lt;li&gt;Body: 암호화된 토큰 정보 (JSON 형태)&lt;/li&gt;
&lt;li&gt;Nonce: 암호화와 인가 시 사용되는 Nonce 정보&lt;/li&gt;
&lt;li&gt;Authentication Tag: 암호화된 메시지와 관련된 비암호화된 정보를 사용하여 인가용으로 사용&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;li&gt;Public:
&lt;ul&gt;
&lt;li&gt;Body: Base64 인코딩된 토큰 정보&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;li&gt;Signature (Public):
&lt;ul&gt;
&lt;li&gt;hex-인코드된 서명 정보&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;li&gt;Footer (Local):
&lt;ul&gt;
&lt;li&gt;Base64 인코드된 추가 정보&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;/ul&gt;
&lt;h4&gt;출처&lt;/h4&gt;
&lt;p&gt;&lt;a href=&quot;https://inspirit941.tistory.com/435&quot;&gt;https://inspirit941.tistory.com/435&lt;/a&gt;&lt;/br&gt;
&lt;a href=&quot;https://autoever.udemy.com/course/backend-master-class-golang-postgresql-kubernetes/learn/lecture/25822332#overview&quot;&gt;https://autoever.udemy.com/course/backend-master-class-golang-postgresql-kubernetes/learn/lecture/25822332#overview&lt;/a&gt;&lt;/p&gt;</content:encoded></item><item><title><![CDATA[[Web] 크롬 브라우저의 쿠키 정책과 SameSite]]></title><description><![CDATA[크롬 브라우저의 쿠키 정책과 SameSite 작년 중 고객 정보 관련 업무를 처리하다 크롬 브라우저의 정책 변경으로 인해 곤혹을 치른적이 있다.
결론부터 말하자면 SameSite의 Default…]]></description><link>https://github.com/SiverPineValley/SiverPineValley.github.io/web/samesite/</link><guid isPermaLink="false">https://github.com/SiverPineValley/SiverPineValley.github.io/web/samesite/</guid><pubDate>Mon, 04 Oct 2021 21:55:30 GMT</pubDate><content:encoded>&lt;h1&gt;크롬 브라우저의 쿠키 정책과 SameSite&lt;/h1&gt;
&lt;p&gt;작년 중 고객 정보 관련 업무를 처리하다 크롬 브라우저의 정책 변경으로 인해 곤혹을 치른적이 있다.
결론부터 말하자면 SameSite의 Default 설정이 변경된 것인데, 이 변경이 일부 환경에서 서비스 장애를 초래한 것이다.
간단히 말하자면, SameSite 기본 설정의 변경으로 크로스 도메인간 http 메소드의 쿠키 유지 정책이 변경된 것인데, 내가 담당한 서버는 여러 third Party에 Oauth2.0 인증 방식을 제공하고 있었다.
우리 인증 서버로 리다이렉트 시 쿠키가 유지되지 않는 현상이 발견된 것이다.&lt;/p&gt;
&lt;/br&gt;
&lt;h2&gt;쿠키(Cookie)란?&lt;/h2&gt;
&lt;p&gt;웹 개발을 하다보면 쿠키(Cookie)란 용어를 자주 듣게 된다.
브라우저에 특정 데이터를 저장하기 위한 방법 중 하나로 쓰이는데, 주로 로그인 정보나 장바구니 정보를 담는 용도로 사용하는데, 클라이언트단에서 정보를 유지하기 위해 사용된다.
쿠키를 설정하기 위해 서버에서는 들어온 요청의 응답의 &lt;code class=&quot;language-text&quot;&gt;Set-Cookie&lt;/code&gt; 헤더에 값을 설정하여 내려주고, 이를 브라우저에서 저장하게 된다.
Cookie는 key와 value 값으로 나뉘는데, 아래와 같이 &lt;code class=&quot;language-text&quot;&gt;session=sessionId&lt;/code&gt;의 경우 session이라는 key 값에 sessionId 라는 value를 가지게 된다.&lt;/p&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;http&quot;&gt;&lt;pre class=&quot;language-http&quot;&gt;&lt;code class=&quot;language-http&quot;&gt;&lt;span class=&quot;token header&quot;&gt;&lt;span class=&quot;token header-name keyword&quot;&gt;Set-Cookie&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;token header-value&quot;&gt;session=sessionId&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;실제 브라우저의 개발자 도구를 통해서는 아래와 같이 확인 가능하다.
브라우저에서는 쿠키의 key, value, 생성된 도메인과 uri, 만료 날짜와 쿠키에 대한 설정 값도 같이 저장한다.
각 쿠키의 설정 정보는 다음과 같다.&lt;/p&gt;
&lt;table&gt;
&lt;thead&gt;
&lt;tr&gt;
&lt;th align=&quot;center&quot;&gt;쿠키 설정&lt;/th&gt;
&lt;th&gt;내용&lt;/th&gt;
&lt;/tr&gt;
&lt;/thead&gt;
&lt;tbody&gt;
&lt;tr&gt;
&lt;td align=&quot;center&quot;&gt;domain&lt;/td&gt;
&lt;td&gt;현재 쿠키가 어떤 서버로 전송되어져야 하는지를 지정할 수 있는 속성이다.&lt;/br&gt;속성을 지정하지 않을경우에는 생성된 서버로만 전송되며, 지정할 수 있는 값으로는 현재 서버의 주소 혹은 상위 도메인까지만 지정할 수 있다.&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td align=&quot;center&quot;&gt;path&lt;/td&gt;
&lt;td&gt;path 속성은 웹서버의 디렉터리 단위로 지정이 가능하며, 디렉터리를 지정하면 지정한 해당 디렉터와 그 하위 경로에만 쿠키가 전송된다.&lt;/br&gt;디렉터리 단위라는것은 URL 경로상에 / (슬래쉬)로 구분되어지는 단위이다.&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td align=&quot;center&quot;&gt;HttpOnly&lt;/td&gt;
&lt;td&gt;자바스크립트를 통해 브라우저에서 쿠키에 접근이 가능한데, 이를 차단하기 위해 사용되는 설정이다.&lt;/br&gt; 주로 CCS(Cross-Site Scripting)과 같은 공격을 차단하기 위해 사용된다.&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td align=&quot;center&quot;&gt;Secure&lt;/td&gt;
&lt;td&gt;HTTPS 통신에서만 쿠키의 전송을 허용하는 설정.&lt;/br&gt; HTTPS 프로토콜의 경우 쿠키를 암호하하여 전달하기 때문에 쿠키 정보를 비교적 안전하게 전달이 가능하다.&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td align=&quot;center&quot;&gt;SameSite&lt;/td&gt;
&lt;td&gt;서드 파티 도메인(third-Party)으로 요청을 보낼 때 쿠키를 보낼지에 대한 설정 값을 나타낸다.&lt;/td&gt;
&lt;/tr&gt;
&lt;/tbody&gt;
&lt;/table&gt;
&lt;div align=&quot;left&quot;&gt;
  &lt;span class=&quot;gatsby-resp-image-wrapper&quot; style=&quot;position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 630px; &quot;&gt;
      &lt;a class=&quot;gatsby-resp-image-link&quot; href=&quot;/static/d3346fa8a8cf84cd13dead8c8291595d/d8817/browser_cookie.png&quot; style=&quot;display: block&quot; target=&quot;_blank&quot; rel=&quot;noopener&quot;&gt;
    &lt;span class=&quot;gatsby-resp-image-background-image&quot; style=&quot;padding-bottom: 10.126582278481013%; position: relative; bottom: 0; left: 0; background-image: url(&apos;data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAACCAIAAADXZGvcAAAACXBIWXMAAA7DAAAOwwHHb6hkAAAAZklEQVR42g2MCw6EIAxEvf8pdyXIp5RScUFwjU7STPpe01lciCLa+ihaV2Pt5o3dQkyqhw+EJYtClL1yLqIViKGUifNCDPO7n6ed8/M1xjofOXE52okzGuEpSZ9XH3NcN3D+kQNfL43pcGW9+83hAAAAAElFTkSuQmCC&apos;); background-size: cover; display: block;&quot;&gt;&lt;/span&gt;
  &lt;img class=&quot;gatsby-resp-image-image&quot; alt=&quot;browser cookie&quot; title=&quot;&quot; src=&quot;/static/d3346fa8a8cf84cd13dead8c8291595d/f058b/browser_cookie.png&quot; srcset=&quot;/static/d3346fa8a8cf84cd13dead8c8291595d/c26ae/browser_cookie.png 158w,
/static/d3346fa8a8cf84cd13dead8c8291595d/6bdcf/browser_cookie.png 315w,
/static/d3346fa8a8cf84cd13dead8c8291595d/f058b/browser_cookie.png 630w,
/static/d3346fa8a8cf84cd13dead8c8291595d/40601/browser_cookie.png 945w,
/static/d3346fa8a8cf84cd13dead8c8291595d/d8817/browser_cookie.png 1238w&quot; sizes=&quot;(max-width: 630px) 100vw, 630px&quot; style=&quot;width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;&quot; loading=&quot;lazy&quot; decoding=&quot;async&quot;&gt;
  &lt;/a&gt;
    &lt;/span&gt;
&lt;/div&gt;
&lt;/br&gt;
&lt;h2&gt;First-party 쿠키와 Third-party 쿠키&lt;/h2&gt;
&lt;p&gt;최근 많이 사용되는 웹 사이트에서는 대부분 쿠키를 통해 클라이언트에 세션 ID를 저장하고, 서버로 보내는 모든 요청에 이 세션 ID를 같이 전달하여 로그인한 유저의 세션을 유지할 수 있는 방법을 제공한다.
즉, 최초의 세션 정보는 서버에서 생성되는데 이것이 위에서 설명한 Set-Cookie 설정을 통해 클라이언트로 전달되게 된다.
여기서 위의 몇 가지 쿠키 설정들은 서버에서 따로 설정하지 않으면 default로 설정되게 되는데, domain의 경우 쿠키가 생성된 서버 도메인 정보가 default로 설정된다.&lt;/p&gt;
&lt;p&gt;이렇게 설정된 도메인을 기준으로 쿠키는 크게 First-Party cookie와 Third-Party cookie로 나뉘게 된다.
First-party cookie는 현재 사용자가 접속한 페이지의 도메인으로 전송되는 쿠키를 의미한다.
반대로 Third-party cookie는 현재 사용자가 접속한 페이지의 도메인과는 다른 도메인으로 전송되는 쿠키를 의미한다.&lt;/p&gt;
&lt;p&gt;쿠키에 별도로 설정을 가하지 않는다면, 크롬을 제외한 브라우저들은 모든 HTTP 요청에 대해서 쿠키를 전송하게 된다.
그 요청에는 HTML 문서 요청, HTML 문서에 포함된 이미지 요청, XHR 혹은 Form을 이용한 HTTP 요청등 모든 요청이 포함된다.
이러한 특징은 보안 위협이 되는데, 이를 CSRF(Cross Site Request Forgery)라고 한다. CSRF는 아래와 같은 공격 방식을 의미한다.&lt;/p&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;text&quot;&gt;&lt;pre class=&quot;language-text&quot;&gt;&lt;code class=&quot;language-text&quot;&gt;1. 공격대상 사이트는 쿠키로 사용자 인증을 수행함.
2. 피해자는 공격 대상 사이트에 이미 로그인 되어있어서 브라우저에 쿠키가 있는 상태.
3. 공격자는 피해자에게 그럴듯한 사이트 링크를 전송하고 누르게 함. (공격대상 사이트와 다른 도메인)
4. 링크를 누르면 HTML 문서가 열리는데, 이 문서는 공격 대상 사이트에 HTTP 요청을 보냄.
5. 이 요청에는 쿠키가 포함(서드 파티 쿠키)되어 있으므로 공격자가 유도한 동작을 실행할 수 있음.&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;즉, 원래의 도메인에서 사용자 인증을 거쳐 생성된 쿠키 정보를 탈취하여 해당 도메인에 인가된 요청을 전달할 수 있다는 것이다.
SameSite 설정은 이러한 문제를 해결하기 위해 도입되었다.&lt;/p&gt;
&lt;/br&gt;
&lt;h2&gt;SameSite 설정이란?&lt;/h2&gt;
&lt;p&gt;SameSite 설정이란 앞서 설명한 대로 Third-party 쿠키 문제를 해결하기 위해 쿠키 전송에 제한을 두는 설정을 의미한다.
크게 세 가지 정책이 있는데, 각각 아래와 같다.&lt;/p&gt;
&lt;table&gt;
&lt;thead&gt;
&lt;tr&gt;
&lt;th align=&quot;center&quot;&gt;쿠키 설정&lt;/th&gt;
&lt;th&gt;내용&lt;/th&gt;
&lt;/tr&gt;
&lt;/thead&gt;
&lt;tbody&gt;
&lt;tr&gt;
&lt;td align=&quot;center&quot;&gt;None&lt;/td&gt;
&lt;td&gt;SameSite 가 탄생하기 전 쿠키와 동작하는 방식이 같습니다. &lt;code class=&quot;language-text&quot;&gt;None&lt;/code&gt;으로 설정된 쿠키의 경우 크로스 사이트 요청의 경우에도 항상 전송됩니다.&lt;/br&gt;즉, 서드 파티 쿠키도 전송됩니다. 따라서, 보안적으로도 SameSite 적용을 하지 않은 쿠키와 마찬가지로 문제가 있는 방식입니다.&lt;/br&gt;최근의 정책 변경으로는 None으로 설정 시 Secure 설정도 같이 적용해줘야 정상적으로 동작합니다.&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td align=&quot;center&quot;&gt;Strict&lt;/td&gt;
&lt;td&gt;가장 보수적인 정책입니다. &lt;code class=&quot;language-text&quot;&gt;Strict&lt;/code&gt;로 설정된 쿠키는 크로스 사이트 요청에는 항상 전송되지 않습니다.&lt;/br&gt;즉, 서드 파티 쿠키는 전송되지 않고, 퍼스트 파티 쿠키만 전송됩니다.&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td align=&quot;center&quot;&gt;Lax&lt;/td&gt;
&lt;td&gt;&lt;code class=&quot;language-text&quot;&gt;Strict&lt;/code&gt;에 비해 상대적으로 느슨한 정책입니다. &lt;code class=&quot;language-text&quot;&gt;Lax&lt;/code&gt;로 설정된 경우, 대체로 서드 파티 쿠키는 전송되지 않지만, 몇 가지 예외적인 요청에는 전송됩니다.&lt;/td&gt;
&lt;/tr&gt;
&lt;/tbody&gt;
&lt;/table&gt;
&lt;p&gt;크롬 브라우저는 80버전 업데이트 이후로는 &lt;code class=&quot;language-text&quot;&gt;Lax&lt;/code&gt;를 SameSite Default 설정으로 사용하고 있고, 따로 서버에서 설정하지 않는다면 자동으로 &lt;code class=&quot;language-text&quot;&gt;Lax&lt;/code&gt;로 설정된다.&lt;/p&gt;
&lt;/br&gt;
&lt;h2&gt;Lax 설정을 통해 쿠키가 전송되는 경우?&lt;/h2&gt;
&lt;p&gt;&lt;a href=&quot;https://www.chromium.org/administrators/policy-list-3/cookie-legacy-samesite-policies&quot;&gt;Chrominus Pojects에서 올린 크롬 브라우저&lt;/a&gt;의 설명을 살펴보면,
First-part 도메인일 경우에는 쿠키를 당연히 전송하고, 이 외에는 Top Level Navigation(웹 페이지 이동)과, &quot;안전한&quot; HTTP 메서드 요청의 경우에만 전송된다는 것이다.&lt;/p&gt;
&lt;p&gt;Top Level Navigation에는 유저가 링크(&lt;code class=&quot;language-text&quot;&gt;&amp;lt;a&gt;&lt;/code&gt;)를 클릭하거나, window.location.replace 등으로 인해 자동으로 이뤄지는 이동, 302 리다이렉트를 이용한 이동이 포함된다.
하지만 &lt;code class=&quot;language-text&quot;&gt;&amp;lt;iframe&gt;&lt;/code&gt;이나 &lt;code class=&quot;language-text&quot;&gt;&amp;lt;img&gt;&lt;/code&gt;를 문서에 삽입함으로서 발생하는 HTTP 요청은 &quot;Navigation&quot;이라고 할 수 없으니 Lax 쿠키가 전송되지 않고, &lt;code class=&quot;language-text&quot;&gt;&amp;lt;iframe&gt;&lt;/code&gt; 안에서 페이지를 이동하는 경우는 &quot;Top Level&quot;이라고 할 수 없으므로 Lax 쿠키는 전송되지 않는다.
또한 &quot;안전하지 않은&quot; POST나 DELETE 같은 요청의 경우, Lax 쿠키는 전송되지 않는다. 하지만 GET처럼 서버의 서버의 상태를 바꾸지 않을 거라고 기대되는 요청에는 Lax 쿠키가 전송된다.&lt;/p&gt;
&lt;table&gt;
&lt;thead&gt;
&lt;tr&gt;
&lt;th&gt;Request Type&lt;/th&gt;
&lt;th&gt;Sample Code&lt;/th&gt;
&lt;th&gt;Cookies Sent&lt;/th&gt;
&lt;/tr&gt;
&lt;/thead&gt;
&lt;tbody&gt;
&lt;tr&gt;
&lt;td&gt;Link&lt;/td&gt;
&lt;td&gt;&lt;code class=&quot;language-text&quot;&gt;&amp;lt;a href=&quot;...&quot;&gt;&amp;lt;/a&gt;&lt;/code&gt;&lt;/td&gt;
&lt;td&gt;Normal, Lax&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;Prerender&lt;/td&gt;
&lt;td&gt;&lt;code class=&quot;language-text&quot;&gt;&amp;lt;link rel=&quot;prerender&quot; href=&quot;..&quot;/&gt;&lt;/code&gt;&lt;/td&gt;
&lt;td&gt;Normal, Lax&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;Form GET&lt;/td&gt;
&lt;td&gt;&lt;code class=&quot;language-text&quot;&gt;&amp;lt;form method=&quot;GET&quot; action=&quot;...&quot;&gt;&lt;/code&gt;&lt;/td&gt;
&lt;td&gt;Normal, Lax&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;Form POST&lt;/td&gt;
&lt;td&gt;&lt;code class=&quot;language-text&quot;&gt;&amp;lt;form method=&quot;POST&quot; action=&quot;...&quot;&gt;&lt;/code&gt;&lt;/td&gt;
&lt;td&gt;Normal&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;iframe&lt;/td&gt;
&lt;td&gt;&lt;code class=&quot;language-text&quot;&gt;&amp;lt;iframe src=&quot;...&quot;&gt;&amp;lt;/iframe&gt;&lt;/code&gt;&lt;/td&gt;
&lt;td&gt;Normal&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;AJAX&lt;/td&gt;
&lt;td&gt;&lt;code class=&quot;language-text&quot;&gt;$.get(&quot;...&quot;)&lt;/code&gt;&lt;/td&gt;
&lt;td&gt;Normal&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;Image&lt;/td&gt;
&lt;td&gt;&lt;code class=&quot;language-text&quot;&gt;&amp;lt;img src=&quot;...&quot;&gt;&lt;/code&gt;&lt;/td&gt;
&lt;td&gt;Normal&lt;/td&gt;
&lt;/tr&gt;
&lt;/tbody&gt;
&lt;/table&gt;
&lt;/br&gt;
&lt;h2&gt;SameSite 예외 설정을 추가하는 방법&lt;/h2&gt;
&lt;p&gt;이와 같이 Lax로 설정된 경우 Third-Party 도메인에서 나의 도메인으로 접근할 때 쿠키가 제대로 전달되지 않기 때문에 인증에 문제가 발생할 수 있다.
이러한 방법을 피하기 위해 SameSite 설정을 None으로 변경해줘 이러한 제한을 우회할 필요가 있다.
(Lax가 보안상 훨씬 안전하겠지만, 당장 적용하기에는 많은 수정 사항을 요하기 때문에...)&lt;/p&gt;
&lt;p&gt;내가 찾아본 방법으로는 크게 두 가지 방법으로 적용이 가능했다. Web 서버(Apache, Nginx)에 설정을 추가하는 방법과 WAS(Web Application Server)에 추가하는 방법인데
결국 쿠키를 생성하는 WAS에서 추가해야 정상적으로 먹혔었다. 또한, 단순히 SameSite=None으로 설정을 주는 것 뿐만 아니라, Secure 설정도 추가해야 정상적으로 동작한다.
즉, HTTPS 통신이 아니라면 쿠키를 사용할 생각을 하지 말라는 뜻과도 같다... ㅡㅡ;;&lt;/p&gt;
&lt;h3&gt;1. Web 서버의 경우&lt;/h3&gt;
&lt;p&gt;Apache 또는 Nginx의 서버 설정에 추가하여 유저가 받는 모든 쿠키 속성에 한 번에 추가가 가능하다.&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;Apache&lt;/li&gt;
&lt;/ul&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;apache&quot;&gt;&lt;pre class=&quot;language-apache&quot;&gt;&lt;code class=&quot;language-apache&quot;&gt;Header always edit Set-Cookie (.*) &amp;quot;$1; Secure; SameSite=None;&amp;quot;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;ul&gt;
&lt;li&gt;Nginx&lt;/li&gt;
&lt;/ul&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;nginx&quot;&gt;&lt;pre class=&quot;language-nginx&quot;&gt;&lt;code class=&quot;language-nginx&quot;&gt;&lt;span class=&quot;token directive&quot;&gt;&lt;span class=&quot;token keyword&quot;&gt;location&lt;/span&gt; /&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;
    &lt;span class=&quot;token comment&quot;&gt;# your usual config ... # hack, set all cookies to secure, httponly and samesite (strict or lax)&lt;/span&gt;
    &lt;span class=&quot;token directive&quot;&gt;&lt;span class=&quot;token keyword&quot;&gt;proxy_cookie_path&lt;/span&gt; / &lt;span class=&quot;token string&quot;&gt;&quot;/; secure; SameSite=None&quot;&lt;/span&gt;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;
    &lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;h3&gt;2. WAS(Web Application Server)에 설정할 경우&lt;/h3&gt;
&lt;p&gt;1번 방법의 경우 간편하지만, 쿠키가 서버에서 생성된 경우라면, 2번 방법을 적용해야할 것이다.
내가 담당했던 인증서버의 경우 golang으로 WAS를 구성하였기 때문에 golang에 대한 예시만 사용하였다.
물론 실제 적용한 내용은 아래보단 복잡했지만 대략적으로 요청에 대한 Response Writer 객체의 헤더 값을 가져와서, 해당 설정에 SameSite None과 Secure 설정을 추가하기만 하면 된다는 내용이다.
다른 언어의 경우 구글에서 제공한 &lt;a href=&quot;https://github.com/GoogleChromeLabs/samesite-examples&quot;&gt;example 코드&lt;/a&gt;를 참고하면 된다.&lt;/p&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;go&quot;&gt;&lt;pre class=&quot;language-go&quot;&gt;&lt;code class=&quot;language-go&quot;&gt;cs &lt;span class=&quot;token operator&quot;&gt;:=&lt;/span&gt; w&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;Header&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;Get&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token string&quot;&gt;&quot;Set-Cookie&quot;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;
cs &lt;span class=&quot;token operator&quot;&gt;+=&lt;/span&gt; &lt;span class=&quot;token string&quot;&gt;&quot;; SameSite=None; Secure&quot;&lt;/span&gt;
w&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;Header&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;Set&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token string&quot;&gt;&quot;Set-Cookie&quot;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; cs&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;하지만, 이렇게 간단했으면 좋았겠지만... 몇몇 버전의 접속 환경에서는 이러한 설정 변경이 제대로 먹히지 않기 때문에 SameSite 설정 변경에 대한 예외처리를 해야하는 경우도 있다.
이를 UserAgent를 사용하여 분기처리 해야 하는데, &lt;a href=&quot;https://www.chromium.org/updates/same-site/incompatible-clients&quot;&gt;예외처리에 대한 내용&lt;/a&gt;에 올라온 소스 코드대로 참고하여 추가해야 한다.&lt;/p&gt;
&lt;/br&gt;
&lt;h2&gt;향후 전망?&lt;/h2&gt;
&lt;p&gt;전 세계적으로 크롬 브라우저의 점유율이 가장 높고, 대부분의 브라우저들이 크롬에서 변경된 사양을 따라가는 경우가 많으므로, 이러한 SameSite 설정은 타 브라우저에서도 적용될 가능성이 매우 높다.
또한, 크롬은 장기적으로는 서드 파티 쿠키에 대한 지원을 단계적으로 제거하고 모든 쿠키가 Strict로 설정된 것 처럼 동작하도록 변경할 예정이라고 한다.
물론, 서드 파티 쿠키를 아예 지원하지 못하도록 하는 것은 아니고 이를 완화할 방안 역시 제공할 예정이라고 한다.
찾아본 바로는, SameParty라는 설정이 이러한 역할을 할 것으로 보이는데, 아직 한글화된 문헌이 많지 않아서... 나중에 정리해보려 한다.&lt;/p&gt;
&lt;/br&gt;
&lt;h3&gt;참조&lt;/h3&gt;
&lt;p&gt;&lt;a href=&quot;https://ifuwanna.tistory.com/223&quot;&gt;https://ifuwanna.tistory.com/223&lt;/a&gt;&lt;/br&gt;
&lt;a href=&quot;https://seob.dev/posts/%EB%B8%8C%EB%9D%BC%EC%9A%B0%EC%A0%80-%EC%BF%A0%ED%82%A4%EC%99%80-SameSite-%EC%86%8D%EC%84%B1/&quot;&gt;https://seob.dev/posts/%EB%B8%8C%EB%9D%BC%EC%9A%B0%EC%A0%80-%EC%BF%A0%ED%82%A4%EC%99%80-SameSite-%EC%86%8D%EC%84%B1/&lt;/a&gt;&lt;/br&gt;
&lt;a href=&quot;https://docs.microsoft.com/ko-kr/azure/active-directory/develop/howto-handle-samesite-cookie-changes-chrome-browser?tabs=dotnet&quot;&gt;https://docs.microsoft.com/ko-kr/azure/active-directory/develop/howto-handle-samesite-cookie-changes-chrome-browser?tabs=dotnet&lt;/a&gt;&lt;/br&gt;
&lt;a href=&quot;https://umbum.dev/1061&quot;&gt;https://umbum.dev/1061&lt;/a&gt;&lt;/p&gt;</content:encoded></item><item><title><![CDATA[[프로그래머스 연습문제] 해시]]></title><description><![CDATA[코테 연습할겸해서 풀었던 해시 문제들에 대한 풀이를 올려보았다. [Level 1] 완주하지 못한 선수 매우 간단한 문제로, 참가자와 완료한 선수들 명단이 있는데, 이중 완료하지 못한 선수 이름을 리턴하기만 하면 된다. 해시 맵에 묶여있어서 map…]]></description><link>https://github.com/SiverPineValley/SiverPineValley.github.io/algorithm/programmers_hash/</link><guid isPermaLink="false">https://github.com/SiverPineValley/SiverPineValley.github.io/algorithm/programmers_hash/</guid><pubDate>Mon, 04 Oct 2021 20:06:22 GMT</pubDate><content:encoded>&lt;p&gt;코테 연습할겸해서 풀었던 해시 문제들에 대한 풀이를 올려보았다.&lt;/p&gt;
&lt;h2&gt;[Level 1] 완주하지 못한 선수&lt;/h2&gt;
&lt;p&gt;매우 간단한 문제로, 참가자와 완료한 선수들 명단이 있는데, 이중 완료하지 못한 선수 이름을 리턴하기만 하면 된다.&lt;br&gt;
해시 맵에 묶여있어서 map을 글대로 사용해서 아래와 같이 작성했다.&lt;br&gt;
가장 효율적인 풀이를 보니 그냥 두 vector를 정렬해서 차례로 비교하다가 다른 값이 나오면 그대로 리턴, 혹은 가장 마지막 참가자를 리턴하면 정답이다.&lt;br&gt;
굳이 해시를 사용하지 않아도 최적의 풀이를 찾아낼 수 있는 문제였다.&lt;/p&gt;
&lt;/br&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;c++&quot;&gt;&lt;pre class=&quot;language-c++&quot;&gt;&lt;code class=&quot;language-c++&quot;&gt;// 프로그래머스
// hash - 완주하지 못한 선수
#include &amp;lt;string&amp;gt;
#include &amp;lt;vector&amp;gt;
#include &amp;lt;map&amp;gt;

using namespace std;

string solution(vector&amp;lt;string&amp;gt; participant, vector&amp;lt;string&amp;gt; completion) {
    string answer = &amp;quot;&amp;quot;;
    int size = completion.size();
    map&amp;lt;string,int&amp;gt; m;
    
    for(string c : completion) {
        if (!m.count(c)) {
            m[c] = 1;
        } else {
            m[c] = m[c] + 1;
        }
    }
    
        for(string p : participant) {
        if (!m.count(p)) {
            answer = p;
            break;
        } else if (m[p] == 0) {
            answer = p;
            break;
        } else {
            m[p] = m[p] - 1;
        }
    }
    
    return answer;
}&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;h2&gt;[Level 2] 전화번호 목록&lt;/h2&gt;
&lt;p&gt;전화번호 목록은 전화번호 리스트 중에 Prefix가 되는 전화번호가 있으면 false를 리턴하는 문제이다.&lt;br&gt;
이번에도 간단한 문제이지만, 효율성 테스트를 통과하기가 조금 더 어려워졌다.&lt;br&gt;
Hash Map을 사용하여 아래와 같이 풀었지만, 마지막 효율성 테스트가 도저히 통과가 되질 않았다..&lt;br&gt;
아무래도 처음에 Map을 생성하는 행위와, map을 순회하면서 비교하는 행위의 까지 하여 O(n^2) 의 시간복잡도라 풀리지 않은 것 같다.
Map을 담은 조건은 각 string의 길이를 key로 잡았고, 비교할 때 이보다 큰 길이의 string들만 비교하도록 하였다.&lt;/p&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;c++&quot;&gt;&lt;pre class=&quot;language-c++&quot;&gt;&lt;code class=&quot;language-c++&quot;&gt;#include &amp;lt;string&amp;gt;
#include &amp;lt;vector&amp;gt;
#include &amp;lt;set&amp;gt;
#include &amp;lt;unordered_map&amp;gt;

using namespace std;

bool solution(vector&amp;lt;string&amp;gt; phone_book) {
    set&amp;lt;int&amp;gt; phone_size;
    unordered_map&amp;lt;int,vector&amp;lt;string&amp;gt;&amp;gt; map_book;
    
    // Map 생성
    for(string each_book : phone_book) {
        int length = each_book.length();
        map_book[length].push_back(each_book);
        phone_size.insert(length);
    }
    
    // Map 비교
    for(auto length = phone_size.begin(); length != phone_size.end(); length++) {
        for (string source : map_book[*length]) {
                for(auto cmp = next(length,1); cmp != phone_size.end(); cmp++) {
                    for (string target : map_book[*cmp]) {
                        if(source == target.substr(0, *length)) return false;
                    }
            }
        }
    }
    
    return true;
}&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;이 문제의 핵심은 string의 길이 순으로 정렬하는게 아니라, 사전순으로 정렬하는 것이 정답이다.&lt;br&gt;
아래와 같이 사전순으로 정렬하게 되면 O(n*m)의 효율성으로 통과가 가능하게 된다.&lt;/p&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;c++&quot;&gt;&lt;pre class=&quot;language-c++&quot;&gt;&lt;code class=&quot;language-c++&quot;&gt;#include &amp;lt;string&amp;gt;
#include &amp;lt;vector&amp;gt;
#include &amp;lt;unordered_map&amp;gt;

using namespace std;

bool solution(vector&amp;lt;string&amp;gt; phone_book) {
    unordered_map&amp;lt;string,int&amp;gt; map_book;
    
    // Map 생성
    for(string each_book : phone_book)
        map_book[each_book] = 1;
    
    // Map 비교
    for(string each_book : phone_book) {
        string book = &amp;quot;&amp;quot;;
        for (int i = 0; i &amp;lt; each_book.size(); i++) {
            book += each_book[i];
            if (map_book[book] &amp;amp;&amp;amp; book != each_book) {
                return false;
            }
        }
    }
    
    return true;
}&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;h2&gt;[Level 2] 위장&lt;/h2&gt;
&lt;p&gt;각 의상의 종류별로 카운팅하여 마지막에 곱셈만 해주면 되는 문제라 쉽게 풀린다.&lt;/p&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;c++&quot;&gt;&lt;pre class=&quot;language-c++&quot;&gt;&lt;code class=&quot;language-c++&quot;&gt;#include &amp;lt;string&amp;gt;
#include &amp;lt;vector&amp;gt;
#include &amp;lt;algorithm&amp;gt;
#include &amp;lt;unordered_map&amp;gt;

using namespace std;

int solution(vector&amp;lt;vector&amp;lt;string&amp;gt;&amp;gt; clothes) {
    int answer = 1;
    
    unordered_map&amp;lt;string,int&amp;gt; cloth_map;
    int cloth_type = 0;

    for(vector&amp;lt;string&amp;gt; cloth : clothes) {
        if(cloth_map.count(cloth[1]) &amp;gt; 0) {
            cloth_map[cloth[1]]++;
        } else {
            cloth_map[cloth[1]] = 1;
            cloth_type++;
        }
    }
    
    unordered_map&amp;lt;string,int&amp;gt;::iterator iter;
    for(iter = cloth_map.begin(); iter!= cloth_map.end(); iter++){
        answer = answer + (iter-&amp;gt;second * answer);   
    }
    return answer-1;
}&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;h2&gt;[Level 3] 베스트 앨범&lt;/h2&gt;
&lt;p&gt;베스트 앨범은 각 장르별, 재생수별로 정렬된 노래들을 각 장르별로 2곡씩 선별하여 정렬된 노래의 고유 번호를 출력하는 문제이다.&lt;br&gt;
map으로 장르별 총 재생 수, 장르별 각 노래별 재생 수를 담아놓고, 장르별로 최대 2곡씩 뽑아서 answr에 push하면 된다.
각 정렬 시 내림차순, 오름차순 정렬을 해야 해서 별도의 정렬 함수를 생성하였다.&lt;/p&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;c++&quot;&gt;&lt;pre class=&quot;language-c++&quot;&gt;&lt;code class=&quot;language-c++&quot;&gt;#include &amp;lt;string&amp;gt;
#include &amp;lt;vector&amp;gt;
#include &amp;lt;map&amp;gt;
#include &amp;lt;queue&amp;gt;
#include &amp;lt;algorithm&amp;gt;
#include &amp;lt;iostream&amp;gt;

using namespace std;

// 내림차순 정렬
bool cmp_total(const pair&amp;lt;string,int&amp;gt;&amp;amp; left, const pair&amp;lt;string,int&amp;gt;&amp;amp; right) {
	return right.second &amp;lt; left.second;
}

// 재생수 같으면, 고유번호의 오름차순
// 재생수는 내림차순
bool cmp_each(const pair&amp;lt;int,int&amp;gt;&amp;amp; left, const pair&amp;lt;int,int&amp;gt;&amp;amp; right) {
    if (left.first == right.first) {
        return left.second &amp;lt; right.second;
    }
    return right.first &amp;lt; left.first;
}

vector&amp;lt;int&amp;gt; solution(vector&amp;lt;string&amp;gt; genres, vector&amp;lt;int&amp;gt; plays) {
    int size = genres.size();
    vector&amp;lt;int&amp;gt; answer;
    map&amp;lt;string,int&amp;gt; genre_total;
    map&amp;lt;string,vector&amp;lt;pair&amp;lt;int,int&amp;gt;&amp;gt;&amp;gt; genre_play;
    
    // map 생성
    for(int i = 0; i &amp;lt; size; i++) {
        if (genre_total.count(genres[i]) == 0) {
            genre_total[genres[i]] = plays[i];
            vector&amp;lt;pair&amp;lt;int,int&amp;gt;&amp;gt; temp;
            temp.push_back(make_pair(plays[i],i));
            genre_play[genres[i]] = temp;
            continue;
        }
        genre_total[genres[i]] = genre_total[genres[i]] + plays[i];
        auto temp = genre_play[genres[i]];
        temp.push_back(make_pair(plays[i],i));
        genre_play[genres[i]] = temp;
    }
    
    // 장르별 정렬
    vector&amp;lt;pair&amp;lt;string, int&amp;gt; &amp;gt; arr;
    for (const auto &amp;amp;item : genre_total) {
        arr.emplace_back(item);
    }
    sort(arr.begin(), arr.end(), cmp_total);
    
    // answer에 담기
    for(auto it = arr.begin(); it != arr.end(); it++) {
        auto each = genre_play[it-&amp;gt;first];
        sort(each.begin(), each.end(), cmp_each);
        int idx = 0;
        int each_size = each.size();
        while(idx &amp;lt; 2 &amp;amp;&amp;amp; idx &amp;lt; each_size) {
            auto each_value = each[idx].second;
            answer.push_back(each_value);
            idx++;
        }
    }
    
    return answer;
}&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;</content:encoded></item><item><title><![CDATA[[Gatsby Blog 만들기 - 2] Gastby Blog 배포 (gatsby-starter-bee)]]></title><description><![CDATA[이번에는 생성한 gatsby 프로젝트를 Netlify를 사용해 배포하는 법에 대해 적어보겠다. 설치 과정이 좀 고됬지만 배포는 그보다는 훨씬 간단하다. Netlify라는 정적 웹사이트 배포 도구가 있어 별도 도메인을 빌려야할 필요도 없고, github…]]></description><link>https://github.com/SiverPineValley/SiverPineValley.github.io/gatsby/gatsby_deploy/</link><guid isPermaLink="false">https://github.com/SiverPineValley/SiverPineValley.github.io/gatsby/gatsby_deploy/</guid><pubDate>Sat, 25 Sep 2021 23:26:20 GMT</pubDate><content:encoded>&lt;p&gt;이번에는 생성한 gatsby 프로젝트를 Netlify를 사용해 배포하는 법에 대해 적어보겠다. 설치 과정이 좀 고됬지만 배포는 그보다는 훨씬 간단하다. Netlify라는 정적 웹사이트 배포 도구가 있어 별도 도메인을 빌려야할 필요도 없고, github 계정만 있으면 된다.&lt;/p&gt;
&lt;h1&gt;배포 방법&lt;/h1&gt;
&lt;h2&gt;1. git repository 생성&lt;/h2&gt;
&lt;div align=&quot;left&quot;&gt;
  &lt;span class=&quot;gatsby-resp-image-wrapper&quot; style=&quot;position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 630px; &quot;&gt;
      &lt;a class=&quot;gatsby-resp-image-link&quot; href=&quot;/static/03d897abf8abf9e9d6164a26a1901e50/40a97/git_repository.png&quot; style=&quot;display: block&quot; target=&quot;_blank&quot; rel=&quot;noopener&quot;&gt;
    &lt;span class=&quot;gatsby-resp-image-background-image&quot; style=&quot;padding-bottom: 55.69620253164557%; position: relative; bottom: 0; left: 0; background-image: url(&apos;data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAALCAIAAADwazoUAAAACXBIWXMAAA7DAAAOwwHHb6hkAAABBElEQVR42oWRa1KEMBCEuf/t/OkRLF2XhGSemcSG6C7WruVUk4LQHzNplmuqH+uurdCuyoVkqrKw+llVVNQgll1Lj+hHxaE+BjFvpVZiNW/RcVmLQpxLeXl7fc8rduDEsoxT7egYa66XzxW87h3UvUHoRiyplITuHtO/9EmcapOAFTfuzsx99OnBKqJMjI/NnSdwEZ+wGWCJnxNFBIsQ3t3g8VBqWkqF1VtDq34qVa2krO177EcYQMoZ5zQzIo57NQzCdFW9NN7C4zl8TRlJ47cg9BnYVK3sLs0l3P4YWzWl3BrcLiznsfl4vDmfwpaOznakfQ+sB/0Lg5mBoTkC/x2YneEv4GiHltBwM7wAAAAASUVORK5CYII=&apos;); background-size: cover; display: block;&quot;&gt;&lt;/span&gt;
  &lt;img class=&quot;gatsby-resp-image-image&quot; alt=&quot;git repository&quot; title=&quot;&quot; src=&quot;/static/03d897abf8abf9e9d6164a26a1901e50/f058b/git_repository.png&quot; srcset=&quot;/static/03d897abf8abf9e9d6164a26a1901e50/c26ae/git_repository.png 158w,
/static/03d897abf8abf9e9d6164a26a1901e50/6bdcf/git_repository.png 315w,
/static/03d897abf8abf9e9d6164a26a1901e50/f058b/git_repository.png 630w,
/static/03d897abf8abf9e9d6164a26a1901e50/40601/git_repository.png 945w,
/static/03d897abf8abf9e9d6164a26a1901e50/78612/git_repository.png 1260w,
/static/03d897abf8abf9e9d6164a26a1901e50/40a97/git_repository.png 1911w&quot; sizes=&quot;(max-width: 630px) 100vw, 630px&quot; style=&quot;width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;&quot; loading=&quot;lazy&quot; decoding=&quot;async&quot;&gt;
  &lt;/a&gt;
    &lt;/span&gt;
&lt;/div&gt;
&lt;p&gt;Netlify에 연동하기 전에, git에 repository를 생성해둬야 한다. &lt;a href=&quot;./gatsby_start.md&quot;&gt;기존에 생성한 gatsby 프로젝트&lt;/a&gt;에서 생성한 프로젝트를 git repository에 연결한다.
자세한 방법은 구글링하면 자세히 나오므로... 이 부분은 생략.&lt;/p&gt;
&lt;h2&gt;2. &lt;a href=&quot;https://app.netlify.com/&quot;&gt;Netlify&lt;/a&gt; 접속&lt;/h2&gt;
&lt;div align=&quot;left&quot;&gt;
  &lt;span class=&quot;gatsby-resp-image-wrapper&quot; style=&quot;position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 630px; &quot;&gt;
      &lt;a class=&quot;gatsby-resp-image-link&quot; href=&quot;/static/b31e442044ebd994291b6148b9dda5c9/c483d/netlify_signup.png&quot; style=&quot;display: block&quot; target=&quot;_blank&quot; rel=&quot;noopener&quot;&gt;
    &lt;span class=&quot;gatsby-resp-image-background-image&quot; style=&quot;padding-bottom: 79.74683544303798%; position: relative; bottom: 0; left: 0; background-image: url(&apos;data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAQCAIAAACZeshMAAAACXBIWXMAAA7DAAAOwwHHb6hkAAACz0lEQVR42mPgk1PFjuTVeKWVxKydRQ0seaUVgVxMNQxYdfLLgzTzSCko+ERIW7vzSMrzE6+ZV1aFR0aZW1qJW0KeW0oRwgWS6JqBRgoqaiAjISVNEycPI3tXXRsnHSsHdTMbHWsHM2dPDXNbHhkU/QxA4xkEJRkEJZARu7gcp6QCh6QCp6SiqIq2iIqWuJquqKoOus3qptZl9c3FNQ1QVAtChVV1+RU1QEZiTgHQaUAHQxC6Zt/IuP/////79+8/Kvj79y+QvHXnrqiKFoeEPNDPPNJKfED9SIghIDrxzZs3UyZPBqLp06fPmTNnxowZs2bOnDZ16vZt267euCmqrCmtoSepriOmosktKQ+MAiACRh4QMYQkpN67f9/SzsHK3tHR1S0kLDwkLMLG0dnA1DynoPD6rVtiqlrSOgZS6jriqtqC8qoCcipAEqrZNzbl/+snvxrDfzVG/GyJ+dmf/bMv81dT1M/qwP9LW2/cuiWppuPg5W/p6mls72Lj7uMaEGJk68QpLscro8TgH5v07c3b7a2dQLS7q/fApGn7Jk7d2d69ub75/IrVN27dFlfVMnFwNXFw0bd21LOy17d2EFXSALlcRpEhLD7hxrNfUmnnpdLPaxddsau/bll9TSnnkkD8mdAJD6/fvC2ppq1jaWdo62Rk52wEJoFmWbh4KugaM/hHJ7x7/2H2olVzFq+evWj1ghUb5y1bD2RPm7dsx97DV6/fAHpV28JWz9pBF2Qt0HIHVUNzJX1TYPiBNH/79m3Xvn279+/fuXfv4WPH9h08BORu37374pUrN2/fASoCuhwY4DJa+kD/y2jq88soQYKdwdTJY8PW7Vt27t68Y9fOfQf2Hz66/8ixbbv3Ark79u6bNHOOkKI6l5QiMJK5pRW5wSSvrDI0noF8VlEZZhFpJmEpYBqS0jSQ1NRnE5cDcoGCbGKy4EymhozgKQwAn+cgYwwGxRUAAAAASUVORK5CYII=&apos;); background-size: cover; display: block;&quot;&gt;&lt;/span&gt;
  &lt;img class=&quot;gatsby-resp-image-image&quot; alt=&quot;netlify signup&quot; title=&quot;&quot; src=&quot;/static/b31e442044ebd994291b6148b9dda5c9/f058b/netlify_signup.png&quot; srcset=&quot;/static/b31e442044ebd994291b6148b9dda5c9/c26ae/netlify_signup.png 158w,
/static/b31e442044ebd994291b6148b9dda5c9/6bdcf/netlify_signup.png 315w,
/static/b31e442044ebd994291b6148b9dda5c9/f058b/netlify_signup.png 630w,
/static/b31e442044ebd994291b6148b9dda5c9/c483d/netlify_signup.png 751w&quot; sizes=&quot;(max-width: 630px) 100vw, 630px&quot; style=&quot;width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;&quot; loading=&quot;lazy&quot; decoding=&quot;async&quot;&gt;
  &lt;/a&gt;
    &lt;/span&gt;
&lt;/div&gt;
&lt;p&gt;상기 링크를 접속해서 GitHub로 로그인한다. Email로 계정 생성 후 github를 연결해도 되지만 귀찮으므로 그냥 github 소셜 로그인을 이용한다. 로그인 이후, 아래의 &lt;code class=&quot;language-text&quot;&gt;New site from Git&lt;/code&gt; 버튼 클릭&lt;/p&gt;
&lt;div align=&quot;left&quot;&gt;
  &lt;span class=&quot;gatsby-resp-image-wrapper&quot; style=&quot;position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 630px; &quot;&gt;
      &lt;a class=&quot;gatsby-resp-image-link&quot; href=&quot;/static/1df803efa20e8d5a07b363c05941f235/f3c12/netlify_new.png&quot; style=&quot;display: block&quot; target=&quot;_blank&quot; rel=&quot;noopener&quot;&gt;
    &lt;span class=&quot;gatsby-resp-image-background-image&quot; style=&quot;padding-bottom: 86.0759493670886%; position: relative; bottom: 0; left: 0; background-image: url(&apos;data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAARCAIAAABSJhvpAAAACXBIWXMAAA7DAAAOwwHHb6hkAAACJUlEQVR42pVSW28SQRSeRKx9UKOhBAqUEqWQitRWa4wmJjax8dkf4qsvPmhTEy9I+2Lqi/+lRlpL1MQHL4kVNZUAu7OwN3Z3dmd2Fs9SIBQN2i8nZ79z9pw5M98Mii7fTixcu7y0vLh0K3v1xvz1m1PZS8fjZ08mZk5MpYZsKIni2YuJ3OKZ+SuTsxcimbnYuYVIJhdO50KpbDg9F5o5D3w/hL/dpO9z4UwOTaRmTyczp5LpQDAaCMaOhuJAxiPTR4LRY5HpwERsLJwYC/vh+GQSwn4SatCdu/ce5tfvP8qvPC2s5tdX82tgDx4/W3lS6PuhsJcsoPKPn4ZhNJtNTW8BqdWFj5+/cNdtj4TnedzlaLf8ndgE+lRVJoTYjmNZhLn/AGOMUoZgnu3DkWWJUqe7bA+8h6EMEChEMKRSrdYEoSErJiFWx6r1uihJIsaKphHbhoyIJdyQBFHUdB12ahEbY8Fv3qtUoFrVdeCMuw6lAsbQQGFvjLmcw1lkVYWtEscBsykljm1YJqKuy9setNE/jB3gnB1UkXGOLNtWVBVW8AbPug84fsd4p9qk9EVpu1DcXCtugt9TZEQp1TQNNBh1MR1vUfry/c5GqbhR2nq+8/qXoiDNND582/30tSwrvjamBSCGaQIZfdWgOAIlXm1tv3n7DpTEUqMmiBXQHmO91fprQ99ABQQ3Dm8D5oCY7cPAn8w9b/DRdXXqfv+jeUDdw03+DXojJjVX0lJdAAAAAElFTkSuQmCC&apos;); background-size: cover; display: block;&quot;&gt;&lt;/span&gt;
  &lt;img class=&quot;gatsby-resp-image-image&quot; alt=&quot;netlify new&quot; title=&quot;&quot; src=&quot;/static/1df803efa20e8d5a07b363c05941f235/f058b/netlify_new.png&quot; srcset=&quot;/static/1df803efa20e8d5a07b363c05941f235/c26ae/netlify_new.png 158w,
/static/1df803efa20e8d5a07b363c05941f235/6bdcf/netlify_new.png 315w,
/static/1df803efa20e8d5a07b363c05941f235/f058b/netlify_new.png 630w,
/static/1df803efa20e8d5a07b363c05941f235/f3c12/netlify_new.png 764w&quot; sizes=&quot;(max-width: 630px) 100vw, 630px&quot; style=&quot;width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;&quot; loading=&quot;lazy&quot; decoding=&quot;async&quot;&gt;
  &lt;/a&gt;
    &lt;/span&gt;
&lt;/div&gt;
&lt;h2&gt;3. Netlify - github 연결&lt;/h2&gt;
&lt;p&gt;gatsby용으로 생성한 repository 선택 후, 빌드 파라미터를 아래와 같이 입력해야 한다.&lt;/p&gt;
&lt;p&gt;특히 환경변수가 중요한데, 내가 선택한 &lt;a href=&quot;https://github.com/JaeYeopHan/gatsby-starter-bee&quot;&gt;gatsby-starter-bee&lt;/a&gt;의 경우 node-sass를 사용하는데, 16 버전 이상의 Node에서는 정상적으로 빌드가 불가능하다.&lt;/p&gt;
&lt;p&gt;Stable 최신 버전인 14.17.6을 입력하였다. 다 입력했으면, 아래에서 &lt;code class=&quot;language-text&quot;&gt;Deploy Site&lt;/code&gt; 버튼 클릭.&lt;/p&gt;
&lt;div align=&quot;left&quot;&gt;
  &lt;span class=&quot;gatsby-resp-image-wrapper&quot; style=&quot;position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 630px; &quot;&gt;
      &lt;a class=&quot;gatsby-resp-image-link&quot; href=&quot;/static/4366ab706dc59ba7ad0dc1edd2736442/f2793/gatsby_deploy_params.png&quot; style=&quot;display: block&quot; target=&quot;_blank&quot; rel=&quot;noopener&quot;&gt;
    &lt;span class=&quot;gatsby-resp-image-background-image&quot; style=&quot;padding-bottom: 157.59493670886076%; position: relative; bottom: 0; left: 0; background-image: url(&apos;data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAgCAIAAACdAM/hAAAACXBIWXMAAA7DAAAOwwHHb6hkAAACwklEQVR42qVV6XKbMBD2+79ckzpO2h+N7XBjdIAuBAj6SYo9Tkya8XRnEbpW2uPb1UaZnkvVKsXBUlIh0AZGRzEhmpabcZyWeZw9D/NsnRucW5Zlc9LqldE9Z4eWZUqWvcmkwBCcSlEYXRhTaLXnfs+e0UPLc62I7b2wHQYlldJaSTlNE6bGcVR+JMdhXAI551QgTGqjlzNtlv+gDaG0quu8KOqmORGSl2VRVWmWYQZ8ahoXzFsX7kTXUIpNYMbbhpDQJ/WpqfERIiSsUmhBXSeuz9rAwjiewYEwnD8SJlwgOGW+vhmnNg3pPLVw3nI+4kJDmFxXG2uctyB4HFrcCv/LZljCODd9fysWKcZvXRi3GWPiYFV4GMcvhaGtVBLObLvWmP6+OFPGGhCiXVWw3doBJsBzxv8sGHqhC4ptb/0H/wdhKXNG65YnhBSMCaWDlPVbrY2dyNrEI7x09OLGTlM/TaEd+49h/F5tBPn1cCyrKgcayzJJ87yskixLszxN86wokgwrJeDquSjSvMASpdwLA4I/d89Pzy/b3Uton3e/fj9snx622x+P28en3f749pZkxyR957fkcEzqE/HCFzC6+R2D39I0ubPN1nrECwH33BjlPQCQVPUpouAmzlojV5A4I7y1RtDMV6F1kGiFBEbuIcKrIMOhWF2/WRvDmE8N4PSLm51dsei9GAhUD2Dq4q7bxGgIXb8Za59cdSPspNJfliHCGGEU8G4ogSJ3IKztfA1jjFHOUQzRCzA2iALaWLq0Tw4/80nzDeIEGWyq27aC4/BQoKx0wn94SboOQxGAAA4d6c5HeJujkxBlXwpnNyGsIebXqAoQdNg6XVdP/w6o+GaYqBWSGJfggLPr8IZMSIEVmxHDaCohFErEC6EqsvnieUBgXRiZHat5RNh9ZYhzjiz7sz9Qxq9D/TlF5pUy8RcDYEg2ksjWxwAAAABJRU5ErkJggg==&apos;); background-size: cover; display: block;&quot;&gt;&lt;/span&gt;
  &lt;img class=&quot;gatsby-resp-image-image&quot; alt=&quot;gatsby deploy params&quot; title=&quot;&quot; src=&quot;/static/4366ab706dc59ba7ad0dc1edd2736442/f058b/gatsby_deploy_params.png&quot; srcset=&quot;/static/4366ab706dc59ba7ad0dc1edd2736442/c26ae/gatsby_deploy_params.png 158w,
/static/4366ab706dc59ba7ad0dc1edd2736442/6bdcf/gatsby_deploy_params.png 315w,
/static/4366ab706dc59ba7ad0dc1edd2736442/f058b/gatsby_deploy_params.png 630w,
/static/4366ab706dc59ba7ad0dc1edd2736442/f2793/gatsby_deploy_params.png 743w&quot; sizes=&quot;(max-width: 630px) 100vw, 630px&quot; style=&quot;width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;&quot; loading=&quot;lazy&quot; decoding=&quot;async&quot;&gt;
  &lt;/a&gt;
    &lt;/span&gt;
&lt;/div&gt;
&lt;h2&gt;4. 빌드&lt;/h2&gt;
&lt;p&gt;정상적으로 빌드되었다면 아래와 같은 문구로 끝나게 된다. 이제 빌드된 사이트로 접속하면 끝~ 😎😎😎&lt;/p&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;sh&quot;&gt;&lt;pre class=&quot;language-sh&quot;&gt;&lt;code class=&quot;language-sh&quot;&gt;Finished processing build request &lt;span class=&quot;token keyword&quot;&gt;in&lt;/span&gt; 3m19.334334179s&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;h2&gt;5. 도메인 설정&lt;/h2&gt;
&lt;p&gt;추가적으로, 처음 Netlify를 통해 배포하면 자동으로 도메인을 부여받는데, 내가 일부 도메인을 설정할 수 있다.
Netlify 홈에서 &lt;code class=&quot;language-text&quot;&gt;Domain Settings&lt;/code&gt; -&gt; &lt;code class=&quot;language-text&quot;&gt;Options&lt;/code&gt; -&gt; &lt;code class=&quot;language-text&quot;&gt;Edit site name&lt;/code&gt; 을 통해 변경 가능하다.&lt;/p&gt;
&lt;p&gt;또, 별도로 커스텀 도메인을 구입한게 있다면 역시 설정 가능하다.&lt;/p&gt;</content:encoded></item><item><title><![CDATA[[Gatsby Blog 만들기 - 1] Gastby Blog 설치 (gatsby-starter-bee)]]></title><description><![CDATA[오랫만에 다시 Gatsby 블로그를 개설했다. 너무 간만인지 개삽질을 거듭해서 아래와 같이 정리하게 되었다. Windows WSL2 기반으로 작성했으며, WSL2 설치는 아래 Blog를 참조하였다. 설치 방법 😎 1. nvm…]]></description><link>https://github.com/SiverPineValley/SiverPineValley.github.io/gatsby/gatsby_start/</link><guid isPermaLink="false">https://github.com/SiverPineValley/SiverPineValley.github.io/gatsby/gatsby_start/</guid><pubDate>Sat, 25 Sep 2021 20:39:13 GMT</pubDate><content:encoded>&lt;p&gt;오랫만에 다시 Gatsby 블로그를 개설했다. 너무 간만인지 개삽질을 거듭해서 아래와 같이 정리하게 되었다. Windows WSL2 기반으로 작성했으며, WSL2 설치는 아래 &lt;a href=&quot;https://www.lainyzine.com/ko/article/how-to-install-wsl2-and-use-linux-on-windows-10/&quot;&gt;Blog&lt;/a&gt;를 참조하였다.&lt;/p&gt;
&lt;h1&gt;설치 방법 😎&lt;/h1&gt;
&lt;h2&gt;1. nvm 설치&lt;/h2&gt;
&lt;p&gt;가장 먼저, NodeJS를 설치했다. 다만, 그 전에 WSL2 설치하니 NodeJS가 기존 system 버전으로 잡혀있어서 nvm을 먼저 설치했다.&lt;/p&gt;
&lt;p&gt;그 후에 최신 Stable 버전인 14.17.6 버전으로 설치했다.&lt;/p&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;sh&quot;&gt;&lt;pre class=&quot;language-sh&quot;&gt;&lt;code class=&quot;language-sh&quot;&gt;&lt;span class=&quot;token comment&quot;&gt;# 빌드 환경 설치&lt;/span&gt;
$ &lt;span class=&quot;token function&quot;&gt;sudo&lt;/span&gt; &lt;span class=&quot;token function&quot;&gt;apt-get&lt;/span&gt; &lt;span class=&quot;token function&quot;&gt;install&lt;/span&gt; build-essential libssl-dev

&lt;span class=&quot;token comment&quot;&gt;# nvm 설치&lt;/span&gt;
$ &lt;span class=&quot;token function&quot;&gt;curl&lt;/span&gt; -o- https://raw.githubusercontent.com/nvm-sh/nvm/v0.38.0/install.sh &lt;span class=&quot;token operator&quot;&gt;|&lt;/span&gt; &lt;span class=&quot;token function&quot;&gt;bash&lt;/span&gt;

&lt;span class=&quot;token comment&quot;&gt;# NodeJS 설치&lt;/span&gt;
$ nvm &lt;span class=&quot;token function&quot;&gt;install&lt;/span&gt; &lt;span class=&quot;token number&quot;&gt;14.17&lt;/span&gt;.6
$ nvm use &lt;span class=&quot;token number&quot;&gt;14.17&lt;/span&gt;.6
$ nvm &lt;span class=&quot;token function&quot;&gt;ls&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;여기까지 했을 때, 현재 버전이 14.17.6으로 되어있으면 정상적으로 NodeJS가 설치된 것이다.&lt;/p&gt;
&lt;p&gt;추가로, 내가 설치하려는 &lt;a href=&quot;https://github.com/JaeYeopHan/gatsby-starter-bee&quot;&gt;gatsby-starter-bee&lt;/a&gt;는 npm이 7.0.0 버전 이상이어야 dependency 오류가 발생하지 않았으므로, 아래와 같이 npm 버전도 업데이트한다.&lt;/p&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;sh&quot;&gt;&lt;pre class=&quot;language-sh&quot;&gt;&lt;code class=&quot;language-sh&quot;&gt;&lt;span class=&quot;token comment&quot;&gt;# npm 업데이트&lt;/span&gt;
$ &lt;span class=&quot;token function&quot;&gt;npm&lt;/span&gt; &lt;span class=&quot;token function&quot;&gt;install&lt;/span&gt; &lt;span class=&quot;token parameter variable&quot;&gt;-g&lt;/span&gt; npm@latest&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;h2&gt;2. Gatsby 설치 및 프로젝트 생성&lt;/h2&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;sh&quot;&gt;&lt;pre class=&quot;language-sh&quot;&gt;&lt;code class=&quot;language-sh&quot;&gt;&lt;span class=&quot;token comment&quot;&gt;# gatsby 설치&lt;/span&gt;
$ &lt;span class=&quot;token function&quot;&gt;npm&lt;/span&gt; &lt;span class=&quot;token function&quot;&gt;install&lt;/span&gt; &lt;span class=&quot;token parameter variable&quot;&gt;-g&lt;/span&gt; gatsby-cli

&lt;span class=&quot;token comment&quot;&gt;# gatsby 프로젝트 init&lt;/span&gt;
$ gatsby new new-gatsby https://github.com/JaeYeopHan/gatsby-starter-bee
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;h2&gt;3. Gatsby 로컬 빌드&lt;/h2&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;sh&quot;&gt;&lt;pre class=&quot;language-sh&quot;&gt;&lt;code class=&quot;language-sh&quot;&gt;$ &lt;span class=&quot;token builtin class-name&quot;&gt;cd&lt;/span&gt; new-gatsby/
$ &lt;span class=&quot;token function&quot;&gt;npm&lt;/span&gt; start
&lt;span class=&quot;token comment&quot;&gt;# open localhost:8000&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;h2&gt;4. Gastby 설치 오류 발생 시 🤢&lt;/h2&gt;
&lt;p&gt;나 같은 경우에는 여러 가지 오류가 발생해서 설치 중 많은 고통을 느끼게 했었다.&lt;/p&gt;
&lt;h3&gt;1) npm 버전 문제&lt;/h3&gt;
&lt;p&gt;npm 버전이 7.0.0 이상이어야 dependency에서 문제가 잡히지 않았다. 최초 설치시에는 6버전대였는데,
위에 설명한대로 잘 따라왔다면 이 문제는 발생하지 않을 것이다.&lt;/p&gt;
&lt;h3&gt;2) python2 미설치 문제&lt;/h3&gt;
&lt;p&gt;python2가 설치되지 않아서 생겼던 문제인데, 결론적으로는 python2만 설치해주면 끝이나 WSL2에 기본 설치된 python3의 기본 경로때문에 문제가 발생했다.&lt;/p&gt;
&lt;p&gt;분명히 python2로 alias도 설정했으나, PATH 변수의 python3 바이너리만 찾아서 빌드를 해대서 문제가 발생했다.&lt;/p&gt;
&lt;p&gt;아래와 같이 해결을 했다.&lt;/p&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;sh&quot;&gt;&lt;pre class=&quot;language-sh&quot;&gt;&lt;code class=&quot;language-sh&quot;&gt;&lt;span class=&quot;token comment&quot;&gt;# 빌드 도구 미리 설치&lt;/span&gt;
$ &lt;span class=&quot;token function&quot;&gt;sudo&lt;/span&gt; &lt;span class=&quot;token function&quot;&gt;apt-get&lt;/span&gt; update
$ &lt;span class=&quot;token function&quot;&gt;sudo&lt;/span&gt; &lt;span class=&quot;token function&quot;&gt;apt-get&lt;/span&gt; g++
$ &lt;span class=&quot;token function&quot;&gt;sudo&lt;/span&gt; &lt;span class=&quot;token function&quot;&gt;apt-get&lt;/span&gt; &lt;span class=&quot;token function&quot;&gt;install&lt;/span&gt; build-essential gdb
$ &lt;span class=&quot;token function&quot;&gt;sudo&lt;/span&gt; &lt;span class=&quot;token function&quot;&gt;apt-get&lt;/span&gt; &lt;span class=&quot;token function&quot;&gt;make&lt;/span&gt;

&lt;span class=&quot;token comment&quot;&gt;# python2.7.18 다운로드&lt;/span&gt;
$ &lt;span class=&quot;token function&quot;&gt;wget&lt;/span&gt; https://www.python.org/ftp/python/2.7.18/Python-2.7.18.tgz

&lt;span class=&quot;token comment&quot;&gt;# 압축 해제&lt;/span&gt;
$ &lt;span class=&quot;token function&quot;&gt;tar&lt;/span&gt; xzf Python-2.7.18.tgz
$ Python-2.7.18

&lt;span class=&quot;token comment&quot;&gt;# 빌드 및 설치&lt;/span&gt;
$ ./configure --enable-optimizations
$ &lt;span class=&quot;token function&quot;&gt;sudo&lt;/span&gt; &lt;span class=&quot;token function&quot;&gt;make&lt;/span&gt; altinstall
$ &lt;span class=&quot;token function&quot;&gt;make&lt;/span&gt;

&lt;span class=&quot;token comment&quot;&gt;# python 버전 설정&lt;/span&gt;
&lt;span class=&quot;token builtin class-name&quot;&gt;alias&lt;/span&gt; &lt;span class=&quot;token assign-left variable&quot;&gt;python&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt;python2
python2

&lt;span class=&quot;token comment&quot;&gt;# python 바이너리 교체&lt;/span&gt;
&lt;span class=&quot;token function&quot;&gt;sudo&lt;/span&gt; &lt;span class=&quot;token function&quot;&gt;cp&lt;/span&gt; /usr/bin/local/python  /usr/bin/python&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;참고로 이 부분에서 gcc, g++, make과 같은 빌드 도구들을 미리 설치해 놓는 것이 좋다.&lt;/p&gt;
&lt;p&gt;WSL2의 경우 기본 설치되지 않았을 확률이 높으므로...&lt;/p&gt;
&lt;p&gt;마지막의 바이너리 교체는 python2 설치 경로가 위와 같을때 그대로 하면 되고, 아니면 설치된 경로에 맞게 넣으면 된다.&lt;/p&gt;</content:encoded></item></channel></rss>